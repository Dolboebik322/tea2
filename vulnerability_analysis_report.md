# Wheel of Whales - Анализ уязвимостей и потенциальных эксплойтов

## Обзор

Wheel of Whales - это браузерная игра-кликер с элементами мини-игр, работающая как Telegram Web App. На основе анализа клиентского кода выявлены потенциальные уязвимости и методы получения преимущества в игре.

## Архитектура приложения

Игра построена на следующих технологиях:
- **Frontend**: Svelte/SvelteKit
- **HTTP Client**: Axios для API запросов
- **State Management**: Svelte stores
- **Games**: Custom implementations + PixiJS для сложных игр

## Выявленные уязвимости

### 1. Клиентская валидация энергии

**Файл**: `energy.store.js`
**Код**:
```javascript
const t=1e3,u=()=>({currentEnergy:t,maxEnergy:t}),n=c(u())
// Функции для управления энергией
l=e=>{n.update(r=>({...r,currentEnergy:e}))}, // Прямая установка энергии
i=e=>{s(n).currentEnergy+e>t||n.update(r=>({...r,currentEnergy:r.currentEnergy+e}))}, // Добавление энергии
v=e=>{n.update(r=>({...r,currentEnergy:r.currentEnergy-e}))}, // Трата энергии
```

**Уязвимость**: Энергия управляется только на клиентской стороне
**Эксплойт**: 
- Перехват и модификация функций управления энергией
- Установка максимального значения энергии
- Отключение трат энергии

### 2. Манипуляция баланса

**Файл**: `balance.store.js`
**Код**:
```javascript
const n=t({balance:0})
s=a=>{n.update(e=>({balance:e.balance+a}))}, // Увеличение баланса
l=a=>{n.update(e=>({balance:a}))}, // Установка баланса
o=a=>{n.update(e=>({balance:e.balance-a}))} // Уменьшение баланса
```

**Уязвимость**: Баланс полностью контролируется клиентом
**Эксплойт**:
- Прямая установка любого значения баланса
- Предотвращение трат валюты
- Бесконечная валюта

### 3. Клиентская логика кликера

**Файл**: `clicker.store.js`
**Код**:
```javascript
const n={isWheelWaiting:!1,isWheelShown:!1,pendingGameId:null,pendingSpinId:null,tapPower:50}
p=e=>{(!e||Number(e)<50||isNaN(Number(e)))&&(e=50),s.update(t=>({...t,tapPower:e}))} // Сила тапа
```

**Уязвимость**: Сила тапа контролируется клиентом
**Эксплойт**:
- Установка любого значения силы тапа
- Обход минимального значения 50
- Автоматизация кликов

### 4. Отсутствие серверной валидации мини-игр

**Файлы**: `chunk0.js` (содержит игры Slot Machine, Flappy Whale)

**Обнаруженные игры**:
- **Slot Machine**: Результат определяется клиентом
- **Flappy Whale**: Счет подсчитывается локально

**Уязвимости**:
- Результаты игр генерируются на клиенте
- Отсутствует серверная проверка результатов
- Возможность подмены результатов

## Методы эксплуатации

### 1. Консольные команды (Browser DevTools)

```javascript
// Установка бесконечной энергии
window.energyStore?.update(state => ({...state, currentEnergy: 999999, maxEnergy: 999999}));

// Установка баланса
window.balanceStore?.update(state => ({balance: 999999999}));

// Увеличение силы тапа
window.clickerStore?.update(state => ({...state, tapPower: 999999}));
```

### 2. Перехват API запросов

```javascript
// Перехват Axios запросов
const originalPost = axios.post;
axios.post = function(...args) {
    console.log('API Call:', args);
    // Модификация данных запроса
    if (args[0].includes('/spin') || args[0].includes('/game')) {
        args[1] = {...args[1], score: 999999, isWon: true};
    }
    return originalPost.apply(this, args);
};
```

### 3. Модификация игровых функций

```javascript
// Автокликер
setInterval(() => {
    document.querySelector('[data-click-handler]')?.click();
}, 100);

// Принудительные выигрыши в мини-играх
window.addEventListener('gameEnded', (event) => {
    event.detail.isWon = true;
    event.detail.score = 999999;
});
```

### 4. Локальное хранилище

```javascript
// Модификация localStorage/sessionStorage
localStorage.setItem('gameState', JSON.stringify({
    balance: 999999,
    energy: 999999,
    level: 999
}));
```

## Потенциальные точки атаки

### 1. WebSocket/API эндпоинты
- `/api/click` - обработка кликов
- `/api/spin` - результаты вращений
- `/api/game/*` - результаты мини-игр
- `/api/balance` - операции с балансом

### 2. Telegram Web App API
- `window.Telegram.WebApp` - интерфейс с Telegram
- Возможность подмены пользовательских данных

### 3. Состояние приложения
- Svelte stores доступны через `window`
- Отсутствие обфускации критичного кода

## Рекомендации по защите

### Для разработчиков:

1. **Серверная валидация**:
   - Все игровые действия должны валидироваться на сервере
   - Энергия, баланс, результаты игр - только серверные

2. **Обфускация кода**:
   - Минификация и обфускация критичного кода
   - Скрытие игровой логики

3. **Античит система**:
   - Детекция аномальных действий
   - Ограничения по времени и частоте действий
   - Проверка целостности клиента

4. **Шифрование данных**:
   - Шифрование критичных API запросов
   - Токены для проверки подлинности

### Для игроков (этичное использование):

**ВАЖНО**: Использование найденных уязвимостей может привести к:
- Бану аккаунта
- Нарушению правил игры
- Потере прогресса

Рекомендуется:
- Сообщать об уязвимостях разработчикам
- Не использовать эксплойты для получения преимущества
- Играть честно

## Заключение

Wheel of Whales имеет множество уязвимостей, связанных с чрезмерным доверием к клиентской стороне. Основные проблемы:

1. **Критичные данные** (энергия, баланс, результаты игр) контролируются клиентом
2. **Отсутствует серверная валидация** игровых действий
3. **Код не обфусцирован**, что упрощает анализ и взлом

Для обеспечения безопасности необходима полная переработка архитектуры с переносом критичной логики на сервер.

---

**Дисклеймер**: Данный анализ предназначен исключительно для образовательных целей и улучшения безопасности игры. Использование найденных уязвимостей для получения несправедливого преимущества неэтично и может повлечь за собой последствия.