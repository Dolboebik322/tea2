// Generated by Construct, the game and animation creation tool
// Visit: https://www.construct.net

var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__require=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),__commonJS=(e,t)=>function(){return t||(0,e[__getOwnPropNames(e)[0]])((t={exports:{}}).exports,t),t.exports},__copyProps=(t,s,n,i)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let e of __getOwnPropNames(s))__hasOwnProp.call(t,e)||e===n||__defProp(t,e,{get:()=>s[e],enumerable:!(i=__getOwnPropDesc(s,e))||i.enumerable});return t},__toESM=(e,t,s)=>(s=null!=e?__create(__getProtoOf(e)):{},__copyProps(!t&&e&&e.__esModule?s:__defProp(s,"default",{value:e,enumerable:!0}),e)),require_c3runtime=__commonJS({"file-map:scripts/c3runtime.js"(exports,module){{let setMatrixArrayType2=function(e){ARRAY_TYPE=e},toRadian2=function(e){return e*degree},equals$92=function(e,t){return Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$82=function(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone$82=function(e){var t=new ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy$82=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity$52=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues$82=function(e,t,s,n){var i=new ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=s,i[3]=n,i},set$82=function(e,t,s,n,i){return e[0]=t,e[1]=s,e[2]=n,e[3]=i,e},transpose$22=function(e,t){var s;return e===t?(s=t[1],e[1]=t[2],e[2]=s):(e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3]),e},invert$52=function(e,t){var s=t[0],n=t[1],i=t[2],r=s*(t=t[3])-i*n;return r?(e[0]=t*(r=1/r),e[1]=-n*r,e[2]=-i*r,e[3]=s*r,e):null},adjoint$22=function(e,t){var s=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=s,e},determinant$32=function(e){return e[0]*e[3]-e[2]*e[1]},multiply$82=function(e,t,s){var n=t[0],i=t[1],r=t[2],t=t[3],a=s[0],o=s[1],l=s[2],s=s[3];return e[0]=n*a+r*o,e[1]=i*a+t*o,e[2]=n*l+r*s,e[3]=i*l+t*s,e},rotate$42=function(e,t,s){var n=t[0],i=t[1],r=t[2],t=t[3],a=Math.sin(s),s=Math.cos(s);return e[0]=n*s+r*a,e[1]=i*s+t*a,e[2]=n*-a+r*s,e[3]=i*-a+t*s,e},scale$82=function(e,t,s){var n=t[0],i=t[1],r=t[2],t=t[3],a=s[0],s=s[1];return e[0]=n*a,e[1]=i*a,e[2]=r*s,e[3]=t*s,e},fromRotation$42=function(e,t){var s=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=s,e[2]=-s,e[3]=t,e},fromScaling$32=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str$82=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob$32=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU2=function(e,t,s,n){return e[2]=n[2]/n[0],s[0]=n[0],s[1]=n[1],s[3]=n[3]-e[2]*s[1],[e,t,s]},add$82=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e},subtract$62=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e},exactEquals$82=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals$82=function(e,t){var s=e[0],n=e[1],i=e[2],e=e[3],r=t[0],a=t[1],o=t[2],t=t[3];return Math.abs(s-r)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(n-a)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},multiplyScalar$32=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e},multiplyScalarAndAdd$32=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e[2]=t[2]+s[2]*n,e[3]=t[3]+s[3]*n,e},create$72=function(){var e=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone$72=function(e){var t=new ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy$72=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity$42=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues$72=function(e,t,s,n,i,r){var a=new ARRAY_TYPE(6);return a[0]=e,a[1]=t,a[2]=s,a[3]=n,a[4]=i,a[5]=r,a},set$72=function(e,t,s,n,i,r,a){return e[0]=t,e[1]=s,e[2]=n,e[3]=i,e[4]=r,e[5]=a,e},invert$42=function(e,t){var s=t[0],n=t[1],i=t[2],r=t[3],a=t[4],t=t[5],o=s*r-n*i;return o?(e[0]=r*(o=1/o),e[1]=-n*o,e[2]=-i*o,e[3]=s*o,e[4]=(i*t-r*a)*o,e[5]=(n*a-s*t)*o,e):null},determinant$22=function(e){return e[0]*e[3]-e[1]*e[2]},multiply$72=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],t=t[5],l=s[0],h=s[1],c=s[2],u=s[3],d=s[4],s=s[5];return e[0]=n*l+r*h,e[1]=i*l+a*h,e[2]=n*c+r*u,e[3]=i*c+a*u,e[4]=n*d+r*s+o,e[5]=i*d+a*s+t,e},rotate$32=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],t=t[5],l=Math.sin(s),s=Math.cos(s);return e[0]=n*s+r*l,e[1]=i*s+a*l,e[2]=n*-l+r*s,e[3]=i*-l+a*s,e[4]=o,e[5]=t,e},scale$72=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],t=t[5],l=s[0],s=s[1];return e[0]=n*l,e[1]=i*l,e[2]=r*s,e[3]=a*s,e[4]=o,e[5]=t,e},translate$32=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],t=t[5],l=s[0],s=s[1];return e[0]=n,e[1]=i,e[2]=r,e[3]=a,e[4]=n*l+r*s+o,e[5]=i*l+a*s+t,e},fromRotation$32=function(e,t){var s=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=s,e[2]=-s,e[3]=t,e[4]=0,e[5]=0,e},fromScaling$22=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation$32=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str$72=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob$22=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add$72=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e},subtract$52=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e},multiplyScalar$22=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e},multiplyScalarAndAdd$22=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e[2]=t[2]+s[2]*n,e[3]=t[3]+s[3]*n,e[4]=t[4]+s[4]*n,e[5]=t[5]+s[5]*n,e},exactEquals$72=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals$72=function(e,t){var s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],e=e[5],o=t[0],l=t[1],h=t[2],c=t[3],u=t[4],t=t[5];return Math.abs(s-o)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(n-l)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-h)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-c)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-u)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$62=function(){var e=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},fromMat4$12=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone$62=function(e){var t=new ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy$62=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues$62=function(e,t,s,n,i,r,a,o,l){var h=new ARRAY_TYPE(9);return h[0]=e,h[1]=t,h[2]=s,h[3]=n,h[4]=i,h[5]=r,h[6]=a,h[7]=o,h[8]=l,h},set$62=function(e,t,s,n,i,r,a,o,l,h){return e[0]=t,e[1]=s,e[2]=n,e[3]=i,e[4]=r,e[5]=a,e[6]=o,e[7]=l,e[8]=h,e},identity$32=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose$12=function(e,t){var s,n,i;return e===t?(s=t[1],n=t[2],i=t[5],e[1]=t[3],e[2]=t[6],e[3]=s,e[5]=t[7],e[6]=n,e[7]=i):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},invert$32=function(e,t){var s=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=(t=t[8])*a-o*h,u=-t*r+o*l,d=h*r-a*l,_=s*c+n*u+i*d;return _?(e[0]=c*(_=1/_),e[1]=(-t*n+i*h)*_,e[2]=(o*n-i*a)*_,e[3]=u*_,e[4]=(t*s-i*l)*_,e[5]=(-o*s+i*r)*_,e[6]=d*_,e[7]=(-h*s+n*l)*_,e[8]=(a*s-n*r)*_,e):null},adjoint$12=function(e,t){var s=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],t=t[8];return e[0]=a*t-o*h,e[1]=i*h-n*t,e[2]=n*o-i*a,e[3]=o*l-r*t,e[4]=s*t-i*l,e[5]=i*r-s*o,e[6]=r*h-a*l,e[7]=n*l-s*h,e[8]=s*a-n*r,e},determinant$12=function(e){var t=e[0],s=e[3],n=e[4],i=e[5],r=e[6],a=e[7],o=e[8];return t*(o*n-i*a)+e[1]*(-o*s+i*r)+e[2]*(a*s-n*r)},multiply$62=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],t=t[8],u=s[0],d=s[1],_=s[2],p=s[3],m=s[4],g=s[5],f=s[6],S=s[7],s=s[8];return e[0]=u*n+d*a+_*h,e[1]=u*i+d*o+_*c,e[2]=u*r+d*l+_*t,e[3]=p*n+m*a+g*h,e[4]=p*i+m*o+g*c,e[5]=p*r+m*l+g*t,e[6]=f*n+S*a+s*h,e[7]=f*i+S*o+s*c,e[8]=f*r+S*l+s*t,e},translate$22=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],t=t[8],u=s[0],s=s[1];return e[0]=n,e[1]=i,e[2]=r,e[3]=a,e[4]=o,e[5]=l,e[6]=u*n+s*a+h,e[7]=u*i+s*o+c,e[8]=u*r+s*l+t,e},rotate$22=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],t=t[8],u=Math.sin(s),s=Math.cos(s);return e[0]=s*n+u*a,e[1]=s*i+u*o,e[2]=s*r+u*l,e[3]=s*a-u*n,e[4]=s*o-u*i,e[5]=s*l-u*r,e[6]=h,e[7]=c,e[8]=t,e},scale$62=function(e,t,s){var n=s[0],s=s[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation$22=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation$22=function(e,t){var s=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=s,e[2]=0,e[3]=-s,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling$12=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat$12=function(e,t){var s=t[0],n=t[2],i=n+n,s=s*(h=s+s),r=(a=t[1])*h,a=a*(c=a+a),o=n*h,l=n*c,h=(t=t[3])*h,c=t*c,t=t*i;return e[0]=1-a-(n=n*i),e[3]=r-t,e[6]=o+c,e[1]=r+t,e[4]=1-s-n,e[7]=l-h,e[2]=o-c,e[5]=l+h,e[8]=1-s-a,e},normalFromMat42=function(e,t){var s=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],_=t[11],p=t[12],m=t[13],g=t[14],f=s*o-n*a,S=s*l-i*a,y=s*h-r*a,C=n*l-i*o,G=n*h-r*o,T=i*h-r*l,I=c*m-u*p,b=c*g-d*p,A=u*g-d*m;return(_=f*(d=d*(t=t[15])-_*g)-S*(u=u*t-_*m)+y*A+C*(c=c*t-_*p)-G*b+T*I)?(e[0]=(o*d-l*u+h*A)*(_=1/_),e[1]=(l*c-a*d-h*b)*_,e[2]=(a*u-o*c+h*I)*_,e[3]=(i*u-n*d-r*A)*_,e[4]=(s*d-i*c+r*b)*_,e[5]=(n*c-s*u-r*I)*_,e[6]=(m*T-g*G+t*C)*_,e[7]=(g*y-p*T-t*S)*_,e[8]=(p*G-m*y+t*f)*_,e):null},projection2=function(e,t,s){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/s,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str$62=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob$12=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add$62=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e},subtract$42=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e},multiplyScalar$12=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e},multiplyScalarAndAdd$12=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e[2]=t[2]+s[2]*n,e[3]=t[3]+s[3]*n,e[4]=t[4]+s[4]*n,e[5]=t[5]+s[5]*n,e[6]=t[6]+s[6]*n,e[7]=t[7]+s[7]*n,e[8]=t[8]+s[8]*n,e},exactEquals$62=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals$62=function(e,t){var s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],l=e[6],h=e[7],e=e[8],c=t[0],u=t[1],d=t[2],_=t[3],p=t[4],m=t[5],g=t[6],f=t[7],t=t[8];return Math.abs(s-c)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(n-u)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-_)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-p)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-g)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-f)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(f))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$52=function(){var e=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone$52=function(e){var t=new ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy$52=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues$52=function(e,t,s,n,i,r,a,o,l,h,c,u,d,_,p,m){var g=new ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=s,g[3]=n,g[4]=i,g[5]=r,g[6]=a,g[7]=o,g[8]=l,g[9]=h,g[10]=c,g[11]=u,g[12]=d,g[13]=_,g[14]=p,g[15]=m,g},set$52=function(e,t,s,n,i,r,a,o,l,h,c,u,d,_,p,m,g){return e[0]=t,e[1]=s,e[2]=n,e[3]=i,e[4]=r,e[5]=a,e[6]=o,e[7]=l,e[8]=h,e[9]=c,e[10]=u,e[11]=d,e[12]=_,e[13]=p,e[14]=m,e[15]=g,e},identity$22=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose2=function(e,t){var s,n,i,r,a,o;return e===t?(s=t[1],n=t[2],i=t[3],r=t[6],a=t[7],o=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=s,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=r,e[11]=t[14],e[12]=i,e[13]=a,e[14]=o):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]),e},invert$22=function(e,t){var s=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],_=t[11],p=t[12],m=t[13],g=t[14],f=s*o-n*a,S=s*l-i*a,y=s*h-r*a,C=n*l-i*o,G=n*h-r*o,T=i*h-r*l,I=c*m-u*p,b=c*g-d*p,A=c*(t=t[15])-_*p,P=u*g-d*m,E=u*t-_*m,v=d*t-_*g,R=f*v-S*E+y*P+C*A-G*b+T*I;return R?(e[0]=(o*v-l*E+h*P)*(R=1/R),e[1]=(i*E-n*v-r*P)*R,e[2]=(m*T-g*G+t*C)*R,e[3]=(d*G-u*T-_*C)*R,e[4]=(l*A-a*v-h*b)*R,e[5]=(s*v-i*A+r*b)*R,e[6]=(g*y-p*T-t*S)*R,e[7]=(c*T-d*y+_*S)*R,e[8]=(a*E-o*A+h*I)*R,e[9]=(n*A-s*E-r*I)*R,e[10]=(p*G-m*y+t*f)*R,e[11]=(u*y-c*G-_*f)*R,e[12]=(o*b-a*P-l*I)*R,e[13]=(s*P-n*b+i*I)*R,e[14]=(m*S-p*C-g*f)*R,e[15]=(c*C-u*S+d*f)*R,e):null},adjoint2=function(e,t){var s=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],_=t[11],p=t[12],m=t[13],g=t[14],f=s*o-n*a,S=s*l-i*a,y=s*h-r*a,C=n*l-i*o,G=n*h-r*o,T=i*h-r*l,I=c*m-u*p,b=c*g-d*p,A=c*(t=t[15])-_*p,P=u*g-d*m,E=u*t-_*m,v=d*t-_*g;return e[0]=o*v-l*E+h*P,e[1]=i*E-n*v-r*P,e[2]=m*T-g*G+t*C,e[3]=d*G-u*T-_*C,e[4]=l*A-a*v-h*b,e[5]=s*v-i*A+r*b,e[6]=g*y-p*T-t*S,e[7]=c*T-d*y+_*S,e[8]=a*E-o*A+h*I,e[9]=n*A-s*E-r*I,e[10]=p*G-m*y+t*f,e[11]=u*y-c*G-_*f,e[12]=o*b-a*P-l*I,e[13]=s*P-n*b+i*I,e[14]=m*S-p*C-g*f,e[15]=c*C-u*S+d*f,e},determinant2=function(e){var t=e[0],s=e[1],n=e[2],i=e[4],r=e[5],a=e[6],o=e[8],l=e[9],h=e[10],c=e[12],u=e[13],d=e[14],_=t*r-s*i,p=t*a-n*i,m=s*a-n*r,g=o*u-l*c,f=o*d-h*c,S=l*d-h*u;return e[7]*(t*S-s*f+n*g)-e[3]*(i*S-r*f+a*g)+e[15]*(o*m-l*p+h*_)-e[11]*(c*m-u*p+d*_)},multiply$52=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],_=t[10],p=t[11],m=t[12],g=t[13],f=t[14],t=t[15],S=s[0],y=s[1],C=s[2],G=s[3];return e[0]=S*n+y*o+C*u+G*m,e[1]=S*i+y*l+C*d+G*g,e[2]=S*r+y*h+C*_+G*f,e[3]=S*a+y*c+C*p+G*t,e[4]=(S=s[4])*n+(y=s[5])*o+(C=s[6])*u+(G=s[7])*m,e[5]=S*i+y*l+C*d+G*g,e[6]=S*r+y*h+C*_+G*f,e[7]=S*a+y*c+C*p+G*t,e[8]=(S=s[8])*n+(y=s[9])*o+(C=s[10])*u+(G=s[11])*m,e[9]=S*i+y*l+C*d+G*g,e[10]=S*r+y*h+C*_+G*f,e[11]=S*a+y*c+C*p+G*t,e[12]=(S=s[12])*n+(y=s[13])*o+(C=s[14])*u+(G=s[15])*m,e[13]=S*i+y*l+C*d+G*g,e[14]=S*r+y*h+C*_+G*f,e[15]=S*a+y*c+C*p+G*t,e},translate$12=function(e,t,s){var n,i,r,a,o,l,h,c,u,d,_,p,m=s[0],g=s[1],s=s[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*s+t[12],e[13]=t[1]*m+t[5]*g+t[9]*s+t[13],e[14]=t[2]*m+t[6]*g+t[10]*s+t[14],e[15]=t[3]*m+t[7]*g+t[11]*s+t[15]):(n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],_=t[10],p=t[11],e[0]=n,e[1]=i,e[2]=r,e[3]=a,e[4]=o,e[5]=l,e[6]=h,e[7]=c,e[8]=u,e[9]=d,e[10]=_,e[11]=p,e[12]=n*m+o*g+u*s+t[12],e[13]=i*m+l*g+d*s+t[13],e[14]=r*m+h*g+_*s+t[14],e[15]=a*m+c*g+p*s+t[15]),e},scale$52=function(e,t,s){var n=s[0],i=s[1],s=s[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate$12=function(e,t,s,n){var i,r,a,o,l,h,c,u,d,_,p,m,g,f,S,y,C,G,T,I,b=n[0],A=n[1],n=n[2],P=Math.hypot(b,A,n);return P<EPSILON?null:(b*=P=1/P,A*=P,n*=P,P=Math.sin(s),s=Math.cos(s),r=t[0],a=t[1],o=t[2],l=t[3],c=t[5],u=t[6],d=t[7],p=t[9],m=t[10],g=t[11],S=b*A*(i=1-s)-n*P,y=A*A*i+s,C=n*A*i+b*P,G=b*n*i+A*P,T=A*n*i-b*P,I=n*n*i+s,e[0]=r*(s=b*b*i+s)+(h=t[4])*(f=A*b*i+n*P)+(_=t[8])*(n=n*b*i-A*P),e[1]=a*s+c*f+p*n,e[2]=o*s+u*f+m*n,e[3]=l*s+d*f+g*n,e[4]=r*S+h*y+_*C,e[5]=a*S+c*y+p*C,e[6]=o*S+u*y+m*C,e[7]=l*S+d*y+g*C,e[8]=r*G+h*T+_*I,e[9]=a*G+c*T+p*I,e[10]=o*G+u*T+m*I,e[11]=l*G+d*T+g*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX$32=function(e,t,s){var n=Math.sin(s),s=Math.cos(s),i=t[4],r=t[5],a=t[6],o=t[7],l=t[8],h=t[9],c=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+l*n,e[5]=r*s+h*n,e[6]=a*s+c*n,e[7]=o*s+u*n,e[8]=l*s-i*n,e[9]=h*s-r*n,e[10]=c*s-a*n,e[11]=u*s-o*n,e},rotateY$32=function(e,t,s){var n=Math.sin(s),s=Math.cos(s),i=t[0],r=t[1],a=t[2],o=t[3],l=t[8],h=t[9],c=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-l*n,e[1]=r*s-h*n,e[2]=a*s-c*n,e[3]=o*s-u*n,e[8]=i*n+l*s,e[9]=r*n+h*s,e[10]=a*n+c*s,e[11]=o*n+u*s,e},rotateZ$32=function(e,t,s){var n=Math.sin(s),s=Math.cos(s),i=t[0],r=t[1],a=t[2],o=t[3],l=t[4],h=t[5],c=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+l*n,e[1]=r*s+h*n,e[2]=a*s+c*n,e[3]=o*s+u*n,e[4]=l*s-i*n,e[5]=h*s-r*n,e[6]=c*s-a*n,e[7]=u*s-o*n,e},fromTranslation$12=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling2=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation$12=function(e,t,s){var n,i=s[0],r=s[1],s=s[2],a=Math.hypot(i,r,s);return a<EPSILON?null:(i*=a=1/a,r*=a,s*=a,a=Math.sin(t),t=Math.cos(t),e[0]=i*i*(n=1-t)+t,e[1]=r*i*n+s*a,e[2]=s*i*n-r*a,e[3]=0,e[4]=i*r*n-s*a,e[5]=r*r*n+t,e[6]=s*r*n+i*a,e[7]=0,e[8]=i*s*n+r*a,e[9]=r*s*n-i*a,e[10]=s*s*n+t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation2=function(e,t){var s=Math.sin(t),t=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=s,e[7]=0,e[8]=0,e[9]=-s,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation2=function(e,t){var s=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=0,e[2]=-s,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=s,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation2=function(e,t){var s=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=s,e[2]=0,e[3]=0,e[4]=-s,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation$12=function(e,t,s){var n=t[0],i=t[2],r=i+i,a=n*(c=n+n),o=n*(u=(h=t[1])+h),n=n*r,l=h*u,h=h*r,c=(t=t[3])*c,u=t*u,t=t*r;return e[0]=1-(l+(i=i*r)),e[1]=o+t,e[2]=n-u,e[3]=0,e[4]=o-t,e[5]=1-(a+i),e[6]=h+c,e[7]=0,e[8]=n+u,e[9]=h-c,e[10]=1-(a+l),e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e},fromQuat22=function(e,t){var s=new ARRAY_TYPE(3),n=-t[0],i=-t[1],r=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=n*n+i*i+r*r+a*a;return 0<u?(s[0]=2*(o*a+c*n+l*r-h*i)/u,s[1]=2*(l*a+c*i+h*n-o*r)/u,s[2]=2*(h*a+c*r+o*i-l*n)/u):(s[0]=2*(o*a+c*n+l*r-h*i),s[1]=2*(l*a+c*i+h*n-o*r),s[2]=2*(h*a+c*r+o*i-l*n)),fromRotationTranslation$12(e,t,s),e},getTranslation$12=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling2=function(e,t){var s=t[0],n=t[4],i=t[5],r=t[6],a=t[8],o=t[9],l=t[10];return e[0]=Math.hypot(s,t[1],t[2]),e[1]=Math.hypot(n,i,r),e[2]=Math.hypot(a,o,l),e},getRotation2=function(e,t){var s=new ARRAY_TYPE(3),n=(getScaling2(s,t),1/s[0]),i=1/s[1],s=1/s[2],r=t[0]*n,a=t[1]*i,o=t[2]*s,l=t[4]*n,h=t[5]*i,c=t[6]*s,n=t[8]*n,i=t[9]*i,u=0;return 0<(s=r+h+(t=t[10]*s))?(u=2*Math.sqrt(1+s),e[3]=.25*u,e[0]=(c-i)/u,e[1]=(n-o)/u,e[2]=(a-l)/u):h<r&&t<r?(u=2*Math.sqrt(1+r-h-t),e[3]=(c-i)/u,e[0]=.25*u,e[1]=(a+l)/u,e[2]=(n+o)/u):t<h?(u=2*Math.sqrt(1+h-r-t),e[3]=(n-o)/u,e[0]=(a+l)/u,e[1]=.25*u,e[2]=(c+i)/u):(u=2*Math.sqrt(1+t-r-h),e[3]=(a-l)/u,e[0]=(n+o)/u,e[1]=(c+i)/u,e[2]=.25*u),e},decompose2=function(e,t,s,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];var t=n[0],i=n[1],r=n[2],a=n[4],o=n[5],l=n[6],h=n[8],c=n[9],n=n[10],u=(s[0]=Math.hypot(t,i,r),s[1]=Math.hypot(a,o,l),s[2]=Math.hypot(h,c,n),1/s[0]),d=1/s[1],t=t*u,i=i*d,r=r*(s=1/s[2]),a=a*u,l=l*s,h=h*u,u=c*d,c=n*s,n=0;return 0<(d=t+(o=o*d)+c)?(n=2*Math.sqrt(1+d),e[3]=.25*n,e[0]=(l-u)/n,e[1]=(h-r)/n,e[2]=(i-a)/n):o<t&&c<t?(n=2*Math.sqrt(1+t-o-c),e[3]=(l-u)/n,e[0]=.25*n,e[1]=(i+a)/n,e[2]=(h+r)/n):c<o?(n=2*Math.sqrt(1+o-t-c),e[3]=(h-r)/n,e[0]=(i+a)/n,e[1]=.25*n,e[2]=(l+u)/n):(n=2*Math.sqrt(1+c-t-o),e[3]=(i-a)/n,e[0]=(h+r)/n,e[1]=(l+u)/n,e[2]=.25*n),e},fromRotationTranslationScale2=function(e,t,s,n){var i=(a=t[0])*(c=a+a),r=a*(u=(l=t[1])+l),a=a*(d=(h=t[2])+h),o=l*u,l=l*d,h=h*d,c=(t=t[3])*c,u=t*u,t=t*d,d=n[0],_=n[1],n=n[2];return e[0]=(1-(o+h))*d,e[1]=(r+t)*d,e[2]=(a-u)*d,e[3]=0,e[4]=(r-t)*_,e[5]=(1-(i+h))*_,e[6]=(l+c)*_,e[7]=0,e[8]=(a+u)*n,e[9]=(l-c)*n,e[10]=(1-(i+o))*n,e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e},fromRotationTranslationScaleOrigin2=function(e,t,s,n,i){var r=(o=t[0])*(u=o+o),a=o*(d=(h=t[1])+h),o=o*(_=(c=t[2])+c),l=h*d,h=h*_,c=c*_,u=(t=t[3])*u,d=t*d,t=t*_,_=n[0],p=n[1],n=n[2],m=i[0],g=i[1],i=i[2],f=(1-(l+c))*_,S=(a+t)*_,_=(o-d)*_,a=(a-t)*p,t=(1-(r+c))*p,c=(h+u)*p,p=(o+d)*n,o=(h-u)*n,d=(1-(r+l))*n;return e[0]=f,e[1]=S,e[2]=_,e[3]=0,e[4]=a,e[5]=t,e[6]=c,e[7]=0,e[8]=p,e[9]=o,e[10]=d,e[11]=0,e[12]=s[0]+m-(f*m+a*g+p*i),e[13]=s[1]+g-(S*m+t*g+o*i),e[14]=s[2]+i-(_*m+c*g+d*i),e[15]=1,e},fromQuat3=function(e,t){var s=t[0],n=t[2],i=n+n,s=s*(h=s+s),r=(a=t[1])*h,a=a*(c=a+a),o=n*h,l=n*c,h=(t=t[3])*h,c=t*c,t=t*i;return e[0]=1-a-(n=n*i),e[1]=r+t,e[2]=o-c,e[3]=0,e[4]=r-t,e[5]=1-s-n,e[6]=l+h,e[7]=0,e[8]=o+c,e[9]=l-h,e[10]=1-s-a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum2=function(e,t,s,n,i,r,a){var o=1/(s-t),l=1/(i-n),h=1/(r-a);return e[0]=2*r*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*r*l,e[6]=0,e[7]=0,e[8]=(s+t)*o,e[9]=(i+n)*l,e[10]=(a+r)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*r*2*h,e[15]=0,e},perspectiveNO2=function(e,t,s,n,i){return t=1/Math.tan(t/2),e[0]=t/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(s=1/(n-i)),e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e},perspectiveZO2=function(e,t,s,n,i){return t=1/Math.tan(t/2),e[0]=t/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=i*(s=1/(n-i)),e[14]=i*n*s):(e[10]=-1,e[14]=-n),e},perspectiveFromFieldOfView2=function(e,t,s,n){var i=Math.tan(t.upDegrees*Math.PI/180),r=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=2/(a+(t=Math.tan(t.rightDegrees*Math.PI/180))),l=2/(i+r);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-t)*o*.5,e[9]=(i-r)*l*.5,e[10]=n/(s-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*s/(s-n),e[15]=0,e},orthoNO2=function(e,t,s,n,i,r,a){var o=1/(t-s),l=1/(n-i),h=1/(r-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+s)*o,e[13]=(i+n)*l,e[14]=(a+r)*h,e[15]=1,e},orthoZO2=function(e,t,s,n,i,r,a){var o=1/(t-s),l=1/(n-i),a=1/(r-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a,e[11]=0,e[12]=(t+s)*o,e[13]=(i+n)*l,e[14]=r*a,e[15]=1,e},lookAt2=function(e,t,s,n){var i,r,a,o,l=t[0],h=t[1],t=t[2],c=n[0],u=n[1],n=n[2],d=s[0],_=s[1],s=s[2];return Math.abs(l-d)<EPSILON&&Math.abs(h-_)<EPSILON&&Math.abs(t-s)<EPSILON?identity$22(e):(d=l-d,_=h-_,s=t-s,i=u*(s*=o=1/Math.hypot(d,_,s))-n*(_*=o),n=n*(d*=o)-c*s,c=c*_-u*d,(o=Math.hypot(i,n,c))?(i*=o=1/o,n*=o,c*=o):c=n=i=0,u=_*c-s*n,r=s*i-d*c,a=d*n-_*i,(o=Math.hypot(u,r,a))?(u*=o=1/o,r*=o,a*=o):a=r=u=0,e[0]=i,e[1]=u,e[2]=d,e[3]=0,e[4]=n,e[5]=r,e[6]=_,e[7]=0,e[8]=c,e[9]=a,e[10]=s,e[11]=0,e[12]=-(i*l+n*h+c*t),e[13]=-(u*l+r*h+a*t),e[14]=-(d*l+_*h+s*t),e[15]=1,e)},targetTo2=function(e,t,s,n){var i=t[0],r=t[1],t=t[2],a=n[0],o=n[1],n=n[2],l=i-s[0],h=r-s[1],c=l*l+h*h+(s=t-s[2])*s,u=(0<c&&(l*=c=1/Math.sqrt(c),h*=c,s*=c),o*s-n*h);return 0<(c=u*u+(n=n*l-a*s)*n+(a=a*h-o*l)*a)&&(u*=c=1/Math.sqrt(c),n*=c,a*=c),e[0]=u,e[1]=n,e[2]=a,e[3]=0,e[4]=h*a-s*n,e[5]=s*u-l*a,e[6]=l*n-h*u,e[7]=0,e[8]=l,e[9]=h,e[10]=s,e[11]=0,e[12]=i,e[13]=r,e[14]=t,e[15]=1,e},str$52=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob2=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add$52=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e[9]=t[9]+s[9],e[10]=t[10]+s[10],e[11]=t[11]+s[11],e[12]=t[12]+s[12],e[13]=t[13]+s[13],e[14]=t[14]+s[14],e[15]=t[15]+s[15],e},subtract$32=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e[9]=t[9]-s[9],e[10]=t[10]-s[10],e[11]=t[11]-s[11],e[12]=t[12]-s[12],e[13]=t[13]-s[13],e[14]=t[14]-s[14],e[15]=t[15]-s[15],e},multiplyScalar2=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12]*s,e[13]=t[13]*s,e[14]=t[14]*s,e[15]=t[15]*s,e},multiplyScalarAndAdd2=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e[2]=t[2]+s[2]*n,e[3]=t[3]+s[3]*n,e[4]=t[4]+s[4]*n,e[5]=t[5]+s[5]*n,e[6]=t[6]+s[6]*n,e[7]=t[7]+s[7]*n,e[8]=t[8]+s[8]*n,e[9]=t[9]+s[9]*n,e[10]=t[10]+s[10]*n,e[11]=t[11]+s[11]*n,e[12]=t[12]+s[12]*n,e[13]=t[13]+s[13]*n,e[14]=t[14]+s[14]*n,e[15]=t[15]+s[15]*n,e},exactEquals$52=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals$52=function(e,t){var s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],d=e[10],_=e[11],p=e[12],m=e[13],g=e[14],e=e[15],f=t[0],S=t[1],y=t[2],C=t[3],G=t[4],T=t[5],I=t[6],b=t[7],A=t[8],P=t[9],E=t[10],v=t[11],R=t[12],x=t[13],w=t[14],t=t[15];return Math.abs(s-f)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-S)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(i-y)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-C)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(a-G)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(G))&&Math.abs(o-T)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-I)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-b)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(c-A)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-P)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(d-E)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(_-v)<=EPSILON*Math.max(1,Math.abs(_),Math.abs(v))&&Math.abs(p-R)<=EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-x)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(g-w)<=EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$42=function(){var e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e},clone$42=function(e){var t=new ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length$42=function(e){var t=e[0];return Math.hypot(t,e[1],e[2])},fromValues$42=function(e,t,s){var n=new ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=s,n},copy$42=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set$42=function(e,t,s,n){return e[0]=t,e[1]=s,e[2]=n,e},add$42=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e},subtract$22=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e},multiply$42=function(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e},divide$22=function(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e},ceil$22=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor$22=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min$22=function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e},max$22=function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e},round$22=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale$42=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},scaleAndAdd$22=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e[2]=t[2]+s[2]*n,e},distance$22=function(e,t){var s=t[0]-e[0];return Math.hypot(s,t[1]-e[1],t[2]-e[2])},squaredDistance$22=function(e,t){var s=t[0]-e[0],n=t[1]-e[1];return s*s+n*n+(t=t[2]-e[2])*t},squaredLength$42=function(e){var t=e[0],s=e[1];return t*t+s*s+(e=e[2])*e},negate$22=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse$22=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize$42=function(e,t){var s=t[0],n=t[1],i=t[2];return 0<(s=s*s+n*n+i*i)&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},dot$42=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross$22=function(e,t,s){var n=t[0],i=t[1],t=t[2],r=s[0],a=s[1],s=s[2];return e[0]=i*s-t*a,e[1]=t*r-n*s,e[2]=n*a-i*r,e},lerp$42=function(e,t,s,n){var i=t[0],r=t[1],t=t[2];return e[0]=i+n*(s[0]-i),e[1]=r+n*(s[1]-r),e[2]=t+n*(s[2]-t),e},slerp$12=function(e,t,s,n){var i=Math.acos(Math.min(Math.max(dot$42(t,s),-1),1)),r=Math.sin(i),a=Math.sin((1-n)*i)/r,n=Math.sin(n*i)/r;return e[0]=a*t[0]+n*s[0],e[1]=a*t[1]+n*s[1],e[2]=a*t[2]+n*s[2],e},hermite2=function(e,t,s,n,i,r){var a=r*r,o=a*(2*r-3)+1,l=a*(r-2)+r,h=a*(r-1);return e[0]=t[0]*o+s[0]*l+n[0]*h+i[0]*(a=a*(3-2*r)),e[1]=t[1]*o+s[1]*l+n[1]*h+i[1]*a,e[2]=t[2]*o+s[2]*l+n[2]*h+i[2]*a,e},bezier2=function(e,t,s,n,i,r){var a=1-r,o=a*a,l=r*r,h=o*a;return e[0]=t[0]*h+s[0]*(o=3*r*o)+n[0]*(a=3*l*a)+i[0]*(l=l*r),e[1]=t[1]*h+s[1]*o+n[1]*a+i[1]*l,e[2]=t[2]*h+s[2]*o+n[2]*a+i[2]*l,e},random$32=function(e,t){t=t||1;var s=2*RANDOM()*Math.PI,n=2*RANDOM()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(s)*i,e[1]=Math.sin(s)*i,e[2]=n*t,e},transformMat4$22=function(e,t,s){var n=t[0],i=t[1],t=t[2],r=s[3]*n+s[7]*i+s[11]*t+s[15];return e[0]=(s[0]*n+s[4]*i+s[8]*t+s[12])/(r=r||1),e[1]=(s[1]*n+s[5]*i+s[9]*t+s[13])/r,e[2]=(s[2]*n+s[6]*i+s[10]*t+s[14])/r,e},transformMat3$12=function(e,t,s){var n=t[0],i=t[1],t=t[2];return e[0]=n*s[0]+i*s[3]+t*s[6],e[1]=n*s[1]+i*s[4]+t*s[7],e[2]=n*s[2]+i*s[5]+t*s[8],e},transformQuat$12=function(e,t,s){var n=s[0],i=s[1],r=t[0],a=t[1],o=i*(t=t[2])-(u=s[2])*a,l=u*r-n*t,h=n*a-i*r,c=i*h-u*l,u=u*o-n*h,n=n*l-i*o;return l*=i=2*s[3],h*=i,u*=2,n*=2,e[0]=r+(o*=i)+(c*=2),e[1]=a+l+u,e[2]=t+h+n,e},rotateX$22=function(e,t,s,n){var i=[],r=[];return i[0]=t[0]-s[0],i[1]=t[1]-s[1],i[2]=t[2]-s[2],r[0]=i[0],r[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),r[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=r[0]+s[0],e[1]=r[1]+s[1],e[2]=r[2]+s[2],e},rotateY$22=function(e,t,s,n){var i=[],r=[];return i[0]=t[0]-s[0],i[1]=t[1]-s[1],i[2]=t[2]-s[2],r[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),r[1]=i[1],r[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=r[0]+s[0],e[1]=r[1]+s[1],e[2]=r[2]+s[2],e},rotateZ$22=function(e,t,s,n){var i=[],r=[];return i[0]=t[0]-s[0],i[1]=t[1]-s[1],i[2]=t[2]-s[2],r[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),r[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),r[2]=i[2],e[0]=r[0]+s[0],e[1]=r[1]+s[1],e[2]=r[2]+s[2],e},angle$12=function(e,t){var s=e[0],n=e[1],i=e[2],r=t[0],a=t[1],o=t[2],n=(s=Math.sqrt((s*s+n*n+i*i)*(r*r+a*a+o*o)))&&dot$42(e,t)/s;return Math.acos(Math.min(Math.max(n,-1),1))},zero$22=function(e){return e[0]=0,e[1]=0,e[2]=0,e},str$42=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals$42=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals$42=function(e,t){var s=e[0],n=e[1],e=e[2],i=t[0],r=t[1],t=t[2];return Math.abs(s-i)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(n-r)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$32=function(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e},clone$32=function(e){var t=new ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues$32=function(e,t,s,n){var i=new ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=s,i[3]=n,i},copy$32=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set$32=function(e,t,s,n,i){return e[0]=t,e[1]=s,e[2]=n,e[3]=i,e},add$32=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e},subtract$12=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e},multiply$32=function(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e[3]=t[3]*s[3],e},divide$12=function(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e[3]=t[3]/s[3],e},ceil$12=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor$12=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min$12=function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e[3]=Math.min(t[3],s[3]),e},max$12=function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e[3]=Math.max(t[3],s[3]),e},round$12=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale$32=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e},scaleAndAdd$12=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e[2]=t[2]+s[2]*n,e[3]=t[3]+s[3]*n,e},distance$12=function(e,t){var s=t[0]-e[0];return Math.hypot(s,t[1]-e[1],t[2]-e[2],t[3]-e[3])},squaredDistance$12=function(e,t){var s=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return s*s+n*n+i*i+(t=t[3]-e[3])*t},length$32=function(e){var t=e[0];return Math.hypot(t,e[1],e[2],e[3])},squaredLength$32=function(e){var t=e[0],s=e[1],n=e[2];return t*t+s*s+n*n+(e=e[3])*e},negate$12=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse$12=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize$32=function(e,t){var s=t[0],n=t[1],i=t[2],r=s*s+n*n+i*i+(t=t[3])*t;return 0<r&&(r=1/Math.sqrt(r)),e[0]=s*r,e[1]=n*r,e[2]=i*r,e[3]=t*r,e},dot$32=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross$12=function(e,t,s,n){var i=s[0]*n[1]-s[1]*n[0],r=s[0]*n[2]-s[2]*n[0],a=s[0]*n[3]-s[3]*n[0],o=s[1]*n[2]-s[2]*n[1],l=s[1]*n[3]-s[3]*n[1],s=s[2]*n[3]-s[3]*n[2],n=t[0],h=t[1],c=t[2],t=t[3];return e[0]=h*s-c*l+t*o,e[1]=-n*s+c*a-t*r,e[2]=n*l-h*a+t*i,e[3]=-n*o+h*r-c*i,e},lerp$32=function(e,t,s,n){var i=t[0],r=t[1],a=t[2],t=t[3];return e[0]=i+n*(s[0]-i),e[1]=r+n*(s[1]-r),e[2]=a+n*(s[2]-a),e[3]=t+n*(s[3]-t),e},random$22=function(e,t){var s,n,i,r,a,o;for(t=t||1;1<=(a=(s=2*RANDOM()-1)*s+(n=2*RANDOM()-1)*n););for(;1<=(o=(i=2*RANDOM()-1)*i+(r=2*RANDOM()-1)*r););var l=Math.sqrt((1-a)/o);return e[0]=t*s,e[1]=t*n,e[2]=t*i*l,e[3]=t*r*l,e},transformMat4$12=function(e,t,s){var n=t[0],i=t[1],r=t[2],t=t[3];return e[0]=s[0]*n+s[4]*i+s[8]*r+s[12]*t,e[1]=s[1]*n+s[5]*i+s[9]*r+s[13]*t,e[2]=s[2]*n+s[6]*i+s[10]*r+s[14]*t,e[3]=s[3]*n+s[7]*i+s[11]*r+s[15]*t,e},transformQuat2=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=s[0],o=s[1],l=s[2],h=(s=s[3])*n+o*r-l*i,c=s*i+l*n-a*r,u=s*r+a*i-o*n;return e[0]=h*s+(n=-a*n-o*i-l*r)*-a+c*-l-u*-o,e[1]=c*s+n*-o+u*-a-h*-l,e[2]=u*s+n*-l+h*-o-c*-a,e[3]=t[3],e},zero$12=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str$32=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals$32=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals$32=function(e,t){var s=e[0],n=e[1],i=e[2],e=e[3],r=t[0],a=t[1],o=t[2],t=t[3];return Math.abs(s-r)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(n-a)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create$22=function(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e},identity$12=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle2=function(e,t,s){s*=.5;var n=Math.sin(s);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(s),e},getAxisAngle2=function(e,t){var s=2*Math.acos(t[3]),n=Math.sin(s/2);return EPSILON<n?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),s},getAngle2=function(e,t){return e=dot$2(e,t),Math.acos(2*e*e-1)},multiply$22=function(e,t,s){var n=t[0],i=t[1],r=t[2],t=t[3],a=s[0],o=s[1],l=s[2],s=s[3];return e[0]=n*s+t*a+i*l-r*o,e[1]=i*s+t*o+r*a-n*l,e[2]=r*s+t*l+n*o-i*a,e[3]=t*s-n*a-i*o-r*l,e},rotateX$12=function(e,t,s){s*=.5;var n=t[0],i=t[1],r=t[2],t=t[3],a=Math.sin(s),s=Math.cos(s);return e[0]=n*s+t*a,e[1]=i*s+r*a,e[2]=r*s-i*a,e[3]=t*s-n*a,e},rotateY$12=function(e,t,s){s*=.5;var n=t[0],i=t[1],r=t[2],t=t[3],a=Math.sin(s),s=Math.cos(s);return e[0]=n*s-r*a,e[1]=i*s+t*a,e[2]=r*s+n*a,e[3]=t*s-i*a,e},rotateZ$12=function(e,t,s){s*=.5;var n=t[0],i=t[1],r=t[2],t=t[3],a=Math.sin(s),s=Math.cos(s);return e[0]=n*s+i*a,e[1]=i*s-n*a,e[2]=r*s+t*a,e[3]=t*s-r*a,e},calculateW2=function(e,t){var s=t[0],n=t[1],t=t[2];return e[0]=s,e[1]=n,e[2]=t,e[3]=Math.sqrt(Math.abs(1-s*s-n*n-t*t)),e},exp2=function(e,t){var s=t[0],n=t[1],i=t[2],t=t[3],r=Math.sqrt(s*s+n*n+i*i),t=Math.exp(t),a=0<r?t*Math.sin(r)/r:0;return e[0]=s*a,e[1]=n*a,e[2]=i*a,e[3]=t*Math.cos(r),e},ln2=function(e,t){var s=t[0],n=t[1],i=t[2],t=t[3],r=0<(r=Math.sqrt(s*s+n*n+i*i))?Math.atan2(r,t)/r:0;return e[0]=s*r,e[1]=n*r,e[2]=i*r,e[3]=.5*Math.log(s*s+n*n+i*i+t*t),e},pow2=function(e,t,s){return ln2(e,t),scale$2(e,e,s),exp2(e,e),e},slerp2=function(e,t,s,n){var i,r,a=t[0],o=t[1],l=t[2],t=t[3],h=s[0],c=s[1],u=s[2],d=a*h+o*c+l*u+t*(s=s[3]);return d<0&&(d=-d,h=-h,c=-c,u=-u,s=-s),d=EPSILON<1-d?(d=Math.acos(d),i=Math.sin(d),r=Math.sin((1-n)*d)/i,Math.sin(n*d)/i):(r=1-n,n),e[0]=r*a+d*h,e[1]=r*o+d*c,e[2]=r*l+d*u,e[3]=r*t+d*s,e},random$12=function(e){var t=RANDOM(),s=RANDOM(),n=RANDOM(),i=Math.sqrt(1-t),t=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*s),e[1]=i*Math.cos(2*Math.PI*s),e[2]=t*Math.sin(2*Math.PI*n),e[3]=t*Math.cos(2*Math.PI*n),e},invert$12=function(e,t){var s=t[0],n=t[1],i=t[2],r=s*s+n*n+i*i+(t=t[3])*t;return e[0]=-s*(r=r?1/r:0),e[1]=-n*r,e[2]=-i*r,e[3]=t*r,e},conjugate$12=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat32=function(e,t){var s,n,i,r=t[0]+t[4]+t[8];return 0<r?(i=Math.sqrt(r+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i):(s=(1+(r=t[3*(r=t[4]>t[0]?1:0)+r]<t[8]?2:r))%3,n=(2+r)%3,i=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1),e[r]=.5*i,e[3]=(t[3*s+n]-t[3*n+s])*(i=.5/i),e[s]=(t[3*s+r]+t[3*r+s])*i,e[n]=(t[3*n+r]+t[3*r+n])*i),e},fromEuler2=function(e,t,s,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ANGLE_ORDER,r=Math.PI/360,a=(n*=r,s*=r,Math.sin(t*=r)),o=Math.cos(t),l=Math.sin(s),h=Math.cos(s),c=Math.sin(n),u=Math.cos(n);switch(i){case"xyz":e[0]=a*h*u+o*l*c,e[1]=o*l*u-a*h*c,e[2]=o*h*c+a*l*u,e[3]=o*h*u-a*l*c;break;case"xzy":e[0]=a*h*u-o*l*c,e[1]=o*l*u-a*h*c,e[2]=o*h*c+a*l*u,e[3]=o*h*u+a*l*c;break;case"yxz":e[0]=a*h*u+o*l*c,e[1]=o*l*u-a*h*c,e[2]=o*h*c-a*l*u,e[3]=o*h*u+a*l*c;break;case"yzx":e[0]=a*h*u+o*l*c,e[1]=o*l*u+a*h*c,e[2]=o*h*c-a*l*u,e[3]=o*h*u-a*l*c;break;case"zxy":e[0]=a*h*u-o*l*c,e[1]=o*l*u+a*h*c,e[2]=o*h*c+a*l*u,e[3]=o*h*u-a*l*c;break;case"zyx":e[0]=a*h*u-o*l*c,e[1]=o*l*u+a*h*c,e[2]=o*h*c-a*l*u,e[3]=o*h*u+a*l*c;break;default:throw new Error("Unknown angle order "+i)}return e},str$22=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},equals$22=function(e,t){return Math.abs(dot$32(e,t))>=1-EPSILON},create$12=function(){var e=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone$12=function(e){var t=new ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues$12=function(e,t,s,n,i,r,a,o){var l=new ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=s,l[3]=n,l[4]=i,l[5]=r,l[6]=a,l[7]=o,l},fromRotationTranslationValues2=function(e,t,s,n,i,r,a){var o=new ARRAY_TYPE(8),i=(o[0]=e,o[1]=t,o[2]=s,o[3]=n,.5*i),r=.5*r,a=.5*a;return o[4]=i*n+r*s-a*t,o[5]=r*n+a*e-i*s,o[6]=a*n+i*t-r*e,o[7]=-i*e-r*t-a*s,o},fromRotationTranslation2=function(e,t,s){var n=.5*s[0],i=.5*s[1],s=.5*s[2],r=t[0],a=t[1],o=t[2],t=t[3];return e[0]=r,e[1]=a,e[2]=o,e[3]=t,e[4]=n*t+i*o-s*a,e[5]=i*t+s*r-n*o,e[6]=s*t+n*a-i*r,e[7]=-n*r-i*a-s*o,e},fromTranslation2=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat42=function(e,t){var s=create$22(),n=(getRotation2(s,t),new ARRAY_TYPE(3));return getTranslation$12(n,t),fromRotationTranslation2(e,s,n),e},copy$12=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},identity2=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set$12=function(e,t,s,n,i,r,a,o,l){return e[0]=t,e[1]=s,e[2]=n,e[3]=i,e[4]=r,e[5]=a,e[6]=o,e[7]=l,e},getDual2=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setDual2=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation2=function(e,t){var s=t[4],n=t[5],i=t[6],r=t[7],a=-t[0],o=-t[1],l=-t[2],t=t[3];return e[0]=2*(s*t+r*a+n*l-i*o),e[1]=2*(n*t+r*o+i*a-s*l),e[2]=2*(i*t+r*l+s*o-n*a),e},translate2=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=.5*s[0],l=.5*s[1],s=.5*s[2],h=t[4],c=t[5],u=t[6],t=t[7];return e[0]=n,e[1]=i,e[2]=r,e[3]=a,e[4]=a*o+i*s-r*l+h,e[5]=a*l+r*o-n*s+c,e[6]=a*s+n*l-i*o+u,e[7]=-n*o-i*l-r*s+t,e},rotateX2=function(e,t,s){var n=-t[0],i=-t[1],r=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=o*a+(_=t[7])*n+l*r-h*i,u=l*a+_*i+h*n-o*r,d=h*a+_*r+o*i-l*n,_=_*a-o*n-l*i-h*r;return rotateX$12(e,t,s),n=e[0],e[4]=c*(a=e[3])+_*n+u*(r=e[2])-d*(i=e[1]),e[5]=u*a+_*i+d*n-c*r,e[6]=d*a+_*r+c*i-u*n,e[7]=_*a-c*n-u*i-d*r,e},rotateY2=function(e,t,s){var n=-t[0],i=-t[1],r=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=o*a+(_=t[7])*n+l*r-h*i,u=l*a+_*i+h*n-o*r,d=h*a+_*r+o*i-l*n,_=_*a-o*n-l*i-h*r;return rotateY$12(e,t,s),n=e[0],e[4]=c*(a=e[3])+_*n+u*(r=e[2])-d*(i=e[1]),e[5]=u*a+_*i+d*n-c*r,e[6]=d*a+_*r+c*i-u*n,e[7]=_*a-c*n-u*i-d*r,e},rotateZ2=function(e,t,s){var n=-t[0],i=-t[1],r=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=o*a+(_=t[7])*n+l*r-h*i,u=l*a+_*i+h*n-o*r,d=h*a+_*r+o*i-l*n,_=_*a-o*n-l*i-h*r;return rotateZ$12(e,t,s),n=e[0],e[4]=c*(a=e[3])+_*n+u*(r=e[2])-d*(i=e[1]),e[5]=u*a+_*i+d*n-c*r,e[6]=d*a+_*r+c*i-u*n,e[7]=_*a-c*n-u*i-d*r,e},rotateByQuatAppend2=function(e,t,s){var n=s[0],i=s[1],r=s[2],s=s[3],a=t[0],o=t[1],l=t[2],h=t[3];return e[0]=a*s+h*n+o*r-l*i,e[1]=o*s+h*i+l*n-a*r,e[2]=l*s+h*r+a*i-o*n,e[3]=h*s-a*n-o*i-l*r,e[4]=(a=t[4])*s+(h=t[7])*n+(o=t[5])*r-(l=t[6])*i,e[5]=o*s+h*i+l*n-a*r,e[6]=l*s+h*r+a*i-o*n,e[7]=h*s-a*n-o*i-l*r,e},rotateByQuatPrepend2=function(e,t,s){var n=t[0],i=t[1],r=t[2],t=t[3],a=s[0],o=s[1],l=s[2],h=s[3];return e[0]=n*h+t*a+i*l-r*o,e[1]=i*h+t*o+r*a-n*l,e[2]=r*h+t*l+n*o-i*a,e[3]=t*h-n*a-i*o-r*l,e[4]=n*(h=s[7])+t*(a=s[4])+i*(l=s[6])-r*(o=s[5]),e[5]=i*h+t*o+r*a-n*l,e[6]=r*h+t*l+n*o-i*a,e[7]=t*h-n*a-i*o-r*l,e},rotateAroundAxis2=function(e,t,s,n){var i,r,a,o,l,h;return Math.abs(n)<EPSILON?copy$12(e,t):(h=Math.hypot(s[0],s[1],s[2]),n*=.5,i=(a=Math.sin(n))*s[0]/h,r=a*s[1]/h,a=a*s[2]/h,s=Math.cos(n),h=t[0],e[0]=h*s+(n=t[3])*i+(o=t[1])*a-(l=t[2])*r,e[1]=o*s+n*r+l*i-h*a,e[2]=l*s+n*a+h*r-o*i,e[3]=n*s-h*i-o*r-l*a,e[4]=(n=t[4])*s+(h=t[7])*i+(o=t[5])*a-(l=t[6])*r,e[5]=o*s+h*r+l*i-n*a,e[6]=l*s+h*a+n*r-o*i,e[7]=h*s-n*i-o*r-l*a,e)},add$12=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e},multiply$12=function(e,t,s){var n=t[0],i=t[1],r=t[2],a=t[3],o=s[4],l=s[5],h=s[6],c=s[7],u=t[4],d=t[5],_=t[6],t=t[7],p=s[0],m=s[1],g=s[2],s=s[3];return e[0]=n*s+a*p+i*g-r*m,e[1]=i*s+a*m+r*p-n*g,e[2]=r*s+a*g+n*m-i*p,e[3]=a*s-n*p-i*m-r*g,e[4]=n*c+a*o+i*h-r*l+u*s+t*p+d*g-_*m,e[5]=i*c+a*l+r*o-n*h+d*s+t*m+_*p-u*g,e[6]=r*c+a*h+n*l-i*o+_*s+t*g+u*m-d*p,e[7]=a*c-n*o-i*l-r*h+t*s-u*p-d*m-_*g,e},scale$12=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e},lerp$12=function(e,t,s,n){var i=1-n;return dot$1(t,s)<0&&(n=-n),e[0]=t[0]*i+s[0]*n,e[1]=t[1]*i+s[1]*n,e[2]=t[2]*i+s[2]*n,e[3]=t[3]*i+s[3]*n,e[4]=t[4]*i+s[4]*n,e[5]=t[5]*i+s[5]*n,e[6]=t[6]*i+s[6]*n,e[7]=t[7]*i+s[7]*n,e},invert2=function(e,t){var s=squaredLength$1(t);return e[0]=-t[0]/s,e[1]=-t[1]/s,e[2]=-t[2]/s,e[3]=t[3]/s,e[4]=-t[4]/s,e[5]=-t[5]/s,e[6]=-t[6]/s,e[7]=t[7]/s,e},conjugate2=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},normalize$12=function(e,t){var s,n,i,r,a,o,l,h,c=squaredLength$1(t);return 0<c&&(c=Math.sqrt(c),h=(s=t[0]/c)*(a=t[4])+(n=t[1]/c)*(o=t[5])+(i=t[2]/c)*(l=t[6])+(r=t[3]/c)*(t=t[7]),e[0]=s,e[1]=n,e[2]=i,e[3]=r,e[4]=(a-s*h)/c,e[5]=(o-n*h)/c,e[6]=(l-i*h)/c,e[7]=(t-r*h)/c),e},str$12=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals$12=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals$12=function(e,t){var s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],l=e[6],e=e[7],h=t[0],c=t[1],u=t[2],d=t[3],_=t[4],p=t[5],m=t[6],t=t[7];return Math.abs(s-h)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-c)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-u)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-d)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-_)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-p)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-m)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},create2=function(){var e=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e},clone2=function(e){var t=new ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},fromValues2=function(e,t){var s=new ARRAY_TYPE(2);return s[0]=e,s[1]=t,s},copy2=function(e,t){return e[0]=t[0],e[1]=t[1],e},set2=function(e,t,s){return e[0]=t,e[1]=s,e},add2=function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e},subtract2=function(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e},multiply2=function(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e},divide2=function(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e},ceil2=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor2=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min2=function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e},max2=function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e},round2=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale2=function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e},scaleAndAdd2=function(e,t,s,n){return e[0]=t[0]+s[0]*n,e[1]=t[1]+s[1]*n,e},distance2=function(e,t){var s=t[0]-e[0];return Math.hypot(s,t[1]-e[1])},squaredDistance2=function(e,t){var s=t[0]-e[0];return s*s+(t=t[1]-e[1])*t},length2=function(e){var t=e[0];return Math.hypot(t,e[1])},squaredLength2=function(e){var t=e[0];return t*t+(e=e[1])*e},negate2=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse2=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize2=function(e,t){var s=t[0],n=t[1];return 0<(s=s*s+n*n)&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e},dot2=function(e,t){return e[0]*t[0]+e[1]*t[1]},cross2=function(e,t,s){return t=t[0]*s[1]-t[1]*s[0],e[0]=e[1]=0,e[2]=t,e},lerp2=function(e,t,s,n){var i=t[0],t=t[1];return e[0]=i+n*(s[0]-i),e[1]=t+n*(s[1]-t),e},random2=function(e,t){t=t||1;var s=2*RANDOM()*Math.PI;return e[0]=Math.cos(s)*t,e[1]=Math.sin(s)*t,e},transformMat22=function(e,t,s){var n=t[0],t=t[1];return e[0]=s[0]*n+s[2]*t,e[1]=s[1]*n+s[3]*t,e},transformMat2d2=function(e,t,s){var n=t[0],t=t[1];return e[0]=s[0]*n+s[2]*t+s[4],e[1]=s[1]*n+s[3]*t+s[5],e},transformMat32=function(e,t,s){var n=t[0],t=t[1];return e[0]=s[0]*n+s[3]*t+s[6],e[1]=s[1]*n+s[4]*t+s[7],e},transformMat42=function(e,t,s){var n=t[0],t=t[1];return e[0]=s[0]*n+s[4]*t+s[12],e[1]=s[1]*n+s[5]*t+s[13],e},rotate2=function(e,t,s,n){var i=t[0]-s[0],t=t[1]-s[1],r=Math.sin(n),n=Math.cos(n);return e[0]=i*n-t*r+s[0],e[1]=i*r+t*n+s[1],e},angle2=function(e,t){var s=e[0],e=e[1],n=t[0],t=t[1],i=Math.sqrt((s*s+e*e)*(n*n+t*t));return Math.acos(Math.min(Math.max(i&&(s*n+e*t)/i,-1),1))},zero2=function(e){return e[0]=0,e[1]=0,e},str2=function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals2=function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals2=function(e,t){var s=e[0],e=e[1],n=t[0],t=t[1];return Math.abs(s-n)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(n))&&Math.abs(e-t)<=EPSILON*Math.max(1,Math.abs(e),Math.abs(t))};setMatrixArrayType=setMatrixArrayType2,toRadian=toRadian2,equals$9=equals$92,create$8=create$82,clone$8=clone$82,copy$8=copy$82,identity$5=identity$52,fromValues$8=fromValues$82,set$8=set$82,transpose$2=transpose$22,invert$5=invert$52,adjoint$2=adjoint$22,determinant$3=determinant$32,multiply$8=multiply$82,rotate$4=rotate$42,scale$8=scale$82,fromRotation$4=fromRotation$42,fromScaling$3=fromScaling$32,str$8=str$82,frob$3=frob$32,LDU=LDU2,add$8=add$82,subtract$6=subtract$62,exactEquals$8=exactEquals$82,equals$8=equals$82,multiplyScalar$3=multiplyScalar$32,multiplyScalarAndAdd$3=multiplyScalarAndAdd$32,create$7=create$72,clone$7=clone$72,copy$7=copy$72,identity$4=identity$42,fromValues$7=fromValues$72,set$7=set$72,invert$4=invert$42,determinant$2=determinant$22,multiply$7=multiply$72,rotate$3=rotate$32,scale$7=scale$72,translate$3=translate$32,fromRotation$3=fromRotation$32,fromScaling$2=fromScaling$22,fromTranslation$3=fromTranslation$32,str$7=str$72,frob$2=frob$22,add$7=add$72,subtract$5=subtract$52,multiplyScalar$2=multiplyScalar$22,multiplyScalarAndAdd$2=multiplyScalarAndAdd$22,exactEquals$7=exactEquals$72,equals$7=equals$72,create$6=create$62,fromMat4$1=fromMat4$12,clone$6=clone$62,copy$6=copy$62,fromValues$6=fromValues$62,set$6=set$62,identity$3=identity$32,transpose$1=transpose$12,invert$3=invert$32,adjoint$1=adjoint$12,determinant$1=determinant$12,multiply$6=multiply$62,translate$2=translate$22,rotate$2=rotate$22,scale$6=scale$62,fromTranslation$2=fromTranslation$22,fromRotation$2=fromRotation$22,fromScaling$1=fromScaling$12,fromMat2d=fromMat2d2,fromQuat$1=fromQuat$12,normalFromMat4=normalFromMat42,projection=projection2,str$6=str$62,frob$1=frob$12,add$6=add$62,subtract$4=subtract$42,multiplyScalar$1=multiplyScalar$12,multiplyScalarAndAdd$1=multiplyScalarAndAdd$12,exactEquals$6=exactEquals$62,equals$6=equals$62,create$5=create$52,clone$5=clone$52,copy$5=copy$52,fromValues$5=fromValues$52,set$5=set$52,identity$2=identity$22,transpose=transpose2,invert$2=invert$22,adjoint=adjoint2,determinant=determinant2,multiply$5=multiply$52,translate$1=translate$12,scale$5=scale$52,rotate$1=rotate$12,rotateX$3=rotateX$32,rotateY$3=rotateY$32,rotateZ$3=rotateZ$32,fromTranslation$1=fromTranslation$12,fromScaling=fromScaling2,fromRotation$1=fromRotation$12,fromXRotation=fromXRotation2,fromYRotation=fromYRotation2,fromZRotation=fromZRotation2,fromRotationTranslation$1=fromRotationTranslation$12,fromQuat2=fromQuat22,getTranslation$1=getTranslation$12,getScaling=getScaling2,getRotation=getRotation2,decompose=decompose2,fromRotationTranslationScale=fromRotationTranslationScale2,fromRotationTranslationScaleOrigin=fromRotationTranslationScaleOrigin2,fromQuat=fromQuat3,frustum=frustum2,perspectiveNO=perspectiveNO2,perspectiveZO=perspectiveZO2,perspectiveFromFieldOfView=perspectiveFromFieldOfView2,orthoNO=orthoNO2,orthoZO=orthoZO2,lookAt=lookAt2,targetTo=targetTo2,str$5=str$52,frob=frob2,add$5=add$52,subtract$3=subtract$32,multiplyScalar=multiplyScalar2,multiplyScalarAndAdd=multiplyScalarAndAdd2,exactEquals$5=exactEquals$52,equals$5=equals$52,create$4=create$42,clone$4=clone$42,length$4=length$42,fromValues$4=fromValues$42,copy$4=copy$42,set$4=set$42,add$4=add$42,subtract$2=subtract$22,multiply$4=multiply$42,divide$2=divide$22,ceil$2=ceil$22,floor$2=floor$22,min$2=min$22,max$2=max$22,round$2=round$22,scale$4=scale$42,scaleAndAdd$2=scaleAndAdd$22,distance$2=distance$22,squaredDistance$2=squaredDistance$22,squaredLength$4=squaredLength$42,negate$2=negate$22,inverse$2=inverse$22,normalize$4=normalize$42,dot$4=dot$42,cross$2=cross$22,lerp$4=lerp$42,slerp$1=slerp$12,hermite=hermite2,bezier=bezier2,random$3=random$32,transformMat4$2=transformMat4$22,transformMat3$1=transformMat3$12,transformQuat$1=transformQuat$12,rotateX$2=rotateX$22,rotateY$2=rotateY$22,rotateZ$2=rotateZ$22,angle$1=angle$12,zero$2=zero$22,str$4=str$42,exactEquals$4=exactEquals$42,equals$4=equals$42,create$3=create$32,clone$3=clone$32,fromValues$3=fromValues$32,copy$3=copy$32,set$3=set$32,add$3=add$32,subtract$1=subtract$12,multiply$3=multiply$32,divide$1=divide$12,ceil$1=ceil$12,floor$1=floor$12,min$1=min$12,max$1=max$12,round$1=round$12,scale$3=scale$32,scaleAndAdd$1=scaleAndAdd$12,distance$1=distance$12,squaredDistance$1=squaredDistance$12,length$3=length$32,squaredLength$3=squaredLength$32,negate$1=negate$12,inverse$1=inverse$12,normalize$3=normalize$32,dot$3=dot$32,cross$1=cross$12,lerp$3=lerp$32,random$2=random$22,transformMat4$1=transformMat4$12,transformQuat=transformQuat2,zero$1=zero$12,str$3=str$32,exactEquals$3=exactEquals$32,equals$3=equals$32,create$2=create$22,identity$1=identity$12,setAxisAngle=setAxisAngle2,getAxisAngle=getAxisAngle2,getAngle=getAngle2,multiply$2=multiply$22,rotateX$1=rotateX$12,rotateY$1=rotateY$12,rotateZ$1=rotateZ$12,calculateW=calculateW2,exp=exp2,ln=ln2,pow=pow2,slerp=slerp2,random$1=random$12,invert$1=invert$12,conjugate$1=conjugate$12,fromMat3=fromMat32,fromEuler=fromEuler2,str$2=str$22,equals$2=equals$22,create$1=create$12,clone$1=clone$12,fromValues$1=fromValues$12,fromRotationTranslationValues=fromRotationTranslationValues2,fromRotationTranslation=fromRotationTranslation2,fromTranslation=fromTranslation2,fromRotation=fromRotation2,fromMat4=fromMat42,copy$1=copy$12,identity=identity2,set$1=set$12,getDual=getDual2,setDual=setDual2,getTranslation=getTranslation2,translate=translate2,rotateX=rotateX2,rotateY=rotateY2,rotateZ=rotateZ2,rotateByQuatAppend=rotateByQuatAppend2,rotateByQuatPrepend=rotateByQuatPrepend2,rotateAroundAxis=rotateAroundAxis2,add$1=add$12,multiply$1=multiply$12,scale$1=scale$12,lerp$1=lerp$12,invert=invert2,conjugate=conjugate2,normalize$1=normalize$12,str$1=str$12,exactEquals$1=exactEquals$12,equals$1=equals$12,create=create2,clone=clone2,fromValues=fromValues2,copy=copy2,set=set2,add=add2,subtract=subtract2,multiply=multiply2,divide=divide2,ceil=ceil2,floor=floor2,min=min2,max=max2,round=round2,scale=scale2,scaleAndAdd=scaleAndAdd2,distance=distance2,squaredDistance=squaredDistance2,length=length2,squaredLength=squaredLength2,negate=negate2,inverse=inverse2,normalize=normalize2,dot=dot2,cross=cross2,lerp=lerp2,random=random2,transformMat2=transformMat22,transformMat2d=transformMat2d2,transformMat3=transformMat32,transformMat4=transformMat42,rotate=rotate2,angle=angle2,zero=zero2,str=str2,exactEquals=exactEquals2,equals=equals2,EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,RANDOM=Math.random,ANGLE_ORDER="zyx",degree=Math.PI/180,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),common={__proto__:null,EPSILON:EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM:RANDOM,ANGLE_ORDER:ANGLE_ORDER,setMatrixArrayType:setMatrixArrayType2,toRadian:toRadian2,equals:equals$92},mul$8=multiply$82,sub$6=subtract$62,mat2=Object.freeze({__proto__:null,create:create$82,clone:clone$82,copy:copy$82,identity:identity$52,fromValues:fromValues$82,set:set$82,transpose:transpose$22,invert:invert$52,adjoint:adjoint$22,determinant:determinant$32,multiply:multiply$82,rotate:rotate$42,scale:scale$82,fromRotation:fromRotation$42,fromScaling:fromScaling$32,str:str$82,frob:frob$32,LDU:LDU2,add:add$82,subtract:subtract$62,exactEquals:exactEquals$82,equals:equals$82,multiplyScalar:multiplyScalar$32,multiplyScalarAndAdd:multiplyScalarAndAdd$32,mul:mul$8,sub:sub$6}),mul$7=multiply$72,sub$5=subtract$52,mat2d=Object.freeze({__proto__:null,create:create$72,clone:clone$72,copy:copy$72,identity:identity$42,fromValues:fromValues$72,set:set$72,invert:invert$42,determinant:determinant$22,multiply:multiply$72,rotate:rotate$32,scale:scale$72,translate:translate$32,fromRotation:fromRotation$32,fromScaling:fromScaling$22,fromTranslation:fromTranslation$32,str:str$72,frob:frob$22,add:add$72,subtract:subtract$52,multiplyScalar:multiplyScalar$22,multiplyScalarAndAdd:multiplyScalarAndAdd$22,exactEquals:exactEquals$72,equals:equals$72,mul:mul$7,sub:sub$5}),mul$6=multiply$62,sub$4=subtract$42,mat3=Object.freeze({__proto__:null,create:create$62,fromMat4:fromMat4$12,clone:clone$62,copy:copy$62,fromValues:fromValues$62,set:set$62,identity:identity$32,transpose:transpose$12,invert:invert$32,adjoint:adjoint$12,determinant:determinant$12,multiply:multiply$62,translate:translate$22,rotate:rotate$22,scale:scale$62,fromTranslation:fromTranslation$22,fromRotation:fromRotation$22,fromScaling:fromScaling$12,fromMat2d:fromMat2d2,fromQuat:fromQuat$12,normalFromMat4:normalFromMat42,projection:projection2,str:str$62,frob:frob$12,add:add$62,subtract:subtract$42,multiplyScalar:multiplyScalar$12,multiplyScalarAndAdd:multiplyScalarAndAdd$12,exactEquals:exactEquals$62,equals:equals$62,mul:mul$6,sub:sub$4}),perspective=perspectiveNO2,ortho=orthoNO2,mul$5=multiply$52,sub$3=subtract$32,mat4=Object.freeze({__proto__:null,create:create$52,clone:clone$52,copy:copy$52,fromValues:fromValues$52,set:set$52,identity:identity$22,transpose:transpose2,invert:invert$22,adjoint:adjoint2,determinant:determinant2,multiply:multiply$52,translate:translate$12,scale:scale$52,rotate:rotate$12,rotateX:rotateX$32,rotateY:rotateY$32,rotateZ:rotateZ$32,fromTranslation:fromTranslation$12,fromScaling:fromScaling2,fromRotation:fromRotation$12,fromXRotation:fromXRotation2,fromYRotation:fromYRotation2,fromZRotation:fromZRotation2,fromRotationTranslation:fromRotationTranslation$12,fromQuat2:fromQuat22,getTranslation:getTranslation$12,getScaling:getScaling2,getRotation:getRotation2,decompose:decompose2,fromRotationTranslationScale:fromRotationTranslationScale2,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin2,fromQuat:fromQuat3,frustum:frustum2,perspectiveNO:perspectiveNO2,perspective:perspective,perspectiveZO:perspectiveZO2,perspectiveFromFieldOfView:perspectiveFromFieldOfView2,orthoNO:orthoNO2,ortho:ortho,orthoZO:orthoZO2,lookAt:lookAt2,targetTo:targetTo2,str:str$52,frob:frob2,add:add$52,subtract:subtract$32,multiplyScalar:multiplyScalar2,multiplyScalarAndAdd:multiplyScalarAndAdd2,exactEquals:exactEquals$52,equals:equals$52,mul:mul$5,sub:sub$3}),sub$2=subtract$22,mul$4=multiply$42,div$2=divide$22,dist$2=distance$22,sqrDist$2=squaredDistance$22,len$4=length$42,sqrLen$4=squaredLength$42,forEach$2=(()=>{var l=create$42();return function(e,t,s,n,i,r){var a,o;for(t=t||3,s=s||0,o=n?Math.min(n*t+s,e.length):e.length,a=s;a<o;a+=t)l[0]=e[a],l[1]=e[a+1],l[2]=e[a+2],i(l,l,r),e[a]=l[0],e[a+1]=l[1],e[a+2]=l[2];return e}})(),vec3=Object.freeze({__proto__:null,create:create$42,clone:clone$42,length:length$42,fromValues:fromValues$42,copy:copy$42,set:set$42,add:add$42,subtract:subtract$22,multiply:multiply$42,divide:divide$22,ceil:ceil$22,floor:floor$22,min:min$22,max:max$22,round:round$22,scale:scale$42,scaleAndAdd:scaleAndAdd$22,distance:distance$22,squaredDistance:squaredDistance$22,squaredLength:squaredLength$42,negate:negate$22,inverse:inverse$22,normalize:normalize$42,dot:dot$42,cross:cross$22,lerp:lerp$42,slerp:slerp$12,hermite:hermite2,bezier:bezier2,random:random$32,transformMat4:transformMat4$22,transformMat3:transformMat3$12,transformQuat:transformQuat$12,rotateX:rotateX$22,rotateY:rotateY$22,rotateZ:rotateZ$22,angle:angle$12,zero:zero$22,str:str$42,exactEquals:exactEquals$42,equals:equals$42,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2}),sub$1=subtract$12,mul$3=multiply$32,div$1=divide$12,dist$1=distance$12,sqrDist$1=squaredDistance$12,len$3=length$32,sqrLen$3=squaredLength$32,forEach$1=(()=>{var l=create$32();return function(e,t,s,n,i,r){var a,o;for(t=t||4,s=s||0,o=n?Math.min(n*t+s,e.length):e.length,a=s;a<o;a+=t)l[0]=e[a],l[1]=e[a+1],l[2]=e[a+2],l[3]=e[a+3],i(l,l,r),e[a]=l[0],e[a+1]=l[1],e[a+2]=l[2],e[a+3]=l[3];return e}})(),vec4=Object.freeze({__proto__:null,create:create$32,clone:clone$32,fromValues:fromValues$32,copy:copy$32,set:set$32,add:add$32,subtract:subtract$12,multiply:multiply$32,divide:divide$12,ceil:ceil$12,floor:floor$12,min:min$12,max:max$12,round:round$12,scale:scale$32,scaleAndAdd:scaleAndAdd$12,distance:distance$12,squaredDistance:squaredDistance$12,length:length$32,squaredLength:squaredLength$32,negate:negate$12,inverse:inverse$12,normalize:normalize$32,dot:dot$32,cross:cross$12,lerp:lerp$32,random:random$22,transformMat4:transformMat4$12,transformQuat:transformQuat2,zero:zero$12,str:str$32,exactEquals:exactEquals$32,equals:equals$32,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1}),clone$2=clone$32,fromValues$2=fromValues$32,copy$2=copy$32,set$2=set$32,add$2=add$32,mul$2=multiply$22,scale$2=scale$32,dot$2=dot$32,lerp$2=lerp$32,length$2=length$32,len$2=length$2,squaredLength$2=squaredLength$32,sqrLen$2=squaredLength$2,normalize$2=normalize$32,exactEquals$2=exactEquals$32,rotationTo=(()=>{var i=create$42(),r=fromValues$42(1,0,0),a=fromValues$42(0,1,0);return function(e,t,s){var n=dot$42(t,s);return n<-.999999?(cross$22(i,r,t),len$4(i)<1e-6&&cross$22(i,a,t),normalize$42(i,i),setAxisAngle2(e,i,Math.PI),e):.999999<n?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(cross$22(i,t,s),e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=1+n,normalize$2(e,e))}})(),sqlerp=(()=>{var a=create$22(),o=create$22();return function(e,t,s,n,i,r){return slerp2(a,t,i,r),slerp2(o,s,n,r),slerp2(e,a,o,2*r*(1-r)),e}})(),setAxes=(()=>{var i=create$62();return function(e,t,s,n){return i[0]=s[0],i[3]=s[1],i[6]=s[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],normalize$2(e,fromMat32(e,i))}})(),quat=Object.freeze({__proto__:null,create:create$22,identity:identity$12,setAxisAngle:setAxisAngle2,getAxisAngle:getAxisAngle2,getAngle:getAngle2,multiply:multiply$22,rotateX:rotateX$12,rotateY:rotateY$12,rotateZ:rotateZ$12,calculateW:calculateW2,exp:exp2,ln:ln2,pow:pow2,slerp:slerp2,random:random$12,invert:invert$12,conjugate:conjugate$12,fromMat3:fromMat32,fromEuler:fromEuler2,str:str$22,clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$22,rotationTo:rotationTo,sqlerp:sqlerp,setAxes:setAxes}),getReal=copy$2,setReal=copy$2,mul$1=multiply$12,dot$1=dot$2,length$1=length$2,len$1=length$1,squaredLength$1=squaredLength$2,sqrLen$1=squaredLength$1,quat2=Object.freeze({__proto__:null,create:create$12,clone:clone$12,fromValues:fromValues$12,fromRotationTranslationValues:fromRotationTranslationValues2,fromRotationTranslation:fromRotationTranslation2,fromTranslation:fromTranslation2,fromRotation:fromRotation2,fromMat4:fromMat42,copy:copy$12,identity:identity2,set:set$12,getReal:getReal,getDual:getDual2,setReal:setReal,setDual:setDual2,getTranslation:getTranslation2,translate:translate2,rotateX:rotateX2,rotateY:rotateY2,rotateZ:rotateZ2,rotateByQuatAppend:rotateByQuatAppend2,rotateByQuatPrepend:rotateByQuatPrepend2,rotateAroundAxis:rotateAroundAxis2,add:add$12,multiply:multiply$12,mul:mul$1,scale:scale$12,dot:dot$1,lerp:lerp$12,invert:invert2,conjugate:conjugate2,length:length$1,len:len$1,squaredLength:squaredLength$1,sqrLen:sqrLen$1,normalize:normalize$12,str:str$12,exactEquals:exactEquals$12,equals:equals$12}),len=length2,sub=subtract2,mul=multiply2,div=divide2,dist=distance2,sqrDist=squaredDistance2,sqrLen=squaredLength2,forEach=(()=>{var l=create2();return function(e,t,s,n,i,r){var a,o;for(t=t||2,s=s||0,o=n?Math.min(n*t+s,e.length):e.length,a=s;a<o;a+=t)l[0]=e[a],l[1]=e[a+1],i(l,l,r),e[a]=l[0],e[a+1]=l[1];return e}})(),vec2=Object.freeze({__proto__:null,create:create2,clone:clone2,fromValues:fromValues2,copy:copy2,set:set2,add:add2,subtract:subtract2,multiply:multiply2,divide:divide2,ceil:ceil2,floor:floor2,min:min2,max:max2,round:round2,scale:scale2,scaleAndAdd:scaleAndAdd2,distance:distance2,squaredDistance:squaredDistance2,length:length2,squaredLength:squaredLength2,negate:negate2,inverse:inverse2,normalize:normalize2,dot:dot2,cross:cross2,lerp:lerp2,random:random2,transformMat2:transformMat22,transformMat2d:transformMat2d2,transformMat3:transformMat32,transformMat4:transformMat42,rotate:rotate2,angle:angle2,zero:zero2,str:str2,exactEquals:exactEquals2,equals:equals2,len:len,sub:sub,mul:mul,div:div,dist:dist,sqrDist:sqrDist,sqrLen:sqrLen,forEach:forEach}),globalThis.glMatrix=common,globalThis.glMatrix.mat2=mat2,globalThis.glMatrix.mat2d=mat2d,globalThis.glMatrix.mat3=mat3,globalThis.glMatrix.mat4=mat4,globalThis.glMatrix.quat=quat,globalThis.glMatrix.quat2=quat2,globalThis.glMatrix.vec2=vec2,globalThis.glMatrix.vec3=vec3,globalThis.glMatrix.vec4=vec4}var EPSILON,ARRAY_TYPE,RANDOM,ANGLE_ORDER,degree,common,mul$8,sub$6,mat2,mul$7,sub$5,mat2d,mul$6,sub$4,mat3,perspective,ortho,mul$5,sub$3,mat4,sub$2,mul$4,div$2,dist$2,sqrDist$2,len$4,sqrLen$4,forEach$2,vec3,sub$1,mul$3,div$1,dist$1,sqrDist$1,len$3,sqrLen$3,forEach$1,vec4,clone$2,fromValues$2,copy$2,set$2,add$2,mul$2,scale$2,dot$2,lerp$2,length$2,len$2,squaredLength$2,sqrLen$2,normalize$2,exactEquals$2,rotationTo,sqlerp,setAxes,quat,getReal,setReal,mul$1,dot$1,length$1,len$1,squaredLength$1,sqrLen$1,quat2,len,sub,mul,div,dist,sqrDist,sqrLen,forEach,vec2,setMatrixArrayType,toRadian,equals$9,create$8,clone$8,copy$8,identity$5,fromValues$8,set$8,transpose$2,invert$5,adjoint$2,determinant$3,multiply$8,rotate$4,scale$8,fromRotation$4,fromScaling$3,str$8,frob$3,LDU,add$8,subtract$6,exactEquals$8,equals$8,multiplyScalar$3,multiplyScalarAndAdd$3,create$7,clone$7,copy$7,identity$4,fromValues$7,set$7,invert$4,determinant$2,multiply$7,rotate$3,scale$7,translate$3,fromRotation$3,fromScaling$2,fromTranslation$3,str$7,frob$2,add$7,subtract$5,multiplyScalar$2,multiplyScalarAndAdd$2,exactEquals$7,equals$7,create$6,fromMat4$1,clone$6,copy$6,fromValues$6,set$6,identity$3,transpose$1,invert$3,adjoint$1,determinant$1,multiply$6,translate$2,rotate$2,scale$6,fromTranslation$2,fromRotation$2,fromScaling$1,fromMat2d,fromQuat$1,normalFromMat4,projection,str$6,frob$1,add$6,subtract$4,multiplyScalar$1,multiplyScalarAndAdd$1,exactEquals$6,equals$6,create$5,clone$5,copy$5,fromValues$5,set$5,identity$2,transpose,invert$2,adjoint,determinant,multiply$5,translate$1,scale$5,rotate$1,rotateX$3,rotateY$3,rotateZ$3,fromTranslation$1,fromScaling,fromRotation$1,fromXRotation,fromYRotation,fromZRotation,fromRotationTranslation$1,fromQuat2,getTranslation$1,getScaling,getRotation,decompose,fromRotationTranslationScale,fromRotationTranslationScaleOrigin,fromQuat,frustum,perspectiveNO,perspectiveZO,perspectiveFromFieldOfView,orthoNO,orthoZO,lookAt,targetTo,str$5,frob,add$5,subtract$3,multiplyScalar,multiplyScalarAndAdd,exactEquals$5,equals$5,create$4,clone$4,length$4,fromValues$4,copy$4,set$4,add$4,subtract$2,multiply$4,divide$2,ceil$2,floor$2,min$2,max$2,round$2,scale$4,scaleAndAdd$2,distance$2,squaredDistance$2,squaredLength$4,negate$2,inverse$2,normalize$4,dot$4,cross$2,lerp$4,slerp$1,hermite,bezier,random$3,transformMat4$2,transformMat3$1,transformQuat$1,rotateX$2,rotateY$2,rotateZ$2,angle$1,zero$2,str$4,exactEquals$4,equals$4,create$3,clone$3,fromValues$3,copy$3,set$3,add$3,subtract$1,multiply$3,divide$1,ceil$1,floor$1,min$1,max$1,round$1,scale$3,scaleAndAdd$1,distance$1,squaredDistance$1,length$3,squaredLength$3,negate$1,inverse$1,normalize$3,dot$3,cross$1,lerp$3,random$2,transformMat4$1,transformQuat,zero$1,str$3,exactEquals$3,equals$3,create$2,identity$1,setAxisAngle,getAxisAngle,getAngle,multiply$2,rotateX$1,rotateY$1,rotateZ$1,calculateW,exp,ln,pow,slerp,random$1,invert$1,conjugate$1,fromMat3,fromEuler,str$2,equals$2,create$1,clone$1,fromValues$1,fromRotationTranslationValues,fromRotationTranslation,fromTranslation,fromRotation,fromMat4,copy$1,identity,set$1,getDual,setDual,getTranslation,translate,rotateX,rotateY,rotateZ,rotateByQuatAppend,rotateByQuatPrepend,rotateAroundAxis,add$1,multiply$1,scale$1,lerp$1,invert,conjugate,normalize$1,str$1,exactEquals$1,equals$1,create,clone,fromValues,copy,set,add,subtract,multiply,divide,ceil,floor,min,max,round,scale,scaleAndAdd,distance,squaredDistance,length,squaredLength,negate,inverse,normalize,dot,cross,lerp,random,transformMat2,transformMat2d,transformMat3,transformMat4,rotate,angle,zero,str,exactEquals,equals,tmpPoint1,tmpPoint2,tmpLine1,tmpLine2,lineInt,lineSegmentsIntersect,triangleArea,isLeft,isLeftOn,isRight,isRightOn,collinear,sqdist,polygonAt,polygonClear,polygonAppend,polygonMakeCCW,polygonReverse,polygonIsReflex,polygonCanSee,polygonCanSee2,polygonCopy,polygonGetCutEdges,polygonDecomp,polygonSlice,polygonIsSimple,getIntersectionPoint,polygonQuickDecomp,polygonRemoveCollinearPoints,polygonRemoveDuplicatePoints,scalar_eq,points_eq,ReadBrandList,RunTest,GetWindowsNTVersionName,asyncifyRequest,asyncifyTransaction,openReadOnlyTransaction,openWriteTransaction,lazyOpenDatabase,RequireString,getEntriesFromCursor,NOT_IMPLEMENTED,DISALLOW_CALLBACK,StructuredClone,arrayFlat,assertFail,isValidTypeChange,logDefendedObjectWarning,CheckDefendedObjectsUsedCorrectly,getObjectPropertySet,VerifyObjectPropertiesConsistent,isNegativeZero,padTwoDigits,hueToRGB,RequireStringOrNumber,SetNewCallback,DoAsyncifiedWork,DoNextAsyncifiedJob,ClearTimeCache,CheckActiveIdleTimeouts,lookupHtmlEntity,bbToHtmlReplacerFunc,IsWordBreakWhiteSpace,IsOpeningCJKPunctiationChar,IsContinuingCJKPunctuationChar,WordBreakTrimEnd,IsNewline,PlaneFromPoints,IsInFrontOfPlane,IsPointInFrontOfPlane,interpolateQuad,GetFormatSpecifiers,fillOrStrokeRect,ptToPx,getOffsetParam,CheckPendingPolls,SortZOrderList,GetDispatcher,MakeIWorldInstanceClass,GetDispatcher,GetTimelineState,GetTimelineState,GetTweenState,getActual,GetTypeFromFileExtension,AddScript,SortByInstLastCachedZIndex,SortByInstLastCachedZIndex,SortByInstZElevation,vec3EqualsXYZ,MaybePrepareLayerDraw,SortSolArray,IsSolArrayIdentical,NoActions,WrapIndex,GetExpressionFunc,EvalParams,EvalParams,GetInst,GetWorldInfo,GetInst_SDKv2,GetWorldInfo_SDKv2,CollMemory_Add,CollMemory_Remove,CollMemory_RemoveInstance,CollMemory_Get,DoOverlapCondition,FinishCollisionConditionPicking,FinishCollisionCondition,PickByUID_Normal,PickByUID_Inverted,GetNextParamMap,ValidateInternalAPIToken,ForEachOrdered_SortInstances,SortZOrderList,SortInstancesByValue,ResizeArray,DoForEachTrigger,CompareValues,GetTouchSdkInstance,IsExpressionType,GetMouseSdkInstance,GetKeyboardSdkInstance,StringFromCharCode,CloneDrawable,WrapModeToStr,GetAudioSdkInstance,GetAudioDOMInterface,GetParticleEngine,randomOffset,getIndexForEase,ValidateTags,unaryminus,bothNumbers,add,subtract,multiply,divide,mod,pow,and,or;{let lineInt2=function(e,t,s){var n=[0,0],i=e[1][1]-e[0][1],r=e[0][0]-e[1][0],e=i*e[0][0]+r*e[0][1],a=t[1][1]-t[0][1],o=t[0][0]-t[1][0],t=a*t[0][0]+o*t[0][1],l=i*o-a*r;return scalar_eq2(l,0,s=s||0)||(n[0]=(o*e-r*t)/l,n[1]=(i*t-a*e)/l),n},lineSegmentsIntersect2=function(e,t,s,n){var i,r=t[0]-e[0],t=t[1]-e[1],a=n[0]-s[0];return a*t-(n=n[1]-s[1])*r!=0&&(i=(a*(e[1]-s[1])+n*(s[0]-e[0]))/(n*r-a*t),0<=(e=(r*(s[1]-e[1])+t*(e[0]-s[0]))/(a*t-n*r)))&&e<=1&&0<=i&&i<=1},triangleArea2=function(e,t,s){return(t[0]-e[0])*(s[1]-e[1])-(s[0]-e[0])*(t[1]-e[1])},isLeft2=function(e,t,s){return 0<triangleArea2(e,t,s)},isLeftOn2=function(e,t,s){return 0<=triangleArea2(e,t,s)},isRight2=function(e,t,s){return triangleArea2(e,t,s)<0},isRightOn2=function(e,t,s){return triangleArea2(e,t,s)<=0},collinear2=function(e,t,s,n){var i,r,a;return n?(a=tmpPoint2,(r=tmpPoint1)[0]=t[0]-e[0],r[1]=t[1]-e[1],a[0]=s[0]-t[0],a[1]=s[1]-t[1],i=r[0]*a[0]+r[1]*a[1],r=Math.sqrt(r[0]*r[0]+r[1]*r[1]),a=Math.sqrt(a[0]*a[0]+a[1]*a[1]),Math.acos(i/(r*a))<n):0===triangleArea2(e,t,s)},sqdist2=function(e,t){var s=t[0]-e[0];return s*s+(t=t[1]-e[1])*t},polygonAt2=function(e,t){var s=e.length;return e[t<0?t%s+s:t%s]},polygonClear2=function(e){e.length=0},polygonAppend2=function(e,t,s,n){for(var i=s;i<n;i++)e.push(t[i])},polygonMakeCCW2=function(e){for(var t=0,s=e,n=1;n<e.length;++n)(s[n][1]<s[t][1]||s[n][1]===s[t][1]&&s[n][0]>s[t][0])&&(t=n);return!isLeft2(polygonAt2(e,t-1),polygonAt2(e,t),polygonAt2(e,t+1))&&(polygonReverse2(e),!0)},polygonReverse2=function(e){for(var t=[],s=e.length,n=0;n!==s;n++)t.push(e.pop());for(n=0;n!==s;n++)e[n]=t[n]},polygonIsReflex2=function(e,t){return isRight2(polygonAt2(e,t-1),polygonAt2(e,t),polygonAt2(e,t+1))},polygonCanSee3=function(e,t,s){var n,i=tmpLine1,r=tmpLine2;if(isLeftOn2(polygonAt2(e,t+1),polygonAt2(e,t),polygonAt2(e,s))&&isRightOn2(polygonAt2(e,t-1),polygonAt2(e,t),polygonAt2(e,s)))return!1;for(var a=sqdist2(polygonAt2(e,t),polygonAt2(e,s)),o=0;o!==e.length;++o)if((o+1)%e.length!==t&&o!==t&&isLeftOn2(polygonAt2(e,t),polygonAt2(e,s),polygonAt2(e,o+1))&&isRightOn2(polygonAt2(e,t),polygonAt2(e,s),polygonAt2(e,o))&&(i[0]=polygonAt2(e,t),i[1]=polygonAt2(e,s),r[0]=polygonAt2(e,o),r[1]=polygonAt2(e,o+1),n=lineInt2(i,r),sqdist2(polygonAt2(e,t),n)<a))return!1;return!0},polygonCanSee22=function(e,t,s){for(var n=0;n!==e.length;++n)if(n!==t&&n!==s&&(n+1)%e.length!==t&&(n+1)%e.length!==s&&lineSegmentsIntersect2(polygonAt2(e,t),polygonAt2(e,s),polygonAt2(e,n),polygonAt2(e,n+1)))return!1;return!0},polygonCopy2=function(e,t,s,n){var i=n||[];if(polygonClear2(i),t<s)for(var r=t;r<=s;r++)i.push(e[r]);else{for(r=0;r<=s;r++)i.push(e[r]);for(r=t;r<e.length;r++)i.push(e[r])}return i},polygonGetCutEdges2=function(e){for(var t=[],s=[],n=[],i=Number.MAX_VALUE,r=0;r<e.length;++r)if(polygonIsReflex2(e,r))for(var a=0;a<e.length;++a)if(polygonCanSee3(e,r,a)){for(var s=polygonGetCutEdges2(polygonCopy2(e,r,a,n)),o=polygonGetCutEdges2(polygonCopy2(e,a,r,n)),l=0;l<o.length;l++)s.push(o[l]);s.length<i&&(i=(t=s).length,t.push([polygonAt2(e,r),polygonAt2(e,a)]))}return t},polygonDecomp2=function(e){var t=polygonGetCutEdges2(e);return 0<t.length?polygonSlice2(e,t):[e]},polygonSlice2=function(e,t){if(0===t.length)return[e];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2===t[0].length&&t[0][0]instanceof Array){for(var s=[e],n=0;n<t.length;n++)for(var i=t[n],r=0;r<s.length;r++){var a=polygonSlice2(s[r],i);if(a){s.splice(r,1),s.push(a[0],a[1]);break}}return s}return n=e.indexOf((i=t)[0]),r=e.indexOf(i[1]),-1!==n&&-1!==r&&[polygonCopy2(e,n,r),polygonCopy2(e,r,n)]},polygonIsSimple2=function(e){for(var t=e,s=0;s<t.length-1;s++)for(var n=0;n<s-1;n++)if(lineSegmentsIntersect2(t[s],t[s+1],t[n],t[n+1]))return!1;for(s=1;s<t.length-2;s++)if(lineSegmentsIntersect2(t[0],t[t.length-1],t[s],t[s+1]))return!1;return!0},getIntersectionPoint2=function(e,t,s,n,i){var r=t[1]-e[1],t=e[0]-t[0],e=r*e[0]+t*e[1],a=n[1]-s[1],n=s[0]-n[0],s=a*s[0]+n*s[1],o=r*n-a*t;return scalar_eq2(o,0,i=i||0)?[0,0]:[(n*e-t*s)/o,(r*s-a*e)/o]},polygonQuickDecomp2=function(e,t,s,n,i,r,a){r=r||100,a=a||0,i=i||25,t=void 0!==t?t:[],s=s||[],n=n||[];var o=[0,0],l=[0,0],h=[0,0],c=0,u=0,d=0,_=0,p=0,m=0,g=0,f=[],S=[],y=e,C=e;if(!(C.length<3))if(r<++a)console.warn("quickDecomp: max level ("+r+") reached.");else{for(var G=0;G<e.length;++G)if(polygonIsReflex2(y,G)){s.push(y[G]);for(var c=u=Number.MAX_VALUE,T=0;T<e.length;++T)isLeft2(polygonAt2(y,G-1),polygonAt2(y,G),polygonAt2(y,T))&&isRightOn2(polygonAt2(y,G-1),polygonAt2(y,G),polygonAt2(y,T-1))&&(h=getIntersectionPoint2(polygonAt2(y,G-1),polygonAt2(y,G),polygonAt2(y,T),polygonAt2(y,T-1)),isRight2(polygonAt2(y,G+1),polygonAt2(y,G),h))&&(d=sqdist2(y[G],h))<u&&(u=d,l=h,m=T),isLeft2(polygonAt2(y,G+1),polygonAt2(y,G),polygonAt2(y,T+1))&&isRightOn2(polygonAt2(y,G+1),polygonAt2(y,G),polygonAt2(y,T))&&(h=getIntersectionPoint2(polygonAt2(y,G+1),polygonAt2(y,G),polygonAt2(y,T),polygonAt2(y,T+1)),isLeft2(polygonAt2(y,G-1),polygonAt2(y,G),h))&&(d=sqdist2(y[G],h))<c&&(c=d,o=h,p=T);if(m===(p+1)%e.length)h[0]=(l[0]+o[0])/2,h[1]=(l[1]+o[1])/2,n.push(h),G<p?(polygonAppend2(f,y,G,p+1),f.push(h),S.push(h),0!==m&&polygonAppend2(S,y,m,y.length),polygonAppend2(S,y,0,G+1)):(0!==G&&polygonAppend2(f,y,G,y.length),polygonAppend2(f,y,0,p+1),f.push(h),S.push(h),polygonAppend2(S,y,m,G+1));else{if(p<m&&(p+=e.length),_=Number.MAX_VALUE,p<m)return t;for(T=m;T<=p;++T)isLeftOn2(polygonAt2(y,G-1),polygonAt2(y,G),polygonAt2(y,T))&&isRightOn2(polygonAt2(y,G+1),polygonAt2(y,G),polygonAt2(y,T))&&(d=sqdist2(polygonAt2(y,G),polygonAt2(y,T)))<_&&polygonCanSee22(y,G,T)&&(_=d,g=T%e.length);G<g?(polygonAppend2(f,y,G,g+1),0!==g&&polygonAppend2(S,y,g,C.length),polygonAppend2(S,y,0,G+1)):(0!==G&&polygonAppend2(f,y,G,C.length),polygonAppend2(f,y,0,g+1),polygonAppend2(S,y,g,G+1))}return f.length<S.length?(polygonQuickDecomp2(f,t,s,n,i,r,a),polygonQuickDecomp2(S,t,s,n,i,r,a)):(polygonQuickDecomp2(S,t,s,n,i,r,a),polygonQuickDecomp2(f,t,s,n,i,r,a)),t}t.push(e)}return t},polygonRemoveCollinearPoints2=function(e,t){for(var s=0,n=e.length-1;3<e.length&&0<=n;--n)collinear2(polygonAt2(e,n-1),polygonAt2(e,n),polygonAt2(e,n+1),t)&&(e.splice(n%e.length,1),s++);return s},polygonRemoveDuplicatePoints2=function(e,t){for(var s=e.length-1;1<=s;--s)for(var n=e[s],i=s-1;0<=i;--i)points_eq2(n,e[i],t)&&e.splice(s,1)},scalar_eq2=function(e,t,s){return s=s||0,Math.abs(e-t)<=s},points_eq2=function(e,t,s){return scalar_eq2(e[0],t[0],s)&&scalar_eq2(e[1],t[1],s)};lineInt=lineInt2,lineSegmentsIntersect=lineSegmentsIntersect2,triangleArea=triangleArea2,isLeft=isLeft2,isLeftOn=isLeftOn2,isRight=isRight2,isRightOn=isRightOn2,collinear=collinear2,sqdist=sqdist2,polygonAt=polygonAt2,polygonClear=polygonClear2,polygonAppend=polygonAppend2,polygonMakeCCW=polygonMakeCCW2,polygonReverse=polygonReverse2,polygonIsReflex=polygonIsReflex2,polygonCanSee=polygonCanSee3,polygonCanSee2=polygonCanSee22,polygonCopy=polygonCopy2,polygonGetCutEdges=polygonGetCutEdges2,polygonDecomp=polygonDecomp2,polygonSlice=polygonSlice2,polygonIsSimple=polygonIsSimple2,getIntersectionPoint=getIntersectionPoint2,polygonQuickDecomp=polygonQuickDecomp2,polygonRemoveCollinearPoints=polygonRemoveCollinearPoints2,polygonRemoveDuplicatePoints=polygonRemoveDuplicatePoints2,scalar_eq=scalar_eq2,points_eq=points_eq2,tmpPoint1=[],tmpPoint2=[],tmpLine1=[],tmpLine2=[],self.polyDecomp={decomp:polygonDecomp2,quickDecomp:polygonQuickDecomp2,isSimple:polygonIsSimple2,removeCollinearPoints:polygonRemoveCollinearPoints2,removeDuplicatePoints:polygonRemoveDuplicatePoints2,makeCCW:polygonMakeCCW2}}{let isReady=!1,hasAppStarted=!1,buildMode="dev",internalApiToken=Symbol("Construct internal API token"),internalApiTokenAccessesRemaining=14,C33=self.C3=class{constructor(){throw TypeError("static class can't be instantiated")}static _GetInternalAPIToken(){if(internalApiTokenAccessesRemaining<=0)throw new Error("cannot obtain internal API token");return--internalApiTokenAccessesRemaining,internalApiToken}static SetReady(){isReady=!0}static IsReady(){return isReady}static SetAppStarted(){hasAppStarted=!0}static HasAppStarted(){return hasAppStarted}static SetBuildMode(e){buildMode=e}static GetBuildMode(){return buildMode}static IsReleaseBuild(){return"final"===buildMode}};C33.isDebug=!1,C33.isDebugDefend=!1,C33.hardwareConcurrency=navigator.hardwareConcurrency||2,self.C3X={}}{const C33=self.C3;C33.QueryParser=class{constructor(e){this._queryString=e,this._parameters=new Map,this._Parse()}_Parse(){let e=this._queryString,t=(e=e.startsWith("?")||e.startsWith("#")?e.substr(1):e).split("&");for(const s of t)this._ParseParameter(s)}_ParseParameter(e){if(e)if(e.includes("=")){const t=e.indexOf("="),s=decodeURIComponent(e.substring(0,t)),n=decodeURIComponent(e.substring(t+1));this._parameters.set(s,n)}else this._parameters.set(e,null)}LogAll(){for(const e of this._parameters)console.log("[QueryParser] Parameter '"+e[0]+"' = "+(null===e[1]?"null":"'"+e[1]+"'"))}Has(e){return this._parameters.has(e)}Get(e){const t=this._parameters.get(e);return void 0===t?null:t}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(e){this._queryString=e,this._parameters.clear(),this._Parse()}},C33.QueryString=new C33.QueryParser(location.search),C33.LocationHashString=new C33.QueryParser(location.hash),C33.QueryString.Has("perf")&&(C33.isPerformanceProfiling=!0),"dev"!==C33.QueryString.Get("mode")&&C33.SetBuildMode("final")}{let GetWindowsNTVersionName2=function(e){const t=parseFloat(e),s=windowsNTVerMap.get(t);return s||(13<=t?"11":"NT "+e)};GetWindowsNTVersionName=GetWindowsNTVersionName2;const C33=self.C3,UNKNOWN="(unknown)",windowsNTVerMap=(C33.Platform={OS:UNKNOWN,OSVersion:UNKNOWN,Browser:UNKNOWN,BrowserVersion:UNKNOWN,BrowserVersionNumber:NaN,BrowserEngine:UNKNOWN,Context:"browser",IsDesktop:!0,IsMobile:!1,IsAppleOS:!1,IsIpadOS:!1,GetDetailedInfo:async()=>{}},new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]])),uaStr=navigator.userAgent,uaData=navigator.userAgentData;if(uaData&&0<uaData.brands.length){let ReadBrandList2=function(t){let s="",n="",i="",r="";for(const a of t){const o=d.get(a.brand),l=(!s&&o&&(s=o,n=a.version),e.get(a.brand));!i&&l&&(i=l,r=a.version)}s||"Chromium"!==i||(C33.Platform.Browser="Chromium",C33.Platform.BrowserVersion=r),C33.Platform.Browser=s||UNKNOWN,C33.Platform.BrowserVersion=n||UNKNOWN,C33.Platform.BrowserEngine=i||UNKNOWN};ReadBrandList=ReadBrandList2,C33.Platform.OS=uaData.platform,C33.Platform.IsMobile=uaData.mobile,C33.Platform.IsDesktop=!C33.Platform.IsMobile;const d=new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]]),e=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]);ReadBrandList2(uaData.brands);let o=!1;C33.Platform.GetDetailedInfo=async()=>{if(!o)try{const e=await navigator.userAgentData.getHighEntropyValues(["platformVersion","fullVersionList"]);ReadBrandList2(e.fullVersionList),"Windows"===C33.Platform.OS?C33.Platform.OSVersion=GetWindowsNTVersionName2(e.platformVersion):C33.Platform.OSVersion=e.platformVersion,o=!0}catch(e){console.warn("Failed to get detailed user agent information: ",e)}}}else{let RunTest2=function(e,t){const s=Array.isArray(e)?e:[e];for(const n of s){const i=n.exec(uaStr);if(i){t(i);break}}};RunTest=RunTest2,RunTest2(/windows\s+nt\s+([\d\.]+)/i,e=>{C33.Platform.OS="Windows";const t=e[1];C33.Platform.OSVersion=GetWindowsNTVersionName2(t)}),RunTest2(/mac\s+os\s+x\s+([\d\._]+)/i,e=>{C33.Platform.OS="macOS",C33.Platform.OSVersion=e[1].replace(/_/g,".")}),RunTest2(/CrOS/,()=>{C33.Platform.OS="Chrome OS"}),RunTest2(/linux|openbsd|freebsd|netbsd/i,()=>{C33.Platform.OS="Linux"}),RunTest2(/android/i,()=>{C33.Platform.OS="Android"}),RunTest2(/android\s+([\d\.]+)/i,e=>{C33.Platform.OS="Android",C33.Platform.OSVersion=e[1]}),C33.Platform.OS===UNKNOWN&&(RunTest2(/(iphone|ipod|ipad)/i,e=>{C33.Platform.OS="iOS"}),RunTest2([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],e=>{C33.Platform.OS="iOS",C33.Platform.OSVersion=e[1].replace(/_/g,".")}));const q=/chrome\//i.test(uaStr),r=/chromium\//i.test(uaStr),s=/edg\//i.test(uaStr),t=/OPR\//.test(uaStr),u=/nwjs/i.test(uaStr),v=/safari\//i.test(uaStr),w=/webkit/i.test(uaStr),x=(s||t||RunTest2(/chrome\/([\d\.]+)/i,e=>{C33.Platform.Browser="Chrome",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/edg\/([\d\.]+)/i,e=>{C33.Platform.Browser="Edge",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/OPR\/([\d\.]+)/,e=>{C33.Platform.Browser="Opera",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/chromium\/([\d\.]+)/i,e=>{C33.Platform.Browser="Chromium",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium"}),RunTest2(/nwjs\/[0-9.]+/i,e=>{C33.Platform.Browser="NW.js",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Chromium",C33.Platform.Context="nwjs"}),RunTest2(/firefox\/([\d\.]+)/i,e=>{C33.Platform.Browser="Firefox",C33.Platform.BrowserVersion=e[1],C33.Platform.BrowserEngine="Gecko"}),!v||q||r||s||t||u||(C33.Platform.Browser="Safari",C33.Platform.BrowserEngine="WebKit",RunTest2(/version\/([\d\.]+)/i,e=>{C33.Platform.BrowserVersion=e[1]}),RunTest2(/crios\/([\d\.]+)/i,e=>{C33.Platform.Browser="Chrome for iOS",C33.Platform.BrowserVersion=e[1]}),RunTest2(/fxios\/([\d\.]+)/i,e=>{C33.Platform.Browser="Firefox for iOS",C33.Platform.BrowserVersion=e[1]}),RunTest2(/edgios\/([\d\.]+)/i,e=>{C33.Platform.Browser="Edge for iOS",C33.Platform.BrowserVersion=e[1]})),C33.Platform.BrowserEngine===UNKNOWN&&w&&(C33.Platform.BrowserEngine="WebKit"),"Android"===C33.Platform.OS&&"Safari"===C33.Platform.Browser&&(C33.Platform.Browser="Stock"),new Set(["Windows","macOS","Linux","Chrome OS"])),y=x.has(C33.Platform.OS)||"nwjs"===C33.Platform.Context;C33.Platform.IsDesktop=y,C33.Platform.IsMobile=!y}"Chrome"===C33.Platform.Browser&&"browser"===C33.Platform.Context&&/wv\)/.test(uaStr)&&(C33.Platform.Context="webview"),"nwjs"!==C33.Platform.Context&&"undefined"!=typeof window&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)&&(C33.Platform.Context="webapp"),C33.Platform.BrowserVersionNumber=parseFloat(C33.Platform.BrowserVersion);const looksLikeIPadOS="macOS"===C33.Platform.OS&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints;looksLikeIPadOS&&(C33.Platform.OS="iOS",C33.Platform.OSVersion=C33.Platform.BrowserVersion,C33.Platform.IsDesktop=!1,C33.Platform.IsMobile=!0,C33.Platform.IsIpadOS=!0),C33.Platform.IsAppleOS="macOS"===C33.Platform.OS||"iOS"===C33.Platform.OS}{let asyncifyRequest2=function(s){return new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})},asyncifyTransaction2=function(s){return new Promise((e,t)=>{s.oncomplete=()=>e(),s.onerror=()=>t(s.error),s.onabort=()=>t(s.error)})},openReadOnlyTransaction2=function(e,t){return openTransaction(e,t)},openWriteTransaction2=function(e,t){return openTransaction(e,t,!0)},lazyOpenDatabase2=function(t){RequireString2(t);let e=c.get(t);return e instanceof Promise||(e=openDatabase(t),c.set(t,e),e.catch(e=>c.delete(t))),e},RequireString2=function(e){if("string"!=typeof e)throw new TypeError("expected string")},getEntriesFromCursor2=function(e,i){const t=e.objectStore(b).openCursor();return new Promise(s=>{const n=[];t.onsuccess=e=>{const t=e.target.result;if(t){switch(i){case"entries":n.push([t.key,t.value]);break;case"keys":n.push(t.key);break;case"values":n.push(t.value)}t.continue()}else s(n)}})};asyncifyRequest=asyncifyRequest2,asyncifyTransaction=asyncifyTransaction2,openReadOnlyTransaction=openReadOnlyTransaction2,openWriteTransaction=openWriteTransaction2,lazyOpenDatabase=lazyOpenDatabase2,RequireString=RequireString2,getEntriesFromCursor=getEntriesFromCursor2;const a=2,b="keyvaluepairs",c=new Map,d="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAll,e="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAllKeys;async function openTransaction(t,s,n=!1,i=!0){const e=await lazyOpenDatabase2(t);try{const r=e.transaction([b],n?"readwrite":"readonly");return s(r)}catch(e){if(i&&"InvalidStateError"===e.name)return c.delete(t),openTransaction(t,s,n,!1);throw e}}async function openDatabase(s){RequireString2(s);const e=indexedDB.open(s,a);return e.addEventListener("upgradeneeded",e=>{try{const t=e.target.result;t.createObjectStore(b)}catch(e){console.error("Failed to create objectstore for database "+s,e)}}),asyncifyRequest2(e)}class f{constructor(e){RequireString2(e),this.name=e}async ready(){await lazyOpenDatabase2(this.name)}set(i,r){return RequireString2(i),openWriteTransaction2(this.name,async e=>{const t=e.objectStore(b).put(r,i),s=asyncifyRequest2(t),n=asyncifyTransaction2(e);await Promise.all([n,s])})}get(r){return RequireString2(r),openReadOnlyTransaction2(this.name,async e=>{const t=e.objectStore(b).get(r),s=asyncifyRequest2(t),n=asyncifyTransaction2(e),[,i]=await Promise.all([n,s]);return i})}delete(i){return RequireString2(i),openWriteTransaction2(this.name,async e=>{const t=e.objectStore(b).delete(i),s=asyncifyRequest2(t),n=asyncifyTransaction2(e);await Promise.all([n,s])})}clear(){return openWriteTransaction2(this.name,async e=>{const t=e.objectStore(b).clear(),s=asyncifyRequest2(t),n=asyncifyTransaction2(e);await Promise.all([n,s])})}keys(){return openReadOnlyTransaction2(this.name,async t=>{let s;if(e){const r=t.objectStore(b).getAllKeys();s=asyncifyRequest2(r)}else s=getEntriesFromCursor2(t,"keys");const n=asyncifyTransaction2(t),[,i]=await Promise.all([n,s]);return i})}values(){return openReadOnlyTransaction2(this.name,async e=>{let t;if(d){const i=e.objectStore(b).getAll();t=asyncifyRequest2(i)}else t=getEntriesFromCursor2(e,"values");const s=asyncifyTransaction2(e),[,n]=await Promise.all([s,t]);return n})}entries(){return openReadOnlyTransaction2(this.name,async e=>{const t=getEntriesFromCursor2(e,"entries"),s=asyncifyTransaction2(e),[,n]=await Promise.all([s,t]);return n})}}self.KVStorageContainer=f}{let NOT_IMPLEMENTED2=function(e){throw new Error(`"${e}" is not implemented`)},DISALLOW_CALLBACK2=function(e){if("function"==typeof e)throw new Error("localforage callback API is not implemented; please use the promise API instead")},StructuredClone2=function(n){return"object"==typeof n?new Promise(t=>{const{port1:e,port2:s}=new MessageChannel;s.onmessage=e=>t(e.data),e.postMessage(n)}):Promise.resolve(n)};NOT_IMPLEMENTED=NOT_IMPLEMENTED2,DISALLOW_CALLBACK=DISALLOW_CALLBACK2,StructuredClone=StructuredClone2;const a=self.KVStorageContainer,b=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i],c=new WeakMap;class d{constructor(e){this._inst=e,this._isInMemory=!this._inst,this._isInMemory||"undefined"!=typeof indexedDB||(this._isInMemory=!0,console.warn("Unable to use local storage because IndexedDB API is not available")),this._memoryStorage=new Map}_MaybeSwitchToMemoryFallback(e){if(!this._isInMemory)for(const t of b)if(e&&t.test(e.message)){console.error("Unable to use local storage, reverting to in-memory store: ",e,e.message),this._isInMemory=!0;break}}async _getItemFallback(e){const t=this._memoryStorage.get(e),s=await StructuredClone2(t);return void 0===s?null:s}async _setItemFallback(e,t){t=await StructuredClone2(t),this._memoryStorage.set(e,t)}_removeItemFallback(e){this._memoryStorage.delete(e)}_clearFallback(){this._memoryStorage.clear()}_keysFallback(){return Array.from(this._memoryStorage.keys())}IsInMemory(){return this._isInMemory}GetMemoryStorage(){return this._memoryStorage}SetMemoryStorage(e){this._memoryStorage=e}async getItem(t,e){if(DISALLOW_CALLBACK2(e),this._isInMemory)return this._getItemFallback(t);let s;try{s=await this._inst.get(t)}catch(e){return this._MaybeSwitchToMemoryFallback(e),this._isInMemory?this._getItemFallback(t):(console.error(`Error reading '${t}' from storage, returning null: `,e),null)}return void 0===s?null:s}async setItem(t,s,e){if(DISALLOW_CALLBACK2(e),void 0===s&&(s=null),this._isInMemory)await this._setItemFallback(t,s);else try{await this._inst.set(t,s)}catch(e){if(this._MaybeSwitchToMemoryFallback(e),!this._isInMemory)throw e;await this._setItemFallback(t,s)}}async removeItem(t,e){if(DISALLOW_CALLBACK2(e),this._isInMemory)this._removeItemFallback(t);else try{await this._inst.delete(t)}catch(e){this._MaybeSwitchToMemoryFallback(e),this._isInMemory?this._removeItemFallback(t):console.error(`Error removing '${t}' from storage: `,e)}}async clear(e){if(DISALLOW_CALLBACK2(e),this._isInMemory)this._clearFallback();else try{await this._inst.clear()}catch(e){this._MaybeSwitchToMemoryFallback(e),this._isInMemory?this._clearFallback():console.error("Error clearing storage: ",e)}}async keys(e){if(DISALLOW_CALLBACK2(e),this._isInMemory)return this._keysFallback();let t=[];try{t=await this._inst.keys()}catch(e){if(this._MaybeSwitchToMemoryFallback(e),this._isInMemory)return this._keysFallback();console.error("Error getting storage keys: ",e)}return t}ready(e){return DISALLOW_CALLBACK2(e),this._isInMemory?Promise.resolve(!0):this._inst.ready()}createInstance(e){if(e.forceInMemoryFallback)return new d(null);{const t=e.name;if("string"!=typeof t)throw new TypeError("invalid store name");const s=new a(t);return new d(s)}}length(e){NOT_IMPLEMENTED2("localforage.length()")}key(e,t){NOT_IMPLEMENTED2("localforage.key()")}iterate(e,t){NOT_IMPLEMENTED2("localforage.iterate()")}setDriver(e){NOT_IMPLEMENTED2("localforage.setDriver()")}config(e){NOT_IMPLEMENTED2("localforage.config()")}defineDriver(e){NOT_IMPLEMENTED2("localforage.defineDriver()")}driver(){NOT_IMPLEMENTED2("localforage.driver()")}supports(e){NOT_IMPLEMENTED2("localforage.supports()")}dropInstance(){NOT_IMPLEMENTED2("localforage.dropInstance()")}}self.localforage=new d(new a("localforage"))}{const C33=self.C3;if(C33.Supports={},C33.Supports.WebAnimations=(()=>{try{if("undefined"==typeof document)return!1;const e=document.createElement("div");if(void 0===e.animate)return!1;const t=e.animate([{opacity:"0"},{opacity:"1"}],1e3);return void 0!==t.reverse}catch(e){return!1}})(),C33.Supports.DialogElement="undefined"!=typeof HTMLDialogElement,C33.Supports.RequestIdleCallback=!!self.requestIdleCallback,C33.Supports.ImageBitmap=!!self.createImageBitmap,C33.Supports.ImageBitmapOptions=!1,C33.Supports.ImageBitmapOptionsResize=!1,C33.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{premultiplyAlpha:"none"}).then(()=>{C33.Supports.ImageBitmapOptions=!0}).catch(()=>{C33.Supports.ImageBitmapOptions=!1})}catch(e){C33.Supports.ImageBitmapOptions=!1}try{self.createImageBitmap(new ImageData(32,32),{resizeWidth:10,resizeHeight:10}).then(e=>{C33.Supports.ImageBitmapOptionsResize=10===e.width&&10===e.height}).catch(()=>{C33.Supports.ImageBitmapOptionsResize=!1})}catch(e){C33.Supports.ImageBitmapOptionsResize=!1}}if(C33.Supports.ClipboardReadText=!(!navigator.clipboard||!navigator.clipboard.readText),C33.Supports.PermissionsQuery=!(!navigator.permissions||!navigator.permissions.query),C33.Supports.ClipboardPermissionsQuery=!1,C33.Supports.PermissionsQuery){const g={name:"clipboard-read"};navigator.permissions.query(g).then(()=>{C33.Supports.ClipboardPermissionsQuery=!0}).catch(()=>{C33.Supports.ClipboardPermissionsQuery=!1})}C33.Supports.AsyncClipboardApi=!!(navigator.permissions&&navigator.clipboard&&self.ClipboardItem),C33.Supports.Proxies="undefined"!=typeof Proxy,C33.Supports.DownloadAttribute=(()=>{if("undefined"==typeof document)return!1;const e=document.createElement("a");return void 0!==e.download})(),C33.Supports.Fetch="function"==typeof fetch,C33.Supports.PersistentStorage=!!(self.isSecureContext&&"Opera"!==C33.Platform.Browser&&navigator.storage&&navigator.storage.persist),C33.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator.storage&&navigator.storage.estimate),C33.Supports.Fullscreen=(()=>{if("undefined"==typeof document)return!1;if("iOS"===C33.Platform.OS)return!1;const e=document.documentElement;return!!(e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen)})(),C33.Supports.ImageDecoder=void 0!==self.ImageDecoder,C33.Supports.WebCodecs=!!self.VideoEncoder,C33.Supports.NativeFileSystemAPI=!!self.showOpenFilePicker,C33.Supports.QueryLocalFonts=!!self.queryLocalFonts,C33.Supports.UserActivation=!!navigator.userActivation,C33.Supports.CanvasToBlobWebP=!1,(async()=>{let t;"undefined"==typeof document?t=new OffscreenCanvas(32,32):((t=document.createElement("canvas")).width=32,t.height=32);const e=t.getContext("2d");e.fillStyle="blue",e.fillRect(0,0,32,32);let s=null;try{t.convertToBlob?s=await t.convertToBlob({type:"image/webp",quality:1}):t.toBlob&&(s=await new Promise(e=>t.toBlob(e,"image/webp",1))),C33.Supports.CanvasToBlobWebP=s&&"image/webp"===s.type}catch(e){C33.Supports.CanvasToBlobWebP=!1}})()}{let arrayFlat2=function(e,s){return e.reduce((e,t)=>(0<s&&Array.isArray(t)?Array.prototype.push.apply(e,arrayFlat2(t,s-1)):e.push(t),e),[])};arrayFlat=arrayFlat2;const C33=self.C3;if(!String.prototype.trimStart){const a=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function(){return this.replace(a,"")}}if(!String.prototype.trimEnd){const c=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function(){return this.replace(c,"")}}String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(C33.EscapeRegex(e),"g"),t)}),Array.prototype.values||(Array.prototype.values=function*(){for(const e of this)yield e}),Array.prototype.flat||(Array.prototype.flat=function(e=1){return arrayFlat2(this,e)}),Array.prototype.at||(Array.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),String.prototype.at||(String.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),RegExp.escape||(RegExp.escape=function(e){return String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}),Set.prototype.isSubsetOf||(Set.prototype.isSubsetOf=function(e){if(!(e instanceof Set))throw new TypeError("argument must be a Set");for(const t of this)if(!e.has(t))return!1;return!0}),navigator.storage&&!navigator.storage.estimate&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota&&(navigator.storage.estimate=function(){return new Promise((s,e)=>navigator.webkitTemporaryStorage.queryUsageAndQuota((e,t)=>s({usage:e,quota:t}),e))}),void 0===self.isSecureContext&&(self.isSecureContext="https:"===location.protocol),void 0===self.globalThis&&(self.globalThis=self)}{let assertFail2=function(e){let t=C33.GetCallStack(),s="Assertion failure: "+e+"\n\nStack trace:\n"+t;console.error(s)};assertFail=assertFail2;const C33=self.C3;self.assert=function(e,t){e||assertFail2(t)}}{const C33=self.C3,C3X=self.C3X,TypedArray=(C33.IsNumber=function(e){return"number"==typeof e},C33.IsFiniteNumber=function(e){return C33.IsNumber(e)&&isFinite(e)},C33.RequireNumber=function(e){if(!C33.IsNumber(e))throw new TypeError("expected number")},C33.RequireOptionalNumber=function(e){C33.IsNullOrUndefined(e)},C33.RequireNumberInRange=function(e,t,s){if(!C33.IsNumber(e)||isNaN(e)||e<t||s<e)throw new RangeError("number outside of range")},C33.RequireAllNumber=function(...t){for(let e of t);},C33.RequireFiniteNumber=function(e){if(!C33.IsFiniteNumber(e))throw new TypeError("expected finite number")},C33.RequireOptionalFiniteNumber=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllFiniteNumber=function(...t){for(let e of t);},C33.IsString=function(e){return"string"==typeof e},C33.RequireString=function(e){if(!C33.IsString(e))throw new TypeError("expected string")},C33.RequireOptionalString=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllString=function(...t){for(let e of t);},C33.IsSimpleObject=function(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return t?t.constructor===Object:null===t},C33.RequireSimpleObject=function(e){if(!C33.IsSimpleObject(e))throw new TypeError("expected simple object")},C33.RequireOptionalSimpleObject=function(e){if(!C33.IsNullOrUndefined(e)&&!C33.IsSimpleObject(e))throw new TypeError("expected simple object")},C33.IsObject=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},C33.RequireObject=function(e){if(!C33.IsObject(e))throw new TypeError("expected object")},C33.RequireOptionalObject=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllObject=function(...t){for(let e of t);},C33.IsFileLike=function(e){return C33.WeakIsInstanceOf(e,Blob)&&"string"==typeof e.name},C33.RequireFileLike=function(e){if(!C33.IsFileLike(e))throw new TypeError("expected file")},C33.RequireOptionalFileLike=function(e){C33.IsNullOrUndefined(e)},C33.IsArray=function(e){return Array.isArray(e)},C33.RequireArray=function(e){if(!C33.IsArray(e))throw new TypeError("expected array")},C33.RequireOptionalArray=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllArray=function(...t){for(let e of t);},C33.Is2DArray=function(e){return!(!C33.IsArray(e)||e.length&&!C33.IsArray(e[0]))},C33.Require2DArray=function(t){if(!C33.Is2DArray(t))throw new TypeError("expected 2d array");for(let e of t)if(!C33.IsArray(e))throw new TypeError("expected 2d array")},C33.RequireOptional2DArray=function(e){C33.IsNullOrUndefined(e)},C33.IsFunction=function(e){return"function"==typeof e},C33.RequireFunction=function(e,t){if(!C33.IsFunction(e))throw new TypeError("expected function");if(!C33.IsNullOrUndefined(t)&&e!==t)throw new TypeError("expected same function reference")},C33.RequireOptionalFunction=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllFunction=function(...t){for(let e of t);},C33.RequireAnyFunction=function(t,...s){if(!C33.IsFunction(t))throw new TypeError("expected function");if(!s.length)throw new Error("missing comparison functions");for(let e of s)if(!C33.IsNullOrUndefined(e)&&t===e)return;throw new TypeError("expected same function reference")},C33.RequireOptionalAllFunction=function(...t){if(!C33.IsNullOrUndefined(t))for(let e of t);},C33.IsInstanceOf=function(e,t){return e instanceof t},C33.IsInstanceOfAny=function(t,...s){for(let e of s)if(C33.IsInstanceOf(t,e))return!0;return!1},C33.RequireInstanceOf=function(e,t){if(!C33.IsInstanceOf(e,t))throw new TypeError("unexpected type")},C33.RequireOptionalInstanceOf=function(e,t){C33.IsNullOrUndefined(e)},C33.RequireAllInstanceOf=function(e,...t){for(let e of t);},C33.RequireAnyInstanceOf=function(e,...t){if(!C33.IsInstanceOfAny(e,...t))throw new TypeError("unexpected type")},C33.RequireAnyOptionalInstanceOf=function(e,...t){if(!C33.IsNullOrUndefined(e)&&!C33.IsInstanceOfAny(e,...t))throw new TypeError("unexpected type")},C33.IsArrayOf=function(t,s){for(let e of t)if(!C33.IsInstanceOf(e,s))return!1;return!0},C33.IsArrayOfFiniteNumbers=function(t){for(let e of t)if(!C33.IsFiniteNumber(e))return!1;return!0},C33.RequireArrayOf=function(t,e){for(let e of t);},C33.RequireOptionalArrayOf=function(t,e){if(!C33.IsNullOrUndefined(t))for(let e of t);},C33.RequireOptionalArrayOfFunctions=function(t,e){if(!C33.IsNullOrUndefined(t))for(let e of t);},C33.RequireArrayOfAny=function(t){for(let e of t);},C33.RequireOptionalArrayOfAny=function(t){if(!C33.IsNullOrUndefined(t))for(let e of t);},C33.IsDOMNode=function(e,t){return!(C33.IsNullOrUndefined(e)||!C33.IsString(e.nodeName))&&(!t||C33.equalsNoCase(e.nodeName,t))},C33.RequireDOMNode=function(e,t){if(C33.IsNullOrUndefined(e)||!C33.IsString(e.nodeName))throw new TypeError("expected DOM node");if(t&&!C33.equalsNoCase(e.nodeName,t))throw new TypeError(`expected DOM '${t}' node`)},C33.RequireOptionalDOMNode=function(e,t){C33.IsNullOrUndefined(e)},C33.IsHTMLElement=function(e,t){return!(C33.IsNullOrUndefined(e)||!C33.IsString(e.tagName))&&(!t||C33.equalsNoCase(e.tagName,t))},C33.RequireHTMLElement=function(e,t){if(C33.IsNullOrUndefined(e)||!C33.IsString(e.tagName))throw new TypeError("expected HTML element");if(t&&!C33.equalsNoCase(e.tagName,t))throw new TypeError(`expected HTML '${t}' element`)},C33.RequireOptionalHTMLElement=function(e,t){C33.IsNullOrUndefined(e)},C33.IsDrawable=function(e){return C33.IsHTMLElement(e,"img")||C33.IsHTMLElement(e,"canvas")||C33.IsHTMLElement(e,"video")||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap},C33.RequireDrawable=function(e){if(!C33.IsDrawable(e))throw new TypeError("expected drawable")},C33.RequireOptionalDrawable=function(e){C33.IsNullOrUndefined(e)},C33.IsDrawableOrImageData=function(e){return e instanceof ImageData||C33.IsDrawable(e)},C33.RequireDrawableOrImageData=function(e){if(!C33.IsDrawableOrImageData(e))throw new TypeError("expected drawable or image data")},C33.RequireOptionalDrawableOrImageData=function(e){if(!C33.IsNullOrUndefined(e)&&!C33.IsDrawableOrImageData(e))throw new TypeError("expected drawable or image data")},C33.IsStringLike=function(e){return"string"==typeof e||C33.HtmlString&&e instanceof C33.HtmlString||e instanceof C33.BBString},C33.RequireStringLike=function(e){if(!C33.IsStringLike(e))throw new TypeError("expected string-like")},C33.RequireOptionalStringLike=function(e){C33.IsNullOrUndefined(e)},C33.RequireAllStringLike=function(...t){for(let e of t);},C33.RequireOverride=function(){throw new Error("must be overridden")},C33.NotYetImplemented=function(){throw new Error("not yet implemented")},C33.IsDefined=function(e,...t){let s=e;if(void 0===s)return!1;for(let e of t){if(void 0===s[e])return!1;s=s[e]}return!0},C33.IsNullOrUndefined=function(e){return null==e},C33.AreArrayElementsOfSameType=function(t){let s=t[0].constructor;for(let e of t)if(e.constructor!==s)return!1;return s},C33.AreArrayElementsOfType=function(t,s){for(let e of t)if(!(e instanceof s))return!1;return!0},Object.getPrototypeOf(Uint8Array));C33.IsTypedArray=function(e){return C33.IsInstanceOf(e,TypedArray)},C33.RequireTypedArray=function(e){},C33.WeakRequireTypedArray=function(e){C33.WeakRequireInstanceOf(e,TypedArray)},C33.WeakRequireAnyInstanceOf=function(e,...t){if(!C33.WeakIsAnyInstanceOf(e,...t))throw new TypeError("unexpected type")},C33.WeakIsAnyInstanceOf=function(e,...t){for(const s of t)if(C33.WeakIsInstanceOf(e,s))return!0;return!1},C33.WeakRequireInstanceOf=function(e,t){if(!C33.WeakIsInstanceOf(e,t))throw new TypeError("unexpected type")},C33.WeakIsInstanceOf=function(e,t){for(;e=Object.getPrototypeOf(e);)if(e.constructor.name===t.name)return!0;return!1},C3X.RequireNumber=C33.RequireNumber,C3X.RequireOptionalNumber=C33.RequireOptionalNumber,C3X.RequireFiniteNumber=C33.RequireFiniteNumber,C3X.RequireOptionalFiniteNumber=C33.RequireOptionalFiniteNumber,C3X.RequireString=C33.RequireString,C3X.RequireOptionalString=C33.RequireOptionalString,C3X.RequireObject=C33.RequireObject,C3X.RequireOptionalObject=C33.RequireOptionalObject,C3X.RequireArray=C33.RequireArray,C3X.RequireOptionalArray=C33.RequireOptionalArray,C3X.RequireFunction=C33.RequireFunction,C3X.RequireOptionalFunction=C33.RequireOptionalFunction,C3X.RequireInstanceOf=C33.RequireInstanceOf,C3X.RequireOptionalInstanceOf=C33.RequireOptionalInstanceOf,C3X.IsNullOrUndefined=C33.IsNullOrUndefined}{let isValidTypeChange2=function(e,t){let s=C33.getType(e),n=C33.getType(t);return"null"===s||"null"===n||"undefined"!==s&&"undefined"!==n&&s===n},logDefendedObjectWarning2=function(e){console.warn("[Defence] "+e+" @",C33.GetCallStack())},CheckDefendedObjectsUsedCorrectly2=function(){if(checkRafId=-1,0<ctorObjectToProxy.size||0<ctorProxyToObject.size){let e=new Set([...ctorObjectToProxy.keys()].map(e=>C33.getName(e))),t=[...e].join(",");console.warn("An object derived from DefendedBase was not protected with debugDefend(). This will disable some checks. See the coding guidelines! Possible affected class names: "+t),ctorObjectToProxy.clear(),ctorProxyToObject.clear()}},getObjectPropertySet2=function(t){let s=new Set;for(let e in t)s.add(e);return s},VerifyObjectPropertiesConsistent2=function(e,t){let s=getObjectPropertySet2(t),n=typeProperties.get(e);if(n){let t=[];for(let e of n.values())s.has(e)?s.delete(e):t.push(e);C33.appendArray(t,[...s]),t.length&&console.warn(`[Defence] '${C33.getName(e)}' constructor creates inconsistent properties: `+t.join(", "))}else typeProperties.set(e,s)};isValidTypeChange=isValidTypeChange2,logDefendedObjectWarning=logDefendedObjectWarning2,CheckDefendedObjectsUsedCorrectly=CheckDefendedObjectsUsedCorrectly2,getObjectPropertySet=getObjectPropertySet2,VerifyObjectPropertiesConsistent=VerifyObjectPropertiesConsistent2;const C33=self.C3,logRafIds=new Map;C33.ColorLog=function(e,t){console.log("%c"+e,"font-weight: bold; color:"+t)},C33.RafLog=function(e,...t){logRafIds.has(e)||logRafIds.set(e,-1),-1===logRafIds.get(e)&&logRafIds.set(e,requestAnimationFrame(()=>{console.log("%c"+e,"font-weight: bold",...t),logRafIds.set(e,-1)}))};let measures,ctorObjectToProxy=(C33.StartMeasure=function(e){performance.mark(e),(measures=measures||new Map).has(e)||measures.set(e,{current:0,total:0,average:0,calls:1,toString:function(){return`${e} :: current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => `+this.calls}})},C33.EndMeasure=function(e){performance.measure("measure-"+e,e);const t=performance.getEntriesByName("measure-"+e)[0],s=measures.get(e);s.current=t.duration,s.total+=s.current,s.average=s.total/s.calls,console.log(s.toString()),s.calls++,performance.clearMarks(e),performance.clearMeasures("measure-"+e)},C33.GetCallStack=function(){return(new Error).stack},C33.Debugger=function(){},C33.cast=function(e,t){return e&&e instanceof t?e:null},C33.getName=function(e){return void 0===e?"undefined":null===e?"null":"boolean"==typeof e?"<boolean>":C33.IsNumber(e)?"<number>":C33.IsString(e)?"<string>":C33.IsArray(e)?"<array>":"symbol"==typeof e?"<"+e.toString()+">":C33.IsFunction(e)?e.name&&"Function"!==e.name?e.name:"<anonymous function>":"object"==typeof e?e.constructor&&e.constructor.name&&"Object"!==e.constructor.name?e.constructor.name:"<anonymous object>":"<unknown>"},C33.getType=function(e){return null===e?"null":Array.isArray(e)?"array":typeof e},C33.range=function*(t,s){if(!isFinite(Math.abs(t-s)))throw new Error("Invalid parameters");if(s<t)for(let e=t-1;e>=s;e--)yield e;else for(let e=t;e<s;e++)yield e},new Map),ctorProxyToObject=new Map,proxyToObject=new WeakMap,releasedObjects=new WeakMap;C33.DefendHandler={};const VALID_GET_MISSING_KEYS=new Set(["then","splice"]);C33.DefendHandler.get=function(e,t){return t in e||"symbol"==typeof t||VALID_GET_MISSING_KEYS.has(t)||logDefendedObjectWarning2(`Accessed missing property '${t}' from defended object '${C33.getName(e)}', returning undefined`),releasedObjects.has(e)&&"symbol"!=typeof t&&!VALID_GET_MISSING_KEYS.has(t)&&logDefendedObjectWarning2(`Accessed property '${t}' on a released object '${C33.getName(e)}'
Object was originally released at: ${releasedObjects.get(e)})
Call stack at access: `),e[t]},C33.DefendHandler.set=function(e,t,s){return t in e||ctorObjectToProxy.has(e)||logDefendedObjectWarning2(`Set non-existent property '${t}' to '${s}' on defended object '${C33.getName(e)}'`),isValidTypeChange2(e[t],s)||ctorObjectToProxy.has(e)||logDefendedObjectWarning2(`Set '${C33.getType(e[t])}' property '${t}' to type '${C33.getType(s)}' on defended object '${C33.getName(e)}'`),releasedObjects.has(e)&&logDefendedObjectWarning2(`Set property '${t}' on a released object '${C33.getName(e)}'
Object was originally released at: ${releasedObjects.get(e)})
Call stack at access: `),e[t]=s,!0},C33.DefendHandler.deleteProperty=function(e,t){throw new ReferenceError(`Cannot delete property '${t}' from defended object '${C33.getName(e)}'`)},C33.DefendHandler.defineProperty=function(e,t,s){throw new ReferenceError(`Cannot define property '${t}' on defended object '${C33.getName(e)}'`)},C33.DefendHandler.enumerate=function(e){throw new ReferenceError(`Cannot enumerate defended object '${C33.getName(e)}'`)};let checkRafId=-1,typeProperties=(C33.DefendedBase=class{constructor(){if(C33.isDebugDefend&&C33.Supports.Proxies){let e=Object.create(new.target.prototype),t=new Proxy(e,C33.DefendHandler);return ctorObjectToProxy.set(e,t),ctorProxyToObject.set(t,e),proxyToObject.set(t,e),-1===checkRafId&&(checkRafId=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly2)),t}}},C33.debugDefend=function(t){if(C33.isDebugDefend&&C33.Supports.Proxies&&t instanceof C33.DefendedBase){if(ctorProxyToObject.has(t)){let e=ctorProxyToObject.get(t);ctorProxyToObject.delete(t),ctorObjectToProxy.delete(e)}return t}return C33.isDebug?Object.seal(t):t},C33.New=function(e,...t){let s;try{s=new e(...t)}catch(e){throw ctorProxyToObject.clear(),ctorObjectToProxy.clear(),e}return C33.isDebugDefend&&VerifyObjectPropertiesConsistent2(e,s),C33.debugDefend(s)},C33.Release=function(e){let t=proxyToObject.get(e);t&&releasedObjects.set(t,C33.GetCallStack())},C33.WasReleased=function(e){let t=proxyToObject.get(e);return!!t&&!!releasedObjects.get(t)},new Map);C33.PerfMark=class{constructor(e){this._name="",e&&this.start(e)}start(e){C33.isPerformanceProfiling&&(this._name=e,performance.mark(this._name+"-Start"))}end(){C33.isPerformanceProfiling&&(performance.mark(this._name+"-End"),performance.measure(this._name,this._name+"-Start",this._name+"-End"))}next(e){C33.isPerformanceProfiling&&(this.end(),this._name=e,performance.mark(this._name+"-Start"))}}}{let isNegativeZero2=function(e){return 0===e&&1/e<0};isNegativeZero=isNegativeZero2;const C33=self.C3,TWO_PI=2*Math.PI,D_TO_R=Math.PI/180,R_TO_D=180/Math.PI,ALPHAEX_SHIFT=(C33.wrap=function(e,t,s){e=Math.floor(e),t=Math.floor(t);const n=(s=Math.floor(s))-t;if(0==n)return s;if(e<t){const i=s-(t-e)%n;return i===s?0:i}return t+(e-t)%n},C33.mapToRange=function(e,t,s,n,i){const r=s-t;if(0==r&&0===n)return e;const a=i-n;return(e-t)*a/r+n},C33.normalize=function(e,t,s){return t-s==0?1:(e-t)/(s-t)},C33.clamp=function(e,t,s){return e<t?t:s<e?s:e},C33.clampAngle=function(e){return(e%=TWO_PI)<0&&(e+=TWO_PI),e},C33.toRadians=function(e){return e*D_TO_R},C33.toDegrees=function(e){return e*R_TO_D},C33.distanceTo=function(e,t,s,n){return Math.hypot(s-e,n-t)},C33.distanceSquared=function(e,t,s,n){const i=s-e,r=n-t;return i*i+r*r},C33.angleTo=function(e,t,s,n){return Math.atan2(n-t,s-e)},C33.angleDiff=function(e,t){if(e===t)return 0;let s=Math.sin(e),n=Math.cos(e),i=Math.sin(t),r=Math.cos(t),a=s*i+n*r;return 1<=a?0:a<=-1?Math.PI:Math.acos(a)},C33.angleRotate=function(e,t,s){let n=Math.sin(e),i=Math.cos(e),r=Math.sin(t),a=Math.cos(t);return Math.acos(n*r+i*a)>s?0<i*r-n*a?C33.clampAngle(e+s):C33.clampAngle(e-s):C33.clampAngle(t)},C33.angleClockwise=function(e,t){let s=Math.sin(e),n=Math.cos(e),i=Math.sin(t),r=Math.cos(t);return n*i-s*r<=0},C33.angleLerp=function(e,t,s,n=0){let i=C33.angleDiff(e,t),r=TWO_PI*n;return C33.angleClockwise(t,e)?C33.clampAngle(e+(i+r)*s):C33.clampAngle(e-(i+r)*s)},C33.angleLerpClockwise=function(e,t,s,n=0){const i=C33.angleDiff(e,t),r=TWO_PI*n;return C33.angleClockwise(t,e)?C33.clampAngle(e+(i+r)*s):C33.clampAngle(e+(TWO_PI-i+r)*s)},C33.angleLerpAntiClockwise=function(e,t,s,n=0){const i=C33.angleDiff(e,t),r=TWO_PI*n;return C33.angleClockwise(t,e)?C33.clampAngle(e-(-TWO_PI+i-r)*s):C33.clampAngle(e-(i+r)*s)},C33.angleReflect=function(e,t){const s=C33.angleDiff(e,t);return C33.angleClockwise(e,t)?C33.clampAngle(t-s):C33.clampAngle(t+s)},C33.lerp=function(e,t,s){return e+s*(t-e)},C33.unlerp=function(e,t,s){return e===t?0:(s-e)/(t-e)},C33.relerp=function(e,t,s,n,i){return C33.lerp(n,i,C33.unlerp(e,t,s))},C33.qarp=function(e,t,s,n){return C33.lerp(C33.lerp(e,t,n),C33.lerp(t,s,n),n)},C33.cubic=function(e,t,s,n,i){return C33.lerp(C33.qarp(e,t,s,i),C33.qarp(t,s,n,i),i)},C33.cosp=function(e,t,s){return(e+t+(e-t)*Math.cos(s*Math.PI))/2},C33.isPOT=function(e){return 0<e&&0==(e-1&e)},C33.nextHighestPowerOfTwo=function(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1},C33.roundToNearestFraction=function(e,t){return Math.round(e*t)/t},C33.floorToNearestFraction=function(e,t){return Math.floor(e*t)/t},C33.roundToDp=function(e,t){t=Math.max(Math.floor(t),0);const s=Math.pow(10,t);return Math.round(e*s)/s},C33.countDecimals=function(e){return Math.floor(e)!==e&&e.toString().split(".")[1].length||0},C33.toFixed=function(e,t){let s=e.toFixed(t),n=s.length-1;for(;0<=n&&"0"===s.charAt(n);--n);return 0<=n&&"."===s.charAt(n)&&--n,n<0?s:s.substr(0,n+1)},C33.PackRGB=function(e,t,s){return C33.clamp(e,0,255)|C33.clamp(t,0,255)<<8|C33.clamp(s,0,255)<<16},1024),ALPHAEX_MAX=1023,RGBEX_SHIFT=16384,RGBEX_MAX=8191,RGBEX_MIN=-8192,COMMON_ASPECT_RATIOS=(C33.PackRGBAEx=function(e,t,s,n){return e=C33.clamp(Math.floor(1024*e),RGBEX_MIN,RGBEX_MAX),t=C33.clamp(Math.floor(1024*t),RGBEX_MIN,RGBEX_MAX),s=C33.clamp(Math.floor(1024*s),RGBEX_MIN,RGBEX_MAX),n=C33.clamp(Math.floor(n*ALPHAEX_MAX),0,ALPHAEX_MAX),e<0&&(e+=RGBEX_SHIFT),t<0&&(t+=RGBEX_SHIFT),s<0&&(s+=RGBEX_SHIFT),-(e*RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT+t*RGBEX_SHIFT*ALPHAEX_SHIFT+s*ALPHAEX_SHIFT+n)},C33.PackRGBEx=function(e,t,s){return C33.PackRGBAEx(e,t,s,1)},C33.GetRValue=function(t){if(0<=t)return(255&t)/255;{let e=Math.floor(-t/(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT));return e>RGBEX_MAX&&(e-=RGBEX_SHIFT),e/1024}},C33.GetGValue=function(t){if(0<=t)return((65280&t)>>8)/255;{let e=Math.floor(-t%(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT)/(RGBEX_SHIFT*ALPHAEX_SHIFT));return e>RGBEX_MAX&&(e-=RGBEX_SHIFT),e/1024}},C33.GetBValue=function(t){if(0<=t)return((16711680&t)>>16)/255;{let e=Math.floor(-t%(RGBEX_SHIFT*ALPHAEX_SHIFT)/ALPHAEX_SHIFT);return e>RGBEX_MAX&&(e-=RGBEX_SHIFT),e/1024}},C33.GetAValue=function(e){if(isNegativeZero2(e))return 0;if(0<=e)return 1;{const t=Math.floor(-e%ALPHAEX_SHIFT);return t/ALPHAEX_MAX}},C33.greatestCommonDivisor=function(t,s){for(t=Math.floor(t),s=Math.floor(s);0!==s;){let e=s;s=t%s,t=e}return t},[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]]),NO_HIT=(C33.getAspectRatio=function(s,n){if((s=Math.floor(s))===(n=Math.floor(n)))return[1,1];for(let t of COMMON_ASPECT_RATIOS){let e=s/t[0]*t[1];if(Math.abs(n-e)<1)return t.slice(0);if(e=s/t[1]*t[0],Math.abs(n-e)<1)return[t[1],t[0]]}let e=C33.greatestCommonDivisor(s,n);return[s/e,n/e]},C33.segmentsIntersect=function(e,t,s,n,i,r,a,o){const l=Math.min(e,s),h=Math.max(e,s),c=Math.min(i,a),u=Math.max(i,a);if(h<c||u<l)return!1;const d=Math.min(t,n),_=Math.max(t,n),p=Math.min(r,o),m=Math.max(r,o);if(_<p||m<d)return!1;const g=i-e+a-s,f=r-t+o-n,S=s-e,y=n-t,C=a-i,G=o-r,T=Math.abs(y*C-G*S),I=C*f-G*g;if(Math.abs(I)>T)return!1;const b=S*f-y*g;return Math.abs(b)<=T},C33.segmentsIntersectPreCalc=function(e,t,s,n,i,r,a,o,l,h,c,u){const d=Math.min(l,c),_=Math.max(l,c);if(r<d||_<i)return!1;const p=Math.min(h,u),m=Math.max(h,u);if(o<p||m<a)return!1;const g=l-e+c-s,f=h-t+u-n,S=s-e,y=n-t,C=c-l,G=u-h,T=Math.abs(y*C-G*S),I=C*f-G*g;if(Math.abs(I)>T)return!1;const b=S*f-y*g;return Math.abs(b)<=T},C33.segmentIntersectsQuad=function(e,t,s,n,i){const r=Math.min(e,s),a=Math.max(e,s),o=Math.min(t,n),l=Math.max(t,n),h=i.getTlx(),c=i.getTly(),u=i.getTrx(),d=i.getTry(),_=i.getBrx(),p=i.getBry(),m=i.getBlx(),g=i.getBly();return C33.segmentsIntersectPreCalc(e,t,s,n,r,a,o,l,h,c,u,d)||C33.segmentsIntersectPreCalc(e,t,s,n,r,a,o,l,u,d,_,p)||C33.segmentsIntersectPreCalc(e,t,s,n,r,a,o,l,_,p,m,g)||C33.segmentsIntersectPreCalc(e,t,s,n,r,a,o,l,m,g,h,c)},C33.segmentIntersectsAnyN=function(t,s,n,i,r){let a=Math.min(t,n),o=Math.max(t,n),l=Math.min(s,i),h=Math.max(s,i),c=0;for(let e=r.length-4;c<=e;c+=2)if(C33.segmentsIntersectPreCalc(t,s,n,i,a,o,l,h,r[c],r[c+1],r[c+2],r[c+3]))return!0;return C33.segmentsIntersectPreCalc(t,s,n,i,a,o,l,h,r[c],r[c+1],r[0],r[1])},2),PADDING=1e-6;C33.rayIntersect=function(e,t,s,n,i,r,a,o){const l=s-e,h=n-t,c=a-i,u=o-r,d=l*u-h*c;if(0==d)return NO_HIT;const _=((t-n)*(a-e)+l*(o-t))/d;return 0<_&&_<1+PADDING?(u*(a-e)+(i-a)*(o-t))/d:NO_HIT},C33.rayIntersectExtended=function(e,t,s,n,i,r,a,o,l){const h=(a-i)*l,c=(o-r)*l;return C33.rayIntersect(e,t,s,n,i-h,r-c,a+h,o+c)},C33.isPointInTriangleInclusive=function(e,t,s,n,i,r,a,o){const l=i-s,h=r-n,c=a-s,u=o-n,d=e-s,_=t-n,p=l*l+h*h,m=l*c+h*u,g=l*d+h*_,f=c*c+u*u,S=c*d+u*_,y=1/(p*f-m*m),C=(f*g-m*S)*y,G=(p*S-m*g)*y;return 0<=C&&0<=G&&C+G<=1},C33.triangleCartesianToBarycentric=function(e,t,s,n,i,r,a,o){const l=i-s,h=r-n,c=a-s,u=o-n,d=e-s,_=t-n,p=l*l+h*h,m=l*c+h*u,g=c*c+u*u,f=d*l+_*h,S=d*c+_*u,y=p*g-m*m,C=(g*f-m*S)/y,G=(p*S-m*f)/y,T=1-C-G;return[T,C,G]},C33.triangleBarycentricToCartesian3d=function(e,t,s,n,i,r,a,o,l,h,c,u){return[e*n+t*a+s*h,e*i+t*o+s*c,e*r+t*l+s*u]}}{let C33=self.C3,mainDocument=null,baseHref="";if("undefined"!=typeof document){const a=(mainDocument=document).querySelector("base");(baseHref=a&&a.hasAttribute("href")?a.getAttribute("href"):"")&&!(baseHref=baseHref.startsWith("/")?baseHref.substr(1):baseHref).endsWith("/")&&(baseHref+="/")}C33.GetBaseHref=function(){return baseHref},C33.GetBaseURL=function(){if(!mainDocument)return"";const e=mainDocument.location;return C33.GetPathFromURL(e.origin+e.pathname)+baseHref},C33.GetPathFromURL=function(e){if(!e.length)return e;if(e.endsWith("/")||e.endsWith("\\"))return e;const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?"":e.substr(0,t+1)},C33.GetFilenameFromURL=function(e){if(!e.length)return e;if(e.endsWith("/")||e.endsWith("\\"))return"";const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?e:e.substr(t+1)},C33.GetFileExtension=function(e){let t=e.lastIndexOf(".");return t<1?"":e.substr(t)},C33.SetFileExtension=function(e,t){const s=e.lastIndexOf(".");return-1===s?e+"."+t:e.substr(0,s+1)+t},C33.GetFileNamePart=function(e){let t=e.lastIndexOf(".");return t<1?e:e.substr(0,t)},C33.NormalizeFileSeparator=function(e){return e.replace(/\\/g,"/")},C33.IsFileExtension=function(e,t){const s=e?C33.GetFileExtension(e).slice(1):"";return t===s},C33.FileNameEquals=function(e,t){let s,n;return C33.IsFileLike(e)&&(s=C33.GetFileNamePart(e.name)),C33.IsString(e)&&(s=C33.GetFileNamePart(e)),C33.IsFileLike(t)&&(n=C33.GetFileNamePart(t.name)),C33.IsString(t)&&(n=C33.GetFileNamePart(t)),s===n},C33.ParseFilePath=function(e){e=C33.NormalizeFileSeparator(e);let t=/^\w\:\//.exec(e),s=(t?(t=t[0],"/"!==(e=e.slice(3))[0]&&(e="/"+e)):t="",(e=1<(e=e.replace(/\/{2,}/g,"/")).length&&"/"===e.slice(-1)?e.slice(0,-1):e).lastIndexOf("/")+1),n="",i=e,r,a="";0<s&&(n=e.slice(0,s),i=e.slice(s));const o=(r=i).lastIndexOf("."),l=(0<o&&(a=i.slice(o),r=i.slice(0,-a.length)),t+n+i);return{dir:n,base:i,name:r,root:t,ext:a,full:l}},C33.Wait=function(s,n){return new Promise((e,t)=>{self.setTimeout(e,s,n)})},C33.swallowException=function(e){try{e()}catch(e){C33.isDebug&&console.warn("Swallowed exception: ",e)}},C33.noop=function(){},C33.equalsNoCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize().toLowerCase()===t.normalize().toLowerCase())},C33.equalsCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize()===t.normalize())},C33.typedArraySet16=function(e,t,s){e[s++]=t[0],e[s++]=t[1],e[s++]=t[2],e[s++]=t[3],e[s++]=t[4],e[s++]=t[5],e[s++]=t[6],e[s++]=t[7],e[s++]=t[8],e[s++]=t[9],e[s++]=t[10],e[s++]=t[11],e[s++]=t[12],e[s++]=t[13],e[s++]=t[14],e[s]=t[15]},C33.truncateArray=function(e,t){e.length=t},C33.clearArray=function(e){e&&0!==e.length&&C33.truncateArray(e,0)},C33.clear2DArray=function(s){if(s){for(let t=0;t<s.length;t++){let e=s[t];C33.truncateArray(e,0)}C33.truncateArray(s,0)}},C33.extendArray=function(t,s,n){const i=t.length;if(!((s|=0)<=i))for(let e=i;e<s;++e)t.push(n)},C33.resizeArray=function(e,t,s){const n=e.length;(t|=0)<n?C33.truncateArray(e,t):n<t&&C33.extendArray(e,t,s)},C33.shallowAssignArray=function(e,t){C33.clearArray(e),C33.appendArray(e,t)},C33.appendArray=function(s,n){if(n.length<1e4)s.push(...n);else for(let e=0,t=n.length;e<t;++e)s.push(n[e])},C33.arrayRemove=function(s,n){if(!((n=Math.floor(n))<0||n>=s.length)){let t=s.length-1;for(let e=n;e<t;++e)s[e]=s[e+1];C33.truncateArray(s,t)}},C33.arrayFindRemove=function(e,t){let s=e.indexOf(t);0<=s&&e.splice(s,1)},C33.arraysEqual=function(t,s){let n=t.length;if(s.length!==n)return!1;for(let e=0;e<n;++e)if(t[e]!==s[e])return!1;return!0},C33.arrayFilterOut=function(s,n){let i=[],r=0;for(let t=0,e=s.length;t<e;++t){let e=s[t];n(e)?i.push(e):(s[r]=e,++r)}return C33.truncateArray(s,r),i},C33.arrayRemoveAllInSet=function(s,n){let e=s.length,i=0;for(let t=0,e=s.length;t<e;++t){let e=s[t];n.has(e)||(s[i++]=e)}return C33.truncateArray(s,i),e-i},C33.isArrayIndexInBounds=function(e,t){return e===Math.floor(e)&&0<=e&&e<t.length},C33.validateArrayIndex=function(e,t){if(!C33.isArrayIndexInBounds(e,t))throw new RangeError("array index out of bounds")},C33.cloneArray=function(e){return e.slice()},C33.deepCloneArray=function(e,s){let n=[];for(let t of e)if(C33.IsObject(t)){let e=s(t);if(!e)throw new Error("missing clone");if(e.constructor!==t.constructor)throw new Error("object is not a clone");n.push(e)}else C33.IsArray(t)?n.push(C33.deepCloneArray(t,s)):n.push(t);return n},C33.clone2DArray=function(t){let s=[];for(let e of t)s.push(e.slice());return s},C33.splitStringAndNormalize=function(e,t=" "){return e?e.split(t).map(e=>e.trim()).filter(e=>!!e):[]},C33.filterSet=function(e,t,s){const n=new Set;for(const i of e.values())t(i)&&(s?n.add(s(i)):n.add(i));return n},C33.mergeSets=function(e,t){return e.union?e.union(t):new Set([...e,...t])},C33.mergeSetsInPlace=function(e,t){for(const s of t)e.add(s);return e},C33.first=function(t){for(let e of t)return e;return null},C33.xor=function(e,t){return!e!=!t},C33.compare=function(e,t,s){switch(t){case 0:return e===s;case 1:return e!==s;case 2:return e<s;case 3:return e<=s;case 4:return s<e;case 5:return s<=e;default:return!1}},C33.hasAnyOwnProperty=function(t){for(let e in t)if(t.hasOwnProperty(e))return!0;return!1},C33.PromiseAllWithProgress=function(o,l){return o.length?new Promise((s,n)=>{let i=[],r=0,a=!1;for(let t=0,e=o.length;t<e;++t)i.push(void 0),o[t].then(e=>{a||(i[t]=e,++r===o.length?s(i):l(r,o.length))}).catch(e=>{a=!0,n(e)})}):Promise.resolve([])};let memoryCallbacks=[],nextTaskId=(C33.AddLibraryMemoryCallback=function(e){memoryCallbacks.push(e)},C33.GetEstimatedLibraryMemoryUsage=function(){let s=0;for(let t of memoryCallbacks){let e=t();s+=e}return Math.floor(s)},1),activeTaskIds=new Map,taskMessageChannel=new MessageChannel,activeRPAFids=(taskMessageChannel.port2.onmessage=function(e){const t=e.data,s=activeTaskIds.get(t);activeTaskIds.delete(t),s&&s(performance.now())},C33.RequestUnlimitedAnimationFrame=function(e){const t=nextTaskId++;return activeTaskIds.set(t,e),taskMessageChannel.port1.postMessage(t),t},C33.CancelUnlimitedAnimationFrame=function(e){activeTaskIds.delete(e)},C33.PostTask=C33.RequestUnlimitedAnimationFrame,C33.WaitForNextTask=function(){return new Promise(e=>C33.PostTask(e))},new Set);C33.RequestPostAnimationFrame=function(t){const s=self.requestAnimationFrame(async e=>{await C33.WaitForNextTask(),activeRPAFids.has(s)&&(activeRPAFids.delete(s),t(e))});return activeRPAFids.add(s),s},C33.CancelPostAnimationFrame=function(e){activeRPAFids.has(e)&&(self.cancelAnimationFrame(e),activeRPAFids.delete(e))}}{const C33=self.C3;C33.IsAbsoluteURL=function(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},C33.IsRelativeURL=function(e){return!C33.IsAbsoluteURL(e)},C33.ThrowIfNotOk=function(e){if(!e.ok)throw new Error(`fetch '${e.url}' response returned ${e.status} `+e.statusText)},C33.FetchOk=function(e,t){return fetch(e,t).then(e=>(C33.ThrowIfNotOk(e),e))},C33.FetchText=function(e){return C33.FetchOk(e).then(e=>e.text())},C33.FetchJson=function(e){return C33.FetchOk(e).then(e=>e.json())},C33.FetchBlob=function(e){return C33.FetchOk(e).then(e=>e.blob())},C33.FetchArrayBuffer=function(e){return C33.FetchOk(e).then(e=>e.arrayBuffer())},C33.FetchImage=function(n){return new Promise((e,t)=>{const s=new Image;s.onload=()=>e(s),s.onerror=e=>t(e),s.src=n})},C33.BlobToArrayBuffer=function(n){return"function"==typeof n.arrayBuffer?n.arrayBuffer():new Promise((e,t)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=()=>t(s.error),s.readAsArrayBuffer(n)})},C33.BlobToString=function(n){return"function"==typeof n.text?n.text():new Promise((e,t)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=()=>t(s.error),s.readAsText(n)})},C33.BlobToJson=function(e){return C33.BlobToString(e).then(e=>JSON.parse(e))},C33.BlobToImage=async function(e,t){let s=URL.createObjectURL(e);try{const n=await C33.FetchImage(s);return URL.revokeObjectURL(s),s="",t&&"function"==typeof n.decode&&await n.decode(),n}finally{s&&URL.revokeObjectURL(s)}},C33.CreateCanvas=function(e,t){if("undefined"==typeof document||"function"!=typeof document.createElement)return new OffscreenCanvas(e,t);{const s=document.createElement("canvas");return s.width=e,s.height=t,s}},C33.CanvasToBlob=function(t,s,n){if("number"!=typeof n&&(n=1),s=s||"image/png",n=C33.clamp(n,0,1),t.convertToBlob)return t.convertToBlob({type:s,quality:n});if(t.toBlob)return new Promise(e=>t.toBlob(e,s,n));throw new Error("could not convert canvas to blob")},C33.DrawableToBlob=function(e,t,s){const n=C33.CreateCanvas(e.width,e.height),i=n.getContext("2d");return i.drawImage(e,0,0),C33.CanvasToBlob(n,t,s)},C33.ImageDataToBlob=function(e,t,s){if(C33.Supports.ImageBitmapOptions)return createImageBitmap(e,{premultiplyAlpha:"none"}).then(e=>C33.DrawableToBlob(e,t,s));if(C33.Supports.ImageBitmap)return createImageBitmap(e).then(e=>C33.DrawableToBlob(e,t,s));{const n=C33.CreateCanvas(e.width,e.height),i=n.getContext("2d");return i.putImageData(e,0,0),C33.CanvasToBlob(n,t,s)}},C33.CopySet=function(e,t){e.clear();for(const s of t)e.add(s)},C33.MapToObject=function(e){const t=Object.create(null);for(const[s,n]of e.entries())t[s]=n;return t},C33.ObjectToMap=function(e,t){t.clear();for(const[s,n]of Object.entries(e))t.set(s,n)},C33.ToSuperJSON=function t(e){if("object"!=typeof e||null===e)return e;if(e instanceof Set)return{_c3type_:"set",data:[...e].map(e=>t(e))};if(e instanceof Map)return{_c3type_:"map",data:[...e].map(e=>[e[0],t(e[1])])};{const s=Object.create(null);for(const[n,i]of Object.entries(e))s[n]=t(i);return s}},C33.FromSuperJSON=function t(e){if("object"==typeof e&null!==e){if("set"===e._c3type_)return new Set(e.data.map(e=>t(e)));if("map"===e._c3type_)return new Map(e.data.map(e=>[e[0],t(e[1])]));{const s=Object.create(null);for(const[n,i]of Object.entries(e))s[n]=t(i);return s}}return e},C33.CSSToCamelCase=function(e){if(e.startsWith("--"))return e;let t="",s=!1,n=0;for(const i of e)"-"===i?0<n&&(s=!0):s?(t+=i.toUpperCase(),s=!1):t+=i,++n;return t},C33.IsIterator=function(e){return"object"==typeof e&&"function"==typeof e.next},C33.MakeFilledArray=function(t,s){const n=[];if("function"==typeof s)for(let e=0;e<t;++e)n.push(s());else for(let e=0;e<t;++e)n.push(s);return n}}{let padTwoDigits2=function(e){return 0===e.length?"00":1===e.length?"0"+e:e},hueToRGB2=function(e,t,s){return s<0&&(s+=1),1<s&&--s,s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e};padTwoDigits=padTwoDigits2,hueToRGB=hueToRGB2;const C33=self.C3,HSL_TEST=/([0-9.]+),([0-9.]+)\%?,([0-9.]+)\%?/i,HSLA_TEST=/([0-9.]+),([0-9.]+)\%?,([0-9.]+)\%?,([0-9.])/i;C33.Color=class{constructor(e,t,s,n){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,this._r=0,this._g=0,this._b=0,this._a=0,e instanceof C33.Color?this.set(e):this.setRgba(e||0,t||0,s||0,n||0)}setRgb(e,t,s){return this._r=+e,this._g=+t,this._b=+s,this.clamp(),this}setRgba(e,t,s,n){return this._r=+e,this._g=+t,this._b=+s,this._a=+n,this.clamp(),this}set(e){return this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a,this}copy(e){return this.set(e)}add(e){this._r+=e._r,this._g+=e._g,this._b+=e._b,this._a+=e._a,this.clamp()}addRgb(e,t,s,n=0){this._r+=+e,this._g+=+t,this._b+=+s,this._a+=+n,this.clamp()}diff(e){this.setR(Math.max(this._r,e._r)-Math.min(this._r,e._r)),this.setG(Math.max(this._g,e._g)-Math.min(this._g,e._g)),this.setB(Math.max(this._b,e._b)-Math.min(this._b,e._b)),this.setA(Math.max(this._a,e._a)-Math.min(this._a,e._a)),this.clamp()}copyRgb(e){this._r=e._r,this._g=e._g,this._b=e._b}setR(e){this._r=C33.clamp(+e,0,1)}getR(){return this._r}setG(e){this._g=C33.clamp(+e,0,1)}getG(){return this._g}setB(e){this._b=C33.clamp(+e,0,1)}getB(){return this._b}setA(e){this._a=C33.clamp(+e,0,1)}getA(){return this._a}clone(){return C33.New(C33.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t++]=this._b,e[t]=this._a}writeRGBToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t]=this._b}equals(e){return this._r===e._r&&this._g===e._g&&this._b===e._b&&this._a===e._a}equalsIgnoringAlpha(e){return this._r===e._r&&this._g===e._g&&this._b===e._b}equalsRgb(e,t,s){return this._r===e&&this._g===t&&this._b===s}equalsRgba(e,t,s,n){return this._r===e&&this._g===t&&this._b===s&&this._a===n}equalsF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)&&e[t+3]===Math.fround(this._a)}equalsRGBF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)}multiply(e){this._r*=e._r,this._g*=e._g,this._b*=e._b,this._a*=e._a}multiplyAlpha(e){this._r*=e,this._g*=e,this._b*=e,this._a*=e}premultiply(){return this._r*=this._a,this._g*=this._a,this._b*=this._a,this}unpremultiply(){return this._r/=this._a,this._g/=this._a,this._b/=this._a,this}clamp(){return this._r=C33.clamp(this._r,0,1),this._g=C33.clamp(this._g,0,1),this._b=C33.clamp(this._b,0,1),this._a=C33.clamp(this._a,0,1),this}setFromRgbValue(e){this._r=C33.GetRValue(e),this._g=C33.GetGValue(e),this._b=C33.GetBValue(e),this._a=C33.GetAValue(e)}getCssRgb(e,t,s){const n=C33.IsFiniteNumber(e)?e:this.getR(),i=C33.IsFiniteNumber(t)?t:this.getG(),r=C33.IsFiniteNumber(s)?s:this.getB();return`rgb(${100*n}%, ${100*i}%, ${100*r}%)`}getCssRgba(e,t,s,n){const i=C33.IsFiniteNumber(e)?e:this.getR(),r=C33.IsFiniteNumber(t)?t:this.getG(),a=C33.IsFiniteNumber(s)?s:this.getB(),o=C33.IsFiniteNumber(n)?n:this.getA();return`rgba(${100*i}%, ${100*r}%, ${100*a}%, ${o})`}toHexString(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return"#"+padTwoDigits2(e.toString(16))+padTwoDigits2(t.toString(16))+padTwoDigits2(s.toString(16))}parseHexString(e){if("string"!=typeof e)return!1;let t,s,n;if(3===(e="#"===(e=e.trim()).charAt(0)?e.substr(1):e).length)t=parseInt(e[0],16)/15,s=parseInt(e[1],16)/15,n=parseInt(e[2],16)/15;else{if(6!==e.length)return!1;t=parseInt(e.substr(0,2),16)/255,s=parseInt(e.substr(2,2),16)/255,n=parseInt(e.substr(4,2),16)/255}return isFinite(t)&&this.setR(t),isFinite(s)&&this.setG(s),isFinite(n)&&this.setB(n),this.setA(1),!0}toCommaSeparatedRgb(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return e+`, ${t}, `+s}toRgbArray(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return[e,t,s]}parseCommaSeparatedRgb(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgb\(|\)|%/,"")).split(",");if(t.length<3)return!1;const s=parseInt(t[0].trim(),10)/255,n=parseInt(t[1].trim(),10)/255,i=parseInt(t[2].trim(),10)/255;return isFinite(s)&&this.setR(s),isFinite(n)&&this.setG(n),isFinite(i)&&this.setB(i),this.setA(1),!0}parseCommaSeparatedPercentageRgb(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgb\(|\)|%/,"")).split(",");if(t.length<3)return!1;const s=parseInt(t[0].trim(),10)/100,n=parseInt(t[1].trim(),10)/100,i=parseInt(t[2].trim(),10)/100;return isFinite(s)&&this.setR(s),isFinite(n)&&this.setG(n),isFinite(i)&&this.setB(i),this.setA(1),!0}parseCommaSeparatedRgba(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgba\(|\)|%/,"")).split(",");if(t.length<4)return!1;const s=parseInt(t[0].trim(),10)/255,n=parseInt(t[1].trim(),10)/255,i=parseInt(t[2].trim(),10)/255,r=parseFloat(t[3].trim());return isFinite(s)&&this.setR(s),isFinite(n)&&this.setG(n),isFinite(i)&&this.setB(i),isFinite(r)&&this.setA(r),!0}parseCommaSeparatedPercentageRgba(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgba\(|\)|%/,"")).split(",");if(t.length<4)return!1;const s=parseInt(t[0].trim(),10)/100,n=parseInt(t[1].trim(),10)/100,i=parseInt(t[2].trim(),10)/100,r=parseFloat(t[3].trim());return isFinite(s)&&this.setR(s),isFinite(n)&&this.setG(n),isFinite(i)&&this.setB(i),isFinite(r)&&this.setA(r),!0}parseString(e){if("string"!=typeof e)return!1;if((e=e.replace(/\s+/,"")).includes(",")){if(e.startsWith("rgb("))return e.includes("%")?this.parseCommaSeparatedPercentageRgb(e):this.parseCommaSeparatedRgb(e);if(e.startsWith("rgba("))return e.includes("%")?this.parseCommaSeparatedPercentageRgba(e):this.parseCommaSeparatedRgba(e);if(e.startsWith("hsl(")||e.startsWith("hsla("))return this.parseHSLString(e);{const t=e.split(",");return e.includes("%")?3===t.length?this.parseCommaSeparatedPercentageRgb(e):4===t.length&&this.parseCommaSeparatedPercentageRgba(e):3===t.length?this.parseCommaSeparatedRgb(e):4===t.length&&this.parseCommaSeparatedRgba(e)}}return this.parseHexString(e)}toJSON(){return[this._r,this._g,this._b,this._a]}setFromHSLA(e,t,s,n){let i,r,a;if(e%=360,t=C33.clamp(t,0,100),s=C33.clamp(s,0,100),n=C33.clamp(n,0,1),e/=360,s/=100,0==(t/=100))i=r=a=s;else{const o=s<.5?s*(1+t):s+t-s*t,l=2*s-o;i=hueToRGB2(l,o,e+1/3),r=hueToRGB2(l,o,e),a=hueToRGB2(l,o,e-1/3)}return this.setR(i),this.setG(r),this.setB(a),this.setA(n),this}parseHSLString(e){const t=e.replace(/ |hsl|hsla|\(|\)|;/gi,""),s=HSL_TEST.exec(t),n=HSLA_TEST.exec(t);return s&&4===s.length?(this.setFromHSLA(+s[1],+s[2],+s[3],1),!0):!(!n||5!==n.length||(this.setFromHSLA(+s[1],+s[2],+s[3],+s[4]),0))}toHSLAString(){const e=this._r,t=this._g,s=this._b,n=this._a,i=C33.Color.GetHue(e,t,s),r=C33.Color.GetSaturation(e,t,s),a=C33.Color.GetLuminosity(e,t,s);return`hsla(${i}, ${r}%, ${a}%, ${n})`}toHSLAArray(){const e=this._r,t=this._g,s=this._b;return[C33.Color.GetHue(e,t,s),C33.Color.GetSaturation(e,t,s),C33.Color.GetLuminosity(e,t,s),this._a]}setFromJSON(e){!Array.isArray(e)||e.length<3||(this._r=e[0],this._g=e[1],this._b=e[2],this._a=4<=e.length?e[3]:1)}set r(e){this.setR(e)}get r(){return this.getR()}set g(e){this.setG(e)}get g(){return this.getG()}set b(e){this.setB(e)}get b(){return this.getB()}set a(e){this.setA(e)}get a(){return this.getA()}setAtIndex(e,t){switch(e){case 0:this.setR(t);break;case 1:this.setG(t);break;case 2:this.setB(t);break;case 3:this.setA(t);break;default:throw new RangeError("invalid color index")}}getAtIndex(e){switch(e){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index")}}static Equals(e,t){let s,n;if(Array.isArray(e))(s=new C33.Color).setFromJSON(e);else{if(!(e instanceof C33.Color))throw new Error("unexpected type");s=e}if(Array.isArray(t))(n=new C33.Color).setFromJSON(t);else{if(!(t instanceof C33.Color))throw new Error("unexpected type");n=t}return s.equals(n)}static DiffChannel(e,t){return C33.clamp(Math.max(e,t)-Math.min(e,t),0,1)}static Diff(e,t){const s=new C33.Color;return s.setR(Math.max(e._r,t._r)-Math.min(e._r,t._r)),s.setG(Math.max(e._g,t._g)-Math.min(e._g,t._g)),s.setB(Math.max(e._b,t._b)-Math.min(e._b,t._b)),s.setA(Math.max(e._a,t._a)-Math.min(e._a,t._a)),s}static DiffNoAlpha(e,t){const s=new C33.Color(0,0,0,1);return s.setR(Math.max(e._r,t._r)-Math.min(e._r,t._r)),s.setG(Math.max(e._g,t._g)-Math.min(e._g,t._g)),s.setB(Math.max(e._b,t._b)-Math.min(e._b,t._b)),s}static GetHue(e,t,s){const n=Math.max(e,t,s),i=Math.min(e,t,s);if(n===i)return 0;let r=0;switch(n){case e:r=(t-s)/(n-i)+(t<s?6:0);break;case t:r=(s-e)/(n-i)+2;break;case s:r=(e-t)/(n-i)+4}return Math.round(r/6*360)}static GetSaturation(e,t,s){const n=Math.max(e,t,s),i=Math.min(e,t,s);if(n===i)return 0;const r=(n+i)/2,a=n-i,o=.5<r?a/(2-n-i):a/(n+i);return Math.round(100*o)}static GetLuminosity(e,t,s){const n=Math.max(e,t,s),i=Math.min(e,t,s),r=(n+i)/2;return n?Math.round(100*r):0}},C33.Color.White=Object.freeze(C33.New(C33.Color,1,1,1,1)),C33.Color.Black=Object.freeze(C33.New(C33.Color,0,0,0,1)),C33.Color.TransparentBlack=Object.freeze(C33.New(C33.Color,0,0,0,0))}{const C33=self.C3;C33.Vector2=class{constructor(e,t){this._x=0,this._y=0,e instanceof C33.Vector2?this.copy(e):this.set(e||0,t||0)}set(e,t){this._x=+e,this._y=+t}copy(e){this._x=e._x,this._y=e._y}equals(e){return this._x===e._x&&this._y===e._y}equalsValues(e,t){return this._x===e&&this._y===t}equalsF32Array(e,t){return e[t]===Math.fround(this._x)&&e[t+1]===Math.fround(this._y)}setX(e){this._x=+e}getX(){return this._x}setY(e){this._y=+e}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._x,e[t]=this._y}offset(e,t){this._x+=+e,this._y+=+t}scale(e,t){this._x*=e,this._y*=t}divide(e,t){this._x/=e,this._y/=t}round(){this._x=Math.round(this._x),this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x),this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x),this._y=Math.ceil(this._y)}angle(){return C33.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.hypot(this._x,this._y)}rotatePrecalc(e,t){const s=this._x*t-this._y*e;this._y=this._y*t+this._x*e,this._x=s}rotate(e){0!==e&&this.rotatePrecalc(Math.sin(e),Math.cos(e))}rotateAbout(e,t,s){0===e||t===this._x&&s===this._y||(this._x-=t,this._y-=s,this.rotatePrecalc(Math.sin(e),Math.cos(e)),this._x+=+t,this._y+=+s)}move(e,t){0!==t&&(this._x+=Math.cos(e)*t,this._y+=Math.sin(e)*t)}normalize(){const e=this.length();0!==e&&1!==e&&(this._x/=e,this._y/=e)}clamp(e,t){this._x=C33.clamp(this._x,e,t),this._y=C33.clamp(this._y,e,t)}dot(e){return this._x*e._x+this._y*e._y}reverse(){this._x=-this._x,this._y=-this._y}perp(){let e=this._x;return this._x=this._y,this._y=-e,this}}}{const C33=self.C3;C33.Rect=class{constructor(e,t,s,n){this._left=NaN,this._top=NaN,this._right=NaN,this._bottom=NaN,this._left=0,this._top=0,this._right=0,this._bottom=0,e instanceof C33.Rect?this.copy(e):this.set(e||0,t||0,s||0,n||0)}set(e,t,s,n){this._left=+e,this._top=+t,this._right=+s,this._bottom=+n}setWH(e,t,s,n){t=+t,this._left=e=+e,this._top=t,this._right=e+ +s,this._bottom=t+ +n}copy(e){this._left=+e._left,this._top=+e._top,this._right=+e._right,this._bottom=+e._bottom}clone(){return new C33.Rect(this._left,this._top,this._right,this._bottom)}static Merge(e,t){const s=new C33.Rect;return s.setLeft(Math.min(e._left,t._left)),s.setTop(Math.min(e._top,t._top)),s.setRight(Math.max(e._right,t._right)),s.setBottom(Math.max(e._bottom,t._bottom)),s}static FromObject(e){return new C33.Rect(e.left,e.top,e.right,e.bottom)}equals(e){return this._left===e._left&&this._top===e._top&&this._right===e._right&&this._bottom===e._bottom}equalsWH(e,t,s,n){return this._left===e&&this._top===t&&this.width()===s&&this.height()===n}equalsF32Array(e,t){return e[t]===Math.fround(this._left)&&e[t+1]===Math.fround(this._top)&&e[t+2]===Math.fround(this._right)&&e[t+3]===Math.fround(this._bottom)}setLeft(e){this._left=+e}getLeft(){return this._left}setTop(e){this._top=+e}getTop(){return this._top}setRight(e){this._right=+e}getRight(){return this._right}setBottom(e){this._bottom=+e}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height())}static fromDOMRect(e){return C33.New(C33.Rect,e.left,e.top,e.right,e.bottom)}writeToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t]=this._bottom}writeAsQuadToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t++]=this._top,e[t++]=this._right,e[t++]=this._bottom,e[t++]=this._left,e[t]=this._bottom}writeAsQuadToTypedArray3D(e,t,s){e[t++]=this._left,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._bottom,e[t++]=s,e[t++]=this._left,e[t++]=this._bottom,e[t]=s}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+this._bottom)/2}offset(e,t){t=+t,this._left+=e=+e,this._top+=t,this._right+=e,this._bottom+=t}offsetLeft(e){this._left+=+e}offsetTop(e){this._top+=+e}offsetRight(e){this._right+=+e}offsetBottom(e){this._bottom+=+e}toSquare(e){if("x"!==e)throw new Error("invalid axis, only 'x' supported");this._top<this._bottom?this._left<this._right?this._bottom=this._top+this.width():this._bottom=this._top-this.width():this._left<this._right?this._bottom=this._top-this.width():this._bottom=this._top+this.width()}inflate(e,t){t=+t,this._left-=e=+e,this._top-=t,this._right+=e,this._bottom+=t}deflate(e,t){t=+t,this._left+=e=+e,this._top+=t,this._right-=e,this._bottom-=t}multiply(e,t){this._left*=e,this._top*=t,this._right*=e,this._bottom*=t}divide(e,t){this._left/=e,this._top/=t,this._right/=e,this._bottom/=t}mirrorAround(e){this._left=+e-this._left,this._right=+e-this._right}flipAround(e){this._top=+e-this._top,this._bottom=+e-this._bottom}rotate90DegreesAround(e,t){const s=this.width(),n=this.height(),i=this.getLeft()+s*e,r=this.getTop()+n*t;this.setWH(i-n*t,r-s*e,n,s)}swapLeftRight(){const e=this._left;this._left=this._right,this._right=e}swapTopBottom(){const e=this._top;this._top=this._bottom,this._bottom=e}shuntY(e){const t=this._top;this._top=+e-this._bottom,this._bottom=+e-t}round(){this._left=Math.round(this._left),this._top=Math.round(this._top),this._right=Math.round(this._right),this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}ceil(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}clamp(e,t,s,n){this._left=Math.max(this._left,+e),this._top=Math.max(this._top,+t),this._right=Math.min(this._right,+s),this._bottom=Math.min(this._bottom,+n)}clampBoth(e,t,s,n){e=+e,t=+t,s=+s,n=+n,this._left=C33.clamp(this._left,e,s),this._top=C33.clamp(this._top,t,n),this._right=C33.clamp(this._right,e,s),this._bottom=C33.clamp(this._bottom,t,n)}normalize(){this._left>this._right&&this.swapLeftRight(),this._top>this._bottom&&this.swapTopBottom()}intersectsRect(e){return!(e._right<this._left||e._bottom<this._top||e._left>this._right||e._top>this._bottom)}intersectsRectOffset(e,t,s){return!(e._right+t<this._left||e._bottom+s<this._top||e._left+t>this._right||e._top+s>this._bottom)}containsPoint(e,t){return e>=this._left&&e<=this._right&&t>=this._top&&t<=this._bottom}containsRect(e){return e._left>=this._left&&e._top>=this._top&&e._right<=this._right&&e._bottom<=this._bottom}expandToContain(e){e._left<this._left&&(this._left=+e._left),e._top<this._top&&(this._top=+e._top),e._right>this._right&&(this._right=+e._right),e._bottom>this._bottom&&(this._bottom=+e._bottom)}lerpInto(e){this._left=C33.lerp(e._left,e._right,this._left),this._top=C33.lerp(e._top,e._bottom,this._top),this._right=C33.lerp(e._left,e._right,this._right),this._bottom=C33.lerp(e._top,e._bottom,this._bottom)}}}{const C33=self.C3;C33.Quad=class{constructor(e,t,s,n,i,r,a,o){this._tlx=NaN,this._tly=NaN,this._trx=NaN,this._try=NaN,this._brx=NaN,this._bry=NaN,this._blx=NaN,this._bly=NaN,this._tlx=0,this._tly=0,this._trx=0,this._try=0,this._brx=0,this._bry=0,this._blx=0,this._bly=0,e instanceof C33.Quad?this.copy(e):this.set(e||0,t||0,s||0,n||0,i||0,r||0,a||0,o||0)}set(e,t,s,n,i,r,a,o){this._tlx=+e,this._tly=+t,this._trx=+s,this._try=+n,this._brx=+i,this._bry=+r,this._blx=+a,this._bly=+o}setRect(e,t,s,n){this.set(e,t,s,t,s,n,e,n)}copy(e){this._tlx=e._tlx,this._tly=e._tly,this._trx=e._trx,this._try=e._try,this._brx=e._brx,this._bry=e._bry,this._blx=e._blx,this._bly=e._bly}equals(e){return this._tlx===e._tlx&&this._tly===e._tly&&this._trx===e._trx&&this._try===e._try&&this._brx===e._brx&&this._bry===e._bry&&this._blx===e._blx&&this._bly===e._bly}setTlx(e){this._tlx=+e}getTlx(){return this._tlx}setTly(e){this._tly=+e}getTly(){return this._tly}setTrx(e){this._trx=+e}getTrx(){return this._trx}setTry(e){this._try=+e}getTry(){return this._try}setBrx(e){this._brx=+e}getBrx(){return this._brx}setBry(e){this._bry=+e}getBry(){return this._bry}setBlx(e){this._blx=+e}getBlx(){return this._blx}setBly(e){this._bly=+e}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}static fromDOMQuad(e){return C33.New(C33.Quad,e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y,e.p4.x,e.p4.y)}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=this._trx,e[t++]=this._try,e[t++]=this._brx,e[t++]=this._bry,e[t++]=this._blx,e[t]=this._bly}writeToTypedArray3D(e,t,s){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=s,e[t++]=this._trx,e[t++]=this._try,e[t++]=s,e[t++]=this._brx,e[t++]=this._bry,e[t++]=s,e[t++]=this._blx,e[t++]=this._bly,e[t]=s}offset(e,t){t=+t,this._tlx+=e=+e,this._tly+=t,this._trx+=e,this._try+=t,this._brx+=e,this._bry+=t,this._blx+=e,this._bly+=t}round(){this._tlx=Math.round(this._tlx),this._tly=Math.round(this._tly),this._trx=Math.round(this._trx),this._try=Math.round(this._try),this._brx=Math.round(this._brx),this._bry=Math.round(this._bry),this._blx=Math.round(this._blx),this._bly=Math.round(this._bly)}floor(){this._tlx=Math.floor(this._tlx),this._tly=Math.floor(this._tly),this._trx=Math.floor(this._trx),this._try=Math.floor(this._try),this._brx=Math.floor(this._brx),this._bry=Math.floor(this._bry),this._blx=Math.floor(this._blx),this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx),this._tly=Math.ceil(this._tly),this._trx=Math.ceil(this._trx),this._try=Math.ceil(this._try),this._brx=Math.ceil(this._brx),this._bry=Math.ceil(this._bry),this._blx=Math.ceil(this._blx),this._bly=Math.ceil(this._bly)}setFromRect(e){this._tlx=e._left,this._tly=e._top,this._trx=e._right,this._try=e._top,this._brx=e._right,this._bry=e._bottom,this._blx=e._left,this._bly=e._bottom}setFromRotatedRect(e,t){0===t?this.setFromRect(e):this.setFromRotatedRectPrecalc(e,Math.sin(t),Math.cos(t))}setFromRotatedRectPrecalc(e,t,s){const n=e._left*t,i=e._top*t,r=e._right*t,a=e._bottom*t,o=e._left*s,l=e._top*s,h=e._right*s,c=e._bottom*s;this._tlx=o-i,this._tly=l+n,this._trx=h-i,this._try=l+r,this._brx=h-a,this._bry=c+r,this._blx=o-a,this._bly=c+n}getBoundingBox(e){e.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(e,t){let s=this._trx-this._tlx,n=this._try-this._tly,i=this._brx-this._tlx,r=this._bry-this._tly,a=e-this._tlx,o=t-this._tly,l=s*s+n*n,h=s*i+n*r,c=s*a+n*o,u=i*i+r*r,d=i*a+r*o,_=1/(l*u-h*h),p=(u*c-h*d)*_,m=(l*d-h*c)*_;return 0<=p&&0<m&&p+m<1||(m=((l=(s=this._blx-this._tlx)*s+(n=this._bly-this._tly)*n)*d-(h=s*i+n*r)*(c=s*a+n*o))*(_=1/(l*u-h*h)),0<=(p=(u*c-h*d)*_)&&0<m&&p+m<1)}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(e,t,s,n){return!(!this.containsPoint(e,t)&&!this.containsPoint(s,n))||C33.segmentIntersectsQuad(e,t,s,n,this)}intersectsQuad(e){let t=e.midX(),s=e.midY();if(this.containsPoint(t,s))return!0;if(t=this.midX(),s=this.midY(),e.containsPoint(t,s))return!0;const n=this._tlx,i=this._tly,r=this._trx,a=this._try,o=this._brx,l=this._bry,h=this._blx,c=this._bly;return C33.segmentIntersectsQuad(n,i,r,a,e)||C33.segmentIntersectsQuad(r,a,o,l,e)||C33.segmentIntersectsQuad(o,l,h,c,e)||C33.segmentIntersectsQuad(h,c,n,i,e)}rotatePointsAnticlockwise(){const e=this._tlx,t=this._tly;this._tlx=this._trx,this._tly=this._try,this._trx=this._brx,this._try=this._bry,this._brx=this._blx,this._bry=this._bly,this._blx=e,this._bly=t}mirror(){this._swap(0,2),this._swap(1,3),this._swap(6,4),this._swap(7,5)}flip(){this._swap(0,6),this._swap(1,7),this._swap(2,4),this._swap(3,5)}diag(){this._swap(2,6),this._swap(3,7)}_swap(e,t){const s=this._getAtIndex(e);this._setAtIndex(e,this._getAtIndex(t)),this._setAtIndex(t,s)}_getAtIndex(e){switch(e){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index")}}_setAtIndex(e,t){switch(t=+t,e){case 0:this._tlx=t;break;case 1:this._tly=t;break;case 2:this._trx=t;break;case 3:this._try=t;break;case 4:this._brx=t;break;case 5:this._bry=t;break;case 6:this._blx=t;break;case 7:this._bly=t;break;default:throw new RangeError("invalid quad point index")}}}}{const C33=self.C3,assert=self.assert,DEFAULT_POLY_POINTS=[0,0,1,0,1,1,0,1],tempQuad=C33.New(C33.Quad);C33.CollisionPoly=class extends C33.DefendedBase{constructor(e,t=!0){super(),e=e||DEFAULT_POLY_POINTS,this._ptsArr=Float64Array.from(e),this._bbox=new C33.Rect,this._isBboxChanged=!0,this._enabled=t}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(e){this._ptsArr.length===e.length?this._ptsArr.set(e):this._ptsArr=Float64Array.from(e),this._isBboxChanged=!0}setDefaultPoints(){this.setPoints(DEFAULT_POLY_POINTS)}copy(e){this.setPoints(e._ptsArr)}setBboxChanged(){this._isBboxChanged=!0}_updateBbox(){if(this._isBboxChanged){let s=this._ptsArr,n=s[0],i=s[1],r=n,a=i;for(let e=0,t=s.length;e<t;e+=2){const o=s[e],l=s[e+1];o<n&&(n=o),o>r&&(r=o),l<i&&(i=l),l>a&&(a=l)}this._bbox.set(n,i,r,a),this._isBboxChanged=!1}}setFromRect(e,t,s){let n=this._ptsArr;8!==n.length&&(n=new Float64Array(8),this._ptsArr=n),n[0]=e.getLeft()-t,n[1]=e.getTop()-s,n[2]=e.getRight()-t,n[3]=e.getTop()-s,n[4]=e.getRight()-t,n[5]=e.getBottom()-s,n[6]=e.getLeft()-t,n[7]=e.getBottom()-s,this._bbox.copy(e),0===t&&0===s||this._bbox.offset(-t,-s),this._isBboxChanged=!1}setFromQuad(e,t,s){tempQuad.copy(e),tempQuad.offset(t,s),this.setPoints(tempQuad.toArray()),this._isBboxChanged=!0}transform(e,t,s){let n=0,i=1;0!==s&&(n=Math.sin(s),i=Math.cos(s)),this.transformPrecalc(e,t,n,i)}transformPrecalc(s,n,i,r){const a=this._ptsArr;for(let e=0,t=a.length;e<t;e+=2){const o=e+1,l=a[e]*s,h=a[o]*n;a[e]=l*r-h*i,a[o]=h*r+l*i}this._isBboxChanged=!0}offset(s,n){const i=this._ptsArr;for(let e=0,t=i.length;e<t;e+=2)i[e]+=s,i[e+1]+=n}containsPoint(s,n){const i=this._ptsArr;if(s===i[0]&&n===i[1])return!0;this._updateBbox();let e=this._bbox,r=e.getLeft()-110,a=e.getTop()-101,o=e.getRight()+131,l=e.getBottom()+120,h=0,c=0,u,d,_=0,p=0,m,g,f=(u=r<s?(h=r,s):(h=s,r),d=a<n?(c=a,n):(c=n,a),m=o<s?(_=o,s):(_=s,o),g=l<n?(p=l,n):(p=n,l),0),S=0;for(let e=0,t=i.length;e<t;e+=2){const y=(e+2)%t,C=i[e],G=i[e+1],T=i[y],I=i[1+y];C33.segmentsIntersectPreCalc(r,a,s,n,h,u,c,d,C,G,T,I)&&++f,C33.segmentsIntersectPreCalc(o,l,s,n,_,m,p,g,C,G,T,I)&&++S}return f%2==1||S%2==1}intersectsPoly(e,u,d){const _=e._ptsArr,p=this._ptsArr;if(this.containsPoint(_[0]+u,_[1]+d))return!0;if(e.containsPoint(p[0]-u,p[1]-d))return!0;for(let t=0,c=p.length;t<c;t+=2){let e=(t+2)%c,s=p[t],n=p[t+1],i=p[e],r=p[1+e],a=0,o=0,l,h;l=s<i?(a=s,i):(a=i,s),h=n<r?(o=n,r):(o=r,n);for(let e=0,t=_.length;e<t;e+=2){const m=(e+2)%t,g=_[e]+u,f=_[e+1]+d,S=_[m]+u,y=_[1+m]+d;if(C33.segmentsIntersectPreCalc(s,n,i,r,a,l,o,h,g,f,S,y))return!0}}return!1}intersectsSegment(s,n,i,r,a,o){if(this.containsPoint(i-s,r-n))return!0;if(this.containsPoint(a-s,o-n))return!0;let l=0,h=0,c,u;c=i<a?(l=i,a):(l=a,i),u=r<o?(h=r,o):(h=o,r);const d=this._ptsArr;for(let e=0,t=d.length;e<t;e+=2){const _=(e+2)%t,p=d[e]+s,m=d[e+1]+n,g=d[_]+s,f=d[1+_]+n;if(C33.segmentsIntersectPreCalc(i,r,a,o,l,c,h,u,p,m,g,f))return!0}return!1}mirror(s){const n=this._ptsArr;for(let e=0,t=n.length;e<t;e+=2)n[e]=2*s-n[e];this._isBboxChanged=!0}flip(s){const n=this._ptsArr;for(let e=0,t=n.length;e<t;e+=2){const i=e+1;n[i]=2*s-n[i]}this._isBboxChanged=!0}diag(){const s=this._ptsArr;for(let e=0,t=s.length;e<t;e+=2){const n=e+1,i=s[e];s[e]=s[n],s[n]=i}this._isBboxChanged=!0}GetMidX(){let s=this._ptsArr,n=0;for(let e=0,t=s.length;e<t;e+=2)n+=s[e];return n/this.pointCount()}GetMidY(){let s=this._ptsArr,n=0;for(let e=0,t=s.length;e<t;e+=2)n+=s[e+1];return n/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}}}{const C33=self.C3;C33.PairMap=class extends C33.DefendedBase{constructor(e){if(super(),this._firstMap=new Map,e)for(const[t,s,n]of e)this.Set(t,s,n)}Release(){this.Clear(),this._firstMap=null}IsEmpty(){return 0===this._firstMap.size}Clear(){const e=this._firstMap;for(const t of e.values())t.clear();e.clear()}Set(e,t,s){let n=this._firstMap,i=n.get(e);i||(i=new Map,n.set(e,i)),i.set(t,s)}Get(e,t){const s=this._firstMap.get(e);return s&&s.get(t)}Has(e,t){const s=this._firstMap.get(e);return!!s&&s.has(t)}Delete(e,t){const s=this._firstMap,n=s.get(e);if(!n)return!1;const i=n.delete(t);return i&&0===n.size&&s.delete(e),i}DeleteEither(e){const t=this._firstMap,s=t.get(e);s&&(s.clear(),t.delete(e));for(const[n,i]of t.entries())i.delete(e)&&0===i.size&&t.delete(n)}GetSize(){let e=0;for(const t of this._firstMap.values())e+=t.size;return e}*values(){for(const e of this._firstMap.values())yield*e.values()}*keyPairs(){for(const[e,t]of this._firstMap.entries())for(const s of t.keys())yield[e,s]}*entries(){for(const[e,t]of this._firstMap.entries())for(const[s,n]of t.entries())yield[e,s,n]}}}{const C33=self.C3;C33.ArraySet=class extends C33.DefendedBase{constructor(){super(),this._set=new Set,this._arr=[],this._needToRebuildArray=!1}Release(){this.Clear()}Clear(){this._set.clear(),C33.clearArray(this._arr),this._needToRebuildArray=!1}Add(e){this._set.has(e)||(this._set.add(e),this._needToRebuildArray)||this._arr.push(e)}Has(e){return this._set.has(e)}Delete(e){this._set.delete(e)&&(this._needToRebuildArray=!0)}GetSize(){return this._set.size}IsEmpty(){return 0===this._set.size}GetArray(){return this._needToRebuildArray&&(this._RebuildArray(),this._needToRebuildArray=!1),this._arr}_RebuildArray(){const e=this._arr;C33.clearArray(e);for(const t of this._set)e.push(t)}}}{const C33=self.C3,EASE_MAP=new Map,PREDEFINED_EASE_MAP=new Map,CUSTOM_EASE_EDITOR_MAP=new Map,CUSTOM_EASE_DATA_EDITOR_MAP=new Map,CUSTOM_EASE_RUNTIME_MAP=new Map,CUSTOM_EASE_DATA_RUNTIME_MAP=new Map,PRIVATE_EASE_MAP=new Map,BUILT_IN_TRANSITION_MAP=new Map,ALIAS_MAP=new Map,EASE_TRANSLATION_KEYS=(ALIAS_MAP.set("linear","noease"),ALIAS_MAP.set("default","noease"),["default","noease","easeinquad","easeoutquad","easeinoutquad","easeincubic","easeoutcubic","easeinoutcubic","easeinquart","easeoutquart","easeinoutquart","easeinquint","easeoutquint","easeinoutquint","easeinsine","easeoutsine","easeinoutsine","easeinexpo","easeoutexpo","easeinoutexpo","easeincirc","easeoutcirc","easeinoutcirc","easeinelastic","easeoutelastic","easeinoutelastic","easeinback","easeoutback","easeinoutback","easeinbounce","easeoutbounce","easeinoutbounce"]),SHORT_EASE_TRANSLATION_KEYS=["default","noease","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"],EASE_API2INTERNAL_NAMES=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]),SAMPLE_COUNT=(self.Ease=class d{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static ToInternal(e){return EASE_API2INTERNAL_NAMES.get(e)}static GetEditorEaseNames(t,...s){this._CreateEaseMap();let e,n=(t?(CUSTOM_EASE_EDITOR_MAP.has(t)||CUSTOM_EASE_EDITOR_MAP.set(t,new Map),[...(e=CUSTOM_EASE_EDITOR_MAP.get(t)).keys()].filter(e=>!d.GetEditorEaseData(e,t)||d.GetEditorEaseData(e,t).transition.IsForAnyPurpose())):[...(e=CUSTOM_EASE_RUNTIME_MAP).keys()]).sort();return[...PREDEFINED_EASE_MAP.keys()].concat(n).filter(e=>!s.includes(e))}static GetRuntimeEaseNames(){this._CreateEaseMap();const e=[...CUSTOM_EASE_RUNTIME_MAP.keys()];return e.sort(),[...PREDEFINED_EASE_MAP.keys()].concat(e)}static GetCustomRuntimeEaseNames(){this._CreateEaseMap();const e=[...CUSTOM_EASE_RUNTIME_MAP.keys()];return e.sort(),e}static IsPredefinedTranslatedName(e){for(const t of EASE_TRANSLATION_KEYS){const s=self.lang("ui.bars.timeline.eases."+t);if(s===e)return!0}for(const n of SHORT_EASE_TRANSLATION_KEYS){const i=self.lang("ui.bars.timeline.short-eases."+n);if(i===e)return!0}}static IsNamePredefined(e){return this._CreateEaseMap(),[...PREDEFINED_EASE_MAP.keys()].includes(e)}static _GetEase(e){const t=ALIAS_MAP.get(e);return t?EASE_MAP.get(t):d.IsNamePredefined(e)?EASE_MAP.get(e):PRIVATE_EASE_MAP.has(e)?PRIVATE_EASE_MAP.get(e):void 0}static GetBuiltInTransition(e){return this._CreateEaseMap(),BUILT_IN_TRANSITION_MAP.get(e)}static GetEditorEase(e,t){this._CreateEaseMap();const s=d._GetEase(e);if(s)return s;if(t)return CUSTOM_EASE_EDITOR_MAP.get(t).get(e);throw new Error("missing ease function")}static GetEditorEaseData(e,t){this._CreateEaseMap();const s=CUSTOM_EASE_DATA_EDITOR_MAP.get(t);if(s)return s.get(e)}static HasEditorEase(e,t){this._CreateEaseMap();const s=d._GetEase(e);return!!s||!!CUSTOM_EASE_EDITOR_MAP.get(t).get(e)}static GetRuntimeEase(e){this._CreateEaseMap();const t=d._GetEase(e);return t||CUSTOM_EASE_RUNTIME_MAP.get(e)}static GetRuntimeEaseData(e){return this._CreateEaseMap(),CUSTOM_EASE_DATA_RUNTIME_MAP.get(e)}static GetEaseFromIndex(e){this._CreateEaseMap();const t=this.GetRuntimeEaseNames();return t[e]}static GetIndexForEase(e,t){this._CreateEaseMap();const s=this.GetEditorEaseNames(t);return s.indexOf(e)}static GetIndexForEaseAtRuntime(e){return this.GetIndexForEase(e)}static _CreateEaseMap(){0===EASE_MAP.size&&(this._AddPredifinedEase("default",()=>{}),this._AddPredifinedEase("noease",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}],!0),this._AddPredifinedEase("easeinsine",[{x:0,y:0,sax:.485,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.038,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutsine",[{x:0,y:0,sax:.038,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.485,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutsine",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinelastic",[{x:0,y:0,sax:.018,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.116,y:.002,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.266,y:-.005,sax:.024,say:0,eax:-.021,eay:0,se:!0,ee:!0},{x:.416,y:.016,sax:.024,say:0,eax:-.026,eay:0,se:!0,ee:!0},{x:.566,y:-.045,sax:.061,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.716,y:.132,sax:.072,say:-.004,eax:-.045,eay:0,se:!0,ee:!0},{x:.866,y:-.373,sax:.06,say:0,eax:-.049,eay:-.002,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.038,eay:-.263,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutelastic",[{x:0,y:0,sax:.038,say:.263,eax:0,eay:0,se:!0,ee:!1},{x:.136,y:1.373,sax:.049,say:.002,eax:-.06,eay:0,se:!0,ee:!0},{x:.286,y:.868,sax:.045,say:0,eax:-.072,eay:.004,se:!0,ee:!0},{x:.436,y:1.045,sax:.025,say:0,eax:-.061,eay:0,se:!0,ee:!0},{x:.586,y:.984,sax:.026,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.736,y:1.005,sax:.021,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.886,y:.998,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.018,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutelastic",[{x:0,y:0,sax:.025,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.067,y:.001,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.18,y:-.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.292,y:.025,sax:.053,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.405,y:-.118,sax:.069,say:0,eax:-.027,eay:0,se:!0,ee:!0},{x:.597,y:1.118,sax:.027,say:0,eax:-.069,eay:0,se:!0,ee:!0},{x:.71,y:.975,sax:.025,say:0,eax:-.053,eay:0,se:!0,ee:!0},{x:.822,y:1.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.935,y:.999,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.025,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinback",[{x:0,y:0,sax:.35,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.34,eay:-1.579,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutback",[{x:0,y:0,sax:.34,say:1.579,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.35,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutback",[{x:0,y:0,sax:.035,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.242,y:-.1,sax:.258,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.76,y:1.1,sax:.025,say:0,eax:-.26,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.035,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinbounce",[{x:0,y:0,sax:.033,say:.025,eax:0,eay:0,se:!0,ee:!1},{x:.092,y:0,sax:.026,say:.078,eax:-.033,eay:.025,se:!0,ee:!0},{x:.274,y:0,sax:.097,say:.319,eax:-.026,eay:.078,se:!0,ee:!0},{x:.637,y:0,sax:.105,say:.625,eax:-.097,eay:.319,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:-.004,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutbounce",[{x:0,y:0,sax:.125,say:.004,eax:0,eay:0,se:!0,ee:!1},{x:.365,y:1,sax:.097,say:-.319,eax:-.105,eay:-.625,se:!0,ee:!0},{x:.728,y:1,sax:.026,say:-.078,eax:-.097,eay:-.319,se:!0,ee:!0},{x:.91,y:1,sax:.033,say:-.025,eax:-.026,eay:-.078,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.033,eay:-.025,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutbounce",[{x:0,y:0,sax:.01,say:.006,eax:0,eay:0,se:!0,ee:!1},{x:.046,y:0,sax:.021,say:.038,eax:-.01,eay:.006,se:!0,ee:!0},{x:.137,y:0,sax:.059,say:.158,eax:-.021,eay:.038,se:!0,ee:!0},{x:.319,y:0,sax:.117,say:.744,eax:-.059,eay:.158,se:!0,ee:!0},{x:.683,y:1,sax:.059,say:-.158,eax:-.117,eay:-.744,se:!0,ee:!0},{x:.865,y:1,sax:.021,say:-.038,eax:-.059,eay:-.158,se:!0,ee:!0},{x:.956,y:1,sax:.01,say:-.006,eax:-.021,eay:-.038,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.01,eay:-.006,se:!1,ee:!0}]),this._AddPredifinedEase("easeincubic",[{x:0,y:0,sax:.75,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.138,eay:-.321,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcubic",[{x:0,y:0,sax:.138,say:.321,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.75,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcubic",[{x:0,y:0,sax:.285,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.081,say:.272,eax:-.081,eay:-.272,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.285,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquad",[{x:0,y:0,sax:.4,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.178,eay:-.392,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquad",[{x:0,y:0,sax:.178,say:.392,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.4,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquad",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.03,say:.065,eax:-.03,eay:-.065,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquart",[{x:0,y:0,sax:.25,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.5,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquart",[{x:0,y:0,sax:.5,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquart",[{x:0,y:0,sax:.765,say:.03,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.765,eay:-.03,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquint",[{x:0,y:0,sax:.6,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.2,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquint",[{x:0,y:0,sax:.2,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.6,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquint",[{eax:0,eay:0,ee:!1,sax:.84,say:0,se:!0,x:0,y:0},{eax:-.84,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPredifinedEase("easeincirc",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.024,eay:-.808,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcirc",[{x:0,y:0,sax:.024,say:.808,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcirc",[{x:0,y:0,sax:.125,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.02,say:.428,eax:-.02,eay:-.428,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinexpo",[{x:0,y:0,sax:.66,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.14,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutexpo",[{x:0,y:0,sax:.14,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.66,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutexpo",[{eax:0,eay:0,ee:!1,sax:.345,say:0,se:!0,x:0,y:0},{eax:-.06,eay:-.5,ee:!0,sax:.06,say:.5,se:!0,x:.5,y:.5},{eax:-.335,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier),this._AddPrivateCustomEase("spline",this.EaseSpline))}static _AddPredifinedEase(e,t,s=!1){if("function"==typeof t)d._AddEase(e,t,"predefined");else{if(!C33.IsArray(t))throw new Error("unexpected arguments");if(self.BuiltInTransition){const i=C33.New(self.BuiltInTransition,e,s);i.SetFromJson(t),d._AddEase(e,(e,t,s,n)=>i.Interpolate(e,t,s,n),"predefined"),BUILT_IN_TRANSITION_MAP.set(e,i)}else{const r=C33.New(C33.Transition,[e,t.map(e=>[e.x,e.y,e.sax,e.say,e.eax,e.eay,e.se,e.ee])],!1);r.MakeLinear(s),d._AddEase(e,(e,t,s,n)=>r.Interpolate(e,t,s,n),"predefined")}}}static _AddPrivateCustomEase(e,t){d._AddEase(e,t,"private")}static AddCustomEase(e,t,s,n){this._CreateEaseMap(),d._AddEase(e,t,"custom",s,n)}static RemoveCustomEase(e,t){if(!this.IsNamePredefined(e)&&![...PRIVATE_EASE_MAP.keys()].includes(e)){const s=CUSTOM_EASE_EDITOR_MAP.get(t),n=(s&&s.delete(e),CUSTOM_EASE_DATA_EDITOR_MAP.get(t));n&&n.delete(e)}}static _AddEase(e,t,s,n,i){switch(s){case"predefined":EASE_MAP.set(e,t),PREDEFINED_EASE_MAP.set(e,t);break;case"custom":if(n){CUSTOM_EASE_EDITOR_MAP.has(n)||CUSTOM_EASE_EDITOR_MAP.set(n,new Map),CUSTOM_EASE_DATA_EDITOR_MAP.has(n)||CUSTOM_EASE_DATA_EDITOR_MAP.set(n,new Map);const r=CUSTOM_EASE_EDITOR_MAP.get(n),a=(r.set(e,t),CUSTOM_EASE_DATA_EDITOR_MAP.get(n));a.set(e,i)}else CUSTOM_EASE_RUNTIME_MAP.set(e,t),CUSTOM_EASE_DATA_RUNTIME_MAP.set(e,i);break;case"private":EASE_MAP.set(e,t),PRIVATE_EASE_MAP.set(e,t);break;default:throw new Error("unexpected ease mode")}}static NoEase(e,t,s,n){return 0===n?t:s*e/n+t}static EaseCubicBezier(e,t,s,n,i){const r=t,a=3*e*(s-t),o=3*e**2*(t+n-2*s),l=e**3*(i-t+3*s-3*n);return r+a+o+l}static EaseSpline(e,t,s,n,i,r,o,l,h,u){if(n===i&&r===o)return e;const d=get_t_for_x(e,t,n,r,l,u),_=a(s,i,o,h),p=b(s,i,o,h),m=c(s,i,o,h);return calc_bezier(d,_,p,m)}static GetBezierSamples(e,t,s,n){const i=[],r=a(e,t,s,n),o=b(e,t,s,n),l=c(e,t,s,n);for(let e=0;e<SAMPLE_COUNT;++e){const h=calc_bezier(e*SAMPLE_STEP,r,o,l);i.push(h)}return i}},11),SAMPLE_STEP=1/(SAMPLE_COUNT-1),NEWTON_RAPHSON_ITERATIONS=4,NEWTON_RAPHSON_MIN_SLOPE=.01,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,a=(e,t,s,n)=>n-3*s+3*t-e,b=(e,t,s,n)=>3*s-6*t+3*e,c=(e,t,s,n)=>3*(t-e),calc_bezier=(e,t,s,n)=>((t*e+s)*e+n)*e,get_slope=(e,t,s,n)=>3*t*e*e+2*s*e+n,get_t_for_x=(o,e,t,s,n,i)=>{if(1==o)return 1;let l=0,r=1,h=i[r],u=SAMPLE_COUNT-1;for(SAMPLE_COUNT;r!=u&&h<=o;)r++,h=i[r],l+=SAMPLE_STEP;r--;let d=(o-(h=i[r]))/(i[r+1]-h),_=l+d*SAMPLE_STEP,p=a(e,t,s,n),m=b(e,t,s,n),g=c(e,t,s,n),f=get_slope(_,p,m,g);if(0===f)return _;if(f>=NEWTON_RAPHSON_MIN_SLOPE){for(let e=0;e<NEWTON_RAPHSON_ITERATIONS;++e){const S=calc_bezier(_,p,m,g)-o,y=get_slope(_,p,m,g);_-=S/y}return _}{let t=l,s=l+SAMPLE_STEP,n=0,i,r;do{_=t+(s-t)/2;let e=calc_bezier(_,p,m,g)-o;0<e?s=_:t=_,i=Math.abs(e)>SUBDIVISION_PRECISION,r=++n<SUBDIVISION_MAX_ITERATIONS}while(i&&r);return _}}}{let RequireStringOrNumber2=function(e){C33.IsString(e)};RequireStringOrNumber=RequireStringOrNumber2;const C33=self.C3;C33.ProbabilityTable=class{constructor(e){this._items=[],this._name=e||"",this._totalWeight=0}Release(){this.Clear(),this._items=null}GetName(){return this._name}Clear(){C33.clear2DArray(this._items),this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(e=Math.random()*this.GetTotalWeight()){let t=0;for(const[s,n]of this._items)if(e<(t+=s))return n;return 0}AddItem(e,t){RequireStringOrNumber2(t),this._totalWeight+=e,this._items.push([e,t])}RemoveItem(t,s){RequireStringOrNumber2(s);const n=0===t;for(let e=0;e<this._items.length;e++){const i=this._items[e],r=n||i[0]===t,a=i[1]===s;if(r&&a){this._items.splice(e,1),this._totalWeight-=i[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(e,t){const s=new C33.ProbabilityTable(t),n=JSON.parse(e);for(const i of n){const r=i[0],a=i[1];s.AddItem(r,a)}return s}}}{let C33=self.C3,nextId=0;C33.ScreenReaderText=class{constructor(e,t){this._runtime=e,this._text=t,this._id=nextId++,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"create",id:this._id,text:this._text})}Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"release",id:this._id}),this._runtime=null,this._text="",this._id=-1}SetText(e){this._text!==e&&(this._text=e,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"update",id:this._id,text:this._text}))}}}{const C33=self.C3;C33.Event=class{constructor(e,t){this.type=e,this.cancelable=!!t,this.defaultPrevented=!1,this.propagationStopped=!1,this.isAsync=!1}preventDefault(){if(!this.cancelable)throw new Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=!0}stopPropagation(){if(!this.cancelable)throw new Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw new Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=!0}}}{const C33=self.C3,assert=self.assert;C33.Event.Handler=class extends C33.DefendedBase{constructor(e){super(),this._type=e,this._captureListeners=[],this._captureListenersSet=new Set,this._listeners=[],this._listenersSet=new Set,this._fireDepth=0,this._queueModifyListeners=[]}Release(){0<this._fireDepth||(C33.clearArray(this._captureListeners),this._captureListenersSet.clear(),C33.clearArray(this._listeners),this._listenersSet.clear(),C33.clearArray(this._queueModifyListeners),C33.Release(this))}_AddListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"add",func:e,capture:t}):t?this._captureListenersSet.has(e)||(this._captureListeners.push(e),this._captureListenersSet.add(e)):this._listenersSet.has(e)||(this._listeners.push(e),this._listenersSet.add(e))}_RemoveListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"remove",func:e,capture:t}):t?this._captureListenersSet.has(e)&&(this._captureListenersSet.delete(e),C33.arrayFindRemove(this._captureListeners,e)):this._listenersSet.has(e)&&(this._listenersSet.delete(e),C33.arrayFindRemove(this._listeners,e))}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return 0<this._fireDepth}_ProcessQueuedListeners(){const e=new Set,t=new Set;for(const s of this._queueModifyListeners)if("add"===s.op)this._AddListener(s.func,s.capture),(s.capture?t:e).delete(s.func);else{if("remove"!==s.op)throw new Error("invalid op");(s.capture?(this._captureListenersSet.delete(s.func),t):(this._listenersSet.delete(s.func),e)).add(s.func)}C33.arrayRemoveAllInSet(this._listeners,e),C33.arrayRemoveAllInSet(this._captureListeners,t),C33.clearArray(this._queueModifyListeners)}_FireCancellable(s){this._IncreaseFireDepth();let n=!1;for(let e=0,t=this._captureListeners.length;e<t;++e)if(this._captureListeners[e](s),s.propagationStopped){n=!0;break}if(!n)for(let e=0,t=this._listeners.length;e<t&&(this._listeners[e](s),!s.propagationStopped);++e);return this._DecreaseFireDepth(),!s.defaultPrevented}_FireNonCancellable(s){this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e)this._captureListeners[e](s);for(let e=0,t=this._listeners.length;e<t;++e)this._listeners[e](s);return this._DecreaseFireDepth(),!0}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--,0===this._fireDepth&&0<this._queueModifyListeners.length&&this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(e){e?this._IncreaseFireDepth():this._DecreaseFireDepth()}_FireAsync(s){let n=[];for(let t=0,e=this._captureListeners.length;t<e;++t){let e=this._captureListeners[t];n.push(C33.Asyncify(()=>e(s)))}for(let t=0,e=this._listeners.length;t<e;++t){let e=this._listeners[t];n.push(C33.Asyncify(()=>e(s)))}return Promise.all(n).then(()=>!s.defaultPrevented)}_FireAndWait_AsyncOptional(s){const n=[];this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e){const i=this._captureListeners[e](s);i instanceof Promise&&n.push(i)}for(let e=0,t=this._listeners.length;e<t;++e){const r=this._listeners[e](s);r instanceof Promise&&n.push(r)}return this._DecreaseFireDepth(),n.length?Promise.all(n).then(()=>!s.defaultPrevented):!s.defaultPrevented}async _FireAndWaitAsync(e){return this._FireAndWait_AsyncOptional(e)}async _FireAndWaitAsyncSequential(s){this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e){const n=this._captureListeners[e](s);n instanceof Promise&&await n}for(let e=0,t=this._listeners.length;e<t;++e){const i=this._listeners[e](s);i instanceof Promise&&await i}return this._DecreaseFireDepth(),!s.defaultPrevented}*_FireAsGenerator(s){this._IncreaseFireDepth();for(let e=0,t=this._captureListeners.length;e<t;++e){const n=this._captureListeners[e](s);C33.IsIterator(n)&&(yield*n)}for(let e=0,t=this._listeners.length;e<t;++e){const i=this._listeners[e](s);C33.IsIterator(i)&&(yield*i)}this._DecreaseFireDepth()}}}{const C33=self.C3;C33.Event.Dispatcher=class extends C33.DefendedBase{constructor(){super(),this._eventHandlers=new Map,this._dispatcherWasReleased=!1}Release(){if(this._dispatcherWasReleased)throw new Error("already released");this.ClearEvents(),this._dispatcherWasReleased=!0,C33.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){if(this._eventHandlers){for(let e of this._eventHandlers.values())e.Release();this._eventHandlers.clear()}}_GetHandlerByType(e,t){let s=this._eventHandlers.get(e);return s||(t?(s=C33.New(C33.Event.Handler,e),this._eventHandlers.set(e,s),s):null)}HasAnyHandlerFor(e){return this._eventHandlers.has(e)}addEventListener(e,t,s){let n=this._GetHandlerByType(e,!0);n._AddListener(t,!!s)}removeEventListener(e,t,s){let n=this._GetHandlerByType(e,!1);n&&(n._RemoveListener(t,!!s),n._IsEmpty())&&this._eventHandlers.delete(e)}dispatchEvent(e){const t=this._GetHandlerByType(e.type,!1);return!t||(e.cancelable?t._FireCancellable(e):t._FireNonCancellable(e))}dispatchEventAsync(e){const t=this._GetHandlerByType(e.type,!1);return t?(e.isAsync=!0,t._FireAsync(e)):Promise.resolve(!0)}async dispatchEventAndClearAsync(e){const t=this._GetHandlerByType(e.type,!1);if(!t)return!0;this._eventHandlers.delete(e.type),e.isAsync=!0;const s=await t._FireAsync(e);return t.Release(),s}async dispatchEventAndWaitAsync(e){const t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWaitAsync(e)}dispatchEventAndWait_AsyncOptional(e){const t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWait_AsyncOptional(e)}async dispatchEventAndWaitAsyncSequential(e){const t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWaitAsyncSequential(e)}dispatchGeneratorEvent(e){const t=this._GetHandlerByType(e.type,!1);if(!t)return null;if(e.cancelable)throw new Error("not supported");return t._FireAsGenerator(e)}SetDelayRemoveEventsEnabled(e){for(const t of this._eventHandlers.values())t.SetDelayRemoveEventsEnabled(e)}}}{let SetNewCallback2=function(e){callbackId=SUPPORTS_RIC&&0===highThroughputMode?requestIdleCallback(DoAsyncifiedWork2,{timeout:IDLECALLBACK_TIMEOUT}):setTimeout(DoAsyncifiedWork2,0<highThroughputMode?1:e)},DoAsyncifiedWork2=function(i){if(callbackId=-1,workQueue.length){let s=performance.now(),n=s,e=0,t;for(;DoNextAsyncifiedJob2(workQueue.shift()),n=performance.now(),++e,t=(n-s)/e*1.1,workQueue.length&&(SUPPORTS_RIC&&0===highThroughputMode&&void 0!==i?t<i.timeRemaining():n-s+t<SETTIMEOUT_WORK_DURATION););if(-1===callbackId&&workQueue.length){let e=n-s,t=Math.max(SETTIMEOUT_INTERVAL-e,4);SetNewCallback2(t)}}},DoNextAsyncifiedJob2=function(t){let e;try{e=t.func()}catch(e){return void t.reject(e)}t.resolve(e)},C33=(SetNewCallback=SetNewCallback2,DoAsyncifiedWork=DoAsyncifiedWork2,DoNextAsyncifiedJob=DoNextAsyncifiedJob2,self.C3),SETTIMEOUT_WORK_DURATION=12,SETTIMEOUT_INTERVAL=16,IDLECALLBACK_TIMEOUT=35,SUPPORTS_RIC="undefined"!=typeof requestIdleCallback,workQueue=[],callbackId=-1,highThroughputMode=0,asyncifyDisabled=C33.QueryString.Has("disable-asyncify");asyncifyDisabled&&console.warn("[Asyncify] Asyncify has been disabled due to disable-asyncify in the query string. Some work will now be done synchronously."),C33.Asyncify=function(s){let n=null;return C33.isDebug&&(n=C33.GetCallStack()),new Promise((e,t)=>{workQueue.push({func:s,resolve:e,reject:t,stack:n}),asyncifyDisabled?DoNextAsyncifiedJob2(workQueue.pop()):-1===callbackId&&SetNewCallback2(SETTIMEOUT_INTERVAL)})},C33.Asyncify.SetHighThroughputMode=function(e){if(e)++highThroughputMode;else if(--highThroughputMode<0)throw new Error("already turned off high throughput mode")}}{let ClearTimeCache2=function(){cachedNowTime=-1},CheckActiveIdleTimeouts2=function(){timerId=-1,nextDeadline=-1;let s=Date.now();for(let t of activeIdleTimeouts)if(t._CheckTimeout(s)){let e=t._GetDeadline();(-1===nextDeadline||e<nextDeadline)&&(nextDeadline=e)}else activeIdleTimeouts.delete(t);if(-1!==nextDeadline){let e=Math.max(nextDeadline-s+IDLE_CHECK_TIMER_OVERSHOOT,IDLE_CHECK_MIN_INTERVAL);timerId=self.setTimeout(CheckActiveIdleTimeouts2,e)}},C33=(ClearTimeCache=ClearTimeCache2,CheckActiveIdleTimeouts=CheckActiveIdleTimeouts2,self.C3),IDLE_CHECK_MIN_INTERVAL=1e3,IDLE_CHECK_TIMER_OVERSHOOT=100,cachedNowTime=-1,timerId=(C33.FastGetDateNow=function(){return-1===cachedNowTime&&(cachedNowTime=Date.now(),self.setTimeout(ClearTimeCache2,16)),cachedNowTime},-1),nextDeadline=-1,activeIdleTimeouts=new Set;C33.IdleTimeout=class{constructor(e,t){this._callback=e,this._timeout=1e3*t,this._deadline=0,this._isActive=!1}Reset(){let e=C33.FastGetDateNow();this._deadline=e+this._timeout,this._isActive||(activeIdleTimeouts.add(this),this._isActive=!0),-1===timerId?(nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts2,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT)):this._deadline<nextDeadline&&nextDeadline>e+IDLE_CHECK_MIN_INTERVAL&&(self.clearTimeout(timerId),nextDeadline=this._deadline,timerId=self.setTimeout(CheckActiveIdleTimeouts2,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT))}_CheckTimeout(e){return!(e>=this._deadline)||(this._callback()?(this._deadline=e+this._timeout,!0):this._isActive=!1)}_GetDeadline(){return this._deadline}Cancel(){this._isActive&&(activeIdleTimeouts.delete(this),this._isActive=!1,0===activeIdleTimeouts.size)&&-1!==timerId&&(self.clearTimeout(timerId),timerId=-1,nextDeadline=-1)}Release(){this.Cancel(),this._callback=null}}}{const C33=self.C3;C33.Disposable=class a{constructor(e){this._disposed=!1,this._disposeAction=e}Dispose(){this._disposed||(this._disposed=!0,this._disposeAction&&(this._disposeAction(),this._disposeAction=null))}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(e){return new a(()=>e.Release())}static From(t,s,n,i,e){if(null==i)i=!1;else if("boolean"!=typeof i&&"object"!=typeof i)throw new TypeError("invalid event listener options");if(e&&(n=n.bind(e)),s.includes(" ")){s=s.split(" ");const r=new C33.CompositeDisposable;for(let e of s)t.addEventListener(e,n,i),r.Add(C33.New(C33.Disposable,()=>t.removeEventListener(e,n,i)));return r}return t.addEventListener(s,n,i),C33.New(C33.Disposable,()=>t.removeEventListener(s,n,i))}},C33.StubDisposable=class extends C33.Disposable{SetAction(e){this._disposeAction=e}},C33.CompositeDisposable=class extends C33.Disposable{constructor(...t){super(),this._disposables=new Set;for(let e of t)this.Add(e)}Add(...t){if(this._disposed)throw new Error("already disposed");for(let e of t)this._disposables.add(e)}Remove(e){if(this._disposed)throw new Error("already disposed");this._disposables.delete(e)}RemoveAll(){if(this._disposed)throw new Error("already disposed");if(this._disposables){for(let e of this._disposables)e.Dispose();this._disposables.clear()}}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw new Error("already disposed");this._disposed=!0;for(let e of this._disposables)e.Dispose();this._disposables.clear(),this._disposables=null}Release(){this.Dispose()}}}{const C33=self.C3;C33.KahanSum=class extends C33.DefendedBase{constructor(){super(),this._c=0,this._y=0,this._t=0,this._sum=0}Add(e){this._y=(e=+e)-this._c,this._t=this._sum+this._y,this._c=this._t-this._sum-this._y,this._sum=this._t}Subtract(e){this._sum-=+e}Get(){return this._sum}Reset(){this._c=0,this._y=0,this._t=0,this._sum=0}Set(e){this._c=0,this._y=0,this._t=0,this._sum=+e}Copy(e){this._c=e._c,this._y=e._y,this._t=e._t,this._sum=e._sum}Release(){}}}{const C33=self.C3,js_cols={},RED=!0,BLACK=!1;js_cols.RBnode=function(e){this.tree=e,this.right=this.tree.sentinel,this.left=this.tree.sentinel,this.parent=null,this.color=!1,this.key=null},js_cols.RedBlackSet=function(e){this.size=0,this.sentinel=new js_cols.RBnode(this),this.sentinel.color=BLACK,this.root=this.sentinel,this.root.parent=this.sentinel,this.compare=e||this.default_compare},js_cols.RedBlackSet.prototype.default_compare=function(e,t){return e<t?-1:t<e?1:0},js_cols.RedBlackSet.prototype.clone=function(){var e=new js_cols.RedBlackSet(this.compare);return e.insertAll(this),e},js_cols.RedBlackSet.prototype.clear=function(){this.size=0,this.sentinel=new js_cols.RBnode(this),this.sentinel.color=BLACK,this.root=this.sentinel,this.root.parent=this.sentinel},js_cols.RedBlackSet.prototype.leftRotate=function(e){var t=e.right;e.right=t.left,t.left!=this.sentinel&&(t.left.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,(t.left=e).parent=t},js_cols.RedBlackSet.prototype.rightRotate=function(e){var t=e.left;e.left=t.right,t.right!=this.sentinel&&(t.right.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.right?e.parent.right=t:e.parent.left=t,(t.right=e).parent=t},js_cols.RedBlackSet.prototype.insert=function(e){if(this.contains(e))this.get_(e).key=e;else{for(var t=new js_cols.RBnode(this),s=(t.key=e,this.sentinel),n=this.root;n!=this.sentinel;)s=n,n=this.compare(t.key,n.key)<0?n.left:n.right;(t.parent=s)==this.sentinel?this.root=t:this.compare(t.key,s.key)<0?s.left=t:s.right=t,t.left=this.sentinel,t.right=this.sentinel,t.color=RED,this.insertFixup(t),this.size++}},js_cols.RedBlackSet.prototype.insertFixup=function(e){for(;e!=this.sentinel&&e!=this.root&&e.parent.color==RED;){var t;e.parent==e.parent.parent.left?(t=e.parent.parent.right).color==RED?(e.parent.color=BLACK,t.color=BLACK,e.parent.parent.color=RED,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.leftRotate(e)),e.parent.color=BLACK,e.parent.parent.color=RED,e.parent.parent!=this.sentinel&&this.rightRotate(e.parent.parent)):(t=e.parent.parent.left).color==RED?(e.parent.color=BLACK,t.color=BLACK,e.parent.parent.color=RED,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rightRotate(e)),e.parent.color=BLACK,e.parent.parent.color=RED,e.parent.parent!=this.sentinel&&this.leftRotate(e.parent.parent))}this.root.color=BLACK},js_cols.RedBlackSet.prototype.delete_=function(e){var t=e.left==this.sentinel||e.right==this.sentinel?e:this.successor_(e),s=t.left!=this.sentinel?t.left:t.right;s.parent=t.parent,t.parent==this.sentinel?this.root=s:t==t.parent.left?t.parent.left=s:t.parent.right=s,t!=e&&(e.key=t.key),t.color==BLACK&&this.deleteFixup(s),this.size--},js_cols.RedBlackSet.prototype.deleteFixup=function(e){for(;e!=this.root&&e.color==BLACK;){var t;e=e==e.parent.left?((t=e.parent.right).color==RED&&(t.color=BLACK,e.parent.color=RED,this.leftRotate(e.parent),t=e.parent.right),t.left.color==BLACK&&t.right.color==BLACK?(t.color=RED,e.parent):(t.right.color==BLACK&&(t.left.color=BLACK,t.color=RED,this.rightRotate(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=BLACK,t.right.color=BLACK,this.leftRotate(e.parent),this.root)):((t=e.parent.left).color==RED&&(t.color=BLACK,e.parent.color=RED,this.rightRotate(e.parent),t=e.parent.left),t.right.color==BLACK&&t.left.color==BLACK?(t.color=RED,e.parent):(t.left.color==BLACK&&(t.right.color=BLACK,t.color=RED,this.leftRotate(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=BLACK,t.left.color=BLACK,this.rightRotate(e.parent),this.root))}e.color=BLACK},js_cols.RedBlackSet.prototype.remove=function(e){var t;return(e=this.get_(e))!=this.sentinel?(t=e.key,this.delete_(e),t):null},js_cols.RedBlackSet.prototype.removeSwapped=function(e,t){this.remove(t)},js_cols.RedBlackSet.prototype.min=function(e){for(;e.left!=this.sentinel;)e=e.left;return e},js_cols.RedBlackSet.prototype.max=function(e){for(;e.right!=this.sentinel;)e=e.right;return e},js_cols.RedBlackSet.prototype.successor_=function(e){if(e.right!=this.sentinel)return this.min(e.right);for(var t=e.parent;t!=this.sentinel&&e==t.right;)t=(e=t).parent;return t},js_cols.RedBlackSet.prototype.predeccessor_=function(e){if(e.left!=this.sentinel)return this.max(e.left);for(var t=e.parent;t!=this.sentinel&&e==t.left;)t=(e=t).parent;return t},js_cols.RedBlackSet.prototype.successor=function(e){if(0<this.size){var t=this.get_(e);if(t==this.sentinel)return null;if(t.right!=this.sentinel)return this.min(t.right).key;for(var s=t.parent;s!=this.sentinel&&t==s.right;)s=(t=s).parent;return s!=this.sentinel?s.key:null}return null},js_cols.RedBlackSet.prototype.predecessor=function(e){if(0<this.size){var t=this.get_(e);if(t==this.sentinel)return null;if(t.left!=this.sentinel)return this.max(t.left).key;for(var s=t.parent;s!=this.sentinel&&t==s.left;)s=(t=s).parent;return s!=this.sentinel?s.key:null}return null},js_cols.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key},js_cols.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key},js_cols.RedBlackSet.prototype.get_=function(e){for(var t=this.root;t!=this.sentinel&&0!=this.compare(t.key,e);)t=this.compare(e,t.key)<0?t.left:t.right;return t},js_cols.RedBlackSet.prototype.contains=function(e){return null!=this.get_(e).key},js_cols.RedBlackSet.prototype.getValues=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},js_cols.RedBlackSet.prototype.insertAll=function(e){if("array"==js_cols.typeOf(e))for(var t=0;t<e.length;t++)this.insert(e[t]);else if("function"==js_cols.typeOf(e.forEach))e.forEach(this.insert,this);else if("function"==js_cols.typeOf(e.getValues))for(var s=e.getValues(),t=0;t<s.length;t++)this.insert(s[t]);else if("object"==js_cols.typeOf(e))for(var n in e)this.insert(e[n])},js_cols.RedBlackSet.prototype.removeAll=function(e){if("array"==js_cols.typeOf(e))for(var t=0;t<e.length;t++)this.remove(e[t]);else if("function"==js_cols.typeOf(e.forEach))e.forEach(this.removeSwapped,this);else if("function"==js_cols.typeOf(e.getValues))for(var s=e.getValues(),t=0;t<s.length;t++)this.remove(s[t]);else if("object"==js_cols.typeOf(e))for(var n in e)this.remove(e[n])},js_cols.RedBlackSet.prototype.containsAll=function(e){if("array"==js_cols.typeOf(e)){for(var t=0;t<e.length;t++)if(!this.contains(e[t]))return!1;return!0}if("function"==js_cols.typeOf(e.forEach))return e.every(this.contains,this);if("function"==js_cols.typeOf(e.getValues)){for(var s=e.getValues(),t=0;t<s.length;t++)if(!this.contains(s[t]))return!1;return!0}if("object"==js_cols.typeOf(e)){for(var n in e)if(!this.contains(e[n]))return!1;return!0}},js_cols.RedBlackSet.prototype.range=function(e,t){var s=[];return this.traverseFromTo(function(e){s.push(e)},e,t),s},js_cols.RedBlackSet.prototype.traverse=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;){if(e.call(t,s.key,this))return;s=this.successor_(s)}},js_cols.RedBlackSet.prototype.traverseFrom=function(e,t,s){if(!this.isEmpty())for(var n=this.get_(t);n!=this.sentinel;){if(e.call(s,n.key,this))return;n=this.successor_(n)}},js_cols.RedBlackSet.prototype.traverseTo=function(e,t,s){if(!this.isEmpty())for(var n=this.min(this.root),i=this.get_(t);n!=i;){if(e.call(s,n.key,this))return;n=this.successor_(n)}},js_cols.RedBlackSet.prototype.traverseFromTo=function(e,t,s,n){if(!this.isEmpty())for(var i=this.get_(t),r=this.get_(s);i!=r;){if(e.call(n,i.key,this))return;i=this.successor_(i)}},js_cols.RedBlackSet.prototype.traverseBackwards=function(e,t){if(!this.isEmpty())for(var s=this.max(this.root);s!=this.sentinel;){if(e.call(t,s.key,this))return;s=this.predeccessor_(s)}},js_cols.RedBlackSet.prototype.forEach=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))e.call(t,s.key,s.key,this)},js_cols.RedBlackSet.prototype.some=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(e.call(t,s.key,s.key,this))return!0;return!1},js_cols.RedBlackSet.prototype.every=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(!e.call(t,s.key,s.key,this))return!1;return!0},js_cols.RedBlackSet.prototype.map=function(e,t){var s=[];if(!this.isEmpty())for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))s.push(e.call(t,n.key,n.key,this));return s},js_cols.RedBlackSet.prototype.filter=function(e,t){var s=[];if(!this.isEmpty())for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))e.call(t,n.key,n.key,this)&&s.push(n.key);return s},js_cols.RedBlackSet.prototype.getCount=function(){return this.size},js_cols.RedBlackSet.prototype.isEmpty=function(){return 0==this.size},js_cols.RedBlackSet.prototype.isSubsetOf=function(e){var t=js_cols.getCount(e);if(this.getCount()>t)return!1;var s=0;if(this.isEmpty())return!0;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n))js_cols.contains.call(e,e,n.key)&&s++;return s==this.getCount()},js_cols.RedBlackSet.prototype.intersection=function(e){var t=new js_cols.RedBlackSet(this.compare);if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))e.contains.call(e,s.key,s.key,this)&&t.insert(s.key);return t},C33.RedBlackSet=class extends C33.DefendedBase{constructor(e){super(),this._rbSet=new js_cols.RedBlackSet(e),this._enableQueue=!1,this._queueInsert=new Set,this._queueRemove=new Set}Add(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.delete(e):this._queueInsert.add(e):this._rbSet.insert(e)}Remove(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.add(e):this._queueInsert.delete(e):this._rbSet.remove(e)}Has(e){return this._enableQueue?!!this._queueInsert.has(e)||!this._queueRemove.has(e)&&this._rbSet.contains(e):this._rbSet.contains(e)}Clear(){this._rbSet.clear(),this._queueInsert.clear(),this._queueRemove.clear()}toArray(){if(this._enableQueue)throw new Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return 0===this.GetSize()}Front(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");const e=this._rbSet,t=e.min(e.root);return t.key}Shift(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");const e=this.Front();return this.Remove(e),e}SetQueueingEnabled(e){if(this._enableQueue!==(e=!!e)&&!(this._enableQueue=e)){for(const t of this._queueRemove)this._rbSet.remove(t);this._queueRemove.clear();for(const s of this._queueInsert)this._rbSet.insert(s);this._queueInsert.clear()}}ForEach(e){this._rbSet.forEach(e)}*values(){if(!this.IsEmpty()){const t=this._rbSet;for(let e=t.min(t.root);e!=t.sentinel;e=t.successor_(e))yield e.key}}[Symbol.iterator](){return this.values()}}}{const C33=self.C3;C33.PromiseThrottle=class{constructor(e=C33.hardwareConcurrency){this._maxParallel=e,this._queue=[],this._activeCount=0}Add(s){return new Promise((e,t)=>{this._queue.push({func:s,resolve:e,reject:t}),this._MaybeStartNext()})}_FindInQueue(s){for(let e=0,t=this._queue.length;e<t;++e)if(this._queue[e].func===s)return e;return-1}RemoveAndResolve(e,t){const s=this._FindInQueue(e);if(-1===s)throw new Error("cannot find promise to resolve");this._queue[s].resolve(t),this._queue.splice(s,1)}RemoveAndReject(e,t){const s=this._FindInQueue(e);if(-1===s)throw new Error("cannot find promise to reject");this._queue[s].reject(t),this._queue.splice(s,1)}async _MaybeStartNext(){if(this._queue.length&&!(this._activeCount>=this._maxParallel)){this._activeCount++;const t=this._queue.shift();try{const e=await t.func();t.resolve(e)}catch(e){t.reject(e)}this._activeCount--,this._MaybeStartNext()}}static async Batch(e,t){let s=[],n=!1,i=[];for(;e--;)i.push((async()=>{let e;for(;e=t.pop();){if(n)return;try{s.push(await e())}catch(e){throw n=!0,e}}})());return await Promise.all(i),s}}}{const C33=self.C3;C33.RateLimiter=class{constructor(e,t,s){this._callback=e,this._interval=t,this._intervalOnBattery=s||2*t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1,this._callbackArguments=null}SetCanRunImmediate(e){this._canRunImmediate=!!e}_GetInterval(){return void 0!==C33.Battery&&C33.Battery.IsOnBatteryPower()?this._intervalOnBattery:this._interval}Call(...n){if(-1===this._timerId){this._callbackArguments=n;let e=C33.FastGetDateNow(),t=e-this._lastCallTime,s=this._GetInterval();s<=t&&this._canRunImmediate?(this._lastCallTime=e,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(s-t,4))}}_RunCallback(){this._ignoreReset=!0;const e=this._callbackArguments;this._callbackArguments=null,e?this._callback(...e):this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._callbackArguments=null,this._lastCallTime=C33.FastGetDateNow())}_OnTimer(){this._timerId=-1,this._lastCallTime=C33.FastGetDateNow(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._callbackArguments=null,this._timerCallFunc=null}}}{const C33=self.C3;C33.SVGRasterManager=class{constructor(){this._images=new Map,this._allowNpotSurfaces=!1,this._getBaseSizeCallback=null,this._rasterAtSizeCallback=null,this._releaseResultCallback=null,this._redrawCallback=null}SetNpotSurfaceAllowed(e){this._allowNpotSurfaces=!!e}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(e){this._getBaseSizeCallback=e}GetBaseSize(e){if(this._getBaseSizeCallback)return this._getBaseSizeCallback(e);throw new Error("no get base size callback set")}SetRasterAtSizeCallback(e){this._rasterAtSizeCallback=e}RasterAtSize(e,t,s,n,i,r){if(this._rasterAtSizeCallback)return this._rasterAtSizeCallback(e,t,s,n,i,r);throw new Error("no raster at size callback set")}SetReleaseResultCallback(e){this._releaseResultCallback=e}ReleaseResult(e){if(!this._releaseResultCallback)throw new Error("no release result callback set");this._releaseResultCallback(e)}SetRedrawCallback(e){this._redrawCallback=e}Redraw(){if(!this._redrawCallback)throw new Error("no redraw callback set");this._redrawCallback()}AddImage(e){let t=this._images.get(e);return t||(t=C33.New(C33.SVGRasterImage,this,e),this._images.set(e,t)),t.IncReference(),t}_RemoveImage(e){this._images.delete(e.GetDataSource())}OnTexturesChanged(){for(const e of this._images.values())e.ReleaseRasterizedResult(),e.ForceRasterAgain()}}}{const C33=self.C3,MAX_SURFACE_SIZE=4096;C33.SVGRasterImage=class{constructor(e,t){this._manager=e,this._dataSource=t,this._refCount=0,this._baseWidth=0,this._baseHeight=0,this._getBaseSizePromise=this._manager.GetBaseSize(t).then(e=>{this._manager&&(this._baseWidth=e[0],this._baseHeight=e[1],this._manager.Redraw())}).catch(e=>{console.error("[SVG] Error loading SVG: ",e),this._hadError=!0,this._manager&&this._manager.Redraw()}),this._rasterSurfaceWidth=0,this._rasterSurfaceHeight=0,this._rasterImageWidth=0,this._rasterImageHeight=0,this._isRasterizing=!1,this._rasterizedResult=null,this._forceRaster=!1,this._hadError=!1}Release(){if(this._refCount<=0)throw new Error("already released");this._refCount--,0===this._refCount&&this._Release()}ReleaseRasterizedResult(){this._rasterizedResult&&(this._manager.ReleaseResult(this._rasterizedResult),this._rasterizedResult=null)}_Release(){this.ReleaseRasterizedResult(),this._manager._RemoveImage(this),this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return 0<this._refCount}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=!0}async StartRasterForSize(n,i,r){if(0!==i&&0!==r&&!this._hadError&&!this._isRasterizing){let e=C33.nextHighestPowerOfTwo(Math.ceil(i)),t=C33.nextHighestPowerOfTwo(Math.ceil(r)),s=Math.max(e,t);if(s>MAX_SURFACE_SIZE){const a=MAX_SURFACE_SIZE/s;i*=a,r*=a,e=Math.min(Math.ceil(e*a),MAX_SURFACE_SIZE),t=Math.min(Math.ceil(t*a),MAX_SURFACE_SIZE)}if(i<e&&r<t){const o=i/r,l=e/t;r=o<l?(i=t*o,t):(i=e)/o}if(this._manager.IsNpotSurfaceAllowed()&&(e=Math.ceil(i),t=Math.ceil(r)),!(e<=this._rasterSurfaceWidth&&t<=this._rasterSurfaceHeight)||this._forceRaster){this._isRasterizing=!0,this._rasterSurfaceWidth=e,this._rasterSurfaceHeight=t;const h=await this._manager.RasterAtSize(this._dataSource,n,this._rasterSurfaceWidth,this._rasterSurfaceHeight,i,r);this._manager&&(this.ReleaseRasterizedResult(),this._rasterizedResult=h,this._rasterImageWidth=i,this._rasterImageHeight=r,this._isRasterizing=!1,this._forceRaster=!1,this._manager.Redraw())}}}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}}}{let lookupHtmlEntity2=function(e){return HTML_ENTITY_MAP.get(e)};lookupHtmlEntity=lookupHtmlEntity2;const C33=self.C3,NUMERIC_CHARS=(C33.UTF8_BOM="\ufeff",new Set("0123456789")),WHITESPACE_CHARS=(C33.IsNumericChar=function(e){return NUMERIC_CHARS.has(e)},new Set(" \t\n\r\u2028\u2029"));C33.IsWhitespaceChar=function(e){return WHITESPACE_CHARS.has(e)},C33.FilterWhitespace=function(e){return[...e].filter(e=>!C33.IsWhitespaceChar(e)).join("")},C33.IsStringAllWhitespace=function(e){for(const t of e)if(!C33.IsWhitespaceChar(t))return!1;return!0},C33.IsCharArrayAllWhitespace=function(e){for(const t of e)if(!C33.IsWhitespaceChar(t))return!1;return!0},C33.IsUnprintableChar=function(e){return 1===e.length&&e.charCodeAt(0)<32},C33.FilterUnprintableChars=function(e){return[...e].filter(e=>!C33.IsUnprintableChar(e)).join("")};let cjkPunctuationRegex=null;try{cjkPunctuationRegex=new RegExp("\\p{P}(?<=[\\u3000-\\u303F\\uFF00-\\uFFEF])","u")}catch(t){console.warn("Unable to detect CJK punctuation: ",t)}C33.IsCJKPunctuationChar=function(e){return!C33.IsWhitespaceChar(e)&&cjkPunctuationRegex&&cjkPunctuationRegex.test(e)};const NUMERIC_STRING_CHARS=new Set("0123456789.+-e"),HTML_ENTITY_MAP=(C33.IsStringNumber=function(t){if(!(t=t.trim()).length)return!1;let e=t.charAt(0);if("-"!==e&&!NUMERIC_CHARS.has(e))return!1;for(let e of t)if(!NUMERIC_STRING_CHARS.has(e))return!1;return!0},C33.RemoveTrailingDigits=function(t){let s=t.length;for(;0<s;){let e=t.charAt(s-1);if(!C33.IsNumericChar(e))break;--s}return t.substr(0,s)},C33.IncrementNumberAtEndOf=function(e){let t=C33.RemoveTrailingDigits(e),s=e.substr(t.length);return t+(s?(parseInt(s,10)+1).toString():"2")},new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]])),HTML_ENTITY_REGEX=/[&<>"']/g,ESCAPE_REGEX=(C33.EscapeHTML=function(e){return e.replace(HTML_ENTITY_REGEX,lookupHtmlEntity2)},C33.EscapeJS=function(e){let t=C33.ReplaceAll(e,"\\","\\\\");return t=C33.ReplaceAll(t,'"','\\"'),t=C33.ReplaceAll(t,"\t","\\t"),t=C33.ReplaceAll(t,"\r",""),C33.ReplaceAll(t,"\n","\\n")},C33.EscapeXML=function(e){let t=C33.ReplaceAll(e,"&","&amp;");return t=C33.ReplaceAll(t,"<","&lt;"),t=C33.ReplaceAll(t,">","&gt;"),C33.ReplaceAll(t,'"',"&quot;")},/[-[\]{}()*+?.,\\^$|#\s]/g),intlSegmenter=(C33.EscapeRegex=function(e){return e.replace(ESCAPE_REGEX,"\\$&")},C33.CountCharsInString=function(e,t){let s=0;for(const n of e)n===t&&++s;return s},C33.FindAll=function(e,t,s=!1){if(!t)return[];s||(e=e.toLowerCase(),t=t.toLowerCase());let n=t.length,i=0,r,a=[];for(;-1<(r=e.indexOf(t,i));)a.push(r),i=r+n;return a},C33.ReplaceAll=function(e,t,s){return e.replaceAll(t,()=>s)},C33.ReplaceAllCaseInsensitive=function(e,t,s){return e.replace(new RegExp(C33.EscapeRegex(t),"gi"),()=>s)},C33.SetElementContent=function(e,t){"string"==typeof t?e.textContent=t:t.isPlainText()?e.textContent=t.toString():(e.innerHTML=t.toHTML(),t instanceof C33.BBString&&t.attachLinkHandlers(e))},C33.StringLikeEquals=function(e,t){return e instanceof C33.HtmlString||e instanceof C33.BBString?e.equals(t):t instanceof C33.HtmlString||t instanceof C33.BBString?t.equals(e):e===t},C33.StringSubstitute=function(s,...n){let i=s;for(let e=0,t=n.length;e<t;++e){const r=`{${e}}`;if(!s.includes(r))throw new Error(`missing placeholder '${r}' in string substitution`);i=i.replace(r,n[e].toString())}return i},C33.StringSubstituteAllowMissing=function(s,...n){let i=s,r=-1,a=-1;for(let e=0,t=n.length;e<t;++e){const o=`{${e}}`;s.includes(o)?(a=e,i=i.replace(o,n[e].toString())):-1===r&&(r=e)}if(0<=r&&0<=a&&r<a)throw new Error(`missing placeholder '${r}' in string substitution`);return i},C33.StringSubstituteMap=function(e,s){let n=e;for(let[e,t]of Object.entries(s))n=n.replaceAll(e,t.toString());return n},C33.SortAZ=function(e,t){return t<e?1:e<t?-1:0},C33.SortAZCaseInsensitive=function(e,t){let s=e.toLowerCase(),n=t.toLowerCase();return n<s?1:s<n?-1:0},new self.Intl.Segmenter),KILOBYTE=(C33.SplitGraphemes=function(e){const t=[];for(const s of intlSegmenter.segment(e))t.push(s.segment);return t},C33.IterateGraphemes=function*(e){for(const t of intlSegmenter.segment(e))yield t.segment},C33.CountGraphemes=function(e){let t=0;for(const s of intlSegmenter.segment(e))++t;return t},1024),MEGABYTE=1024*KILOBYTE,GIGABYTE=1024*MEGABYTE,TERABYTE=1024*GIGABYTE,DEFAULT_FORMATTIME_OPTS={approximate:(C33.FormatDataSize=function(t,e){let s="common."+(e?"dataRates":"dataSizes")+".",n=self.langSub;if(t<KILOBYTE)return n(s+"bytes",t);if(t<MEGABYTE){let e=t/KILOBYTE;return e=e<10?Math.round(10*e)/10:Math.round(e),n(s+"kilobytes",e)}if(t<GIGABYTE){let e=t/MEGABYTE;return e=e<10?Math.round(10*e)/10:Math.round(e),n(s+"megabytes",e)}if(t<TERABYTE){let e=t/GIGABYTE;return e=e<10?Math.round(10*e)/10:Math.round(e),n(s+"gigabytes",e)}{let e=t/TERABYTE;return e=e<10?Math.round(10*e)/10:Math.round(e),n(s+"terabytes",e)}},!1),days:!0,hours:!0,minutes:!0,seconds:!0};C33.FormatTime=function(e,t){t=Object.assign({},DEFAULT_FORMATTIME_OPTS,t),C33.Lang.PushContext("common.time");const s=[],n=self.lang,i=self.langPluralSub;if(t.days){const a=Math.floor(e/86400);0<a&&(e-=24*a*3600,s.push(i(".days",null,a)))}if(t.hours){const o=Math.floor(e/3600);(0<o||s.length)&&(e-=3600*o,s.push(i(".hours",null,o)))}if(t.minutes){const l=Math.floor(e/60);(0<l||s.length||!t.seconds)&&(e-=60*l,s.push(i(".minutes",null,l)))}if(t.seconds){const h=Math.floor(e%60);s.push(i(".seconds",null,h))}const r=(t.approximate?n(".approx-prefix"):"")+s.join(n(".separator"));return C33.Lang.PopContext(),r},C33.ZeroPad=function(e,t){let s=e<0?"-":"",n=(e=Math.abs(e)).toString(),i=t-n.length;for(let e=0;e<i;++e)s+="0";return s+n},C33.StringToTitleCase=function(e){return e.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())},C33.CompareVersionStrings=function(e,t){let s=e.split(".").map(e=>e.trim()),n=t.split(".").map(e=>e.trim());C33.resizeArray(s,4,"0"),C33.resizeArray(n,4,"0"),s=s.map(e=>parseInt(e,10)),n=n.map(e=>parseInt(e,10));for(let e=0;e<4;++e){const i=s[e]-n[e];if(0!=i)return i<0?-1:1}return 0},C33.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.floor(16*Math.random()),s="x"===e?t:3&t|8;return s.toString(16)})},C33.StringHammingDistance=function(s,n){if(s.length!==n.length)throw new Error("strings must be same length");let i=0;for(let e=0,t=s.length;e<t;++e)s.charAt(e)!==n.charAt(e)&&++i;return i},C33.StringLevenshteinDistance=function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;let s,n,i,r,a,o;for(t.length<e.length&&(s=e,e=t,t=s),o=Array(e.length+1),n=0;n<=e.length;n++)o[n]=n;for(n=1;n<=t.length;n++){for(r=n,i=1;i<=e.length;i++)a=t[n-1]===e[i-1]?o[i-1]:Math.min(o[i-1]+1,Math.min(r+1,o[i]+1)),o[i-1]=r,r=a;o[e.length]=r}return o[e.length]}}{let bbToHtmlReplacerFunc2=function(e,s,n){const i=BB_CODE_MAP.get(n);if(!i)return"class"===n?s?"</span>":`<span class="bbclass${classIndex++}">`:e;if("string"==typeof i){if("a"===i&&0===linkActions.length||"abbr"===i&&0===tipList.length)return e;if("a"!==i||s){if("abbr"!==i||s)return"<"+s+i+">";{const r=parseInt(n.substring(3),10)-1;if(r<0||r>=tipList.length)throw new Error("invalid bbcode tip substitution");let e=tipList[r],t="";if("string"==typeof e?t=e:"function"==typeof e&&(t=e()),"string"!=typeof t)throw new TypeError("invalid bbcode tip");return`<abbr title="${C33.ReplaceAll(t,'"',"&quot;")}">`}}{const t=parseInt(n.substring(1),10)-1;if(t<0||t>=linkActions.length)throw new Error("invalid bbcode link substitution");const a=linkActions[t];if("string"==typeof a)return`<a href="${linkActions[t]}">`;if("function"==typeof a)return`<a class="bblink${t}">`;throw new TypeError("invalid bbcode link action")}}if(Array.isArray(i)){let e=i[0],t=i[1];return s?"</"+e+">":`<${e} class="${t}">`}},C33=(bbToHtmlReplacerFunc=bbToHtmlReplacerFunc2,self.C3),assert=self.assert,BB_CODE_MAP=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]),SELF_CLOSING_TAGS=new Set(["icon"]),BBREGEX=/\[(\/?)([a-zA-Z0-9]+)\]/g,CUSTOM_BBREGEX=/\[(\/?)([^\[\n]*?)\]/g,linkActions=null,tipList=null,classIndex=0,LINEBREAK_REGEX=/\n/g;C33.BBString=class{constructor(e,t){if(this._bbstr=t&&t.noEscape?e:C33.EscapeHTML(e),this._htmlstr="",this._convertLineBreaks=!1,this._linkActions=[],this._tipList=[],t){if(this._convertLineBreaks=!!t.convertLineBreaks,t.links){if(9<t.links.length)throw new Error("too many links");this._linkActions=t.links}if(t.tips){if(9<t.tips.length)throw new Error("too many tips");this._tipList=t.tips}}this._hasAnyBBtags=this._bbstr.includes("["),this._needsLineBreakConversion=this._convertLineBreaks&&this._bbstr.includes("\n"),this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&"),this._hasParsedFragments=!1,this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){return this._hasAnyBBtags?this._bbstr.replace(BBREGEX,""):this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let e=this._bbstr;this._hasAnyBBtags&&(classIndex=0,linkActions=this._linkActions,tipList=this._tipList,e=e.replace(BBREGEX,bbToHtmlReplacerFunc2),linkActions=null,tipList=null),this._needsLineBreakConversion&&(e=e.replace(LINEBREAK_REGEX,"<br>")),this._htmlstr=e}return this._htmlstr}attachLinkHandlers(s){if(this._linkActions.length)for(let e=0,t=this._linkActions.length;e<t;++e){const n=this._linkActions[e];if("function"==typeof n){const i=s.querySelector(".bblink"+e);if(!i)throw new Error("unable to attach BBString link handler");i.onclick=n}}}equals(e){return e instanceof C33.HtmlString?this.toHTML()===e.toHTML():e instanceof C33.BBString?this._bbstr===e._bbstr:this._bbstr===e}toFragmentList(){if(!this._hasParsedFragments){let n=[],e=this._bbstr,i=[],t=CUSTOM_BBREGEX.lastIndex=0,s;for(;null!==(s=CUSTOM_BBREGEX.exec(e));){const r=s.index;if(!(0<r&&"\\"===e.charAt(r-1))){const a=s[0],o=s[1],l=s[2],h=e.substring(t,r);if(t=r+a.length,h&&n.push({text:h,styles:i.slice(0)}),l)if(o){const c=l.toLowerCase();for(let e=i.length-1;0<=e;--e)if(i[e].tag===c){i.splice(e,1);break}}else{let e=l,t=null,s=l.indexOf("=");if(-1!==s?(e=l.substring(0,s).toLowerCase(),t=l.substring(s+1)):e=e.toLowerCase(),SELF_CLOSING_TAGS.has(e)){if("icon"!==e)throw new Error("unknown self-closing tag "+e);n.push({icon:t,styles:i.slice(0)})}else i.push({tag:e,param:t})}}}t<e.length&&n.push({text:e.substring(t),styles:i.slice(0)});for(const u of n)u.text&&(u.text=this._ProcessBBCodeEscapeSequences(u.text));this._fragments=n.map(e=>e.icon?C33.New(C33.IconFragment,{icon:e.icon,styles:e.styles}):C33.New(C33.TextFragment,{chArr:C33.SplitGraphemes(e.text),styles:e.styles})),this._hasParsedFragments=!0}return this._fragments}_ProcessBBCodeEscapeSequences(e){return e=C33.ReplaceAll(e,"\\[","["),C33.ReplaceAll(e,"\\\\","\\")}static StripTags(e){return C33.New(C33.BBString,e,{noEscape:!0}).toPlainText()}static StripAnyTags(e){return e.replace(CUSTOM_BBREGEX,"")}}}{let IsWordBreakWhiteSpace2=function(e){return""!==e&&""!==e&&C33.IsWhitespaceChar(e)},IsOpeningCJKPunctiationChar2=function(e){return CJK_OPEN_PUNCTUATION.has(e)},IsContinuingCJKPunctuationChar2=function(e){return C33.IsCJKPunctuationChar(e)&&!IsOpeningCJKPunctiationChar2(e)},WordBreakTrimEnd2=function(e){for(;0<e.length&&IsWordBreakWhiteSpace2(e.at(-1));)e.pop()},IsNewline2=function(e){return"\n"===e||"\r\n"===e};IsWordBreakWhiteSpace=IsWordBreakWhiteSpace2,IsOpeningCJKPunctiationChar=IsOpeningCJKPunctiationChar2,IsContinuingCJKPunctuationChar=IsContinuingCJKPunctuationChar2,WordBreakTrimEnd=WordBreakTrimEnd2,IsNewline=IsNewline2;const C33=self.C3,CJK_OPEN_PUNCTUATION=new Set("");C33.WordWrap=class{constructor(){this._lines=[],this._iconSet=null}GetLines(){return this._lines}GetLineCount(){return this._lines.length}SetIconSet(e){this._iconSet=e}_MeasureLine(e,t){let s=0,n=0,i=0,r=0,a=0;for(const o of e){if(-1===o.GetWidth()){const l=t(o);o.SetHeight(l.height),o.SetFontBoundingBoxAscent(l.fontBoundingBoxAscent||0),o.SetFontBoundingBoxDescent(l.fontBoundingBoxDescent||0),o.SetTopToAlphabeticDistance(l.topToAlphabeticDistance||0),o.IsText()?o.SetWidth(l.width):o.IsIcon()&&o.CalculateWidthFromHeight(this._iconSet)}s+=o.GetWidth(),n=Math.max(n,o.GetHeight()),i=Math.max(i,o.GetFontBoundingBoxAscent()),r=Math.max(r,o.GetFontBoundingBoxDescent()),a=Math.max(a,o.GetTopToAlphabeticDistance())}return{width:s,height:n,fontBoundingBoxAscent:i,fontBoundingBoxDescent:r,topToAlphabeticDistance:a}}_AddLine(e,t,s,n,i,r){this._lines.push(C33.New(C33.WordWrap.Line,{fragments:e,width:t,height:s,fontBoundingBoxAscent:n,fontBoundingBoxDescent:i,topToAlphabeticDistance:r}))}WordWrap(t,r,a,s,o){if("string"==typeof t&&(t=[C33.New(C33.TextFragment,{chArr:C33.SplitGraphemes(t)})]),C33.clearArray(this._lines),!(!t.length||1===t.length&&t[0].IsText()&&t[0].IsEmpty()||a<2)){if(1===t.length){const l=t[0];if(l.IsText()&&l.GetLength()<=100&&!l.HasNewLine()){let{width:e,height:t,fontBoundingBoxAscent:s,fontBoundingBoxDescent:n,topToAlphabeticDistance:i}=r(l);if(e+=o,l.SetWidth(e),l.SetHeight(t),l.SetFontBoundingBoxAscent(s||0),l.SetFontBoundingBoxDescent(n||0),l.SetTopToAlphabeticDistance(i||0),e<=a)return void this._AddLine([l],e,t,s,n,i)}}let e;e="word"===s?this._TokeniseByWord(t):"cjk"===s?this._TokeniseByCJK(t):this._TokeniseByChar(t),this._WrapText(e,r,a,o)}}_TokeniseByWord(e){let t=[],s=[],n=!1;for(const i of e){const r=i.GetStyles();if(i.IsIcon())0<s.length&&t.push(s),t.push([i]),s=[];else for(const a of i.GetCharacterArray())if(IsNewline2(a))0<s.length&&t.push(s),t.push([C33.New(C33.TextFragment,{chArr:["\n"],styles:r})]),s=[];else if(0===s.length)s.push(C33.New(C33.TextFragment,{chArr:[a],styles:r})),n=IsWordBreakWhiteSpace2(a);else{const o=IsWordBreakWhiteSpace2(a);if(o===n){const l=s.at(-1);l.GetStyles()===r?l._AppendChar(a):s.push(C33.New(C33.TextFragment,{chArr:[a],styles:r}))}else t.push(s),s=[C33.New(C33.TextFragment,{chArr:[a],styles:r})],n=o}}return 0<s.length&&t.push(s),t}_TokeniseByCJK(e){let t=[],s=[],n=!1;for(const i of e){const r=i.GetStyles();if(i.IsIcon())0<s.length&&t.push(s),t.push([i]),s=[];else for(const a of i.GetCharacterArray())if(IsNewline2(a))0<s.length&&t.push(s),t.push([C33.New(C33.TextFragment,{chArr:["\n"],styles:r})]),s=[];else{if(0===s.length)s.push(C33.New(C33.TextFragment,{chArr:[a],styles:r}));else if(n||IsContinuingCJKPunctuationChar2(a)){const o=s.at(-1);o.GetStyles()===r?o._AppendChar(a):s.push(C33.New(C33.TextFragment,{chArr:[a],styles:r}))}else t.push(s),s=[C33.New(C33.TextFragment,{chArr:[a],styles:r})];n=IsOpeningCJKPunctiationChar2(a)}}return 0<s.length&&t.push(s),t}_TokeniseByChar(e){const t=[];for(const s of e)if(s.IsText()){const n=s.GetCharacterArray();C33.appendArray(t,n.map(e=>[C33.New(C33.TextFragment,{chArr:[e],styles:s.GetStyles()})]))}else t.push([s]);return t}_CopyLine(e){return e.map(e=>e._Clone())}_AddWordToLine(t,s){let e=t.length?t.at(-1):null,n=0;e&&e.IsText()&&s[0].IsText()&&s[0].GetStyles()===e.GetStyles()&&(e._Append(s[0].GetCharacterArray()),n=1);for(let e=s.length;n<e;++n){const i=s[n];t.push(i._Clone())}}_WrapText(e,t,s,n){let i=[],r=0,a=0,o=0,l=0,h=0;for(const c of e)if(1===c.length&&c[0].IsText()&&1===c[0].GetLength()&&IsNewline2(c[0].GetCharacterArray()[0])){if(0===a){const u=C33.New(C33.TextFragment,{chArr:[" "],styles:c[0].GetStyles()}),d=t(u);a=d.height,o=d.fontBoundingBoxAscent||0,l=d.fontBoundingBoxDescent||0,h=d.topToAlphabeticDistance||0}this._AddLine(i,r,a,o,l,h),i=[],r=0,a=0,o=0,l=0,h=0}else{const _=this._CopyLine(i),p=(this._AddWordToLine(_,c),this._MeasureLine(_,t)),m=p.width;if(s<=m)if(0<i.length&&this._AddLine(i,r,a,o,l,h),i=[],c[0].IsText()&&C33.IsCharArrayAllWhitespace(c[0].GetCharacterArray()))r=0,a=0,o=0,l=0,h=0;else{this._AddWordToLine(i,c);const g=this._MeasureLine(i,t);r=g.width,a=g.height,o=g.fontBoundingBoxAscent,l=g.fontBoundingBoxDescent,h=g.topToAlphabeticDistance}else i=_,r=m,a=p.height,o=p.fontBoundingBoxAscent,l=p.fontBoundingBoxDescent,h=p.topToAlphabeticDistance}0<i.length&&this._AddLine(i,r,a,o,l,h),this._TrimLinesTrailingWhitespace(t,n)}_TrimLinesTrailingWhitespace(t,s){for(const n of this._lines){const i=n._GetFragmentsArray();if(i.length){let e=i.at(-1);if(e.IsText()){const r=e.GetCharacterArray(),a=r.slice(0);if(WordBreakTrimEnd2(a),0===a.length)n.OffsetWidth(-e.GetWidth()),i.pop();else if(a.length<r.length){e.SetCharacterArray(a);const o=t(e).width,l=e.GetWidth()-o;e.SetWidth(o),n.OffsetWidth(-l)}0!==s&&0<i.length&&((e=i.at(-1)).OffsetWidth(s),n.OffsetWidth(s))}}}}Clear(){C33.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce((e,t)=>Math.max(e,t.GetWidth()),0)}GetTotalLineHeight(){return this._lines.reduce((e,t)=>e+t.GetHeight(),0)}}}{const C33=self.C3;C33.WordWrap.Line=class{constructor(e){this._fragments=e.fragments||[],this._width=e.width||-1,this._height=e.height||-1,this._fontBoundingBoxAscent=e.fontBoundingBoxAscent||-1,this._fontBoundingBoxDescent=e.fontBoundingBoxDescent||-1,this._topToAlphabeticDistance=e.topToAlphabeticDistance||-1,this._posX=0,this._posY=0}fragments(){return this._fragments.values()}*fragmentsReverse(){const t=this._fragments;for(let e=t.length-1;0<=e;--e)yield t[e]}_GetFragmentsArray(){return this._fragments}OffsetWidth(e){this._width+=e}GetWidth(){return this._width}GetHeight(){return this._height}GetFoundBoundingBoxAscent(){return this._fontBoundingBoxAscent}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(e){this._posX=e}GetPosX(){return this._posX}SetPosY(e){this._posY=e}GetPosY(){return this._posY}}}{const C33=self.C3;C33.FragmentBase=class{constructor(e){this._styles=e.styles||[],this._width=e.width||-1,this._height=e.height||-1,this._fontBoundingBoxAscent=e.fontBoundingBoxAscent||-1,this._fontBoundingBoxDescent=e.fontBoundingBoxDescent||-1,this._topToAlphabeticDistance=e.topToAlphabeticDistance||-1,this._posX=0,this._posY=0}IsText(){return!1}IsIcon(){return!1}GetStyles(){return this._styles}GetStyleTag(t){const s=this._styles;for(let e=s.length-1;0<=e;--e){const n=s[e];if(n.tag===t)return n}return null}HasStyleTag(e){return!!this.GetStyleTag(e)}GetStyleMap(){const e=new Map;for(const t of this._styles)e.set(t.tag,t.param);return e}OffsetWidth(e){this._width+=e}SetWidth(e){this._width=e}GetWidth(){return this._width}SetHeight(e){this._height=e}GetHeight(){return this._height}SetFontBoundingBoxAscent(e){this._fontBoundingBoxAscent=e}GetFontBoundingBoxAscent(){return this._fontBoundingBoxAscent}SetFontBoundingBoxDescent(e){this._fontBoundingBoxDescent=e}GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent}SetTopToAlphabeticDistance(e){this._topToAlphabeticDistance=e}GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance}SetPosX(e){this._posX=e}GetPosX(){return this._posX}SetPosY(e){this._posY=e}GetPosY(){return this._posY}}}{const C33=self.C3;C33.TextFragment=class extends C33.FragmentBase{constructor(e){super(e),this._chArr=e.chArr}IsText(){return!0}_Append(e){C33.appendArray(this._chArr,e),this._width=-1,this._height=-1,this._fontBoundingBoxAscent=-1,this._fontBoundingBoxDescent=-1,this._topToAlphabeticDistance=-1}_AppendChar(e){this._chArr.push(e)}_Clone(){return C33.New(C33.TextFragment,{chArr:this._chArr.slice(0),styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetCharacterArray(){return this._chArr}SetCharacterArray(e){this._chArr=e}GetLength(){return this._chArr.length}IsEmpty(){return 0===this._chArr.length}HasNewLine(){return this._chArr.includes("\n")}}}{const C33=self.C3;C33.IconFragment=class extends C33.FragmentBase{constructor(e){super(e),this._icon=e.icon}IsIcon(){return!0}GetIconParameter(){return this._icon}_Clone(){return C33.New(C33.IconFragment,{icon:this._icon,styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance})}GetTextIcon(e){if(!e)return null;let t=Number(this._icon);return String(t)===this._icon?(t=Math.floor(t),e.GetTextIconByIndex(t)):e.GetTextIconByTag(this._icon)}CalculateWidthFromHeight(e){const t=this.GetTextIcon(e);this._width=t?this._height*t.GetWidth()/t.GetHeight():0}GetDrawable(e){const t=this.GetTextIcon(e);return t?t.GetDrawable():null}GetLength(){return 1}}}{const C33=self.C3;C33.TextIconManager=class{constructor(e){this._iconSets=new Map,this._getIconSetMetaCallback=e.getIconSetMeta,this._getIconSetContentCallback=e.getIconSetContent}Release(){for(const e of this._iconSets.values())e.Release();this._iconSets.clear()}GetIconSet(e){let t=this._iconSets.get(e);if(!t){const s=this._getIconSetMetaCallback(e);t=C33.New(C33.TextIconSet,this,{source:e,iconMeta:s}),this._iconSets.set(e,t)}return t}HasIconSet(e){return this._iconSets.has(e)}DeleteIconSet(e){const t=this._iconSets.get(e);t&&t.Release(),this._iconSets.delete(e)}async _GetIconSetContent(e){return this._getIconSetContentCallback(e)}}}{const C33=self.C3;C33.TextIconSet=class{constructor(e,t){this._textIconManager=e,this._source=t.source,this._iconsArray=[],this._iconsByTag=new Map,this._hasStartedLoad=!1,this._isLoading=!1,this._loadPromise=null;const s=t.iconMeta.icons;for(let e=0,t=s.length;e<t;++e){const n=s[e],i=C33.New(C33.TextIcon,this,{index:e,tag:n.tag,source:n.source,width:n.width,height:n.height});this._iconsArray.push(i),n.tag&&this._iconsByTag.set(n.tag.toLowerCase(),i)}}Release(){for(const e of this._iconsArray)e.Release();C33.clearArray(this._iconsArray),this._iconsByTag.clear(),this._textIconManager=null,this._source=null}HasLoaded(){return this._hasStartedLoad}IsLoading(){return this._isLoading}LoadContent(){return this._loadPromise||(this._loadPromise=this._DoLoadContent()),this._loadPromise}async _DoLoadContent(){if(!this._hasStartedLoad){this._hasStartedLoad=!0,this._isLoading=!0;const e=await this._textIconManager._GetIconSetContent(this._source);if(this._textIconManager){const s=e.icons;for(let e=0,t=Math.min(s.length,this._iconsArray.length);e<t;++e){const n=s[e].drawable;this._iconsArray[e]._SetDrawable(n)}this._isLoading=!1}}}GetTextIconByIndex(e){return(e=Math.floor(e))<0||e>=this._iconsArray.length?null:this._iconsArray[e]}GetTextIconByTag(e){return this._iconsByTag.get(e.toLowerCase())||null}}}{const C33=self.C3;C33.TextIcon=class{constructor(e,t){this._textIconSet=e,this._source=t.source||null,this._index=t.index,this._tag=t.tag,this._width=t.width,this._height=t.height,this._drawable=null}Release(){this._width=0,this._height=0,this._textIconSet=null}GetSource(){return this._source}GetWidth(){return this._width}GetHeight(){return this._height}_SetDrawable(e){this._drawable=e}GetDrawable(){return this._drawable}}}{let PlaneFromPoints2=function(e,t,s,n){const i=tempVec3c;vec32.subtract(tempVec3a,s,t),vec32.subtract(tempVec3b,e,t),vec32.cross(i,tempVec3a,tempVec3b),vec32.normalize(i,i),n.set(i[0],i[1],i[2],vec32.dot(e,i))},IsInFrontOfPlane2=function(e,t,s,n,i,r,a){const o=a.x,l=a.y,h=a.z,c=a.w,u=a.xF,d=a.yF,_=a.zF,p=1-u,m=1-d,g=1-_,f=o*e*u+o*n*p+l*t*d+l*i*m+h*s*_+h*r*g;if(c<=f)return!0;const S=o*n*u+o*e*p+l*i*d+l*t*m+h*r*_+h*s*g;return c<S},IsPointInFrontOfPlane2=function(e,t,s,n){const i=n.x,r=n.y,a=n.z,o=n.w,l=i*e+r*t+a*s;return o<=l};PlaneFromPoints=PlaneFromPoints2,IsInFrontOfPlane=IsInFrontOfPlane2,IsPointInFrontOfPlane=IsPointInFrontOfPlane2;const C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,tempVec3a=vec32.create(),tempVec3b=vec32.create(),tempVec3c=vec32.create(),tempVec4=vec42.create(),tempMat4=mat42.create(),neartl=vec32.create(),neartr=vec32.create(),nearbl=vec32.create(),nearbr=vec32.create(),fartl=vec32.create(),fartr=vec32.create(),farbl=vec32.create(),farbr=vec32.create(),unitViewport=vec42.fromValues(0,0,1,1);C33.Gfx={Project(e,t,s,n,i,r,a){let o=n[0]*e+n[4]*t+n[8]*s+n[12],l=n[1]*e+n[5]*t+n[9]*s+n[13],h=n[2]*e+n[6]*t+n[10]*s+n[14],c=n[3]*e+n[7]*t+n[11]*s+n[15],u=i[0]*o+i[4]*l+i[8]*h+i[12]*c,d=i[1]*o+i[5]*l+i[9]*h+i[13]*c,_=i[2]*o+i[6]*l+i[10]*h+i[14]*c,p=i[3]*o+i[7]*l+i[11]*h+i[15]*c;return 0!=p&&(d*=p=1/p,_*=p,a[0]=(.5*(u*=p)+.5)*r[2]+r[0],a[1]=(.5*d+.5)*r[3]+r[1],a[2]=.5*(1+_),!0)},Unproject(e,t,s,n,i,r,a){const o=tempMat4,l=tempVec4;return mat42.multiply(o,i,n),null!==mat42.invert(o,o)&&(l[0]=(e-r[0])/r[2]*2-1,l[1]=(t-r[1])/r[3]*2-1,l[2]=2*s-1,l[3]=1,vec42.transformMat4(l,l,o),0!==l[3])&&(l[3]=1/l[3],a[0]=l[0]*l[3],a[1]=l[1]*l[3],a[2]=l[2]*l[3],!0)},UnprojectScreenToWorldZ(e,t,s,n,i,r,a){const o=tempVec3a,l=tempVec3b;if(!C33.Gfx.Unproject(e,t,0,n,i,r,o))return!1;if(!C33.Gfx.Unproject(e,t,1,n,i,r,l))return!1;let h=tempVec3b,c=(vec32.subtract(h,l,o),tempVec3c),u=(vec32.set(c,0,0,1),-s),d=vec32.dot(c,h),_=0;if(0===d){const p=vec32.dot(c,o)+u;if(0!==p)return!1}else if((_=-(vec32.dot(o,c)+u)/d)<0)return!1;return vec32.scaleAndAdd(a,o,h,_),!0}};class Plane{constructor(){this.x=NaN,this.y=NaN,this.z=NaN,this.w=NaN,this.xF=NaN,this.yF=NaN,this.zF=NaN}set(e,t,s,n){this.x=e,this.y=t,this.z=s,this.w=n,this.xF=0<e?1:0,this.yF=0<t?1:0,this.zF=0<s?1:0}}C33.Gfx.ViewFrustum=class{constructor(){this._leftP=new Plane,this._topP=new Plane,this._rightP=new Plane,this._bottomP=new Plane,this._nearP=new Plane,this._farP=new Plane}CalculatePlanes(e,t){const s=unitViewport;C33.Gfx.Unproject(0,1,0,e,t,s,neartl),C33.Gfx.Unproject(1,1,0,e,t,s,neartr),C33.Gfx.Unproject(0,0,0,e,t,s,nearbl),C33.Gfx.Unproject(1,0,0,e,t,s,nearbr),C33.Gfx.Unproject(0,1,1,e,t,s,fartl),C33.Gfx.Unproject(1,1,1,e,t,s,fartr),C33.Gfx.Unproject(0,0,1,e,t,s,farbl),C33.Gfx.Unproject(1,0,1,e,t,s,farbr),PlaneFromPoints2(nearbl,neartl,fartl,this._leftP),PlaneFromPoints2(neartl,neartr,fartr,this._topP),PlaneFromPoints2(neartr,nearbr,farbr,this._rightP),PlaneFromPoints2(nearbr,nearbl,farbl,this._bottomP),PlaneFromPoints2(farbl,fartl,fartr,this._farP),PlaneFromPoints2(nearbr,neartr,neartl,this._nearP)}ContainsAABB(e,t,s,n,i,r){return IsInFrontOfPlane2(e,t,s,n,i,r,this._leftP)&&IsInFrontOfPlane2(e,t,s,n,i,r,this._topP)&&IsInFrontOfPlane2(e,t,s,n,i,r,this._rightP)&&IsInFrontOfPlane2(e,t,s,n,i,r,this._bottomP)&&IsInFrontOfPlane2(e,t,s,n,i,r,this._nearP)&&IsInFrontOfPlane2(e,t,s,n,i,r,this._farP)}IsBehindNearPlane(e,t,s){return!IsPointInFrontOfPlane2(e,t,s,this._nearP)}}}{const C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,tempMat4=mat42.create(),tmpVec3a=vec32.fromValues(0,0,0),tmpVec3b=vec32.fromValues(0,0,0),tmpVec3c=vec32.fromValues(0,0,0),defaultUpVector=vec32.fromValues(0,1,0),tmpVec4=vec42.fromValues(0,0,0,0),tmpQuad=new C33.Quad,tmpRect=new C33.Rect,defaultTexCoordsQuad=new C33.Quad(0,0,1,0,1,1,0,1),DEFAULT_RENDERERBASE_OPTS={nearZ:1,farZ:1e4},matWebGLtoWebGPU=mat42.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);C33.Gfx.RendererBase=class{constructor(e){e=Object.assign({},DEFAULT_RENDERERBASE_OPTS,e),this._width=0,this._height=0,this._fovY=C33.toRadians(45),this._tan_fovY_2=Math.tan(this._fovY/2),this._matP=mat42.create(),this._matMV=mat42.create(),this._zAxisScale=!1,this._nearZ=e.nearZ,this._farZ=e.farZ,this._allShaderPrograms=[],this._shaderProgramsByName=new Map,this._spTextureFill=null,this._spPoints=null,this._spTilemapFill=null,this._spTileRandomization=null,this._spColorFill=null,this._spLinearGradientFill=null,this._spPenumbraFill=null,this._spHardEllipseFill=null,this._spHardEllipseOutline=null,this._spSmoothEllipseFill=null,this._spSmoothEllipseOutline=null,this._spSmoothLineFill=null,this._stateGroups=new Map,this._currentStateGroup=null,this._blendModeTable=[],this._namedBlendModeMap=new Map,this._baseZ=0,this._currentZ=0,this._lineWidth=1,this._lineWidthStack=[this._lineWidth],this._lineCap=1,this._lineCapStack=[this._lineCap],this._lineOffset=.5,this._lineOffsetStack=[this._lineOffset],this._frameNumber=0,this._enableMipmaps=!0,this._hasMajorPerformanceCaveat=!1}FillIndexBufferData(e){let t=0,s=e.length,n=0;for(;t<s;)e[t++]=n,e[t++]=n+1,e[t++]=n+2,e[t++]=n,e[t++]=n+2,e[t++]=n+3,n+=4}_ClearState(){this._baseZ=0,this._currentZ=0,this._spTextureFill=null,this._spPoints=null,this._spTilemapFill=null,this._spTileRandomization=null,this._spColorFill=null,this._spLinearGradientFill=null,this._spPenumbraFill=null,this._spHardEllipseFill=null,this._spHardEllipseOutline=null,this._spSmoothEllipseFill=null,this._spSmoothEllipseOutline=null,this._spSmoothLineFill=null,this._ClearAllShaderPrograms()}InitState(){this._ClearState(),this._currentStateGroup=null}OnDeviceOrContextLost(){for(const e of this._allShaderPrograms)e.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(e){return this.IsZAxisScaleNormalized()?100:e/(2*this._GetTanFovYDiv2())}GetZAxisScaleFactor(e){if(this.IsZAxisScaleNormalized()){const t=e/(2*this._GetTanFovYDiv2());return t/this.GetDefaultCameraZ(e)}return 1}SetNearZ(e){this._nearZ=e}GetNearZ(){return this._nearZ}SetFarZ(e){this._farZ=e}GetFarZ(){return this._farZ}SetFovY(e){this._fovY=e,this._tan_fovY_2=Math.tan(this._fovY/2)}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}SetZAxisScaleNormalized(){this._zAxisScale=!1}SetZAxisScaleRegular(){this._zAxisScale=!0}IsZAxisScaleNormalized(){return!this._zAxisScale}IsZAxisScaleRegular(){return this._zAxisScale}CalculatePerspectiveMatrix(e,t,s=.5,n=.5){const i=this.GetNearZ(),r=this.GetFarZ(),a=this.GetFovY();if(.5===s&&.5===n)this.IsWebGPU()?mat42.perspectiveZO(e,a,t,i,r):mat42.perspective(e,a,t,i,r);else{const o=2*(s=1-s)-2,l=2*s,h=2*n-2,c=2*n,u=this._GetTanFovYDiv2()*i,d=u*t;mat42.frustum(e,o*d,l*d,h*u,c*u,i,r),this.IsWebGPU()&&mat42.mul(e,matWebGLtoWebGPU,e)}}CalculateOrthographicMatrix(e,t,s,n=1){const i=self.devicePixelRatio,r=2*this.GetDefaultCameraZ(s)*i*this._GetTanFovYDiv2()/s,a=t*r/(2*i*n),o=s*r/(2*i*n),l=-a,h=a,c=-o,u=o;this.IsWebGPU()?mat42.orthoZO(e,l,h,c,u,this.GetNearZ(),this.GetFarZ()):mat42.ortho(e,l,h,c,u,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(e,t,s,n,i,r=1){let a=1;this.IsZAxisScaleNormalized()&&(a=200*this._GetTanFovYDiv2()/i);const o=tmpVec3c,l=(vec32.set(o,a,-a,1),tmpVec3a),h=tmpVec3b;vec32.multiply(l,t,o),vec32.multiply(h,s,o),mat42.lookAt(e,l,h,n||defaultUpVector),o[2]=r,mat42.scale(e,e,o)}CalculateLookAtModelView2(e,t,s,n,i,r,a,o){return vec32.set(tmpVec3a,e,t,s),vec32.set(tmpVec3b,n,i,r),this.CalculateLookAtModelView(tempMat4,tmpVec3a,tmpVec3b,defaultUpVector,a,o),tempMat4}_AddShaderProgram(e){this._allShaderPrograms.push(e),this._shaderProgramsByName.set(e.GetName(),e)}_RemoveShaderProgram(e){const t=this._allShaderPrograms.indexOf(e);-1!==t&&this._allShaderPrograms.splice(t,1),this._shaderProgramsByName.delete(e.GetName())}_ClearAllShaderPrograms(){C33.clearArray(this._allShaderPrograms),this._shaderProgramsByName.clear()}GetShaderProgramByName(e){return this._shaderProgramsByName.get(e)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(e){this._currentStateGroup=e}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(e,t,s,n){let i=C33.Gfx.StateGroup.MakeKey(e,t,s,n),r=this._stateGroups.get(i);return r||(r=C33.New(C33.Gfx.StateGroup,this,e,t,s,n),this._stateGroups.set(i,r)),r.AddRef(),r}ReleaseStateGroup(e){e.DecRef(),0===e._GetRefCount()&&(this._currentStateGroup===e&&(this._currentStateGroup=null),this._stateGroups.delete(e.GetKey()),e.Release())}_InitBlendModeData(e){C33.clearArray(this._blendModeTable),this._namedBlendModeMap.clear();let t=0;for(const s of e){const n=s[0],i=s[1],r=s[2];this._blendModeTable.push([i,r]),this._namedBlendModeMap.set(n,{number:t,srcBlend:i,destBlend:r}),t++}}_GetBlendByIndex(e){return this._blendModeTable[e]}GetSrcBlendByIndex(e){return this._GetBlendByIndex(e)[0]}GetDestBlendByIndex(e){return this._GetBlendByIndex(e)[1]}GetNamedBlend(e){const t=this._namedBlendModeMap.get(e);if(void 0===t)throw new Error("invalid blend name");return t}NamedBlendToNumber(e){const t=this._namedBlendModeMap.get(e);if(void 0===t)throw new Error("invalid blend name");return t.number}SetBaseZ(e){this._baseZ=e}GetBaseZ(){return this._baseZ}SetCurrentZ(e){this._currentZ=e,this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(e,t,s,n){const i=C33.angleTo(e,t,s,n),r=Math.sin(i),a=Math.cos(i),o=.5*this._lineWidth,l=r*o,h=a*o,c=this._lineCap;2===c?this.LinePreCalc_LineCap2(e,t,0,s,n,0,l,h):1===c?this.LinePreCalc_LineCap1(e,t,0,s,n,0,l,h):this.LinePreCalc_LineCap0(e,t,0,s,n,0,l,h)}Line3D(e,t,s,n,i,r){const a=C33.angleTo(e,t,n,i),o=Math.sin(a),l=Math.cos(a),h=.5*this._lineWidth,c=o*h,u=l*h,d=this._lineCap;2===d?this.LinePreCalc_LineCap2(e,t,s,n,i,r,c,u):1===d?this.LinePreCalc_LineCap1(e,t,s,n,i,r,c,u):this.LinePreCalc_LineCap0(e,t,s,n,i,r,c,u)}LinePreCalc_LineCap2(e,t,s,n,i,r,a,o){const l=this._lineOffset,h=e+l-o,c=t+l-a,u=n+l+o,d=i+l+a,_=2*o,p=2*a,m=h+a,g=c-o,f=h-a+_,S=c+o+p,y=u+a,C=d-o,G=u-a-_,T=d+o-p;this.Quad3D2(m,g,s,y,C,r,G,T,r,f,S,s,defaultTexCoordsQuad)}LinePreCalc_LineCap1(e,t,s,n,i,r,a,o){const l=this._lineOffset,h=e+l-o,c=t+l-a,u=n+l+o,d=i+l+a,_=h+a,p=c-o,m=h-a,g=c+o,f=u+a,S=d-o,y=u-a,C=d+o;this.Quad3D2(_,p,s,f,S,r,y,C,r,m,g,s,defaultTexCoordsQuad)}LinePreCalc_LineCap0(e,t,s,n,i,r,a,o){const l=this._lineOffset,h=e+l,c=t+l,u=n+l,d=i+l,_=h+a,p=c-o,m=h-a,g=c+o,f=u+a,S=d-o,y=u-a,C=d+o;this.Quad3D2(_,p,s,f,S,r,y,C,r,m,g,s,defaultTexCoordsQuad)}TexturedLine(e,t,s,n,i,r){const a=C33.angleTo(e,t,s,n),o=Math.sin(a),l=Math.cos(a),h=.5*this._lineWidth,c=o*h,u=l*h,d=this._lineCap;2===d?this.TexturedLinePreCalc_LineCap2(e,t,s,n,c,u,i,r):1===d?this.TexturedLinePreCalc_LineCap1(e,t,s,n,c,u,i,r):this.TexturedLinePreCalc_LineCap0(e,t,s,n,c,u,i,r)}TexturedLinePreCalc_LineCap2(e,t,s,n,i,r,a,o){const l=this._lineOffset,h=e+l-r,c=t+l-i,u=s+l+r,d=n+l+i,_=2*r,p=2*i,m=h+i,g=c-r,f=h-i+_,S=c+r+p,y=u+i,C=d-r,G=u-i-_,T=d+r-p;tmpQuad.set(m,g,y,C,G,T,f,S),tmpRect.set(a,0,o,0),this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap1(e,t,s,n,i,r,a,o){const l=this._lineOffset,h=e+l-r,c=t+l-i,u=s+l+r,d=n+l+i,_=h+i,p=c-r,m=h-i,g=c+r,f=u+i,S=d-r,y=u-i,C=d+r;tmpQuad.set(_,p,f,S,y,C,m,g),tmpRect.set(a,0,o,0),this.Quad3(tmpQuad,tmpRect)}TexturedLinePreCalc_LineCap0(e,t,s,n,i,r,a,o){const l=this._lineOffset,h=e+l,c=t+l,u=s+l,d=n+l,_=h+i,p=c-r,m=h-i,g=c+r,f=u+i,S=d-r,y=u-i,C=d+r;tmpQuad.set(_,p,f,S,y,C,m,g),tmpRect.set(a,0,o,0),this.Quad3(tmpQuad,tmpRect)}LineRect(e,t,s,n){const i=.5*this._lineWidth,r=this._lineCap;2===r?this._LineRectPreCalc_LineCap2(e,t,s,n,i):1===r?this._LineRectPreCalc_LineCap1(e,t,s,n,i):this._LineRectPreCalc_LineCap0(e,t,s,n,i)}_LineRectPreCalc_LineCap2(e,t,s,n,i){this.LinePreCalc_LineCap2(e,t,0,s,t,0,0,i),this.LinePreCalc_LineCap2(s,t,0,s,n,0,i,0),this.LinePreCalc_LineCap2(s,n,0,e,n,0,0,-i),this.LinePreCalc_LineCap2(e,n,0,e,t,0,-i,0)}_LineRectPreCalc_LineCap1(e,t,s,n,i){this.LinePreCalc_LineCap1(e,t,0,s,t,0,0,i),this.LinePreCalc_LineCap1(s,t,0,s,n,0,i,0),this.LinePreCalc_LineCap1(s,n,0,e,n,0,0,-i),this.LinePreCalc_LineCap1(e,n,0,e,t,0,-i,0)}_LineRectPreCalc_LineCap0(e,t,s,n,i){this.LinePreCalc_LineCap0(e,t,0,s,t,0,0,i),this.LinePreCalc_LineCap0(s,t,0,s,n,0,i,0),this.LinePreCalc_LineCap0(s,n,0,e,n,0,0,-i),this.LinePreCalc_LineCap0(e,n,0,e,t,0,-i,0)}LineRect2(e){this.LineRect(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}LineQuad(e){const t=C33.angleTo(e.getTlx(),e.getTly(),e.getTrx(),e.getTry()),s=Math.sin(t),n=Math.cos(t),i=.5*this._lineWidth,r=s*i,a=n*i,o=this._lineCap;2===o?this._LineQuadPreCalc_LineCap2(e,r,a):1===o?this._LineQuadPreCalc_LineCap1(e,r,a):this._LineQuadPreCalc_LineCap0(e,r,a)}_LineQuadPreCalc_LineCap2(e,t,s){this.LinePreCalc_LineCap2(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap2(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap2(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap2(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap1(e,t,s){this.LinePreCalc_LineCap1(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap1(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap1(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap1(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap0(e,t,s){this.LinePreCalc_LineCap0(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap0(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap0(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap0(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}SetLineWidth(e){this._lineWidth=e,this._lineWidthStack[this._lineWidthStack.length-1]=e}GetLineWidth(){return this._lineWidth}PushLineWidth(e){if(100<=this._lineWidthStack.length)throw new Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(e),this._lineWidth=e}PopLineWidth(){if(this._lineWidthStack.length<=1)throw new Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop(),this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=2,this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(e){if("butt"===e)this.PushLineCapButt();else if("square"===e)this.PushLineCapSquare();else{if("zag"!==e)throw new Error("invalid line cap");this.PushLineCapZag()}}PushLineCapButt(){if(100<=this._lineCapStack.length)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0),this._lineCap=0}PushLineCapSquare(){if(100<=this._lineCapStack.length)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1),this._lineCap=1}PushLineCapZag(){if(100<=this._lineCapStack.length)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2),this._lineCap=2}PopLineCap(){if(this._lineCapStack.length<=1)throw new Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop(),this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(e){this._lineOffset=e,this._lineOffsetStack[this._lineOffsetStack.length-1]=e}GetLineOffset(){return this._lineOffset}PushLineOffset(e){if(100<=this._lineOffsetStack.length)throw new Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(e),this._lineOffset=e}PopLineOffset(){if(this._lineOffsetStack.length<=1)throw new Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop(),this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(t){const e=t.length/2;if(e<3)throw new Error("need at least 3 points");const s=e-2,n=s-1,i=t[0],r=t[1];for(let e=0;e<s;e+=2){const a=2*e,o=t[2+a],l=t[3+a],h=t[4+a],c=t[5+a];if(e===n)this.Quad2(i,r,o,l,h,c,h,c);else{const u=t[6+a],d=t[7+a];this.Quad2(i,r,o,l,h,c,u,d)}}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(!0),this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(e){this._enableMipmaps=!!e}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(e){this._hasMajorPerformanceCaveat=!!e}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return!1}IsWebGPU(){return!1}GetEstimatedBackBufferMemoryUsage(){}GetEstimatedRenderBufferMemoryUsage(){}GetEstimatedTextureMemoryUsage(){}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}CreateRendererText(){return C33.New(C33.Gfx.RendererText,this)}}}{const C33=self.C3;C33.Gfx.ShaderProgramBase=class{constructor(e,t){this._name=t.name,this._renderer=e,this._extendBoxHorizontal=t.extendBoxHorizontal||0,this._extendBoxVertical=t.extendBoxVertical||0,this._crossSampling=!!t.crossSampling,this._mustPreDraw=!!t.mustPreDraw,this._preservesOpaqueness=!!t.preservesOpaqueness,this._supports3dDirectRendering=!!t.supports3dDirectRendering,this._animated=!!t.animated,this._blendsBackground=!!t.blendsBackground,this._usesDepth=!!t.usesDepth,this._usesAnySrcRectOrPixelSize=!1,this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return 0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}Supports3DDirectRendering(){return this._supports3dDirectRendering}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}UsesIsSrcTexRotated(){return!1}}}{const C33=self.C3;C33.Gfx.StateGroup=class{constructor(e,t,s,n,i){this._renderer=e,this._refCount=0,this._shaderProgram=null,this._shaderProgramName="",this._blendMode=s,this._color=C33.New(C33.Color),this._color.set(n),this._zElevation=i,"string"==typeof t?this._shaderProgramName=t:(this._shaderProgram=t,this._shaderProgramName=this._shaderProgram.GetName())}Release(){if(0<this._refCount)throw new Error("releasing state group still in use");this._renderer=null,this._shaderProgram=null,this._shaderProgramName=""}Apply(){const e=this._renderer;e.SetProgram(this._shaderProgram),e.SetBlendMode(this._blendMode),e.SetColor(this._color),e.SetCurrentZ(this._zElevation),e._SetCurrentStateGroup(this)}GetKey(){return C33.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=null}OnContextRestored(e){if(this._shaderProgram=e.GetShaderProgramByName(this._shaderProgramName),!this._shaderProgram)throw new Error("failed to restore shader program")}static MakeKey(e,t,s,n){const i="string"==typeof e?e:e.GetName();return i+","+t+","+s.getR()+","+s.getG()+","+s.getB()+","+s.getA()+","+n}}}{let interpolateQuad2=function(e,t,s){const n=s.getTlx(),i=s.getTly(),r=s.getTrx()-n,a=s.getTry()-i,o=s.getBlx()-n,l=s.getBly()-i,h=r*e,c=a*e,u=o*t,d=l*t;return[n+h+u,i+c+d]};interpolateQuad=interpolateQuad2;const C33=self.C3,tempQuadTex=C33.New(C33.Quad);C33.Gfx.MeshPoint=class{constructor(e,t,s){this._mesh=e,this._col=t,this._row=s,this._x=NaN,this._y=NaN,this._zElevation=NaN,this._u=NaN,this._v=NaN,this._x=0,this._y=0,this._zElevation=0,this._u=0,this._v=0}_Init(e,t,s,n){this._x=e,this._y=t,this._u=s,this._v=n}GetX(){return this._x}SetX(e){this._x!==e&&(this._x=e,this._mesh._SetPointsChanged())}GetY(){return this._y}SetY(e){this._y!==e&&(this._y=e,this._mesh._SetPointsChanged())}GetZElevation(){return this._zElevation}SetZElevation(e){this._zElevation!==e&&(this._zElevation=Math.max(e,0),this._mesh._SetPointsChanged())}GetU(){return this._u}SetU(e){this._u=e}GetV(){return this._v}SetV(e){this._v=e}_Interpolate_TexRect(e,t,s){[this._x,this._y]=interpolateQuad2(e._x,e._y,t),this._zElevation=e._zElevation,this._u=C33.lerp(s.getLeft(),s.getRight(),e._u),this._v=C33.lerp(s.getTop(),s.getBottom(),e._v)}_Interpolate_TexQuad(e,t,s){[this._x,this._y]=interpolateQuad2(e._x,e._y,t),this._zElevation=e._zElevation,[this._u,this._v]=interpolateQuad2(e._u,e._v,s)}SaveToJson(){return{x:this.GetX(),y:this.GetY(),z:this.GetZElevation(),u:this.GetU(),v:this.GetV()}}LoadFromJson(e){this.SetX(e.x),this.SetY(e.y),e.hasOwnProperty("z")&&this.SetZElevation(e.z),this.SetU(e.u),this.SetV(e.v)}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}},C33.Gfx.Mesh=class{constructor(s,e,t){if(s<2||e<2)throw new Error("invalid mesh size");this._hsize=s,this._vsize=e,this._owner=t||null,this._pts=[],this._minX=0,this._minY=0,this._maxX=1,this._maxY=1,this._maxZ=0,this._pointsChanged=!1;const n=s-1,i=e-1;for(let t=0;t<e;++t){const r=[];for(let e=0;e<s;++e){const a=C33.New(C33.Gfx.MeshPoint,this,e,t),o=e/n,l=t/i;a._Init(o,l,o,l),r.push(a)}this._pts.push(r)}}Release(){C33.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=!0}_MaybeComputeBounds(){if(this._pointsChanged){let e=1/0,t=1/0,s=-1/0,n=-1/0,i=0;for(const r of this._pts)for(const a of r){const o=a.GetX(),l=a.GetY();e=Math.min(e,o),t=Math.min(t,l),s=Math.max(s,o),n=Math.max(n,l),i=Math.max(i,a.GetZElevation())}this._minX=e,this._minY=t,this._maxX=s,this._maxY=n,this._maxZ=i,this._pointsChanged=!1}}GetMinX(){return this._MaybeComputeBounds(),this._minX}GetMinY(){return this._MaybeComputeBounds(),this._minY}GetMaxX(){return this._MaybeComputeBounds(),this._maxX}GetMaxY(){return this._MaybeComputeBounds(),this._maxY}GetMaxZ(){return this._MaybeComputeBounds(),this._maxZ}HasAnyZElevation(){return 0<this.GetMaxZ()}GetMeshPointAt(e,t){return e=Math.floor(e),t=Math.floor(t),e<0||e>=this._hsize||t<0||t>=this._vsize?null:this._pts[t][e]}CalculateTransformedMesh(e,s,n){const i=n instanceof C33.Rect;if(e.GetHSize()!==this.GetHSize()||e.GetVSize()!==this.GetVSize())throw new Error("source mesh wrong size");const r=e._pts,a=this._pts;for(let e=0,t=a.length;e<t;++e){const o=r[e],l=a[e];for(let e=0,t=l.length;e<t;++e){const h=o[e],c=l[e];i?c._Interpolate_TexRect(h,s,n):c._Interpolate_TexQuad(h,s,n)}}}Draw(r){let a=this._pts,o=a[0];for(let e=1,t=a.length;e<t;++e){let s=a[e],n=o[0],i=s[0];for(let e=1,t=s.length;e<t;++e){const l=o[e],h=s[e];tempQuadTex.set(n.GetU(),n.GetV(),l.GetU(),l.GetV(),h.GetU(),h.GetV(),i.GetU(),i.GetV()),r.Quad3D2(n.GetX(),n.GetY(),n.GetZElevation(),l.GetX(),l.GetY(),l.GetZElevation(),h.GetX(),h.GetY(),h.GetZElevation(),i.GetX(),i.GetY(),i.GetZElevation(),tempQuadTex),n=l,i=h}o=s}}Outline(o,l){l=l||((e,t,s)=>[e,t,s]);let e=this._pts,h=e[0];for(let r=1,a=e.length;r<a;++r){let s=e[r],n=h[0],i=s[0];for(let e=1,t=s.length;e<t;++e){const c=h[e],u=s[e],[d,_,p]=l(n.GetX(),n.GetY(),n.GetZElevation()),[m,g,f]=l(c.GetX(),c.GetY(),c.GetZElevation()),[S,y,C]=l(u.GetX(),u.GetY(),u.GetZElevation()),[G,T,I]=l(i.GetX(),i.GetY(),i.GetZElevation());o.Line3D(d,_,p,m,g,f),o.Line3D(d,_,p,S,y,C),o.Line3D(d,_,p,G,T,I),e===t-1&&o.Line3D(m,g,f,S,y,C),r===a-1&&o.Line3D(G,T,I,S,y,C),n=c,i=u}h=s}}InsertPolyMeshVertices(e){let s=.99999999,n=e.pointsArr(),i=[],r=this.GetHSize()-1,a=this.GetVSize()-1,o=1/r,l=1/a,h=r-1,c=a-1,u=n[0],d=n[1],_=C33.clamp(Math.floor(u*r),0,h),p=C33.clamp(Math.floor(d*a),0,c),m=!0,g=0,f=0,S=0,y=-1,C=()=>{u=C33.clamp(C33.lerp(u,g,S),0,1),d=C33.clamp(C33.lerp(d,f,S),0,1),i.push(u,d)};for(let e=0,t=n.length;e<t;e+=2){u=n[e],d=n[e+1],i.push(u,d),_=C33.clamp(Math.floor(u*r),0,h),p=C33.clamp(Math.floor(d*a),0,c);const G=(e+2)%t;for(g=n[G],f=n[1+G],y=-1;;){if(1e6<i.length)throw new Error("Too many mesh poly points");const T=_*o,I=p*l,b=(_+1)*o,A=(p+1)*l;if(m=C33.isPointInTriangleInclusive(u,d,T,I,b,I,b,A),0!==y&&0<=(S=C33.rayIntersectExtended(u,d,g,f,T,I,b,A,-.001))&&S<=s)C(),m=!m,y=0;else if(0<p&&2!==y&&0<=(S=C33.rayIntersectExtended(u,d,g,f,T,I,b,I,.001))&&S<=s)C(),p--,m=!1,y=4;else if(_<h&&3!==y&&0<=(S=C33.rayIntersectExtended(u,d,g,f,b,I,b,A,.001))&&S<=s)C(),_++,m=!1,y=1;else if(0<_&&1!==y&&0<=(S=C33.rayIntersectExtended(u,d,g,f,T,I,T,A,.001))&&S<=s)C(),_--,m=!0,y=3;else{if(!(p<c&&4!==y&&0<=(S=C33.rayIntersectExtended(u,d,g,f,T,A,b,A,.001))&&S<=s))break;C(),p++,m=!0,y=2}}}return C33.New(C33.CollisionPoly,i)}TransformCollisionPoly(e,t){const s=this._TransformPolyPoints(e);this._SimplifyPoly(s),t.setPoints(s)}_TransformPolyPoints(e){const s=[],n=e.pointsArr();for(let e=0,t=n.length;e<t;e+=2){const i=n[e],r=n[e+1],[a,o]=this.TransformPoint(i,r);s.push(a,o)}return s}TransformPoint(e,t){const s=this.GetHSize()-1,n=this.GetVSize()-1,i=1/s,r=1/n,a=C33.clamp(Math.floor(e*s),0,s-1),o=C33.clamp(Math.floor(t*n),0,n-1),l=a*i,h=o*r,c=(a+1)*i,u=(o+1)*r,d=this.GetMeshPointAt(a,o),_=this.GetMeshPointAt(a+1,o+1),p=C33.isPointInTriangleInclusive(e,t,l,h,c,h,c,u),m=p?l+i:l,g=p?h:h+r,f=this.GetMeshPointAt(a+(p?1:0),o+(p?0:1)),[S,y,C]=C33.triangleCartesianToBarycentric(e,t,l,h,m,g,c,u);return C33.triangleBarycentricToCartesian3d(S,y,C,d.GetX(),d.GetY(),d.GetZElevation(),f.GetX(),f.GetY(),f.GetZElevation(),_.GetX(),_.GetY(),_.GetZElevation())}_SimplifyPoly(s){let n=[],i=s[0],r=s[1],a=i-s.at(-2),o=r-s.at(-1);for(let e=0,t=s.length;e<t;e+=2){const l=(e+2)%t,h=s[l],c=s[1+l],u=h-i,d=c-r,_=Math.abs(u)<1e-7&&Math.abs(a)<1e-7&&Math.sign(d)===Math.sign(o),p=Math.abs(d)<1e-7&&Math.abs(o)<1e-7&&Math.sign(u)===Math.sign(a);(!_&&!p&&.001<Math.abs(u/a-d/o)||0==u&&0==d)&&n.push(i,r),i=h,r=c,a=u,o=d}6<=n.length&&n.length<s.length&&C33.shallowAssignArray(s,n)}SaveToJson(){return{cols:this.GetHSize(),rows:this.GetVSize(),points:this._pts.map(e=>e.map(e=>e.SaveToJson()))}}LoadFromJson(e){const s=this.GetHSize(),n=this.GetVSize();if(e.cols!==s||e.rows!==n)throw new Error("mesh data wrong size");const i=e.points;for(let t=0;t<n;++t){const r=i[t];for(let e=0;e<s;++e){const a=this.GetMeshPointAt(e,t);a.LoadFromJson(r[e])}}}}}{let GetFormatSpecifiers2=function(e,t){let s,n,i,r;switch(e){case"rgba8":s=t.RGBA8,n=t.RGBA,i=t.RGBA,r=t.UNSIGNED_BYTE;break;case"rgb8":s=t.RGB8,n=t.RGB,i=t.RGB,r=t.UNSIGNED_BYTE;break;case"rgba4":s=t.RGBA4,n=t.RGBA,i=t.RGBA,r=t.UNSIGNED_SHORT_4_4_4_4;break;case"rgb5_a1":s=t.RGB5_A1,n=t.RGBA,i=t.RGBA,r=t.UNSIGNED_SHORT_5_5_5_1;break;case"rgb565":s=t.RGB565,n=t.RGB,i=t.RGB,r=t.UNSIGNED_SHORT_5_6_5;break;default:throw new Error("invalid pixel format")}return{sizedinternalformat:s,internalformat:n,format:i,type:r}};GetFormatSpecifiers=GetFormatSpecifiers2;const C33=self.C3,VALID_PIXEL_FORMATS=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]),VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]),VALID_MIPMAP_QUALITIES=new Set(["default","low","high"]),VALID_WRAP_MODES=new Set(["clamp-to-edge","repeat","mirror-repeat"]),CREATEFROM_DEFAULT_OPTIONS={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:!0,mipMapQuality:"default",premultiplyAlpha:!0,isSvg:!1,width:-1,height:-1},UPDATE_DEFAULT_OPTIONS={premultiplyAlpha:!0,flipY:!1},allTextures=new Set;C33.Gfx.WebGLRendererTexture=class{constructor(e){this._renderer=e,this._texture=null,this._width=0,this._height=0,this._isStatic=!0,this._wrapX="clamp-to-edge",this._wrapY="clamp-to-edge",this._sampling="trilinear",this._anisotropy=0,this._pixelFormat="rgba8",this._isMipMapped=!1,this._mipMapQuality="default",this._refCount=0}_CreateStatic(t,e){if(!("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||t instanceof ImageData||t instanceof ArrayBuffer||null===t))throw new Error("invalid texture source");if(e=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,e),this._texture)throw new Error("already created texture");if(this._wrapX=e.wrapX,this._wrapY=e.wrapY,this._sampling=e.sampling,this._anisotropy=e.anisotropy,this._pixelFormat=e.pixelFormat,this._isMipMapped=!!e.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=e.mipMapQuality,!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");if(this._isStatic=!0,t instanceof ArrayBuffer||null===t||e.isSvg){if(this._width=e.width,this._height=e.height,t instanceof ArrayBuffer&&t.byteLength!==this._width*this._height*4)throw new Error("ArrayBuffer wrong size")}else this._width=t.width,this._height=t.height;if(this._width<=0||this._height<=0)throw new Error("invalid texture data size");if(e.isSvg){const o=C33.CreateCanvas(this._width,this._height),l=o.getContext("2d");l.drawImage(t,0,0,this._width,this._height),t=o}const s=C33.isPOT(this._width)&&C33.isPOT(this._height),n=this._renderer.GetMaxTextureSize();if(this._width>n||this._height>n)throw new Error("texture data exceeds maximum texture size");const i=this._renderer.GetContext(),r=this._renderer.GetWebGLVersionNumber(),a=(this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this._texture),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),GetFormatSpecifiers2(this._pixelFormat,i));if(this._renderer.SupportsNPOTTextures()||s||!this._IsTiled())if(2<=r){let e;e=this._isMipMapped?Math.floor(Math.log2(Math.max(this._width,this._height))+1):1,i.texStorage2D(i.TEXTURE_2D,e,a.sizedinternalformat,this._width,this._height),t instanceof ArrayBuffer?i.texSubImage2D(i.TEXTURE_2D,0,0,0,this._width,this._height,a.format,a.type,new Uint8Array(t)):null!==t&&i.texSubImage2D(i.TEXTURE_2D,0,0,0,a.format,a.type,t)}else t instanceof ArrayBuffer?i.texImage2D(i.TEXTURE_2D,0,a.internalformat,this._width,this._height,0,a.format,a.type,new Uint8Array(t)):null===t?i.texImage2D(i.TEXTURE_2D,0,a.internalformat,this._width,this._height,0,a.format,a.type,null):i.texImage2D(i.TEXTURE_2D,0,a.internalformat,a.format,a.type,t);else{if(null===t)throw new Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");if((t=t instanceof ArrayBuffer?new ImageData(new Uint8ClampedArray(t),this._width,this._height):t)instanceof ImageData){const u=C33.CreateCanvas(this._width,this._height),d=u.getContext("2d");d.putImageData(t,0,0),t=u}const h=C33.CreateCanvas(C33.nextHighestPowerOfTwo(this._width),C33.nextHighestPowerOfTwo(this._height)),c=h.getContext("2d");c.imageSmoothingEnabled="nearest"!==this._sampling,c.drawImage(t,0,0,this._width,this._height,0,0,h.width,h.height),i.texImage2D(i.TEXTURE_2D,0,a.internalformat,a.format,a.type,h)}null!==t&&this._SetTextureParameters(i),i.bindTexture(i.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,allTextures.add(this)}_CreateDynamic(e,t,s){if(s=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,s),this._texture)throw new Error("already created texture");if(this._wrapX=s.wrapX,this._wrapY=s.wrapY,this._sampling=s.sampling,this._pixelFormat=s.pixelFormat,this._isMipMapped=!!s.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=s.mipMapQuality,!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");this._isStatic=!1,this._width=Math.floor(e),this._height=Math.floor(t);const n=C33.isPOT(this._width)&&C33.isPOT(this._height),i=this._renderer.GetMaxTextureSize();if(this._width<=0||this._height<=0)throw new Error("invalid texture size");if(this._width>i||this._height>i)throw new Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!n)throw new Error("non-power-of-two tiled textures not supported");const r=this._renderer.GetContext(),a=this._renderer.GetWebGLVersionNumber(),o=(this._texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this._texture),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),GetFormatSpecifiers2(this._pixelFormat,r)),l=2<=a?o.sizedinternalformat:o.internalformat;r.texImage2D(r.TEXTURE_2D,0,l,this._width,this._height,0,o.format,o.type,null),this._SetTextureParameters(r),r.bindTexture(r.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,allTextures.add(this)}_GetMipMapHint(e){if("default"===this._mipMapQuality)return this._isStatic?e.NICEST:e.FASTEST;if("low"===this._mipMapQuality)return e.FASTEST;if("high"===this._mipMapQuality)return e.NICEST;throw new Error("invalid mipmap quality")}_IsTiled(){return"clamp-to-edge"!==this._wrapX||"clamp-to-edge"!==this._wrapY}_GetTextureWrapMode(e,t){if("clamp-to-edge"===t)return e.CLAMP_TO_EDGE;if("repeat"===t)return e.REPEAT;if("mirror-repeat"===t)return e.MIRRORED_REPEAT;throw new Error("invalid wrap mode")}_SetTextureParameters(e){const t=C33.isPOT(this._width)&&C33.isPOT(this._height);if(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._GetTextureWrapMode(e,this._wrapX)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._GetTextureWrapMode(e,this._wrapY)),"nearest"===this._sampling)e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),this._isMipMapped=!1;else if(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),(t||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){e.hint(e.GENERATE_MIPMAP_HINT,this._GetMipMapHint(e)),e.generateMipmap(e.TEXTURE_2D);const n="trilinear"===this._sampling&&!this._renderer.HasMajorPerformanceCaveat();e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n?e.LINEAR_MIPMAP_LINEAR:e.LINEAR_MIPMAP_NEAREST)}else e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this._isMipMapped=!1;const s=this._renderer._GetAnisotropicExtension();s&&0<this._anisotropy&&"nearest"!==this._sampling&&e.texParameterf(e.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(e,t){if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||e instanceof ImageData))throw new Error("invalid texture source");if(!this._texture||this._refCount<=0)throw new Error("texture not created");if(this._isStatic)throw new Error("cannot update static texture");t=Object.assign({},UPDATE_DEFAULT_OPTIONS,t);const s=e.width||e.videoWidth,n=e.height||e.videoHeight,i=this._renderer.GetWebGLVersionNumber(),r=this._renderer.GetContext(),a=(r.bindTexture(r.TEXTURE_2D,this._texture),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!!t.flipY),GetFormatSpecifiers2(this._pixelFormat,r)),o=2<=i?a.sizedinternalformat:a.internalformat;try{if(this._width===s&&this._height===n){const l=C33.isPOT(this._width)&&C33.isPOT(this._height);r.texSubImage2D(r.TEXTURE_2D,0,0,0,a.format,a.type,e),(l||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(r.hint(r.GENERATE_MIPMAP_HINT,this._GetMipMapHint(r)),r.generateMipmap(r.TEXTURE_2D))}else{this._width=s,this._height=n;const h=C33.isPOT(this._width)&&C33.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!h)throw new Error("non-power-of-two tiled textures not supported");r.texImage2D(r.TEXTURE_2D,0,o,a.format,a.type,e),(h||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(r.hint(r.GENERATE_MIPMAP_HINT,this._GetMipMapHint(r)),r.generateMipmap(r.TEXTURE_2D))}}catch(e){console.error("Error updating WebGL texture: ",e)}r.bindTexture(r.TEXTURE_2D,null),this._renderer._ResetLastTexture()}_Delete(){if(0<this._refCount)throw new Error("texture still has references");if(!this._texture)throw new Error("already deleted texture");allTextures.delete(this);const e=this._renderer.GetContext();e.deleteTexture(this._texture),this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(this._refCount<=0)throw new Error("no more references");this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let e=this._width*this._height;switch(this._pixelFormat){case"rgba8":e*=4;break;case"rgb8":e*=3;break;case"rgba4":case"rgb5_a1":case"rgb565":e*=2}return this._isMipMapped&&(e+=Math.floor(e/3)),e}static OnContextLost(){allTextures.clear()}static allTextures(){return allTextures.values()}}}{const C33=self.C3,assert=self.assert,glMatrix=self.glMatrix,vec32=glMatrix.vec3,mat42=glMatrix.mat4,VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]),DEFAULT_RENDERTARGET_OPTIONS={sampling:"trilinear",alpha:!0,depth:!1,isSampled:!0,isDefaultSize:!0,multisampling:0},allRenderTargets=new Set;C33.Gfx.WebGLRenderTarget=class{constructor(e){this._renderer=e,this._frameBuffer=null,this._frameBufferNoDepth=null,this._texture=null,this._renderBuffer=null,this._width=0,this._height=0,this._isDefaultSize=!0,this._sampling="trilinear",this._alpha=!0,this._depth=!1,this._isSampled=!0,this._multisampling=0,this._projectionMatrix=mat42.create(),this._lastFov=0,this._lastNearZ=0,this._lastFarZ=0}_Create(e,t,s){s=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,s);const n=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw new Error("already created render target");if(this._sampling=s.sampling,this._alpha=!!s.alpha,this._depth=!!s.depth,this._isSampled=!!s.isSampled,this._isDefaultSize=!!s.isDefaultSize,this._multisampling=s.multisampling,!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(0<this._multisampling&&(n<2||this._isSampled))throw new Error("invalid use of multisampling");if(n<2&&(this._isSampled=!0),this._width=e,this._height=t,this._width<=0||this._height<=0)throw new Error("invalid render target size");this._CalculateProjection();const i=this._renderer.GetContext();if(this._frameBuffer=i.createFramebuffer(),this._depth&&(this._frameBufferNoDepth=i.createFramebuffer()),this._isSampled){this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:!1});const a=this._texture._GetTexture();i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0),this._depth&&(i.bindFramebuffer(i.FRAMEBUFFER,this._frameBufferNoDepth),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0))}else{this._renderBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._renderBuffer);const o=this._alpha?i.RGBA8:i.RGB8;if(0<this._multisampling){const l=i.getInternalformatParameter(i.RENDERBUFFER,o,i.SAMPLES);if(l&&l[0]){const h=l[0];this._multisampling>h&&(this._multisampling=h)}else this._multisampling=0}0===this._multisampling?i.renderbufferStorage(i.RENDERBUFFER,o,this._width,this._height):i.renderbufferStorageMultisample(i.RENDERBUFFER,this._multisampling,o,this._width,this._height),i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,this._renderBuffer),this._depth&&(i.bindFramebuffer(i.FRAMEBUFFER,this._frameBufferNoDepth),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,this._renderBuffer)),i.bindRenderbuffer(i.RENDERBUFFER,null)}const r=this._renderer._GetDepthBuffer();this._depth&&r&&(i.bindFramebuffer(i.FRAMEBUFFER,this._frameBuffer),this._renderer._CanSampleDepth()?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,r,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r)),i.bindFramebuffer(i.FRAMEBUFFER,null),allRenderTargets.add(this)}_Resize(e,t){if(this._width!==e||this._height!==t){this._width=e,this._height=t,this._CalculateProjection();const s=this._renderer.GetContext(),n=(s.bindFramebuffer(s.FRAMEBUFFER,this._frameBuffer),this._texture?this._texture._Update(new ImageData(this._width,this._height)):(s.bindRenderbuffer(s.RENDERBUFFER,this._renderBuffer),s.renderbufferStorage(s.RENDERBUFFER,this._alpha?s.RGBA8:s.RGB8,this._width,this._height),s.bindRenderbuffer(s.RENDERBUFFER,null)),this._renderer._GetDepthBuffer());this._depth&&n&&(this._renderer._CanSampleDepth()?s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,n,0):s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n)),s.bindFramebuffer(s.FRAMEBUFFER,null)}}_Delete(){if(!this._texture&&!this._renderBuffer)throw new Error("already deleted render target");allRenderTargets.delete(this);const e=this._renderer.GetContext(),t=(this._texture?(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)),this._renderer.DeleteTexture(this._texture),this._texture=null):this._renderBuffer&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),e.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),e.bindFramebuffer(e.FRAMEBUFFER,null),2<=this._renderer.GetWebGLVersionNumber()&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)),e.deleteFramebuffer(this._frameBuffer),this._depth&&e.deleteFramebuffer(this._frameBufferNoDepth),this._renderer.GetBatchState());t.currentFramebuffer=null,this._frameBuffer=t.currentFramebufferNoDepth=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height),this._lastFov=this._renderer.GetFovY(),this._lastNearZ=this._renderer.GetNearZ(),this._lastFarZ=this._renderer.GetFarZ()}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){return this._renderer.GetFovY()===this._lastFov&&this._renderer.GetNearZ()===this._lastNearZ&&this._renderer.GetFarZ()===this._lastFarZ||this._CalculateProjection(),this._projectionMatrix}IsLinearSampling(){return"nearest"!==this._sampling}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){const e={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};return this._isDefaultSize||(e.width=this._width,e.height=this._height),e}IsCompatibleWithOptions(e){return"nearest"!==(e=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,e)).sampling===this.IsLinearSampling()&&!!e.alpha===this.HasAlpha()&&!!e.depth===this.HasDepthBuffer()&&!(2<=this._renderer.GetWebGLVersionNumber()&&!!e.isSampled!==this.IsSampled())&&("number"==typeof e.width||"number"==typeof e.height?!this.IsDefaultSize()&&this.GetWidth()===Math.floor(e.width)&&this.GetHeight()===Math.floor(e.height):this.IsDefaultSize())}_GetWebGLTexture(){return this._texture?this._texture._GetTexture():null}GetEstimatedMemoryUsage(){return this._texture?this._texture.GetEstimatedMemoryUsage():this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(e,t){const s=await e.ReadBackRenderTargetToImageData(t,!0);return C33.ImageDataToBlob(s)}static OnContextLost(){allRenderTargets.clear()}static allRenderTargets(){return allRenderTargets.values()}static ResizeAll(e,t){for(const s of allRenderTargets)s.IsDefaultSize()&&s._Resize(e,t)}}}{const C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,mat42=glMatrix.mat4,RESERVED_UNIFORM_NAMES=new Set(["aPos","aTex","aPoints","matP","matMV","samplerFront","samplerBack","samplerDepth","destStart","destEnd","srcStart","srcEnd","srcOriginStart","srcOriginEnd","pixelSize","seconds","devicePixelRatio","layerScale","layerAngle","layoutStart","layoutEnd","color","color2_","pointTexStart","pointTexEnd","zElevation","tileSize","tileSpacing","outlineThickness","zNear","zFar"]);C33.Gfx.WebGLShaderProgram=class extends C33.Gfx.ShaderProgramBase{static async Compile(e,t){const s=e.GetContext(),n=t.src,i=t.vertexSrc,r=t.name,a=s.createShader(s.FRAGMENT_SHADER),o=(s.shaderSource(a,n),s.compileShader(a),s.createShader(s.VERTEX_SHADER)),l=(s.shaderSource(o,i),s.compileShader(o),s.createProgram()),h=(s.attachShader(l,a),s.attachShader(l,o),s.bindAttribLocation(l,0,"aPos"),s.bindAttribLocation(l,1,"aTex"),s.bindAttribLocation(l,2,"aPoints"),s.linkProgram(l),e._GetParallelShaderCompileExtension());if(h?await e._WaitForObjectReady(()=>s.getProgramParameter(l,h.COMPLETION_STATUS_KHR)):await C33.Wait(5),!s.getShaderParameter(a,s.COMPILE_STATUS)){const u=s.getShaderInfoLog(a);throw s.deleteShader(a),s.deleteShader(o),s.deleteProgram(l),new Error("Error compiling fragment shader: "+u)}if(!s.getShaderParameter(o,s.COMPILE_STATUS)){const d=s.getShaderInfoLog(o);throw s.deleteShader(a),s.deleteShader(o),s.deleteProgram(l),new Error("Error compiling vertex shader: "+d)}if(!s.getProgramParameter(l,s.LINK_STATUS)){const _=s.getProgramInfoLog(l);throw s.deleteShader(a),s.deleteShader(o),s.deleteProgram(l),new Error("Error linking shader program: "+_)}const c=C33.FilterUnprintableChars(s.getProgramInfoLog(l)||"").trim();return c&&!C33.IsStringAllWhitespace(c)&&console.info(`[WebGL] Shader program '${r}' compilation log: `,c),s.deleteShader(a),s.deleteShader(o),l}static async Create(e,t){const s=await C33.Gfx.WebGLShaderProgram.Compile(e,t);return new C33.Gfx.WebGLShaderProgram(e,s,t)}constructor(e,t,s){super(e,s);const n=e.GetContext(),i=e.GetBatchState(),r=(e.EndBatch(),n.useProgram(t),this._gl=n,this._shaderProgram=t,this._isDeviceTransform="<default-device-transform>"===s.name,n.getAttribLocation(t,"aPos")),a=n.getAttribLocation(t,"aTex"),o=(this._locAPoints=n.getAttribLocation(t,"aPoints"),-1!==r&&(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.vertexAttribPointer(r,e.GetNumVertexComponents(),n.FLOAT,!1,0,0),n.enableVertexAttribArray(r)),-1!==a&&(n.bindBuffer(n.ARRAY_BUFFER,e._texcoordBuffer),n.vertexAttribPointer(a,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a)),-1!==this._locAPoints&&(n.bindBuffer(n.ARRAY_BUFFER,e._pointBuffer),n.vertexAttribPointer(this._locAPoints,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(this._locAPoints)),n.bindBuffer(n.ARRAY_BUFFER,null),this._uMatP=new C33.Gfx.WebGLShaderUniform(this,"matP","mat4"),this._uMatMV=new C33.Gfx.WebGLShaderUniform(this,"matMV","mat4"),this._uColor=new C33.Gfx.WebGLShaderUniform(this,"color","vec4"),this._uSamplerFront=new C33.Gfx.WebGLShaderUniform(this,"samplerFront","sampler"),this._uPointTexStart=new C33.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2"),this._uPointTexEnd=new C33.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2"),this._uZElevation=new C33.Gfx.WebGLShaderUniform(this,"zElevation","float"),this._uTileSize=new C33.Gfx.WebGLShaderUniform(this,"tileSize","vec2"),this._uTileSpacing=new C33.Gfx.WebGLShaderUniform(this,"tileSpacing","vec2"),this._uColor2=new C33.Gfx.WebGLShaderUniform(this,"color2_","vec4"),this._uOutlineThickness=new C33.Gfx.WebGLShaderUniform(this,"outlineThickness","float"),this._uSamplerBack=new C33.Gfx.WebGLShaderUniform(this,"samplerBack","sampler"),this._uSamplerDepth=new C33.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler"),this._uDestStart=new C33.Gfx.WebGLShaderUniform(this,"destStart","vec2"),this._uDestEnd=new C33.Gfx.WebGLShaderUniform(this,"destEnd","vec2"),this._uSrcStart=new C33.Gfx.WebGLShaderUniform(this,"srcStart","vec2"),this._uSrcEnd=new C33.Gfx.WebGLShaderUniform(this,"srcEnd","vec2"),this._uSrcOriginStart=new C33.Gfx.WebGLShaderUniform(this,"srcOriginStart","vec2"),this._uSrcOriginEnd=new C33.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2"),this._uPixelSize=new C33.Gfx.WebGLShaderUniform(this,"pixelSize","vec2"),this._uSeconds=new C33.Gfx.WebGLShaderUniform(this,"seconds","float"),this._uDevicePixelRatio=new C33.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float"),this._uLayerScale=new C33.Gfx.WebGLShaderUniform(this,"layerScale","float"),this._uLayerAngle=new C33.Gfx.WebGLShaderUniform(this,"layerAngle","float"),this._uLayoutStart=new C33.Gfx.WebGLShaderUniform(this,"layoutStart","vec2"),this._uLayoutEnd=new C33.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2"),this._uZNear=new C33.Gfx.WebGLShaderUniform(this,"zNear","float"),this._uZFar=new C33.Gfx.WebGLShaderUniform(this,"zFar","float"),this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed()),s.parameters||[]);this._uCustomParameters=[],this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed(),this._hasCurrentMatP=!1,this._hasCurrentMatMV=!1,this._uColor.Init4f(1,1,1,1),this._uColor2.Init4f(1,1,1,1),this._uSamplerFront.Init1i(0),this._uSamplerBack.Init1i(1),this._uSamplerDepth.Init1i(2),this._uPointTexStart.Init2f(0,0),this._uPointTexEnd.Init2f(1,1),this._uZElevation.Init1f(0),this._uTileSize.Init2f(0,0),this._uTileSpacing.Init2f(0,0),this._uDestStart.Init2f(0,0),this._uDestEnd.Init2f(1,1),this._uSrcStart.Init2f(0,0),this._uSrcEnd.Init2f(0,0),this._uSrcOriginStart.Init2f(0,0),this._uSrcOriginEnd.Init2f(0,0),this._uPixelSize.Init2f(0,0),this._uDevicePixelRatio.Init1f(1),this._uZNear.Init1f(e.GetNearZ()),this._uZFar.Init1f(e.GetFarZ()),this._uLayerScale.Init1f(1),this._uLayerAngle.Init1f(0),this._uSeconds.Init1f(0),this._uLayoutStart.Init2f(0,0),this._uLayoutEnd.Init2f(0,0),this._uOutlineThickness.Init1f(1);for(const h of o){const c=h[0],u=h[2],d=new C33.Gfx.WebGLShaderUniform(this,c,u);"color"===u?d.Init3f(0,0,0):d.Init1f(0),this._uCustomParameters.push(d)}this._isDeviceTransform?this._UpdateDeviceTransformUniforms(i.currentMatP):(this.UpdateMatP(i.currentMatP,!0),this.UpdateMatMV(i.currentMV,!0));const l=i.currentShader;n.useProgram(l?l._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram),this._shaderProgram=null,this._renderer._RemoveShaderProgram(this),this._gl=null,super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(e){return e<0||e>=this._uCustomParameters.length?null:this._uCustomParameters[e].GetType()}AreCustomParametersAlreadySetInBatch(s){for(let e=0,t=s.length;e<t;++e)if(!this._uCustomParameters[e].IsSetToCustomInBatch(s[e]))return!1;return!0}SetCustomParametersInBatch(s){for(let e=0,t=s.length;e<t;++e)this._uCustomParameters[e].SetBatchValueCustom(s[e])}AreOptionalUniformsAlreadySetInBatch(e,t,s,n,i,r,a,o,l,h){return!this._uSamplerBack.IsUsed()&&!(this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(i,r)||this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(e.getLeft(),e.getTop())||this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(e.getRight(),e.getBottom())||this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(a)||this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(o)||this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(l)||this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(t.getLeft(),t.getTop())||this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(t.getRight(),t.getBottom())||this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(s.getLeft(),s.getTop())||this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(s.getRight(),s.getBottom())||this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(n.getLeft(),n.getTop())||this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(n.getTop(),n.getBottom())||this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(h))}SetOptionalUniformsInBatch(e,t,s,n,i,r,a,o,l,h){this._uSamplerBack.IsUsed()||(this._uPixelSize.IsUsed()&&this._uPixelSize.SetBatch2(i,r),this._uDestStart.IsUsed()&&this._uDestStart.SetBatch2(e.getLeft(),e.getTop()),this._uDestEnd.IsUsed()&&this._uDestEnd.SetBatch2(e.getRight(),e.getBottom()),this._uDevicePixelRatio.IsUsed()&&this._uDevicePixelRatio.SetBatch1(a),this._uLayerScale.IsUsed()&&this._uLayerScale.SetBatch1(o),this._uLayerAngle.IsUsed()&&this._uLayerAngle.SetBatch1(l),this._uSrcStart.IsUsed()&&this._uSrcStart.SetBatch2(t.getLeft(),t.getTop()),this._uSrcEnd.IsUsed()&&this._uSrcEnd.SetBatch2(t.getRight(),t.getBottom()),this._uSrcOriginStart.IsUsed()&&this._uSrcOriginStart.SetBatch2(s.getLeft(),s.getTop()),this._uSrcOriginEnd.IsUsed()&&this._uSrcOriginEnd.SetBatch2(s.getRight(),s.getBottom()),this._uLayoutStart.IsUsed()&&this._uLayoutStart.SetBatch2(n.getLeft(),n.getTop()),this._uLayoutEnd.IsUsed()&&this._uLayoutEnd.SetBatch2(n.getTop(),n.getBottom()),this._uSeconds.IsUsed()&&this._uSeconds.SetBatch1(h))}UpdateMatP(e,t){this._hasCurrentMatP&&!t||this._isDeviceTransform||(this._uMatP.IsUsed()&&this._uMatP.UpdateMatrix4fv(e),this._hasCurrentMatP=!0)}SetMatPStale(){this._hasCurrentMatP=!1}UpdateMatMV(e,t){this._hasCurrentMatMV&&!t||this._isDeviceTransform||(this._uMatMV.IsUsed()&&this._uMatMV.UpdateMatrix4fv(e),this._hasCurrentMatMV=!0)}SetMatMVStale(){this._hasCurrentMatMV=!1}_UpdateDeviceTransformUniforms(e){if(!this._isDeviceTransform)throw new Error("not device transform shader");this._uMatP.UpdateMatrix4fv(e);const t=this._renderer,s=t.GetWidth()/2,n=t.GetHeight()/2,i=t.CalculateLookAtModelView2(s,n,t.GetDefaultCameraZ(t.GetHeight()),s,n,0,t.GetHeight());this._uMatMV.UpdateMatrix4fv(i)}UpdateColor(e){this._uColor.IsUsed()&&this._uColor.Update4f(e[0],e[1],e[2],e[3])}static GetReservedUniformNames(){return RESERVED_UNIFORM_NAMES}static GetDefaultVertexShaderSource(e){const t=e?"highmedp":"mediump";return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","attribute highp vec3 aPos;",`attribute ${t} vec2 aTex;`,`varying ${t} vec2 vTex;`,"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {",`	gl_Position = matP * matMV * vec4(aPos, 1.0);`,`	vTex = aTex;`,"}"].join("\n")}static GetDefaultVertexShaderSource_WebGL2(e){const t=e?"highp":"mediump";return["#version 300 es","in highp vec3 aPos;",`in ${t} vec2 aTex;`,`out ${t} vec2 vTex;`,"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {",`	gl_Position = matP * matMV * vec4(aPos, 1.0);`,`	vTex = aTex;`,"}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL2(){return["#version 300 es","in mediump vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\toutColor = texture(samplerFront, vTex) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL2(){return["#version 300 es","in highp vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highp vec2 srcStart;","uniform highp vec2 pixelSize;","uniform highp vec2 tileSize;","uniform highp vec2 tileSpacing;","void main(void) {","\thighp vec2 tile = floor(vTex);","\thighp vec2 tex = fract(vTex);","\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTileRandomizationFragmentShaderSource(e,t,s){let n="";return 2<=e?n="#version 300 es\n":(t&&(n="#extension GL_EXT_frag_depth : enable\n"),s&&(n+="#extension GL_EXT_shader_texture_lod : enable\n#extension GL_OES_standard_derivatives : enable\n")),n+`
#ifdef GL_FRAGMENT_PRECISION_HIGH
#define highmedp highp
#else
#define highmedp mediump
#endif
precision highmedp float;
${2<=e?"in":"varying"} vec2 vTex;
${2<=e?"out lowp vec4 outColor;":""}
uniform lowp vec4 color;
uniform lowp sampler2D samplerFront;
uniform vec2 pixelSize;

uniform vec2 tileSize;
uniform vec2 tileSpacing;
uniform float outlineThickness;

const float PI = 3.1415926;

lowp vec4 cospVec4(lowp vec4 a, lowp vec4 b, float x)
{
	return (a + b + (a - b) * cos(x * PI)) / 2.0;
}

vec3 randVec3(vec2 seed)
{
	return vec3(fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(12.9898,78.233))) * 43758.5453),
				fract(sin(dot(seed.yx + vec2(0.1, 0.1), vec2(12.9898,-78.233))) * 43758.5453),
				fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(-12.9898,-78.233))) * 43758.5453));
}

lowp vec4 sampleTile(vec2 tile, vec2 uv, vec2 ddx, vec2 ddy)
{
	vec2 posRandom = tileSize;
	float angleRandom = outlineThickness;
	
	vec3 rand = (randVec3(floor(tile + 0.5)) - 0.5) * 2.0;
	
	float angle = angleRandom * rand.z * PI;
	float sin_a = sin(angle);
	float cos_a = cos(angle);
	float aspect = pixelSize.x / pixelSize.y;

	vec2 mid = tile + vec2(0.5, 0.5);
	vec2 dp = uv - mid;
	dp.x /= aspect;
	vec2 r = vec2(dp.x * cos_a - dp.y * sin_a,
				  dp.y * cos_a + dp.x * sin_a);
	r.x *= aspect;

	vec2 p = mid + r + (posRandom * rand.xy / 2.0);
	
	${2<=e?"return textureGrad(samplerFront, p, ddx, ddy);":""}
	${e<2&&s?"return texture2DGradEXT(samplerFront, p, ddx, ddy);":""}
	${e<2&&!s?"return texture2D(samplerFront, p);":""}
}

void main(void) {
	
	${e<2?"lowp vec4 outColor;":""}
	
	float blendMarginX = tileSpacing.x;
	float blendMarginY = tileSpacing.y;
	
	vec2 tile = floor(vTex);
	vec2 tex = fract(vTex);
	vec2 ddx = ${2<=e||s?"dFdx(vTex)":"vec2(0.0, 0.0)"};
	vec2 ddy = ${2<=e||s?"dFdy(vTex)":"vec2(0.0, 0.0)"};
	
	vec4 curTile = sampleTile(tile, vTex, ddx, ddy);
	
	bool inLeftMargin = (tex.x < blendMarginX);
	bool inRightMargin = (tex.x > 1.0 - blendMarginX);
	bool inTopMargin = (tex.y < blendMarginY);
	bool inBottomMargin = (tex.y > 1.0 - blendMarginY);
	
	if (inLeftMargin)
	{
		lowp vec4 leftTile = sampleTile(tile + vec2(-1.0, 0.0), vTex, ddx, ddy);
		float leftMix = (tex.x / (blendMarginX * 2.0)) + 0.5;
		lowp vec4 leftMixedTile = cospVec4(leftTile, curTile, leftMix);
		
		if (inTopMargin)
		{
			lowp vec4 topTile =     sampleTile(tile + vec2(0.0,  -1.0), vTex, ddx, ddy);
			lowp vec4 topLeftTile = sampleTile(tile + vec2(-1.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topLeftMixedTile = cospVec4(topLeftTile, topTile, leftMix);
			
			outColor = cospVec4(topLeftMixedTile, leftMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
		}
		else if (inBottomMargin)
		{
			lowp vec4 bottomTile =     sampleTile(tile + vec2(0.0,  1.0), vTex, ddx, ddy);
			lowp vec4 bottomLeftTile = sampleTile(tile + vec2(-1.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomLeftMixedTile = cospVec4(bottomLeftTile, bottomTile, leftMix);
			
			outColor = cospVec4(leftMixedTile, bottomLeftMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
		}
		else
		{
			outColor = leftMixedTile;
		}
	}
	else if (inRightMargin)
	{
		lowp vec4 rightTile = sampleTile(tile + vec2(1.0, 0.0), vTex, ddx, ddy);
		float rightMix = (tex.x - (1.0 - blendMarginX)) / (blendMarginX * 2.0);
		lowp vec4 rightMixedTile = cospVec4(curTile, rightTile, rightMix);
		
		if (inTopMargin)
		{
			lowp vec4 topTile =      sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topRightTile = sampleTile(tile + vec2(1.0, -1.0), vTex, ddx, ddy);
			lowp vec4 topRightMixedTile = cospVec4(topTile, topRightTile, rightMix);
			
			outColor = cospVec4(topRightMixedTile, rightMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
		}
		else if (inBottomMargin)
		{
			lowp vec4 bottomTile =      sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomRightTile = sampleTile(tile + vec2(1.0, 1.0), vTex, ddx, ddy);
			lowp vec4 bottomRightMixedTile = cospVec4(bottomTile, bottomRightTile, rightMix);
			
			outColor = cospVec4(rightMixedTile, bottomRightMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
		}
		else
		{
			outColor = rightMixedTile;
		}
	}
	else if (inTopMargin)
	{
		lowp vec4 topTile = sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);
		outColor = cospVec4(topTile, curTile, (tex.y / (blendMarginY * 2.0)) + 0.5);
	}
	else if (inBottomMargin)
	{
		lowp vec4 bottomTile = sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);
		outColor = cospVec4(curTile, bottomTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));
	}
	else
	{
		outColor = curTile;
	}
	
	outColor *= color;
	${e<2?"gl_FragColor = outColor;":""}
	${2<=e?"gl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}
	${e<2&&t?"gl_FragDepthEXT = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}
}
`}static GetPointVertexShaderSource_WebGL1(){return["attribute vec4 aPoints;","varying float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointVertexShaderSource_WebGL2(){return["#version 300 es","in vec4 aPoints;","out float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return["uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetPointFragmentShaderSource_WebGL2(){return["#version 300 es","uniform lowp sampler2D samplerFront;","in lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","out lowp vec4 outColor;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\toutColor = texture(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetColorFillFragmentShaderSource(){return["uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = color;","}"].join("\n")}static GetLinearGradientFillFragmentShaderSource(){return["precision lowp float;","varying mediump vec2 vTex;","uniform vec4 color;","uniform vec4 color2_;","vec3 fromLinear(vec3 linearRGB)","{","\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));","\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);","\tvec3 lower = linearRGB * vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","vec3 toLinear(vec3 sRGB)","{","\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));","\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));","\tvec3 lower = sRGB/vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","void main(void) {","\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);","\tfloat a = mix(color.a, color2_.a, vTex.x);","\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);","}"].join("\n")}static GetPenumbraFillFragmentShaderSource(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","precision lowp float;","varying highmedp vec2 vTex;","uniform vec4 color;","void main(void) {",`	highmedp float grad = vTex.x / (1.0 - vTex.y);`,`	gl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);`,"}"].join("\n")}static GetSmoothLineFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float f = step(diffSq.x + diffSq.y, 0.25);","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump float innerF = step(distSq, 0.25);","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}static GetSmoothEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);","\tgl_FragColor = color * f;","}"].join("\n")}static GetSmoothEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 pxNorm = pixelSize * norm;","\tmediump vec2 innerEdge1 = halfNorm - pxNorm;","\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;","\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);","\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;","\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;","\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);","\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;","\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}}}{const C33=self.C3,glMatrix=self.glMatrix,mat42=glMatrix.mat4,TYPE_SIZES=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);C33.Gfx.WebGLShaderUniform=class{constructor(e,t,s){if(!TYPE_SIZES.has(s))throw new Error("invalid uniform type");this._owner=e,this._gl=this._owner.GetWebGLContext(),this._name=t,this._type=s,this._isColorType="color"===this._type,this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),t),this._isUsed=!!this._location;const n=TYPE_SIZES.get(s);this._lastValue=new Float32Array(n),this._lastBatchValue=new Float32Array(n)}Release(){this._owner=null,this._gl=null,this._location=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1f(this._location,e))}Init1i(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1i(this._location,e))}Init2f(e,t){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastBatchValue.set(this._lastValue),this._gl.uniform2f(this._location,e,t))}Init3f(e,t,s){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastBatchValue.set(this._lastValue),this._gl.uniform3f(this._location,e,t,s))}Init4f(e,t,s,n){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastValue[3]=n,this._lastBatchValue.set(this._lastValue),this._gl.uniform4f(this._location,e,t,s,n))}Update1f(e){e=Math.fround(e);const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1f(this._location,e))}Update1i(e){const t=this._lastValue;t[0]!==e&&this._gl.uniform1i(this._location,t[0]=e)}Update2f(e,t){e=Math.fround(e),t=Math.fround(t);const s=this._lastValue;s[0]===e&&s[1]===t||(s[0]=e,s[1]=t,this._gl.uniform2f(this._location,e,t))}Update3f(e,t,s){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s);const n=this._lastValue;n[0]===e&&n[1]===t&&n[2]===s||(n[0]=e,n[1]=t,n[2]=s,this._gl.uniform3f(this._location,e,t,s))}Update4f(e,t,s,n){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s),n=Math.fround(n);const i=this._lastValue;i[0]===e&&i[1]===t&&i[2]===s&&i[3]===n||(i[0]=e,i[1]=t,i[2]=s,i[3]=n,this._gl.uniform4f(this._location,e,t,s,n))}UpdateMatrix4fv(e){const t=this._lastValue;mat42.exactEquals(t,e)||(C33.typedArraySet16(t,e,0),this._gl.uniformMatrix4fv(this._location,!1,e))}IsSetToCustomInBatch(e){const t=this._lastBatchValue;return this.IsColorType()?t[0]===Math.fround(e.getR())&&t[1]===Math.fround(e.getG())&&t[2]===Math.fround(e.getB()):t[0]===Math.fround(e)}SetBatchValueCustom(e){const t=this._lastBatchValue;this.IsColorType()?(t[0]=e.getR(),t[1]=e.getG(),t[2]=e.getB()):t[0]=e}IsSetTo1InBatch(e){return this._lastBatchValue[0]===Math.fround(e)}IsSetTo2InBatch(e,t){const s=this._lastBatchValue;return s[0]===Math.fround(e)&&s[1]===Math.fround(t)}SetBatch1(e){this._lastBatchValue[0]=e}SetBatch2(e,t){const s=this._lastBatchValue;s[0]=e,s[1]=t}}}{const C33=self.C3,glMatrix=self.glMatrix,vec42=glMatrix.vec4,mat42=glMatrix.mat4,BATCH_NULL=0,BATCH_QUAD=1,BATCH_SETTEXTURE=2,BATCH_SETCOLOR=3,BATCH_SETBLEND=4,BATCH_SETVIEWPORT=5,BATCH_SETPROJECTION=6,BATCH_SETMODELVIEW=7,BATCH_SETRENDERTARGET=8,BATCH_CLEARSURFACE=9,BATCH_POINTS=10,BATCH_SETPROGRAM=11,BATCH_SETPROGRAMPARAMETERS=12,BATCH_SETPROGRAMCUSTOMPARAMETERS=13,BATCH_INVALIDATEFRAMEBUFFER=14,BATCH_SETPOINTTEXCOORDS=15,BATCH_SETTILEMAPINFO=16,BATCH_BLITFRAMEBUFFER=17,BATCH_STARTQUERY=18,BATCH_ENDQUERY=19,BATCH_SETELLIPSEPARAMS=20,BATCH_SETGRADIENTCOLOR=21,BATCH_CLEARDEPTH=22,BATCH_SETDEPTHENABLED=23,BATCH_SETDEPTHSAMPLINGENABLED=24,BATCH_COPLANAR_STARTSTENCILPASS=25,BATCH_COPLANAR_STARTCOLORPASS=26,BATCH_COPLANAR_RESTORE=27,BATCH_SET_SCISSOR=28,BATCH_SETTILERANDOMIZATIONINFO=29;C33.Gfx.BatchState=class{constructor(e){this.renderer=e,this.currentMV=mat42.create(),this.currentMatP=mat42.create(),this.currentFramebuffer=null,this.currentFramebufferNoDepth=null,this.isDepthSamplingEnabled=!1,this.currentColor=vec42.fromValues(1,1,1,1),this.currentShader=null,this.pointTexCoords=new C33.Rect,this.clearColor=C33.New(C33.Color,0,0,0,0)}},C33.Gfx.WebGLBatchJob=class{constructor(e){const t=new ArrayBuffer(96);this._type=0,this._batchState=e,this._gl=e.renderer.GetContext(),this._startIndex=0,this._indexCount=0,this._texParam=null,this._mat4param=new Float32Array(t,0,16),this._colorParam=new Float32Array(t,64,4),this._srcOriginRect=new Float32Array(t,80,4),this._shaderParams=[]}InitQuad(e,t){this._type=BATCH_QUAD,this._startIndex=e,this._indexCount=t}DoQuad(){const e=this._gl;e.drawElements(e.TRIANGLES,this._indexCount,e.UNSIGNED_SHORT,this._startIndex)}InitSetTexture(e){this._type=BATCH_SETTEXTURE,this._texParam=e}DoSetTexture(){const e=this._gl,t=this._texParam;e.bindTexture(e.TEXTURE_2D,t?t._GetTexture():null)}InitSetColor(e){this._type=BATCH_SETCOLOR,e.writeToTypedArray(this._colorParam,0)}DoSetColor(){const e=this._colorParam,t=this._batchState;vec42.copy(t.currentColor,e),t.currentShader.UpdateColor(e)}InitSetGradientColor(e){this._type=BATCH_SETGRADIENTCOLOR,e.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){const e=this._colorParam,t=this._batchState.currentShader;t._uColor2.IsUsed()&&t._uColor2.Update4f(e[0],e[1],e[2],e[3])}InitSetBlend(e,t){this._type=BATCH_SETBLEND,this._startIndex=e,this._indexCount=t}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(e,t,s,n){this._type=BATCH_SETVIEWPORT;const i=this._colorParam;i[0]=e,i[1]=t,i[2]=s,i[3]=n}DoSetViewport(){const e=this._colorParam;this._gl.viewport(e[0],e[1],e[2],e[3])}InitSetProjection(e){this._type=BATCH_SETPROJECTION,mat42.copy(this._mat4param,e)}DoSetProjection(){const e=this._batchState,s=e.renderer._allShaderPrograms,n=e.currentShader,i=this._mat4param;for(let e=0,t=s.length;e<t;++e){const r=s[e];r===n?r.UpdateMatP(i,!0):r.SetMatPStale()}mat42.copy(e.currentMatP,i)}InitSetModelView(e){this._type=BATCH_SETMODELVIEW,mat42.copy(this._mat4param,e)}DoSetModelView(){const e=this._batchState,s=e.renderer._allShaderPrograms,n=e.currentShader,i=this._mat4param;for(let e=0,t=s.length;e<t;++e){const r=s[e];r===n?r.UpdateMatMV(i,!0):r.SetMatMVStale()}mat42.copy(e.currentMV,i)}InitSetRenderTarget(e){this._type=BATCH_SETRENDERTARGET,this._texParam=e}DoSetRenderTarget(){const e=this._gl,t=this._texParam,s=this._batchState;t?(s.currentFramebuffer=t._GetFramebuffer(),s.currentFramebufferNoDepth=t._GetFramebufferNoDepth(),s.isDepthSamplingEnabled&&s.currentFramebufferNoDepth?e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebufferNoDepth):e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebuffer)):(s.currentFramebuffer=null,s.currentFramebufferNoDepth=null,e.bindFramebuffer(e.FRAMEBUFFER,null))}InitClearSurface(e){this._type=BATCH_CLEARSURFACE,e.writeToTypedArray(this._mat4param,0)}InitClearSurface2(e,t,s,n){this._type=BATCH_CLEARSURFACE;const i=this._mat4param;i[0]=e,i[1]=t,i[2]=s,i[3]=n}DoClearSurface(){const e=this._gl,t=this._mat4param,s=this._batchState,n=s.clearColor,i=t[0],r=t[1],a=t[2],o=t[3];n.equalsRgba(i,r,a,o)||(e.clearColor(i,r,a,o),n.setRgba(i,r,a,o)),e.clear(e.COLOR_BUFFER_BIT)}InitSetPointTexCoords(e){this._type=BATCH_SETPOINTTEXCOORDS,e.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){const e=this._mat4param;this._batchState.pointTexCoords.set(e[0],e[1],e[2],e[3])}InitPoints(e,t){this._type=BATCH_POINTS,this._startIndex=e,this._indexCount=1,this._mat4param[0]=t}DoPoints(){const e=this._gl,t=this._batchState,s=t.renderer,n=s._spPoints,i=(e.useProgram(n._shaderProgram),n.UpdateMatP(t.currentMatP,!1),n.UpdateMatMV(t.currentMV,!1),t.pointTexCoords),r=(n._uPointTexStart.IsUsed()&&n._uPointTexStart.Update2f(i.getLeft(),i.getTop()),n._uPointTexEnd.IsUsed()&&n._uPointTexEnd.Update2f(i.getRight(),i.getBottom()),this._mat4param[0]);if(n._uZElevation.IsUsed()&&n._uZElevation.Update1f(r),n._uColor.IsUsed()){const a=t.currentColor;n._uColor.Update4f(a[0],a[1],a[2],a[3])}e.drawArrays(e.POINTS,this._startIndex/4,this._indexCount),e.useProgram(t.currentShader._shaderProgram)}InitSetProgram(e){this._type=BATCH_SETPROGRAM,this._texParam=e}DoSetProgram(){const e=this._gl,t=this._batchState,s=this._texParam;if(t.currentShader=s,e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1),s._uColor.IsUsed()){const n=t.currentColor;s._uColor.Update4f(n[0],n[1],n[2],n[3])}}InitSetProgramParameters(){this._type=BATCH_SETPROGRAMPARAMETERS}DoSetProgramParameters(){const e=this._batchState.currentShader,t=this._gl,s=this._mat4param,n=this._colorParam,i=this._srcOriginRect;if(e._uSamplerBack.IsUsed()){const r=this._batchState.renderer,a=this._texParam;r._lastTexture1!==a&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a?a._GetTexture():null),r._lastTexture1=a,t.activeTexture(t.TEXTURE0))}e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(s[0],s[1]),e._uDestStart.IsUsed()&&e._uDestStart.Update2f(s[2],s[3]),e._uDestEnd.IsUsed()&&e._uDestEnd.Update2f(s[4],s[5]),e._uDevicePixelRatio.IsUsed()&&e._uDevicePixelRatio.Update1f(this._indexCount),e._uLayerScale.IsUsed()&&e._uLayerScale.Update1f(s[6]),e._uLayerAngle.IsUsed()&&e._uLayerAngle.Update1f(s[7]),e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(s[12],s[13]),e._uSrcEnd.IsUsed()&&e._uSrcEnd.Update2f(s[14],s[15]),e._uSrcOriginStart.IsUsed()&&e._uSrcOriginStart.Update2f(i[0],i[1]),e._uSrcOriginEnd.IsUsed()&&e._uSrcOriginEnd.Update2f(i[2],i[3]),e._uLayoutStart.IsUsed()&&e._uLayoutStart.Update2f(n[0],n[1]),e._uLayoutEnd.IsUsed()&&e._uLayoutEnd.Update2f(n[2],n[3]),e._uSeconds.IsUsed()&&e._uSeconds.Update1f(this._startIndex)}InitSetProgramCustomParameters(){this._type=BATCH_SETPROGRAMCUSTOMPARAMETERS}DoSetProgramCustomParameters(){const e=this._batchState.currentShader,s=e._uCustomParameters,n=this._shaderParams;for(let e=0,t=s.length;e<t;++e){const i=s[e],r=n[e];i.IsColorType()?i.Update3f(r.getR(),r.getG(),r.getB()):i.Update1f(r)}}InitInvalidateFramebuffer(e){this._type=BATCH_INVALIDATEFRAMEBUFFER,this._texParam=e}DoInvalidateFramebuffer(){const e=this._gl,t=this._texParam,s=this._batchState.currentFramebuffer;t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,t),e.invalidateFramebuffer(e.FRAMEBUFFER,[e.COLOR_ATTACHMENT0]),t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,s)}InitBlitFramebuffer(e,t,s){this._type=BATCH_BLITFRAMEBUFFER;const n=this._mat4param,i=this._batchState.renderer,r=(n[0]=e.GetWidth(),n[1]=e.GetHeight(),n[2]=(t||i).GetWidth(),n[3]=(t||i).GetHeight(),n[4]=e.IsLinearSampling()?1:0,n[5]="stretch"===s,this._shaderParams);C33.clearArray(r),r.push(e._GetFramebuffer()),r.push(t?t._GetFramebuffer():null)}DoBlitFramebuffer(){const e=this._mat4param,t=this._shaderParams,s=this._gl,n=e[0],i=e[1],r=e[2],a=e[3],o=0!==e[4],l=0!==e[5],h=t[0],c=t[1];if(s.bindFramebuffer(s.READ_FRAMEBUFFER,h),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,c),l)s.blitFramebuffer(0,0,n,i,0,0,r,a,s.COLOR_BUFFER_BIT,o?s.LINEAR:s.NEAREST);else{const u=Math.min(n,r),d=Math.min(i,a),_=Math.max(i-a,0),p=Math.max(a-i,0);s.blitFramebuffer(0,_,u,d+_,0,p,u,d+p,s.COLOR_BUFFER_BIT,s.NEAREST)}}InitStartQuery(e){this._type=BATCH_STARTQUERY,this._texParam=e}DoStartQuery(){this._texParam.BeginTimeElapsed(),this._texParam=null}InitEndQuery(e){this._type=BATCH_ENDQUERY,this._texParam=e}DoEndQuery(){this._texParam.EndTimeElapsed(),this._texParam=null}InitSetEllipseParams(e,t,s){this._type=BATCH_SETELLIPSEPARAMS;const n=this._mat4param;n[0]=e,n[1]=t,n[2]=s}DoSetEllipseParams(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[2])}InitSetTilemapInfo(e,t,s,n,i,r,a){this._type=BATCH_SETTILEMAPINFO;const o=this._mat4param;e.writeToTypedArray(o,0),o[4]=1/t,o[5]=1/s,o[6]=n/t,o[7]=i/s,o[8]=r/t,o[9]=a/s}DoSetTilemapInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(t[0],t[1]),e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[4],t[5]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[6],t[7]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[8],t[9])}InitSetTileRandomizationInfo(e,t,s,n,i,r,a){this._type=BATCH_SETTILERANDOMIZATIONINFO;const o=this._mat4param;o[0]=1/e,o[1]=1/t,o[2]=s,o[3]=n,o[4]=i,o[5]=r,o[6]=a}DoSetTileRandomizationInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[2],t[3]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[4]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[5],t[6])}InitClearDepth(e){this._type=BATCH_CLEARDEPTH,this._startIndex=e?1:0}DoClearDepth(){const e=this._gl,t=0!==this._startIndex;t||e.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT),t||e.depthMask(!1)}InitSetDepthEnabled(e){this._type=BATCH_SETDEPTHENABLED,this._startIndex=e?1:0}DoSetDepthEnabled(){const e=this._gl;0===this._startIndex?(e.disable(e.DEPTH_TEST),e.depthMask(!1)):(e.enable(e.DEPTH_TEST),e.depthMask(!0))}InitSetDepthSamplingEnabled(e){this._type=BATCH_SETDEPTHSAMPLINGENABLED,this._startIndex=e?1:0}DoSetDepthSamplingEnabled(){const e=this._gl,t=this._batchState,s=t.renderer,n=0!==this._startIndex;t.isDepthSamplingEnabled=n,e.activeTexture(e.TEXTURE2),n?(t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebufferNoDepth),e.bindTexture(e.TEXTURE_2D,s._GetDepthBuffer())):(e.bindTexture(e.TEXTURE_2D,null),t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebuffer)),e.activeTexture(e.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=BATCH_COPLANAR_STARTSTENCILPASS}DoCoplanarStartStencilPass(){const e=this._gl;e.clear(e.STENCIL_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.colorMask(!1,!1,!1,!1)}InitCoplanarStartColorPass(){this._type=BATCH_COPLANAR_STARTCOLORPASS}DoCoplanarStartColorPass(){const e=this._gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}InitCoplanarRestore(){this._type=BATCH_COPLANAR_RESTORE}DoCoplanarRestore(){const e=this._gl;e.disable(e.STENCIL_TEST)}InitSetScissor(e,t,s,n,i){this._type=BATCH_SET_SCISSOR,this._startIndex=e?1:0;const r=this._mat4param;r[0]=t,r[1]=s,r[2]=n,r[3]=i}DoSetScissor(){const e=this._gl,t=this._mat4param;1===this._startIndex?(e.enable(e.SCISSOR_TEST),e.scissor(t[0],t[1],t[2],t[3])):e.disable(e.SCISSOR_TEST)}Run(){switch(this._type){case 1:return void this.DoQuad();case 2:return void this.DoSetTexture();case 3:return void this.DoSetColor();case 4:return void this.DoSetBlend();case 5:return void this.DoSetViewport();case 6:return void this.DoSetProjection();case 7:return void this.DoSetModelView();case 8:return void this.DoSetRenderTarget();case 9:return void this.DoClearSurface();case 10:return void this.DoPoints();case 11:return void this.DoSetProgram();case 12:return void this.DoSetProgramParameters();case 13:return void this.DoSetProgramCustomParameters();case 14:return void this.DoInvalidateFramebuffer();case 15:return void this.DoSetPointTextureCoords();case 16:return void this.DoSetTilemapInfo();case 17:return void this.DoBlitFramebuffer();case 18:return void this.DoStartQuery();case 19:return void this.DoEndQuery();case 20:return void this.DoSetEllipseParams();case 21:return void this.DoSetGradientColor();case 22:return void this.DoClearDepth();case 23:return void this.DoSetDepthEnabled();case 24:return void this.DoSetDepthSamplingEnabled();case 25:return void this.DoCoplanarStartStencilPass();case 26:return void this.DoCoplanarStartColorPass();case 27:return void this.DoCoplanarRestore();case 28:return void this.DoSetScissor();case 29:return void this.DoSetTileRandomizationInfo()}}}}{let fillOrStrokeRect2=function(e,t,s,n,i,r){t?e.strokeRect(s,n,i,r):e.fillRect(s,n,i,r)},ptToPx2=function(e){return e*(4/3)},getOffsetParam2=function(e,t){e=e.trim();const s=parseFloat(e);return isFinite(s)?e.endsWith("%")?t*s/100:s:0};fillOrStrokeRect=fillOrStrokeRect2,ptToPx=ptToPx2,getOffsetParam=getOffsetParam2;const C33=self.C3,MAX_TEXTURE_SIZE=4096,EXTRA_LINE_HEIGHT=4,GENERIC_FONT_FAMILIES=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),DEFAULT_OPTS={timeout:60},tempColor=new C33.Color(0,0,0,1),VALID_HORIZ_ALIGNMENTS=new Set(["left","center","right"]),VALID_VERT_ALIGNMENTS=new Set(["top","center","bottom"]),VALID_WORD_WRAP_MODES=new Set(["word","cjk","character"]),VALID_TEXT_DIRECTIONS=new Set(["ltr","rtl"]),allRendererTexts=new Set;C33.FontManager&&C33.FontManager.addEventListener("fontload",e=>{const t=e.font.GetName();for(const s of allRendererTexts)(s.IsBBCodeEnabled()||C33.equalsNoCase(s.GetFontName(),t))&&s._SetWordWrapChanged()});let didCheckFoundBoundingBoxSupport=!1,supportsFontBoundingBoxMeasurements=!1;C33.Gfx.RendererText=class{constructor(e,t){t=Object.assign({},DEFAULT_OPTS,t),this._renderer=e,this._fontName="Arial",this._fontSize=16,this._fontSizeScale=1,this._lineHeight=0,this._isBold=!1,this._isItalic=!1,this._colorStr="black",this._isBBcodeEnabled=!1,this._iconSet=null,this._iconSmoothing=!0,this.onloadfont=null,this._alreadyLoadedFonts=new Set,this._horizontalAlign="left",this._verticalAlign="top",this._text="",this._bbString=null,this._wrappedText=C33.New(C33.WordWrap),this._wrapMode="word",this._textDirection="ltr",this._wordWrapChanged=!1,this._textLayoutChanged=!1,this._drawChanged=!1,this._drawMaxCharCount=-1,this._drawCharCount=0,this._cssWidth=0,this._cssHeight=0,this._width=0,this._height=0,this._zoom=1,this._textCanvas=null,this._textContext=null,this._measureContext=null,this._measureContextTop=null,this._lastCanvasWidth=-1,this._lastCanvasHeight=-1,this._lastTextCanvasFont="",this._lastMeasureCanvasFont="",this._lastTextCanvasFillStyle="",this._lastTextCanvasOpacity=1,this._lastTextCanvasLineWidth=1,this._measureTextCallback=e=>this._MeasureText(e),this._texture=null,this._rcTex=new C33.Rect,this._scaleFactor=1,this._textureTimeout=new C33.IdleTimeout(()=>{this.ReleaseTexture(),this._SetTextCanvasSize(8,8)},t.timeout),this.ontextureupdate=null,this._wasReleased=!1,allRendererTexts.add(this)}Release(){this.onloadfont=null,this._alreadyLoadedFonts.clear(),this._iconSet=null,this._bbString=null,this._textCanvas=null,this._textContext=null,this._measureContext=null,this._measureContextTop=null,this._measureTextCallback=null,this._textureTimeout.Release(),this.ontextureupdate=null,this.ReleaseTexture(),this._wrappedText.Clear(),this._wrappedText=null,this._renderer=null,this._wasReleased=!0,allRendererTexts.delete(this)}_SetDrawChanged(){this._drawChanged=!0}_SetTextLayoutChanged(){this._SetDrawChanged(),this._textLayoutChanged=!0}_SetWordWrapChanged(){this._SetTextLayoutChanged(),this._wordWrapChanged=!0}SetBBCodeEnabled(e){if(this._isBBcodeEnabled!==(e=!!e)){this._isBBcodeEnabled=e;const t=this._isBBcodeEnabled?"alphabetic":"top";this._textContext&&(this._textContext.textBaseline=t),this._measureContext&&(this._measureContext.textBaseline=t),this._SetWordWrapChanged()}}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetIconSet(e){this._iconSet!==e&&(this._iconSet=e,this._wrappedText.SetIconSet(e),this._iconSet&&this._iconSet.IsLoading()&&this._iconSet.LoadContent().then(()=>this._SetDrawChanged()),this._SetWordWrapChanged())}SetIconSmoothing(e){this._iconSmoothing!==(e=!!e)&&(this._iconSmoothing=e,this._SetDrawChanged())}SetFontName(e){this._fontName!==(e=e||"serif")&&(this._fontName=e,this._SetWordWrapChanged())}GetFontName(){return this._fontName}SetFontSize(e){this._fontSize!==(e=e<.1?.1:e)&&(this._fontSize=e,this._SetWordWrapChanged())}GetFontSize(){return this._fontSize}SetFontSizeScale(e){this._fontSizeScale!==e&&(this._fontSizeScale=e,this._SetWordWrapChanged())}SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._SetTextLayoutChanged())}GetLineHeight(){return this._lineHeight}SetBold(e){this._isBold!==(e=!!e)&&(this._isBold=e,this._SetWordWrapChanged())}IsBold(){return this._isBold}SetItalic(e){this._isItalic!==(e=!!e)&&(this._isItalic=e,this._SetWordWrapChanged())}IsItalic(){return this._isItalic}SetDrawMaxCharacterCount(e){e=Math.floor(e),this._drawMaxCharCount!==e&&(this._drawMaxCharCount=e,this._SetDrawChanged())}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetFontString(e,t){let s=[];(this._isBold||t.HasStyleTag("b"))&&s.push("bold"),(this._isItalic||t.HasStyleTag("i"))&&s.push("italic");const n=t.GetStyleTag("size"),i=(n?parseFloat(n.param):this._fontSize)*this._fontSizeScale;s.push(e?i+"pt":i*this.GetDrawScale()+"pt");let r=this._fontName,a=t.GetStyleTag("font");return a&&a.param&&(r=a.param,this.onloadfont)&&!this._alreadyLoadedFonts.has(r)&&(this.onloadfont(r),this._alreadyLoadedFonts.add(r)),r&&(GENERIC_FONT_FAMILIES.has(r)?s.push(r):s.push('"'+r+'"')),s.join(" ")}SetColor(e){e instanceof C33.Color&&(e=e.getCssRgb()),this._colorStr!==e&&(this._colorStr=e,this._SetDrawChanged())}SetColorRgb(e,t,s){tempColor.setRgb(e,t,s),this.SetColor(tempColor)}SetHorizontalAlignment(e){if(!VALID_HORIZ_ALIGNMENTS.has(e))throw new Error("invalid horizontal alignment");this._horizontalAlign!==e&&(this._horizontalAlign=e,this._SetTextLayoutChanged())}GetHorizontalAlignment(){return this._horizontalAlign}SetVerticalAlignment(e){if(!VALID_VERT_ALIGNMENTS.has(e))throw new Error("invalid vertical alignment");this._verticalAlign!==e&&(this._verticalAlign=e,this._SetTextLayoutChanged())}GetVerticalAlignment(){return this._verticalAlign}SetWordWrapMode(e){if(!VALID_WORD_WRAP_MODES.has(e))throw new Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetWordWrapChanged())}GetWordWrapMode(){return this._wrapMode}SetTextDirection(e){if(!VALID_TEXT_DIRECTIONS.has(e))throw new Error("invalid text direction");this._textDirection!==e&&(this._textDirection=e,this._textContext&&(this._textContext.direction=this._textDirection),this._measureContext&&(this._measureContext.direction=this._textDirection),this._SetWordWrapChanged())}GetTextDirection(){return this._textDirection}SetText(e){this._text!==e&&(this._text=e,this._SetWordWrapChanged())}GetText(){return this._text}GetDrawScale(){return this._scaleFactor*this._zoom*self.devicePixelRatio}SetSize(r,a,o){if(void 0===o&&(o=1),!(r<=0||this._cssWidth===r&&this._cssHeight===a&&this._zoom===o)){let e=this._cssWidth,t=(this._cssWidth=r,this._cssHeight=a,this._zoom=o,self.devicePixelRatio),s=(this._width=this._cssWidth*this._zoom*t,this._height=this._cssHeight*this._zoom*t,Math.max(this._width,this._height)),n=Math.min(this._renderer.GetMaxTextureSize(),MAX_TEXTURE_SIZE),i=1;n<s&&(i=n/s,this._width=Math.min(this._width*i,n),this._height=Math.min(this._height*i,n)),this._scaleFactor=i,this._cssWidth!==e?this._SetWordWrapChanged():this._SetTextLayoutChanged()}}GetWidth(){return this._width}GetHeight(){return this._height}GetZoom(){return this._zoom}GetTextWidth(){return this._UpdateTextMeasurements(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){return this._UpdateTextMeasurements(),this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+EXTRA_LINE_HEIGHT)-this._lineHeight}GetLengthInGraphemes(){this._UpdateTextMeasurements();let e=0;for(const t of this._wrappedText.GetLines())for(const s of t.fragments())e+=s.GetLength();return e}GetTexture(){return this._textureTimeout.Reset(),this._MaybeUpdate(),this._texture}HitTestFragment(e,t){this._UpdateTextMeasurements();const s=this.GetDrawScale(),n=this._wrappedText.GetLines();for(const i of n){const r=i.GetFontBoundingBoxDescent()*s;if(t>=i.GetPosY()-i.GetHeight()*s+r&&t<i.GetPosY()+r)for(const a of i.fragments())if(e>=a.GetPosX()&&e<a.GetPosX()+a.GetWidth()*s)return a}return null}*fragmentsWithTag(e){this._UpdateTextMeasurements();const t=this._wrappedText.GetLines();for(const s of t)for(const n of s.fragments()){const i=n.GetStyleTag("tag");i&&C33.equalsNoCase(i.param,e)&&(yield n)}}FindFragmentWithTag(e,t){for(const s of this.fragmentsWithTag(e)){if(0===t)return s;--t}return null}CountFragmentsWithTag(e){let t=0;for(const s of this.fragmentsWithTag(e))++t;return t}_MaybeUpdate(){this._texture&&!this._drawChanged&&!this._textLayoutChanged&&!this._wordWrapChanged||this._wasReleased||this._width<=0||this._height<=0||(this._drawChanged=!1,this._DoUpdate())}_DoUpdate(){this._wasReleased||(this._UpdateTextMeasurements(),this._SetTextCanvasSize(Math.max(C33.nextHighestPowerOfTwo(Math.ceil(this._width)),128),Math.max(C33.nextHighestPowerOfTwo(Math.ceil(this._height)),64)),this._DrawTextToCanvas(),this._UpdateTexture(),this._textureTimeout.Reset())}_SetTextCanvasSize(e,t){this._textCanvas||(this._textCanvas=C33.CreateCanvas(16,16));let s=!1;this._lastCanvasWidth===e&&this._lastCanvasHeight===t||(this._lastCanvasWidth=e,this._lastCanvasHeight=t,this._textCanvas.width=e,this._textCanvas.height=t,s=!0),this._textContext||(this._textContext=this._textCanvas.getContext("2d"),s=!0),s?(this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._textContext.direction=this._textDirection,this._textContext.font=this._lastTextCanvasFont,this._textContext.fillStyle=this._lastTextCanvasFillStyle,this._textContext.strokeStyle=this._lastTextCanvasFillStyle,this._textContext.globalAlpha=this._lastTextCanvasOpacity,this._textContext.lineWidth=this._lastTextCanvasLineWidth):this._textContext.clearRect(0,0,e,t)}_MaybeCreateMeasureContext(){this._measureContext||(this._measureContext=C33.CreateCanvas(16,16).getContext("2d"),this._measureContextTop=C33.CreateCanvas(16,16).getContext("2d"),this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._measureContextTop.textBaseline="top",this._measureContext.direction=this._textDirection,this._measureContextTop.direction=this._textDirection)}_SetMeasureFontString(e){this._lastMeasureCanvasFont!==e&&(this._lastMeasureCanvasFont=e,this._measureContext.font=e,this._measureContextTop.font=e)}_SupportsFontBoundingBoxMeasurements(){if(!didCheckFoundBoundingBoxSupport){didCheckFoundBoundingBoxSupport=!0,this._MaybeCreateMeasureContext();const e=this._measureContext.measureText("test");supportsFontBoundingBoxMeasurements="number"==typeof e.fontBoundingBoxAscent&&"number"==typeof e.fontBoundingBoxDescent}return supportsFontBoundingBoxMeasurements}_UpdateTextMeasurements(){this._UpdateWordWrap(),this._UpdateTextLayout()}_UpdateWordWrap(){this._wordWrapChanged&&(this._MaybeCreateMeasureContext(),!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new C33.BBString(this._text,{noEscape:!0})),this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,0),this._wordWrapChanged=!1)}_UpdateTextLayout(){this._textLayoutChanged&&(this._LayoutText(),this._textLayoutChanged=!1)}_MeasureText(e){let t=e.IsText()?e.GetCharacterArray().join(""):" ",s=(this._SetMeasureFontString(this._GetFontString(!0,e)),e.GetStyleTag("size")),n=(s?parseFloat(s.param):this._fontSize)*this._fontSizeScale,i=this._measureContext.measureText(t),r=0;if(this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()){const a=this._measureContextTop.measureText(t);r=i.fontBoundingBoxAscent-a.fontBoundingBoxAscent}return{width:i.width,height:ptToPx2(n),fontBoundingBoxAscent:i.fontBoundingBoxAscent||0,fontBoundingBoxDescent:i.fontBoundingBoxDescent||0,topToAlphabeticDistance:r}}_SetDrawFontString(e){this._lastTextCanvasFont!==e&&(this._lastTextCanvasFont=e,this._textContext.font=e)}_SetDrawCanvasColor(e){this._lastTextCanvasFillStyle!==e&&(this._lastTextCanvasFillStyle=e,this._textContext.fillStyle=e,this._textContext.strokeStyle=e)}_SetDrawCanvasOpacity(e){this._lastTextCanvasOpacity!==e&&(this._lastTextCanvasOpacity=e,this._textContext.globalAlpha=e)}_SetDrawCanvasLineWith(e){this._lastTextCanvasLineWidth!==e&&(this._lastTextCanvasLineWidth=e,this._textContext.lineWidth=e)}_LayoutText(){let n=this.GetDrawScale(),i=(EXTRA_LINE_HEIGHT+this._lineHeight)*n,r=0,a=this._wrappedText.GetLines();if(0!==a.length){for(const t of a){t.SetPosX(NaN),t.SetPosY(NaN);for(const o of t.fragments())o.SetPosX(NaN),o.SetPosY(NaN)}let e=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements(),s=a[0].GetHeight()*n;if("center"===this._verticalAlign){const l=a.reduce((e,t)=>e+t.GetHeight()*n+i,0)-i;r=Math.max(this._height/2-l/2,0),e&&(s=a[0].GetTopToAlphabeticDistance()*n)}else if("bottom"===this._verticalAlign){const h=a.reduce((e,t)=>e+t.GetHeight()*n+i,0)-this._lineHeight*n,c=e?a.at(-1).GetFontBoundingBoxDescent()*n:0;r=this._height-h-c-2}for(let e=0,t=a.length;e<t;++e){const u=a[e],d=u.GetHeight()*n,_=r;if(this._isBBcodeEnabled){if(r+=0===e?s:d,0<e&&r>this._height-EXTRA_LINE_HEIGHT*n)break}else if(0<e&&r>=this._height-d)break;0<=_&&this._LayoutTextLine(u,r,n),this._isBBcodeEnabled||(r+=d),r+=i}}}_LayoutTextLine(e,t,s){let n=0;"center"===this._horizontalAlign?n=Math.floor((this._width-e.GetWidth()*s)/2):"right"===this._horizontalAlign&&(n=this._width-e.GetWidth()*s),e.SetPosX(n),e.SetPosY(t);for(const i of"ltr"===this._textDirection?e.fragments():e.fragmentsReverse())this._LayoutFragment(i,n,t,s),n+=i.GetWidth()*s}_LayoutFragment(e,t,s,n){const i=e.GetStyleTag("offsetx"),r=(t+=i?getOffsetParam2(i.param,e.GetHeight())*n:0,e.GetStyleTag("offsety"));if(s+=r?getOffsetParam2(r.param,e.GetHeight())*n:0,e.IsIcon()){const a=e.GetStyleTag("iconoffsety");s+=a?getOffsetParam2(a.param,e.GetHeight())*n:.2*e.GetHeight()*n}e.SetPosX(t),e.SetPosY(s)}_DrawTextToCanvas(){this._textContext.imageSmoothingEnabled=this._iconSmoothing,this._textContext.imageSmoothingQuality="high",this._drawCharCount=0;const e=this.GetDrawScale(),t=this._wrappedText.GetLines();for(const s of t)this._DrawTextLine(s,e)}_DrawTextLine(e,t){const s=e.GetPosX(),n=e.GetPosY();if(Number.isFinite(s)&&Number.isFinite(n))for(const i of"ltr"===this._textDirection?e.fragments():e.fragmentsReverse())this._DrawFragment(i,t,e.GetHeight())}_DrawFragment(a,o,l){const h=this._textContext,c=a.GetPosX(),u=a.GetPosY();if(Number.isFinite(c)&&Number.isFinite(u)){let e=l/16,t=a.GetWidth()*o,s=a.GetHeight()*o,n=a.GetHeight()/16,i=(EXTRA_LINE_HEIGHT+this._lineHeight)*o,r=a.IsText()?a.GetCharacterArray():null;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;a.IsText()&&this._drawCharCount+r.length>this._drawMaxCharCount&&(r=r.slice(0,this._drawMaxCharCount-this._drawCharCount),t=this._MeasureText(a).width*o),this._drawCharCount+=a.GetLength()}const d=a.GetStyleTag("background"),_=a.HasStyleTag("u"),p=a.HasStyleTag("s");if((!a.IsText()||!C33.IsCharArrayAllWhitespace(r)||d||_||p)&&!a.HasStyleTag("hide")){const m=a.GetStyleTag("color"),g=a.GetStyleTag("opacity"),f=(this._SetDrawCanvasOpacity(g?parseFloat(g.param)/100:1),d&&(this._SetDrawCanvasColor(d.param),h.fillRect(c,u-s,t,s+i)),a.GetStyleTag("linethickness")),S=f?parseFloat(f.param):1,y=a.HasStyleTag("stroke");if(y&&this._SetDrawCanvasLineWith(.5*n*S*this.GetDrawScale()),a.IsText()){const C=r.join("");if(this._SetDrawFontString(this._GetFontString(!1,a)),!y){this._SetDrawCanvasLineWith(.5*n*S*this.GetDrawScale());const G=a.GetStyleTag("outlineback");G&&(this._SetDrawCanvasColor(G.param),this._FillOrStrokeText(!0,C,c,u,t))}if(this._SetDrawCanvasColor(m?m.param:this._colorStr),this._FillOrStrokeText(y,C,c,u,t),!y){this._SetDrawCanvasLineWith(.5*n*S*this.GetDrawScale());const T=a.GetStyleTag("outline");T&&(this._SetDrawCanvasColor(T.param),this._FillOrStrokeText(!0,C,c,u,t))}}else if(a.IsIcon()&&0<a.GetWidth()){const I=a.GetDrawable(this._iconSet);I&&h.drawImage(I,c,u-s,t,s)}if(this._SetDrawCanvasColor(m?m.param:this._colorStr),_&&fillOrStrokeRect2(h,y,c,u+o*e,t,o*e*S),p){const b=u-s/4,A=o*n,P=b+A/2;h.fillRect(c,P-A*S/2,t,A*S)}}}}_FillOrStrokeText(e,t,s,n,i){"rtl"===this._textDirection&&(s+=i),e?"Gecko"===C33.Platform.BrowserEngine?this._textContext.strokeText(t,s,n,i):this._textContext.strokeText(t,s,n):"Gecko"===C33.Platform.BrowserEngine?this._textContext.fillText(t,s,n,i):this._textContext.fillText(t,s,n)}_UpdateTexture(){this._renderer.IsContextLost()||(this._texture||(this._texture=this._renderer.CreateDynamicTexture(this._textCanvas.width,this._textCanvas.height,{mipMap:!0,mipMapQuality:"high"})),this._renderer.UpdateTexture(this._textCanvas,this._texture),this._rcTex.set(0,0,this._width/this._texture.GetWidth(),this._height/this._texture.GetHeight()),this.ontextureupdate&&this.ontextureupdate())}GetTexRect(){return this._rcTex}ReleaseTexture(){this._texture&&(this._renderer.IsContextLost()||this._renderer.DeleteTexture(this._texture),this._texture=null)}static OnContextLost(){for(const e of allRendererTexts)e.ReleaseTexture()}static GetAll(){return allRendererTexts.values()}}}{const C33=self.C3;class WebGLRealTimeElapsedQuery{constructor(e){this._gl=e.GetContext(),this._version=e.GetWebGLVersionNumber(),this._timerExt=e._GetDisjointTimerQueryExtension(),this._query=null,this._isActive=!1,this._hasResult=!1,this._result=0,1===this._version?this._query=this._timerExt.createQueryEXT():this._query=this._gl.createQuery()}Release(){this._DeleteQueryObject(),this._gl=null,this._timerExt=null,this._hasResult=!1}_DeleteQueryObject(){this._query&&(1===this._version?this._timerExt.deleteQueryEXT(this._query):this._gl.deleteQuery(this._query),this._query=null)}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");1===this._version?this._timerExt.beginQueryEXT(this._timerExt.TIME_ELAPSED_EXT,this._query):this._gl.beginQuery(this._timerExt.TIME_ELAPSED_EXT,this._query),this._isActive=!0}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");1===this._version?this._timerExt.endQueryEXT(this._timerExt.TIME_ELAPSED_EXT):this._gl.endQuery(this._timerExt.TIME_ELAPSED_EXT),this._isActive=!1}CheckForResult(){if(this._query&&!this._hasResult&&!this._isActive){let e;e=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_AVAILABLE_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE);const t=this._gl.getParameter(this._timerExt.GPU_DISJOINT_EXT);e&&!t&&(1===this._version?this._result=this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_EXT):this._result=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT),this._result/=1e9,this._hasResult=!0),(e||t)&&this._DeleteQueryObject()}}HasResult(){return this._hasResult}GetResult(){if(this._hasResult)return this._result;throw new Error("no result available")}}C33.Gfx.WebGLTimeElapsedQuery=class{constructor(e){this._renderer=e,this._frameNumber=e.GetFrameNumber(),this._isActive=!1,this._parentQuery=null,this._isNested=!1,this._realQuery=null,this._queries=[]}Release(){for(const e of this._queries)e instanceof WebGLRealTimeElapsedQuery&&e.Release();C33.clearArray(this._queries),this._parentQuery=null,this._realQuery=null,this._renderer=null}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");const e=this._renderer._GetTimeQueryStack();0<e.length?(this._isNested=!0,this._parentQuery=e.at(-1),this._parentQuery._EndReal(),this._parentQuery._queries.push(this)):(this._isNested=!1,this._parentQuery=null),this._isActive=!0,e.push(this),this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");const e=this._renderer._GetTimeQueryStack().pop();if(e!==this)throw new Error("can only end most nested query");this._isActive=!1,this._EndReal(),this._parentQuery&&(this._parentQuery._StartReal(),this._parentQuery=null)}_StartReal(){this._realQuery=C33.New(WebGLRealTimeElapsedQuery,this._renderer),this._queries.push(this._realQuery),this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed(),this._realQuery=null}CheckForResult(){for(const e of this._queries)e.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every(e=>e.HasResult())}GetResult(){return this._queries.reduce((e,t)=>e+t.GetResult(),0)}GetFrameNumber(){return this._frameNumber}}}{const C33=self.C3;C33.Gfx.WebGLQueryResultBuffer=class{constructor(e,t=1e3){this._renderer=e,this._maxQueries=t,this._buffer=[],this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear(),this._renderer._RemoveQueryResultBuffer(this),this._renderer=null}Clear(){for(const e of this._buffer)e.Release();C33.clearArray(this._buffer)}AddTimeElapsedQuery(){const e=new C33.Gfx.WebGLTimeElapsedQuery(this._renderer);if(this._buffer.push(e),this._buffer.length>this._maxQueries){const t=this._buffer.shift();t.Release()}return e}CheckForResults(e){for(const t of this._buffer){if(t.GetFrameNumber()>=e)return;if(t.IsNested())return;t.CheckForResult()}}GetFrameRangeResultSum(e,t){if(t<=e)return NaN;let s=0;for(const n of this._buffer){if(n.GetFrameNumber()>=t)break;if(!(n.GetFrameNumber()<e)){if(!n.HasResult())return NaN;s+=n.GetResult()}}return s}DeleteAllBeforeFrameNumber(s){for(let e=0,t=this._buffer.length;e<t;++e){const n=this._buffer[e];if(!(n.GetFrameNumber()<s))return void(0<e&&this._buffer.splice(0,e));n.Release()}}}}{let CheckPendingPolls2=function(){pollRafId=-1;for(const e of pendingPolls)e.checkFunc()&&(e.resolve(),pendingPolls.delete(e));0<pendingPolls.size&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls2))},C33=(CheckPendingPolls=CheckPendingPolls2,self.C3),assert=self.assert,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,DEFAULT_WEBGLRENDERER_OPTS={powerPreference:"default",enableGpuProfiling:!0,alpha:!1,depth:!1,canSampleDepth:!1,maxWebGLVersion:2,failIfMajorPerformanceCaveat:!1},VALID_POWER_PREFERENCES=new Set(["default","low-power","high-performance"]),MAX_VERTICES=8e3,MAX_INDICES=MAX_VERTICES/2*3,MAX_POINTS=8e3,LAST_POINT=MAX_POINTS-4,PARTIAL_TEXTURE_UPLOAD_CHUNK_SIZE=262144,defaultTexCoordsQuad=new C33.Quad(0,0,1,0,1,1,0,1),tmpProjection=mat42.create(),tmpModelView=mat42.create(),tmpQuad=new C33.Quad,tmpRect=new C33.Rect,loseContextExtension=null,pendingPolls=(C33.isDebug&&(self.debug_lose_webgl_context=function(){loseContextExtension?loseContextExtension.loseContext():console.warn("WEBGL_lose_context not supported")},self.debug_restore_webgl_context=function(){loseContextExtension?loseContextExtension.restoreContext():console.warn("WEBGL_lose_context not supported")}),new Set),pollRafId=-1;C33.Gfx.WebGLRenderer=class extends C33.Gfx.RendererBase{constructor(e,t){if(super(t),t=Object.assign({},DEFAULT_WEBGLRENDERER_OPTS,t),!VALID_POWER_PREFERENCES.has(t.powerPreference))throw new Error("invalid power preference");let s={alpha:!!t.alpha,depth:!1,antialias:!1,powerPreference:t.powerPreference,failIfMajorPerformanceCaveat:!!t.failIfMajorPerformanceCaveat},n=null,i=0;if(2<=t.maxWebGLVersion&&(n=e.getContext("webgl2",s),i=2),n||(n=e.getContext("webgl",s),i=1),!n)throw new Error("renderer-unavailable (could not get WebGL context)");this._gl=n,this._attribs=n.getContextAttributes(),this._versionString=n.getParameter(n.VERSION),this._version=i,this._viewport=vec42.create(),this._didChangeTransform=!1,this._bbProjectionMatrix=mat42.create(),this._usesDepthBuffer=!!t.depth,this._canSampleDepth=!(!t.depth||!t.canSampleDepth),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._depthBuffer=null,this._isAutoSizeDepthBuffer=!0,this._depthBufferWidth=0,this._depthBufferHeight=0,this._vertexBuffer=null,this._texcoordBuffer=null,this._indexBuffer=null,this._pointBuffer=null,this._vertexData=new Float32Array(MAX_VERTICES*this.GetNumVertexComponents()),this._indexData=new Uint16Array(MAX_INDICES),this._texcoordData=new Float32Array(2*MAX_VERTICES),this._pointData=new Float32Array(4*MAX_POINTS),this._vertexPtr=0,this._texPtr=0,this._pointPtr=0,this._lastVertexPtr=0,this._lastProgram=null,this._spDeviceTransformTextureFill=null,this._batch=[],this._batchPtr=0,this._topOfBatch=0,this._currentRenderTarget=null,this._lastPointZ=0,this._batchState=C33.New(C33.Gfx.BatchState,this),this._lastColor=C33.New(C33.Color,1,1,1,1),this._lastTexture0=null,this._lastTexture1=null,this._lastSrcBlend=0,this._lastDestBlend=0,this._lastPointTexCoords=new C33.Rect,this._lastScissorRect=C33.New(C33.Rect,0,0,-1,-1),this._coplanarMode=0,this._maxTextureSize=-1,this._minPointSize=0,this._maxPointSize=0,this._highpPrecision=0,this._unmaskedVendor="(unavailable)",this._unmaskedRenderer="(unavailable)",this._extensions=[],this._isInitialisingAfterContextRestored=!1,this._parallelShaderCompileExt=null,this._anisotropicExt=null,this._depthTextureExt=null,this._fragDepthExt=null,this._stdDerivativesExt=null,this._textureLodExt=null,this._maxAnisotropy=0,this._isGpuProfilingEnabled=!!t.enableGpuProfiling,this._timerExt=null,this._allQueryResultBuffers=new Set,this._timeQueryStack=[],this.FillIndexBufferData(this._indexData)}IsWebGL(){return!0}async InitState(){super.InitState();const e=this._gl,t=this.GetNumVertexComponents(),s=(this._lastColor.setRgba(1,1,1,1),this._lastTexture0=null,this._lastTexture1=null,this._vertexPtr=0,this._pointPtr=0,this._lastVertexPtr=MAX_VERTICES*t-4*t,C33.clearArray(this._batch),this._batchPtr=0,this._topOfBatch=0,this._lastProgram=null,this._currentRenderTarget=null,this._lastPointTexCoords.set(0,0,1,1),this._lastPointZ=0,this._batchState),n=(s.currentShader=null,s.currentFramebuffer=null,s.currentFramebufferNoDepth=null,vec42.set(s.currentColor,1,1,1,1),s.clearColor.setRgba(0,0,0,0),s.pointTexCoords.set(0,0,1,1),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this._lastSrcBlend=e.ONE,this._lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this._InitBlendModes(e),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this._usesDepthBuffer?(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.LEQUAL)):(e.disable(e.DEPTH_TEST),e.depthMask(!1)),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferData(e.ARRAY_BUFFER,this._pointData.byteLength,e.DYNAMIC_DRAW),this._vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertexData.byteLength,e.DYNAMIC_DRAW),this._texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferData(e.ARRAY_BUFFER,this._texcoordData.byteLength,e.DYNAMIC_DRAW),this._indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indexData,e.STATIC_DRAW),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),e.getParameter(e.ALIASED_POINT_SIZE_RANGE)),i=(this._minPointSize=n[0],this._maxPointSize=n[1],e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT)),r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),a=(this._highpPrecision=i&&r?Math.min(i.precision,r.precision):0,2048<this._maxPointSize&&(this._maxPointSize=2048),this._extensions=e.getSupportedExtensions(),e.getExtension("WEBGL_debug_renderer_info"));if(a&&(this._unmaskedVendor=e.getParameter(a.UNMASKED_VENDOR_WEBGL),this._unmaskedRenderer=e.getParameter(a.UNMASKED_RENDERER_WEBGL)),this._parallelShaderCompileExt=e.getExtension("KHR_parallel_shader_compile"),C33.isDebug&&(loseContextExtension=e.getExtension("WEBGL_lose_context")),this._isGpuProfilingEnabled&&(1===this.GetWebGLVersionNumber()?this._timerExt=e.getExtension("EXT_disjoint_timer_query"):this._timerExt=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query")),this._anisotropicExt=e.getExtension("EXT_texture_filter_anisotropic"),this._anisotropicExt?this._maxAnisotropy=e.getParameter(this._anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):this._maxAnisotropy=0,this.GetWebGLVersionNumber()<2&&this._usesDepthBuffer&&this._canSampleDepth&&(this._depthTextureExt=e.getExtension("WEBGL_depth_texture"),!this._depthTextureExt))throw new Error("no depth texture support");this.GetWebGLVersionNumber()<2&&(this._fragDepthExt=e.getExtension("EXT_frag_depth"),this._stdDerivativesExt=e.getExtension("OES_standard_derivatives"),this._textureLodExt=e.getExtension("EXT_shader_texture_lod"));let o=C33.Gfx.WebGLShaderProgram,l=o.GetDefaultVertexShaderSource(!1),h=o.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(),c=l,u=o.GetPointFragmentShaderSource_WebGL1_NoFragDepth(),d=o.GetPointVertexShaderSource_WebGL1(),_=o.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(),p=o.GetDefaultVertexShaderSource(!0),m=!1;this._usesDepthBuffer&&(this.GetWebGLVersionNumber()<2?this._fragDepthExt&&(h=o.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(),u=o.GetPointFragmentShaderSource_WebGL1_FragDepthEXT(),_=o.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(),m=!0):(c=o.GetDefaultVertexShaderSource_WebGL2(),h=o.GetTextureFillFragmentShaderSource_WebGL2(),u=o.GetPointFragmentShaderSource_WebGL2(),d=o.GetPointVertexShaderSource_WebGL2(),_=o.GetTilemapFragmentShaderSource_WebGL2(),p=o.GetDefaultVertexShaderSource_WebGL2(!0)));const g=o.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),m,this._stdDerivativesExt&&this._textureLodExt),f=2<=this.GetWebGLVersionNumber()?o.GetDefaultVertexShaderSource_WebGL2():l,S=[[h,c,"<default>"],[h,c,"<default-device-transform>"],[u,d,"<point>"],[o.GetColorFillFragmentShaderSource(),l,"<fill>"],[o.GetLinearGradientFillFragmentShaderSource(),l,"<lineargradient>"],[o.GetPenumbraFillFragmentShaderSource(),l,"<penumbra>"],[o.GetHardEllipseFillFragmentShaderSource(),l,"<hardellipse>"],[o.GetHardEllipseOutlineFragmentShaderSource(),l,"<hardellipseoutline>"],[o.GetSmoothEllipseFillFragmentShaderSource(),l,"<smoothellipse>"],[o.GetSmoothEllipseOutlineFragmentShaderSource(),l,"<smoothellipseoutline>"],[o.GetSmoothLineFillFragmentShaderSource(),l,"<smoothline>"],[_,p,"<tilemap>"],[g,f,"<tilerandomization>"]],y=await Promise.all(S.map(e=>this.CreateShaderProgram({src:e[0],vertexSrc:e[1],name:e[2]})));this._spTextureFill=y[0],this._spDeviceTransformTextureFill=y[1],this._spPoints=y[2],this._spColorFill=y[3],this._spLinearGradientFill=y[4],this._spPenumbraFill=y[5],this._spHardEllipseFill=y[6],this._spHardEllipseOutline=y[7],this._spSmoothEllipseFill=y[8],this._spSmoothEllipseOutline=y[9],this._spSmoothLineFill=y[10],this._spTilemapFill=y[11],this._spTileRandomization=y[12],this.SetTextureFillMode()}async CreateShaderProgram(e){const t=await C33.Gfx.WebGLShaderProgram.Create(this,e);return this._AddShaderProgram(t),t}ResetLastProgram(){this._lastProgram=null}SetSize(e,t,s){if(this._width!==e||this._height!==t||s){this.EndBatch();const n=this._gl,i=this._batchState;this._width=e,this._height=t,this._SetViewport(0,0,e,t),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,e/t),this.SetProjectionMatrix(this._bbProjectionMatrix),this._spDeviceTransformTextureFill&&(n.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram()),this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP),this._lastProgram=this._spDeviceTransformTextureFill,this._batchState.currentShader=this._spDeviceTransformTextureFill),n.bindTexture(n.TEXTURE_2D,null),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,null),n.activeTexture(n.TEXTURE0),this._lastTexture0=null,this._lastTexture1=null,this._usesDepthBuffer&&this._isAutoSizeDepthBuffer&&this._SetDepthBufferSize(this._width,this._height),this._currentRenderTarget&&this._currentRenderTarget._Resize(this._width,this._height),n.bindFramebuffer(n.FRAMEBUFFER,null),this._currentRenderTarget=null,i.currentFramebuffer=null,i.currentFramebufferNoDepth=null}}_SetDepthBufferSize(e,t){const s=this._gl;this._depthBuffer&&this._depthBufferWidth===e&&this._depthBufferHeight===t||(this._canSampleDepth?(this._depthBuffer&&s.deleteTexture(this._depthBuffer),this._depthBuffer=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._depthBuffer),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),2<=this.GetWebGLVersionNumber()?s.texImage2D(s.TEXTURE_2D,0,s.DEPTH24_STENCIL8,e,t,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):this._depthTextureExt&&s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_STENCIL,e,t,0,s.DEPTH_STENCIL,this._depthTextureExt.UNSIGNED_INT_24_8_WEBGL,null),s.bindTexture(s.TEXTURE_2D,null)):(this._depthBuffer&&s.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this._depthBuffer),s.renderbufferStorage(s.RENDERBUFFER,2<=this._version?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL,e,t),s.bindRenderbuffer(s.RENDERBUFFER,null)),this._depthBufferWidth=e,this._depthBufferHeight=t)}SetFixedSizeDepthBuffer(e,t){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!1,this._SetDepthBufferSize(e,t))}SetAutoSizeDepthBuffer(){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!0,this._SetDepthBufferSize(this._width,this._height))}_SetViewport(e,t,s,n){const i=this._viewport;if(i[0]!==e||i[1]!==t||i[2]!==s||i[3]!==n){const r=this.PushBatch();r.InitSetViewport(e,t,s,n),vec42.set(i,e,t,s,n),this._topOfBatch=0}}SetFovY(e){super.SetFovY(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetNearZ(e){super.SetNearZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetFarZ(e){super.SetFarZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetProjectionMatrix(e){if(!mat42.exactEquals(this._matP,e)){const t=this.PushBatch();t.InitSetProjection(e),mat42.copy(this._matP,e),this._topOfBatch=0,this._didChangeTransform=!0}}SetDefaultRenderTargetProjectionState(){let e,t,s,n=this._currentRenderTarget;s=(null===n?(e=this._bbProjectionMatrix,t=this.GetWidth(),this):(e=n.GetProjectionMatrix(),t=n.GetWidth(),n)).GetHeight(),this.SetProjectionMatrix(e),this._SetViewport(0,0,t,s)}SetModelViewMatrix(e){if(!mat42.exactEquals(this._matMV,e)){const t=this.PushBatch();t.InitSetModelView(e),mat42.copy(this._matMV,e),this._topOfBatch=0,this._didChangeTransform=!0}}ResetDidChangeTransformFlag(){this._didChangeTransform=!1}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){const e=this._batch;return this._batchPtr===e.length&&e.push(new C33.Gfx.WebGLBatchJob(this._batchState)),e[this._batchPtr++]}EndBatch(){0===this._batchPtr||this.IsContextLost()||(this._WriteBuffers(),this._ExecuteBatch(),this._batchPtr=0,this._vertexPtr=0,this._texPtr=0,this._pointPtr=0,this._topOfBatch=0)}_WriteBuffers(){const e=this._gl;0<this._pointPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr))),0<this._vertexPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr)),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr)))}_ExecuteBatch(){const s=this._batch;for(let e=0,t=this._batchPtr;e<t;++e)s[e].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(e,t,s,n){const i=this._lastColor;if(!i.equalsRgba(e,t,s,n)){i.setRgba(e,t,s,n);const r=this.PushBatch();r.InitSetColor(i),this._topOfBatch=0,this._currentStateGroup=null}}SetOpacity(e){const t=this._lastColor;if(t.getA()!==e){t.setA(e);const s=this.PushBatch();s.InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null}}SetColor(e){const t=this._lastColor;if(!t.equals(e)){t.set(e);const s=this.PushBatch();s.InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null}}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(e){if(e!==this._lastTexture0){const t=this.PushBatch();t.InitSetTexture(e),this._lastTexture0=e,this._topOfBatch=0}}_ResetLastTexture(){this._lastTexture0=null}SetBlendMode(e){const t=this._GetBlendByIndex(e);this._SetBlend(t[0],t[1])}SetNamedBlendMode(e){const t=this.GetNamedBlend(e);this._SetBlend(t.srcBlend,t.destBlend)}_SetBlend(e,t){if(e!==this._lastSrcBlend||t!==this._lastDestBlend){const s=this.PushBatch();s.InitSetBlend(e,t),this._lastSrcBlend=e,this._lastDestBlend=t,this._topOfBatch=0,this._currentStateGroup=null}}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(e){this.Rect2(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}Rect2(e,t,s,n){this.Quad2(e,t,s,t,s,n,e,n)}_ExtendQuadBatch(){let e=this._vertexPtr;if(e>=this._lastVertexPtr&&(this.EndBatch(),e=0),1===this._topOfBatch)this._batch[this._batchPtr-1]._indexCount+=6;else{const t=this.PushBatch();t.InitQuad(e,6),this._topOfBatch=1}}_WriteQuadToVertexBuffer(e){e.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ),this._vertexPtr+=12}Quad(e){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad2(e,t,s,n,i,r,a,o){this._ExtendQuadBatch();let l=this._vertexData,h=this._vertexPtr,c=this._baseZ+this._currentZ;l[h++]=e,l[h++]=t,l[h++]=c,l[h++]=s,l[h++]=n,l[h++]=c,l[h++]=i,l[h++]=r,l[h++]=c,l[h++]=a,l[h++]=o,l[h++]=c,this._vertexPtr=h,defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad4(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D(e,t,s,n,i,r,a,o,l,h,c,u,d){this._ExtendQuadBatch();let _=this._vertexData,p=this._vertexPtr,m=this._baseZ+this._currentZ;_[p++]=e,_[p++]=t,_[p++]=m+s,_[p++]=n,_[p++]=i,_[p++]=m+r,_[p++]=a,_[p++]=o,_[p++]=m+l,_[p++]=h,_[p++]=c,_[p++]=m+u,this._vertexPtr=p,d.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D2(e,t,s,n,i,r,a,o,l,h,c,u,d){this._ExtendQuadBatch();let _=this._vertexData,p=this._vertexPtr,m=this._baseZ+this._currentZ;_[p++]=e,_[p++]=t,_[p++]=m+s,_[p++]=n,_[p++]=i,_[p++]=m+r,_[p++]=a,_[p++]=o,_[p++]=m+l,_[p++]=h,_[p++]=c,_[p++]=m+u,this._vertexPtr=p,d.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}DrawMesh(n,i,r){const a=this._vertexData,o=this._texcoordData;if(r.length%3!=0)throw new Error("invalid index buffer length");for(let s=0,e=r.length;s<e;){const l=r[s++],h=r[s++],c=r[s++],u=3*l,d=3*h,_=3*c,p=2*l,m=2*h,g=2*c;this._ExtendQuadBatch();let e=this._vertexPtr,t=this._texPtr;a[e++]=n[0+u],a[e++]=n[1+u],a[e++]=n[2+u],a[e++]=n[0+d],a[e++]=n[1+d],a[e++]=n[2+d],a[e++]=n[0+_],a[e++]=n[1+_],a[e++]=n[2+_],a[e++]=n[0+_],a[e++]=n[1+_],a[e++]=n[2+_],o[t++]=i[0+p],o[t++]=i[1+p],o[t++]=i[0+m],o[t++]=i[1+m],o[t++]=i[0+g],o[t++]=i[1+g],o[t++]=i[0+g],o[t++]=i[1+g],this._vertexPtr=e,this._texPtr=t}}FullscreenQuad(e,t){this.SetCurrentZ(0),mat42.copy(tmpProjection,this._matP),mat42.copy(tmpModelView,this._matMV),this.SetDefaultRenderTargetProjectionState();const[s,n]=this.GetRenderTargetSize(this._currentRenderTarget),i=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(n),0,0,0,n);if(this.SetModelViewMatrix(i),"crop"===e&&this._currentRenderTarget&&t){const r=this._width/2,a=this._height/2,o=t.GetWidth(),l=t.GetHeight(),h=this._currentRenderTarget.GetWidth(),c=this._currentRenderTarget.GetHeight(),u=Math.min(h,o),d=Math.min(c,l),_=Math.max(l-c,0),p=Math.max(c-l,0);tmpRect.set(-r,a-p,-r+u,a-d-p),tmpQuad.setFromRect(tmpRect),tmpRect.set(0,_,u,d+_),tmpRect.divide(o,l),this.Quad3(tmpQuad,tmpRect)}else{const m=s/2,g=n/2;this.Rect2(-m,g,m,-g)}this.SetProjectionMatrix(tmpProjection),this.SetModelViewMatrix(tmpModelView)}StartRenderingPoints(e){if(!this._lastPointTexCoords.equals(e)){this._lastPointTexCoords.copy(e);const t=this.PushBatch();t.InitSetPointTexCoords(e),this._topOfBatch=0}}FinishRenderingPoints(){}Point(e,t,s,n){this._pointPtr>=LAST_POINT&&this.EndBatch();let i=this._pointPtr,r=this._baseZ+this._currentZ;if(2===this._topOfBatch&&this._lastPointZ===r)this._batch[this._batchPtr-1]._indexCount++;else{const o=this.PushBatch();o.InitPoints(i,r),this._topOfBatch=2,this._lastPointZ=r}const a=this._pointData;a[i++]=e,a[i++]=t,a[i++]=s,a[i++]=n,this._pointPtr=i}SetProgram(e){if(this._lastProgram!==e){const t=this.PushBatch();t.InitSetProgram(e),this._lastProgram=e,this._topOfBatch=0,this._currentStateGroup=null}}GetProgram(){return this._lastProgram}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(e){const t=this.PushBatch();t.InitSetGradientColor(e),this._topOfBatch=0}SetEllipseParams(e,t,s=1){const n=this.PushBatch();n.InitSetEllipseParams(e,t,s),this._topOfBatch=0}SetTilemapInfo(e,t,s,n,i,r,a){if(this._lastProgram!==this._spTilemapFill)throw new Error("must set tilemap fill mode first");const o=this.PushBatch();o.InitSetTilemapInfo(e,t,s,n,i,r,a),this._topOfBatch=0}SetTileRandomizationInfo(e,t,s,n,i,r,a){if(this._lastProgram!==this._spTileRandomization)throw new Error("must set tile randomization mode first");const o=this.PushBatch();o.InitSetTileRandomizationInfo(e,t,s,n,i,r,a),this._topOfBatch=0}SetProgramParameters(e,t,s,n,i,r,a,o,l,h,c){const u=this._lastProgram;if(c%=10800,u._hasAnyOptionalUniforms&&!u.AreOptionalUniformsAlreadySetInBatch(t,s,n,i,r,a,o,l,h,c)){const d=this.PushBatch(),_=(d.InitSetProgramParameters(),u.SetOptionalUniformsInBatch(t,s,n,i,r,a,o,l,h,c),d._mat4param),p=(_[0]=r,_[1]=a,t.writeToTypedArray(_,2),_[6]=l,_[7]=h,s.writeToTypedArray(_,12),d._colorParam),m=(i.writeToTypedArray(p,0),p[1]);p[1]=p[3],p[3]=m,n.writeToTypedArray(d._srcOriginRect,0),d._startIndex=c,d._indexCount=o,u._uSamplerBack.IsUsed()?d._texParam=e?e.GetTexture():null:d._texParam=null,this._topOfBatch=0}}SetProgramCustomParameters(e){const t=this._lastProgram;if(0!==e.length&&!t.AreCustomParametersAlreadySetInBatch(e)){const s=this.PushBatch();s.InitSetProgramCustomParameters(),t.SetCustomParametersInBatch(e),C33.shallowAssignArray(s._shaderParams,e),this._topOfBatch=0}}ClearRgba(e,t,s,n){const i=this.PushBatch();i.InitClearSurface2(e,t,s,n),this._topOfBatch=0}Clear(e){const t=this.PushBatch();t.InitClearSurface(e),this._topOfBatch=0}Start(){}Finish(){super.Finish(),this._gl.flush()}ClearDepth(){if(this._usesDepthBuffer&&this._currentRenderTarget&&this._currentRenderTarget.HasDepthBuffer()){const e=this.PushBatch();e.InitClearDepth(this._isDepthEnabled),this._topOfBatch=0}}SetDepthEnabled(e){if(this._isDepthEnabled!==(e=!!e)&&this._usesDepthBuffer){this._isDepthEnabled=e;const t=this.PushBatch();t.InitSetDepthEnabled(e),this._topOfBatch=0}}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(e){if(e=!!e,this._canSampleDepth&&this._isDepthSamplingEnabled!==e){if(e&&this.IsDepthEnabled())throw new Error("depth still enabled");this._isDepthSamplingEnabled=e;const t=this.PushBatch();t.InitSetDepthSamplingEnabled(e),this._topOfBatch=0}}SetScissorRect(e,t,s,n,i=0){if(e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),n=Math.floor(n),!this._lastScissorRect.equalsWH(e,t,s,n)){this._lastScissorRect.setWH(e,t,s,n);const r=i||this.GetRenderTargetSize(this.GetRenderTarget())[1],a=(t=r-t-n,this.PushBatch());a.InitSetScissor(!0,e,t,s,n),this._topOfBatch=0}}RemoveScissorRect(){if(-1!==this._lastScissorRect.getRight()){this._lastScissorRect.set(0,0,-1,-1);const e=this.PushBatch();e.InitSetScissor(!1,0,0,0,0),this._topOfBatch=0}}CheckForQueryResults(){for(const e of this._allQueryResultBuffers)e.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost(),C33.Gfx.WebGLRendererTexture.OnContextLost(),C33.Gfx.WebGLRenderTarget.OnContextLost(),C33.Gfx.RendererText.OnContextLost();for(const e of this._allQueryResultBuffers)e.Clear();this._extensions=[],this._timerExt=null,this._parallelShaderCompileExt=null,this._anisotropicExt=null,this._depthTextureExt=null,this._fragDepthExt=null,this._stdDerivativesExt=null,this._textureLodExt=null,this._maxAnisotropy=0,this._unmaskedVendor="(unavailable)",this._unmaskedRenderer="(unavailable)",this._lastProgram=null,this._spDeviceTransformTextureFill=null,this._depthBuffer=null;for(const t of this._stateGroups.values())t.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=!0,await this.InitState(),this._isInitialisingAfterContextRestored=!1;for(const e of this._stateGroups.values())e.OnContextRestored(this);this.SetSize(this._width,this._height,!0)}CreateStaticTexture(e,t){if(this.IsContextLost())throw new Error("context lost");this.EndBatch();const s=C33.New(C33.Gfx.WebGLRendererTexture,this);return s._CreateStatic(e,t),s}async CreateStaticTextureAsync(n,i){if(this.IsContextLost())throw new Error("context lost");if(i=Object.assign({},i),C33.Supports.ImageBitmapOptions){let e=await createImageBitmap(n,{premultiplyAlpha:"premultiply"}),t=i.wrapX&&"clamp-to-edge"!==i.wrapX||i.wrapY&&"clamp-to-edge"!==i.wrapY,s=C33.isPOT(e.width)&&C33.isPOT(e.height);return this.SupportsNPOTTextures()||s||!t?i.premultiplyAlpha=!1:C33.Supports.ImageBitmapOptionsResize?(e=await createImageBitmap(n,{premultiplyAlpha:"premultiply",resizeWidth:C33.nextHighestPowerOfTwo(e.width),resizeHeight:C33.nextHighestPowerOfTwo(e.height)}),i.premultiplyAlpha=!1):e=await createImageBitmap(n,{premultiplyAlpha:"none"}),C33.Asyncify(()=>this.CreateStaticTexture(e,i))}if(n instanceof Blob){if("undefined"==typeof Image)throw new Error("texture upload variant not supported in worker");const e=await C33.BlobToImage(n);n=e}return C33.Asyncify(()=>this.CreateStaticTexture(n,i))}CreateDynamicTexture(e,t,s){this.EndBatch();const n=C33.New(C33.Gfx.WebGLRendererTexture,this);return n._CreateDynamic(e,t,s),n}UpdateTexture(e,t,s){this.EndBatch(),t._Update(e,s)}DeleteTexture(e){e&&(e.SubtractReference(),0<e.GetReferenceCount()||(this.EndBatch(),e===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),e===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()))}CreateRenderTarget(e){let t=this._width,s=this._height,n=!0;if(e&&("number"==typeof e.width&&(t=Math.floor(e.width),n=!1),"number"==typeof e.height)&&(s=Math.floor(e.height),n=!1),t<=0||s<=0)throw new Error("invalid size");this.EndBatch();const i=C33.New(C33.Gfx.WebGLRenderTarget,this);return i._Create(t,s,Object.assign({isDefaultSize:n},e)),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,i}SetRenderTarget(e,t=!0){if(e!==this._currentRenderTarget){e&&e.IsDefaultSize()&&e._Resize(this._width,this._height);const s=this.PushBatch();s.InitSetRenderTarget(e),this._currentRenderTarget=e,this._topOfBatch=0,t&&this.SetDefaultRenderTargetProjectionState()}}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(e){return e?[e.GetWidth(),e.GetHeight()]:[this._width,this._height]}CopyRenderTarget(e,t="stretch"){if(this._version<2||this._currentRenderTarget&&0<this._currentRenderTarget.GetMultisampling())this.SetCopyBlend(),this.ResetColor(),this.DrawRenderTarget(e,t);else{const s=this.PushBatch();s.InitBlitFramebuffer(e,this._currentRenderTarget,t),this._topOfBatch=0}}DrawRenderTarget(e,t="stretch"){const s=e.GetTexture();if(!s)throw new Error("not a texture-backed render target");this.SetTexture(s),this.FullscreenQuad(t,s)}InvalidateRenderTarget(e){if(!(this._version<2)){const t=this.PushBatch();t.InitInvalidateFramebuffer(e._GetFramebuffer()),this._topOfBatch=0}}DeleteRenderTarget(e){this.SetRenderTarget(null),this.EndBatch();const t=e.GetTexture();t===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),t===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()}async ReadBackRenderTargetToImageData(e,t,s){this.EndBatch();let n=this._currentRenderTarget,i,r,a,o=(a=e?(i=e.GetWidth(),r=e.GetHeight(),e._GetFramebuffer()):(i=this.GetWidth(),r=this.GetHeight(),null),0),l=0,h=i,c=r;if(s){o=C33.clamp(Math.floor(s.getLeft()),0,i-1),l=C33.clamp(Math.floor(s.getTop()),0,r-1);let e=s.width(),t=(e=0===e?i-o:C33.clamp(Math.floor(e),0,i-o),s.height());t=0===t?r-l:C33.clamp(Math.floor(t),0,r-l),h=e,c=t,l=r-(l+c)}let u=this._gl,d=(u.bindFramebuffer(u.FRAMEBUFFER,a),()=>{u.bindFramebuffer(u.FRAMEBUFFER,null),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,this.SetRenderTarget(n)}),_;if(!t&&2<=this.GetWebGLVersionNumber()){u.bindFramebuffer(u.READ_FRAMEBUFFER,a);const p=u.createBuffer(),m=h*c*4,g=u.PIXEL_PACK_BUFFER,f=(u.bindBuffer(g,p),u.bufferData(g,m,u.STREAM_READ),u.readPixels(o,l,h,c,u.RGBA,u.UNSIGNED_BYTE,0),u.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.bindBuffer(g,null),d(),u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0));await this._WaitForObjectReady(()=>u.getSyncParameter(f,u.SYNC_STATUS)===u.SIGNALED),u.deleteSync(f),_=new ImageData(h,c),u.bindBuffer(g,p),u.getBufferSubData(g,0,new Uint8Array(_.data.buffer),0,m),u.bindBuffer(g,null),u.deleteBuffer(p)}else _=new ImageData(h,c),u.readPixels(o,l,h,c,u.RGBA,u.UNSIGNED_BYTE,new Uint8Array(_.data.buffer)),d();return _}CoplanarStartStencilPass(){this.SetDepthEnabled(!0);const e=this.PushBatch();e.InitCoplanarStartStencilPass(),this._topOfBatch=0,this._coplanarMode=1}CoplanarStartColorPass(){this.SetDepthEnabled(!1);const e=this.PushBatch();e.InitCoplanarStartColorPass(),this._topOfBatch=0,this._coplanarMode=2}IsCoplanarColorPass(){return 2===this._coplanarMode}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(!0);const e=this.PushBatch();e.InitCoplanarRestore(),this._topOfBatch=0,this._coplanarMode=0}StartQuery(e){if(this.SupportsGPUProfiling()){const t=this.PushBatch();t.InitStartQuery(e),this._topOfBatch=0}}EndQuery(e){if(this.SupportsGPUProfiling()){const t=this.PushBatch();t.InitEndQuery(e),this._topOfBatch=0}}_WaitForObjectReady(t){const e=new Promise(e=>pendingPolls.add({resolve:e,checkFunc:t}));return-1===pollRafId&&(pollRafId=self.requestAnimationFrame(CheckPendingPolls2)),e}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs.alpha?4:3)}GetEstimatedRenderBufferMemoryUsage(){let e=0;for(const t of C33.Gfx.WebGLRenderTarget.allRenderTargets())t.GetTexture()||(e+=t.GetEstimatedMemoryUsage());return e}GetEstimatedTextureMemoryUsage(){let e=0;for(const t of C33.Gfx.WebGLRendererTexture.allTextures())e+=t.GetEstimatedMemoryUsage();return e}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return 2<=this.GetWebGLVersionNumber()}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){return 0!==this._highpPrecision}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetWebGLExtensionsAnalyticsString(){if(2<=this.GetWebGLVersionNumber())return"webgl2";{const e=[];return this._fragDepthExt&&e.push("EXT_frag_depth"),this._stdDerivativesExt&&e.push("OES_standard_derivatives"),this._textureLodExt&&e.push("EXT_shader_texture_lod"),0<e.length?"webgl1:"+e.join(","):"webgl1:none"}}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(e){this._allQueryResultBuffers.add(e)}_RemoveQueryResultBuffer(e){this._allQueryResultBuffers.delete(e)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(e){this._InitBlendModeData([["normal",e.ONE,e.ONE_MINUS_SRC_ALPHA],["additive",e.ONE,e.ONE],["xor",e.ONE,e.ONE_MINUS_SRC_ALPHA],["copy",e.ONE,e.ZERO],["destination-over",e.ONE_MINUS_DST_ALPHA,e.ONE],["source-in",e.DST_ALPHA,e.ZERO],["destination-in",e.ZERO,e.SRC_ALPHA],["source-out",e.ONE_MINUS_DST_ALPHA,e.ZERO],["destination-out",e.ZERO,e.ONE_MINUS_SRC_ALPHA],["source-atop",e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],["destination-atop",e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA]])}CreateWebGLText(){return this.CreateRendererText()}}}{const C33=self.C3,DEFAULT_CTOR_OPTS={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};C33.Gfx.EffectChainManager=class{constructor(e){e=Object.assign({},DEFAULT_CTOR_OPTS,e),this._cbGetDrawSize=e.getDrawSize,this._cbGetRenderTarget=e.getRenderTarget,this._cbReleaseRenderTarget=e.releaseRenderTarget,this._cbGetTime=e.getTime,this._cbRedraw=e.redraw,this._webgpuBackTexture=null,this._allEffectChains=new Set}_AddEffectChain(e){this._allEffectChains.add(e)}_RemoveEffectChain(e){this._allEffectChains.delete(e)}OnContextLost(){this._webgpuBackTexture=null;for(const e of this._allEffectChains)e.OnContextLost()}GetDrawSize(e){return this._cbGetDrawSize?this._cbGetDrawSize(e):[e.GetWidth(),e.GetHeight()]}GetRenderTarget(e){return this._cbGetRenderTarget(e)}ReleaseRenderTarget(e,t){this._cbReleaseRenderTarget(e,t)}GetTime(){return this._cbGetTime()}Redraw(e){this._cbRedraw(e)}_GetWebGPUBackTexture(e,t,s){return t=Math.floor(t),s=Math.floor(s),!this._webgpuBackTexture||this._webgpuBackTexture.GetWidth()===t&&this._webgpuBackTexture.GetHeight()===s||(e.DeleteTexture(this._webgpuBackTexture),this._webgpuBackTexture=null),null===this._webgpuBackTexture&&(this._webgpuBackTexture=e.CreateStaticTexture(null,{width:t,height:s,sampling:"nearest",mipMap:!1})),this._webgpuBackTexture}}}{const C33=self.C3,assert=self.assert,glMatrix=self.glMatrix,mat42=glMatrix.mat4,tempRect=C33.New(C33.Rect),tempRect2=C33.New(C33.Rect),tempRect3=C33.New(C33.Rect),tempRect4=C33.New(C33.Rect),tempMat4a=mat42.create(),tempMat4b=mat42.create(),DEFAULT_CTOR_OPTS={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:!1},DEFAULT_BUILDSTEPS_OPTS={indexMap:null,forcePreDraw:!1,forcePostDraw:!1,is3D:!1,isSourceTextureRotated:!1,isRotatedOrNegativeSizeInstance:!1,useFullSurface:!1};C33.Gfx.EffectChain=class{constructor(e,t){t=Object.assign({},DEFAULT_CTOR_OPTS,t),this._manager=e,this._cbDrawContent=t.drawContent,this._cbGetSourceTextureInfo=t.getSourceTextureInfo,this._cbGetShaderParameters=t.getShaderParameters,this._cbDrawContentHook=null,this._shaderProgramList=[],this._shaderProgramIndices=[],this._steps=[],this._needsRebuild=!1,this._blendMode=0,this._isAnyShaderAnimated=!1,this._isAnyShaderDepthSampling=!1,this._isAnyShaderBackgroundBlending=!1,this._isAnyShaderCrossSampling=!1,this._isAnyIsSrcTexRotated=!1,this._useCopyTextureBackgroundSampling=!1,this._didChangeTransform=!1,this._depthEnabledAtStart=!1,this._coplanarColorPassAtStart=!1,this._canUseFastPath=!1,this._useFullSurface=!1,this._isSourceTextureRotated=!1,this._numTempSurfacesRequired=0,this._renderTargets=[null,null,null],this._invalidateRenderTargets=!!t.invalidateRenderTargets,this._boxExtendHorizontal=0,this._boxExtendVertical=0,this._drawWidth=0,this._drawHeight=0,this._contentObject=null,this._contextObject=null,this._layoutRect=C33.New(C33.Rect),this._drawSurfaceRect=C33.New(C33.Rect),this._rcTexOriginal=C33.New(C33.Rect),this._rcTexBounce=C33.New(C33.Rect),this._rcTexDest=C33.New(C33.Rect),this._devicePixelRatio=1,this._layerScale=1,this._layerAngle=0,this._time=0,this._destRenderTarget=null,this._backTex=null,this._compositOffX=0,this._compositOffY=0,this._updateOwnProjection=!1,this._projectionMatrix=mat42.create(),this._modelViewMatrix=mat42.create(),this._manager._AddEffectChain(this)}Release(){this._manager._RemoveEffectChain(this),C33.clearArray(this._steps),C33.clearArray(this._shaderProgramList),C33.clearArray(this._shaderProgramIndices),this._contentObject=null,this._contextObject=null,this._cbDrawContent=null,this._cbGetSourceTextureInfo=null,this._cbGetShaderParameters=null}OnContextLost(){this._needsRebuild=!0,C33.clearArray(this._steps),C33.clearArray(this._shaderProgramList),C33.clearArray(this._shaderProgramIndices)}NeedsRebuild(){return this._needsRebuild}BuildSteps(i,e){if(e=Object.assign({},DEFAULT_BUILDSTEPS_OPTS,e),C33.clearArray(this._steps),this._boxExtendHorizontal=0,this._boxExtendVertical=0,this._isAnyShaderAnimated=!1,this._isAnyShaderDepthSampling=!1,this._isAnyShaderBackgroundBlending=!1,this._isAnyShaderCrossSampling=!1,this._isAnyIsSrcTexRotated=!1,this._useCopyTextureBackgroundSampling=!1,this._numTempSurfacesRequired=0,this._isSourceTextureRotated=!!e.isSourceTextureRotated,this._useFullSurface=!!e.useFullSurface,this._needsRebuild=!1,C33.shallowAssignArray(this._shaderProgramList,i),0!==i.length){if(e.indexMap){if(e.indexMap.length!==i.length)throw new Error("incorrect indexMap length");C33.shallowAssignArray(this._shaderProgramIndices,e.indexMap)}else{C33.clearArray(this._shaderProgramIndices);for(let e=0,t=i.length;e<t;++e)this._shaderProgramIndices.push(e)}for(const t of i)this._boxExtendHorizontal+=t.GetBoxExtendHorizontal(),this._boxExtendVertical+=t.GetBoxExtendVertical(),t.IsAnimated()&&(this._isAnyShaderAnimated=!0),t.UsesDepth()&&(this._isAnyShaderDepthSampling=!0),t.BlendsBackground()&&(this._isAnyShaderBackgroundBlending=!0),t.UsesCrossSampling()&&(this._isAnyShaderCrossSampling=!0),t.UsesIsSrcTexRotated()&&(this._isAnyIsSrcTexRotated=!0);this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(i[0].GetRenderer());const r=this._ShouldPreDraw(i[0],e),a=this._ShouldPostDraw(i.at(-1),e);if(1!==i.length||r||a){this._canUseFastPath=!1;let n=0;r&&(this._numTempSurfacesRequired=1,this._steps.push(C33.New(C33.Gfx.EffectChain.Step.PreDraw,this,-1,1)),n=1);for(let t=0,s=i.length;t<s;++t)if(0!==t||r){let e=1===n?2:1;t!==s-1||a||(e=0),this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,e),this._steps.push(C33.New(C33.Gfx.EffectChain.Step.Bounce,this,n,e,t)),n=e}else this._numTempSurfacesRequired=1,this._steps.push(C33.New(C33.Gfx.EffectChain.Step.FirstBounce,this,-1,1,t)),n=1;a&&this._steps.push(C33.New(C33.Gfx.EffectChain.Step.PostDraw,this,n,0))}else this._canUseFastPath=!0}}_ShouldPreDraw(e,t){return!!(t.forcePreDraw||e.MustPreDraw()||t.is3D&&!e.Supports3DDirectRendering()||e.UsesDepth()&&!this._useFullSurface||0!==this._boxExtendHorizontal||0!==this._boxExtendVertical)||(e.GetRenderer().IsWebGL()?e.BlendsBackground()&&(t.isRotatedOrNegativeSizeInstance||t.isSourceTextureRotated)||e.UsesAnySrcRectOrPixelSize()&&t.isSourceTextureRotated:e.BlendsBackground()&&!this._useCopyTextureBackgroundSampling&&t.isRotatedOrNegativeSizeInstance)}_ShouldPostDraw(e,t){return!!t.forcePostDraw||(e.GetRenderer().IsWebGL()?e.BlendsBackground()||e.UsesCrossSampling():(e.BlendsBackground()||e.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling())}_ShouldUseCopyTextureBackgroundSampling(e){return e.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling}Render(e,t,s){e.IsWebGPU()&&null===t&&(t=e.GetBackbufferRenderTarget()),this._destRenderTarget=t,this._contentObject=s.contentObject||null,this._contextObject=s.contextObject||null,this._blendMode=s.blendMode||0,this._devicePixelRatio=s.devicePixelRatio||1,this._layerScale=s.layerScale||1,this._layerAngle=s.layerAngle||0,this._time="number"==typeof s.time?s.time:this._manager.GetTime(),this._didChangeTransform=!1,e.ResetDidChangeTransformFlag(),this._isAnyShaderAnimated&&this._Redraw();let n=!1;if(this._UseCopyTextureBackgroundSampling()&&(this._CalculateDrawSizeAndRectangles(e,s),n=!0,this._backTex=this._manager._GetWebGPUBackTexture(e,this._drawWidth,this._drawHeight),tempRect.copy(this._drawSurfaceRect),tempRect.roundOuter(),e.IsWebGPU()&&e._MaybeDoPendingClearRenderPass(this._destRenderTarget),e.CopyTextureToTexture(this._destRenderTarget.GetTexture(),this._backTex,tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height())),this._canUseFastPath)this._Render_FastPath(e,s);else if(n||this._CalculateDrawSizeAndRectangles(e,s),0!==this._rcTexOriginal.width()||0!==this._rcTexOriginal.height()){e.SetAlphaBlend(),e.ResetColor(),e.SetBaseZ(0),e.SetCurrentZ(0),this._cbDrawContentHook=s.drawContentHook||null,this._compositOffX=s.compositOffX||0,this._compositOffY=s.compositOffY||0,this._updateOwnProjection=!!s.updateOwnProjection,this._OnBeforeStartEffectChain(e),this._renderTargets[0]=t,this._renderTargets[1]=1<=this._numTempSurfacesRequired?this._GetRenderTarget():null,this._renderTargets[2]=2===this._numTempSurfacesRequired?this._GetRenderTarget():null;for(const i of this._steps){const r=this._GetRenderTargetForId(i.GetSrcTargetId()),a=this._GetRenderTargetForId(i.GetDestTargetId());e.IsWebGPU()?i.Run_WebGPU(e,r,a):i.Run_WebGL(e,r,a)}e.SetTexture(null),this._renderTargets[1]&&this._ReleaseRenderTarget(this._renderTargets[1]),this._renderTargets[2]&&this._ReleaseRenderTarget(this._renderTargets[2]),this._renderTargets.fill(null),this._OnAfterEndEffectChain(e),this._destRenderTarget=null,this._backTex=null,this._contentObject=null,this._contextObject=null,this._cbDrawContentHook=null}}_CalculateDrawSizeAndRectangles(e,t){const[s,n]=this._manager.GetDrawSize(e);this._SetDrawSize(e,s,n),this._CalculateRectangles(t)}_SetDrawSize(e,t,s){if(t<=0||s<=0)throw new Error("invalid draw size");this._drawWidth===t&&this._drawHeight===s||this._CalculateDeviceTransformMatrices(e,t,s,0,0,this._projectionMatrix,this._modelViewMatrix),this._drawWidth=t,this._drawHeight=s}_CalculateDeviceTransformMatrices(e,t,s,n,i,r,a){const o=t/2+n,l=s/2+i,h=(e.CalculatePerspectiveMatrix(r,t/s),e.CalculateLookAtModelView2(o,l,e.GetDefaultCameraZ(s),o,l,0,s));mat42.copy(a,h)}_CalculateRectangles(e){this._layoutRect.copy(e.layoutRect),e.drawSurfaceRect?this._drawSurfaceRect.copy(e.drawSurfaceRect):this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight),this._rcTexOriginal.copy(this._drawSurfaceRect),this._rcTexOriginal.divide(this._drawWidth,this._drawHeight);const t=this._layerScale*this._devicePixelRatio;this._drawSurfaceRect.inflate(this._boxExtendHorizontal*t,this._boxExtendVertical*t),this._rcTexDest.copy(this._drawSurfaceRect),this._rcTexDest.divide(this._drawWidth,this._drawHeight),this._drawSurfaceRect.clampBoth(0,0,this._drawWidth,this._drawHeight),this._rcTexBounce.copy(this._drawSurfaceRect),this._rcTexBounce.divide(this._drawWidth,this._drawHeight)}_OnBeforeStartEffectChain(e){if(this._depthEnabledAtStart=e.IsDepthEnabled(),this._coplanarColorPassAtStart=e.IsCoplanarColorPass(),this._useFullSurface)e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0);else{if(tempRect.copy(this._drawSurfaceRect),e.IsWebGL()){const t=this._layerScale*this._devicePixelRatio;tempRect.inflate(Math.max(this._boxExtendHorizontal,1)*t,Math.max(this._boxExtendVertical,1)*t),tempRect.roundOuter(),tempRect.clamp(0,0,this._drawWidth,this._drawHeight)}else tempRect.roundOuter();e.SetScissorRect(tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height(),this._drawHeight)}}_OnAfterEffectChainDrawContent(e){e.ResetColor(),this._useFullSurface||(this._coplanarColorPassAtStart&&e.CoplanarRestoreStandardRendering(),e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!0)}_OnAfterEndEffectChain(e){e.SetDepthSamplingEnabled(!1),this._coplanarColorPassAtStart&&e.CoplanarStartColorPass(),e.SetDepthEnabled(this._depthEnabledAtStart),this._useFullSurface||e.RemoveScissorRect(),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!1),this._didChangeTransform=e.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(e){return e<0?null:this._renderTargets[e]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(e){this._manager.ReleaseRenderTarget(e,this)}_GetShaderProgramAt(e){return this._shaderProgramList[e]}_DrawContent(e){this._cbDrawContentHook?this._cbDrawContentHook(this,e,()=>this._cbDrawContent(e,this)):this._cbDrawContent(e,this),this._canUseFastPath||this._OnAfterEffectChainDrawContent(e)}_IsRenderTargetSameSizeAndOffset(e){if(this._useFullSurface)return!0;if(0!==this._compositOffX||0!==this._compositOffY)return!1;const[t,s]=e.GetRenderTargetSize(e.GetRenderTarget());return t===this._drawWidth&&s===this._drawHeight}_SetDeviceTransform(e,t){let s=this._projectionMatrix,n=this._modelViewMatrix;if(t&&!this._IsRenderTargetSameSizeAndOffset(e)){s=tempMat4a,n=tempMat4b;const[i,r]=e.GetRenderTargetSize(e.GetRenderTarget());this._CalculateDeviceTransformMatrices(e,i,r,this._compositOffX,this._compositOffY,s,n),this._useFullSurface||e.RemoveScissorRect()}e.SetProjectionMatrix(s),e.SetModelViewMatrix(n)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(e,t){return this._cbGetShaderParameters(this._shaderProgramIndices[e],t)}_SetProgramParameters(e,t){let s=this._rcTexDest,n=this._rcTexBounce,i=this._rcTexOriginal;e.IsWebGL()&&(tempRect2.copy(s),tempRect2.flipAround(1),s=tempRect2,tempRect3.copy(n),tempRect3.flipAround(1),n=tempRect3,tempRect4.copy(i),tempRect4.flipAround(1),i=tempRect4),this._DoSetProgramParameters(e,t,n,i,s,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(e,t){let n=this._rcTexBounce,i=this._rcTexOriginal,r=1/this._drawWidth,a=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let{srcTexRect:e,srcWidth:t,srcHeight:s}=this._cbGetSourceTextureInfo(this._contentObject);e||(tempRect.set(0,0,0,0),e=tempRect),t=t||this._drawWidth,s=s||this._drawHeight,n=e,i=e,r=1/t,a=1/s}else e.IsWebGL()&&(tempRect3.copy(n),tempRect3.flipAround(1),n=tempRect3,tempRect4.copy(i),tempRect4.flipAround(1),i=tempRect4);let s=this._rcTexDest;e.IsWebGL()&&((s=tempRect2).copy(this._rcTexDest),s.flipAround(1)),this._DoSetProgramParameters(e,t,n,i,s,r,a),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_GetBackTex(e){return this._isAnyShaderBackgroundBlending?e.IsWebGPU()?this._UseCopyTextureBackgroundSampling()?this._backTex:this._destRenderTarget.GetTexture():this._destRenderTarget:null}_DoSetProgramParameters(e,t,s,n,i,r,a){e.SetProgramParameters(this._GetBackTex(e),i,s,n,this._layoutRect,r,a,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(t,e))}_Render_FastPath(e,t){const s=this._shaderProgramList[0],n=e.IsDepthEnabled(),i=s.UsesDepth();i&&(e.SetDepthEnabled(!1),e.SetDepthSamplingEnabled(!0),this._rcTexDest.set(0,0,1,1),this._rcTexOriginal.set(0,0,1,1)),e.SetProgram(s),e.SetBlendMode(this._blendMode),e.SetRenderTarget(this._destRenderTarget);let r=0,a=1;if(this._rcTexOriginal.set(0,0,1,1),s.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){const{srcTexRect:o,srcWidth:l,srcHeight:h}=this._cbGetSourceTextureInfo(this._contentObject);o&&this._rcTexOriginal.copy(o),r=Number.isFinite(l)?1/l:0,a=Number.isFinite(h)?1/h:0}else{const[c,u]=this._manager.GetDrawSize(e);r=1/c,a=1/u}t.layoutRect?this._layoutRect.copy(t.layoutRect):this._layoutRect.set(0,0,0,0),e.SetProgramParameters(this._GetBackTex(e),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,r,a,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(0,e)),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated),e.SetBaseZ(0),this._DrawContent(e),i&&(e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(n))}_UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling}_UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling}IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending}CanSkipCalculatingDrawSurfaceRect(){return!!this._canUseFastPath&&!this._UseCopyTextureBackgroundSampling()}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(e,t,s){}}}{const C33=self.C3;C33.Gfx.EffectChain.Step=class{constructor(e,t,s,n=-1){this._effectChain=e,this._srcTargetId=t,this._destTargetId=s,this._index=n}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(e,t,s){}Run_WebGPU(e,t,s){}}}{const C33=self.C3;C33.Gfx.EffectChain.Step.PreDraw=class extends C33.Gfx.EffectChain.Step{constructor(e,t,s,n){super(e,t,s,n)}Run_WebGL(e,t,s){const n=this.GetEffectChain();e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,n._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),n._DrawContent(e),n._ClampRcTexDest()}Run_WebGPU(e,t,s){const n=this.GetEffectChain();e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),n._DrawContent(e),n._ClampRcTexDest()}}}{const C33=self.C3,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad);C33.Gfx.EffectChain.Step.PostDraw=class extends C33.Gfx.EffectChain.Step{constructor(e,t,s,n){super(e,t,s,n)}Run_WebGL(e,t,s){const n=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(s),n._SetDeviceTransform(e,!0),e.SetBlendMode(n._GetBlendMode()),e.SetTexture(t.GetTexture()),tempQuad.setFromRect(n._GetDrawSurfaceRect()),tempRect.copy(n._GetRcTexBounce()),tempRect.flipAround(1),e.Quad3(tempQuad,tempRect),n._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(t)}Run_WebGPU(e,t,s){const n=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(s,!1),n._IsRenderTargetSameSizeAndOffset(e)?tempQuad.setFromRect(n._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),n._SetDeviceTransform(e,!0),tempQuad.setFromRect(n._GetDrawSurfaceRect())),e.SetBackTexture(null),e.SetBlendMode(n._GetBlendMode()),e.SetTexture(t.GetTexture()),n.UseFullSurface()?e.FullscreenQuad():e.Quad3(tempQuad,n._GetRcTexBounce())}}}{const C33=self.C3;C33.Gfx.EffectChain.Step.FirstBounce=class extends C33.Gfx.EffectChain.Step{constructor(e,t,s,n){super(e,t,s,n)}Run_WebGL(e,t,s){const n=this.GetEffectChain();e.SetRenderTarget(s,n._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),n._SetFirstBounceProgramParameters(e,this.GetIndex()),n._DrawContent(e),n._ClampRcTexDest()}Run_WebGPU(e,t,s){const n=this.GetEffectChain();e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),n._SetFirstBounceProgramParameters(e,this.GetIndex()),n._DrawContent(e),n._ClampRcTexDest()}}}{const C33=self.C3,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad);C33.Gfx.EffectChain.Step.Bounce=class extends C33.Gfx.EffectChain.Step{constructor(e,t,s,n){super(e,t,s,n)}Run_WebGL(e,t,s){const n=this.GetEffectChain(),i=(e.SetRenderTarget(s),0===this.GetDestTargetId());i?e.SetBlendMode(n._GetBlendMode()):(e.ClearRgba(0,0,0,0),e.SetCopyBlend()),e.SetProgram(this.GetShaderProgram()),n._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),n._SetDeviceTransform(e,i),tempQuad.setFromRect(n._GetDrawSurfaceRect()),tempRect.copy(n._GetRcTexBounce()),tempRect.flipAround(1),e.Quad3(tempQuad,tempRect),n._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(t)}Run_WebGPU(e,t,s){const n=this.GetEffectChain(),i=(e.SetRenderTarget(s,!1),0===this.GetDestTargetId());i?(e.SetBlendMode(n._GetBlendMode()),e.SetBackTexture(null),n._IsRenderTargetSameSizeAndOffset(e)?tempQuad.setFromRect(n._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),n._SetDeviceTransform(e,!0),tempQuad.setFromRect(n._GetDrawSurfaceRect()))):(e.ClearRgba(0,0,0,0),e.SetCopyBlend(),tempQuad.setFromRect(n._GetRcTexBounce())),e.SetProgram(this.GetShaderProgram()),n._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),n.UseFullSurface()?e.FullscreenQuad():e.Quad3(tempQuad,n._GetRcTexBounce())}}}{let SortZOrderList2=function(e,t){const s=e[0],n=t[0],i=s-n;if(0!=i)return i;const r=e[1],a=t[1];return r-a},C33=(SortZOrderList=SortZOrderList2,self.C3),C3X=self.C3X,runtime=null,keysDownByKey=new Set,tempZOrderList=[],tempInstances=[],didWarnInAlertPolyfill=!1,didWarnFpsDeprecated=!1,VALID_FRAMERATE_MODES=new Set(["vsync","unlimited-tick","unlimited-frame"]);self.IRuntime=class{constructor(e){runtime=e,Object.defineProperties(this,{assets:{value:runtime.GetAssetManager().GetIAssetManager(),writable:!1},collisions:{value:runtime.GetCollisionEngine().GetICollisionEngine(),writable:!1},objects:{value:{},writable:!1},globalVars:{value:{},writable:!1},projectName:{value:runtime.GetProjectName(),writable:!1},projectVersion:{value:runtime.GetProjectVersion(),writable:!1},storage:{value:new self.IStorage(runtime),writable:!1},isInWorker:{value:runtime.IsInWorker(),writable:!1},viewportWidth:{value:runtime.GetOriginalViewportWidth(),writable:!1},viewportHeight:{value:runtime.GetOriginalViewportHeight(),writable:!1},sampling:{value:runtime.GetSampling(),writable:!1},isPixelRoundingEnabled:{value:runtime.IsPixelRoundingEnabled(),writable:!1},platformInfo:{value:new self.IPlatformInfo(e),writable:!1},sdk:{value:new self.ISDKUtils(e),writable:!1}}),runtime.UserScriptDispatcher().addEventListener("keydown",e=>{keysDownByKey.has(e.key)?e.stopPropagation():keysDownByKey.add(e.key)}),runtime.UserScriptDispatcher().addEventListener("keyup",e=>keysDownByKey.delete(e.key)),runtime.Dispatcher().addEventListener("window-blur",()=>keysDownByKey.clear()),runtime.IsInWorker()&&(self.alert=e=>(didWarnInAlertPolyfill||(didWarnInAlertPolyfill=!0,console.warn("[Construct] alert() was called from a Web Worker, because the project 'Use worker' setting is enabled. This method is not normally available in a Web Worker. Construct has implemented the alert for you, but note that other features may be missing in worker mode. You may wish to disable 'Use worker', or use a more convenient function like console.log(). For more information please refer to the scripting section of the manual.")),this.alert(e)))}_InitObjects(e){Object.defineProperties(this.objects,e)}_InitGlobalVars(e){Object.defineProperties(this.globalVars,e)}addEventListener(e,t){runtime.UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){runtime.UserScriptDispatcher().removeEventListener(e,t)}callFunction(e,...t){C3X.RequireString(e);const s=runtime.GetEventSheetManager(),n=s.GetFunctionBlockByName(e);if(!n)throw new Error(`cannot find function name '${e}'`);if(!n.IsEnabled())return n.GetDefaultReturnValue();if(t.length<n.GetFunctionParameterCount())throw new Error(`not enough function parameters passed for '${e}' (${t.length} passed, ${n.GetFunctionParameterCount()} expected)`);let i=n.GetEventBlock(),r=i.GetSolModifiersIncludingParents(),a=s.GetCurrentEvent();if(a){r=r.slice(0);const l=new Set(r);for(const h of a.GetSolModifiersIncludingParents())l.has(h)||(r.push(h),l.add(h));for(const c of s.GetDynamicSolModifiersSet())l.has(c)||(r.push(c),l.add(c))}const o=i.RunAsExpressionFunctionCall(r,n.IsCopyPicked(),n.GetReturnType(),n.GetDefaultReturnValue(),...t);return o}setReturnValue(e){const t=runtime.GetEventStack().GetCurrentExpFuncStackFrame();if(!t)throw new Error("not in a function which returns a value");switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:"number"!=typeof e&&"string"!=typeof e||t.SetFunctionReturnValue(e)}}signal(e){C3X.RequireString(e),runtime.GetEventSheetManager().Signal(e)}waitForSignal(e){return C3X.RequireString(e),runtime.GetEventSheetManager().WaitForSignal(e)}getViewportSize(){return[runtime.GetOriginalViewportWidth(),runtime.GetOriginalViewportHeight()]}get isSuspended(){return runtime.IsSuspended()}get dt(){return runtime.GetDt()}get dtRaw(){return runtime.GetDtRaw()}get gameTime(){return runtime.GetGameTime()}get wallTime(){return runtime.GetWallTime()}get timeScale(){return runtime.GetTimeScale()}set timeScale(e){C3X.RequireFiniteNumber(e),runtime.SetTimeScale(e)}get fps(){return didWarnFpsDeprecated||(console.warn("IRuntime.fps is deprecated. Use IRuntime.framesPerSecond instead."),didWarnFpsDeprecated=!0),runtime.GetFramesPerSecond()}get framesPerSecond(){return runtime.GetFramesPerSecond()}get ticksPerSecond(){return runtime.GetTicksPerSecond()}get cpuUtilisation(){return runtime.GetMainThreadTime()}get gpuUtilisation(){return runtime.GetGPUUtilisation()}get framerateMode(){return runtime.GetFramerateMode()}set framerateMode(e){if(!VALID_FRAMERATE_MODES.has(e))throw new Error("invalid framerate mode");runtime._SetFramerateMode(e)}get minDt(){return runtime.GetMinDt()}set minDt(e){C3X.RequireFiniteNumber(e),runtime.SetMinDt(e)}get maxDt(){return runtime.GetMaxDt()}set maxDt(e){runtime.SetMaxDt(e)}random(){return runtime.Random()}get layout(){const e=runtime.GetMainRunningLayout();if(e)return e.GetILayout();throw new Error("no layout is running - make sure a layout is loaded before accessing")}getLayout(e){let t=runtime.GetLayoutManager(),s=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(s=t.GetLayout(e))return s.GetILayout();throw new Error("invalid layout")}getAllLayouts(){return runtime.GetLayoutManager().GetAllLayouts().map(e=>e.GetILayout())}goToLayout(e){let t=runtime.GetLayoutManager(),s;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(!(s=t.GetLayout(e)))throw new Error("invalid layout");t.IsPendingChangeMainLayout()||t.ChangeMainLayout(s)}get keyboard(){const e=runtime._GetCommonScriptInterfaces().keyboard;if(e)return e;throw new Error("runtime.keyboard used but Keyboard object missing - add it to your project first")}get mouse(){const e=runtime._GetCommonScriptInterfaces().mouse;if(e)return e;throw new Error("runtime.mouse used but Mouse object missing - add it to your project first")}get touch(){const e=runtime._GetCommonScriptInterfaces().touch;if(e)return e;throw new Error("runtime.touch used but Touch object missing - add it to your project first")}get timelineController(){const e=runtime._GetCommonScriptInterfaces().timelineController;if(e)return e;throw new Error("runtime.timelineController used but Timeline Controller object missing - add it to your project first")}invokeDownload(e,t){C3X.RequireString(e),C3X.RequireString(t),runtime.InvokeDownload(e,t)}getInstanceByUid(e){C3X.RequireFiniteNumber(e);const t=runtime.GetInstanceByUID(e);return t?t.GetInterfaceClass():null}sortZOrder(e,n){C3X.RequireFunction(n);const i=runtime.GetCurrentLayout();for(const t of e){const s=runtime._UnwrapIWorldInstance(t),r=s.GetWorldInfo();tempZOrderList.push([r.GetLayer().GetIndex(),r.GetZIndex()]),tempInstances.push(s)}if(0!==tempZOrderList.length){tempZOrderList.sort(SortZOrderList2),tempInstances.sort((e,t)=>n(e.GetInterfaceClass(),t.GetInterfaceClass()));let s=!1;for(let e=0,t=tempZOrderList.length;e<t;++e){const a=tempInstances[e],o=i.GetLayerByIndex(tempZOrderList[e][0]),l=tempZOrderList[e][1],h=o._GetInstances();h[l]!==a&&((h[l]=a).GetWorldInfo()._SetLayer(o,!0),o.SetZIndicesChanged(a),s=!0)}s&&runtime.UpdateRender(),C33.clearArray(tempZOrderList),C33.clearArray(tempInstances)}}async createWorker(e,t){const s=new MessageChannel,n=s.port1,i=s.port2;return await runtime.PostComponentMessageToDOMAsync("runtime","script-create-worker",{url:e,opts:t,port2:i},[i]),n}alert(e){return runtime.PostComponentMessageToDOMAsync("runtime","alert",{message:e+(runtime.IsInWorker()?" [via Web Worker]":"")})}getHTMLLayer(e){return C3X.RequireFiniteNumber(e),runtime._GetHTMLLayerWrapElement(e)}addLoadPromise(e){runtime.AddLoadPromise(e)}}}{let C33=self.C3,C3X=self.C3X,assetManager=null;self.IAssetManager=class{constructor(e){assetManager=e,Object.defineProperties(this,{isWebMOpusSupported:{value:assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:!1}})}loadImageAsset(e){const t=self.IImageInfo._Unwrap(e);if(!t)throw new Error("invalid IImageInfo");t.LoadAsset(assetManager.GetRuntime())}fetchText(e){return assetManager.FetchText(e)}fetchJson(e){return assetManager.FetchJson(e)}fetchBlob(e){return assetManager.FetchBlob(e)}fetchArrayBuffer(e){return assetManager.FetchArrayBuffer(e)}getProjectFileUrl(e){return assetManager.GetProjectFileUrl(e)}getMediaFileUrl(e){return"flat"===assetManager.GetFileStructure()&&C33.IsRelativeURL(e)&&(e=e.toLowerCase()),assetManager.GetMediaFileUrl(e)}get mediaFolder(){return assetManager.GetMediaSubfolder()}async decodeWebMOpus(e,t){if(this.isWebMOpusSupported)throw new Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");const s=await assetManager.GetRuntime()._WasmDecodeWebMOpus(t),n=new Float32Array(s),i=e.createBuffer(1,n.length,48e3),r=i.getChannelData(0);return r.set(n),i}loadScripts(...e){return assetManager.LoadScripts(...e)}compileWebAssembly(e){return assetManager.CompileWebAssembly(e)}loadStyleSheet(e){return assetManager.LoadStyleSheet(e)}}}{let C33=self.C3,C3X=self.C3X,collisionEngine=null;self.ICollisionEngine=class{constructor(e){collisionEngine=e,Object.defineProperties(this,{runtime:{value:collisionEngine.GetRuntime(),writable:!1}})}testOverlap(e,t){const s=collisionEngine.GetRuntime(),n=s._UnwrapIWorldInstance(e),i=s._UnwrapIWorldInstance(t);return collisionEngine.TestOverlap(n,i)}testOverlapAny(e,t){const s=collisionEngine.GetRuntime(),n=s._UnwrapIWorldInstance(e);for(const i of t){const r=s._UnwrapIWorldInstance(i);if(collisionEngine.TestOverlap(n,r))return i}return null}testOverlapSolid(e){const t=collisionEngine.GetRuntime()._UnwrapIWorldInstance(e),s=collisionEngine.TestOverlapSolid(t);return s?s.GetInterfaceClass():null}setCollisionCellSize(e,t){if(C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),e=Math.floor(e),t=Math.floor(t),e<=0||t<=0)throw new Error("invalid cell size");collisionEngine.SetCollisionCellSize(e,t)}getCollisionCellSize(){return collisionEngine.GetCollisionCellSize()}getCollisionCandidates(e,t){let s=collisionEngine.GetRuntime(),n;n=Array.isArray(e)?e.map(e=>s._UnwrapIObjectClass(e)):[s._UnwrapIObjectClass(e)];const i=C33.Rect.FromObject(t),r=[];return collisionEngine.GetObjectClassesCollisionCandidates(null,n,i,r),r.map(e=>e.GetInterfaceClass())}}}{let C33=self.C3,C3X=self.C3X,runtime=null,osMap=new Map([["Windows","windows"],["macOS","macos"],["Linux","linux"],["Chrome OS","chrome-os"],["Android","android"],["iOS","ios"]]),browserMap=new Map([["Chrome","chrome"],["Chromium","chromium"],["Edge","edge"],["Opera","opera"],["NW.js","nwjs"],["Firefox","firefox"],["Safari","safari"]]),browserEngineMap=new Map([["Chromium","chromium"],["Gecko","gecko"],["WebKit","webkit"]]);self.IPlatformInfo=class{constructor(e){runtime=e,Object.defineProperties(this,{isMobile:{value:C33.Platform.IsMobile,writable:!1},os:{value:osMap.get(C33.Platform.OS)||"unknown",writable:!1},osVersion:{value:C33.Platform.OSVersion,writable:!1},browser:{value:browserMap.get(C33.Platform.Browser)||"unknown",writable:!1},browserVersion:{value:C33.Platform.BrowserVersion,writable:!1},browserEngine:{value:browserEngineMap.get(C33.Platform.BrowserEngine)||"unknown",writable:!1}})}get exportType(){let e=runtime.GetExportType();return runtime.IsNWjs()?e="nwjs":runtime.IsWindowsWebView2()?e="windows-webview2":"cordova"===e?e="Android"===C33.Platform.OS?"cordova-android":"cordova-ios":"playable-ad-single-file"!==e&&"playable-ad-zip"!==e||(e="playable-ad"),e}get renderer(){return runtime.GetCanvasManager().GetRendererString()}get rendererDetail(){return runtime.GetCanvasManager().GetRendererDetailString()}get canvasCssWidth(){return runtime.GetCanvasManager().GetCssWidth()}get canvasCssHeight(){return runtime.GetCanvasManager().GetCssHeight()}get canvasDeviceWidth(){return runtime.GetCanvasManager().GetDeviceWidth()}get canvasDeviceHeight(){return runtime.GetCanvasManager().GetDeviceHeight()}get devicePixelRatio(){return runtime.GetDevicePixelRatio()}}}{const C33=self.C3,C3X=self.C3X;self.IStorage=class{constructor(e){this._storage=e._GetProjectStorage()}getItem(e){return C3X.RequireString(e),this._storage.getItem(e)}setItem(e,t){return C3X.RequireString(e),this._storage.setItem(e,t)}removeItem(e){return C3X.RequireString(e),this._storage.removeItem(e)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}}}{const C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.IPlugin=class{#private;constructor(){const e=C33.AddonManager._GetInitObject2(internalApiToken);this.#private=e,Object.defineProperties(this,{runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},isSingleGlobal:{value:e.IsSingleGlobal(),writable:!1},isWorldType:{value:e.IsWorldType(),writable:!1},isHTMLElementType:{value:e.IsHTMLElementType(),writable:!1},isRotatable:{value:e.IsRotatable(),writable:!1},hasEffects:{value:e.HasEffects(),writable:!1},is3d:{value:e.Is3D(),writable:!1},supportsHierarchies:{value:e.SupportsSceneGraph(),writable:!1},supportsMesh:{value:e.SupportsMesh(),writable:!1}})}static getByConstructor(e){if(!e)return null;const t=C33.AddonManager.GetPluginByConstructorFunction(e);return t?t.GetIPlugin():null}getSingleGlobalObjectType(){return this.#private.GetSingleGlobalObjectClass().GetIObjectClass()}getSingleGlobalInstance(){return this.#private.GetSingleGlobalInstance().GetInterfaceClass()}}}{const C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.IObjectClass=class{#private;constructor(){const e=C33.AddonManager._GetInitObject2(internalApiToken);this.#private=e,Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},plugin:{value:e.GetPlugin().GetIPlugin(),writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}addEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),this.#private.UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),this.#private.UserScriptDispatcher().removeEventListener(e,t)}getAllInstances(){return[...this.instances()]}getFirstInstance(){return C33.first(this.instances())}getPickedInstances(){return[...this.pickedInstances()]}getFirstPickedInstance(){return C33.first(this.pickedInstances())}getPairedInstance(e){const t=this.#private,s=t.GetRuntime()._UnwrapIInstance(e),n=t.GetPairedInstance(s);return n?n.GetInterfaceClass():null}*instances(){for(const e of this.#private.instancesIncludingPendingCreate())yield e.GetInterfaceClass()}*pickedInstances(){for(const e of this.#private.GetCurrentSol().GetInstances())yield e.GetInterfaceClass()}setInstanceClass(e){C3X.RequireFunction(e);const t=this.#private;if(0<t.GetInstanceCount())throw new Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");t._SetUserScriptInstanceClass(e)}createInstance(e,t,s,n,i){if(C3X.RequireNumber(t),C3X.RequireNumber(s),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid layer parameter");const r=this.#private,a=r.GetRuntime(),o=a.GetMainRunningLayout().GetLayer(e);if(!o)throw new Error("invalid layer");const l=a.CreateInstance(r,o,t,s,n,i),h=(n&&o.SortAndAddInstancesByZIndex(l),a.GetEventSheetManager());return h.BlockFlushingInstances(!0),l._TriggerOnCreatedOnSelfAndRelated(),h.BlockFlushingInstances(!1),h.IsInEventEngine()||a.GetLayoutManager().IsEndingLayout()||a.FlushPendingInstances(),l.GetInterfaceClass()}}}{const C33=self.C3,C3X=self.C3X,map=new WeakMap,VALID_WHERE_STRINGS=["above","below","top-sublayer","bottom-sublayer"];self.ILayout=class{constructor(e){map.set(this,e);const t=[],s=e.GetEffectList(),n=s.GetAllEffectTypes().length;for(let e=0;e<n;++e)t.push(new self.IEffectInstance(s,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},effects:{value:t,writable:!1}})}addEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),map.get(this).UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){C3X.RequireString(e),C3X.RequireFunction(t),map.get(this).UserScriptDispatcher().removeEventListener(e,t)}get width(){return map.get(this).GetWidth()}set width(e){C3X.RequireFiniteNumber(e),map.get(this).SetWidth(e)}get height(){return map.get(this).GetHeight()}set height(e){C3X.RequireFiniteNumber(e),map.get(this).SetHeight(e)}setSize(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);const s=map.get(this);s.SetWidth(e),s.SetHeight(t)}getSize(){const e=map.get(this);return[e.GetWidth(),e.GetHeight()]}set scale(e){C3X.RequireFiniteNumber(e),map.get(this).SetScale(e)}get scale(){return map.get(this).GetScale()}set angle(e){C3X.RequireFiniteNumber(e),map.get(this).SetAngle(e)}get angle(){return map.get(this).GetAngle()}set scrollX(e){C3X.RequireNumber(e),map.get(this).SetScrollX(e)}get scrollX(){return map.get(this).GetScrollX()}set scrollY(e){C3X.RequireNumber(e),map.get(this).SetScrollY(e)}get scrollY(){return map.get(this).GetScrollY()}scrollTo(e,t){C3X.RequireNumber(e),C3X.RequireNumber(t);const s=map.get(this);s.SetScrollX(e),s.SetScrollY(t)}getScrollPosition(){const e=map.get(this);return[e.GetScrollX(),e.GetScrollY()]}getLayer(e){let t=map.get(this),s=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");return(s=t.GetLayer(e))?s.GetILayer():null}getAllLayers(){return map.get(this).GetLayers().map(e=>e.GetILayer())}*allLayers(){for(const e of map.get(this).allLayers())yield e.GetILayer()}addLayer(e,t,s){const n=map.get(this),i=self.ILayer,r=(C3X.RequireString(e),C3X.RequireOptionalInstanceOf(t,i),t?n.GetRuntime()._UnwrapScriptInterface(t):null),a=VALID_WHERE_STRINGS.indexOf(s);if(a<0)throw new Error("invalid location");n.AddLayer(e,r,a)}moveLayer(e,t,s){const n=map.get(this),i=n.GetRuntime(),r=self.ILayer,a=(C3X.RequireInstanceOf(e,r),i._UnwrapScriptInterface(e));if(!a)throw new Error("invalid layer");C3X.RequireOptionalInstanceOf(t,r);const o=t?i._UnwrapScriptInterface(t):null,l=VALID_WHERE_STRINGS.indexOf(s);if(l<0)throw new Error("invalid location");n.MoveLayer(a,o,l)}removeLayer(e){const t=map.get(this),s=self.ILayer,n=(C3X.RequireInstanceOf(e,s),t.GetRuntime()._UnwrapScriptInterface(e));if(!n)throw new Error("invalid layer");const i=n.GetRuntime();t.RemoveLayer(n),i.GetEventSheetManager().IsInEventEngine()||i.FlushPendingInstances()}removeAllDynamicLayers(){const e=map.get(this),t=e.GetRuntime();e.RemoveAllDynamicLayers(),t.GetEventSheetManager().IsInEventEngine()||t.FlushPendingInstances()}setVanishingPoint(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),map.get(this).SetVanishingPointXY(e,t)}getVanishingPoint(){return map.get(this)._GetVanishingPoint()}set projection(e){C3X.RequireString(e);const t=map.get(this);if("perspective"===e)t.SetPerspectiveProjection();else{if("orthographic"!==e)throw new Error("invalid projection");t.SetOrthographicProjection()}}get projection(){return map.get(this).IsOrthographicProjection()?"orthographic":"perspective"}}}{const C33=self.C3,C3X=self.C3X,map=new WeakMap,BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(e=>[e[1],e[0]])),tempColor=C33.New(C33.Color);self.ILayer=class{constructor(e){map.set(this,e);const t=[],s=e.GetEffectList(),n=s.GetAllEffectTypes().length;for(let e=0;e<n;++e)t.push(new self.IEffectInstance(s,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},layout:{value:e.GetLayout().GetILayout(),writable:!1},effects:{value:t,writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}get parentLayer(){const e=map.get(this).GetParentLayer();return e?e.GetILayer():null}*parentLayers(){for(const e of map.get(this).parentLayers())yield e.GetILayer()}*subLayers(){for(const e of map.get(this).GetSubLayers())yield e.GetILayer()}*allSubLayers(){for(const e of map.get(this).GetSubLayers())for(const t of e.selfAndAllSubLayers())yield t.GetILayer()}get index(){return map.get(this).GetIndex()}get isVisible(){return map.get(this)._IsVisibleFlagSet()}set isVisible(e){map.get(this).SetVisible(e)}get isSelfAndParentsVisible(){return map.get(this).IsVisible()}get isInteractive(){return map.get(this).IsInteractive()}set isInteractive(e){map.get(this).SetInteractive(e)}get isHTMLElementsLayer(){return map.get(this).IsHTMLElementsLayer()}set isHTMLElementsLayer(e){map.get(this).SetIsHTMLElementsLayer(!!e)}get isSelfAndParentsInteractive(){return map.get(this).IsSelfAndParentsInteractive()}get opacity(){return map.get(this).GetOpacity()}set opacity(e){e=C33.clamp(+e,0,1),isNaN(e)||map.get(this).SetOpacity(e)}set scale(e){C3X.RequireFiniteNumber(e),map.get(this).SetOwnScale(e)}get scale(){return map.get(this).GetOwnScale()}set scaleRate(e){C3X.RequireFiniteNumber(e),map.get(this).SetScaleRate(e)}get scaleRate(){return map.get(this).GetScaleRate()}set angle(e){C3X.RequireFiniteNumber(e),map.get(this).SetAngle(e)}get angle(){return map.get(this).GetOwnAngle()}set parallaxX(e){C3X.RequireFiniteNumber(e),map.get(this).SetParallaxX(e)}get parallaxX(){return map.get(this).GetParallaxX()}set parallaxY(e){C3X.RequireFiniteNumber(e),map.get(this).SetParallaxY(e)}get parallaxY(){return map.get(this).GetParallaxY()}set zElevation(e){C3X.RequireFiniteNumber(e),map.get(this).SetZElevation(e)}get zElevation(){return map.get(this).GetZElevation()}set isTransparent(e){map.get(this).SetTransparent(e)}get isTransparent(){return map.get(this).IsTransparent()}set isForceOwnTexture(e){map.get(this).SetForceOwnTexture(e)}get isForceOwnTexture(){return map.get(this).IsForceOwnTexture()}set blendMode(e){C3X.RequireString(e);const t=BLEND_MODE_TO_INDEX.get(e);if("number"!=typeof t)throw new Error("invalid blend mode");map.get(this).SetBlendMode(t)}get blendMode(){return INDEX_TO_BLEND_MODE.get(map.get(this).GetBlendMode())}set backgroundColor(e){if(C3X.RequireArray(e),e.length<3)throw new Error("expected 3 elements");tempColor.setRgb(e[0],e[1],e[2]);const t=map.get(this),s=t.GetBackgroundColor();s.equalsIgnoringAlpha(tempColor)||(s.copyRgb(tempColor),t.GetRuntime().UpdateRender())}get backgroundColor(){const e=map.get(this).GetBackgroundColor();return[e.getR(),e.getG(),e.getB()]}set scrollX(e){C3X.RequireNumber(e);const t=map.get(this);t.SetOwnScrollPositionEnabled(!0),t.SetScrollX(e)}get scrollX(){return map.get(this).GetScrollX()}set scrollY(e){C3X.RequireNumber(e);const t=map.get(this);t.SetOwnScrollPositionEnabled(!0),t.SetScrollY(e)}get scrollY(){return map.get(this).GetScrollY()}scrollTo(e,t){C3X.RequireNumber(e),C3X.RequireNumber(t);const s=map.get(this);s.SetOwnScrollPositionEnabled(!0),s.SetScrollX(e),s.SetScrollY(t)}getScrollPosition(){const e=map.get(this);return[e.GetScrollX(),e.GetScrollY()]}restoreScrollPosition(){map.get(this).SetOwnScrollPositionEnabled(!1)}getViewport(){return map.get(this).GetViewport().toDOMRect()}cssPxToLayer(e,t,s=0){C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(s);const n=map.get(this),i=n.GetRuntime();return n.CanvasCssToLayer(e-i.GetCanvasClientX(),t-i.GetCanvasClientY(),s)}layerToCssPx(e,t,s=0){C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(s);const n=map.get(this),i=n.GetRuntime(),[r,a]=n.LayerToCanvasCss(e,t,s);return[r+i.GetCanvasClientX(),a+i.GetCanvasClientY()]}drawSurfaceToLayer(e,t,s=0){return C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(s),map.get(this).DrawSurfaceToLayer(e,t,s)}layerToDrawSurface(e,t,s=0){return C3X.RequireNumber(e),C3X.RequireNumber(t),C3X.RequireNumber(s),map.get(this).LayerToDrawSurface(e,t,s)}get renderScale(){return map.get(this).GetRenderScale()}}}{let GetDispatcher2=function(e){let t=dispatchers.get(e);return t||(t=C33.New(C33.Event.Dispatcher),dispatchers.set(e,t)),t};GetDispatcher=GetDispatcher2;const C33=self.C3,C3X=self.C3X,dispatchers=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IInstance=class{#private;constructor(){const e=C33.AddonManager._GetInitObject2(internalApiToken),t={runtime:{value:(this.#private=e).GetRuntime().GetIRuntime(),writable:!1},objectType:{value:e.GetObjectClass().GetIObjectClass(),writable:!1},plugin:{value:e.GetPlugin().GetIPlugin(),writable:!1}};e._GetInstVarsScriptDescriptor(t),e._GetBehaviorsScriptDescriptor(t),Object.defineProperties(this,t),e.GetRuntime()._MapScriptInterface(this,e)}static _GetInitInst(){return C33.AddonManager._GetInitObject()}_release(){const e=dispatchers.get(this);e&&(e.Release(),dispatchers.delete(this))}addEventListener(e,t,s){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).addEventListener(e,t,s)}removeEventListener(e,t,s){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).removeEventListener(e,t,s)}dispatchEvent(e){GetDispatcher2(this).dispatchEvent(e)}destroy(){const e=this.#private,t=e.GetRuntime();t.DestroyInstance(e),t.GetEventSheetManager().IsInEventEngine()||t.GetLayoutManager().IsEndingLayout()||t.GetEventSheetManager().IsFlushingBlocked()||t.FlushPendingInstances()}getOtherContainerInstances(){const e=this.#private.GetSiblings();return e?e.map(e=>e.GetInterfaceClass()):[]}*otherContainerInstances(){const e=this.#private;if(e.IsInContainer())for(const t of e.siblings())yield t.GetInterfaceClass()}get uid(){return this.#private.GetUID()}get templateName(){return this.#private.GetTemplateName()}set timeScale(e){C3X.RequireFiniteNumber(e),this.#private.SetTimeScale(e)}get timeScale(){return this.#private.GetActiveTimeScale()}restoreTimeScale(){this.#private.RestoreTimeScale()}get dt(){const e=this.#private;return e.GetRuntime().GetDt(e)}hasTags(...e){C3X.RequireArray(e);const t=new Set(e),s=this.#private.GetTagsSet();return t.isSubsetOf(s)}setAllTags(e){C3X.RequireInstanceOf(e,Set),this.#private.SetTagsSet(e)}getAllTags(){return new Set(this.#private.GetTagsSet())}signal(e){C3X.RequireString(e);const t=this.#private;t.GetRuntime().GetEventSheetManager().InstanceSignal(t,e)}waitForSignal(e){C3X.RequireString(e);const t=this.#private;return t.GetRuntime().GetEventSheetManager().WaitForInstanceSignal(t,e)}}}{const C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.ISDKInstanceBase=class extends self.IInstance{#private;#isTicking=!1;#tickFunc=null;#isTicking2=!1;#tickFunc2=null;#domComponentId;#wrapperComponentId;constructor(e){super(),this.#private=C33.AddonManager._GetInitObject2(internalApiToken),this.#isTicking=!1,this.#tickFunc=null,this.#isTicking2=!1,this.#tickFunc2=null,this.#domComponentId=e?.domComponentId,this.#wrapperComponentId=e?.wrapperComponentId}_release(){this._setTicking(!1),this._setTicking2(!1),super._release()}_getInitProperties(){return C33.AddonManager._GetInitProperties()}_trigger(e){const t=this.#private;t.GetRuntime().Trigger(e,t)}_triggerAsync(e){const t=this.#private;return t.GetRuntime().TriggerAsync(e,t)}_addDOMMessageHandler(e,t){if(C3X.RequireString(e),C3X.RequireFunction(t),!this.#domComponentId)throw new Error("no DOM component id set");const s=this.#private.GetRuntime();s.AddDOMComponentMessageHandler(this.#domComponentId,e,t)}_addDOMMessageHandlers(e){C3X.RequireArray(e);for(const[t,s]of e)this._addDOMMessageHandler(t,s)}_postToDOM(e,t){if(C3X.RequireString(e),!this.#domComponentId)throw new Error("no DOM component id set");const s=this.#private.GetRuntime();s.PostComponentMessageToDOM(this.#domComponentId,e,t)}_postToDOMAsync(e,t){if(C3X.RequireString(e),!this.#domComponentId)throw new Error("no DOM component id set");const s=this.#private.GetRuntime();return s.PostComponentMessageToDOMAsync(this.#domComponentId,e,t)}_postToDOMMaybeSync(e,t){const s=this.#private.GetRuntime();if(!s.IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this.#domComponentId,handler:e,data:t,responseId:null});this._postToDOM(e,t)}_setTicking(e){if(this.#isTicking!==(e=!!e)){this.#isTicking=e;const t=this.#private.GetRuntime();e?(this.#tickFunc||(this.#tickFunc=()=>this._tick()),t.Dispatcher().addEventListener("tick",this.#tickFunc)):t.Dispatcher().removeEventListener("tick",this.#tickFunc)}}_isTicking(){return this.#isTicking}_tick(){}_setTicking2(e){if(this.#isTicking2!==(e=!!e)){this.#isTicking2=e;const t=this.#private.GetRuntime();e?(this.#tickFunc2||(this.#tickFunc2=()=>this._tick2()),t.Dispatcher().addEventListener("tick2",this.#tickFunc2)):t.Dispatcher().removeEventListener("tick2",this.#tickFunc2)}}_isTicking2(){return this.#isTicking2}_tick2(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(e){}_isWrapperExtensionAvailable(){if(!this.#wrapperComponentId)throw new Error("no wrapper component id set");const e=this.#private.GetRuntime();return e.HasWrapperComponentId(this.#wrapperComponentId)}_addWrapperExtensionMessageHandler(e,t){if(C3X.RequireString(e),C3X.RequireFunction(t),!this.#wrapperComponentId)throw new Error("no wrapper component id set");const s=this.#private.GetRuntime();s.AddWrapperExtensionMessageHandler(this.#wrapperComponentId,e,t)}_addWrapperMessageHandlers(e){C3X.RequireArray(e);for(const[t,s]of e)this._addWrapperExtensionMessageHandler(t,s)}_sendWrapperExtensionMessage(e,t){if(!this.#wrapperComponentId)throw new Error("no wrapper component id set");this.runtime.sdk.sendWrapperExtensionMessage(this.#wrapperComponentId,e,t)}_sendWrapperExtensionMessageAsync(e,t){if(this.#wrapperComponentId)return this.runtime.sdk.sendWrapperExtensionMessageAsync(this.#wrapperComponentId,e,t);throw new Error("no wrapper component id set")}}}{let MakeIWorldInstanceClass2=function(e){return class i extends e{#privateInst;#privateWi;constructor(e){super(e);const t=C33.AddonManager._GetInitObject2(internalApiToken),s=t.GetWorldInfo(),n=(this.#privateInst=t,this.#privateWi=s,map.set(this,t),[]),i=s.GetInstanceEffectList();if(i){const a=s.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let e=0;e<a;++e)n.push(new self.IEffectInstance(i,e))}const r={effects:{value:n,writable:!1}};Object.defineProperties(this,r)}get layout(){return this.#privateWi.GetLayout().GetILayout()}get layer(){return this.#privateWi.GetLayer().GetILayer()}get x(){return this.#privateWi.GetX()}set x(e){e=+e;const t=this.#privateWi;isNaN(e)||t.GetX()===e||(t.SetX(e),t.SetBboxChanged())}get y(){return this.#privateWi.GetY()}set y(e){e=+e;const t=this.#privateWi;isNaN(e)||t.GetY()===e||(t.SetY(e),t.SetBboxChanged())}setPosition(e,t){e=+e,t=+t;const s=this.#privateWi;isNaN(e)||isNaN(t)||s.GetX()===e&&s.GetY()===t||(s.SetXY(e,t),s.SetBboxChanged())}getPosition(){const e=this.#privateWi;return[e.GetX(),e.GetY()]}offsetPosition(e,t){if(e=+e,t=+t,!(isNaN(e)||isNaN(t)||0===e&&0===t)){const s=this.#privateWi;s.OffsetXY(e,t),s.SetBboxChanged()}}get zElevation(){return this.#privateWi.GetZElevation()}set zElevation(e){e=+e;const t=this.#privateInst,s=this.#privateWi;isNaN(e)||s.GetZElevation()===e||(s.SetZElevation(e),t.GetRuntime().UpdateRender())}get totalZElevation(){return this.#privateWi.GetTotalZElevation()}get width(){return this.#privateWi.GetWidth()}set width(e){e=+e;const t=this.#privateWi;isNaN(e)||t.GetWidth()===e||(t.SetWidth(e),t.SetBboxChanged())}get height(){return this.#privateWi.GetHeight()}set height(e){e=+e;const t=this.#privateWi;isNaN(e)||t.GetHeight()===e||(t.SetHeight(e),t.SetBboxChanged())}setSize(e,t){e=+e,t=+t;const s=this.#privateWi;isNaN(e)||isNaN(t)||s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())}getSize(){const e=this.#privateWi;return[e.GetWidth(),e.GetHeight()]}get angle(){return this.#privateWi.GetAngle()}set angle(e){e=C33.clampAngle(+e);const t=this.#privateWi;isNaN(e)||t.GetAngle()===e||(t.SetAngle(e),t.SetBboxChanged())}get angleDegrees(){return C33.toDegrees(this.angle)}set angleDegrees(e){this.angle=C33.toRadians(e)}getBoundingBox(){return this.#privateWi.GetBoundingBox().toDOMRect()}getBoundingQuad(){return this.#privateWi.GetBoundingQuad().toDOMQuad()}isOnScreen(){return this.#privateWi.IsInViewport2()}get isVisible(){return this.#privateWi.IsVisible()}set isVisible(e){e=!!e;const t=this.#privateInst,s=this.#privateWi;s.IsVisible()!==e&&(s.SetVisible(e),t.GetRuntime().UpdateRender())}get opacity(){return this.#privateWi.GetOpacity()}set opacity(e){e=C33.clamp(+e,0,1);const t=this.#privateInst,s=this.#privateWi;isNaN(e)||s.GetOpacity()===e||(s.SetOpacity(e),t.GetRuntime().UpdateRender())}set colorRgb(e){if(C3X.RequireArray(e),e.length<3)throw new Error("expected 3 elements");tempColor.setRgb(e[0],e[1],e[2]);const t=this.#privateInst,s=this.#privateWi;s.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor)||(s.SetUnpremultipliedColor(tempColor),t.GetRuntime().UpdateRender())}get colorRgb(){const e=this.#privateWi.GetUnpremultipliedColor();return[e.getR(),e.getG(),e.getB()]}set blendMode(e){C3X.RequireString(e);const t=BLEND_MODE_TO_INDEX.get(e);if("number"!=typeof t)throw new Error("invalid blend mode");const s=this.#privateInst,n=this.#privateWi;n.SetBlendMode(t),s.GetRuntime().UpdateRender()}get blendMode(){return INDEX_TO_BLEND_MODE.get(this.#privateWi.GetBlendMode())}moveToTop(){this.#privateWi.ZOrderMoveToTop()}moveToBottom(){this.#privateWi.ZOrderMoveToBottom()}moveToLayer(e){C3X.RequireInstanceOf(e,ILayer);const t=this.#privateInst,s=t.GetRuntime()._UnwrapScriptInterface(e);if(!s)throw new Error("invalid layer");t.GetWorldInfo().ZOrderMoveToLayer(s)}moveAdjacentToInstance(e,t){C3X.RequireInstanceOf(e,i),this.#privateWi.ZOrderMoveAdjacentToInstance(map.get(e),t)}get zIndex(){return this.#privateWi.GetZIndex()}get isCollisionEnabled(){return this.#privateWi.IsCollisionEnabled()}set isCollisionEnabled(e){this.#privateWi.SetCollisionEnabled(!!e)}containsPoint(e,t){return C3X.RequireNumber(e),C3X.RequireNumber(t),this.#privateWi.ContainsPoint(+e,+t)}testOverlap(e){C3X.RequireInstanceOf(e,i);const t=this.#privateInst,s=map.get(e);return t.GetRuntime().GetCollisionEngine().TestOverlap(t,s)}testOverlapSolid(){const e=this.#privateInst,t=e.GetRuntime().GetCollisionEngine().TestOverlapSolid(e);return t?t.GetInterfaceClass():null}getParent(){const e=this.#privateInst.GetParent();return e?e.GetInterfaceClass():null}getTopParent(){const e=this.#privateInst.GetTopParent();return e?e.GetInterfaceClass():null}*parents(){for(const e of this.#privateInst.parents())yield e.GetInterfaceClass()}getChildCount(){return this.#privateInst.GetChildCount()}getChildAt(e){const t=this.#privateInst.GetChildAt(e);return t?t.GetInterfaceClass():null}*children(){for(const e of this.#privateInst.children())yield e.GetInterfaceClass()}*allChildren(){for(const e of this.#privateInst.allChildren())yield e.GetInterfaceClass()}addChild(e,t){C3X.RequireInstanceOf(e,i),C3X.RequireOptionalObject(t),t=t||{};const s=this.#privateInst,n=map.get(e);s.AddChild(n,t)}removeChild(e){C3X.RequireInstanceOf(e,i);const t=this.#privateInst,s=map.get(e);t.RemoveChild(s)}removeFromParent(){const e=this.#privateInst;if(e.HasParent()){const t=e.GetParent();t.RemoveChild(e)}}getHierarchyOpts(){const e=this.#privateWi;return{transformX:e.GetTransformWithParentX(),transformY:e.GetTransformWithParentY(),transformWidth:e.GetTransformWithParentWidth(),transformHeight:e.GetTransformWithParentHeight(),transformAngle:e.GetTransformWithParentAngle(),transformZElevation:e.GetTransformWithParentZElevation(),transformOpacity:e.GetTransformWithParentOpacity(),transformVisibility:e.GetTransformWithParentVisibility(),destroyWithParent:e.GetDestroyWithParent()}}createMesh(e,t){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),this.#privateWi.CreateMesh(e,t)}releaseMesh(){const e=this.#privateWi;e.ReleaseMesh(),e.SetBboxChanged()}setMeshPoint(e,t,s){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),C3X.RequireObject(s);const n=this.#privateWi;n.SetMeshPoint(e,t,s)&&n.SetBboxChanged()}getMeshPoint(e,t){let s=NaN,n=NaN,i=NaN,r=NaN,a=NaN,o=this.#privateWi;if(o.HasMesh()){const l=o.GetSourceMesh(),h=l.GetMeshPointAt(e,t);null!==h&&(s=h.GetX(),n=h.GetY(),i=h.GetZElevation(),r=h.GetU(),a=h.GetV())}return{x:s,y:n,zElevation:i,u:r,v:a}}getMeshSize(){const e=this.#privateWi;if(!e.HasMesh())return[0,0];const t=e.GetSourceMesh();return[t.GetHSize(),t.GetVSize()]}}};MakeIWorldInstanceClass=MakeIWorldInstanceClass2;const C33=self.C3,C3X=self.C3X,IInstance=self.IInstance,ILayer=self.ILayer,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken(),BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),INDEX_TO_BLEND_MODE=new Map([...BLEND_MODE_TO_INDEX.entries()].map(e=>[e[1],e[0]])),tempColor=C33.New(C33.Color);self.IWorldInstance=MakeIWorldInstanceClass2(self.IInstance),self.IWorldInstanceSDKBase=MakeIWorldInstanceClass2(self.ISDKInstanceBase)}{const C33=self.C3,C3X=self.C3X;self.IDOMInstance=class extends self.IWorldInstance{#private;constructor(){super(),this.#private=self.IInstance._GetInitInst()}getElement(){return this.#private.GetSdkInstance()._GetElementInDOMMode()}focus(){this.#private.GetSdkInstance().FocusElement()}blur(){this.#private.GetSdkInstance().BlurElement()}setCssStyle(e,t){C3X.RequireString(e),this.#private.GetSdkInstance().SetElementCSSStyle(e,t)}}}{let GetDispatcher2=function(e){let t=dispatchers.get(e);return t||(t=C33.New(C33.Event.Dispatcher),dispatchers.set(e,t)),t};GetDispatcher=GetDispatcher2;const C33=self.C3,C3X=self.C3X,dispatchers=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.IBehaviorInstance=class{#private;constructor(){const e=C33.AddonManager._GetInitObject2(internalApiToken),t={runtime:{value:(this.#private=e).GetRuntime().GetIRuntime(),writable:!1},behavior:{value:e.GetBehavior().GetIBehavior(),writable:!1},behaviorType:{value:e.GetBehaviorType().GetIBehaviorType(),writable:!1}};Object.defineProperties(this,t),e.GetRuntime()._MapScriptInterface(this,e)}static _GetInitInst(){return C33.AddonManager._GetInitObject()}get instance(){return this.#private.GetObjectInstance().GetInterfaceClass()}_release(){const e=dispatchers.get(this);e&&(e.Release(),dispatchers.delete(this))}addEventListener(e,t,s){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).addEventListener(e,t,s)}removeEventListener(e,t,s){C3X.RequireString(e),C3X.RequireFunction(t),GetDispatcher2(this).removeEventListener(e,t,s)}dispatchEvent(e){GetDispatcher2(this).dispatchEvent(e)}}}{const C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.IBehaviorType=class{constructor(){const e=C33.AddonManager._GetInitObject2(internalApiToken),t={runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:e.GetBehavior().GetIBehavior(),writable:!1},name:{value:e.GetName(),writable:!1}};Object.defineProperties(this,t)}}}{const C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.IBehavior=class{#private;constructor(){const e=C33.AddonManager._GetInitObject2(internalApiToken),t={runtime:{value:(this.#private=e).GetRuntime().GetIRuntime(),writable:!1}};Object.defineProperties(this,t)}getAllInstances(){return this.#private.GetInstances().map(e=>e.GetInterfaceClass())}static getByConstructor(e){if(!e)return null;const t=C33.AddonManager.GetBehaviorByConstructorFunction(e);return t?t.GetIBehavior():null}}}{const C33=self.C3,C3X=self.C3X,tempColor=C33.New(C33.Color);self.IEffectInstance=class{#private;constructor(e,t){this.#private=e;const s={index:{value:t,writable:!1}};Object.defineProperties(this,s)}get name(){const e=this.#private.GetAllEffectTypes();return e[this.index].GetName()}get isActive(){return this.#private.IsEffectIndexActive(this.index)}set isActive(e){e=!!e;const t=this.#private;t.IsEffectIndexActive(this.index)!==e&&(t.SetEffectIndexActive(this.index,e),t.UpdateActiveEffects(),t.GetRuntime().UpdateRender())}setParameter(e,t){C3X.RequireFiniteNumber(e),e=Math.floor(+e);const s=this.#private,n=s.GetEffectParameter(this.index,e);if(null===n)throw new RangeError("invalid index");if(n instanceof C33.Color){if(!Array.isArray(t)||t.length<3)throw new TypeError("expected array with 3 elements");tempColor.setRgb(t[0],t[1],t[2]),t=tempColor}else if("number"!=typeof t)throw new TypeError("expected number");const i=s.SetEffectParameter(this.index,e,t);i&&s.IsEffectIndexActive(this.index)&&s.GetRuntime().UpdateRender()}getParameter(e){C3X.RequireFiniteNumber(e),e=Math.floor(+e);const t=this.#private,s=t.GetEffectParameter(this.index,e);if(null===s)throw new RangeError("invalid index");return s instanceof C33.Color?[s.getR(),s.getG(),s.getB()]:s}}}{const C33=self.C3,C3X=self.C3X;self.IAnimation=class{#private;constructor(e){this.#private=e,Object.defineProperties(this,{name:{value:e.GetName(),writable:!1}})}get speed(){return this.#private.GetSpeed()}get isLooping(){return this.#private.IsLooping()}get repeatCount(){return this.#private.GetRepeatCount()}get repeatTo(){return this.#private.GetRepeatTo()}get isPingPong(){return this.#private.IsPingPong()}get frameCount(){return this.#private.GetFrameCount()}getFrames(){return this.#private.GetFrames().map(e=>e.GetIAnimationFrame())}*frames(){for(const e of this.#private.GetFrames())yield e.GetIAnimationFrame()}}}{const C33=self.C3,C3X=self.C3X;self.IImageInfo=class{#private;constructor(e){this.#private=e}static _Unwrap(e){return e.#private}get width(){return this.#private.GetWidth()}get height(){return this.#private.GetHeight()}getSize(){const e=this.#private;return[e.GetWidth(),e.GetHeight()]}getTexture(e){return e.getTextureForImageInfo(this)}getTexRect(){return this.#private.GetTexRect().toDOMRect()}}}{const C33=self.C3,C3X=self.C3X;self.IAnimationFrame=class extends self.IImageInfo{#private;constructor(e){super(e.GetImageInfo()),this.#private=e,Object.defineProperties(this,{duration:{value:e.GetDuration(),writable:!1},originX:{value:e.GetOriginX(),writable:!1},originY:{value:e.GetOriginY(),writable:!1}})}getOrigin(){const e=this.#private;return[e.GetOriginX(),e.GetOriginY()]}getImagePointCount(){return this.#private.GetImagePointCount()}getImagePointX(e){return this.getImagePoint(e)[0]}getImagePointY(e){return this.getImagePoint(e)[1]}getImagePoint(e){let t=this.#private,s=null;if("number"==typeof e)s=t.GetImagePointByIndex(Math.floor(e));else{if("string"!=typeof e)throw new TypeError("expected string or number");s=t.GetImagePointByName(e)}return s?[s.GetX(),s.GetY()]:this.getOrigin()}getPolyPointCount(){const e=this.#private.GetCollisionPoly();return e?e.pointCount():0}getPolyPointX(e){return this.getPolyPoint(e)[0]}getPolyPointY(e){return this.getPolyPoint(e)[1]}getPolyPoint(e){C3X.RequireFiniteNumber(e),e=Math.floor(e);const t=this.#private.GetCollisionPoly();if(!t||e<0||e>=t.pointCount())return[0,0];const s=t.pointsArr(),n=s[2*e],i=s[2*e+1];return[n,i]}get tag(){return this.#private.GetTag()}}}{let GetTimelineState2=function(e){const t=map.get(e);if(t.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return t};GetTimelineState=GetTimelineState2;const C33=self.C3,C3X=self.C3X,map=new WeakMap;self.ITimelineStateBase=class{constructor(e){map.set(this,e),e.GetRuntime()._MapScriptInterface(this,e)}pause(){GetTimelineState2(this).Stop()}resume(){GetTimelineState2(this).Resume()}stop(){GetTimelineState2(this).Reset()}hasTags(e){return GetTimelineState2(this).HasTags(e)}set time(e){C3X.RequireFiniteNumber(e),GetTimelineState2(this).SetTime(e)}get time(){return GetTimelineState2(this).GetTime()}set totalTime(e){C3X.RequireFiniteNumber(e),GetTimelineState2(this).SetTotalTime(e)}get totalTime(){return GetTimelineState2(this).GetTotalTime()}set isLooping(e){GetTimelineState2(this).SetLoop(!!e)}get isLooping(){return GetTimelineState2(this).GetLoop()}set isPingPong(e){GetTimelineState2(this).SetPingPong(!!e)}get isPingPong(){return GetTimelineState2(this).GetPingPong()}set playbackRate(e){C3X.RequireFiniteNumber(e),GetTimelineState2(this).SetPlaybackRate(e)}get playbackRate(){return GetTimelineState2(this).GetPlaybackRate()}get progress(){const e=GetTimelineState2(this);return e.GetTime()/e.GetTotalTime()}get tags(){return GetTimelineState2(this).GetTags()}get finished(){return GetTimelineState2(this).GetPlayPromise()}get isPlaying(){return GetTimelineState2(this).IsPlaying()}get isPaused(){return GetTimelineState2(this).IsPaused()}get isReleased(){return map.get(this).IsReleased()}}}{let GetTimelineState2=function(e){const t=map.get(e);if(t.IsReleased())throw new Error("timeline was released and is no longer valid");return t},C33=(GetTimelineState=GetTimelineState2,self.C3),C3X=self.C3X,map=new WeakMap,easeToIndexFunc=null;self.ITimelineState=class extends self.ITimelineStateBase{constructor(e){super(e),map.set(this,e);const t={name:{value:e.GetName(),writable:!1}};Object.defineProperties(this,t)}}}{let GetTweenState2=function(e){const t=map.get(e);if(t.IsReleased())throw new Error("tween was released and is no longer valid");return t},C33=(GetTweenState=GetTweenState2,self.C3),C3X=self.C3X,map=new WeakMap,behInstMap=new WeakMap,easeToIndexFunc=null;self.ITweenState=class extends self.ITimelineStateBase{constructor(e,t,s){super(e),easeToIndexFunc=easeToIndexFunc||s.easeToIndexFunc,map.set(this,e),t&&behInstMap.set(this,t)}stop(){const e=GetTweenState2(this),t=behInstMap.get(this);t.ReleaseTween(e)}setEase(e){C3X.RequireString(e);const t=self.Ease.GetEaseFromIndex(easeToIndexFunc(e));GetTweenState2(this).SetEase(t)}get instance(){const e=GetTweenState2(this).GetInstance();return e?e.GetInterfaceClass():null}get isDestroyOnComplete(){return GetTweenState2(this).GetDestroyInstanceOnComplete()}set isDestroyOnComplete(e){GetTweenState2(this).SetDestroyInstanceOnComplete(!!e)}get value(){const e=GetTweenState2(this);if("value"!==e.GetId())throw new Error("not a value tween");return e.GetPropertyTrack("value").GetSourceAdapterValue()}}}{const C33=self.C3,C3X=self.C3X;self.ISDKPluginBase=class extends self.IPlugin{constructor(){super()}}}{const C33=self.C3,C3X=self.C3X,internalApiToken=C33._GetInternalAPIToken();self.ISDKDOMPluginBase=class extends self.ISDKPluginBase{#private;#domComponentId;#nextElementId=0;#instMap=new Map;constructor(e){if(super(),this.#private=C33.AddonManager._GetInitObject2(internalApiToken),!e?.domComponentId)throw new Error("no DOM component ID specified");this.#domComponentId=e.domComponentId,this._addElementMessageHandler("elem-focused",e=>e._onElemFocused()),this._addElementMessageHandler("elem-blurred",e=>{e&&e._onElemBlurred()})}_addElement(e){const t=this.#nextElementId++;return this.#instMap.set(t,e),t}_removeElement(e){this.#instMap.delete(e)}_addElementMessageHandler(e,s){const t=this.#private.GetRuntime();t.AddDOMComponentMessageHandler(this.#domComponentId,e,e=>{const t=this.#instMap.get(e.elementId);s(t,e)})}_addElementMessageHandlers(e){C3X.RequireArray(e);for(const[t,s]of e)this._addElementMessageHandlers(t,s)}}}{const C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKObjectTypeBase=class extends self.IObjectClass{#private;constructor(){super(),this.#private=C33.AddonManager._GetInitObject2(internalApiToken)}_onCreate(){}getImageInfo(){return this.#private.GetImageInfo().GetIImageInfo()}_loadTextures(e){}_releaseTextures(e){}_onDynamicTextureLoadComplete(){}_preloadTexturesWithInstances(e){}}}{const C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKWorldInstanceBase=class extends self.IWorldInstanceSDKBase{#private;#renderercontextlost_handler=null;#renderercontextrestored_handler=null;constructor(e){super(e),this.#private=C33.AddonManager._GetInitObject2(internalApiToken)}_release(){if(super._release(),this.#renderercontextlost_handler){const e=this.#private.GetRuntime().Dispatcher();e.removeEventListener("renderercontextlost",this.#renderercontextlost_handler),e.removeEventListener("renderercontextrestored",this.#renderercontextrestored_handler),this.#renderercontextlost_handler=null,this.#renderercontextrestored_handler=null}}_handleRendererContextLoss(){if(!this.#renderercontextlost_handler){this.#renderercontextlost_handler=()=>this._onRendererContextLost(),this.#renderercontextrestored_handler=()=>this._onRendererContextRestored();const e=this.#private.GetRuntime().Dispatcher();e.addEventListener("renderercontextlost",this.#renderercontextlost_handler),e.addEventListener("renderercontextrestored",this.#renderercontextrestored_handler)}}_onRendererContextLost(){}_onRendererContextRestored(){}_draw(e){}}}{const C33=self.C3,C3X=self.C3X,tempRect=C33.New(C33.Rect),map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKDOMInstanceBase=class extends self.ISDKWorldInstanceBase{#elementId=-1;#isElementShowing=!0;#elemHasFocus=!1;#autoFontSize=!1;#autoFontSizeOffset=-.2;#lastRect=C33.New(C33.Rect,0,0,-1,-1);#lastWindowWidth=0;#lastWindowHeight=0;#lastHTMLIndex=-1;#lastHTMLZIndex=-1;#isPendingUpdateState=!1;constructor(e){if(!e?.domComponentId)throw new Error("no DOM component ID specified");super(e);const t=C33.AddonManager._GetInitObject2(internalApiToken),s=(map.set(this,t),this.#elementId=this.plugin._addElement(this),t.GetRuntime().GetCanvasManager());this.#lastWindowWidth=s.GetLastWidth(),this.#lastWindowHeight=s.GetLastHeight(),this._setTicking(!0)}_release(){super._release(),this.plugin._removeElement(this.#elementId),this._postToDOMElement("destroy"),this.#elementId=-1,map.delete(this)}_getElementInDOMMode(){const e=map.get(this).GetRuntime();if(e.IsInWorker())throw new Error("not valid in worker mode");return this._postToDOMElementMaybeSync("get-element")}_postToDOMElement(e,t){(t=t||{}).elementId=this.#elementId,this._postToDOM(e,t)}_postToDOMElementMaybeSync(e,t){return(t=t||{}).elementId=this.#elementId,this._postToDOMMaybeSync(e,t)}_postToDOMElementAsync(e,t){return(t=t||{}).elementId=this.#elementId,this._postToDOMAsync(e,t)}_createElement(e){e=e||{};const t=map.get(this).GetWorldInfo();e.elementId=this.#elementId,e.isVisible=t.IsVisible(),e.htmlIndex=t.GetLayer().GetHTMLIndex(),e.htmlZIndex=t.GetHTMLZIndex(),Object.assign(e,this._getElementState()),this.#isElementShowing=!!e.isVisible,this._postToDOMMaybeSync("create",e),this._updatePosition(!0)}setElementVisible(e){this.#isElementShowing!==(e=!!e)&&(this.#isElementShowing=e,this._postToDOMElement("set-visible",{isVisible:e}))}_tick(){this._updatePosition(!1)}_shouldPreserveElement(){const e=map.get(this).GetRuntime(),t=e.GetCanvasManager().GetFullscreenMode();return"Android"===C33.Platform.OS&&("scale-inner"===t||"scale-outer"===t||"crop"===t)}_updatePosition(c){const u=map.get(this);if(!u.IsDestroyed()){let e=u.GetWorldInfo(),t=e.GetLayer(),s=e.GetBoundingBox(),[n,i]=t.LayerToCanvasCss(s.getLeft(),s.getTop()),[r,a]=t.LayerToCanvasCss(s.getRight(),s.getBottom()),o=u.GetRuntime().GetCanvasManager(),l=o.GetCssWidth(),h=o.GetCssHeight();if(e.IsVisible()&&t.IsVisible())if(!this._shouldPreserveElement()&&(r<=0||a<=0||l<=n||h<=i))this.setElementVisible(!1);else{tempRect.set(n,i,r,a);const d=o.GetLastWidth(),_=o.GetLastHeight(),p=t.GetHTMLIndex(),m=e.GetHTMLZIndex();if(!c&&tempRect.equals(this.#lastRect)&&this.#lastWindowWidth===d&&this.#lastWindowHeight===_&&this.#lastHTMLIndex===p&&this.#lastHTMLZIndex===m)this.setElementVisible(!0);else{this.#lastRect.copy(tempRect),this.#lastWindowWidth=d,this.#lastWindowHeight=_,this.#lastHTMLIndex=p,this.#lastHTMLZIndex=m,this.setElementVisible(!0);let e=null;this.#autoFontSize&&(e=t.GetDisplayScale()+this.#autoFontSizeOffset),this._postToDOMElement("update-position",{left:Math.round(this.#lastRect.getLeft()),top:Math.round(this.#lastRect.getTop()),width:Math.round(this.#lastRect.width()),height:Math.round(this.#lastRect.height()),htmlIndex:p,htmlZIndex:m,fontSize:e})}}else this.setElementVisible(!1)}}focusElement(){this._postToDOMElementMaybeSync("focus",{focus:!0})}blurElement(){this._postToDOMElementMaybeSync("focus",{focus:!1})}_onElemFocused(){this.#elemHasFocus=!0}_onElemBlurred(){this.#elemHasFocus=!1}isElementFocused(){return this.#elemHasFocus}setElementCSSStyle(e,t){this.postToDOMElement("set-css-style",{prop:C33.CSSToCamelCase(e),val:t})}setElementAttribute(e,t){this.postToDOMElement("set-attribute",{name:e,val:t})}removeElementAttribute(e){this.postToDOMElement("remove-attribute",{name:e})}_updateElementState(){this.#isPendingUpdateState||(this.#isPendingUpdateState=!0,Promise.resolve().then(()=>{this.#isPendingUpdateState=!1,this._postToDOMElement("update-state",this._getElementState())}))}_getElementState(){}_getElementId(){return this.#elementId}}}{const C33=self.C3,C3X=self.C3X;self.ISDKBehaviorBase=class extends self.IBehavior{constructor(){super()}}}{const C33=self.C3,C3X=self.C3X;self.ISDKBehaviorTypeBase=class extends globalThis.IBehaviorType{constructor(){super()}_onCreate(){}}}{const C33=self.C3,C3X=self.C3X,map=new WeakMap,internalApiToken=C33._GetInternalAPIToken();self.ISDKBehaviorInstanceBase=class extends self.IBehaviorInstance{#isTicking=!1;#isTicking2=!1;#isPostTicking=!1;constructor(){super(),map.set(this,C33.AddonManager._GetInitObject2(internalApiToken))}_release(){super._release(),this._setTicking(!1),this._setTicking2(!1),this._setPostTicking(!1),map.delete(this)}_getInitProperties(){return C33.AddonManager._GetInitProperties()}_postCreate(){}_trigger(e){const t=map.get(this);t.GetRuntime().Trigger(e,t.GetObjectInstance(),t.GetBehaviorType())}_triggerAsync(e){const t=map.get(this);return t.GetRuntime().TriggerAsync(e,t.GetObjectInstance(),t.GetBehaviorType())}_setTicking(e){if(this.#isTicking!==(e=!!e)){this.#isTicking=e;const t=map.get(this).GetRuntime();e?t._AddBehInstToTick(this):t._RemoveBehInstToTick(this)}}_isTicking(){return this.#isTicking}_tick(){}_setTicking2(e){if(this.#isTicking2!==(e=!!e)){this.#isTicking2=e;const t=map.get(this).GetRuntime();e?t._AddBehInstToTick2(this):t._RemoveBehInstToTick2(this)}}_isTicking2(){return this.#isTicking2}_tick2(){}_setPostTicking(e){if(this.#isPostTicking!==(e=!!e)){this.#isPostTicking=e;const t=map.get(this).GetRuntime();e?t._AddBehInstToPostTick(this):t._RemoveBehInstToPostTick(this)}}_isPostTicking(){return this.#isPostTicking}_postTick(){}_getDebuggerProperties(){return[]}_saveToJson(){return null}_loadFromJson(e){}}}{let C33=self.C3,C3X=self.C3X,runtime=null;self.ISDKUtils=class{constructor(e){runtime=e}addLoadPromise(e){runtime.AddLoadPromise(e)}sendWrapperExtensionMessage(e,t,s){C3X.RequireString(e),C3X.RequireString(t),C3X.RequireOptionalArray(s),runtime.SendWrapperExtensionMessage(e,t,s)}sendWrapperExtensionMessageAsync(e,t,s){return C3X.RequireString(e),C3X.RequireString(t),C3X.RequireOptionalArray(s),runtime.SendWrapperExtensionMessageAsync(e,t,s)}createLoopingConditionContext(e){return C3X.RequireOptionalString(e),new self.ILoopingConditionContext(runtime,e)}set isAutoSuspendEnabled(e){runtime._SetAutoSuspendEnabled(!!e)}get isAutoSuspendEnabled(){return runtime._IsAutoSuspendEnabled()}setSuspended(e){runtime.SetSuspended(!!e)}getObjectClassBySid(e){C3X.RequireNumber(e);const t=runtime.GetObjectClassBySID(e);return t?t.GetIObjectClass():null}}}{const C33=self.C3,C3X=self.C3X;self.ILoopingConditionContext=class{#runtime;#currentEvent;#solModifiers;#oldFrame;#newFrame;#loop;constructor(e,t){const s=(this.#runtime=e).GetEventSheetManager(),n=e.GetCurrentEvent(),i=(this.#currentEvent=n,this.#solModifiers=n.GetSolModifiers(),e.GetEventStack()),r=(this.#oldFrame=i.GetCurrentStackFrame(),this.#newFrame=i.Push(n),s.GetLoopStack()),a=r.Push();this.#loop=a,t&&a.SetName(t),e.SetDebuggingEnabled(!1)}retrigger(){const e=this.#runtime.GetEventSheetManager(),t=this.#solModifiers,s=this.#loop;e.PushCopySol(t),this.#currentEvent.Retrigger(this.#oldFrame,this.#newFrame),e.PopSol(t),s.SetIndex(s.GetIndex()+1)}get isStopped(){return this.#loop.IsStopped()}release(){const e=this.#runtime,t=e.GetEventStack(),s=e.GetEventSheetManager().GetLoopStack();e.SetDebuggingEnabled(!0),s.Pop(),t.Pop()}}}{let C33=self.C3,C3X=self.C3X,renderer=null,runtime=null;self.IRenderer=class{constructor(e,t){runtime=e,renderer=t}setAlphaBlendMode(){renderer.SetAlphaBlend()}setBlendMode(e){renderer.SetNamedBlendMode(e)}setColorFillMode(){renderer.SetColorFillMode()}setTextureFillMode(){renderer.SetTextureFillMode()}setSmoothLineFillMode(){renderer.SetSmoothLineFillMode()}setColor(e){renderer.SetColorRgba(e[0],e[1],e[2],e[3])}setColorRgba(e,t,s,n){renderer.SetColorRgba(e,t,s,n)}resetColor(){renderer.ResetColor()}setOpacity(e){renderer.SetOpacity(e)}setCurrentZ(e){renderer.SetCurrentZ(e)}getCurrentZ(){renderer.GetCurrentZ()}rect(e){renderer.Rect2(e.left,e.top,e.right,e.bottom)}rect2(e,t,s,n){renderer.Rect2(e,t,s,n)}quad(e){renderer.Quad(C33.Quad.fromDOMQuad(e))}quad2(e,t,s,n,i,r,a,o){renderer.Quad2(e,t,s,n,i,r,a,o)}quad3(e,t){renderer.Quad3(C33.Quad.fromDOMQuad(e),C33.Rect.fromDOMRect(t))}quad4(e,t){renderer.Quad4(C33.Quad.fromDOMQuad(e),C33.Quad.fromDOMQuad(t))}quad3D(e,t,s,n,i,r,a,o,l,h,c,u,d){renderer.Quad3D(e,t,s,n,i,r,a,o,l,h,c,u,C33.Rect.fromDOMRect(d))}quad3D2(e,t,s,n,i,r,a,o,l,h,c,u,d){renderer.Quad3D2(e,t,s,n,i,r,a,o,l,h,c,u,C33.Quad.fromDOMQuad(d))}drawMesh(e,t,s){renderer.DrawMesh(e,t,s)}convexPoly(e){renderer.ConvexPoly(e)}line(e,t,s,n){renderer.Line(e,t,s,n)}texturedLine(e,t,s,n,i,r){renderer.TexturedLine(e,t,s,n,i,r)}lineRect(e,t,s,n){renderer.LineRect(e,t,s,n)}lineRect2(e){renderer.LineRect2(C33.Rect.fromDOMRect(e))}lineQuad(e){renderer.LineQuad(C33.Quad.fromDOMQuad(e))}pushLineWidth(e){renderer.PushLineWidth(e)}popLineWidth(){renderer.PopLineWidth()}pushLineCap(e){renderer.PushLineCap(e)}popLineCap(){renderer.PopLineCap()}setTexture(e){C3X.RequireOptionalInstanceOf(e,self.ITexture);const t=e?runtime._UnwrapScriptInterface(e):null;renderer.SetTexture(t)}loadTextureForImageInfo(e,t){const s=self.IImageInfo._Unwrap(e);if(s)return s.LoadStaticTexture(renderer,{wrapX:t?.wrapX??"clamp-to-edge",wrapY:t?.wrapY??"clamp-to-edge",sampling:t?.sampling??"trilinear",mipMap:t?.mipMap??!0});throw new Error("invalid IImageInfo")}releaseTextureForImageInfo(e){const t=self.IImageInfo._Unwrap(e);if(!t)throw new Error("invalid IImageInfo");t.ReleaseTexture()}getTextureForImageInfo(e){const t=self.IImageInfo._Unwrap(e);if(!t)throw new Error("invalid IImageInfo");const s=t.GetTexture();return self.ITexture.GetInterface(runtime,s)}createDynamicTexture(e,t,s){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t);const n=renderer.CreateDynamicTexture(e,t,{wrapX:s?.wrapX??"clamp-to-edge",wrapY:s?.wrapY??"clamp-to-edge",sampling:s?.sampling??"trilinear",mipMap:s?.mipMap??!0});return self.ITexture.GetInterface(runtime,n)}updateTexture(e,t,s){C3X.RequireInstanceOf(t,self.ITexture);const n=runtime._UnwrapScriptInterface(t);renderer.UpdateTexture(e,n,{premultiplyAlpha:s?.premultiplyAlpha??!0})}deleteTexture(e){C3X.RequireInstanceOf(e,self.ITexture);const t=runtime._UnwrapScriptInterface(e);renderer.DeleteTexture(t)}createRendererText(){const e=renderer.CreateRendererText();return new self.IRendererText(runtime,e)}setDeviceTransform(){runtime.GetCanvasManager().SetDeviceTransform(renderer)}setLayerTransform(e){C3X.RequireInstanceOf(e,globalThis.ILayer);const t=runtime._UnwrapScriptInterface(e);t._SetTransform(renderer)}}}{const C33=self.C3,C3X=self.C3X,map=new WeakMap,reverseMap=new WeakMap;self.ITexture=class{constructor(e,t){map.set(this,{runtime:e,texture:t}),reverseMap.set(t,this),e._MapScriptInterface(this,t),Object.defineProperties(this,{width:{value:t.GetWidth(),writable:!1},height:{value:t.GetHeight(),writable:!1}})}static GetInterface(e,t){if(!t)return null;const s=reverseMap.get(t);return s||new self.ITexture(e,t)}}}{let getActual2=function(e){return map.get(e).rendererText};getActual=getActual2;const C33=self.C3,C3X=self.C3X,map=new WeakMap;self.IRendererText=class{constructor(e,t){map.set(this,{runtime:e,rendererText:t}),e._MapScriptInterface(this,t)}release(){getActual2(this).Release()}set fontFace(e){C3X.RequireString(e),getActual2(this).SetFontName(e)}get fontFace(){return getActual2(this).GetFontName()}set sizePt(e){C3X.RequireFiniteNumber(e),getActual2(this).SetFontSize(e)}get sizePt(){return getActual2(this).GetFontSize()}set lineHeight(e){C3X.RequireFiniteNumber(e),getActual2(this).SetLineHeight(e)}get lineHeight(){return getActual2(this).GetLineHeight()}set isBold(e){getActual2(this).SetBold(e)}get isBold(){return getActual2(this).IsBold()}set isItalic(e){getActual2(this).SetItalic(e)}get isItalic(){return getActual2(this).IsItalic()}setColor(e){C3X.RequireArray(e),this.setColorRgb(e[0],e[1],e[2])}setColorRgb(e,t,s){getActual2(this).SetColorRgb(e,t,s)}setCssColor(e){C3X.RequireString(e),getActual2(this).SetColor(e)}set horizontalAlign(e){getActual2(this).SetHorizontalAlignment(e)}get horizontalAlign(){return getActual2(this).GetHorizontalAlignment()}set verticalAlign(e){getActual2(this).SetVerticalAlignment(e)}get verticalAlign(){return getActual2(this).GetVerticalAlignment()}set wordWrapMode(e){getActual2(this).SetWordWrapMode(e)}get wordWrapMode(){return getActual2(this).GetWordWrapMode()}set textDirection(e){getActual2(this).SetTextDirection(e)}get textDirection(){return getActual2(this).GetTextDirection()}set text(e){C3X.RequireString(e),getActual2(this).SetText(e)}get text(){return getActual2(this).GetText()}setSize(e,t,s){C3X.RequireFiniteNumber(e),C3X.RequireFiniteNumber(t),C3X.RequireFiniteNumber(s),getActual2(this).SetSize(e,t,s)}getTexture(){const{runtime:e,rendererText:t}=map.get(this),s=t.GetTexture();return self.ITexture.GetInterface(e,s)}getTexRect(){return getActual2(this).GetTexRect().toDOMRect()}setTextureUpdateCallback(e){C3X.RequireFunction(e),getActual2(this).ontextureupdate=e}releaseTexture(){getActual2(this).ReleaseTexture()}get textWidth(){return getActual2(this).GetTextWidth()}get textHeight(){return getActual2(this).GetTextHeight()}}}{let GetTypeFromFileExtension2=function(e){if(!e)return"";const t=e.split(".");if(t.length<2)return"";const s=t.at(-1).toLowerCase();return EXT_TO_TYPE.get(s)||""},AddScript2=function(n){return new Promise((e,t)=>{const s=document.createElement("script");s.onload=e,s.onerror=t,s.async=!1,s.type="module",s.src=n,document.head.appendChild(s)})};GetTypeFromFileExtension=GetTypeFromFileExtension2,AddScript=AddScript2;const C33=self.C3,VALID_LOAD_POLICIES=new Set(["local","remote"]),EXT_TO_TYPE=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);C33.AssetManager=class extends C33.DefendedBase{constructor(e,t){super();const s=t.exportType,n=(this._runtime=e,this._fileStructure="folders",this._cordovaBlobUrlCache=new Map,this._isCordova="cordova"===s,this._isiOSCordova=!!t.isiOSCordova,this._isFileProtocol=!!t.isFileProtocol,this._swClientId=t.swClientId,this._supportedAudioFormats=t.supportedAudioFormats||{},this._audioFiles=new Map,this._preloadSounds=!1,this._scriptSubfolder=t.scriptFolder,this._mediaSubfolder="",this._fontsSubfolder="",this._iconsSubfolder="",this._fileMap=t.fileMap||new Map,this._fileMapBlobUrls=new Map,"html5"===s||"scirra-arcade"===s||"instant-games"===s);this._defaultLoadPolicy=n?"remote":"local",this._assetsByUrl=new Map,this._webFonts=[],this._loadPromises=[],this._hasFinishedInitialLoad=!1,this._totalAssetSizeToLoad=0,this._assetSizeLoaded=0,this._lastLoadProgress=0,this._hasHadErrorLoading=!1,this._loadingRateLimiter=C33.New(C33.RateLimiter,()=>this._FireLoadingProgressEvent(),50),this._localPromiseThrottle=C33.New(C33.PromiseThrottle,Math.max(C33.hardwareConcurrency,8)),this._remotePromiseThrottle=C33.New(C33.PromiseThrottle,20),this._iAssetManager=new self.IAssetManager(this)}Release(){for(const e of this._assetsByUrl.values())e.Release();this._assetsByUrl.clear(),C33.clearArray(this._loadPromises),this._runtime=null}GetRuntime(){return this._runtime}_SetFileStructure(e){this._fileStructure=e}GetFileStructure(){return this._fileStructure}GetScriptSubfolder(){return this._scriptSubfolder}_SetMediaSubfolder(e){this._mediaSubfolder=e}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(e){this._fontsSubfolder=e}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(e){this._iconsSubfolder=e}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}FetchBlob(e,t){return t=t||this._defaultLoadPolicy,C33.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlob(e):"playable-ad-single-file"===this._runtime.GetExportType()?self.c3_runtimeInterface._PlayableAdFetchBlob(e):("local"===t?this._localPromiseThrottle:this._remotePromiseThrottle).Add(()=>C33.FetchBlob(e))):C33.FetchBlob(e)}FetchArrayBuffer(e){return C33.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsArrayBuffer(e):"playable-ad-single-file"===this._runtime.GetExportType()?C33.BlobToArrayBuffer(self.c3_runtimeInterface._PlayableAdFetchBlob(e)):("local"===this._defaultLoadPolicy?this._localPromiseThrottle:this._remotePromiseThrottle).Add(()=>C33.FetchArrayBuffer(e))):C33.FetchArrayBuffer(e)}FetchText(e){return C33.IsRelativeURL(e)?("flat"===this._fileStructure&&(e=e.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsText(e):"playable-ad-single-file"===this._runtime.GetExportType()?C33.BlobToString(self.c3_runtimeInterface._PlayableAdFetchBlob(e)):("local"===this._defaultLoadPolicy?this._localPromiseThrottle:this._remotePromiseThrottle).Add(()=>C33.FetchText(e))):C33.FetchText(e)}async FetchJson(e){const t=await this.FetchText(e);return JSON.parse(t)}_CordovaFetchLocalFileAs(e,t){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{filename:e,as:t})}CordovaFetchLocalFileAsText(e){return this._CordovaFetchLocalFileAs(e,"text")}async CordovaFetchLocalFileAsBlob(e){const t=await this._CordovaFetchLocalFileAs(e,"buffer"),s=GetTypeFromFileExtension2(e);return new Blob([t],{type:s})}async CordovaFetchLocalFileAsBlobURL(e){"flat"===this._fileStructure&&(e=e.toLowerCase());let t=this._cordovaBlobUrlCache.get(e);if(!t){const s=await this.CordovaFetchLocalFileAsBlob(e);t=URL.createObjectURL(s),this._cordovaBlobUrlCache.set(e,t)}return t}CordovaFetchLocalFileAsArrayBuffer(e){return this._CordovaFetchLocalFileAs(e,"buffer")}GetMediaFileUrl(e){"flat"===this._fileStructure&&(e=e.toLowerCase());let t=this._mediaSubfolder+e;return"Gecko"===C33.Platform.BrowserEngine&&"preview"===this._runtime.GetExportType()?this._GetLocalBlobURLFromFileMap(t):t}GetProjectFileUrl(e){return C33.IsAbsoluteURL(e)?Promise.resolve(e):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(e):"playable-ad-single-file"===this._runtime.GetExportType()?URL.createObjectURL(self.c3_runtimeInterface._PlayableAdFetchBlob(e)):("flat"===this._fileStructure&&(e=e.toLowerCase()),Promise.resolve(e))}GetProjectFileIframeUrl(t){if(C33.IsAbsoluteURL(t)||"preview"!==this._runtime.GetExportType()||!this._swClientId||!t)return t;try{const e=new URL(t,location.href);return e.searchParams.set("__c3_client_id",this._swClientId),e.toString()}catch(e){return console.warn("Invalid iframe URL: "+t),t}}LoadProjectFileUrl(e){return this.GetProjectFileUrl(e)}LoadImage(e){if(e.loadPolicy&&!VALID_LOAD_POLICIES.has(e.loadPolicy))throw new Error("invalid load policy");let t=this._assetsByUrl.get(e.url);return t||(t=C33.New(C33.ImageAsset,this,{url:e.url,size:e.size||0,loadPolicy:e.loadPolicy||this._defaultLoadPolicy}),this._assetsByUrl.set(t.GetURL(),t),this._hasFinishedInitialLoad)||(this._totalAssetSizeToLoad+=t.GetSize(),this._loadPromises.push(t.Load().then(()=>this._AddLoadedSize(t.GetSize())))),t}_ReleaseAsset(e){this._assetsByUrl.delete(e.GetURL())}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises),this._lastLoadProgress=1}catch(e){console.error("Error loading: ",e),this._hasHadErrorLoading=!0,this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=!0}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(e){this._assetSizeLoaded+=e,this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){const e=C33.New(C33.Event,"loadingprogress");this._lastLoadProgress=C33.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1),e.progress=this._lastLoadProgress,this._runtime.Dispatcher().dispatchEvent(e)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(e){C33.shallowAssignArray(this._webFonts,e),this._webFonts.length&&this._loadPromises.push(this._LoadWebFonts())}async _LoadWebFonts(){const e=[],t=[];for(const[s,n,i]of this._webFonts)this._totalAssetSizeToLoad+=i,e.push(this._LoadWebFont(s,n,t).then(()=>this._AddLoadedSize(i)));await Promise.all(e),this._runtime.IsInWorker()&&0<t.length&&await this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{webfonts:t})}async _LoadWebFont(t,s,n){try{let e=await this.GetProjectFileUrl(s);"Gecko"===C33.Platform.BrowserEngine&&(t=`'${t}'`),("Gecko"===C33.Platform.BrowserEngine&&"preview"===this._runtime.GetExportType()||"playable-ad-single-file"===this._runtime.GetExportType())&&(e=this._GetLocalBlobURLFromFileMap(e));const i=new FontFace(t,`url('${e}')`);(this._runtime.IsInWorker()?self:document).fonts.add(i),await i.load(),this._runtime.IsInWorker()&&n.push({name:t,url:e})}catch(e){console.warn(`[C3 runtime] Failed to load web font '${t}': `,e)}}IsAudioFormatSupported(e){return!!this._supportedAudioFormats[e]}_SetAudioFiles(e,t){this._preloadSounds=!!t;for(const[s,n,i]of e)this._audioFiles.set(s,{fileName:s,formats:n.map(e=>({type:e[0],fileExtension:e[1],fullName:s+e[1],fileSize:e[2]})),isMusic:i})}GetPreferredAudioFile(e){"flat"===this._fileStructure&&(e=e.toLowerCase());const t=this._audioFiles.get(e);if(!t)return null;let s=null;for(const n of t.formats)if(s||"audio/webm; codecs=opus"!==n.type||(s=n),this.IsAudioFormatSupported(n.type))return n;return s}GetProjectAudioFileUrl(e){const t=this.GetPreferredAudioFile(e);return t?{url:this.GetMediaFileUrl(t.fullName),type:t.type}:null}GetAudioToPreload(){if(this._preloadSounds){const e=[];for(const t of this._audioFiles.values())if(!t.isMusic){const s=this.GetPreferredAudioFile(t.fileName);s&&e.push({originalUrl:t.fileName,url:this.GetMediaFileUrl(s.fullName),type:s.type,fileSize:s.fileSize})}return e}return[]}_GetLocalBlobFromFileMap(e){return"preview"===this._runtime.GetExportType()&&(e=new URL(e,location.href).toString()),this._fileMap.get(e)||null}_GetLocalBlobURLFromFileMap(e){let t=this._fileMapBlobUrls.get(e);if(!t){const s=this._GetLocalBlobFromFileMap(e);if(!s)return e;t=URL.createObjectURL(s),this._fileMapBlobUrls.set(e,t)}return t}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...e){const t=await Promise.all(e.map(e=>this.GetProjectFileUrl(e)));if(this._runtime.IsInWorker())if(1===e.length){const s=e[0];await import((C33.IsRelativeURL(s)?"./":"")+s)}else{const n=e.map(e=>`import "${C33.IsRelativeURL(e)?"./":""}${e}";`).join("\n"),i=URL.createObjectURL(new Blob([n],{type:"application/javascript"}));await import(i)}else await Promise.all(t.map(e=>AddScript2(e)))}async CompileWebAssembly(e){if(WebAssembly.compileStreaming){const t=await this.GetProjectFileUrl(e);return WebAssembly.compileStreaming(fetch(t))}{const s=await C33.FetchArrayBuffer(e);return WebAssembly.compile(s)}}async LoadStyleSheet(e){const t=await this.GetProjectFileUrl(e);return this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{url:t})}}}{const C33=self.C3;C33.Asset=class extends C33.DefendedBase{constructor(e,t){super(),this._assetManager=e,this._runtime=e.GetRuntime(),this._url=t.url||"",this._size=t.size,this._loadPolicy=t.loadPolicy,this._blob=t.blob||null,this._isLoaded=!!this._blob,this._loadPromise=null}Release(){this._loadPromise=null,this._assetManager=null,this._runtime=null,this._blob=null}GetURL(){return this._url}GetSize(){return this._size}Load(){return"local"===this._loadPolicy||this._blob?(this._isLoaded=!0,Promise.resolve()):(this._loadPromise||(this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then(e=>(this._isLoaded=!0,this._loadPromise=null,this._blob=e)).catch(e=>{console.error("Error loading resource: ",e),this._loadPromise=null})),this._loadPromise)}IsLoaded(){return this._isLoaded}GetBlob(){return this._blob?Promise.resolve(this._blob):this._loadPromise||this._assetManager.FetchBlob(this._url,this._loadPolicy)}}}{const C33=self.C3,promiseThrottle=new C33.PromiseThrottle,allImageAssets=new Set;C33.ImageAsset=class extends C33.Asset{constructor(e,t){super(e,t),this._texturePromise=null,this._webglTexture=null,this._refCount=0,this._imageWidth=-1,this._imageHeight=-1,allImageAssets.add(this)}Release(){if(0!==this._refCount)throw new Error("released image asset which still has texture references");this._assetManager._ReleaseAsset(this),this._texturePromise=null,allImageAssets.delete(this),super.Release()}static OnRendererContextLost(){for(const e of allImageAssets)e._texturePromise=null,e._webglTexture=null,e._refCount=0}LoadStaticTexture(e,t){return t=t||{},this._refCount++,this._webglTexture?Promise.resolve(this._webglTexture):(this._texturePromise||(t.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy(),this._texturePromise=this._DoLoadStaticTexture(e,t)),this._texturePromise)}async _DoLoadStaticTexture(t,s){try{const n=await this.GetBlob();return 0===this._refCount?this._texturePromise=null:await promiseThrottle.Add(async()=>{const e=await t.CreateStaticTextureAsync(n,s);return this._texturePromise=null,0===this._refCount?(t.DeleteTexture(e),null):(this._webglTexture=e,this._imageWidth=e.GetWidth(),this._imageHeight=e.GetHeight(),this._webglTexture)})}catch(e){throw console.error("Failed to load texture: ",e),e}}ReleaseTexture(){if(this._refCount<=0)throw new Error("texture released too many times");if(this._refCount--,0===this._refCount&&this._webglTexture){const e=this._webglTexture.GetRenderer();e.DeleteTexture(this._webglTexture),this._webglTexture=null}}GetRefCount(){return this._refCount}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){const e=await this.GetBlob();return C33.Supports.ImageBitmap?createImageBitmap(e):C33.BlobToImage(e)}}}{let SortByInstLastCachedZIndex2=function(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()};SortByInstLastCachedZIndex=SortByInstLastCachedZIndex2;const C33=self.C3,assert=self.assert;C33.RenderCell=class extends C33.DefendedBase{constructor(e,t,s){super(),this._grid=e,this._x=t,this._y=s,this._instances=[],this._isSorted=!0,this._pendingRemoval=new Set,this._isAnyPendingRemoval=!1}Release(){C33.clearArray(this._instances),this._pendingRemoval.clear(),this._grid=null}Reset(){C33.clearArray(this._instances),this._isSorted=!0,this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1}SetChanged(){this._isSorted=!1}IsEmpty(){if(this._instances.length){if(this._instances.length>this._pendingRemoval.size)return!1;this._FlushPending()}return!0}Insert(e){this._pendingRemoval.has(e)?(this._pendingRemoval.delete(e),0===this._pendingRemoval.size&&(this._isAnyPendingRemoval=!1)):(this._instances.push(e),this._isSorted=1===this._instances.length)}Remove(e){this._pendingRemoval.add(e),this._isAnyPendingRemoval=!0,50<=this._pendingRemoval.size&&this._FlushPending()}_FlushPending(){this._isAnyPendingRemoval&&(this._instances.length===this._pendingRemoval.size?this.Reset():(C33.arrayRemoveAllInSet(this._instances,this._pendingRemoval),this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1))}_EnsureSorted(){this._isSorted||(this._instances.sort(SortByInstLastCachedZIndex2),this._isSorted=!0)}Dump(e){this._FlushPending(),this._EnsureSorted(),this._instances.length&&e.push(this._instances)}}}{const C33=self.C3;C33.RenderGrid=class extends C33.DefendedBase{constructor(e,t){super(),this._cellWidth=e,this._cellHeight=t,this._cells=C33.New(C33.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(e,t,s){let n=this._cells.Get(e,t);return n||(s?(n=C33.New(C33.RenderCell,this,e,t),this._cells.Set(e,t,n),n):null)}XToCell(e){return Math.floor(e/this._cellWidth)}YToCell(e){return Math.floor(e/this._cellHeight)}Update(n,i,r){if(i)for(let s=i.getLeft(),e=i.getRight();s<=e;++s)for(let e=i.getTop(),t=i.getBottom();e<=t;++e)if(!r||!r.containsPoint(s,e)){const a=this.GetCell(s,e,!1);a&&(a.Remove(n),a.IsEmpty())&&this._cells.Delete(s,e)}if(r)for(let s=r.getLeft(),e=r.getRight();s<=e;++s)for(let e=r.getTop(),t=r.getBottom();e<=t;++e)i&&i.containsPoint(s,e)||this.GetCell(s,e,!0).Insert(n)}QueryRange(e,t){let s=this.XToCell(e.getLeft()),n=this.YToCell(e.getTop()),i=this.XToCell(e.getRight()),r=this.YToCell(e.getBottom());for(;s<=i;++s)for(let e=n;e<=r;++e){const a=this.GetCell(s,e,!1);a&&a.Dump(t)}}MarkRangeChanged(e){let t=e.getLeft(),s=e.getTop(),n=e.getRight(),i=e.getBottom();for(;t<=n;++t)for(let e=s;e<=i;++e){const r=this.GetCell(t,e,!1);r&&r.SetChanged()}}}}{let SortByInstLastCachedZIndex2=function(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()},SortByInstZElevation2=function(e,t){return e.GetWorldInfo().GetZElevation()-t.GetWorldInfo().GetZElevation()};SortByInstLastCachedZIndex=SortByInstLastCachedZIndex2,SortByInstZElevation=SortByInstZElevation2;const C33=self.C3,assert=self.assert,tmpRect=new C33.Rect,tmpQuad=new C33.Quad,renderCellArr=[],tmpDestRect=new C33.Rect,tmpSrcRect=new C33.Rect,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,mat42=glMatrix.mat4,tempMat4=mat42.create(),tempVec3=vec32.create(),tempVec4=vec42.create(),camVector=vec32.create(),lookVector=vec32.create(),upVector=vec32.create(),tempVec2=C33.New(C33.Vector2),tempRect=C33.New(C33.Rect),tempInstanceList1=[],tempInstanceList2=[],tempInstancesByCameraDist=[],DEFAULT_LAYER_OPTIONS={name:"",sid:-1,isDynamic:!1,isVisible:!0,isInteractive:!0,isHTMLElementsLayer:!1,backgroundColor:[1,1,1,1],isTransparent:!0,parallax:[1,1],opacity:1,isForceOwnTexture:!1,renderAs3d:!1,useCameraDistanceDrawOrder:!1,useRenderCells:!1,scaleRate:1,blendMode:0,zElevation:0,initialInstancesData:[],effectListData:[],subLayersData:[]};C33.Layer=class extends C33.DefendedBase{constructor(e,t,s){super(),s=Object.assign({},DEFAULT_LAYER_OPTIONS,s),this._layout=e,this._runtime=e.GetRuntime(),this._parentLayer=t,this._name=s.name,this._index=-1,this._isHTMLElementsLayer=!!s.isHTMLElementsLayer,this._htmlIndex=-1,this._sid=s.sid,this._isDynamic=!!s.isDynamic,this._isVisible=!!s.isVisible,this._isInteractive=!!s.isInteractive,this._backgroundColor=C33.New(C33.Color),this._backgroundColor.setFromJSON(s.backgroundColor),this._isTransparent=!!s.isTransparent,this._parallaxX=s.parallax[0],this._parallaxY=s.parallax[1],this._color=C33.New(C33.Color,1,1,1,s.opacity),this._premultipliedColor=C33.New(C33.Color),this._isForceOwnTexture=!!s.isForceOwnTexture,this._renderAs3d=!!s.renderAs3d,this._useCameraDistanceDrawOrder=!!s.useCameraDistanceDrawOrder,this._useRenderCells=!!s.useRenderCells,this._scaleRate=s.scaleRate,this._blendMode=s.blendMode,this._curRenderTarget=null,this._scale=1,this._zElevation=s.zElevation,this._angle=0,this._scrollX=0,this._scrollY=0,this._hasOwnScrollPosition=!1,this._viewport=C33.New(C33.Rect),this._viewportZ0=C33.New(C33.Rect),this._viewport3D=C33.New(C33.Rect),this._isViewportChanged=!0,this._projectionMatrix=mat42.create(),this._isProjectionMatrixChanged=!0,this._modelViewMatrix=mat42.create(),this._isMVMatrixChanged=!0,this._viewFrustum=C33.New(C33.Gfx.ViewFrustum),this._isViewFrustumChanged=!0,this._startupInitialInstances=[],this._initialInstancesData=s.initialInstancesData,this._initialInstances=[],this._createdGlobalUids=[],this._initialUIDsToInstanceData=new Map,this._instances=[],this._zIndicesUpToDate=!1,this._htmlZIndicesUpToDate=!1,this._anyInstanceZElevated=!1;const i=this._runtime.GetCanvasManager();this._effectList=C33.New(C33.EffectList,this,s.effectListData),this._effectChain=C33.New(C33.Gfx.EffectChain,i.GetEffectChainManager(),{drawContent:(e,t)=>{const s=t.GetContentObject(),n=s.GetRenderTarget();e.SetColor(s.GetPremultipliedColor()),e.DrawRenderTarget(n),e.InvalidateRenderTarget(n),i.ReleaseAdditionalRenderTarget(n)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasDefaultColor=!0,this._renderGrid=null,this._lastRenderList=[],this._isRenderListUpToDate=!1,this._lastRenderCells=C33.New(C33.Rect,0,0,-1,-1),this._curRenderCells=C33.New(C33.Rect,0,0,-1,-1),this._iLayer=new self.ILayer(this),this._UpdatePremultipliedColor(),this.UsesRenderCells()&&(this._renderGrid=C33.New(C33.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight())),this._subLayers=s.subLayersData.map(e=>C33.Layer.CreateFromExportData(this._layout,this,e))}_InitInitialInstances(){for(const e of this._initialInstancesData){const t=this._runtime.GetObjectClassByIndex(e[1]);this._layout._AddInitialObjectClass(t),t.GetDefaultInstanceData()||(t.SetDefaultInstanceData(e),t._SetDefaultLayerIndex(this._index)),this._initialInstances.push(e),this._initialUIDsToInstanceData.set(e[2],e)}C33.shallowAssignArray(this._startupInitialInstances,this._initialInstances),this._initialInstancesData=null}static CreateFromExportData(e,t,s){return C33.New(C33.Layer,e,t,{name:s[0],sid:s[2],isVisible:s[3],isInteractive:s[13],isHTMLElementsLayer:s[19],backgroundColor:s[4].map(e=>e/255),isTransparent:s[5],parallax:[s[6],s[7]],opacity:s[8],isForceOwnTexture:s[9],renderAs3d:s[17],useCameraDistanceDrawOrder:s[18],useRenderCells:s[10],scaleRate:s[11],blendMode:s[12],zElevation:s[16],initialInstancesData:s[14],effectListData:s[15],subLayersData:s[20]})}Release(){for(const e of this._subLayers)e.Release();C33.clearArray(this._subLayers);for(const t of this._instances)this._runtime.DestroyInstance(t);C33.clearArray(this._instances),this._effectList.Release(),this._effectList=null,this._effectChain.Release(),this._effectChain=null,this._iLayer=null,this._parentLayer=null,this._layout=null,this._runtime=null}GetInitialInstanceData(e){return this._initialUIDsToInstanceData.get(e)}CreateInitialInstances(i){let r=this._layout.IsFirstVisit(),a=0,o=this._initialInstances;for(let n=0,e=o.length;n<e;++n){let e=o[n],t=this._runtime.GetObjectClassByIndex(e[1]),s=!0;if(!t.HasPersistBehavior()||r){const l=this._runtime.CreateInstanceFromData(e,this,!0);i.push(l),t.IsGlobal()&&(s=!1,this._createdGlobalUids.push(l.GetUID()))}s&&(o[a]=o[n],++a)}C33.truncateArray(o,a),this._runtime.FlushPendingInstances(),this.SetZIndicesChanged()}_AddInstance(e,t){if(!e.GetPlugin().IsWorldType())throw new Error("instance is not of world type");const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.push(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged(),this.SetZIndicesChanged(e)}_MaybeAddInstance(e){this._instances.includes(e)||(this._instances.push(e),0!==e.GetWorldInfo().GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(e))}_PrependInstance(e,t){const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.unshift(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(e),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged()}_RemoveInstance(e,t){const s=this._instances.indexOf(e);s<0||(t&&this.UsesRenderCells()&&e.GetWorldInfo()._RemoveFromRenderCells(),this._instances.splice(s,1),this.SetZIndicesChanged(e),this._MaybeResetAnyInstanceZElevatedFlag())}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=!0}_MaybeResetAnyInstanceZElevatedFlag(){0===this._instances.length&&(this._anyInstanceZElevated=!1)}_SortInstancesByLastCachedZIndex(e){if(e){const t=new Set;for(const s of this._instances){const n=s.GetWorldInfo()._GetLastCachedZIndex();0<=n&&t.add(n)}let e=-1;for(const i of this._instances){const r=i.GetWorldInfo();if(!(0<=r._GetLastCachedZIndex())){for(++e;t.has(e);)++e;r._SetZIndex(e)}}}this._instances.sort(SortByInstLastCachedZIndex2)}_Start(){}_End(){for(const e of this._instances)e.GetObjectClass().IsGlobal()||this._runtime.DestroyInstance(e);this._runtime.FlushPendingInstances(),C33.clearArray(this._instances),this._anyInstanceZElevated=!1,this.SetZIndicesChanged()}RecreateInitialObjects(t,e,s,n,i,r){const a=this._runtime.GetEventSheetManager(),o=this._runtime.GetAllObjectClasses(),l=t.IsFamily(),h=[];for(const c of this._initialInstances){const u=c[0],d=u[0],_=u[1];if(e.containsPoint(d,_)){const p=o[c[1]];if(p!==t){if(!l)continue;if(!t.FamilyHasMember(p))continue}let e=i;if(!e){const f=this._runtime.GetCurrentLayout();e=this.GetLayout()===f?this:(e=f.GetLayerByName(this.GetName()))||f.GetLayerByIndex(this.GetIndex())}const m=this._runtime.CreateInstanceFromData(c,e,!1,void 0,void 0,!1,r),g=(e.SortAndAddInstancesByZIndex(m),m.GetWorldInfo());g.OffsetXY(s,n),g.SetBboxChanged(),a.BlockFlushingInstances(!0),m._TriggerOnCreatedOnSelfAndRelated(),a.BlockFlushingInstances(!1),h.push(m)}}return h}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}_SetHTMLIndex(e){this._htmlIndex=e}GetHTMLIndex(){return this._htmlIndex}IsHTMLElementsLayer(){return this._isHTMLElementsLayer}SetIsHTMLElementsLayer(e){this._isHTMLElementsLayer!==(e=!!e)&&(this._isHTMLElementsLayer=e,this._layout._ReindexAndUpdateAllLayers(),this._runtime.UpdateRender())}_GetSiblingIndex(){let e=this.GetParentLayer();return(e?e.GetSubLayers():this.GetLayout()._GetRootLayers()).indexOf(this)}GetSID(){return this._sid}GetRuntime(){return this._runtime}IsDynamic(){return this._isDynamic}HasAnyDynamicParentLayer(){for(const e of this.parentLayers())if(e.IsDynamic())return!0;return!1}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e=this.HasDefaultColor();if(this._needsRebuildEffectChainSteps||e!==this._wasDefaultColor||this._effectChain.NeedsRebuild()){const t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map(e=>e.GetShaderProgram()),{indexMap:t.map(e=>e.GetIndex()),forcePreDraw:!e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasDefaultColor=e}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=!1}IsVisible(){for(const e of this.selfAndParentLayers())if(!e._IsVisibleFlagSet())return!1;return!0}_IsVisibleFlagSet(){return this._isVisible}SetVisible(e){this._isVisible!==(e=!!e)&&(this._isVisible=e,this._runtime.UpdateRender())}SetInteractive(e){this._isInteractive=!!e}IsInteractive(){return this._isInteractive}IsSelfAndParentsInteractive(){for(const e of this.selfAndParentLayers())if(!e.IsInteractive())return!1;return!0}SetOwnScrollPositionEnabled(e){if(this._hasOwnScrollPosition!==(e=!!e)){if(this._hasOwnScrollPosition=e){const t=this.GetLayout();this._scrollX=t.GetScrollX(),this._scrollY=t.GetScrollY()}this._SetMVMatrixChanged(),this._runtime.UpdateRender()}}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(e){const t=this.GetLayout(),s=t.GetScrollLeftBound(),n=t.GetScrollRightBound();this._scrollX!==(e=(e=n<e?n:e)<s?s:e)&&(this._scrollX=e,this.IsOwnScrollPositionEnabled())&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender())}SetScrollY(e){const t=this.GetLayout(),s=t.GetScrollTopBound(),n=t.GetScrollBottomBound();this._scrollY!==(e=(e=n<e?n:e)<s?s:e)&&(this._scrollY=e,this.IsOwnScrollPositionEnabled())&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetScrollX(){return this.IsOwnScrollPositionEnabled()?this._scrollX:this.GetLayout().GetScrollX()}GetScrollY(){return this.IsOwnScrollPositionEnabled()?this._scrollY:this.GetLayout().GetScrollY()}GetViewport(){return this._MaybeUpdateViewport(),this._viewport}_GetViewportZ0(){return this._MaybeUpdateViewport(),this._viewportZ0}GetViewport3D(){return this._MaybeUpdateViewport(),this._viewport3D}_GetVanishingPoint(){const e=this.GetLayout();return[e.GetVanishingPointX(),e.GetVanishingPointY()]}GetDefaultCameraZ(e){return this._runtime.GetDefaultCameraZ(e)}GetViewportForZ(u,n){const i=this._GetViewportZ0();if(0===u)n.copy(i);else{let o=i.midX(),l=i.midY(),e=this.Get2DScaleFactorToZ(u),t=i.width()/e,s=i.height()/e,[h,c]=this._GetVanishingPoint();if(.5!==h||.5!==c){let e=this.Get2DCameraZ(),t=this._runtime,s=this.GetDefaultCameraZ()/e,n=(h-.5)*t.GetViewportWidth()/s,i=(c-.5)*t.GetViewportHeight()/s,r=this.GetAngle(),a=(0!==r&&(tempVec2.set(n,i),tempVec2.rotate(r),n=tempVec2.getX(),i=tempVec2.getY()),C33.unlerp(e,0,u));o+=C33.lerp(n,0,a),l+=C33.lerp(i,0,a)}n.set(o-t/2,l-s/2,o+t/2,l+s/2)}}GetOpacity(){return this._color.getA()}SetOpacity(e){e=C33.clamp(e,0,1),this._color.getA()!==e&&(this._color.setA(e),this._UpdatePremultipliedColor(),this._runtime.UpdateRender())}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color),this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(e){this._scaleRate!==e&&(this._scaleRate=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(e,t){this._parallaxX===e&&this._parallaxY===t||(this._parallaxX=e,this._parallaxY=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}SetParallaxX(e){this.SetParallax(e,this.GetParallaxY())}SetParallaxY(e){this.SetParallax(this.GetParallaxX(),e)}SetZElevation(e){this._zElevation!==e&&(this._zElevation=e,this._runtime.UpdateRender())}GetZElevation(){return this._zElevation}SetAngle(e){e=C33.clampAngle(e),this._angle!==e&&(this._angle=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetAngle(){return C33.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return 0<this._instances.length}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){return this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder?(C33.shallowAssignArray(tempInstancesByCameraDist,this._GetInstances()),tempInstancesByCameraDist.sort((e,t)=>this._SortInstancesByCameraDistance(e,t)),tempInstancesByCameraDist):this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(e){C33.appendArray(e,this._GetInstancesInDrawOrder());for(const t of this._subLayers)t.IsVisible()&&0<t.GetOpacity()&&t._AppendAllInstancesIncludingSubLayersInDrawOrder(e)}_SortInstancesByCameraDistance(e,t){const s=this.GetLayout().Get3DCameraPosition(),n=s[0],i=s[1],r=s[2],a=e.GetWorldInfo(),o=t.GetWorldInfo(),l=a.GetX()-n,h=a.GetY()-i,c=a.GetZElevation()-r,u=o.GetX()-n,d=o.GetY()-i,_=o.GetZElevation()-r;return u*u+d*d+_*_-(l*l+h*h+c*c)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(e){this._isTransparent!==(e=!!e)&&(this._isTransparent=e,this._runtime.UpdateRender())}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(e){this._isForceOwnTexture!==(e=!!e)&&(this._isForceOwnTexture=e,this._runtime.UpdateRender())}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return!1;for(const e of this._subLayers)if(!e.SelfAndAllSubLayersHave3DCamera())return!1;return!0}SetBlendMode(e){this._blendMode!==e&&(this._blendMode=e,this._runtime.UpdateRender())}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}_SetParentLayer(e){this._parentLayer=e}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return 0<this._subLayers.length}_AddSubLayer(e,t=!0){t?this._subLayers.push(e):this._subLayers.unshift(e)}_InsertSubLayer(e,t,s){let n=this._subLayers.indexOf(t);if(-1===n)throw new Error("cannot find layer to insert by");s&&++n,this._subLayers.splice(n,0,e)}_RemoveSubLayer(e){const t=this._subLayers.indexOf(e);if(-1===t)throw new Error("cannot find layer to remove");this._subLayers.splice(t,1)}HasAnyVisibleSubLayer(){for(const e of this._subLayers)if(e.ShouldDraw())return!0;return!1}*selfAndAllSubLayers(){for(const e of this._subLayers)yield*e.selfAndAllSubLayers();yield this}*parentLayers(){let e=this.GetParentLayer();for(;e;)yield e,e=e.GetParentLayer()}*selfAndParentLayers(){yield this,yield*this.parentLayers()}HasParentLayer(e){for(const t of this.parentLayers())if(t===e)return!0;return!1}IsTransformCompatibleWith(e){return this===e||this._parallaxX===e._parallaxX&&this._parallaxY===e._parallaxY&&this._scale===e._scale&&this._scaleRate===e._scaleRate&&this._angle===e._angle&&this.GetScrollX()===e.GetScrollX()&&this.GetScrollY()===e.GetScrollY()}SaveTransform(){return{parallaxX:this.GetParallaxX(),parallaxY:this.GetParallaxY(),scale:this.GetOwnScale(),scaleRate:this.GetScaleRate(),angle:this.GetOwnAngle(),hasOwnScroll:this.IsOwnScrollPositionEnabled(),scrollX:this.GetScrollX(),scrollY:this.GetScrollY()}}RestoreTransform(e){this.SetParallax(e.parallaxX,e.parallaxY),this.SetOwnScale(e.scale),this.SetScaleRate(e.scaleRate),this.SetAngle(e.angle),this.SetOwnScrollPositionEnabled(e.hasOwnScroll),this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this._MaybeUpdateViewport()}_RemoveAllInstancesInSet(e){if(0!==e.size){const t=C33.arrayRemoveAllInSet(this._instances,e);0<t&&(this._MaybeResetAnyInstanceZElevatedFlag(),this.SetZIndicesChanged())}}SetZIndicesChanged(e){this._zIndicesUpToDate=!1,this._isRenderListUpToDate=!1,e&&!e.GetObjectClass().GetPlugin().IsHTMLElementType()||(this._htmlZIndicesUpToDate=!1)}_UpdateZIndices(){if(!this._zIndicesUpToDate){if(this._instances.sort(SortByInstZElevation2),this.UsesRenderCells())for(let e=0,t=this._instances.length;e<t;++e){const s=this._instances[e].GetWorldInfo();s._SetZIndex(e),this._renderGrid.MarkRangeChanged(s.GetRenderCellRange())}else for(let e=0,t=this._instances.length;e<t;++e)this._instances[e].GetWorldInfo()._SetZIndex(e);this._zIndicesUpToDate=!0}}_UpdateHTMLZIndices(){if(!this._htmlZIndicesUpToDate){let e=this._layout.GetRootLayersForHTMLLayer(this.GetHTMLIndex()),t=e.map(e=>[...e.selfAndAllSubLayers()]).flat(),s=0;for(const n of t){for(const i of n._GetInstances())i.GetObjectClass().GetPlugin().IsHTMLElementType()&&i.GetWorldInfo()._SetHTMLZIndex(s++);n._SetHTMLZIndicesUpToDate()}}}_SetHTMLZIndicesUpToDate(){this._htmlZIndicesUpToDate=!0}_GetHTMLLayerDOMState(){return{isVisible:this.IsVisible(),opacity:this.GetOpacity(),isInteractive:this.IsInteractive()}}MoveInstanceAdjacent(e,t,s){const n=e.GetWorldInfo(),i=t.GetWorldInfo();if(n.GetLayer()!==this||i.GetLayer()!==this)throw new Error("can't arrange Z order unless both objects on this layer");let r=n.GetZIndex(),a=i.GetZIndex();return r!==a+(s?1:-1)&&(C33.arrayRemove(this._instances,r),r<a&&a--,s&&a++,a===this._instances.length?this._instances.push(e):this._instances.splice(a,0,e),this.SetZIndicesChanged(e),!0)}_MergeSortedZArrays(e,t){let s=[],n=0,i=0,r=e.length,a=t.length;for(;n<r&&i<a;){const o=e[n],l=t[i];o.GetWorldInfo()._GetLastCachedZIndex()<l.GetWorldInfo()._GetLastCachedZIndex()?(s.push(o),++n):(s.push(l),++i)}for(;n<r;++n)s.push(e[n]);for(;i<a;++i)s.push(t[i]);return s}_MergeAllSortedZArrays_pass(t){const s=[],n=t.length;for(let e=0;e<n-1;e+=2){const i=t[e],r=t[e+1];s.push(this._MergeSortedZArrays(i,r))}return n%2==1&&s.push(t[n-1]),s}_MergeAllSortedZArrays(e){for(;1<e.length;)e=this._MergeAllSortedZArrays_pass(e);return e[0]}_GetRenderCellInstancesToDraw(){return this._UpdateZIndices(),C33.clearArray(renderCellArr),this._renderGrid.QueryRange(this.GetViewport(),renderCellArr),renderCellArr.length?1===renderCellArr.length?renderCellArr[0]:this._MergeAllSortedZArrays(renderCellArr):[]}ShouldDraw(){return this.IsVisible()&&0<this.GetOpacity()&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return!0;for(const e of this._subLayers)if(e._DrawsAnyContentInSelfOrSubLayers())return!0;return!1}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||0!==this.GetBlendMode()||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return!0;for(const e of this._subLayers)if(e.SelfOrAnySubLayerUsesOwnTexture())return!0;return!1}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(e){if(this._layout.IsOrthographicProjection())return 1;{const t=this.Get3DCameraZ();return t/(t-e)}}GetResolutionScaleFactorToZ(e){const t=this._runtime.GetRenderScale();if(this._layout.IsOrthographicProjection())return t;{const s=this.Get3DCameraZ(),n=this.GetDefaultCameraZ();return n/Math.abs(s-e)*t}}_SetMVMatrixChanged(){this._isMVMatrixChanged=!0,this._isViewFrustumChanged=!0,this._isViewportChanged=!0}_GetModelViewMatrix(e){return this._isMVMatrixChanged&&(this._CalculateModelViewMatrix(e,this._modelViewMatrix,0,0,null),this._isMVMatrixChanged=!1),this._modelViewMatrix}Get2DCameraZ(e){return this.GetDefaultCameraZ(e)/this.GetNormalScale()}Get3DCameraZ(){return this.Has3DCamera()?this.GetLayout().Get3DCameraPosition()[2]:this.Get2DCameraZ()}GetCameraPosition(){if(this.Has3DCamera()){const e=this.GetLayout().Get3DCameraPosition();return[e[0],e[1],e[2]]}return this._Get2DCameraPosition()}_Get2DCameraPosition(e=0,t=0,i=0){let r=this._runtime,s=this.GetLayout(),n=r.GetParallaxXOrigin(),a=r.GetParallaxYOrigin(),o=(this.GetScrollX()-n)*this._parallaxX+n,l=(this.GetScrollY()-a)*this._parallaxY+a,h=(r.IsPixelRoundingEnabled()&&(o=Math.round(o),l=Math.round(l)),o+e),c=l+t,u=s.IsOrthographicProjection()?this.GetDefaultCameraZ(i):this.Get2DCameraZ(i),[d,_]=this._GetVanishingPoint();if(.5!==d||.5!==_){let e=this.GetDefaultCameraZ(i)/u,t=(d-.5)*r.GetViewportWidth()/e,s=(_-.5)*r.GetViewportHeight()/e,n=this.GetAngle();0!==n&&(tempVec2.set(t,s),tempVec2.rotate(n),t=tempVec2.getX(),s=tempVec2.getY()),h+=t,c+=s}return[h,c,u]}_CalculateModelViewMatrix(e,t,s,n,i){const r=this._runtime,a=this.GetLayout();if(this.Has3DCamera()){vec32.copy(camVector,a.Get3DCameraPosition()),vec32.copy(lookVector,a.Get3DCameraLookAt()),vec32.copy(upVector,a.Get3DCameraUpVector());const o=r.GetParallaxXOrigin(),l=r.GetParallaxYOrigin(),h=lookVector[0]-camVector[0],c=lookVector[1]-camVector[1],u=lookVector[2]-camVector[2];camVector[0]=(camVector[0]-o)*this._parallaxX+o,camVector[1]=(camVector[1]-l)*this._parallaxY+l,camVector[2]*=Math.max(this._parallaxX,this._parallaxY),lookVector[0]=camVector[0]+h,lookVector[1]=camVector[1]+c,lookVector[2]=camVector[2]+u}else{const[d,_,p]=this._Get2DCameraPosition(s,n,i),m=(vec32.set(camVector,d,_,p),vec32.set(lookVector,d,_,p-100),this.GetAngle());0===m?vec32.set(upVector,0,1,0):vec32.set(upVector,Math.sin(m),Math.cos(m),0)}e.CalculateLookAtModelView(t,camVector,lookVector,upVector,i||r.GetViewportHeight())}_SetProjectionMatrixChanged(){this._isProjectionMatrixChanged=!0,this._isViewFrustumChanged=!0,this._isViewportChanged=!0}_GetProjectionMatrix(e){return this._isProjectionMatrixChanged&&(this._CalculateProjectionMatrix(e),this._isProjectionMatrixChanged=!1),this._projectionMatrix}_CalculateProjectionMatrix(e){const t=this._runtime.GetCanvasManager(),[s,n]=this._GetVanishingPoint();if(this._layout.IsOrthographicProjection())e.CalculateOrthographicMatrix(this._projectionMatrix,t.GetDrawWidth(),t.GetDrawHeight());else if(.5===s&&.5===n)mat42.copy(this._projectionMatrix,t.GetDefaultProjectionMatrix());else{const i=t.GetDrawWidth(),r=t.GetDrawHeight();e.CalculatePerspectiveMatrix(this._projectionMatrix,i/r,s,n)}}_SetTransform(e,t=!0,s=0,n=0,i=0){t&&e.SetProjectionMatrix(this._GetProjectionMatrix(e));let r;r=0===s&&0===n&&0===i?this._GetModelViewMatrix(e):(this._CalculateModelViewMatrix(e,tempMat4,s,n,i),tempMat4),e.SetModelViewMatrix(r)}PrepareForDraw(e){this._SetTransform(e),e.SetBaseZ(this.GetZElevation())}_MaybeStartWebGLProfiling(e){let t=null;if(e.IsWebGL()&&this._runtime.IsGPUProfiling()){const s=this._runtime.GetCanvasManager().GetLayerTimingsBuffer(this);s&&(t=s.AddTimeElapsedQuery(),e.StartQuery(t))}return t}_MaybeStartWebGPUProfiling(e){if(e.IsWebGPU()&&this._runtime.IsGPUProfiling()){const t=2*(this.GetIndex()+1);e.StartMeasuringRenderPassTime(t,1+t)}}Draw(e,t,s){let n=this._runtime.GetCanvasManager(),i=this.UsesOwnTexture(),r=null,a=this._MaybeStartWebGLProfiling(e);if(this._MaybeStartWebGPUProfiling(e),i){const o={sampling:this._runtime.GetSampling(),isSampled:!0,canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()};"low"===n.GetCurrentFullscreenScalingQuality()&&(o.width=n.GetDrawWidth(),o.height=n.GetDrawHeight()),r=this._runtime.GetAdditionalRenderTarget(o),this._curRenderTarget=r,e.SetRenderTarget(r),this.IsTransparent()&&e.ClearRgba(0,0,0,0)}else this._curRenderTarget=t,e.SetRenderTarget(t);if(this.IsTransparent()||e.Clear(this._backgroundColor),this._layout._DrawLayerList(e,this._curRenderTarget,this._subLayers,i&&this.IsTransparent()),this._MaybeStartWebGPUProfiling(e),this._SetTransform(e),e.SetBaseZ(this.GetZElevation()),e.SetDepthEnabled(this.RendersIn3DMode()),this.GetNormalScale()>Number.EPSILON){this._UpdateZIndices();const l=this.UsesRenderCells()&&0===this.GetZElevation()&&!this._anyInstanceZElevated;this.Has3DCamera()?this._DrawInstances_3DCamera(e):l?this._DrawInstances_RenderCells(e):this._DrawInstances(e,this._GetInstancesInDrawOrder())}e.SetBaseZ(0),e.SetCurrentZ(0),i&&(e.SetDepthEnabled(!1),this._DrawLayerOwnTextureToRenderTarget(e,r,t,s)),a&&e.EndQuery(a),this._curRenderTarget=null}_DrawInstances(s,n){let i=this.GetViewport(),r=this._curRenderTarget,a=this.GetLayout().IsOrthographicProjection(),o=this.GetLayout().HasVanishingPointOutsideViewport(),l=null;for(let e=0,t=n.length;e<t;++e){const h=n[e];if(h!==l){const c=(l=h).GetWorldInfo();c.IsVisible()&&c.IsInViewport(i,o,a)&&this._DrawInstanceMaybeWithEffects(h,c,s,r)}}}_DrawInstances_3DCamera(n){const i=this._curRenderTarget,r=this._GetViewFrustum(),a=tempInstanceList1,o=tempInstanceList2,l=this._GetInstancesInDrawOrder();for(let t=0,s=l.length;t<s;){const h=l[t],c=h.GetWorldInfo();if(c.IsVisible()&&c.IsInViewport3D(r)){(!h.RendersToOwnZPlane()||0<c.GetDepth())&&o.push(h);const u=h.GetWorldInfo().GetTotalZElevation();a.push(h);let e=t+1;for(;e<s;++e){const d=l[e],_=d.GetWorldInfo();if(_.IsVisible()&&_.IsInViewport3D(r)){if(_.GetTotalZElevation()!==u)break;(d.RendersToOwnZPlane()?(0<_.GetDepth()&&o.push(d),a):o).push(d)}}if(1!==a.length||a[0].MustMitigateZFighting()){this._DrawCoplanarInstances_3DCamera(n,a);for(let e=0,t=o.length;e<t;++e){const p=o[e],m=p.GetWorldInfo();m._SetDrawNonBackFacesOnly(!0),this._DrawInstanceMaybeWithEffects(p,m,n,i),m._SetDrawNonBackFacesOnly(!1)}}else{this._DrawInstanceMaybeWithEffects(h,c,n,i);for(let e=0,t=o.length;e<t;++e){const g=o[e];if(g!==h){const f=g.GetWorldInfo(),S=f.GetLayer();S._DrawInstanceMaybeWithEffects(g,f,n,i)}}}t=e,C33.clearArray(a),C33.clearArray(o)}else++t}}_DrawCoplanarInstances_3DCamera(s,n){const i=this._curRenderTarget;s.CoplanarStartStencilPass();for(let e=0,t=n.length;e<t;++e){const r=n[e],a=r.GetWorldInfo();a._SetDrawBackFaceOnly(!0),this._DrawInstance(r,a,s)}s.CoplanarStartColorPass();for(let e=0,t=n.length;e<t;++e){const o=n[e],l=o.GetWorldInfo();this._DrawInstanceMaybeWithEffects(o,l,s,i),l._SetDrawBackFaceOnly(!1)}s.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(e){let t=this._renderGrid,s=this._curRenderCells,n=this._lastRenderCells,i=this.GetViewport(),r;s.set(t.XToCell(i.getLeft()),t.YToCell(i.getTop()),t.XToCell(i.getRight()),t.YToCell(i.getBottom())),this._isRenderListUpToDate&&s.equals(n)?r=this._lastRenderList:(r=this._GetRenderCellInstancesToDraw(),this._isRenderListUpToDate=!0,n.copy(s)),this._DrawInstances(e,r),r!==this._lastRenderList&&C33.shallowAssignArray(this._lastRenderList,r)}_DrawInstanceMaybeWithEffects(e,t,s,n){t.HasAnyActiveEffect()?this._DrawInstanceWithEffectsAndRestore(e,t,s,n):this._DrawInstance(e,t,s)}_DrawInstance(e,t,s){const n=t.GetRendererStateGroup();s.GetCurrentStateGroup()!==n&&n.Apply(),e.Draw(s)}_DrawInstanceWithEffectsAndRestore(e,t,s,n){this._DrawInstanceWithEffects(e,t,s,n,null)&&this._SetTransform(s)}_DrawInstanceWithEffects(e,t,s,n,i){const r=t.GetInstanceEffectList().GetEffectChain();return r.Render(s,n,{contentObject:e,blendMode:t.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),time:e.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:t.GetBoundingBox(),drawSurfaceRect:r.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(t),drawContentHook:i&&i.drawContentHook,compositOffX:i&&i.compositOffX,compositOffY:i&&i.compositOffY,updateOwnProjection:i&&i.updateOwnProjection}),s.SetBaseZ(this.GetZElevation()),r.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(e,t,s,n){const i=this._effectList.GetActiveEffectTypes(),r=this._runtime;0===i.length?(e.SetRenderTarget(s),e.SetTextureFillMode(),n&&0===this._blendMode&&this.HasDefaultColor()?e.CopyRenderTarget(t):(e.SetBlendMode(this._blendMode),e.SetColor(this._premultipliedColor),e.DrawRenderTarget(t)),e.InvalidateRenderTarget(t),r.ReleaseAdditionalRenderTarget(t)):this.GetEffectChain().Render(e,s,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:r.GetEffectDevicePixelRatioParam(),layerScale:r.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:!0})}GetOwnScale(){return this._scale}SetOwnScale(e){this._scale!==e&&(this._scale=e,this._layout.BoundScrolling(),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*this._layout.GetScale()-1)*this._scaleRate+1}_MaybeUpdateViewport(){if(this._isViewportChanged){this._isViewportChanged=!1;let e=this._runtime.GetParallaxXOrigin(),t=this._runtime.GetParallaxYOrigin(),s=(this.GetScrollX()-e)*this._parallaxX+e,n=(this.GetScrollY()-t)*this._parallaxY+t,i=this.GetNormalScale(),r=this._runtime.GetViewportWidth()/i,a=this._runtime.GetViewportHeight()/i,o=s-r/2,l=n-a/2;this._runtime.IsPixelRoundingEnabled()&&(o=Math.round(o),l=Math.round(l));const h=this._viewportZ0,c=(h.set(o,l,o+r,l+a),this.GetAngle()),u=(0!==c&&(tmpRect.copy(h),tmpRect.offset(-h.midX(),-h.midY()),tmpQuad.setFromRotatedRect(tmpRect,c),tmpQuad.getBoundingBox(tmpRect),tmpRect.offset(h.midX(),h.midY()),h.copy(tmpRect)),this._zElevation);this.GetViewportForZ(u,this._viewport),this.Has3DCamera()?this.CalculateViewport3D(u,this._viewport3D):this._viewport3D.copy(this._viewport)}}CalculateViewport3D(e,t){let s=this._runtime.GetCanvasManager(),n=s.GetCssWidth(),i=s.GetCssHeight(),[r,a]=this.CanvasCssToLayer(0,0,e),[o,l]=this.CanvasCssToLayer(n,0,e),[h,c]=this.CanvasCssToLayer(n,i,e),[u,d]=this.CanvasCssToLayer(0,i,e),_=Math.min(r,o,h,u),p=Math.min(a,l,c,d),m=Math.max(r,o,h,u),g=Math.max(a,l,c,d);isFinite(_)||(_=-1/0),isFinite(p)||(p=-1/0),isFinite(m)||(m=1/0),isFinite(g)||(g=1/0),t.set(_,p,m,g)}CanvasCssToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetDisplayScale())}DrawSurfaceToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_CanvasToLayer(e,t,s,n){const i=this._runtime,r=i.GetRenderer(),a=this.GetNormalScale(),o=i.GetViewportWidth()/a,l=i.GetViewportHeight()/a,h=tempVec4,c=(vec42.set(h,0,0,o,l),e/=n,t=h[3]-t/n,this._GetProjectionMatrix(r)),u=this._GetModelViewMatrix(r),d=tempVec3,_=C33.Gfx.UnprojectScreenToWorldZ(e,t,s,u,c,h,d);return _?[d[0],d[1]]:[NaN,NaN]}CanvasCssToLayer_DefaultTransform(e,t){const s=this._scale,n=this._scaleRate,i=this._parallaxX,r=this._parallaxY,a=this._angle,o=(this._scale=1,this._scaleRate=1,this._parallaxX=1,this._parallaxY=1,this._angle=0,this._SetMVMatrixChanged(),this.CanvasCssToLayer(e,t));return this._scale=s,this._scaleRate=n,this._parallaxX=i,this._parallaxY=r,this._angle=a,this._SetMVMatrixChanged(),o}LayerToCanvasCss(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetDisplayScale())}LayerToDrawSurface(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(e,t,s,n){const i=this._runtime,r=i.GetRenderer(),a=this.GetNormalScale(),o=i.GetViewportWidth()/a,l=i.GetViewportHeight()/a,h=tempVec4,c=(vec42.set(h,0,0,o,l),this._GetProjectionMatrix(r)),u=this._GetModelViewMatrix(r),d=tempVec3,_=C33.Gfx.Project(e,t,s,u,c,h,d);return _?[d[0]*n,(h[3]-d[1])*n]:[NaN,NaN]}_GetLayerToDrawSurfaceScale(e,t){return e*=this.GetRenderScale()*this.GetDevicePixelRatio(),0!==t&&(e*=this.Get2DScaleFactorToZ(t)),e}_InstanceBoxToDrawSurface(e){const t=e.GetBoundingBox(),s=e.GetTotalZElevation(),n=e.GetDepth(),h=s+n,c=t.getLeft(),u=t.getTop(),d=t.getRight(),_=t.getBottom();if(this.Has3DCamera()){if(this._IsPointBehindNearPlane(c,u,s)||this._IsPointBehindNearPlane(d,u,s)||this._IsPointBehindNearPlane(d,_,s)||this._IsPointBehindNearPlane(c,_,s))return null;if(0<n&&(this._IsPointBehindNearPlane(c,u,h)||this._IsPointBehindNearPlane(d,u,h)||this._IsPointBehindNearPlane(d,_,h)||this._IsPointBehindNearPlane(c,_,h)))return null}else if(h>=this.Get2DCameraZ())return null;let[p,m]=this.LayerToDrawSurface(c,u,s),[g,f]=this.LayerToDrawSurface(d,_,s);if(0!==this.GetAngle()||0<n||this.Has3DCamera()){const[S,y]=this.LayerToDrawSurface(d,u,s),[C,G]=this.LayerToDrawSurface(c,_,s);if(0<n){let[e,t]=this.LayerToDrawSurface(c,u,h),[s,n]=this.LayerToDrawSurface(d,u,h),[i,r]=this.LayerToDrawSurface(d,_,h),[a,o]=this.LayerToDrawSurface(c,_,h),l=Math.min(p,g,S,C,e,s,i,a);g=Math.max(p,g,S,C,e,s,i,a),p=l,l=Math.min(m,f,y,G,t,n,r,o),f=Math.max(m,f,y,G,t,n,r,o),m=l}else{let e=Math.min(p,g,S,C);g=Math.max(p,g,S,C),p=e,e=Math.min(m,f,y,G),f=Math.max(m,f,y,G),m=e}}return tmpRect.set(p,m,g,f),tmpRect}_GetViewFrustum(){return this._isViewFrustumChanged&&(this._UpdateViewFrustum(),this._isViewFrustumChanged=!1),this._viewFrustum}_UpdateViewFrustum(){const e=this._runtime.GetRenderer(),t=this._GetProjectionMatrix(e),s=this._GetModelViewMatrix(e);this._viewFrustum.CalculatePlanes(s,t)}_IsPointBehindNearPlane(e,t,s){return this._GetViewFrustum().IsBehindNearPlane(e,t,s)}_SaveToJson(){const e={d:this.IsDynamic(),s:this.GetOwnScale(),a:this.GetOwnAngle(),v:this._IsVisibleFlagSet(),i:this.IsInteractive(),html:this.IsHTMLElementsLayer(),bc:this._backgroundColor.toJSON(),t:this.IsTransparent(),sx:this._scrollX,sy:this._scrollY,hosp:this._hasOwnScrollPosition,px:this.GetParallaxX(),py:this.GetParallaxY(),c:this._color.toJSON(),sr:this.GetScaleRate(),fx:this._effectList.SaveToJson(),cg:this._createdGlobalUids};return e}_LoadFromJson(e){this._isDynamic=!!e.d,this._scale=e.s,this._angle=e.a,this._isVisible=!!e.v,this._isInteractive=!e.hasOwnProperty("i")||e.i,this._isHTMLElementsLayer=!!e.html,this._backgroundColor.setFromJSON(e.bc),this._isTransparent=!!e.t,e.hasOwnProperty("sx")&&(this._scrollX=e.sx),e.hasOwnProperty("sy")&&(this._scrollY=e.sy),e.hasOwnProperty("hosp")&&(this._hasOwnScrollPosition=!!e.hosp),this._parallaxX=e.px,this._parallaxY=e.py,this._color.setFromJSON(e.c),this._UpdatePremultipliedColor(),this._scaleRate=e.sr,C33.shallowAssignArray(this._createdGlobalUids,e.cg),C33.shallowAssignArray(this._initialInstances,this._startupInitialInstances);let s=new Set(this._createdGlobalUids),n=0;for(let e=0,t=this._initialInstances.length;e<t;++e)s.has(this._initialInstances[e][2])||(this._initialInstances[n]=this._initialInstances[e],++n);C33.truncateArray(this._initialInstances,n),this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0}_LoadFromJsonAfterInstances(){this._SortInstancesByLastCachedZIndex(!1),this.SetZIndicesChanged(),this._SetMVMatrixChanged(),this._SetProjectionMatrixChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(e,t=!1){if(this._instances.includes(e))t&&this._instances.sort((e,t)=>{const s=e.GetWorldInfo().GetSceneGraphZIndex(),n=t.GetWorldInfo().GetSceneGraphZIndex();return s-n});else if(e.HasChildren()){const s=[...e.allChildren()];s.push(e),s.sort((e,t)=>{const s=e.GetWorldInfo().GetSceneGraphZIndex(),n=t.GetWorldInfo().GetSceneGraphZIndex();return s-n});for(const n of s)if(n.IsInContainer())for(const i of n.siblings())if(!s.includes(i)){const r=[...i.allChildren()];r.push(i),r.sort((e,t)=>{const s=e.GetWorldInfo().GetSceneGraphZIndex(),n=t.GetWorldInfo().GetSceneGraphZIndex();return s-n}),r&&r.length&&s.splice(s.length,0,...r)}for(const a of s)a.GetPlugin().IsWorldType()&&this._AddInstance(a,!0)}else if(e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0),e.IsInContainer())for(const o of e.siblings()){const l=[...o.allChildren()];if(l.push(o),l.sort((e,t)=>{const s=e.GetWorldInfo().GetSceneGraphZIndex(),n=t.GetWorldInfo().GetSceneGraphZIndex();return s-n}),l&&l.length)for(const h of l)h.GetPlugin().IsWorldType()&&this._AddInstance(h,!0)}}}}{let vec3EqualsXYZ2=function(e,t,s,n){return e[0]===Math.fround(t)&&e[1]===Math.fround(s)&&e[2]===Math.fround(n)},MaybePrepareLayerDraw2=function(e,t){lastLayerPreparedForDrawing!==e&&(e.PrepareForDraw(t),lastLayerPreparedForDrawing=e)},C33=(vec3EqualsXYZ=vec3EqualsXYZ2,MaybePrepareLayerDraw=MaybePrepareLayerDraw2,self.C3),C3Debugger=self.C3Debugger,assert=self.assert,tempDestRect=C33.New(C33.Rect),tempSrcRect=C33.New(C33.Rect),tempLayoutRect=C33.New(C33.Rect),tempColor=C33.New(C33.Color),glMatrix=self.glMatrix,vec32=glMatrix.vec3,tempRender3dList=[],tempInstanceList1=[],tempInstanceList2=[],tempInstanceList3=[],lastLayerPreparedForDrawing=null;C33.Layout=class extends C33.DefendedBase{constructor(e,t,s){super(),this._layoutManager=e,this._runtime=e.GetRuntime(),this._name=s[0],this._originalWidth=s[1],this._originalHeight=s[2],this._width=s[1],this._height=s[2],this._isUnboundedScrolling=!!s[3],this._isOrthographicProjection=!!s[4],this._vanishingPointX=s[5],this._vanishingPointY=s[6],this._eventSheetName=s[7],this._eventSheet=null,this._sid=s[8],this._index=t,this._scrollX=0,this._scrollY=0,this._scale=1,this._angle=0,this._initialObjectClasses=new Set,this._textureLoadedTypes=new Set,this._textureLoadPendingPromises=new Set,this._createdInstances=[],this._createdPersistedInstances=[],this._createdPersistedInstancesToDataMap=new Map,this._createdPersistedIndexToInstanceMap=new Map,this._initialNonWorld=[],this._is3dCameraEnabled=!1,this._cam3dposition=vec32.create(),this._cam3dlook=vec32.create(),this._cam3dup=vec32.create(),this._rootLayers=[],this._allLayersFlat=[],this._layersByName=new Map,this._layersBySid=new Map,this._pendingSetHTMLLayerCount=-1;const i=this._runtime.GetCanvasManager();this._effectList=C33.New(C33.EffectList,this,s[11]),this._effectChain=C33.New(C33.Gfx.EffectChain,i.GetEffectChainManager(),{drawContent:(e,t)=>{const s=t.GetContentObject(),n=s.GetRenderTarget();e.ResetColor(),e.DrawRenderTarget(n),e.InvalidateRenderTarget(n),i.ReleaseAdditionalRenderTarget(n)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasFullScreenQualityLow=!1,this._curRenderTarget=null,this._persistData={},this._persistedIntances=new Map,this._isFirstVisit=!0,this._iLayout=new self.ILayout(this),this._userScriptDispatcher=C33.New(C33.Event.Dispatcher);for(const n of s[9])this._rootLayers.push(C33.Layer.CreateFromExportData(this,null,n));this._ReindexLayers();for(const r of this.allLayers())r._InitInitialInstances();for(const a of s[10]){const o=this._runtime.GetObjectClassByIndex(a[1]);if(!o)throw new Error("missing nonworld object class");o.GetDefaultInstanceData()||o.SetDefaultInstanceData(a),this._initialNonWorld.push(a),this._AddInitialObjectClass(o)}}Release(){for(const e of this._allLayersFlat)e.Release();C33.clearArray(this._allLayersFlat),this._textureLoadPendingPromises.clear(),this._eventSheet=null,this._layoutManager=null,this._runtime=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e="low"===this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality();if(this._needsRebuildEffectChainSteps||this._wasFullScreenQualityLow!==e||this._effectChain.NeedsRebuild()){const t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map(e=>e.GetShaderProgram()),{indexMap:t.map(e=>e.GetIndex()),forcePostDraw:e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasFullScreenQualityLow=e}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}GetMinLayerScale(){let s=this._allLayersFlat[0].GetNormalScale();for(let e=1,t=this._allLayersFlat.length;e<t;++e){const n=this._allLayersFlat[e];0===n.GetParallaxX()&&0===n.GetParallaxY()||(s=Math.min(s,n.GetNormalScale()))}return s}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){return this.IsUnboundedScrolling()?1/0:this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){return this.IsUnboundedScrolling()?1/0:this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(e){const t=this.GetScrollLeftBound(),s=this.GetScrollRightBound();this._scrollX!==(e=(e=s<e?s:e)<t?t:e)&&(this._scrollX=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollX(){return this._scrollX}SetScrollY(e){const t=this.GetScrollTopBound(),s=this.GetScrollBottomBound();this._scrollY!==(e=(e=s<e?s:e)<t?t:e)&&(this._scrollY=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX()),this.SetScrollY(this.GetScrollY());for(const e of this._allLayersFlat)e.IsOwnScrollPositionEnabled()&&(e.SetScrollX(e.GetScrollX()),e.SetScrollY(e.GetScrollY()))}SetVanishingPointXY(e,t){this._vanishingPointX===e&&this._vanishingPointY===t||(this._vanishingPointX=e,this._vanishingPointY=t,this.IsPerspectiveProjection()&&(this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender()))}GetVanishingPointX(){return this.IsOrthographicProjection()?.5:this._vanishingPointX}GetVanishingPointY(){return this.IsOrthographicProjection()?.5:this._vanishingPointY}HasVanishingPointOutsideViewport(){const e=this.GetVanishingPointX(),t=this.GetVanishingPointY();return e<0||1<e||t<0||1<t}SetPerspectiveProjection(){this._isOrthographicProjection&&(this._isOrthographicProjection=!1,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}SetOrthographicProjection(){this._isOrthographicProjection||(this._isOrthographicProjection=!0,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(e){this._is3dCameraEnabled!==(e=!!e)&&(this._is3dCameraEnabled=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(e,t,s,n,i,r,a,o,l){vec3EqualsXYZ2(this._cam3dposition,e,t,s)&&vec3EqualsXYZ2(this._cam3dlook,n,i,r)&&vec3EqualsXYZ2(this._cam3dup,a,o,l)||(vec32.set(this._cam3dposition,e,t,s),vec32.set(this._cam3dlook,n,i,r),vec32.set(this._cam3dup,a,o,l),this.Set3DCameraChanged())}Set3DCameraChanged(){this._SetAllLayersMVChanged(),this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(e){this._scale!==e&&(this._scale=e,this._SetAllLayersMVChanged(),this.BoundScrolling(),this._runtime.UpdateRender())}SetAngle(e){e=C33.clampAngle(e),this._angle!==e&&(this._angle=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(e){!isFinite(e)||e<1||(this._width=e)}GetHeight(){return this._height}SetHeight(e){!isFinite(e)||e<1||(this._height=e)}GetEventSheet(){return this._eventSheet}_GetRootLayers(){return this._rootLayers}*allLayers(){for(const e of this._rootLayers)yield*e.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(e){return"number"==typeof e?this.GetLayerByIndex(e):this.GetLayerByName(e.toString())}GetLayerByIndex(e){return e=C33.clamp(Math.floor(e),0,this._allLayersFlat.length-1),this._allLayersFlat[e]}GetLayerByName(e){return this._layersByName.get(e.toLowerCase())||null}HasLayerByName(e){return!!this.GetLayerByName(e)}GetLayerBySID(e){return this._layersBySid.get(e)||null}_SetAllLayersProjectionChanged(){for(const e of this._allLayersFlat)e._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(const e of this._allLayersFlat)e._SetMVMatrixChanged()}AddLayer(e,t,s){if(this.HasLayerByName(e))throw new Error(`layer name '${e}' already in use`);if(!t&&s<2)throw new Error("invalid insert position");const n=2<=s?t:t.GetParentLayer(),i=C33.New(C33.Layer,this,n,{name:e,sid:Math.floor(1e15*Math.random()),isDynamic:!0});this._InsertLayer(i,t,s),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers()}MoveLayer(e,t,s){if(!t&&s<2)throw new Error("invalid insert position");e===t&&s<2||(this._RemoveLayer(e),this._InsertLayer(e,t,s),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers())}RemoveLayer(e){if(this._RemoveLayer(e)){const t=this._runtime.GetEventSheetManager();t.BlockFlushingInstances(!0),e.Release(),t.BlockFlushingInstances(!1),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers()}}RemoveAllDynamicLayers(){const e=new Set;for(const t of this.allLayers())t.IsDynamic()&&!t.HasAnyDynamicParentLayer()&&e.add(t);if(0!==e.size){const s=this._runtime.GetEventSheetManager();s.BlockFlushingInstances(!0);for(const n of e)this._RemoveLayer(n),n.Release();s.BlockFlushingInstances(!1),this.GetRuntime().UpdateRender(),this._ReindexAndUpdateAllLayers()}}_InsertLayer(t,s,n){if(2<=n)if(s){if(s===t||s.HasParentLayer(t))throw new Error(`cannot move layer '${t.GetName()}' to sub-layer of itself`);s._AddSubLayer(t,2===n),t._SetParentLayer(s)}else 2===n?this._rootLayers.push(t):this._rootLayers.unshift(t),t._SetParentLayer(null);else{const e=s.GetParentLayer();if(e){if(s.HasParentLayer(t))throw new Error(`cannot move layer '${t.GetName()}' to sub-layer of itself`);e._InsertSubLayer(t,s,0===n),t._SetParentLayer(e)}else{let e=this._rootLayers.indexOf(s);if(-1===e)throw new Error("cannot find layer to insert by");0===n&&++e,this._rootLayers.splice(e,0,t),t._SetParentLayer(null)}}}_RemoveLayer(e){const t=e.GetParentLayer();if(t)return t._RemoveSubLayer(e),!0;if(1<this._rootLayers.length){const s=this._rootLayers.indexOf(e);if(-1===s)throw new Error("cannot find layer to remove");return this._rootLayers.splice(s,1),!0}return!1}_ReindexLayers(){this._allLayersFlat=[...this.allLayers()],this._layersByName.clear(),this._layersBySid.clear();for(let e=0,t=this._allLayersFlat.length;e<t;++e){const s=this._allLayersFlat[e];s._SetIndex(e),this._layersByName.set(s.GetName().toLowerCase(),s),this._layersBySid.set(s.GetSID(),s)}}_ReindexHTMLLayers(){let e=0;for(const t of this._rootLayers){for(const s of t.selfAndAllSubLayers())s._SetHTMLIndex(e);t.IsHTMLElementsLayer()&&e++}}GetHTMLLayerCount(){return this._rootLayers.at(-1).GetHTMLIndex()+1}async _ReindexAndUpdateAllLayers(){this._ReindexLayers(),this._ReindexHTMLLayers(),this._pendingSetHTMLLayerCount=this.GetHTMLLayerCount()}_GetPendingSetHTMLLayerCount(){return this._pendingSetHTMLLayerCount}_ResetPendingHTMLLayerCount(){this._pendingSetHTMLLayerCount=-1}GetRootLayersForHTMLLayer(e){const t=[];for(const s of this._rootLayers){const n=s.GetHTMLIndex();if(n===e)t.push(s);else if(e<n)break}return t}SaveTransform(){return{scrollX:this.GetScrollX(),scrollY:this.GetScrollY(),scale:this.GetScale(),angle:this.GetAngle(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY()}}RestoreTransform(e){this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this.SetScale(e.scale),this.SetAngle(e.angle),this.SetVanishingPointXY(e.vpX,e.vpY)}GetLayoutBackgroundColor(){let e=this._rootLayers.filter(e=>e.ShouldDraw())[0];for(;e;){if(!e.IsTransparent())return tempColor.copyRgb(e.GetBackgroundColor()),tempColor.setA(1),tempColor;if(e.UsesOwnTexture())return tempColor.setRgba(0,0,0,0),tempColor;e=e.GetSubLayers().filter(e=>e.ShouldDraw())[0]}return tempColor.setRgba(0,0,0,0),tempColor}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(e){if(e.IsInContainer())for(const t of e.GetContainer().GetObjectTypes())this._initialObjectClasses.add(t);else this._initialObjectClasses.add(e)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(e,t){if(e===this||!t)return Promise.resolve();e&&(C33.CopySet(this._textureLoadedTypes,e._textureLoadedTypes),e._textureLoadedTypes.clear());const s=[];for(const n of this._initialObjectClasses)this._textureLoadedTypes.has(n)||(s.push(n.LoadTextures(t)),this._textureLoadedTypes.add(n));return Promise.all(s)}async MaybeLoadTexturesFor(e){if(e.IsFamily())throw new Error("cannot load textures for family");const t=this._runtime.GetRenderer();if(t&&!t.IsContextLost()&&!this._textureLoadedTypes.has(e)){this._textureLoadedTypes.add(e);const s=e.LoadTextures(t);this._AddPendingTextureLoadPromise(s),await s,e.OnDynamicTextureLoadComplete(),this._runtime.UpdateRender()}}_AddPendingTextureLoadPromise(e){this._textureLoadPendingPromises.add(e),e.then(()=>this._textureLoadPendingPromises.delete(e)).catch(()=>this._textureLoadPendingPromises.delete(e))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(e){if(e.IsFamily()||0<e.GetInstanceCount())throw new Error("cannot unload textures");const t=this._runtime.GetRenderer();t&&this._textureLoadedTypes.has(e)&&(this._textureLoadedTypes.delete(e),e.ReleaseTextures(t))}_Unload(e,t){if(e!==this&&t)for(const s of this._textureLoadedTypes)s.IsGlobal()||e._initialObjectClasses.has(s)||(s.ReleaseTextures(),this._textureLoadedTypes.delete(s))}_OnRendererContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(e){const t=this._runtime,s=this._layoutManager,n=t.GetEventSheetManager(),i=(this._eventSheetName&&(this._eventSheet=n.GetEventSheetByName(this._eventSheetName),this._eventSheet._UpdateDeepIncludes()),s._SetMainRunningLayout(this),this._width=this._originalWidth,this._height=this._originalHeight,this._scrollX=t.GetOriginalViewportWidth()/2,this._scrollY=t.GetOriginalViewportHeight()/2,this.BoundScrolling(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._ReindexHTMLLayers(),await this._runtime.GetCanvasManager().SetHTMLLayerCount(this.GetHTMLLayerCount(),!0),this._MoveGlobalObjectsToThisLayout(e),this._runtime.SetUsingCreatePromises(!0),this._CreateInitialInstances(),this._isFirstVisit||this._CreatePersistedInstances(),this._CreateAndLinkContainerInstances(this._createdInstances),this._CreateAndLinkContainerInstances(this._createdPersistedInstances),this._CreateInitialNonWorldInstances(),s.ClearPendingChangeLayout(),t.FlushPendingInstances(),this._runtime.SetUsingCreatePromises(!1),this._runtime.GetCreatePromises());if(await Promise.all(i),C33.clearArray(i),!t.IsLoadingState()){for(const r of this._createdInstances)r.SetupInitialSceneGraphConnections();for(const a of this._createdPersistedInstances)a.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);for(const[o,l]of Object.entries(this._persistData)){const h=this._runtime.GetObjectClassBySID(parseInt(o,10));h&&!h.IsFamily()&&h.HasPersistBehavior()&&C33.clearArray(l)}for(const c of this._createdInstances)c._TriggerOnCreated();for(const u of this._createdPersistedInstances)u._TriggerOnCreated()}C33.clearArray(this._createdInstances),C33.clearArray(this._createdPersistedInstances),this._createdPersistedInstancesToDataMap.clear(),this._createdPersistedIndexToInstanceMap.clear(),await Promise.all([...this._initialObjectClasses].map(e=>e.PreloadTexturesWithInstances(this._runtime.GetRenderer()))),e&&(t.Dispatcher().dispatchEvent(new C33.Event("beforefirstlayoutstart")),await t.DispatchUserScriptEventAsyncWait(new C33.Event("beforeprojectstart"))),await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("beforeanylayoutstart")),t.Dispatcher().dispatchEvent(new C33.Event("beforelayoutstart")),await this.DispatchUserScriptEventAsyncWait(new C33.Event("beforelayoutstart")),t.IsLoadingState()||await t.TriggerAsync(C33.Plugins.System.Cnds.OnLayoutStart,null,null),t.Dispatcher().dispatchEvent(new C33.Event("afterlayoutstart")),await this.DispatchUserScriptEventAsyncWait(new C33.Event("afterlayoutstart")),await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("afteranylayoutstart")),e&&(t.Dispatcher().dispatchEvent(new C33.Event("afterfirstlayoutstart")),await t.DispatchUserScriptEventAsyncWait(new C33.Event("afterprojectstart"))),n._RunQueuedTriggers(s),await this.WaitForPendingTextureLoadsToComplete(),this._isFirstVisit=!1}_MoveGlobalObjectsToThisLayout(e){for(const t of this._runtime.GetAllObjectClasses())if(!t.IsFamily()&&t.IsWorldType())for(const s of t.GetInstances()){const n=s.GetWorldInfo(),i=n.GetLayer(),r=C33.clamp(i.GetIndex(),0,this._allLayersFlat.length-1),a=this._allLayersFlat[r];n._SetLayer(a,!0),a._MaybeAddInstance(s)}if(!e)for(const o of this._allLayersFlat)o._SortInstancesByLastCachedZIndex(!1)}_CreateInitialInstances(){for(const e of this._allLayersFlat)e.CreateInitialInstances(this._createdInstances),e._Start()}_CreatePersistedInstances(){let t=!1;for(const[e,s]of Object.entries(this._persistData)){const n=this._runtime.GetObjectClassBySID(parseInt(e,10));if(n&&!n.IsFamily()&&n.HasPersistBehavior())for(const i of s){let e=null;if(!n.IsWorldType()||(e=i.hasOwnProperty("instJson")?this.GetLayerBySID(i.instJson.w.l):this.GetLayerBySID(i.w.l))){const r=this._runtime.CreateInstanceFromData(n,e,!1,0,0,!0);i.hasOwnProperty("instJson")?r.LoadFromJson(i.instJson):r.LoadFromJson(i),t=!0,this._createdPersistedInstances.push(r),i.hasOwnProperty("instJson")&&(this._createdPersistedInstancesToDataMap.set(r,i),this._createdPersistedIndexToInstanceMap.set(i.index,r))}}}for(const a of this._allLayersFlat)a._SortInstancesByLastCachedZIndex(!0),a.SetZIndicesChanged();t&&(this._runtime.FlushPendingInstances(),this._runtime._RefreshUidMap())}_CreateAndLinkContainerInstances(t){for(const s of t)if(s.IsInContainer()){const n=s.GetWorldInfo(),e=s.GetIID();for(const i of s.GetObjectClass().GetContainer().objectTypes())if(i!==s.GetObjectClass()){const r=i.GetInstances();if(r.length>e)s._AddSibling(r[e]);else{let e;e=n?this._runtime.CreateInstanceFromData(i,n.GetLayer(),!0,n.GetX(),n.GetY(),!0):this._runtime.CreateInstanceFromData(i,null,!0,0,0,!0),this._runtime.FlushPendingInstances(),i._UpdateIIDs(),s._AddSibling(e),t.push(e)}}}}_CreateInitialNonWorldInstances(){for(const e of this._initialNonWorld){const t=this._runtime.GetObjectClassByIndex(e[1]);t.IsInContainer()||this._runtime.CreateInstanceFromData(e,null,!0)}}_CreateGlobalNonWorlds(){let s=[],n=this._initialNonWorld,i=0;for(let e=0,t=n.length;e<t;++e){const r=n[e],a=this._runtime.GetObjectClassByIndex(r[1]);a.IsGlobal()?a.IsInContainer()&&a.GetContainer().HasAnyWorldType()||s.push(this._runtime.CreateInstanceFromData(r,null,!0)):(n[i]=r,++i)}C33.truncateArray(n,i),this._runtime.FlushPendingInstances(),this._CreateAndLinkContainerInstances(s)}RecreateInitialObjects(e,t,s,n,i,r,a){if(s)return s.RecreateInitialObjects(e,t,i,r,n,a);{const o=[];for(const l of this._allLayersFlat)o.push(l.RecreateInitialObjects(e,t,i,r,n,a));return o.flat()}}async _StopRunning(){const e=this._layoutManager;this._runtime.IsLoadingState()||(await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("beforeanylayoutend")),await this.DispatchUserScriptEventAsyncWait(new C33.Event("beforelayoutend")),await this._runtime.TriggerAsync(C33.Plugins.System.Cnds.OnLayoutEnd,null,null),await this.DispatchUserScriptEventAsyncWait(new C33.Event("afterlayoutend")),await this.DispatchRuntimeUserScriptEventAsyncWait(new C33.Event("afteranylayoutend"))),e.SetIsEndingLayout(!0),this._runtime.GetEventSheetManager().ClearAllScheduledWaits(),this._isFirstVisit||this._SavePersistData();for(const t of this._allLayersFlat)t._End();for(const s of this._runtime.GetAllObjectClasses())if(!(s.IsGlobal()||s.IsWorldType()||s.GetPlugin().IsSingleGlobal()||s.IsFamily())){for(const n of s.GetInstances())this._runtime.DestroyInstance(n);this._runtime.FlushPendingInstances()}e.SetIsEndingLayout(!1),e.GetMainRunningLayout()===this&&e._SetMainRunningLayout(null)}_SaveInstanceToPersist(e,t){const s=e.GetObjectClass().GetSID().toString(),n=(this._persistData.hasOwnProperty(s)||(this._persistData[s]=[]),this._persistData[s]),i={index:t,instJson:e.SaveToJson(),sceneGraphJson:{children:[]}};n.push(i),this._persistedIntances.set(e,i)}_SaveSceneGraphInfoToPersist(e){const t=this._persistedIntances.get(e);for(const s of e.GetChildren()){const n=this._persistedIntances.get(s);n&&t.sceneGraphJson.children.push({index:n.index,flags:C33.SceneGraphInfo._GetFlagsNumber(s.GetWorldInfo())})}}_SavePersistData(){this._persistedIntances.clear();let e=0;for(const t of this._allLayersFlat){t._UpdateZIndices();for(const s of t._GetInstances()){const n=s.GetObjectClass();!n.IsGlobal()&&n.HasPersistBehavior()&&(this._SaveInstanceToPersist(s,e),e++)}}for(const i of this._allLayersFlat)for(const r of i._GetInstances()){const a=r.GetObjectClass();!a.IsGlobal()&&a.HasPersistBehavior()&&this._SaveSceneGraphInfoToPersist(r)}this._persistedIntances.clear()}ResetPersistData(){this._persistData={},this._isFirstVisit=!0}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){const e=this._runtime,t=e.GetRenderer().IsWebGL();return"low"===e.GetCanvasManager().GetCurrentFullscreenScalingQuality()||t&&e.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect()||t&&e.Uses3DFeatures()}_MaybeStartDrawToOwnTexture(e){const t=this._runtime.GetCanvasManager();if(this.UsesOwnTexture()){e.SetRenderTarget(null),e.ClearRgba(0,0,0,0);const s={sampling:this._runtime.GetSampling(),isSampled:e.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()};"low"===t.GetCurrentFullscreenScalingQuality()&&(s.width=t.GetDrawWidth(),s.height=t.GetDrawHeight()),this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(s)}else this._curRenderTarget=null}_MaybeCopyOwnTextureToBackbuffer(e){this._runtime._NeedsHTMLLayerCompositing(e)&&(e.SetDepthEnabled(!1),e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(this._curRenderTarget))}_MaybeEndDrawToOwnTexture(e){this.UsesOwnTexture()&&(e.SetDepthEnabled(!1),this._DrawLayoutOwnTextureToRenderTarget(e,this._curRenderTarget))}DrawMain(e){e.SetRenderTarget(this._curRenderTarget),e.Clear(this.GetLayoutBackgroundColor()),this._runtime.Uses3DFeatures()&&e.ClearDepth();const t=this.GetRootLayersForHTMLLayer(0);this._DrawLayerList(e,this._curRenderTarget,t,!0),e.IsWebGPU()&&e.StartMeasuringRenderPassTime(0,1),this._MaybeEndDrawToOwnTexture(e),this._curRenderTarget=null}DrawForHTMLLayerIndex(e,t){let s=null;this._runtime._NeedsHTMLLayerCompositing(e)&&(s=this._curRenderTarget),e.SetRenderTarget(s),e.ClearRgba(0,0,0,0),this._runtime.Uses3DFeatures()&&e.ClearDepth();const n=this.GetRootLayersForHTMLLayer(t);this._DrawLayerList(e,s,n,!0),this._MaybeCopyOwnTextureToBackbuffer(e),e.EndBatch(),this._runtime.GetCanvasManager().BlitMainCanvasToHTMLLayerCanvas(t)}_DrawLayerList(e,n,t,i){const r=t.filter(e=>e.ShouldDraw());for(let t=0,s=r.length;t<s;){const a=r[t];if(a.SelfAndAllSubLayersHave3DCamera()&&!a.SelfOrAnySubLayerUsesOwnTexture()){tempRender3dList.push(a);for(let e=t+1;e<s;++e){const o=r[e];if(!o.SelfAndAllSubLayersHave3DCamera()||o.SelfOrAnySubLayerUsesOwnTexture())break;tempRender3dList.push(r[e])}if(2<=tempRender3dList.length||1===tempRender3dList.length&&tempRender3dList[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(e,n,tempRender3dList),t+=tempRender3dList.length,C33.clearArray(tempRender3dList);continue}C33.clearArray(tempRender3dList)}a.Draw(e,n,i&&0===t),++t}}_DrawLayoutOwnTextureToRenderTarget(e,t){const s=this._effectList.GetActiveEffectTypes(),n=this._runtime;0===s.length?(e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(t),e.InvalidateRenderTarget(t),n.ReleaseAdditionalRenderTarget(t)):(tempLayoutRect.set(0,0,n.GetViewportWidth(),n.GetViewportHeight()),this.GetEffectChain().Render(e,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:tempLayoutRect,drawSurfaceRect:null,invalidateRenderTargets:!0}))}_Draw3DLayers(n,i,e){e[0].IsTransparent()||(tempColor.copyRgb(e[0].GetBackgroundColor()),tempColor.setA(1),n.Clear(tempColor)),this._runtime.GetCanvasManager(),n.SetDepthEnabled(!0);const r=tempInstanceList1,a=tempInstanceList2,o=tempInstanceList3;for(const l of e)l._UpdateZIndices(),l._AppendAllInstancesIncludingSubLayersInDrawOrder(r);const t=e[0],s=t._MaybeStartWebGLProfiling(n);t._MaybeStartWebGPUProfiling(n);for(let t=0,s=r.length;t<s;){const h=r[t],c=h.GetWorldInfo(),u=c.GetLayer();if(c.IsVisible()&&c.IsInViewport3D(u._GetViewFrustum())){(!h.RendersToOwnZPlane()||0<c.GetDepth())&&o.push(h);const d=h.GetWorldInfo().GetTotalZElevation();a.push(h);let e=t+1;for(;e<s;++e){const _=r[e],p=_.GetWorldInfo();if(p.IsVisible()&&p.IsInViewport3D(p.GetLayer()._GetViewFrustum())){if(p.GetTotalZElevation()!==d)break;(_.RendersToOwnZPlane()?(0<p.GetDepth()&&o.push(_),a):o).push(_)}}if(1!==a.length||a[0].MustMitigateZFighting()){this._Draw3DLayersCoplanarInstances(n,i,a);for(let e=0,t=o.length;e<t;++e){const m=o[e],g=m.GetWorldInfo(),f=g.GetLayer();g._SetDrawNonBackFacesOnly(!0),MaybePrepareLayerDraw2(f,n),f._DrawInstanceMaybeWithEffects(m,g,n,i),g._SetDrawNonBackFacesOnly(!1)}}else{MaybePrepareLayerDraw2(u,n),u._DrawInstanceMaybeWithEffects(h,c,n,i);for(let e=0,t=o.length;e<t;++e){const S=o[e];if(S!==h){const y=S.GetWorldInfo(),C=y.GetLayer();MaybePrepareLayerDraw2(C,n),C._DrawInstanceMaybeWithEffects(S,y,n,i)}}}t=e,C33.clearArray(a),C33.clearArray(o)}else++t}s&&n.EndQuery(s),C33.clearArray(r),lastLayerPreparedForDrawing=null}_Draw3DLayersCoplanarInstances(s,n,i){s.CoplanarStartStencilPass();for(let e=0,t=i.length;e<t;++e){const r=i[e],a=r.GetWorldInfo(),o=a.GetLayer();a._SetDrawBackFaceOnly(!0),MaybePrepareLayerDraw2(o,s),o._DrawInstance(r,a,s)}s.CoplanarStartColorPass();for(let e=0,t=i.length;e<t;++e){const l=i[e],h=l.GetWorldInfo(),c=h.GetLayer();MaybePrepareLayerDraw2(c,s),c._DrawInstanceMaybeWithEffects(l,h,s,n),h._SetDrawBackFaceOnly(!1)}s.CoplanarRestoreStandardRendering()}_SaveToJson(){const e={sx:this.GetScrollX(),sy:this.GetScrollY(),s:this.GetScale(),a:this.GetAngle(),w:this.GetWidth(),h:this.GetHeight(),ortho:this.IsOrthographicProjection(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY(),fv:this._isFirstVisit,persist:this._persistData,fx:this._effectList.SaveToJson(),layers:{},dynamicLayers:[]};for(const t of this._allLayersFlat)if(t.IsDynamic()){const s=t.GetParentLayer();e.dynamicLayers.push({sid:t.GetSID(),name:t.GetName(),parentSid:s?s.GetSID():null,siblingIndex:t._GetSiblingIndex(),data:t._SaveToJson()})}else e.layers[t.GetSID().toString()]=t._SaveToJson();return e}_LoadFromJson(e){this._scrollX=e.sx,this._scrollY=e.sy,this._scale=e.s,this._angle=e.a,this._width=e.w,this._height=e.h,this._isOrthographicProjection=!!e.ortho,e.hasOwnProperty("vpX")&&(this._vanishingPointX=e.vpX),e.hasOwnProperty("vpY")&&(this._vanishingPointY=e.vpY),this._isFirstVisit=!!e.fv,this._persistData=e.persist,this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0;for(const[t,s]of Object.entries(e.layers)){const n=parseInt(t,10),i=this.GetLayerBySID(n);i&&i._LoadFromJson(s)}if(e.hasOwnProperty("dynamicLayers")){this.RemoveAllDynamicLayers(),this._runtime.FlushPendingInstances();const r=new Map,a=e.dynamicLayers;for(let e=a.length-1;0<=e;--e){const o=a[e],l=o.sid,h=o.name,c=o.parentSid,u=o.siblingIndex,d=o.data;if(this._ReindexLayers(),!this.HasLayerByName(h)&&!this.GetLayerBySID(l)){let e,t;if(null===c)e=null,t=this._rootLayers;else{if(!(e=this.GetLayerBySID(c)))continue;t=e.GetSubLayers()}const _=C33.New(C33.Layer,this,e,{name:h,sid:l,isDynamic:!0});t.push(_);let s=r.get(t);s||(s=[],r.set(t,s)),s.push({layer:_,siblingIndex:u}),_._LoadFromJson(d)}}for(const[p,m]of r){m.sort((e,t)=>e.siblingIndex-t.siblingIndex);for(const g of m){let e=g.layer,t=g.siblingIndex,s=p.indexOf(e);p.splice(s,1),p.splice(t,0,e)}}}this._ReindexAndUpdateAllLayers(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.layout=this.GetILayout();const t=this._runtime,s=t.IsDebug()&&!t.GetEventSheetManager().IsInEventEngine();s&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),s&&C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}DispatchRuntimeUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._runtime.DispatchUserScriptEventAsyncWait(e)}_LogLayerTree(){this._LogLayerList(this._rootLayers)}_LogLayerList(e,t=0){const s=e.slice(0);s.reverse();for(const n of s)console.log("\t".repeat(t)+"- "+n.GetName()),this._LogLayerList(n.GetSubLayers(),t+1)}}}{const C33=self.C3;C33.LayoutManager=class extends C33.DefendedBase{#runtime;#allLayouts=[];#layoutsByName=new Map;#layoutsBySid=new Map;#mainRunningLayout=null;#runningSubLayouts=[];#firstLayout=null;#isEndingLayout=0;#pendingChangeLayout=null;constructor(e){super(),this.#runtime=e}Release(){this.#runtime=null,this.#mainRunningLayout=null,this.#firstLayout=null,this.#pendingChangeLayout=null,C33.clearArray(this.#allLayouts),this.#layoutsByName.clear(),this.#layoutsBySid.clear(),C33.clearArray(this.#runningSubLayouts)}Create(e){const t=C33.New(C33.Layout,this,this.#allLayouts.length,e);this.#allLayouts.push(t),this.#layoutsByName.set(t.GetName().toLowerCase(),t),this.#layoutsBySid.set(t.GetSID(),t)}GetRuntime(){return this.#runtime}SetFirstLayout(e){this.#firstLayout=e}GetFirstLayout(){if(this.#firstLayout)return this.#firstLayout;if(this.#allLayouts.length)return this.#allLayouts[0];throw new Error("no first layout")}GetLayoutByName(e){return this.#layoutsByName.get(e.toLowerCase())||null}GetLayoutBySID(e){return this.#layoutsBySid.get(e)||null}GetLayoutByIndex(e){return e=C33.clamp(Math.floor(e),0,this.#allLayouts.length-1),this.#allLayouts[e]}GetLayout(e){return"number"==typeof e?this.GetLayoutByIndex(e):this.GetLayoutByName(e.toString())}GetAllLayouts(){return this.#allLayouts}_SetMainRunningLayout(e){this.#mainRunningLayout=e}GetMainRunningLayout(){return this.#mainRunningLayout}_AddRunningSubLayout(e){if(this.#runningSubLayouts.includes(e))throw new Error("layout already running");this.#runningSubLayouts.push(e)}_RemoveRunningSubLayout(e){const t=this.#runningSubLayouts.indexOf(e);if(-1===t)throw new Error("layout not running");this.#runningSubLayouts.splice(t,1)}*runningLayouts(){this.#mainRunningLayout&&(yield this.#mainRunningLayout),this.#runningSubLayouts.length&&(yield*this.#runningSubLayouts)}IsLayoutRunning(e){return this.#mainRunningLayout===e||this.#runningSubLayouts.includes(e)}SetIsEndingLayout(e){if(e)this.#isEndingLayout++;else{if(this.#isEndingLayout<=0)throw new Error("already unset");this.#isEndingLayout--}}IsEndingLayout(){return 0<this.#isEndingLayout}ChangeMainLayout(e){this.#pendingChangeLayout=e}ClearPendingChangeLayout(){this.#pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this.#pendingChangeLayout}GetPendingChangeMainLayout(){return this.#pendingChangeLayout}SetAllLayerProjectionChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersMVChanged()}}}{const C33=self.C3,NAMES_REGEXP=new RegExp("<(.+?)>","g");C33.TimelineManager=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._timelineDataManager=C33.New(C33.TimelineDataManager),this._pluginInstance=null,this._timelines=[],this._timelinesByName=new Map,this._objectClassToTimelineMap=new Map,this._timelinesCreatedByTemplate=new Map,this._scheduledTimelines=[],this._playingTimelines=[],this._markedForRemovalTimelines=[],this._hasRuntimeListeners=!1,this._changingLayout=!1,this._isTickingTimelines=!1,this._tickFunc=()=>this._OnTick(),this._tick2Func=()=>this._OnTick2(),this._beforeLayoutChange=()=>this._OnBeforeChangeLayout(),this._layoutChange=()=>this._OnAfterChangeLayout(),this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance),this._beforeLoad=e=>this._OnBeforeLoad(),this._afterLoad=e=>this._OnAfterLoad(),this._afterLayoutStart=e=>this._OnAfterLayoutStart(),this._destroyedWhileLoadingState=[],this._renderChange=0}Release(){this.RemoveRuntimeListeners(),this._tickFunc=null,this._tick2Func=null,this._beforeLayoutChange=null,this._layoutChange=null,this._instanceDestroy=null,this._afterLoad=null;for(const e of this._timelines)e.Stop(),e.Release();C33.clearArray(this._timelines),this._timelines=null,this._timelineDataManager.Release(),this._timelineDataManager=null,C33.clearArray(this._scheduledTimelines),this._scheduledTimelines=null,C33.clearArray(this._playingTimelines),this._playingTimelines=null,C33.clearArray(this._markedForRemovalTimelines),this._markedForRemovalTimelines=null,this._timelinesByName.clear(),this._timelinesByName=null,this._objectClassToTimelineMap.clear(),this._objectClassToTimelineMap=null,this._timelinesCreatedByTemplate.clear(),this._timelinesCreatedByTemplate=null,C33.clearArray(this._destroyedWhileLoadingState),this._destroyedWhileLoadingState=null,this._runtime=null}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e.addEventListener("pretick",this._tickFunc),e.addEventListener("tick2",this._tick2Func),e.addEventListener("beforelayoutchange",this._beforeLayoutChange),e.addEventListener("layoutchange",this._layoutChange),e.addEventListener("instancedestroy",this._instanceDestroy),e.addEventListener("beforeload",this._beforeLoad),e.addEventListener("afterload",this._afterLoad),e.addEventListener("afterlayoutstart",this._afterLayoutStart)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e.removeEventListener("pretick",this._tickFunc),e.removeEventListener("tick2",this._tick2Func),e.removeEventListener("beforelayoutchange",this._beforeLayoutChange),e.removeEventListener("layoutchange",this._layoutChange),e.removeEventListener("instancedestroy",this._instanceDestroy),e.removeEventListener("beforeload",this._beforeLoad),e.removeEventListener("afterload",this._afterLoad),e.removeEventListener("afterlayoutstart",this._afterLayoutStart)}Create(e){this._timelineDataManager.Add(e);const t=C33.TimelineState.CreateInitial(e,this);this.Add(t),this.SetTimelineObjectClassesToMap(t),this._timelinesCreatedByTemplate.set(t.GetName(),0)}CreateFromTemplate(e){const t=this.GetTimelineDataManager(),s=e.GetTemplateName(),n=t.Get(s),i=C33.TimelineState.CreateFromTemplate(s+":"+this._timelinesCreatedByTemplate.get(s),n,this);return this._IncreaseTemplateTimelinesCount(s),this.Add(i),i}_IncreaseTemplateTimelinesCount(e){this._timelinesCreatedByTemplate.set(e,this._timelinesCreatedByTemplate.get(e)+1)}_SetCreatedTemplateTimelinesCount(){for(const e of this._timelines)if(!e.IsTemplate()){const t=e.GetTemplateName();this._IncreaseTemplateTimelinesCount(t)}}_ClearCreatedTemplateTimelinesCount(){for(const e of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(e,0)}Add(e){this._timelines.push(e),this._timelinesByName.set(e.GetName().toLowerCase(),e)}Remove(e){e.Removed(),e.IsTemplate()||(C33.arrayFindRemove(this._timelines,e),C33.arrayFindRemove(this._scheduledTimelines,e),C33.arrayFindRemove(this._playingTimelines,e),C33.arrayFindRemove(this._markedForRemovalTimelines,e),this._timelinesByName.delete(e.GetName().toLowerCase()),this.RemoveTimelineFromObjectClassMap(e),e.IsReleased())||e.Release()}Trigger(e){this._runtime.Trigger(e,this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(e){this._pluginInstance=e}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(const e of this._timelines)yield e}*GetPlayingTimelines(){for(const e of this._playingTimelines)yield e}SetTimelineObjectClassToMap(e,t){this._objectClassToTimelineMap.has(e)||this._objectClassToTimelineMap.set(e,new Set),this._objectClassToTimelineMap.get(e).add(t)}SetTimelineObjectClassesToMap(e){for(const t of e.GetObjectClasses())this.SetTimelineObjectClassToMap(t,e)}RemoveTimelineFromObjectClassMap(e){for(const[t,s]of this._objectClassToTimelineMap.entries())s.has(e)&&(s.delete(e),0===s.size)&&this._objectClassToTimelineMap.delete(t)}GetTimelinesForObjectClass(e){if(this._objectClassToTimelineMap.has(e))return this._objectClassToTimelineMap.get(e)}GetTimelineOfTemplateForInstances(e,t){if(t)for(const s of this._timelines){const n=t.every(e=>s.HasTrackInstance(e.instance,e.trackId));if(n&&s.GetName().includes(e.GetName()))return s}}GetTimelineByName(e){return this._timelinesByName.get(e.toLowerCase())||null}GetScheduledOrPlayingTimelineByName(e){for(const t of this._scheduledTimelines)if(t.GetName()===e)return t;for(const s of this._playingTimelines)if(s.GetName()===e)return s;return null}*GetTimelinesByName(s){if(NAMES_REGEXP.test(s)){NAMES_REGEXP.lastIndex=0;let e,t=new Set;do{if(e=NAMES_REGEXP.exec(s)){const n=e[1].split(",");for(const i of n)t.add(i)}}while(e);for(const r of t.values()){const a=this.GetTimelineByName(r);a&&(yield a)}t.clear()}else{const e=this.GetTimelineByName(s);e&&(yield e)}}*GetTimelinesByTags(e){for(const t of this._timelines)t.HasTags(e)&&(yield t)}AddScheduledTimeline(e){this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e),this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(e){C33.arrayFindRemove(this._playingTimelines,e),this._MaybeDisableRuntimeListeners()}ScheduleTimeline(e){this._playingTimelines.includes(e)?(e.SetPlaying(!0),e.SetScheduled(!1),e.SetMarkedForRemoval(!1)):(e.SetPlaying(!1),e.SetScheduled(!0),e.SetMarkedForRemoval(!1),this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e)),this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(e){e.SetPlaying(!1),e.SetScheduled(!1),e.ResolvePlayPromise(),C33.arrayFindRemove(this._scheduledTimelines,e),this._MaybeDisableRuntimeListeners()}CompleteTimeline(e){e.SetPlaying(!1),e.SetScheduled(!1),this._playingTimelines.includes(e)&&(e.SetMarkedForRemoval(!0),this._markedForRemovalTimelines.push(e),C33.arrayFindRemove(this._playingTimelines,e)),this._scheduledTimelines.includes(e)&&e.SetMarkedForRemoval(!0)}CompleteTimelineBeforeChangeOfLayout(e){e.SetPlaying(!1),e.SetScheduled(!1),e.SetMarkedForRemoval(!1),e.SetPlaybackRate(1),C33.arrayFindRemove(this._playingTimelines,e)}CompleteTimelineAndResolve(e){this.CompleteTimeline(e),e.ResolvePlayPromise()}_OnTick(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){for(this._isTickingTimelines=!0;this._scheduledTimelines.length;){const e=this._scheduledTimelines.pop();(e.IsMarkedForRemoval()?(e.SetInitialStateForce(),this._markedForRemovalTimelines):(e.SetInitialState(),this._playingTimelines)).push(e),0!==e.GetRenderChange()&&(this._renderChange=1)}const t=this._runtime._GetDtFast(),s=this._runtime.GetDt1(),n=this._runtime.GetTimeScale();for(let e=this._playingTimelines.length-1;0<=e;e--){const i=this._playingTimelines[e];i&&i.Tick(t,n,s)}this._isTickingTimelines=!1,0!==this._renderChange&&this.GetRuntime().UpdateRender()}}_OnTick2(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){let s;for(let e=0,t=this._markedForRemovalTimelines.length;e<t;e++){const n=this._markedForRemovalTimelines[e];s=s||new Set,n.Removed(),this._MaybeExecuteTimelineFinishTriggers(n),s.add(n)}if(s){C33.arrayRemoveAllInSet(this._markedForRemovalTimelines,s);for(let e=this._renderChange=0,t=this._playingTimelines.length;e<t;e++)if(0!==this._playingTimelines[e].GetRenderChange()){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}}_MaybeExecuteTimelineFinishTriggers(e){e.IsReleased()||e.HasValidTracks()&&e.IsComplete()&&e.InitialStateSet()&&e.FinishTriggers()}_MaybeEnableRuntimeListeners(){this._hasRuntimeListeners||(this._hasRuntimeListeners=!0)}_MaybeDisableRuntimeListeners(){this._markedForRemovalTimelines.length||this._playingTimelines.length||this._scheduledTimelines.length||this._isTickingTimelines||(this._hasRuntimeListeners=!1)}_OnBeforeChangeLayout(){for(this._changingLayout=!0;this._scheduledTimelines.length;)this.DeScheduleTimeline(this._scheduledTimelines.pop());const e=new Set;for(const t of this._playingTimelines){const s=t._OnBeforeChangeLayout();s&&(t.Removed(),e.add(t))}C33.arrayRemoveAllInSet(this._playingTimelines,e),e.clear();for(const n of this._markedForRemovalTimelines){const i=n._OnBeforeChangeLayout();i&&(n.Removed(),e.add(n))}C33.arrayRemoveAllInSet(this._markedForRemovalTimelines,e),this._MaybeDisableRuntimeListeners();for(const r of this._timelines)r.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=!1}_OnInstanceDestroy(e){const t=e.GetObjectClass(),s=this.GetTimelinesForObjectClass(t);if(s)if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(e);else for(const n of s)n.IsTemplate()||(n.IsReleased()?this.Remove(n):n.HasValidTracks()||(this._MaybeExecuteTimelineFinishTriggers(n),this.Remove(n)))}_OnBeforeLoad(){for(const e of this._scheduledTimelines.map(e=>e))this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e);for(const t of this._playingTimelines.map(e=>e))this._MaybeExecuteTimelineFinishTriggers(t),this.Remove(t)}_OnAfterLoad(){for(const e of this._destroyedWhileLoadingState)this._OnInstanceDestroy(e);C33.clearArray(this._destroyedWhileLoadingState);for(const t of this._timelines)t._OnAfterLoad()}_OnAfterLayoutStart(){const e=this._runtime.GetLayoutManager(),t=e.GetMainRunningLayout();if(t)for(const s of this._timelines){const n=s.GetStartOnLayout();n&&t.GetName()===n&&this.ScheduleTimeline(s)}}_SaveToJson(){return{timelinesJson:this._SaveTimelinesToJson(),scheduledTimelinesJson:this._SaveScheduledTimelinesToJson(),playingTimelinesJson:this._SavePlayingTimelinesToJson(),markedForRemovalTimelinesJson:this._SaveMarkedForRemovalTimelinesToJson(),hasRuntimeListeners:this._hasRuntimeListeners,changingLayout:this._changingLayout,isTickingTimelines:this._isTickingTimelines}}_LoadFromJson(e){e&&(this._ClearCreatedTemplateTimelinesCount(),this._LoadTimelinesFromJson(e.timelinesJson),this._LoadScheduledTimelinesFromJson(e.scheduledTimelinesJson),this._LoadPlayingTimelinesFromJson(e.playingTimelinesJson),this._LoadMarkedForRemovalTimelinesFromJson(e.markedForRemovalTimelinesJson),this._hasRuntimeListeners=!e.hasRuntimeListeners,this._changingLayout=!!e.changingLayout,this._isTickingTimelines=!!e.isTickingTimelines,this._SetCreatedTemplateTimelinesCount(),this._MaybeEnableRuntimeListeners(),this._MaybeDisableRuntimeListeners())}_SaveTimelinesToJson(){return this._timelines.map(e=>e._SaveToJson())}_LoadTimelinesFromJson(e){for(const t of e){let e=this.GetTimelineByName(t.name);if(e)e._LoadFromJson(t);else{const s=this._GetTemplateNameFromJson(t);if(!s)continue;const n=this.GetTimelineByName(s);(e=this.CreateFromTemplate(n))._LoadFromJson(t)}e.HasTracks()||this.Remove(e)}}_GetTemplateNameFromJson(e){const t=e.name,s=t.split(":");return s&&2===s.length?s[0]:null}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(e){this._LoadTimelines(e,this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(e){this._LoadTimelines(e,this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(e){this._LoadTimelines(e,this._markedForRemovalTimelines)}_IsTimelineInJson(e,t){if(t)for(const s of t)if(s===e.GetName())return!0;return!1}_SaveTimelines(e){return e.map(e=>e.GetName())}_LoadTimelines(e,t){const s=new Set;for(const n of t)this._IsTimelineInJson(n,e)||s.add(n);if(C33.arrayRemoveAllInSet(t,s),e)for(const i of e){const r=this.GetTimelineByName(i);if(r){const a=t.find((t=>e=>e.GetName()===t)(i));a||t.push(r)}}}}}{const C33=self.C3,STEPS=100,LENGTH_STEP_SIZE=.01,BEZIER_STEP_SIZE=25,REFINE_ITERATIONS=20,LOOKUP_STEPS_FROM_LAST=5,TANGENT_RESULT=[0,0],MAP_RESULT=[0,0],SHORT_PROJECTION_RESULT=[0,0],PROJECTION_RESULT=[0,0,0,0,0],REFINE_LUT=new Array(4),REFINE_LUT_OBJECTS=[{x:0,y:0,t:0,distance:0},{x:0,y:0,t:0,distance:0},{x:0,y:0,t:0,distance:0}],REFINE_RESULT={x:0,y:0,t:0,distance:0};C33.TimelineInfo=class{constructor(e,t){this._initialized=!1,this._timeline=e,this._segments=[];let s=null;if(s=t?this._timeline.GetTrackById(t):C33.first(this._timeline.GetTracks())){const n=s.GetPropertyTrack("offsetX"),i=s.GetPropertyTrack("offsetY");if(n&&i){this._xTrack=n,this._yTrack=i;const r=n.GetPropertyKeyframeDataItemArrayIncludingDisabled(),a=i.GetPropertyKeyframeDataItemArrayIncludingDisabled();for(let e=1,t=Math.min(r.length,a.length);e<t;++e){const o=r[e],l=(o.GetNext(),o.GetPrevious()),h=a[e],c=(h.GetNext(),h.GetPrevious());l&&"cubic-bezier"===l.GetPathMode()&&c&&"cubic-bezier"===c.GetPathMode()?this._segments.push(C33.New(C33.TimelineCubicBezierSegmentInfo,l,c,o,h,this._segments.length)):(l&&"line"===l.GetPathMode()&&c&&c.GetPathMode(),this._segments.push(C33.New(C33.TimelineLineSegmentInfo,o,h,this._segments.length)))}this._initialized=!0}}}Release(){for(const e of this._segments)e.Release();C33.clearArray(this._segments),this._segments=null,this._timeline=null,this._xTrack=null,this._yTrack=null}WasInitialized(){return this._initialized}segments(){return this._segments}SetOrigin(e){const t="relative"===this._xTrack.GetResultMode()?e.GetX():0,s="relative"===this._yTrack.GetResultMode()?e.GetY():0;for(const n of this._segments)n.SetOrigin(t,s)}Project(t,s,e){let n=NaN,i=this._segments.length;for(let e=0;e<i;e++){const r=this._segments[e];if("cubic-bezier"===r.GetType()){const a=r.Project(t,s);(isNaN(n)||a[3]<n)&&(n=a[3],SHORT_PROJECTION_RESULT[0]=a[2],SHORT_PROJECTION_RESULT[1]=r.GetIndex())}}return SHORT_PROJECTION_RESULT}ProjectWithOptions(t,s,e){const n=e.tRange;C33.IsFiniteNumber(n[0])||(n[0]=0),C33.IsFiniteNumber(n[1])||(n[1]=1);let i=NaN,r=this._segments.length;for(let e=0;e<r;e++){const a=this._segments[e];if("cubic-bezier"===a.GetType()){const o=a.ProjectWithRange(t,s,n);(isNaN(i)||o[3]<i)&&(i=o[3],SHORT_PROJECTION_RESULT[0]=o[2],SHORT_PROJECTION_RESULT[1]=a.GetIndex())}}return SHORT_PROJECTION_RESULT}Tangent(e,t){return this._segments[t].Tangent(e)}TangentAngle(e,t){return this._segments[t].TangentAngle(e)}},C33.TimelineCubicBezierSegmentInfo=class{constructor(e,t,s,n,i){this._index=i;const r=e.GetAddOn("cubic-bezier"),a=s.GetAddOn("cubic-bezier"),o=t.GetAddOn("cubic-bezier"),l=n.GetAddOn("cubic-bezier");this._aX=e.GetValueWithResultMode(),this._aY=t.GetValueWithResultMode(),this._bX=e.GetValueWithResultMode()+r.GetStartAnchor(),this._bY=t.GetValueWithResultMode()+o.GetStartAnchor(),this._cX=s.GetValueWithResultMode()+a.GetEndAnchor(),this._cY=n.GetValueWithResultMode()+l.GetEndAnchor(),this._dX=s.GetValueWithResultMode(),this._dY=n.GetValueWithResultMode(),this._aXO=0,this._aYO=0,this._bXO=0,this._bYO=0,this._cXO=0,this._cYO=0,this._dXO=0,this._dYO=0,this._d0x=0,this._d0y=0,this._d1x=0,this._d1y=0,this._d2x=0,this._d2y=0,this._x1Factor=0,this._x2Factor=0,this._x3Factor=0,this._y1Factor=0,this._y2Factor=0,this._y3Factor=0,this._lutIndex=NaN,this._initialized=!1,this._len=STEPS,this._arcLengths=new Array(this._len+1),this._arcLengths[0]=0,this._length=0,this._lut=[],this._lutObjects=[];for(let e=0;e<STEPS;e++)this._lutObjects.push({x:0,y:0,t:0,distance:0});this._CalculateLength()}Release(){C33.clearArray(this._arcLengths),this._arcLengths=null,C33.clearArray(this._lut),this._lut=null,C33.clearArray(this._lutObjects),this._lutObjects=null}GetType(){return"cubic-bezier"}GetIndex(){return this._index}GetStepCount(){return Math.floor(this._length/BEZIER_STEP_SIZE)}GetStepIncrement(){return 1/this.GetStepCount()}SetOrigin(e,t){this._originX=e,this._originY=t,this._arcLengths=new Array(this._len+1),this._arcLengths[0]=0,this._CalculateLength(),this._aXO=this._aX+this._originX,this._aYO=this._aY+this._originY,this._bXO=this._bX+this._originX,this._bYO=this._bY+this._originY,this._cXO=this._cX+this._originX,this._cYO=this._cY+this._originY,this._dXO=this._dX+this._originX,this._dYO=this._dY+this._originY,this._d0x=3*(this._bXO-this._aXO),this._d0y=3*(this._bYO-this._aYO),this._d1x=3*(this._cXO-this._bXO),this._d1y=3*(this._cYO-this._bYO),this._d2x=3*(this._dXO-this._cXO),this._d2y=3*(this._dYO-this._cYO),this._x1Factor=3*(this._bXO-this._aXO),this._x2Factor=3*(this._aXO+this._cXO-2*this._bXO),this._x3Factor=this._dXO-this._aXO+3*(this._bXO-this._cXO),this._y1Factor=3*(this._bYO-this._aYO),this._y2Factor=3*(this._aYO+this._cYO-2*this._bYO),this._y3Factor=this._dYO-this._aYO+3*(this._bYO-this._cYO)}Map(e){if(!this._initialized)return NaN;const t=this._Map(e);return MAP_RESULT[0]=this._X(t),MAP_RESULT[1]=this._Y(t),MAP_RESULT}Project(e,t){const s=this._GenerateLUT(STEPS),n=this._FindClosestFromLUT(e,t,s),i=this._RefineProjection(e,t,s,n);return PROJECTION_RESULT[0]=i.x,PROJECTION_RESULT[1]=i.y,PROJECTION_RESULT[2]=i.t,PROJECTION_RESULT[3]=i.distance,PROJECTION_RESULT}ProjectWithRange(e,t,s){const n=this._GenerateLUT(STEPS),i=this._FindClosestFromLUTWithRange(e,t,n,s),r=this._RefineProjection(e,t,n,i);return PROJECTION_RESULT[0]=r.x,PROJECTION_RESULT[1]=r.y,PROJECTION_RESULT[2]=r.t,PROJECTION_RESULT[3]=r.distance,PROJECTION_RESULT}Tangent(e){const t=1-e,s=t*t,n=2*t*e,i=e*e,r=s*this._d0x+n*this._d1x+i*this._d2x,a=s*this._d0y+n*this._d1y+i*this._d2y,o=Math.hypot(r,a);return TANGENT_RESULT[0]=r/o,TANGENT_RESULT[1]=a/o,TANGENT_RESULT}TangentAngle(e){const t=1-e,s=t*t,n=2*t*e,i=e*e,r=s*this._d0x+n*this._d1x+i*this._d2x,a=s*this._d0y+n*this._d1y+i*this._d2y;return Math.atan2(a,r)}_Map(i){if(this._initialized){let e=i*this._arcLengths[this._len],t=0,s=this._len,n=0;for(;t<s;)n=t+((s-t)/2|0),this._arcLengths[n]<e?t=n+1:s=n;this._arcLengths[n]>e&&n--;const r=this._arcLengths[n];return r===e?n/this._len:(n+(e-r)/(this._arcLengths[n+1]-r))/this._len}}_X(e){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(e,this._aX+this._originX,this._bX+this._originX,this._cX+this._originX,this._dX+this._originX):NaN}_Y(e){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(e,this._aY+this._originY,this._bY+this._originY,this._cY+this._originY,this._dY+this._originY):NaN}_GenerateLUT(t){if(t=t||STEPS,!(this._lut.length>=t)){this._lut=new Array(t),t++;for(let e=0;e<t-1;e++){const s=e/(t-1),n=s**2,i=s**3,r=this._x1Factor*s,a=this._x2Factor*n,o=this._x3Factor*i,l=this._y1Factor*s,h=this._y2Factor*n,c=this._y3Factor*i,u=this._aXO+r+a+o,d=this._aYO+l+h+c;this._lutObjects[e].x=u,this._lutObjects[e].y=d,this._lutObjects[e].t=s,this._lutObjects[e].distance=0,this._lut[e]=this._lutObjects[e]}}return this._lut}_FindClosestFromLUT(t,s,n,e=0,i=Number.MAX_SAFE_INTEGER){let r=0;if(isNaN(this._lutIndex))for(let e=0;e<STEPS;e++){const a=n[e],o=a.x-t,l=a.y-s;a.distance=o*o+l*l,a.distance<i&&(i=a.distance,r=e)}else{for(let e=this._lutIndex;e<this._lutIndex+LOOKUP_STEPS_FROM_LAST&&!(e>=n.length);e++){const h=n[e],c=h.x-t,u=h.y-s;h.distance=c*c+u*u,h.distance<i&&(i=h.distance,r=e)}for(let e=this._lutIndex;e>this._lutIndex-LOOKUP_STEPS_FROM_LAST&&!(e<0);e--){const d=n[e],_=d.x-t,p=d.y-s;d.distance=_*_+p*p,d.distance<i&&(i=d.distance,r=e)}}return this._lutIndex=r}_FindClosestFromLUTWithRange(t,s,n,i,r=Number.MAX_SAFE_INTEGER){let a=0;if(isNaN(this._lutIndex))for(let e=0;e<STEPS;e++){const o=n[e],l=o.x-t,h=o.y-s;o.distance=l*l+h*h,o.t>=i[0]&&o.t<=i[1]&&o.distance<r&&(r=o.distance,a=e)}else{for(let e=this._lutIndex;e<this._lutIndex+LOOKUP_STEPS_FROM_LAST&&!(e>=n.length);e++){const c=n[e],u=c.x-t,d=c.y-s;c.distance=u*u+d*d,c.t>=i[0]&&c.t<=i[1]&&c.distance<r&&(r=c.distance,a=e)}for(let e=this._lutIndex;e>this._lutIndex-LOOKUP_STEPS_FROM_LAST&&!(e<0);e--){const _=n[e],p=_.x-t,m=_.y-s;_.distance=p*p+m*m,_.t>=i[0]&&_.t<=i[1]&&_.distance<r&&(r=_.distance,a=e)}}return this._lutIndex=a}_RefineProjection(a,o,l,h){let c=l[h],e=1,u=Number.MAX_SAFE_INTEGER;e:do{let e=l.length,t=0===h?0:h-1,s=h===e-1?e-1:h+1,n=l[t].t,i=l[s].t,r=(i-n)/4;if(r<.001)break;REFINE_LUT[0]=l[t];for(let e=1;e<=2;e++){const d=n+e*r,_=d**2,p=d**3,m=this._x1Factor*d,g=this._x2Factor*_,f=this._x3Factor*p,S=this._y1Factor*d,y=this._y2Factor*_,C=this._y3Factor*p,G=this._aXO+m+g+f,T=this._aYO+S+y+C,I=G-a,b=T-o,A=I*I+b*b;if(A<u){u=A,h=e,REFINE_RESULT.x=G,REFINE_RESULT.y=T,REFINE_RESULT.t=d,REFINE_RESULT.distance=A,c=REFINE_RESULT;break e}const P=REFINE_LUT_OBJECTS[e-1];P.x=G,P.y=T,P.t=d,P.distance=A,REFINE_LUT[e]=P}REFINE_LUT[3]=l[s],l=REFINE_LUT}while(e++<REFINE_ITERATIONS);return c}_CalculateLength(){this._initialized=!0;let t=this._X(0),s=this._Y(0),n=0;for(let e=1;e<=this._len;e++){const i=this._X(e*LENGTH_STEP_SIZE),r=this._Y(e*LENGTH_STEP_SIZE),a=t-i,o=s-r;n+=Math.hypot(a,o),this._arcLengths[e]=n,t=i,s=r}this._length=n}},C33.TimelineLineSegmentInfo=class{constructor(e,t,s){this._index=s,this._targetX=e.GetValueWithResultMode(),this._targetY=t.GetValueWithResultMode(),this._originX=0,this._originY=0}Release(){}GetType(){return"line"}GetIndex(){return this._index}SetOrigin(e,t){this._originX=e,this._originY=t}GetX(){return this._targetX+this._originX}GetY(){return this._targetY+this._originY}}}{const C33=self.C3,PING_PONG_BEGIN=0,PING_PONG_END=1;C33.TimelineState=class extends C33.DefendedBase{constructor(e,t,s){super(),this._runtime=s.GetRuntime(),this._timelineManager=s,this._timelineDataItem=t,this._name=e,this._tracks=[],this._tracksLength=0,this._beforeAndAfterTracks=null,this._beforeAndAfterTracksLength=0,this.CreateTrackStates(),this._playPromise=null,this._playResolve=null,this._playheadTime=0,this._overshoot=0,this._playbackRate=1,this._pingPongState=PING_PONG_BEGIN,this._currentRepeatCount=1,this._isPlaying=!1,this._isScheduled=!1,this._initialStateSet=!1,this._complete=!0,this._released=!1,this._markedForRemoval=!1,this._completedTick=-1,this._implicitPause=!1,this._isTemplate=!1,this._finishedTriggers=!1,this._firstTick=!1,this._lastDelta=NaN,this._tags=[""],this._stringTags="",this._tagsChanged=!1,this._renderChange=0,this._hasNestedContent=0,this._iTimelineState=null}static CreateInitial(e,t){const s=t.GetTimelineDataManager(),n=s.GetNameId(),i=s.Get(e[n]),r=C33.New(C33.TimelineState,e[n],i,t);return r.SetIsTemplate(!0),r}static CreateFromTemplate(e,t,s){return C33.New(C33.TimelineState,e,t,s)}Release(){if(!this.IsReleased()){const e=this._runtime.Dispatcher();this._timelineManager.DeScheduleTimeline(this),this._timelineManager.CompleteTimelineAndResolve(this);for(const t of this._tracks)t.Release();C33.clearArray(this._tracks),this._tracks=null,this._runtime=null,this._timelineManager=null,this._timelineDataItem=null,this._released=!0,this._playPromise=null,this._playResolve=null,this.FireReleaseEvent(e)}}FireReleaseEvent(e){const t=C33.New(C33.Event,"timelinestatereleased");t.timelineState=this,e.dispatchEvent(t)}GetType(){return 0}CreateTrackStates(){for(const e of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=this._tracks.push(C33.TrackState.Create(this,e))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(n,i,r,a){if(this._hasNestedContent){let s;for(let t=0;t<this._tracks.length;t++){let e=this._tracks[t];if(n===e.GetInstance()){const o=e.GetPropertyTrack(r);o&&i.constructor===o.GetSourceAdapter().constructor&&o.GetResultMode()===a.GetResultMode()&&(s=s||[]).push(o)}}return s}}HasTracks(){return!!this._tracks.length}GetTrackById(e){for(const t of this._tracks)if(C33.equalsNoCase(t.GetId(),e))return t;return null}GetTrackByName(e){for(const t of this._tracks)if(!t.IsInstanceTrack()&&C33.equalsNoCase(t.GetName(),e))return t;return null}SetName(e){this._name=e}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(e){this._timelineDataItem.SetTotalTime(e)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(e){this._timelineDataItem.SetStep(e)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._timelineDataItem.SetInterpolationMode(e)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(e){this._timelineDataItem.GetResultMode(e)}SetEase(e){for(const t of this.GetTracks())t.SetEase(e)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(e){return this._timelineDataItem.SetLoop(e)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(e){return this._timelineDataItem.SetPingPong(e)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetRepeatCount(e){return this._timelineDataItem.SetRepeatCount(e)}SetPlaybackRate(e){return this._playbackRate=e}GetPlaybackRate(){return this._playbackRate}GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout()}GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph()}GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale()}GetPingPongState(){return this._pingPongState}IsForwardPlayBack(){return!this.IsPlaying()||0<this._playbackRate}GetPlayPromise(){return this._playPromise||(this._playPromise=new Promise(e=>{this._playResolve=e})),this._playPromise}ResolvePlayPromise(){this._playPromise&&(this._playResolve(),this._playPromise=null,this._playResolve=null)}SetTags(e){this._tags=C33.TimelineState._GetTagArray(e),this._tagsChanged=!0}GetTags(){return this._tags}GetStringTags(){return this._tagsChanged&&(this._stringTags=this._tags.join(" ")),this._tagsChanged=!1,this._stringTags}HasTags(e){if(!this._tags)return!1;if(!this._tags.length)return!1;const t=C33.TimelineState._GetTagArray(e);return!!t&&!!t.length&&t.every(C33.TimelineState._HasTag,this)}OnStarted(){C33.Plugins.Timeline&&this.constructor===C33.TimelineState&&(C33.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineStarted),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineStartedByName),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineStartedByTags),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnAnyTimelineStarted),C33.Plugins.Timeline.Cnds.PopTriggerTimeline())}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){this._finishedTriggers||(this._finishedTriggers=!0,C33.Plugins.Timeline&&this.constructor===C33.TimelineState&&(C33.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineFinished),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineFinishedByName),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimelineFinishedByTags),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnAnyTimelineFinished),C33.Plugins.Timeline.Cnds.PopTriggerTimeline()))}SetPlaying(e){this._isPlaying=e}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(e=!1){return!!this.IsCompletedTick()||!(!this.IsScheduled()||e)||this._isPlaying}_IsPlaying(){return this.IsPlaying(!0)}IsPaused(){return this._IsPaused()}_IsPaused(){return!(this.IsReleased()||this.IsScheduled()||this._IsPlaying()||this.IsComplete())}SetScheduled(e){this._isScheduled=e}IsScheduled(){return this._isScheduled}SetComplete(e){this._complete=e;const t=this.GetTime();(t<=0||t>=this.GetTotalTime())&&(this._complete=!0)}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(e){this._markedForRemoval=e}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(e){this._implicitPause=e}IsImplicitPause(){return this._implicitPause}SetIsTemplate(e){this._isTemplate=!!e}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(e){const t=this.GetTime();this._SetTime(e),this.SetComplete(!1),this.IsComplete()||this.SetImplicitPause(!0),!this._IsPlaying()&&!this.IsScheduled()&&this._initialStateSet||(this._IsPlaying()||this.IsScheduled()||this._initialStateSet?this._IsPlaying()?this.Stop():this.IsScheduled()&&(this._timelineManager.DeScheduleTimeline(this),this.SetInitialStateFromSetTime()):this.SetInitialStateFromSetTime()),this._SetUpdateStateBefore(),this._Interpolate(this.GetTime(),!1,!0,!0,t),this._SetUpdateStateAfter(),this._renderChange&&this.GetRuntime().UpdateRender(),this._OnSetTime()}_SetTime(e){(e=C33.IsFiniteNumber(e)?e:this.GetTotalTime())<0?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e}_SetTimeAndReset(e){(e=C33.IsFiniteNumber(e)?e:this.GetTotalTime())<0?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e;for(const t of this._tracks)t.SetResetState()}_OnSetTime(){C33.Plugins.Timeline&&this.constructor===C33.TimelineState&&(C33.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimeSet),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimeSetByName),this._timelineManager.Trigger(C33.Plugins.Timeline.Cnds.OnTimeSetByTags),C33.Plugins.Timeline.Cnds.PopTriggerTimeline())}_CanResume(){if(!this.GetLoop())if(this.GetPingPong()&&this._pingPongState===PING_PONG_END){if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(this.GetTime()<=0)return!1}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(this.GetTime()<=0)return!1;return!0}Resume(){this.IsReleased()||this._CanResume()&&this.Play(!0)}Play(e=!1){return!this.IsReleased()&&!this.IsScheduled()&&(this._IsPlaying()&&this.IsCompletedTick()?this._SchedulePlayingTimeline():!this._IsPlaying()&&!!(this.IsComplete()||e||this.IsImplicitPause())&&this._ScheduleStoppedTimeline())}_SchedulePlayingTimeline(){return this.SetImplicitPause(!1),this._timelineManager.RemovePlayingTimeline(this),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}_ScheduleStoppedTimeline(){return this.SetImplicitPause(!1),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}Stop(e=!1){this.IsReleased()||(this.SetComplete(e),this._timelineManager.CompleteTimeline(this),this.IsComplete()&&this.ResolvePlayPromise())}Reset(e=!0,t=!1){if(!this.IsReleased()){if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(!this.IsComplete()){this.Stop(!0),this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime());const s=this.GetTime();this._SetUpdateStateBefore(),t?this._InterpolateBeforeChangeLayout(s):this._Interpolate(s,!1,!1,!0),e&&this._OnSetTime(),this._SetUpdateStateAfter(),this._renderChange&&e&&this.GetRuntime().UpdateRender()}}}ResetBeforeChangeLayout(){this.Reset(!1,!0)}_InterpolateBeforeChangeLayout(e){this._Interpolate(e,!1,!1,!0,NaN,!1,!0)}_OnBeforeChangeLayout(){if(!this.IsReleased()){if(!this.GetRuntime().IsLoadingState()&&this.HasValidGlobalTracks())return!1;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.GetRuntime().IsLoadingState()||this.ResetBeforeChangeLayout()}return!0}SetInitialStateFromSetTime(){this.SetInitialState(!0)}SetInitialStateForce(){this.SetInitialState(!1,!0),this.SetPlaying(!1),this.SetScheduled(!1)}SetInitialState(e=!1,t=!1){if(!this.IsMarkedForRemoval()||t){if(e){this._finishedTriggers=!1,this._initialStateSet=!0,this._firstTick=!0,this._SetUpdateStateBefore();for(const s of this._tracks)s.SetInitialState()}else if(this.SetPlaying(!0),this.SetScheduled(!1),this.OnStarted(),this.IsComplete()){this._completedTick=-1,this._pingPongState!==PING_PONG_BEGIN&&(this._playbackRate=Math.abs(this._playbackRate)),this._pingPongState=PING_PONG_BEGIN,this._currentRepeatCount=1,this._complete=!1,this._finishedTriggers=!1,this._initialStateSet=!0,this._firstTick=!0,this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime()),this._SetUpdateStateBefore();for(const n of this._tracks)n.SetInitialState()}else{this._firstTick=!0,this._finishedTriggers=!1,this._SetUpdateStateBefore();for(const i of this._tracks)i.SetResumeState()}this._SetUpdateStateAfter()}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(const e of this._tracks)e.IsNested()&&(this._hasNestedContent=1)}_SetUpdateStateAfter(){this._renderChange=0;for(const e of this._tracks)e._SetUpdateState(),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1),this._beforeAndAfterTracks||1!==e.GetNeedsBeforeAndAfter()||(this._beforeAndAfterTracks||(this._beforeAndAfterTracks=[]),this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(e))}Tick(e,t,s){if(this.GetUseSystemTimescale()){if(0===e&&0===this._lastDelta)return;this._lastDelta=e,e=s}else{if(0===s&&0===this._lastDelta)return;e=this._lastDelta=s,t=1}const n=this._playheadTime+this._overshoot,i=e*t*this._playbackRate,r=n+i,a=this._timelineDataItem._totalTime;r<0?(this._playheadTime=0,this._overshoot=-r):a<=r?(this._playheadTime=a,this._overshoot=this._playheadTime-r):(this._playheadTime=r,this._overshoot=0);let o=!1,l=!1,h=this.GetLoop(),c=this.GetPingPong();h||c?h&&!c?0<this._playbackRate?this._playheadTime>=a&&(this._SetTimeAndReset(0),l=!0):this._playheadTime<=0&&(this._SetTimeAndReset(a),l=!0):!h&&c?0<this._playbackRate?this._playheadTime>=a&&(this._SetTime(a),this.SetPlaybackRate(-1*this.GetPlaybackRate()),l=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=PING_PONG_BEGIN):o=!0:this._pingPongState===PING_PONG_BEGIN&&(this._pingPongState=PING_PONG_END)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),l=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=PING_PONG_BEGIN):o=!0:this._pingPongState===PING_PONG_BEGIN&&(this._pingPongState=PING_PONG_END)):h&&c&&(0<this._playbackRate?this._playheadTime>=a&&(this._SetTime(a),this.SetPlaybackRate(-1*this.GetPlaybackRate()),l=!0,this._pingPongState++,C33.wrap(this._pingPongState,0,2)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),l=!0,this._pingPongState++,C33.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=a&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),l=!0):(this._SetTime(a),o=!0)):this._playheadTime<=0&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(a),l=!0):(this._SetTime(0),o=!0));let u,d=this._tracksLength;if(o){for(u=0;u<d;u++)this._tracks[u].SetEndState();this.Stop(!0),this.OnCompleted()}else{const _=this._beforeAndAfterTracksLength;for(u=0;u<_;u++)this._beforeAndAfterTracks[u].BeforeInterpolate();if(1===this._hasNestedContent)for(u=0;u<d;u++){const p=this._tracks[u],m=p.GetStartOffset(),g=this._playheadTime-m,f=n-m;g<0&&0<f?(this._playheadTime=m<0?0:a<=m?a:m,p.Interpolate(m,!0,!1,l,this._firstTick,!1)):p.Interpolate(this._playheadTime,!0,!1,l,this._firstTick,!1)}else for(u=0;u<d;u++)this._tracks[u].Interpolate(this._playheadTime,!0,!1,l,this._firstTick,!1);for(u=0;u<_;u++)this._beforeAndAfterTracks[u].AfterInterpolate();this._firstTick&&(this._firstTick=!1)}}_Interpolate(t,s=!1,n=!1,i=!1,r=NaN,e=!1,a=!1){for(const o of this._tracks)o.BeforeInterpolate();for(const l of this._tracks){let e=t;if("number"==typeof r&&!isNaN(r)){const h=this.GetTime(),c=h-l.GetStartOffset(),u=r-l.GetStartOffset();c<0&&0<u&&(e=l.GetStartOffset(),this._SetTime(e))}l.Interpolate(e,s,n,i,this._firstTick,a)}for(const d of this._tracks)d.AfterInterpolate();this._firstTick&&e&&(this._firstTick=!1)}AddTrack(){const e=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem(),t=C33.TrackState.Create(this,e);return this._tracksLength=this._tracks.push(t),t}Removed(){if(!this.IsReleased())for(const e of this._tracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._tracks)e.CleanCaches()}ClearTrackInstances(){for(const e of this._tracks)e.ClearInstance()}SetTrackInstance(e,t,s){if(t){if("number"==typeof s&&0<=s){const n=this._tracks[s];return n?(n.SetInstance(t),void this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this)):void 0}for(const i of this._tracks)if(i.IsInstanceTrack())if(e){if(i.GetId()===e){i.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}else if(!i.HasInstance()){i.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}}HasTrackInstance(e,t){for(const s of this._tracks)if(s.IsInstanceTrack())if(t){if(t===s.GetId()&&e===s.GetInstance())return!0}else if(e===s.GetInstance())return!0;return!1}HasValidTracks(){return this._tracks.some(e=>!e.IsInstanceTrack()||e.CanInstanceBeValid())}HasValidGlobalTracks(){return this._tracks.some(e=>{if(e.IsInstanceTrack()){if(!e.CanInstanceBeValid())return!1;const t=e.GetObjectClass();return!!t&&t.IsGlobal()}return!1})}GetPropertyTrack(e){for(const t of this.GetTracks())for(const s of t.GetPropertyTracks())if(s.GetPropertyName()===e)return s}GetTrackFromInstance(e){for(const t of this._tracks)if(e===t.GetInstance())return t;return null}GetKeyframeWithTags(e){let t=e?e.split(" "):[],s=new Set(t.map(e=>e.toLowerCase().trim()));t=[...s.values()];for(const n of this.GetTracks())for(const i of n.GetKeyframeDataItems()){const r=t.every(e=>i.HasTag(e));if(r)return i}}GetObjectClasses(){const e=[];for(const t of this.GetTracks())e.push(t.GetObjectClass());return e.filter(e=>e)}_OnAfterLoad(){for(const e of this.GetTracks())e._OnAfterLoad()}_SaveToJson(){return{tracksJson:this._SaveTracksToJson(),name:this._name,playheadTime:this.GetTime(),playbackRate:this._playbackRate,pingPongState:this._pingPongState,currentRepeatCount:this._currentRepeatCount,isPlaying:this._isPlaying,isScheduled:this._isScheduled,initialStateSet:this._initialStateSet,finishedTriggers:this._finishedTriggers,complete:this._complete,released:this._released,markedForRemoval:this._markedForRemoval,completedTick:this._completedTick,implicitPause:this._implicitPause,isTemplate:this._isTemplate,tags:this._tags.join(" "),stringTags:this._stringTags,tagsChanged:this._tagsChanged,firstTick:this._firstTick}}_LoadFromJson(e){e&&(this._LoadTracksFromJson(e.tracksJson),this._name=e.name,this._playheadTime=e.playheadTime,this._playbackRate=e.playbackRate,this._pingPongState=e.pingPongState,this._currentRepeatCount=e.currentRepeatCount,this._isPlaying=!!e.isPlaying,this._isScheduled=!!e.isScheduled,this._initialStateSet=!!e.initialStateSet,this._finishedTriggers=!!e.hasOwnProperty("finishedTriggers")&&!!e.finishedTriggers,this._complete=!!e.complete,this._released=!!e.released,this._markedForRemoval=!!e.markedForRemoval,this._completedTick=e.completedTick,this._implicitPause=!!e.implicitPause,this._isTemplate=!!e.isTemplate,this._tags=e.tags.split(" "),this._stringTags=e.stringTags,this._tagsChanged=!!e.tagsChanged,this._firstTick=!!e.firstTick)}_SaveTracksToJson(){return this._tracks.map(e=>e._SaveToJson())}_LoadTracksFromJson(e){this.ClearTrackInstances(),e.forEach((e,t)=>{const s=this._tracks[t];s._LoadFromJson(e)}),this._tracks.filter(e=>e.CanInstanceBeValid())}static _HasTag(e){const t=this.GetTags();return""===e?1===t.length&&""===t[0]:t.map(e=>e.toLowerCase()).includes(e.toLowerCase())}static _GetTagArray(e){if(C33.IsArray(e))return e.slice(0);if(C33.IsString(e))return e.split(" ");throw new Error("invalid tags")}GetITimelineState(){return this._iTimelineState||(this._iTimelineState=C33.New(self.ITimelineState,this)),this._iTimelineState}}}{const C33=self.C3,INSTANCE_TRACK=0,VALUE_TRACK=1,AUDIO_TRACK=2;C33.TrackState=class extends C33.DefendedBase{constructor(e,t){super(),this._timeline=e,this._trackDataItem=t,this._trackData=t.GetTrackData(),this._instanceUid=NaN,this._objectClassIndex=NaN,this._instance=null,this._worldInfo=null,this._cleared=!1,this._isNested=0<t.GetStartOffset(),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this._instanceUidToLoad=NaN,this._lastKeyframeDataItem=null,this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray(),this._propertyTracks=[],this.CreatePropertyTrackStates(),this._worldInfoChange=0,this._renderChange=0,this._needsBeforeAndAfter=0}static Create(e,t){return C33.New(C33.TrackState,e,t)}Release(){this._keyframeDataItems=null;for(const e of this._propertyTracks)e.Release();C33.clearArray(this._propertyTracks),this._propertyTracks=null,this._timeline=null,this._instance=null,this._worldInfo=null,this._trackDataItem=null,this._lastKeyframeDataItem=null}CreatePropertyTrackStates(){for(const e of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C33.PropertyTrackState.Create(this,e))}TimelineRemoved(){for(const e of this._propertyTracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._propertyTracks)e.CleanCaches();this._instance=null,this._worldInfo=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){return this._keyframeDataItems||(this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()),this._keyframeDataItems}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(t){for(let e=0;e<this._propertyTracks.length;e++){const s=this._propertyTracks[e];if(s.GetPropertyName()===t)return s}}MaybeGetInstance(){this._instance||this.GetInstance()}IsInstanceValid(){return!!this._instance&&!this._instance.IsDestroyed()}CanInstanceBeValid(){if(!this.IsInstanceTrack())return!1;const e=this.GetInstanceUID(),t=this.GetRuntime().GetInstanceByUID(e);return!!t&&!t.IsDestroyed()}GetObjectClass(){if(this.IsInstanceTrack()){const e=this.GetObjectClassIndex();if(-1!==e)return this.GetRuntime().GetObjectClassByIndex(e)}}GetTrackIndexInTimeline(){return this._timeline.GetTracks().indexOf(this)}ClearInstance(){this._instance=null,this._instanceUid=NaN,this._worldInfo=null,this._objectClassIndex=NaN,this._cleared=!0}HasInstance(){return!!this._instance}GetInstance(){if(!this._cleared){if(!this._instance||!this.IsInstanceValid()){const e=this.GetInstanceUID();this._instance=this.GetRuntime().GetInstanceByUID(e)}return this._instance}}SetInstance(e){if(this._cleared=!1,this._instance!==e){this.CleanCaches(),this._instance=e,this._objectClassIndex=e.GetObjectClass().GetIndex(),this._instanceUid=e.GetUID(),this._worldInfo=e.GetWorldInfo();for(const t of this.propertyTrackItems()){const s=t.propertyTrack,n=t.sourceAdapter,i=s.GetSourceAdapterId();switch(i){case"instance-variable":{n.GetEditorIndex();const r=e.GetObjectClass(),a=r.GetInstanceVariableIndexByName(t.name),o=r.GetInstanceVariableName(a),l=r.GetInstanceVariableType(a);o===t.name&&l===t.type&&n.UpdateInstanceVariableIndex(a);break}case"behavior":{const h=t.behaviorType,c=this.GetObjectClass(),u=e.GetObjectClass(),d=n.GetBehaviorType(u);if(h&&d){const _=h.GetName();c.GetBehaviorIndexByName(_),u.GetBehaviorIndexByName(_),n.GetEditorIndex(),n.UpdateBehaviorTypeSid(d.GetSID())}break}}}}}*propertyTrackItems(){for(const e of this._propertyTracks){const t=e.GetSourceAdapter(),s=this.GetObjectClass(),n={propertyTrack:e,sourceAdapter:t};switch(e.GetSourceAdapterId()){case"world-instance":n.property=e.GetPropertyName();break;case"instance-variable":{const i=t.GetEditorIndex();n.name=s.GetInstanceVariableName(i),n.type=s.GetInstanceVariableType(i);break}case"effect":{const r=s.GetEffectList(),a=t.GetEffectType(r);n.effectType=a;break}case"behavior":{const o=t.GetBehaviorType(s);n.behaviorType=o;break}case"plugin":n.plugin=s.GetPlugin()}yield n}}GetWorldInfo(){if(!this._worldInfo||!this.IsInstanceValid()){const e=this.GetInstance();e&&(this._worldInfo=e.GetWorldInfo())}return this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){return isNaN(this._instanceUid)?this._trackDataItem.GetInstanceUID():this._instanceUid}SetInstanceUID(e){this._trackDataItem.SetInstanceUID(e)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._trackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(e){this._trackDataItem.SetLocalTotalTime(e)}SetResultMode(e){this._trackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetKeyframeDataItems())t.SetEase(e);for(const s of this.GetPropertyTracks())s.SetEase(e)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(e){this._trackDataItem.SetEnable(e)}GetObjectClassIndex(){return isNaN(this._objectClassIndex)?this._trackDataItem.GetObjectClassIndex():this._objectClassIndex}SetObjectClassIndex(e){this._trackDataItem.SetObjectClassIndex(e)}SetOriginalWidth(e){this._trackDataItem.SetOriginalWidth(e)}GetOriginalWidth(){const e=this.GetInstance();if(e){const t=e.GetSdkInstance();if(t.IsOriginalSizeKnown())return e.GetSdkInstance().GetOriginalWidth()}return this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(e){this._trackDataItem.SetOriginalHeight(e)}GetOriginalHeight(){const e=this.GetInstance();if(e){const t=e.GetSdkInstance();if(t.IsOriginalSizeKnown())return e.GetSdkInstance().GetOriginalHeight()}return this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return this.GetType()===INSTANCE_TRACK}IsValueTrack(){return this.GetType()===VALUE_TRACK}IsAudioTrack(){return this.GetType()===AUDIO_TRACK}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetResetState(){for(const e of this._propertyTracks)e.SetResetState()}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){const e=this.GetTimeline(),t=e.IsForwardPlayBack(),s=t?0:this.GetLocalTotalTime();for(const i of this._propertyTracks)i.SetInitialState(s),0===this._worldInfoChange&&1===i.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===i.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;const n=this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter());n&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(s),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this.Interpolate(s),this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(s))}}SetResumeState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){this._timeline.IsForwardPlayBack();const e=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e);for(const t of this._propertyTracks)t.SetResumeState(e)}}SetEndState(){if(!this.GetTimeline().IsComplete()&&(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack())&&!this._isNested){const e=this._timeline.GetTime(),t=this.GetStartOffset()+this.GetLocalTotalTime();t<=e?this.Interpolate(this.GetLocalTotalTime(),!0,!1,!0,!1,!1,!0):e<=0&&this.Interpolate(0,!0,!1,!0,!1,!1,!0)}}_SetUpdateState(){for(let e=0,t=this._propertyTracks.length;e<t;e++){const s=this._propertyTracks[e];s._SetUpdateState(),0===this._worldInfoChange&&1===s.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===s.GetRenderChange()&&(this._renderChange=1)}}BeforeInterpolate(){const t=this._propertyTracks.length;for(let e=0;e<t;e++)this._propertyTracks[e].BeforeInterpolate()}Interpolate(s,e=!1,n=!1,i=!1,t=!1,r=!1,a=!1){this._instance||this.GetInstance();const o=this._instance&&!this._instance.IsDestroyed(),l=this._trackDataItem._type===INSTANCE_TRACK;if((o||!l)&&!(r&&l&&this.GetObjectClass().IsGlobal()||(s-=this.GetStartOffset())<0)){this.MaybeSetInitialStateOfNestedTrack(s,e),this.MaybeTriggerKeyframeReachedConditions(s,e,t);for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].Interpolate(s,n,i,a);this.MaybeSetEndStateOfNestedTrack(s,e),0!==this._worldInfoChange&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo)&&this._worldInfo.SetBboxChanged()}}AfterInterpolate(){const t=this._propertyTracks.length;for(let e=0;e<t;e++)this._propertyTracks[e].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._initialStateOfNestedSet){const s=this.GetTimeline();if(s.IsForwardPlayBack()){if(e<0)return}else if(e>this.GetLocalTotalTime())return;for(const n of this._propertyTracks)n.SetInitialState();this._initialStateOfNestedSet=!0}}MaybeSetEndStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._endStateOfNestedSet){const s=this.GetTimeline();if(s.IsForwardPlayBack()){if(e>=this.GetLocalTotalTime()){for(const n of this._propertyTracks)n.Interpolate(this.GetLocalTotalTime(),!1,!0);this._endStateOfNestedSet=!0}}else if(e<=0){for(const i of this._propertyTracks)i.Interpolate(0,!1,!0);this._endStateOfNestedSet=!0}}}MaybeTriggerKeyframeReachedConditions(e,t,s){if(!s&&t&&C33.Plugins.Timeline){const n=this.GetTimeline(),i=this._lastKeyframeDataItem.GetNext(),r=this._lastKeyframeDataItem.GetTime(),a=i?i.GetTime():n.GetTotalTime();if(e<=r||a<=e)if(this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem),n.IsForwardPlayBack())i&&this.OnKeyframeReached(this._lastKeyframeDataItem);else{const o=this._lastKeyframeDataItem.GetNext();o&&this.OnKeyframeReached(o)}}}_GetLastKeyFrameBeforeTime(e){const t=this._trackData.GetKeyFrameDataItemAtTime(e,this._trackDataItem);return t||this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem)}OnKeyframeReached(e){if(C33.Plugins.Timeline){const t=this.GetTimeline(),s=t.GetTimelineManager();C33.Plugins.Timeline.Cnds.PushTriggerTimeline(t),C33.Plugins.Timeline.Cnds.PushTriggerKeyframe(e),s.Trigger(C33.Plugins.Timeline.Cnds.OnAnyKeyframeReached),s.Trigger(C33.Plugins.Timeline.Cnds.OnKeyframeReached),C33.Plugins.Timeline.Cnds.PopTriggerTimeline(t),C33.Plugins.Timeline.Cnds.PopTriggerKeyframe(e)}}AddKeyframe(){const e=this._trackDataItem.GetKeyframeData(),t=e.AddEmptyKeyframeDataItem();return t}AddPropertyTrack(){const e=this._trackDataItem.GetPropertyTrackData(),t=e.AddEmptyPropertyTrackDataItem(),s=C33.PropertyTrackState.Create(this,t);return this._propertyTracks.push(s),s}DeleteKeyframes(e){const t=this._trackDataItem.GetKeyframeData();t.DeleteKeyframeDataItems(e)}DeletePropertyKeyframes(e){for(const t of this._propertyTracks)t.DeletePropertyKeyframes(e)}SaveState(){for(const e of this._propertyTracks)e.SaveState()}CompareInitialStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack())for(const e of this._propertyTracks)e.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){let e=!1;for(const t of this._propertyTracks){const s=t.CompareSaveStateWithCurrent();!e&&s&&(e=!0)}if(e){const n=this.AddKeyframe();n.SetTime(this.GetTimeline().GetTime()),n.SetEase("noease"),n.SetEnable(!0),n.SetTags("")}}}_OnAfterLoad(){isNaN(this._instanceUidToLoad)||this._LoadInstanceFromJson(this._instanceUidToLoad),this._instanceUidToLoad=NaN}_SaveToJson(){const e=this.GetInstance(),t=e?e.GetUID():this.GetInstanceUID();return{propertyTracksJson:this._SavePropertyTracksToJson(),lastKeyframeDataItemJson:this._SaveLastKeyframeDataItemToJson(),initialStateOfNestedSet:this._initialStateOfNestedSet,endStateOfNestedSet:this._endStateOfNestedSet,instanceUid:t,cleared:this._cleared}}_LoadFromJson(e){if(e){this._LoadPropertyTracksFromJson(e.propertyTracksJson),this._LoadLastKeyframeDataItemFromJson(e.lastKeyframeDataItemJson),this._instanceUidToLoad=e.instanceUid,this._initialStateOfNestedSet=!1,e.hasOwnProperty.initialStateOfNestedSet&&(this._initialStateOfNestedSet=e.initialStateOfNestedSet),this._endStateOfNestedSet=!1,e.hasOwnProperty.endStateOfNestedSet&&(this._endStateOfNestedSet=e.endStateOfNestedSet),this._cleared=!!e.hasOwnProperty("cleared")&&e.cleared;for(const t of this._propertyTracks)0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1)}}_SaveLastKeyframeDataItemToJson(){const e=this._trackDataItem.GetKeyframeData();return e.GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map(e=>e._SaveToJson())}_LoadPropertyTracksFromJson(e){e.forEach((e,t)=>{const s=this._propertyTracks[t];s._LoadFromJson(e)})}_LoadInstanceFromJson(e){if(C33.IsFiniteNumber(e)){const t=this.GetRuntime().GetInstanceByUID(e);if(t){const s=this.GetTimeline();s.SetTrackInstance(this._trackDataItem.GetId(),t,this.GetTrackIndexInTimeline())}}}_LoadLastKeyframeDataItemFromJson(e){const t=this._trackDataItem.GetKeyframeData();this._lastKeyframeDataItem=t.GetKeyframeDataItemFromIndex(e)}}}{const C33=self.C3;C33.PropertyTrackState=class extends C33.DefendedBase{constructor(e,t){super(),this._track=e,this._propertyTrackDataItem=t,this._propertyTrackData=t.GetPropertyTrackData(),this._worldInfoChange=0,this._renderChange=0,this._needsBeforeAndAfter=0,this._sourceAdapter=this.GetSourceAdapter(),this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),this._lastPropertyKeyframeDataItem=null,this._absoluteValueObject=null}static Create(e,t){return C33.New(C33.PropertyTrackState,e,t)}Release(){this._track=null,this._sourceAdapter&&(this._sourceAdapter.Release(),this._sourceAdapter=null),this._propertyKeyframeDataItems=null,this._propertyTrackDataItem=null,this._propertyTrackData=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(e){this._absoluteValueObject=e}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(!this._sourceAdapter){let e=this._propertyTrackDataItem.GetSourceAdapterId(),t;switch(e){case"behavior":t=new C33.PropertyTrackState.BehaviorSourceAdapter(this);break;case"effect":t=new C33.PropertyTrackState.EffectSourceAdapter(this),this._renderChange=1;break;case"instance-variable":t=new C33.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case"plugin":t=new C33.PropertyTrackState.PluginSourceAdapter(this),this._renderChange=1;break;case"world-instance":t=new C33.PropertyTrackState.PropertySourceAdapter(this),this._renderChange=1,this._worldInfoChange=1;break;case"value":t=new C33.PropertyTrackState.ValueSourceAdapter(this);break;case"audio":t=new C33.PropertyTrackState.AudioSourceAdapter(this)}this._sourceAdapter=t}return this._sourceAdapter}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(e){this._propertyTrackDataItem.SetSourceAdapterId(e)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(e){this._propertyTrackDataItem.SetSourceAdapterArguments(e)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(e){this._propertyTrackDataItem.SetProperty(e)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(e){this._propertyTrackDataItem.SetType(e)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(e){this._propertyTrackDataItem.SetMin(e)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(e){this._propertyTrackDataItem.SetMax(e)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(e){this._propertyTrackDataItem.SetEnable(e)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._propertyTrackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(e){this._propertyTrackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetPropertyKeyframeDataItems())t.SetEase(e)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){return this._propertyKeyframeDataItems||(this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()),this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArrayIncludingDisabled()}GetPropertyKeyFrameDataItemAtTime(e){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem)}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem)}GetPropertyKeyframeDataItemPairForTime(e){let t=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem),s;return s=t?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(e,this._propertyTrackDataItem):(t=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem)),{start:t,end:s}}*GetPropertyKeyframeValues(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetValueWithResultMode()}*GetPropertyKeyframeTimes(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetTime()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetResetState(){this.GetSourceAdapter().SetResetState()}SetInitialState(e){this.GetSourceAdapter().SetInitialState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e),this._SetUpdateState()}SetResumeState(e){this.GetSourceAdapter().SetResumeState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e)}_SetUpdateState(){const e=this.GetTrack();if(this._needsBeforeAndAfter=0,e.IsInstanceTrack()){const t=this.GetTimeline(),s=e.GetInstance(),n=this.GetSourceAdapter(),i=this.GetPropertyName(),r=n.MayNeedBeforeAndAfterInterpolate();if(r){const a=t.GetSimilarPropertyTracks(s,n,i,this);a&&a.length&&(this._needsBeforeAndAfter=1)}else this._needsBeforeAndAfter=0}}_GetLastPropertyKeyFrameBeforeTime(e){const t=this.GetTimeline(),s=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return s||(t.IsForwardPlayBack()?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem))}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(e,t=!1,s=!1,n=!1){let i,r,a=!1;if(t)i=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){const o=this.GetTimeline(),l=this._lastPropertyKeyframeDataItem.GetNext(),h=this._lastPropertyKeyframeDataItem.GetTime(),c=l?l.GetTime():o.GetTotalTime();(e<=h||c<=e)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),a=!0)}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),a=!0;i=this._lastPropertyKeyframeDataItem}i&&(r=i.GetNext()),this._sourceAdapter.Interpolate(e,i,r,t,s,n,a)}GetInterpolatedValue(e){if(this._lastPropertyKeyframeDataItem){const n=this.GetTimeline(),i=this._lastPropertyKeyframeDataItem.GetNext(),r=this._lastPropertyKeyframeDataItem.GetTime(),a=i?i.GetTime():n.GetTotalTime();(e<=r||a<=e)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);const t=this._lastPropertyKeyframeDataItem,s=t.GetNext();return this._sourceAdapter.GetInterpolatedValue(e,t,s)}GetInterpolatedValueFast(e,t,s){return this._sourceAdapter.GetInterpolatedValue(e,t,s)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem(),n=t._propertyTrackData;return n.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,s)}static GetEndPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem(),n=t._propertyTrackData;return n.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,s)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData(),t=e.AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,t}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null;const t=this._propertyTrackDataItem.GetPropertyKeyframeData();t.DeletePropertyKeyframeDataItems(e)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){const e=this.GetSourceAdapter().CompareInitialStateWithCurrent();if(e){const t=this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem),s=this.GetSourceAdapter().GetCurrentState();t.SetAbsoluteValue(s)}}CompareSaveStateWithCurrent(){const e=this.GetSourceAdapter().CompareSaveStateWithCurrent();return e&&this.AddPropertyKeyframeAtCurrentTime(),this.GetSourceAdapter().ClearSaveState(),e}AddPropertyKeyframeAtCurrentTime(){const e=this.GetTimeline().GetTime(),t=this.GetSourceAdapter(),s=C33.PropertyTrackState.GetStartPropertyKeyframeForTime(e,this),n=this.AddPropertyKeyframe();n.SetType(s.GetType()),n.SetTime(e),n.SetEase(s.GetEase()),n.SetEnable(!0),n.SetValue(t.GetValueAtTime()),n.SetAbsoluteValue(t.GetCurrentState())}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson)}}}{const C33=self.C3,NS=C33.PropertyTrackState;NS.PropertySourceAdapter=class{constructor(e){this._propertyTrack=e,this._propertyAdapter=null,this.GetPropertyAdapter()}Release(){this._propertyAdapter&&(this._propertyAdapter.Release(),this._propertyAdapter=null),this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){this._propertyAdapter&&this._propertyAdapter.TimelineRemoved()}CleanCaches(){this._propertyAdapter&&this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){return this._propertyAdapter||(this._propertyAdapter=this._CreatePropertyAdapter()),this._propertyAdapter}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetResetState(){this.GetPropertyAdapter().SetResetState()}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(e,t,s,n,i,r,a){let o=this._propertyTrack.GetPropertyKeyframeType(),l;switch(o){case"numeric":l=NS.NumericTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"angle":l=NS.AngleTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"boolean":l=NS.BooleanTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"color":l=NS.ColorTypeAdapter.Interpolate(e,t,s,this._propertyTrack);break;case"text":l=NS.TextTypeAdapter.Interpolate(e,t,s,this._propertyTrack)}this._propertyAdapter.ChangeProperty(e,l,t,s,n,i,r,a)}GetInterpolatedValue(e,t,s){switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":return NS.NumericTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"angle":return NS.AngleTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"boolean":return NS.BooleanTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"color":return NS.ColorTypeAdapter.Interpolate(e,t,s,this._propertyTrack);case"text":return NS.TextTypeAdapter.Interpolate(e,t,s,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){const e=this._propertyTrack,t=e.GetTrack(),s=t.GetTimeline().GetTime(),n=NS.GetStartPropertyKeyframeForTime(s,e),i=n.GetNext(),r=e.GetPropertyKeyframeType();switch(r){case"numeric":return NS.NumericTypeAdapter.Interpolate(s,n,i,e);case"angle":return NS.AngleTypeAdapter.Interpolate(s,n,i,e);case"boolean":return NS.BooleanTypeAdapter.Interpolate(s,n,i,e);case"color":return NS.ColorTypeAdapter.Interpolate(s,n,i,e);case"text":return NS.TextTypeAdapter.Interpolate(s,n,i,e)}}_CreatePropertyAdapter(){const e=this._propertyTrack,t=e.CanHavePropertyKeyframes()?e.GetPropertyKeyframeType():"";switch(t){case"combo":case"boolean":case"text":case"string":return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);case"numeric":case"number":case"angle":return new("combo"===this._propertyTrack.GetPropertyType()?NS.PropertyInterpolationAdapter.NoInterpolationAdapter:NS.PropertyInterpolationAdapter.NumericInterpolationAdapter)(this);case"color":case"offsetColor":return new NS.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);default:return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}_SaveToJson(){return{propertyAdapterJson:this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetPropertyAdapter()._LoadFromJson(e.propertyAdapterJson)}}}{const C33=self.C3,INDEX=0;class InstanceVariableSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetIndex(){return this._updatedIndex||super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(e){const t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX];t!==e&&(this._updatedIndex=e)}Interpolate(e,t,s,n,i,r,a){this.GetPropertyAdapter().CanChange(t.GetValue())&&super.Interpolate(e,t,s,n,i,r,a)}GetInterpolatedValue(e,t,s){if(this.GetPropertyAdapter().CanChange(t.GetValue()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{index:this._updatedIndex})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._updatedIndex=e.index)}}C33.PropertyTrackState.InstanceVariableSourceAdapter=InstanceVariableSourceAdapter}{const C33=self.C3,SID=0,INDEX=1,NAME=2;class BehaviorSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._sid=NaN}GetEditorIndex(){const e=this._propertyTrack.GetPropertyTrackDataItem();return e.GetSourceAdapterArguments()[INDEX]}GetTarget(){const e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetTrack(),s=this._sid||e.GetSourceAdapterArguments()[SID],n=t.GetInstance(),i=n.GetBehaviorIndexBySID(s),r=n.GetBehaviorInstances()[i];return r.GetSdkInstance()}GetBehaviorType(e){const t=this._propertyTrack.GetPropertyTrackDataItem(),s=t.GetSourceAdapterArguments()[NAME];return e.GetBehaviorTypeByName(s)}UpdateBehaviorTypeSid(e){const t=this._propertyTrack.GetPropertyTrackDataItem();t.GetSourceAdapterArguments()[SID]!==e&&(this._sid=e)}Interpolate(e,t,s,n,i,r,a){const o=this._propertyTrack.GetTrack(),l=o.GetInstance();this.GetBehaviorType(l.GetObjectClass())&&super.Interpolate(e,t,s,n,i,r,a)}GetInterpolatedValue(e,t,s){const n=this._propertyTrack.GetTrack(),i=n.GetInstance();if(this.GetBehaviorType(i.GetObjectClass()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{sid:this._sid})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._sid=e.sid)}}C33.PropertyTrackState.BehaviorSourceAdapter=BehaviorSourceAdapter}{const C33=self.C3,NAME=0,INDEX=1;class EffectSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){const e=this._propertyTrack,t=e.GetTrack(),s=t.GetWorldInfo(),n=s.GetInstanceEffectList(),i=n.GetEffectList(),r=this.GetEffectType(i),a=r.GetIndex();return n.IsEffectIndexActive(a)?n.GetEffectParametersForIndex(a):null}GetEffectType(e){const t=this._propertyTrack,s=t.GetPropertyTrackDataItem().GetSourceAdapterArguments()[NAME];return e.GetEffectTypeByName(s)}Interpolate(e,t,s,n,i,r,a){this._IsEffectActive()&&super.Interpolate(e,t,s,n,i,r,a)}GetInterpolatedValue(e,t,s){if(this._IsEffectActive())return super.GetInterpolatedValue(e,t,s)}_IsEffectActive(){const e=this._propertyTrack,t=e.GetTrack(),s=t.GetWorldInfo(),n=s.GetInstanceEffectList(),i=n.GetEffectList(),r=this.GetEffectType(i);if(r){const a=r.GetIndex();return n.IsEffectIndexActive(a)}}}C33.PropertyTrackState.EffectSourceAdapter=EffectSourceAdapter}{const C33=self.C3,INDEX=0;class PluginSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(e,t,s,n,i,r,a){const o=this._propertyTrack.GetTrack(),l=o.GetObjectClass().GetPlugin(),h=o.GetInstance().GetObjectClass().GetPlugin();l===h&&super.Interpolate(e,t,s,n,i,r,a)}GetInterpolatedValue(e,t,s){const n=this._propertyTrack.GetTrack(),i=n.GetObjectClass().GetPlugin(),r=n.GetInstance().GetObjectClass().GetPlugin();if(i===r)return super.GetInterpolatedValue(e,t,s)}GetOptionalCallbacks(){const e=this._propertyTrack.GetTrack(),t=e.GetObjectClass().GetPlugin();if(C33.Plugins.Sprite&&t instanceof C33.Plugins.Sprite&&("initial-frame"===this._propertyTrack.GetPropertyName()||"initial-animation"===this._propertyTrack.GetPropertyName()))switch(this._propertyTrack.GetResultMode()){case"relative":case"absolute":return null}}}C33.PropertyTrackState.PluginSourceAdapter=PluginSourceAdapter}{const C33=self.C3;class ValueSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._value=0,this._init=!1}MayNeedBeforeAndAfterInterpolate(){return!1}SetInitialState(){let e=this._propertyTrack.GetPropertyTrackData(),t=this._propertyTrack.GetPropertyTrackDataItem();t=e.GetFirstPropertyKeyframeDataItem(t),this._value=t.GetValueWithResultMode()}SetResumeState(){}GetValue(){return this._init||this._propertyTrack.Interpolate(0),this._value}Interpolate(e,t,s,n,i,r,a){this._value=C33.PropertyTrackState.NumericTypeAdapter.Interpolate(e,t,s,this._propertyTrack),this._init=!0}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return!1}CompareSaveStateWithCurrent(){return!1}_SaveToJson(){return{value:this._value,init:this._init}}_LoadFromJson(e){e&&(this._value=e.value,this._init=!e.hasOwnProperty("init")||e.init)}}C33.PropertyTrackState.ValueSourceAdapter=ValueSourceAdapter}{const C33=self.C3,PROJECT_FILE=0,PROJECT_FILE_NAME=0,PROJECT_FILE_TYPE=1,START_OFFSET=1,AUDIO_DURATION=2,AUDIO_TAG=3;class AudioSourceAdapter extends C33.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._audioPlaybackStarted=!1,this._sdkInstance=null,this._actions=null,this._expressions=null,this._timeline=this._propertyTrack.GetTimeline(),this._track=this._propertyTrack.GetTrack(),this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs(),this._fileArgs=this._sourceAdapterArgs[PROJECT_FILE],this._startOffsetTime=this._sourceAdapterArgs[START_OFFSET],this._sourceAdapterArgs[AUDIO_TAG]?this._audioTag=this._sourceAdapterArgs[AUDIO_TAG]:this._audioTag=Math.random().toString(36).slice(2),this._pauseTime=NaN,this._pauseVolume=NaN,this._volume=NaN,this._audioSource=null,this._Initialize()}Release(){super.Release(),this._sdkInstance=null,this._actions=null,this._expressions=null,this._timeline=null,this._track=null,this._sourceAdapterArgs=null,this._fileArgs=null,this._audioSource=null}_Initialize(){if(self.C3.Plugins.Audio){const e=this._propertyTrack.GetRuntime(),t=e.GetSingleGlobalObjectClassByCtor(self.C3.Plugins.Audio);t&&(this._sdkInstance=t.GetSingleGlobalInstance().GetSdkInstance()),this._actions=self.C3.Plugins.Audio.Acts,this._expressions=self.C3.Plugins.Audio.Exps}}_MaybeSetAudioSource(){if(!this._audioSource){const e=this._propertyTrack.GetTrack(),t=e.GetPropertyTrack("audioSource");t&&(this._audioSource=t.GetSourceAdapter())}}_GetPauseVolume(){const e=this._propertyTrack.GetTrack(),t=e.GetPropertyTrack("volume");return(t?t.GetSourceAdapter():this)._pauseVolume}TimelineRemoved(){super.TimelineRemoved(),this._audioPlaybackStarted=!1,this._sdkInstance&&(this._expressions&&(this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag),this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)),this._actions)&&this._actions.Stop.call(this._sdkInstance,this._audioTag)}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(e){this._volume=e}SetInitialState(){super.SetInitialState(),this._pauseTime=NaN,this._audioPlaybackStarted=!1}SetResumeState(){super.SetResumeState();const e=this._propertyTrack.GetTimeline(),t=e.GetTime();switch(this._pauseTime=t-this._startOffsetTime,this._propertyTrack.GetPropertyName()){case"audioSource":break;case"volume":this._pauseVolume=this._propertyTrack.GetInterpolatedValue(t)}this._audioPlaybackStarted=!1}Interpolate(e,t,s,n,i,r,a){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":{if(!this._timeline.IsForwardPlayBack())return;if(n)return void(this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag));if(e<this._startOffsetTime)return void(this._audioPlaybackStarted=!1);const o=this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag),l=this._timeline.GetPlaybackRate();if(l!==o&&this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,l),this._audioPlaybackStarted)return;if(!this._propertyTrack.GetTimeline().IsPlaying())return;if(this._audioPlaybackStarted=!0,isNaN(this._pauseTime)){const h=self.performance.now(),c=e-this._startOffsetTime,u=this._sdkInstance.GetAudioContextState();if("suspended"===u)return void(this._audioPlaybackStarted=!1);const d=self.performance.now(),_=(d-h)/1e3,p=c+_;if(this._actions){let e=this.GetVolume();isNaN(e)?(this.SetVolume(0),e=0):this.SetVolume(e),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,e,this._audioTag,p)}}else{const m=this._pauseTime,g=(this._pauseTime=NaN,this._GetPauseVolume()),f=(this._pauseVolume=NaN,this._sdkInstance.GetAudioContextState());if("suspended"===f)return void(this._audioPlaybackStarted=!1);this._actions&&(this.SetVolume(g),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,g,this._audioTag,m))}break}case"volume":this._MaybeSetAudioSource(),super.Interpolate(e,t,s,n,i,r,a)}}GetInterpolatedValue(e,t,s){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":return;case"volume":return this._MaybeSetAudioSource(),super.GetInterpolatedValue(e,t,s)}}Getter(e,t){return this._audioSource?this._audioSource.GetVolume():0}Setter(e,t,s,n){this._audioSource&&this._audioSource.SetVolume(this.Getter()+t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(e,t,s){this._audioSource&&this._audioSource.SetVolume(t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return!0}_SaveToJson(){return{audioPlaybackStarted:this._audioPlaybackStarted,audioTag:this._audioTag,pauseTime:this._pauseTime,pauseVolume:this._pauseVolume,volume:this._volume}}_LoadFromJson(e){e&&(this._audioPlaybackStarted=e.audioPlaybackStarted,this._audioTag=e.audioTag,this._pauseTime=e.pauseTime,this._pauseVolume=e.pauseVolume,this._volume=e.volume,this._Initialize())}}C33.PropertyTrackState.AudioSourceAdapter=AudioSourceAdapter}{const C33=self.C3;C33.PropertyTrackState.PropertyInterpolationAdapter=class{constructor(e){this._sourceAdapter=e,this._propertyTrack=e.GetPropertyTrack(),this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo(),this._property=this._propertyTrack.GetPropertyName(),this._firstAbsoluteUpdate=!1,this._saveState=null,this._target=null}Release(){this._sourceAdapter=null,this._propertyTrack=null,this._worldInfo=null,this._saveState=null,this._target=null}MayNeedBeforeAndAfterInterpolate(){return!1}TimelineRemoved(){}CleanCaches(){this._worldInfo=null,this._saveState=null,this._target=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){return this._worldInfo||(this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo()),this._worldInfo}SetFirstAbsoluteUpdate(e){this._firstAbsoluteUpdate=!!e}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetResetState(){}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(e){const t=typeof this._Getter(),s=typeof e;return t==s}BeforeChangeProperty(){}ChangeProperty(e,t,s,n,i,r,a,o){}AfterChangeProperty(){}_FirstKeyframeGetter(){const e=this._PickTimelinePlaybackMode(()=>{const e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetPropertyTrackData();return t.GetFirstPropertyKeyframeDataItem(e)},()=>{const e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetPropertyTrackData();return t.GetLastPropertyKeyframeDataItem(e)});return e.GetAbsoluteValue()}_CurrentKeyframeGetter(){const e=this._propertyTrack.GetTimeline(),n=e.GetTime()-this._propertyTrack.GetTrack().GetStartOffset(),t=this._PickTimelinePlaybackMode(()=>{const e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetPropertyTrackData();return t.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(n,e)},()=>{const e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetPropertyTrackData(),s=t.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(n,e);return s||t.GetLastPropertyKeyframeDataItem(e)});return t.GetAbsoluteValue()}_PickTimelinePlaybackMode(e,t){const s=this._propertyTrack.GetTimeline();return(s.IsForwardPlayBack()?e:t)()}_PickResultMode(e,t){const s=this._propertyTrack.GetResultMode();return("relative"===s?e:t)()}_PickFirstAbsoluteUpdate(e,t){return(this.GetFirstAbsoluteUpdate()?(this.SetFirstAbsoluteUpdate(!1),e):t)()}_GetAbsoluteInitialValue(e){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){return this._target||(this._target=this._sourceAdapter.GetTarget()),this._target}_PickSource(e,t,s,n,i,r){const a=this._propertyTrack.GetSourceAdapterId();switch(a){case"behavior":return e();case"effect":return t();case"instance-variable":return s();case"plugin":return n();case"world-instance":return i();case"audio":return r()}}_SaveToJson(){return{firstAbsoluteUpdate:this._firstAbsoluteUpdate,saveState:this._saveState}}_LoadFromJson(e){e&&(this._firstAbsoluteUpdate=e.firstAbsoluteUpdate,this._saveState=e.saveState)}_GetPropertyKeyframeStubs(e,t=!1){const s=[];for(const n of e){const i=n.GetTrack().GetStartOffset();for(const r of n.GetPropertyKeyframeDataItems())(t&&0===r.GetTime()||!t)&&s.push({time:i+r.GetTime(),value:r.GetAbsoluteValue()})}return s.sort((e,t)=>e.time-t.time)}_GetLastPropertyKeyframeStub(e,t,s){return this._GetPropertyKeyframeStubLowerThanPlayhead(t,s)}_GetPropertyKeyframeStubLowerThanPlayhead(t,s){for(let e=s.length-1;0<=e;e--){const n=s[e].time;if(n<=t)return s[e]}return null}}}{const C33=self.C3,TMP_COLORS_MAP=new Map,TMP_COLOR=[0,0,0];class ColorInterpolationAdapter extends C33.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"effect":return this._ToColorArray(t[s]);case"plugin":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){const e=this._FirstKeyframeGetter();return!this._CompareColors(e,this._Getter())}CompareSaveStateWithCurrent(){return!C33.IsNullOrUndefined(this._saveState)&&!this._CompareColors(this._saveState,this._Getter())}_CompareColors(e,t){return e=this._GetColorFromArray(e),t=this._GetColorFromArray(t),e.equalsIgnoringAlpha(t)}_FirstKeyframeGetter(){const e=super._FirstKeyframeGetter();return this._GetColorFromArray(e)}_CurrentKeyframeGetter(){const e=super._CurrentKeyframeGetter();return this._GetColorFromArray(e)}_GetAbsoluteInitialValue(e){}_ToColorArray(e){return(C33.IsInstanceOf(e,C33.Color)?e.toArray():e).slice(0,3)}_GetColorFromArray(e){return C33.IsInstanceOf(e,C33.Color)?e:new C33.Color(e[0],e[1],e[2],1)}CanChange(e){return!0}MayNeedBeforeAndAfterInterpolate(){return!0}BeforeChangeProperty(){const e=this._propertyTrack.GetTimeline(),t=this._propertyTrack.GetInstance(),s=this._propertyTrack.GetSourceAdapter(),n=e.GetSimilarPropertyTracks(t,s,this._property,this._propertyTrack);if(n&&1<n.length){TMP_COLORS_MAP.has(t)||TMP_COLORS_MAP.set(t,new Map);const i=TMP_COLORS_MAP.get(t),r=this._propertyTrack.GetSourceAdapterId(),a=(i.has(r)||i.set(r,new Map),i.get(r));a.has(this._property)||a.set(this._property,{used:!1,color:new C33.Color(0,0,0,1)})}}_GetTmpColor(e,t,s){const n=TMP_COLORS_MAP.get(e).get(t).get(s);return n.used=!0,n.color}ChangeProperty(e,t,s,n,i,r,a,o){const l=this._propertyTrack.GetTimeline(),h=this._propertyTrack.GetTrack(),c=this._propertyTrack.GetInstance(),u=this._propertyTrack.GetSourceAdapter(),d=this._propertyTrack.GetSourceAdapterId(),_=this._property,p=l.GetSimilarPropertyTracks(c,u,_,this._propertyTrack);if(p&&1<p.length){const m=this._GetPropertyKeyframeStubs(p,!0),g=this._GetLastPropertyKeyframeStub(l,l.GetTime(),m);if(g){const f=h.GetStartOffset(),S=g.time-f;if(0==S)this._GetTmpColor(c,d,this._property).addRgb(t[0],t[1],t[2]);else if(!(S<0)){const y=t[0],C=t[1],G=t[2],T=this._propertyTrack.Interpolate(S,!1,!0),I=C33.Color.DiffChannel(y,T[0]),b=C33.Color.DiffChannel(C,T[1]),A=C33.Color.DiffChannel(G,T[2]);this._GetTmpColor(c,d,this._property).addRgb(I,b,A)}}}else this._Setter(t[0],t[1],t[2])}AfterChangeProperty(){const e=this._propertyTrack.GetInstance();if(TMP_COLORS_MAP.has(e)){const t=TMP_COLORS_MAP.get(e),s=this._propertyTrack.GetSourceAdapterId();if(t.has(s)){const n=t.get(s);if(n.has(this._property)){const i=n.get(this._property),r=i.used,a=i.color;r&&this._Setter(a.getR(),a.getG(),a.getB()),0===n.size&&t.delete(s),0===t.size&&TMP_COLORS_MAP.delete(e)}}}}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"effect":return t[s].clone();case"plugin":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(e,t,s){const n=this._propertyTrack.GetSourceAdapterId(),i=this._GetTarget(),r=this._GetIndex();switch(n){case"behavior":TMP_COLOR[0]=e,TMP_COLOR[1]=t,TMP_COLOR[2]=s,i.SetPropertyValueByIndex(r,TMP_COLOR);break;case"effect":i[r].setRgb(e,t,s);break;case"plugin":TMP_COLOR[0]=e,TMP_COLOR[1]=t,TMP_COLOR[2]=s,i.SetPropertyValueByIndex(r,TMP_COLOR);break;case"world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(e,t,s)}}_SaveToJson(){}_LoadFromJson(e){}}C33.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=ColorInterpolationAdapter}{const C33=self.C3,NS=C33.PropertyTrackState;class NoInterpolationAdapter extends C33.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){const e=this._FirstKeyframeGetter();return e!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!C33.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return!1}ChangeProperty(e,t,s,n,i,r,a,o){const l=this._propertyTrack,h=l.GetTrack(),c=l.GetSourceAdapterId(),u=l.GetTimeline(),d=h.GetInstance(),_=l.GetSourceAdapter(),p=this._property,m=u.GetSimilarPropertyTracks(d,_,p,l);if(m&&1<m.length){const f=this._GetPropertyKeyframeStubs(m),S=e+h.GetStartOffset(),y=this._GetLastPropertyKeyframeStub(u,S,f);y&&(t=y.value)}const g=l.GetPropertyKeyframeType();switch(g){case"numeric":if(NS.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,c))break;return;case"angle":if(NS.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,c))break;return;case"boolean":if(NS.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,c))break;return;case"color":if(NS.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,c))break;return;case"text":if(!NS.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),t,c))return}this._Setter(t)}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return t.GetPropertyValueByIndex(s);case"effect":return t[s];case"instance-variable":return t.GetInstanceVariableValue(s);case"plugin":return t.GetPropertyValueByIndex(s)}}_Setter(e){const t=this._propertyTrack.GetSourceAdapterId(),s=this._GetTarget(),n=this._GetIndex();switch(t){case"behavior":s.SetPropertyValueByIndex(n,e);break;case"effect":s[n]=e;break;case"instance-variable":s.SetInstanceVariableValue(n,e);break;case"plugin":s.SetPropertyValueByIndex(n,e)}}}C33.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=NoInterpolationAdapter}{const C33=self.C3,NS=C33.PropertyTrackState.PropertyInterpolationAdapter,INSTANCE_FUNC_MAP=new Map,add2=(e,t,s,n,i,r=!1,a=null,o=null)=>{INSTANCE_FUNC_MAP.set(e,{setter:t,absolute_setter:s,getter:n,round:i,fRound:r,init:a,reset:o})};add2("offsetX",(e,t,s,n)=>{"relative"===n._propertyTrack.GetResultMode()?e.OffsetX(t,s.GetTimeline().GetTransformWithSceneGraph()):e.OffsetX(t)},(e,t)=>e.SetX(t),e=>e.GetX(),!0),add2("offsetY",(e,t,s,n)=>{"relative"===n._propertyTrack.GetResultMode()?e.OffsetY(t,s.GetTimeline().GetTransformWithSceneGraph()):e.OffsetY(t)},(e,t)=>e.SetY(t),e=>e.GetY(),!0),add2("offsetWidth",(t,e,o,s,n)=>{if(0!==e){const i="relative"===s._propertyTrack.GetResultMode(),h=1===s._typeAdapter.GetType();if((i||h)&&t.HasParent()&&t.GetTransformWithParentWidth()){if(isNaN(s._absoluteToFactor)){let n=[],e=t.GetParent();for(;e;)n.push(e),e=e.GetParent();n.reverse();let l=(e,t)=>t.GetTimeline().GetTrackFromInstance(e.GetInstance()),i=(e,t)=>{const s=l(e,t);if(s)return s.GetOriginalWidth();const n=e.GetInstance().GetSdkInstance();return n.IsOriginalSizeKnown()?n.GetOriginalWidth():e._GetSceneGraphInfo()._GetStartWidth()},r=(e,t,s,n=0)=>{const i=l(e,t);if(!i)return n;const r=i.GetPropertyTrack(s);if(!r)return n;const a=r.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!a)return n;const o=a.GetLastPropertyKeyframeDataItem();return o?o.GetValue():n},a;if(h){let e=n[n.length-1];a=e.GetWidth()}else{let t=n[0],e=t._GetSceneGraphInfo()._GetStartWidth(),s=t._GetSceneGraphInfo().GetStartScaleX();a=e*s,a=(a+=r(t,o,"offsetWidth"))+i(t,o)*r(t,o,"offsetScaleX");for(let e=1;e<n.length;e++){const c=(t=n[e])._GetSceneGraphInfo().GetStartScaleX();a=(a=(a*=c)+r(t,o,"offsetWidth"))+i(t,o)*r(t,o,"offsetScaleX")}}s._absoluteToFactor=0===a?Number.EPSILON:a}n||t.OffsetWidth(e/s._absoluteToFactor,!0)}else t.OffsetWidth(e)}},(e,t)=>e.SetWidth(t),e=>e.GetWidth(),!0),add2("offsetHeight",(t,e,o,s,n)=>{if(0!==e){const i="relative"===s._propertyTrack.GetResultMode(),l=1===s._typeAdapter.GetType();if((i||l)&&t.HasParent()&&t.GetTransformWithParentHeight()){if(isNaN(s._absoluteToFactor)){let n=[],e=t.GetParent();for(;e;)n.push(e),e=e.GetParent();n.reverse();let i=(e,t)=>{n=e;const s=t.GetTimeline().GetTrackFromInstance(n.GetInstance());var n;if(s)return s.GetOriginalHeight();const i=e.GetInstance().GetSdkInstance();return i.IsOriginalSizeKnown()?i.GetOriginalHeight():e._GetSceneGraphInfo()._GetStartHeight()},r=(e,t,s,n=0)=>{const i=t.GetTimeline().GetTrackFromInstance(e.GetInstance());if(!i)return n;const r=i.GetPropertyTrack(s);if(!r)return n;const a=r.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!a)return n;const o=a.GetLastPropertyKeyframeDataItem();return o?o.GetValue():n},a;if(l){let e=n[n.length-1];a=e.GetHeight()}else{let t=n[0],e=t._GetSceneGraphInfo()._GetStartHeight(),s=t._GetSceneGraphInfo().GetStartScaleY();a=e*s,a=(a+=r(t,o,"offsetHeight"))+i(t,o)*r(t,o,"offsetScaleY");for(let e=1;e<n.length;e++){const h=(t=n[e])._GetSceneGraphInfo().GetStartScaleY();a=(a=(a*=h)+r(t,o))+i(t,o)*r(t,o,"offsetScaleY")}}s._absoluteToFactor=0===a?Number.EPSILON:a}n||t.OffsetHeight(e/s._absoluteToFactor,!0)}else t.OffsetHeight(e)}},(e,t)=>e.SetHeight(t),e=>e.GetHeight(),!0),add2("offsetAngle",(e,t,s,n,i)=>{e.OffsetAngle(t)},(e,t)=>e.SetAngle(t),e=>e.GetAngle(),!1,!0),add2("offsetOpacity",(e,t,s,n,i)=>{const r=n._opacityFactor||1,a=(t/=r,e.GetOpacity()),o=a+t;if(0===n._clampAccumulator)1<o?n._clampAccumulator+=o-1:o<0&&(n._clampAccumulator+=o),e.OffsetOpacity(t);else{const l=e.GetOpacity()+t;0<t&&0<n._clampAccumulator?1<l&&(n._clampAccumulator+=l-1):0<t&&n._clampAccumulator<0?(n._clampAccumulator+=t,0<n._clampAccumulator&&(e.OffsetOpacity(n._clampAccumulator),n._clampAccumulator=0)):t<0&&0<n._clampAccumulator?(n._clampAccumulator+=t,n._clampAccumulator<0&&(e.OffsetOpacity(n._clampAccumulator),n._clampAccumulator=0)):t<0&&n._clampAccumulator<0&&l<0&&(n._clampAccumulator+=l)}},(e,t)=>{e.SetOpacity(t)},e=>e.GetOpacity(),!1,!0,(r,i,a)=>{switch(r._clampAccumulator=0,r._propertyTrack.GetResultMode()){case"relative":{r._propertyTrack.GetPropertyTrackData();let e=r._propertyTrack.GetPropertyTrackDataItem(),t=e.GetPropertyKeyframeData(),s=t.GetPropertyKeyframeDataItemArray(),n=r.GetWorldInfo().GetOpacity(),i=n;for(const o of s){const l=o.GetTime(),h=r._propertyTrack.GetInterpolatedValue(l);i=n+h,i=C33.clamp(i,0,1)}r._totalForewardOpacityDelta=n-i,r._totalForewardOpacityDelta=Math.round(100*(r._totalForewardOpacityDelta+Number.EPSILON))/100,i=n;for(let e=s.length-1;0<=e;e--){const c=s[e].GetTime(),u=r._propertyTrack.GetInterpolatedValue(c);i-=u,i=C33.clamp(i,0,1)}r._totalBackwardOpacityDelta=i,r._totalBackwardOpacityDelta=Math.round(100*(r._totalBackwardOpacityDelta+Number.EPSILON))/100;break}}const e="relative"===r._propertyTrack.GetResultMode(),t=1===r._typeAdapter.GetType();if((e||t)&&i.HasParent()&&i.GetTransformWithParentOpacity()){let t=[],e=i.GetParent();for(;e;)t.push(e),e=e.GetParent();t.reverse();let s=(e,t,s)=>{const n=t.GetTimeline().GetTrackFromInstance(e.GetInstance());if(!n)return 0;const i=n.GetPropertyTrack(s);if(!i)return 0;const r=i.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!r)return 0;const a=r.GetLastPropertyKeyframeDataItem();return a?a.GetValue():0},n=t[0]._GetSceneGraphInfo().GetStartOpacity();n+=s(t[0],a,"offsetOpacity");for(let e=1;e<t.length;e++)n+=s(t[e],a,"offsetOpacity");r._opacityFactor=0===n?1:n}},s=>{switch(s._propertyTrack.GetResultMode()){case"relative":{s._clampAccumulator=0;let e=s.GetWorldInfo(),t=e.GetOpacity();t=Math.round(100*(t+Number.EPSILON))/100,s._propertyTrack.GetTimeline().IsForwardPlayBack()?(e.SetOpacity(t+s._totalForewardOpacityDelta),s._lastValue=0):(e.SetOpacity(t-s._totalBackwardOpacityDelta),s._lastValue=s.GetSourceAdapter().GetValueAtTime());break}}}),add2("offsetOriginX",(e,t)=>e.OffsetOriginX(t),(e,t)=>e.SetOriginX(t),e=>e.GetOriginX(),!1),add2("offsetOriginY",(e,t)=>e.OffsetOriginY(t),(e,t)=>e.SetOriginY(t),e=>e.GetOriginY(),!1),add2("offsetZElevation",(e,t)=>e.OffsetZElevation(t),(e,t)=>e.SetZElevation(t),e=>e.GetZElevation(),!0),add2("offsetScaleX",(e,t,s,n)=>{if(0!==t){const i=e.GetWidth()<0?-1:1;if("relative"===n._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentWidth()){const r=s.GetOriginalWidth()*i*t;isNaN(n._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetWidth").setter(e,1,s,n,!0),e.OffsetWidth(r/n._absoluteToFactor,!0)}else e.OffsetWidth(s.GetOriginalWidth()*i*t)}},(e,t,s)=>{e.SetWidth(s.GetOriginalWidth()*t)},(n,i)=>{const r=n.GetWidth()<0?-1:1;if(n.GetTransformWithParentWidth()){let e=n.GetParent(),t=i.GetTimeline().GetTrackFromInstance(e.GetInstance()),s=NaN;if(t)s=e.GetWidth()/t.GetOriginalWidth();else{const a=e.GetInstance().GetSdkInstance();s=a.IsOriginalSizeKnown()?e.GetWidth()/a.GetOriginalWidth():1}return n.GetWidth()*r/(i.GetOriginalWidth()*s)}return n.GetWidth()*r/i.GetOriginalWidth()},!1),add2("offsetScaleY",(e,t,s,n)=>{if(0!==t){const i=e.GetHeight()<0?-1:1;if("relative"===n._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentHeight()){const r=s.GetOriginalHeight()*i*t;isNaN(n._absoluteToFactor)&&INSTANCE_FUNC_MAP.get("offsetHeight").setter(e,1,s,n,!0),e.OffsetHeight(r/n._absoluteToFactor,!0)}else e.OffsetHeight(s.GetOriginalHeight()*i*t)}},(e,t,s)=>{e.SetHeight(s.GetOriginalHeight()*t)},(n,i)=>{const r=n.GetHeight()<0?-1:1;if(n.GetTransformWithParentHeight()){let e=n.GetParent(),t=i.GetTimeline().GetTrackFromInstance(e.GetInstance()),s=NaN;if(t)s=e.GetHeight()/t.GetOriginalHeight();else{const a=e.GetInstance().GetSdkInstance();s=a.IsOriginalSizeKnown()?e.GetHeight()/a.GetOriginalHeight():1}return n.GetHeight()*r/(i.GetOriginalHeight()*s)}return n.GetHeight()*r/i.GetOriginalHeight()},!1);class NumericInterpolationAdapter extends C33.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e),this._lastValue=0,this._clampAccumulator=0,this._totalForewardOpacityDelta=0,this._totalBackwardOpacityDelta=0,this._opacityFactor=NaN,this._absoluteToFactor=NaN,this._angleReflectMirrorOrFlip=void 0,this._angleReflectMirrorAndFlip=void 0,this._instance_getter=null,this._instance_setter=null,this._instance_absolute_setter=null,this._reset_action=null,this._init_action=null,this._source_adapter_getter=null,this._source_adapter_setter=null,this._source_adapter_absolute_setter=null,this._round=!1,this._fRound=!1,C33.IsInstanceOf(this._propertyTrack.GetTimeline(),C33.TweenState)?this._typeAdapter=new C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this):this._typeAdapter=new C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);const t=this._propertyTrack.GetPropertyName();switch(this._propertyTrack.GetSourceAdapterId()){case"world-instance":{const s=INSTANCE_FUNC_MAP.get(t);this._instance_getter=s.getter,this._instance_setter=s.setter,this._instance_absolute_setter=s.absolute_setter,this._round=s.round,this._fRound=s.fRound,this._init_action=s.init,this._reset_action=s.reset;break}case"audio":this._source_adapter_getter=e.Getter,this._source_adapter_setter=e.Setter,this._source_adapter_absolute_setter=e.AbsoluteSetter,this._round=!!e.DoesRounding(),this._fRound=!1}}Release(){this._typeAdapter=null,this._instance_getter=null,this._instance_setter=null,this._instance_absolute_setter=null,this._reset_action=null,this._init_action=null,this._source_adapter_getter=null,this._source_adapter_setter=null,this._source_adapter_absolute_setter=null,super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(e){this._lastValue=e}SetResetState(){this._reset_action&&this._reset_action(this)}SetInitialState(){const e=this._typeAdapter.SetInitialState();if("number"==typeof e&&(this._lastValue=e),this._init_action){const t=this.GetWorldInfo(),s=this._propertyTrack.GetTrack();this._init_action(this,t,s)}}SetResumeState(){const e=this._typeAdapter.SetResumeState();"number"==typeof e&&(this._lastValue=e)}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){const e=this._FirstKeyframeGetter();return e!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!C33.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(e,t,s,n,i,r,a,o){return this._typeAdapter.ChangeProperty(e,t,s,n,i,r,a,o)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){const e=this._GetTarget(),t=this._GetIndex(),s=this.GetWorldInfo(),n=this._propertyTrack.GetTrack(),i=this._propertyTrack.GetSourceAdapterId();switch(i){case"behavior":return e.GetPropertyValueByIndex(t);case"effect":return e[t];case"instance-variable":return e.GetInstanceVariableValue(t);case"plugin":return e.GetPropertyValueByIndex(t);case"world-instance":return this._instance_getter(s,n);case"audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),s,n)}}_Setter(e,t,s){const n=this._GetTarget(),i=this._GetIndex(),r=this.GetWorldInfo(),a=this._propertyTrack.GetTrack(),o=this._propertyTrack.GetSourceAdapterId();switch(o){case"behavior":n.OffsetPropertyValueByIndex(i,e);break;case"effect":n[i]+=e;break;case"instance-variable":n.SetInstanceVariableOffset(i,e);break;case"plugin":n.OffsetPropertyValueByIndex(i,e,this.GetSourceAdapter().GetOptionalCallbacks());break;case"world-instance":this._instance_setter(r,e,a,this);break;case"audio":this._source_adapter_setter.call(this.GetSourceAdapter(),r,e,a,this)}}_SetterAbsolute(e,t,s){let n=this._propertyTrack.GetInterpolationMode();if("discrete"!==(n="default"===n?"continuous":n)||t){if("discrete"===n&&s){const h=this._propertyTrack.GetTimeline(),c=h.GetTime(),u=this._propertyTrack.GetPropertyKeyFrameDataItemAtTime(c);if(!u)return}const i=this._GetTarget(),r=this._GetIndex(),a=this.GetWorldInfo(),o=this._propertyTrack.GetTrack(),l=this._propertyTrack.GetSourceAdapterId();switch(l){case"behavior":i.SetPropertyValueByIndex(r,e);break;case"effect":i[r]=e;break;case"instance-variable":i.SetInstanceVariableValue(r,e);break;case"plugin":i.SetPropertyValueByIndex(r,e,this.GetSourceAdapter().GetOptionalCallbacks());break;case"world-instance":this._instance_absolute_setter(a,e,o);break;case"audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),a,e,o)}}}_MaybeEnsureValue(e,t,s,n,i,r,a,o){this._typeAdapter._MaybeEnsureValue(e,t,s,n,i,r,a,o)}_AddDelta(e,t,s,n,i){let r=(e="angle"===this._propertyTrack.GetPropertyType()?C33.toDegrees(e):e).toString(),a=r.split(".")[1]||"",o=a.length,l=this._Getter(),h;switch(h=0===o?this._round?Math.round(l):this._fRound?"angle"===this._propertyTrack.GetPropertyType()?C33.toRadians(Math.round(C33.toDegrees(l))):Number(C33.toFixed(l,2)):l:this._round?Number(C33.toFixed(l,o)):(this._fRound,l),this._Setter(h-l,t,s),this._propertyTrack.GetPropertyName()){case"offsetWidth":case"offsetScaleX":{const c=this.GetWorldInfo(),u=c.GetWidth(),d=Number(C33.toFixed(u,2));c.OffsetWidth(d-u);break}case"offsetHeight":case"offsetScaleY":{const _=this.GetWorldInfo(),p=_.GetHeight(),m=Number(C33.toFixed(p,2));_.OffsetHeight(m-p);break}}}_SaveToJson(){return Object.assign(super._SaveToJson(),{v:this._lastValue,a:this._clampAccumulator,fod:this._totalForewardOpacityDelta,bod:this._totalBackwardOpacityDelta,of:this._opacityFactor,sf:this._absoluteToFactor,armorf:this._angleReflectMirrorOrFlip,armandf:this._angleReflectMirrorAndFlip})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._lastValue=e.v,this._clampAccumulator=e.a,this._totalForewardOpacityDelta=C33.IsFiniteNumber(e.fod)?e.fod:0,this._totalBackwardOpacityDelta=C33.IsFiniteNumber(e.bod)?e.bod:0,this._opacityFactor=C33.IsFiniteNumber(e.of)?e.of:NaN,this._absoluteToFactor=C33.IsFiniteNumber(e.sf)?e.sf:NaN,this._angleReflectMirrorOrFlip=C33.IsFiniteNumber(e.armorf)?e.armorf:void 0,this._angleReflectMirrorAndFlip=C33.IsFiniteNumber(e.armandf)?e.armandf:void 0)}}C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=NumericInterpolationAdapter}{const C33=self.C3;class AbsoluteValueObject{constructor(e){this._used=!1,this._value=0,this._propertyKeyframeReached=!1,this._endState=!1,this._propertyTracks=e;for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=!0}GetUsed(){return this._used}SetValue(e){this._value=e}GetValue(){return this._value}SetPropertyKeyframeReached(e){this._propertyKeyframeReached=e}GetPropertyKeyframeReached(){return this._propertyKeyframeReached}SetEndState(e){this._endState=e}GetEndState(){return this._endState}Reset(){this._used=!1,this._value=0,this._propertyKeyframeReached=!1,this._endState=!1}}class NumericInterpolationAdapterForTimeline{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}GetType(){return 0}SetInitialState(){const e=this._numericInterpolationAdapter;return this._numericInterpolationAdapter.GetPropertyTrack(),e._PickResultMode(()=>e._PickTimelinePlaybackMode(()=>0,()=>e.GetSourceAdapter().GetValueAtTime()),()=>{})}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){this._numericInterpolationAdapter;const e=this._numericInterpolationAdapter.GetPropertyTrack();switch(e.GetResultMode()){case"relative":return!1;case"absolute":return!0}}BeforeChangeProperty(){this._numericInterpolationAdapter;const e=this._numericInterpolationAdapter.GetPropertyTrack(),t=e.GetPropertyName();switch(e.GetResultMode()){case"relative":break;case"absolute":if(e.HasAbsoluteValueObject()){const s=e.GetAbsoluteValueObject();s.Reset()}else{const n=e.GetTimeline(),i=e.GetInstance(),r=e.GetSourceAdapter(),a=n.GetSimilarPropertyTracks(i,r,t,e);a&&1<a.length&&new AbsoluteValueObject(a)}}}ChangeProperty(e,t,s,n,i,r,a,o){const l=this._numericInterpolationAdapter,h=this._numericInterpolationAdapter.GetPropertyTrack();switch(h.GetResultMode()){case"relative":{const c=l.GetLastValue();l._Setter(t-c,s,n),r&&this._MaybeEnsureValue(e,s,n,i,c,t),l.SetLastValue(t);break}case"absolute":{const u=h.GetTimeline(),d=h.GetTrack();if(h.GetInstance(),h.GetSourceAdapter(),h.HasAbsoluteValueObject()){const _=h.GetAbsoluteValueObject(),p=_.GetPropertyTracks(),m=l._GetPropertyKeyframeStubs(p,!0),g=l._GetLastPropertyKeyframeStub(u,u.GetTime(),m);if(g){const f=d.GetStartOffset(),S=g.time-f;if(0==S)_.SetEndState(a),_.SetPropertyKeyframeReached(o),_.SetUsed(),_.SetValue(_.GetValue()+t);else{if(S<0)return;const y=h.GetInterpolatedValue(S);_.SetEndState(a),_.SetPropertyKeyframeReached(o),_.SetUsed(),_.SetValue(_.GetValue()+(t-y))}}}else l._SetterAbsolute(t,o,a);break}}}AfterChangeProperty(){const e=this._numericInterpolationAdapter,t=this._numericInterpolationAdapter.GetPropertyTrack();switch(t.GetResultMode()){case"relative":break;case"absolute":if(t.HasAbsoluteValueObject()){const s=t.GetAbsoluteValueObject();s.GetUsed()&&e._SetterAbsolute(s.GetValue(),s.GetPropertyKeyframeReached(),s.GetEndState())}}}_MaybeEnsureValue(e,t,s,n,i,r){const a=this._numericInterpolationAdapter;n||(t&&e===t.GetTime()?a._AddDelta(t.GetValueWithResultMode(),t,s):s&&e===s.GetTime()?a._AddDelta(s.GetValueWithResultMode(),t,s):r-i==0&&a._AddDelta(t.GetValueWithResultMode(),t,s))}}C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=NumericInterpolationAdapterForTimeline}{const C33=self.C3;class NumericInterpolationAdapterForTween{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}GetType(){return 1}SetInitialState(){const e=this._numericInterpolationAdapter;return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._FirstKeyframeGetter())}SetResumeState(){const e=this._numericInterpolationAdapter;if(e._FirstKeyframeGetter()!==e._CurrentKeyframeGetter())return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return!1}BeforeChangeProperty(){}ChangeProperty(e,t,s,n,i,r,a,o){const l=this._numericInterpolationAdapter,h=l.GetLastValue();switch(l.GetPropertyTrack().GetResultMode()){case"relative":l._Setter(t-h,s,n),r&&this._MaybeEnsureValue(e,s,n,i,h,t,!1,a);break;case"absolute":l.GetFirstAbsoluteUpdate()?(l.SetFirstAbsoluteUpdate(!1),l._Setter(h,s,n)):0===e&&0===l.GetPropertyTrack().GetTimeline().GetTotalTime()?l._SetterAbsolute(t,!0,!1):(l._Setter(t-h,s,n),r&&this._MaybeEnsureValue(e,s,n,i,h,t,this._ForceEndValue(),a))}l.SetLastValue(t)}AfterChangeProperty(){}_GetAbsoluteInitialValue(e){const t=this._numericInterpolationAdapter;return e-t.GetCurrentState()}_ForceEndValue(){let e=this._numericInterpolationAdapter,t=e.GetWorldInfo().GetInstance(),s=e.GetPropertyTrack().GetRuntime(),n=s.GetTimelineManager(),i=0;for(const r of n.GetPlayingTimelines())0===r.GetType()?r.HasTrackInstance(t)&&i++:1===r.GetType()&&r.GetInstance()===t&&i++;return i<=1}_MaybeEnsureValue(e,t,s,n,i,r,a,o){const l=this._numericInterpolationAdapter;n?t&&e===t.GetTime()?l._AddDelta(t.GetValueWithResultMode(),t,s,a,o):s&&e===s.GetTime()?l._AddDelta(s.GetValueWithResultMode(),t,s,a,o):s||l._AddDelta(t.GetValueWithResultMode(),t,s,a,o):t&&e===t.GetTime()?l._AddDelta(t.GetValueWithResultMode(),t,s,a,o):s&&e===s.GetTime()?l._AddDelta(s.GetValueWithResultMode(),t,s,a,o):r-i==0&&l._AddDelta(t.GetValueWithResultMode(),t,s,a,o)}}C33.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=NumericInterpolationAdapterForTween}{const C33=self.C3,Ease=self.Ease;C33.PropertyTrackState.NumericTypeAdapter=class{constructor(){}static WillChange(e,t,s,n){let i;switch(n){case"behavior":i=t.GetPropertyValueByIndex(e);break;case"effect":i=t[e];break;case"instance-variable":i=t.GetInstanceVariableValue(e);break;case"plugin":i=t.GetPropertyValueByIndex(e)}return i!==s}static Interpolate(r,a,o,l){if(!o){let e=l.GetPropertyTrackDataItem(),t=l.GetPropertyTrackData();return(e=t.GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode()}let h=l.GetInterpolationMode();if("default"===h&&(h="continuous"),"discrete"===(h="combo"===l.GetPropertyType()?"discrete":h))return a.GetValueWithResultMode();if("continuous"===h||"step"===h){const c=l.GetTimeline().GetStep();if("step"===h&&0!==c){const g=1/c;r=Math.floor(r*g)/g}const u=a.GetValueWithResultMode(),d=o.GetValueWithResultMode(),_=a.GetAddOn("cubic-bezier"),p=o.GetAddOn("cubic-bezier"),m=_&&_.GetStartEnable()&&p&&p.GetEndEnable();if(!m&&u===d)return u;let e=a.GetTime(),t=o.GetTime(),s=("step"===h&&0!==c&&(r=C33.clamp(r,e,t)),C33.normalize(r,e,t)),n=a.GetEase(),i;if(m){const f=t-e;i=Ease.GetRuntimeEase(n)(f*s,0,1,f),i=Ease.GetRuntimeEase("cubicbezier")(i,u,u+_.GetStartAnchor(),d+p.GetEndAnchor(),d)}else i=Ease.GetRuntimeEase(n)((t-e)*s,u,d-u,t-e);return"integer"===l.GetPropertyType()?Math.floor(i):i}}}}{const C33=self.C3;C33.PropertyTrackState.AngleTypeAdapter=class{constructor(){}static WillChange(e,t,s,n){let i;switch(n){case"behavior":i=t.GetPropertyValueByIndex(e);break;case"effect":i=t[e];break;case"instance-variable":i=t.GetInstanceVariableValue(e);break;case"plugin":i=t.GetPropertyValueByIndex(e)}return i!==s}static Interpolate(e,t,s,n){if(!s){let e=n.GetPropertyTrackDataItem(),t=n.GetPropertyTrackData();return(e=t.GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode()}let i=n.GetInterpolationMode();if("default"===i&&(i="continuous"),"discrete"===(i="combo"===n.GetPropertyType()?"discrete":i))return t.GetValueWithResultMode();if("continuous"===i||"step"===i){const r=n.GetTimeline().GetStep();if("step"===i&&0!==r){const u=1/r;e=Math.floor(e*u)/u}const a=t.GetTime(),o=s.GetTime(),l=t.GetValueWithResultMode(),h=s.GetValueWithResultMode(),c=("step"===i&&0!==r&&(e=C33.clamp(e,a,o)),t.GetAddOn("angle"));if(!c){if(l===h)return l;const d=C33.normalize(e,a,o),_=self.Ease.GetRuntimeEase(t.GetEase());return C33.angleLerp(l,h,_(d,0,1,1))}{const p=c.GetRevolutions();if(l===h&&0===p)return l;const m=C33.normalize(e,a,o),g=self.Ease.GetRuntimeEase(t.GetEase()),f=g(m,0,1,1);switch(c.GetDirection()){case"closest":return C33.angleLerp(l,h,f,p);case"clockwise":return C33.angleLerpClockwise(l,h,f,p);case"anti-clockwise":return C33.angleLerpAntiClockwise(l,h,f,p)}}}}}}{const C33=self.C3;C33.PropertyTrackState.BooleanTypeAdapter=class{constructor(){}static WillChange(e,t,s,n){let i;switch(n){case"behavior":i=t.GetPropertyValueByIndex(e);break;case"effect":i=t[e];break;case"instance-variable":i=t.GetInstanceVariableValue(e);break;case"plugin":i=t.GetPropertyValueByIndex(e)}return!!i!=!!s}static Interpolate(e,t,s,n){if(s)return t.GetValueWithResultMode()?1:0;{let e=n.GetPropertyTrackDataItem(),t=n.GetPropertyTrackData();return(e=t.GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode()?1:0}}}}{const C33=self.C3,TEMP_COLOR_ARRAY=[0,0,0],TEMP_COLOR_ARRAY_2=[0,0,0],TEMP_COLOR_ARRAY_3=[0,0,0];C33.PropertyTrackState.ColorTypeAdapter=class{constructor(){}static WillChange(e,t,s,n){let i;switch(n){case"behavior":i=t.GetPropertyValueByIndex(e);break;case"effect":i=t[e];break;case"instance-variable":i=t.GetInstanceVariableValue(e);break;case"plugin":i=t.GetPropertyValueByIndex(e)}return Array.isArray(s)?(TEMP_COLOR_ARRAY[0]=s[0],TEMP_COLOR_ARRAY[1]=s[1],TEMP_COLOR_ARRAY[2]=s[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(s),TEMP_COLOR_ARRAY[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB())),Array.isArray(i)?(TEMP_COLOR_ARRAY_2[0]=i[0],TEMP_COLOR_ARRAY_2[1]=i[1],TEMP_COLOR_ARRAY_2[2]=i[2]):(TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(i),TEMP_COLOR_ARRAY_2[0]=Math.floor(255*TEMP_COLOR_ARRAY_3.getR()),TEMP_COLOR_ARRAY_2[1]=Math.floor(255*TEMP_COLOR_ARRAY_3.getG()),TEMP_COLOR_ARRAY_2[2]=Math.floor(255*TEMP_COLOR_ARRAY_3.getB())),TEMP_COLOR_ARRAY[0]!==TEMP_COLOR_ARRAY_2[0]||TEMP_COLOR_ARRAY[1]!==TEMP_COLOR_ARRAY_2[1]||TEMP_COLOR_ARRAY[2]!==TEMP_COLOR_ARRAY_2[2]}static Interpolate(e,t,s,n){if(!s){let e=n.GetPropertyTrackDataItem(),t=n.GetPropertyTrackData(),s=(e=t.GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode();return TEMP_COLOR_ARRAY[0]=s[0],TEMP_COLOR_ARRAY[1]=s[1],TEMP_COLOR_ARRAY[2]=s[2],TEMP_COLOR_ARRAY}let i=n.GetInterpolationMode();if("discrete"===(i="default"===i?"continuous":i)){const r=t.GetValueWithResultMode();return TEMP_COLOR_ARRAY[0]=r[0],TEMP_COLOR_ARRAY[1]=r[1],TEMP_COLOR_ARRAY[2]=r[2],TEMP_COLOR_ARRAY}if("continuous"===i||"step"===i){const a=n.GetTimeline().GetStep();if("step"===i&&0!==a){const T=1/a;e=Math.floor(e*T)/T}const o=t.GetTime(),l=s.GetTime(),h=t.GetValueWithResultMode(),c=s.GetValueWithResultMode(),u=("step"===i&&0!==a&&(e=C33.clamp(e,o,l)),C33.normalize(e,o,l)),d=t.GetEase(),_=h[0],p=h[1],m=h[2],g=c[0],f=c[1],S=c[2],y=self.Ease.GetRuntimeEase(d),C=l-o,G=C*u;return TEMP_COLOR_ARRAY[0]=_===g?_:y(G,_,g-_,C),TEMP_COLOR_ARRAY[1]=p===f?p:y(G,p,f-p,C),TEMP_COLOR_ARRAY[2]=m===S?m:y(G,m,S-m,C),TEMP_COLOR_ARRAY}}}}{const C33=self.C3;C33.PropertyTrackState.TextTypeAdapter=class{constructor(){}static WillChange(e,t,s,n){let i;switch(n){case"behavior":i=t.GetPropertyValueByIndex(e);break;case"effect":i=t[e];break;case"instance-variable":i=t.GetInstanceVariableValue(e);break;case"plugin":i=t.GetPropertyValueByIndex(e)}return i!==s}static Interpolate(e,t,s,n){if(s)return t.GetValueWithResultMode();{let e=n.GetPropertyTrackDataItem(),t=n.GetPropertyTrackData();return(e=t.GetLastPropertyKeyframeDataItem(e)).GetValueWithResultMode()}}}}{const C33=self.C3;C33.TimelineDataManager=class{constructor(){this._timelineDataItems=new Map}Release(){for(const e of this._timelineDataItems.values())e.Release();this._timelineDataItems.clear(),this._timelineDataItems=null}Add(e){const t=new C33.TimelineDataItem(e),s=t.GetName();this._timelineDataItems.set(s,t)}Get(e){return this._timelineDataItems.get(e)}GetNameId(){return 0}static _CreateDataItems(e,t,s,n){if(t)for(const i of t)C33.TimelineDataManager._CreateDataItem("create",i,e,s,n)}static _CreateDataItemsIncludingDisabled(e,t,s,n){if(t)for(const i of t)C33.TimelineDataManager._CreateDataItem("create-including-disabled",i,e,s,n)}static _LoadDataItemsFromJson(s,e,t,n){s.length?e.forEach((e,t)=>{s[t]._LoadFromJson(e)}):e.forEach(e=>{C33.TimelineDataManager._CreateDataItem("load",e,s,t,n)})}static _CreateDataItem(e,t,s,n,i){let r;if("function"==typeof n)switch(e){case"load":r=new n(null,i);break;case"create":case"create-including-disabled":r=new n(t,i)}else if("object"==typeof n){const a=n.prop,o=t[a],l=n.map.get(o);switch(e){case"load":r=new l(null,i);break;case"create":case"create-including-disabled":r=new l(t,i)}}switch(e){case"load":r._LoadFromJson(t),s.push(r);break;case"create":if("function"==typeof r.GetEnable&&!r.GetEnable())return r.Release();s.push(r);break;case"create-including-disabled":s.push(r)}}}}{const C33=self.C3,NAME=0,TOTAL_TIME=1,STEP=2,INTERPOLATION_MODE=3,RESULT_MODE=4,TRACKS=5,LOOP=6,PING_PONG=7,REPEAT_COUNT=8,START_ON_LAYOUT=9,TRANSFORM_WITH_SCENE_GRAPH=10,USE_SYSTEM_TIMESCALE=11;C33.TimelineDataItem=class{constructor(e){this._name="",this._totalTime=NaN,this._step=0,this._interpolationMode="default",this._resultMode="default",this._loop=!1,this._pingPong=!1,this._repeatCount=1,this._trackData=null,this._startOnLayout="",this._transformWithSceneGraph=!1,this._useSystemTimescale=!0,e&&(this._name=e[NAME],this._totalTime=e[TOTAL_TIME],this._step=e[STEP],this._interpolationMode=e[INTERPOLATION_MODE],this._resultMode=e[RESULT_MODE],this._loop=!!e[LOOP],this._pingPong=!!e[PING_PONG],this._repeatCount=e[REPEAT_COUNT],this._startOnLayout=e[START_ON_LAYOUT],this._transformWithSceneGraph=!!e[TRANSFORM_WITH_SCENE_GRAPH],this._useSystemTimescale=!!e[USE_SYSTEM_TIMESCALE],this._trackData=new C33.TrackData(e[TRACKS],this))}Release(){this._trackData.Release(),this._trackData=null}GetTrackData(){return this._trackData||(this._trackData=new C33.TrackData(null,this)),this._trackData}GetName(){return this._name}SetName(e){this._name=e}GetTotalTime(){return this._totalTime}SetTotalTime(e){this._totalTime=e}GetStep(){return this._step}SetStep(e){this._step=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetLoop(){return this._loop}SetLoop(e){this._loop=e}GetPingPong(){return this._pingPong}SetPingPong(e){this._pingPong=e}GetRepeatCount(){return this._repeatCount}SetRepeatCount(e){this._repeatCount=e}GetStartOnLayout(){return this._startOnLayout}GetTransformWithSceneGraph(){return this._transformWithSceneGraph}GetUseSystemTimescale(){return this._useSystemTimescale}_SaveToJson(){return{trackDataJson:this._trackData._SaveToJson(),name:this._name,totalTime:this._totalTime,step:this._step,interpolationMode:this._interpolationMode,resultMode:this._resultMode,loop:this._loop,pingPong:this._pingPong,repeatCount:this._repeatCount,startOnLayout:this._startOnLayout,transformWithSceneGraph:!!this._transformWithSceneGraph,useSystemTimescale:this._useSystemTimescale}}_LoadFromJson(e){e&&(this.GetTrackData()._LoadFromJson(e.trackDataJson),this._name=e.name,this._totalTime=e.totalTime,this._step=e.step,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._loop=e.loop,this._pingPong=e.pingPong,this._repeatCount=e.repeatCount,this._startOnLayout=e.startOnLayout,this._transformWithSceneGraph=!!e.transformWithSceneGraph,this._useSystemTimescale=!!e.useSystemTimescale)}}}{const C33=self.C3,WI_DATA=0,OC_INDEX=1,WI_UID=2,INTERPOLATION_MODE=1,RESULT_MODE=2,ENABLED=3,KEYFRAMES=4,PROPERTY_TRACKS=5,ID=6,NESTED_DATA=7,START_OFFSET=0,LOCAL_TOTAL_TIME=1,WI_ADDITIONAL_DATA=8,ORIGINAL_WIDTH=0,ORIGINAL_HEIGHT=1,TRACK_TYPE=9,TRACK_NAME=10;class TrackDataItem{constructor(e,t){this._trackData=t,this._instanceData=null,this._additionalInstanceData=null,this._instanceUid=NaN,this._objectClassIndex=NaN,this._interpolationMode="default",this._resultMode="default",this._enabled=!1,this._keyframeData=null,this._propertyTrackData=null,this._id="",this._nestedData=null,this._startOffset=0,this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),this._type=0,this._name="",e&&(e[WI_DATA]&&(this._instanceData=e[WI_DATA],this._instanceUid=e[WI_DATA][WI_UID],this._objectClassIndex=e[WI_DATA][OC_INDEX]),this._interpolationMode=e[INTERPOLATION_MODE],this._resultMode=e[RESULT_MODE],this._enabled=!!e[ENABLED],e[ID]&&(this._id=e[ID]),e[NESTED_DATA]&&(this._nestedData=e[NESTED_DATA],this._startOffset=e[NESTED_DATA][START_OFFSET],this._localTotalTime=e[NESTED_DATA][LOCAL_TOTAL_TIME]),e[WI_ADDITIONAL_DATA]&&(this._additionalInstanceData=e[WI_ADDITIONAL_DATA]),e[WI_ADDITIONAL_DATA]&&(this._additionalInstanceData=e[WI_ADDITIONAL_DATA]),e[TRACK_TYPE]&&(this._type=e[TRACK_TYPE]),e[TRACK_NAME]&&(this._name=e[TRACK_NAME]),this._keyframeData=new C33.KeyframeData(e[KEYFRAMES],this),this._propertyTrackData=new C33.PropertyTrackData(e[PROPERTY_TRACKS],this))}Release(){this._instanceData=null,this._trackData=null,this._keyframeData&&(this._keyframeData.Release(),this._keyframeData=null),this._propertyTrackData&&(this._propertyTrackData.Release(),this._propertyTrackData=null),this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){return this._keyframeData||(this._keyframeData=new C33.KeyframeData(null,this)),this._keyframeData}GetPropertyTrackData(){return this._propertyTrackData||(this._propertyTrackData=new C33.PropertyTrackData(null,this)),this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(e){this._objectClassIndex=e}GetInstanceUID(){return this._instanceUid}SetInstanceUID(e){this._instanceUid=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(e){this._localTotalTime=e}GetOriginalWidth(){return this._additionalInstanceData[ORIGINAL_WIDTH]}SetOriginalWidth(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[ORIGINAL_WIDTH]=e}GetOriginalHeight(){return this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[ORIGINAL_HEIGHT]}SetOriginalHeight(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[ORIGINAL_HEIGHT]=e}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{keyframeDataJson:this._keyframeData._SaveToJson(),propertyTrackDataJson:this._propertyTrackData._SaveToJson(),instanceData:this._instanceData,additionalInstanceData:this._additionalInstanceData,instanceUid:this._instanceUid,objectClassIndex:this._objectClassIndex,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,id:this._id,nestedData:this._nestedData,type:this._type,name:this._name}}_LoadFromJson(e){e&&(this._instanceData=e.instanceData,this._instanceUid=e.instanceUid,this._objectClassIndex=e.objectClassIndex,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._id=e.id,this._type=e.type||0,this._name=e.name||"",this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),e.nestedData&&(this._nestedData=e.nestedData,this._startOffset=this._nestedData[START_OFFSET],this._localTotalTime=this._nestedData[LOCAL_TOTAL_TIME]),e.additionalInstanceData&&(this._additionalInstanceData=e.additionalInstanceData),this.GetKeyframeData()._LoadFromJson(e.keyframeDataJson),this.GetPropertyTrackData()._LoadFromJson(e.propertyTrackDataJson))}}C33.TrackData=class{constructor(e,t){this._timelineDataItem=t,this._trackDataItems=[],C33.TimelineDataManager._CreateDataItems(this._trackDataItems,e,TrackDataItem,this)}Release(){this._timelineDataItem=null;for(const e of this._trackDataItems)e.Release();C33.clearArray(this._trackDataItems),this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){const e=new TrackDataItem(null,this);return this._trackDataItems.push(e),e}GetFirstKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(e){const t=e.GetKeyframeData().GetKeyframeDataItemArray();return t.at(-1)}GetKeyFrameDataItemAtTime(t,e){const s=e.GetKeyframeData().GetKeyframeDataItemArray(),n=s.length;for(let e=0;e<n;e++){const i=s[e];if(i.GetTime()===t)return i}}GetFirstKeyFrameDataItemHigherThan(t,e){const s=e.GetKeyframeData().GetKeyframeDataItemArray(),n=s.length;for(let e=0;e<n;e++){const i=s[e];if(i.GetTime()>t)return i}}GetFirstKeyFrameDataItemHigherOrEqualThan(t,e){const s=e.GetKeyframeData().GetKeyframeDataItemArray(),n=s.length;for(let e=0;e<n;e++){const i=s[e];if(i.GetTime()>=t)return i}}GetFirstKeyFrameDataItemLowerOrEqualThan(t,e){const s=e.GetKeyframeData().GetKeyframeDataItemArray();for(let e=s.length-1;0<=e;e--){const n=s[e];if(n.GetTime()<=t)return n}}*trackDataItems(){for(const e of this._trackDataItems)yield e}_SaveToJson(){return{trackDataItemsJson:this._trackDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&C33.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,e.trackDataItemsJson,TrackDataItem,this)}}}{const C33=self.C3,SOURCE_DATA=0,SOURCE=0,PROPERTY=1,TYPE=2,MIN=3,MAX=4,INTERPOLATION_MODE=5,RESULT_MODE=6,ENABLED=7,PROPERTY_KEYFRAMES=8,CAN_HAVE_PROPERTY_KEYFRAMES=9;class PropertyTrackDataItem{constructor(e,t){this._propertyTrackData=t,this._sourceAdapterId="",this._sourceAdapterArguments=null,this._property=null,this._type=null,this._min=NaN,this._max=NaN,this._interpolationMode="default",this._resultMode="default",this._enabled=!1,this._propertyKeyframeData=null,this._canHavePropertyKeyframes=!0,e&&(this._sourceAdapterId=e[SOURCE_DATA][SOURCE],this._sourceAdapterArguments=e[SOURCE_DATA].slice(1),this._property=e[PROPERTY],this._type=e[TYPE],this._min=e[MIN],this._max=e[MAX],this._interpolationMode=e[INTERPOLATION_MODE],this._resultMode=e[RESULT_MODE],this._enabled=!!e[ENABLED],this._propertyKeyframeData=new C33.PropertyKeyframeData(e[PROPERTY_KEYFRAMES],this),this._canHavePropertyKeyframes=e[CAN_HAVE_PROPERTY_KEYFRAMES])}Release(){this._propertyKeyframeData.Release(),this._propertyKeyframeData=null,this._propertyTrackData=null,this._sourceAdapterArguments=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){return this._propertyKeyframeData||(this._propertyKeyframeData=new C33.PropertyKeyframeData(null,this)),this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(e){this._sourceAdapterId=e}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(e){this._sourceAdapterArguments=e}GetProperty(){return this._property}SetProperty(e){this._property=e}GetType(){return this._type}SetType(e){this._type=e}GetMin(){return this._min}SetMin(e){this._min=e}GetMax(){return this._max}SetMax(e){this._max=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{propertyKeyframeDataJson:this._propertyKeyframeData._SaveToJson(),sourceAdapterId:this._sourceAdapterId,sourceAdapterArguments:this._sourceAdapterArguments,property:this._property,type:this._type,min:this._min,max:this._max,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,canHavePropertyKeyframes:this._canHavePropertyKeyframes}}_LoadFromJson(e){e&&(this._sourceAdapterId=e.sourceAdapterId,this._sourceAdapterArguments=e.sourceAdapterArguments,this._property=e.property,this._type=e.type,this._min=e.min,this._max=e.max,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._canHavePropertyKeyframes=e.canHavePropertyKeyframes,this.GetPropertyKeyframeData()._LoadFromJson(e.propertyKeyframeDataJson))}}C33.PropertyTrackData=class{constructor(e,t){this._trackDataItem=t,this._propertyTrackDataItems=[],C33.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,e,PropertyTrackDataItem,this)}Release(){this._trackDataItem=null;for(const e of this._propertyTrackDataItems)e.Release();C33.clearArray(this._propertyTrackDataItems),this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){const e=new PropertyTrackDataItem(null,this);return this._propertyTrackDataItems.push(e),e}GetFirstPropertyKeyframeDataItem(e){const t=e.GetPropertyKeyframeData();return t.GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(e){const t=e.GetPropertyKeyframeData(),s=t.GetPropertyKeyframeDataItemArray();return s.at(-1)}GetPropertyKeyFrameDataItemAtTime(t,e){const s=e.GetPropertyKeyframeData(),n=s.GetPropertyKeyframeDataItemArray(),i=n.length;for(let e=0;e<i;e++){const r=n[e];if(r.GetTime()===t)return r}}GetFirstPropertyKeyFrameDataItemHigherThan(t,e){const s=e.GetPropertyKeyframeData(),n=s.GetPropertyKeyframeDataItemArray(),i=n.length;for(let e=0;e<i;e++){const r=n[e];if(r.GetTime()>t)return r}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(t,e){const s=e.GetPropertyKeyframeData(),n=s.GetPropertyKeyframeDataItemArray(),i=n.length;for(let e=0;e<i;e++){const r=n[e];if(r.GetTime()>=t)return r}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(t,e){const s=e.GetPropertyKeyframeData(),n=s.GetPropertyKeyframeDataItemArray();for(let e=n.length-1;0<=e;e--){const i=n[e];if(i.GetTime()<=t)return i}}*propertyTrackDataItems(){for(const e of this._propertyTrackDataItems)yield e}_SaveToJson(){return{propertyTrackDataItemsJson:this._propertyTrackDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&C33.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,e.propertyTrackDataItemsJson,PropertyTrackDataItem,this)}}}{const C33=self.C3,TIME=0,EASE=1,ENABLE=2,TAGS=3;class KeyframeDataItem{constructor(e,t){if(this._keyframeData=t,this._time=-1,this._ease="noease",this._enable=!1,this._tags=null,this._lowerTags=null,e){this._time=e[TIME],this._ease=e[EASE],this._enable=!!e[ENABLE];const s=e[TAGS];this._tags=s?s.split(" "):[],this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase())),this._next=null}}Release(){this._keyframeData=null,C33.clearArray(this._tags),this._tags=null,this._lowerTags.clear(),this._lowerTags=null,this._next=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(e){this._next=e}GetTime(){return this._time}SetTime(e){this._time=e,this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetTags(){return this._tags}SetTags(e){this._tags=e?e.split(" "):[],this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase()))}GetLowerTags(){return this._lowerTags}HasTag(e){return this._lowerTags.has(e.toLowerCase())}_SaveToJson(){return{time:this._time,ease:this._ease,enable:this._enable,tags:this._tags}}_LoadFromJson(e){e&&(this._time=e.time,this._ease=e.ease,this._enable=e.enable,this._tags=e.tags,this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase())))}}C33.KeyframeData=class{constructor(e,t){this._trackDataItem=t,this._keyframeDataItems=[],C33.TimelineDataManager._CreateDataItems(this._keyframeDataItems,e,KeyframeDataItem,this),this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(const e of this._keyframeDataItems)e.Release();C33.clearArray(this._keyframeDataItems),this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<this._keyframeDataItems.length;e++){const t=this._keyframeDataItems[e];t.SetNext(this._keyframeDataItems[e+1])}}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){const e=new KeyframeDataItem(null,this);return this._keyframeDataItems.push(e),this._LinkKeyframeDataItems(),e}DeleteKeyframeDataItems(e){for(const t of this._keyframeDataItems)if(e(t)){const s=this._keyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._keyframeDataItems.splice(s,1))}this.SortKeyframeDataItems(),this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime())}GetKeyframeDataItemIndex(e){return this._keyframeDataItems.indexOf(e)}GetKeyframeDataItemFromIndex(e){return this._keyframeDataItems[e]}*keyframeDataItems(){for(const e of this._keyframeDataItems)yield e}*keyframeDataItemsReverse(){for(let e=this._keyframeDataItems.length-1;0<=e;e--)yield this._keyframeDataItems[e]}_SaveToJson(){return{keyframeDataItemsJson:this._keyframeDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&(C33.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,e.keyframeDataItemsJson,KeyframeDataItem,this),this._LinkKeyframeDataItems())}}}{const C33=self.C3,VALUE_DATA=0,VALUE_DATA_VALUE=0,VALUE_DATA_ABSOLUTE_VALUE=1,VALUE_DATA_TYPE=2,TIME=1,EASE=2,ENABLE=3,ADDONS=4,PATH_MODE=5;class PropertyKeyframeDataItem{constructor(e,t){this._propertyKeyframeData=t,this._value=null,this._aValue=null,this._type="",this._time=NaN,this._ease="noease",this._enable=!1,this._addonData=null,this._addonInstance=void 0,this._pathMode="line",e&&(this._value=e[VALUE_DATA][VALUE_DATA_VALUE],this._aValue=e[VALUE_DATA][VALUE_DATA_ABSOLUTE_VALUE],this._type=e[VALUE_DATA][VALUE_DATA_TYPE],this._time=e[TIME],this._ease=e[EASE],this._enable=!!e[ENABLE],this._pathMode=e[PATH_MODE],this._addonData=null,e[ADDONS]&&(this._addonData=new C33.AddonData(e[ADDONS],this)),this._next=null,this._prev=null)}Release(){this._propertyKeyframeData=null,this._addonData&&(this._addonData.Release(),this._addonData=null),this._next=null,this._prev=null}GetAddonData(){return this._addonData}SetNext(e){this._next=e}GetNext(){return this._next}SetPrevious(e){this._prev=e}GetPrevious(){return this._prev}GetValue(){return this._value}SetValue(e){"color"===this._type&&C33.IsFiniteNumber(e)?(this._value[0]=C33.GetRValue(e),this._value[1]=C33.GetGValue(e),this._value[2]=C33.GetBValue(e)):this._value=e}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(e){"color"===this._type&&C33.IsFiniteNumber(e)?(this._aValue[0]=C33.GetRValue(e),this._aValue[1]=C33.GetGValue(e),this._aValue[2]=C33.GetBValue(e)):this._aValue=e}GetValueWithResultMode(){const e=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();return"relative"===e?this.GetValue():"absolute"===e?this.GetAbsoluteValue():void 0}GetType(){return this._type}SetType(e){this._type=e}GetTime(){return this._time}SetTime(e){this._time=e,this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetPathMode(){return this._pathMode}GetAddOn(t){if(this._addonData){if(!this._addonInstance&&null!==this._addonInstance){const s=this._addonData.GetAddDataItemArray();if(s){const n=s.length;for(let e=0;e<n;e++){const i=s[e];if(i.GetId()===t)return this._addonInstance=i,this._addonInstance}}this._addonInstance=null}return this._addonInstance}}_SaveToJson(){const e=this._addonData;return{addonDataJson:e&&e._SaveToJson(),value:this._value,aValue:this._aValue,type:this._type,time:this._time,ease:this._ease,enable:this._enable}}_LoadFromJson(e){e&&(e.addonDataJson&&this._addonData._SetFromJson(e.addonDataJson),this._value=e.value,this._aValue=e.aValue,this._type=e.type,this._time=e.time,this._ease=e.ease,this._enable=e.enable)}}C33.PropertyKeyframeData=class{constructor(e,t){this._propertyTrackDataItem=t,this._propertyKeyframeDataItems=[],this._propertyKeyframeDataItemsIncludingDisabled=[],C33.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,e,PropertyKeyframeDataItem,this),C33.TimelineDataManager._CreateDataItemsIncludingDisabled(this._propertyKeyframeDataItemsIncludingDisabled,e,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=null;for(const e of this._propertyKeyframeDataItems)e.Release();C33.clearArray(this._propertyKeyframeDataItems),this._propertyKeyframeDataItems=null;for(const t of this._propertyKeyframeDataItemsIncludingDisabled)t.Release();C33.clearArray(this._propertyKeyframeDataItemsIncludingDisabled),this._propertyKeyframeDataItemsIncludingDisabled=null}_LinkPropertyKeyframeDataItems(){let t=this._propertyKeyframeDataItems;t.sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<t.length;e++){const s=t[e];e+1<t.length&&s.SetNext(t[e+1]),0<=e-1&&s.SetPrevious(t[e-1])}(t=this._propertyKeyframeDataItemsIncludingDisabled).sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<t.length;e++){const n=t[e];e+1<t.length&&n.SetNext(t[e+1]),0<=e-1&&n.SetPrevious(t[e-1])}}AddEmptyPropertyKeyframeDataItem(){const e=new PropertyKeyframeDataItem(null,this);return this._propertyKeyframeDataItems.push(e),this._LinkPropertyKeyframeDataItems(),e}DeletePropertyKeyframeDataItems(e){for(const t of this._propertyKeyframeDataItems)if(e(t)){const s=this._propertyKeyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._propertyKeyframeDataItems.splice(s,1))}this.SortPropertyKeyFrameDataItems(),this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime())}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-1]}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyKeyframeDataItemsIncludingDisabled}*propertyKeyframeDataItems(){for(const e of this._propertyKeyframeDataItems)yield e}*propertyKeyframeDataItemsReverse(){for(let e=this._propertyKeyframeDataItems.length-1;0<=e;e--)yield this._propertyKeyframeDataItems[e]}_SaveToJson(){const e=this._propertyKeyframeDataItems,t=this._propertyKeyframeDataItemsIncludingDisabled;return{propertyKeyframeDataItemsJson:e.map(e=>e._SaveToJson()),propertyKeyframeDataItemsIncludingDisabledJson:t.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&(C33.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,e.propertyKeyframeDataItemsJson,PropertyKeyframeDataItem,this),C33.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItemsIncludingDisabled,e.propertyKeyframeDataItemsIncludingDisabledJson,PropertyKeyframeDataItem,this),this._LinkPropertyKeyframeDataItems())}}}{const C33=self.C3,ADDON_ID=0,ADDON_DATA=1;class AddonDataItem{constructor(e,t){this._addonData=t,this._id=e[ADDON_ID],this._data=e[ADDON_DATA]}Release(){this._addonData=null,this._data=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{id:this._id,data:this._data}}_LoadFromJson(e){e&&(this._id=e.id,this._data=e.data)}}const START_ANCHOR=0,START_ENABLE=1,END_ANCHOR=2,END_ENABLE=3;class AddonDataCubicBezierItem extends AddonDataItem{constructor(e,t){super(e,t),this._startAnchor=this._data[START_ANCHOR],this._startEnable=!!this._data[START_ENABLE],this._endAnchor=this._data[END_ANCHOR],this._endEnable=!!this._data[END_ENABLE]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{startAnchor:this._startAnchor,startEnable:!!this._startEnable,endAnchor:this._endAnchor,endEnable:!!this._endEnable})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._startAnchor=e.startAnchor,this._startEnable=!!e.startEnable,this._endAnchor=e.endAnchor,this._endEnable=!!e.endEnable)}}const DIRECTION=0,REVOLUTIONS=1;class AddonDataAngleItem extends AddonDataItem{constructor(e,t){super(e,t),this._direction=this._data[DIRECTION],this._revolutions=this._data[REVOLUTIONS]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{direction:this._direction,revolutions:this._revolutions})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._direction=e.direction,this._revolutions=e.revolutions)}}C33.AddonData=class{constructor(e,t){this._propertyKeyframeDataItem=t,this._addonDataItems=[],C33.TimelineDataManager._CreateDataItems(this._addonDataItems,e,{prop:0,map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}Release(){this._propertyKeyframeDataItem=null;for(const e of this._addonDataItems)e.Release();C33.clearArray(this._addonDataItems),this._addonDataItems=null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(const e of this._addonDataItems)yield e}_SaveToJson(){return{addonDataItemsJson:this._addonDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(e){e&&C33.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,e.addonDataItemsJson,{prop:"id",map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this)}}}{let C33=self.C3,INITIAL_VALUE_MODE_START_VALUE="start-value",INITIAL_VALUE_MODE_CURRENT_STATE="current-state",PING_PONG_BEGIN=0,PING_PONG_END=1,createdTweens=0;C33.TweenState=class extends C33.TimelineState{constructor(e,t){super("tween-"+createdTweens++,e,t),this._id="",this._destroyInstanceOnComplete=!1,this._initialValueMode=INITIAL_VALUE_MODE_START_VALUE,this._instance=null,this._on_completed_callbacks=null,this._on_started_callbacks=null,this._track=null,this._iTweenState=null}FireReleaseEvent(e){const t=C33.New(C33.Event,"tweenstatereleased");t.tweenState=this,e.dispatchEvent(t)}GetType(){return 1}CreateTrackStates(){for(const e of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(C33.TweenTrackState.Create(this,e));this._track=this._tracks[0]}AddTrack(){const e=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem(),t=C33.TweenTrackState.Create(this,e);return this._tracks.push(t),this._CacheTrack(),t}_CacheTrack(){this._track=this._tracks[0]}GetPropertyTrack(e){return this._track.GetPropertyTracks()[0]}SetPropertyType(e){this._propertyType=e}GetInstance(){const e=this.GetTracks();if(e&&e.length){const t=e[0];if(this._track=t){const s=t.GetInstance();return t.IsInstanceValid()?s:void 0}}}AddStartedCallback(e){this._on_started_callbacks||(this._on_started_callbacks=[]),this._on_started_callbacks.push(e)}AddCompletedCallback(e){this._on_completed_callbacks||(this._on_completed_callbacks=[]),this._on_completed_callbacks.push(e)}RemoveStartedCallback(e){if(this._on_started_callbacks){const t=this._on_started_callbacks.indexOf(e);-1!==t&&this._on_started_callbacks.splice(t,1)}}RemoveCompletedCallback(e){if(this._on_completed_callbacks){const t=this._on_completed_callbacks.indexOf(e);-1!==t&&this._on_completed_callbacks.splice(t,1)}}SetStartValue(e,t){for(const s of this._tracks)for(const n of s._propertyTracks)if(n.GetPropertyName()===t){const i=n.GetPropertyTrackData(),r=n.GetPropertyTrackDataItem(),a=i.GetFirstPropertyKeyframeDataItem(r);a.SetValue(e),a.SetAbsoluteValue(e)}}_GetPropertyTrackState(e){for(const t of this._tracks)for(const s of t._propertyTracks)if(s.GetPropertyName()===e)return s}BeforeSetEndValues(e){for(const t of e){const s=this._GetPropertyTrackState(t);this.SetStartValue(s.GetCurrentState(),t)}if(this.IsForwardPlayBack()){const n=this.GetTotalTime()-this.GetTime();this.SetTotalTime(n);for(const i of this._tracks)i.SetLocalTotalTime(n);this._SetTime(0)}else{const r=this.GetTime();this.SetTotalTime(r);for(const a of this._tracks)a.SetLocalTotalTime(r);this._SetTime(r)}this.SetInitialStateFromSetTime()}SetEndValue(e,t){const s=this._GetPropertyTrackState(t),n=s.GetPropertyTrackData(),i=s.GetPropertyTrackDataItem(),r=n.GetLastPropertyKeyframeDataItem(i);r.SetTime(this.GetTotalTime()),r.SetValue(e),r.SetAbsoluteValue(e)}SetId(e){this._id=e}GetId(){return this._id}SetInitialValueMode(e){this._initialValueMode=e}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(e){this._destroyInstanceOnComplete=e}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(const e of this._on_started_callbacks)e(this);if(!this.IsComplete())for(const t of this._tracks)t.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(!this._finishedTriggers&&(this._finishedTriggers=!0,this._on_completed_callbacks))for(const e of this._on_completed_callbacks)e(this)}SetTime(e){this._DeleteIntermediateKeyframes(),super.SetTime(e)}_SetTimeAndReset(e){(e=C33.IsFiniteNumber(e)?e:this.GetTotalTime())<0?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e,this._track.SetResetState()}SetInitialState(e){if(!this.InitialStateSet()&&this.GetInitialValueMode()===INITIAL_VALUE_MODE_CURRENT_STATE)for(const t of this._tracks)t.CompareInitialStateWithCurrent();super.SetInitialState(e)}Stop(e=!1){if(super.Stop(e),!this.IsComplete())for(const t of this._tracks)t.SaveState()}Reset(e=!0,t=!1){this._DeleteIntermediateKeyframes(),super.Reset(e,t)}_DeleteIntermediateKeyframes(){for(const e of this._tracks){const t=e=>{const t=e.GetTime(),s=this.GetTotalTime();return 0!==t&&t!==s};e.DeleteKeyframes(t),e.DeletePropertyKeyframes(t)}}_OnBeforeChangeLayout(){if(!this.IsReleased()){const e=this.GetInstance();if(e&&e.GetObjectClass().IsGlobal())return!1;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.ResetBeforeChangeLayout()}return!0}Tick(i,e,t){if(this._instance||(this._instance=this.GetInstance()),!this._instance||this._instance.IsDestroyed())this.Stop(!0),this.OnCompleted();else{const s=this._instance.GetTimeScale();if(0!==(i=-1!==s?t*s:i)||0!==this._lastDelta){this._lastDelta=i;const r=this._playheadTime+this._overshoot,a=i*this._playbackRate,o=r+a,l=this._timelineDataItem._totalTime;o<0?(this._playheadTime=0,this._overshoot=-o):l<=o?(this._playheadTime=l,this._overshoot=this._playheadTime-o):(this._playheadTime=o,this._overshoot=0);let e=!1,t=!1,s=this.GetLoop(),n=this.GetPingPong();s||n?s&&!n?0<this._playbackRate?this._playheadTime>=l&&(this._SetTimeAndReset(0),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):this._playheadTime<=0&&(this._SetTimeAndReset(l),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):!s&&n?0<this._playbackRate?this._playheadTime>=l&&(this._SetTime(l),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_BEGIN):(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),e=!0):this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_END)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_END?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_BEGIN):(e=!0,this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)):this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong),this._pingPongState=PING_PONG_END)):s&&n&&(0<this._playbackRate?this._playheadTime>=l&&(this._SetTime(l),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState===PING_PONG_END&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState++,this._pingPongState=C33.wrap(this._pingPongState,0,2)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),t=!0,this._pingPongState===PING_PONG_BEGIN&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState===PING_PONG_END&&(this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenPingPong),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensPingPong)),this._pingPongState++,this._pingPongState=C33.wrap(this._pingPongState,0,2))):0<this._playbackRate?this._playheadTime>=l&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):(this._SetTime(l),e=!0)):this._playheadTime<=0&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(l),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnAnyTweenLoop),this._TweenTrigger(C33.Behaviors.Tween.Cnds.OnTweensLoop),t=!0):(this._SetTime(0),e=!0)),e?(this._track.SetEndState(),this.Stop(!0),this.OnCompleted()):(this._track.Interpolate(this._playheadTime,!0,!1,t,this._firstTick,!1),this._firstTick&&(this._firstTick=!1))}}}_TweenTrigger(e){const t=this.GetInstance(),s=t.GetBehaviorSdkInstanceFromCtor(C33.Behaviors.Tween);s.PushTriggerTween(this),this._runtime.Trigger(e,t,s.GetBehaviorType()),s.PopTriggerTween()}_SaveToJson(){const e=super._SaveToJson(),t=this.GetTimelineDataItem();return Object.assign(e,{tweenDataItemJson:t._SaveToJson(),id:this._id,destroyInstanceOnComplete:this._destroyInstanceOnComplete,initialValueMode:this._initialValueMode})}_LoadFromJson(e){if(e){const t=this.GetTimelineDataItem();t._LoadFromJson(e.tweenDataItemJson),super._LoadFromJson(e),this._id=e.id,this._destroyInstanceOnComplete=e.destroyInstanceOnComplete,this._initialValueMode=e.initialValueMode,this._CacheTrack()}}static IsPlaying(e){return e.IsPlaying()}static IsPaused(e){return e.IsPaused()}static IsPing(e){return!!e.GetPingPong()&&e.GetPingPongState()===PING_PONG_BEGIN}static IsPong(e){return!!e.GetPingPong()&&e.GetPingPongState()===PING_PONG_END}static Build(e){const t=e.runtime.GetTimelineManager(),s=new C33.TimelineDataItem;if(e.json){s._LoadFromJson(e.json.tweenDataItemJson);const n=new C33.TweenState(s,t);return n._LoadFromJson(e.json),n}{const i=new C33.TweenState(s,t),r=(C33.IsArray(e.propertyTracksConfig)||(e.propertyTracksConfig=[e.propertyTracksConfig]),i.SetId(e.id),i.SetTags(e.tags),i.SetInitialValueMode(e.initialValueMode),i.SetDestroyInstanceOnComplete(e.releaseOnComplete),i.SetLoop(e.loop),i.SetPingPong(e.pingPong),i.SetTotalTime(e.time),i.SetStep(0),i.SetInterpolationMode("default"),i.SetResultMode(e.propertyTracksConfig[0].resultMode),i.SetRepeatCount(e.repeatCount),i.AddTrack()),a=(r.SetInstanceUID(e.instance.GetUID()),r.SetInterpolationMode("default"),r.SetResultMode(e.propertyTracksConfig[0].resultMode),r.SetEnable(!0),r.SetObjectClassIndex(e.instance.GetObjectClass().GetIndex()),e.instance.GetSdkInstance()),o=a.IsOriginalSizeKnown()?a.GetOriginalWidth():e.instance.GetWorldInfo().GetWidth(),l=a.IsOriginalSizeKnown()?a.GetOriginalHeight():e.instance.GetWorldInfo().GetHeight(),h=(r.SetOriginalWidth(o),r.SetOriginalHeight(l),r.AddKeyframe()),c=(h.SetTime(0),h.SetEase("noease"),h.SetEnable(!0),h.SetTags(""),r.AddKeyframe());c.SetTime(e.time),c.SetEase("noease"),c.SetEnable(!0),c.SetTags("");for(const u of e.propertyTracksConfig){const d=r.AddPropertyTrack(),_=(d.SetSourceAdapterId(u.sourceId),d.SetSourceAdapterArgs(u.sourceArgs),d.SetPropertyName(u.property),d.SetPropertyType(u.type),d.SetMin(NaN),d.SetMax(NaN),d.SetInterpolationMode("default"),d.SetResultMode(u.resultMode),d.SetEnable(!0),d.AddPropertyKeyframe()),p=(_.SetType(u.valueType),_.SetTime(0),_.SetEase(u.ease),_.SetEnable(!0),_.SetValue(u.startValue),_.SetAbsoluteValue(u.startValue),d.AddPropertyKeyframe());p.SetType(u.valueType),p.SetTime(e.time),p.SetEase(u.ease),p.SetEnable(!0),p.SetValue(u.endValue),p.SetAbsoluteValue(u.endValue),d.GetSourceAdapter()}return i}}static SetInstanceUID(e,t){if(!isNaN(t))for(const s of e.GetTracks())s.SetInstanceUID(t)}GetITweenState(e,t){return this._iTweenState||(this._iTweenState=C33.New(self.ITweenState,this,e,t)),this._iTweenState}}}{const C33=self.C3;C33.TweenTrackState=class extends C33.TrackState{constructor(e,t){super(e,t),this._firstPropertyTrack=null,this._secondPropertyTrack=null}static Create(e,t){return C33.New(C33.TweenTrackState,e,t)}_CachePropertyTracks(){1===this._propertyTracks.length?this._firstPropertyTrack=this._propertyTracks[0]:(this._firstPropertyTrack=this._propertyTracks[0],this._secondPropertyTrack=this._propertyTracks[1])}CreatePropertyTrackStates(){for(const e of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(C33.TweenPropertyTrackState.Create(this,e));this._CachePropertyTracks()}AddPropertyTrack(){const e=this._trackDataItem.GetPropertyTrackData(),t=e.AddEmptyPropertyTrackDataItem(),s=C33.TweenPropertyTrackState.Create(this,t);return this._propertyTracks.push(s),this._CachePropertyTracks(),s}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){const e=this.GetTimeline(),t=e.IsForwardPlayBack(),s=t?0:this.GetLocalTotalTime();for(const i of this._propertyTracks)i.SetInitialState(s),0===this._worldInfoChange&&1===i.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===i.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;const n=this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter());n&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(s),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this.Interpolate(s)}}BeforeInterpolate(){}Interpolate(e,t=0,s=!1,n=!1,i,r=!1,a=!1){if(this._instance||this.GetInstance(),this._instance){const o=!this._instance.IsDestroyed();return o&&(!r||!this.GetObjectClass().IsGlobal())&&((this._secondPropertyTrack?(this._firstPropertyTrack.Interpolate(e,s,n,a),this._secondPropertyTrack):this._firstPropertyTrack).Interpolate(e,s,n,a),void(0!==this._firstPropertyTrack.GetWorldInfoChange()&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo)&&this._worldInfo.SetBboxChanged()))}}AfterInterpolate(){}_LoadFromJson(e){super._LoadFromJson(e),this._CachePropertyTracks()}}}{const C33=self.C3;C33.TweenPropertyTrackState=class extends C33.PropertyTrackState{constructor(e,t){super(e,t),this._basic=!1}static Create(e,t){return C33.New(C33.TweenPropertyTrackState,e,t)}Interpolate(e,t=!1,s=!1,n=!1){let i,r;if(this._basic)i=this._propertyKeyframeDataItems[0],r=this._propertyKeyframeDataItems[1];else{if(t)i=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){const a=this.GetTimeline(),o=this._lastPropertyKeyframeDataItem.GetNext(),l=this._lastPropertyKeyframeDataItem.GetTime(),h=o?o.GetTime():a.GetTotalTime();(e<=l||h<=e)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);i=this._lastPropertyKeyframeDataItem}r=i.GetNext()}this._sourceAdapter.Interpolate(e,i,r,t,s,n)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData(),t=e.AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,this._basic=this.GetPropertyKeyframeDataItems().length<=2,t}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null;const t=this._propertyTrackDataItem.GetPropertyKeyframeData();t.DeletePropertyKeyframeDataItems(e),this._basic=this.GetPropertyKeyframeDataItems().length<=2}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson(),basic:this._basic}}_LoadFromJson(e){e&&(this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson),this._basic=e.basic)}}}{const C33=self.C3,Ease=self.Ease,NAME=0,TRANSITION_KEYFRAMES=1,LINEAR=2;C33.Transition=class extends C33.DefendedBase{constructor(e,t=!0){super(),this._name=e[NAME],this._linear=e[LINEAR],this._transitionKeyframes=[];for(const s of e[TRANSITION_KEYFRAMES]){const n=C33.TransitionKeyframe.Create(this,s);this._transitionKeyframes.push(n)}for(let e=0;e<this._transitionKeyframes.length;e++){const i=this._transitionKeyframes[e],r=this._transitionKeyframes[e+1],a=this._transitionKeyframes[e-1];i.SetNext(r),i.SetPrevious(a)}this._precalculatedSamples=new Map,this._transitionKeyframeCache=new Map,this._PreCalcSamples(),t&&Ease.AddCustomEase(this._name,(e,t,s,n)=>this.Interpolate(e,t,s,n),null,{transition:this})}static Create(e){return C33.New(C33.Transition,e)}Release(){for(const e of this._transitionKeyframes)e.Release();C33.clearArray(this._transitionKeyframes),this._transitionKeyframes=null,this._precalculatedSamples.clear(),this._precalculatedSamples=null,this._transitionKeyframeCache.clear(),this._transitionKeyframeCache=null}MakeLinear(e){this._linear=!!e}GetTransitionKeyFrameAt(e){const t=this._transitionKeyframeCache.get(e);if(t)return t;for(const s of this._transitionKeyframes)if(s.GetValueX()===e)return this._transitionKeyframeCache.set(e,s),s}GetFirstTransitionKeyFrameLowerOrEqualThan(t){for(let e=this._transitionKeyframes.length-1;0<=e;e--){const s=this._transitionKeyframes[e],n=s.GetValueX();if(n<=t){let e=s;if(n<t)return e;if(n===t){for(;e;){const i=e.GetPrevious();if(!i)break;if(i.GetValueX()!==e.GetValueX())break;e=i}return e}}}}Interpolate(e,t,s,n){let i=e/n;if(this._linear){const S=this.GetTransitionKeyFrameAt(0),y=this.GetTransitionKeyFrameAt(1),C=t+(t+s)*S.GetValueY(),G=(t+s)*y.GetValueY(),T=G-C;return 0===n?C+T:Ease.NoEase(e,C,T,n)}0===n&&(i=1);let r=this.GetFirstTransitionKeyFrameLowerOrEqualThan(i),a=r.GetNext();if(!a){const I=r.GetPrevious(),b=r;r=I,a=b}const o=a.GetValueX()-r.GetValueX(),l=C33.mapToRange(i,r.GetValueX(),a.GetValueX(),0,o);if(r.IsSegmentLinear()||0==o){const A=t+(t+s)*r.GetValueY(),P=(t+s)*a.GetValueY(),E=P-A;return 0==o?1===l?A+E:A:Ease.NoEase(l,A,E,o)}let h=r.GetValueX(),c=r.GetValueY(),u=r.GetValueX()+r.GetStartAnchorX(),d=r.GetValueY()+r.GetStartAnchorY(),_=a.GetValueX()+a.GetEndAnchorX(),p=a.GetValueY()+a.GetEndAnchorY(),m=a.GetValueX(),g=a.GetValueY(),f=Ease.GetRuntimeEase("spline")(l,h,c,u,d,_,p,m,g,this._precalculatedSamples.get(r));return(1-(f+=r.GetValueY()))*t+f*(t+s)}_PreCalcSamples(){this._precalculatedSamples.clear();for(let e=0;e<this._transitionKeyframes.length-1;e++){const t=this._transitionKeyframes[e];if(t.GetStartEnable()){const s=t,n=this._transitionKeyframes[e+1];if(n.GetEndEnable()){const i=s.GetValueX(),r=s.GetValueX()+s.GetStartAnchorX(),a=n.GetValueX()+n.GetEndAnchorX(),o=n.GetValueX();this._precalculatedSamples.set(s,Ease.GetBezierSamples(i,r,a,o))}}}}}}{const C33=self.C3,VALUE_X=0,VALUE_Y=1,START_ANCHOR_X=2,START_ANCHOR_Y=3,END_ANCHOR_X=4,END_ANCHOR_Y=5,START_ENABLE=6,END_ENABLE=7,SEGMENT_MODE=8;C33.TransitionKeyframe=class extends C33.DefendedBase{constructor(e,t){super(),this._transition=e,this._valueX=t[VALUE_X],this._valueY=t[VALUE_Y],this._startAnchorX=t[START_ANCHOR_X],this._startAnchorY=t[START_ANCHOR_Y],this._endAnchorX=t[END_ANCHOR_X],this._endAnchorY=t[END_ANCHOR_Y],this._startEnable=t[START_ENABLE],this._endEnable=t[END_ENABLE],this._segmentMode=t[SEGMENT_MODE],this._next=null,this._prev=null}Release(){this._transition=null}static Create(e,t){return C33.New(C33.TransitionKeyframe,e,t)}SetNext(e){this._next=e}GetNext(){return this._next}SetPrevious(e){this._prev=e}GetPrevious(){return this._prev}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}IsSegmentLinear(){return"linear"===this._segmentMode}IsSegmentCubic(){return"cubic"===this._segmentMode}}}{const C33=self.C3;C33.TransitionManager=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._transitions=[]}Release(){for(const e of this._transitions)e.Release();C33.clearArray(this._transitions),this._transitions=null}Create(e){this._transitions.push(C33.Transition.Create(e))}}}{const C33=self.C3;C33.TemplateManager=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._templateDataMap=null,this._instanceToTemplateNameMap=null,this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance)}Release(){if(this.RemoveRuntimeListeners(),this._templateDataMap){for(const e of this._templateDataMap.values())e.clear();this._templateDataMap.clear()}this._templateDataMap=null,this._runtime=null}Create(e){if(this._templateDataMap||(this._templateDataMap=new Map),e){const t=e[0][16],s=t[0],n=e[1],i=(this._templateDataMap.has(n)||this._templateDataMap.set(n,new Map),this._templateDataMap.get(n));i.set(s,e)}}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e&&e.addEventListener("instancedestroy",this._instanceDestroy)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e&&e.removeEventListener("instancedestroy",this._instanceDestroy)}HasTemplates(){return!!this._templateDataMap&&0!==this._templateDataMap.size}GetTemplateData(e,t){let s;if(s=e instanceof C33.ObjectClass?e.GetIndex():e,this._templateDataMap.has(s)){const n=this._templateDataMap.get(s).get(t);return n?JSON.parse(JSON.stringify(n)):void 0}}MapInstanceToTemplateName(e,t){this._instanceToTemplateNameMap||(this._instanceToTemplateNameMap=new WeakMap),this._instanceToTemplateNameMap.has(e)||this._instanceToTemplateNameMap.set(e,t)}GetInstanceTemplateName(e){if(!this._instanceToTemplateNameMap)return"";const t=this._instanceToTemplateNameMap.get(e);return t||""}_OnInstanceDestroy(e){this._instanceToTemplateNameMap&&this._instanceToTemplateNameMap.has(e)&&this._instanceToTemplateNameMap.delete(e)}}}{const C33=self.C3;C33.FlowchartManager=class{constructor(e){this._runtime=e,this._flowchartDataManager=new C33.FlowchartDataManager}Release(){this._flowchartDataManager.Release(),this._flowchartDataManager=null,this._runtime=null}GetRuntime(){return this._runtime}Create(e){this._flowchartDataManager.Add(e)}GetFlowchartDataItemByName(e){return this._flowchartDataManager.Get(e)}HasFlowcharts(){return this._flowchartDataManager.HasFlowcharts()}}}{const C33=self.C3;C33.FlowchartState=class{constructor(e,t,s,n,i,r,a){this._runtime=i.GetRuntime(),this._flowchartManager=i,this._flowchartName=e,this._startNodeTag=s,this._flowchartDataItem=n,this._tag=t,this._pluginInstance=r,this._pluginUID=a??r.GetInstance().GetUID(),this._SetStartFlowchartNode(),this._currentFlowchartNodeId=this._startFlowchartNode?.GetFlowchartId()??-1,this._previousFlowchartNodeIds=[],this._previousFlowchartState=null,this._previousFlowchartStateStartNodeId=NaN,this._referenceFlowchartStates=null,this._currentReferenceFlowchartState=null,this._rootFlowchartState=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._currentReferenceFlowchartStateTag="",this._rootFlowchartStateTag="",this._triggerCount=0,this._markForRelease=!1,this._released=!1}Release(){this._released||(C33.clearArray(this._previousFlowchartNodeIds),this._previousFlowchartNodeIds=null,this._runtime=null,this._flowchartManager=null,this._flowchartDataItem=null,this._pluginInstance=null,this._previousFlowchartState=null,this._previousFlowchartStateStartNodeId=NaN,this._referenceFlowchartStates&&this._referenceFlowchartStates.clear(),this._referenceFlowchartStates=null,this._currentReferenceFlowchartState=null,this._rootFlowchartState=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._currentReferenceFlowchartStateTag="",this._rootFlowchartStateTag="",this._released=!0)}WasReleased(){return this._released}GetFlowchartManager(){return this._flowchartManager}GetRuntime(){return this._runtime}GetName(){return this._flowchartName}GetFlowchartDataItem(){return this._flowchartDataItem}GetTag(){return this._tag}GetPluginInstance(){return this._pluginInstance||(this._pluginInstance=this._runtime.GetInstanceByUID(this._pluginUID).GetSdkInstance()),this._pluginInstance}GetCurrentNode(){return this.GetFlowchartElementById(this._currentFlowchartNodeId)}GetCurrentNodeTag(){const e=this.GetCurrentNode();return e?e.GetTag():""}GetCurrentNodeTags(){const e=this.GetCurrentNode();return e?e.GetTags():[]}CurrentNodeHasTags(e){const t=this.GetCurrentNodeTags();if(!t)return!1;if(!t.length)return!1;const s=C33.FlowchartState._GetTagArray(e);return!(!s||!s.length)&&s.every(C33.FlowchartState._HasTag,t)}CurrentNodeCompareTags(e,t){const s=this.GetCurrentNodeTags();if(!s)return!1;if(!s.length)return!1;const n=C33.FlowchartState._GetTagArray(e);return!(!n||!n.length)&&n.every(e=>C33.FlowchartState._CompareTag.call(s,e,t))}static _HasTag(e){return""===e?1===this.length&&""===this[0]:this.map(e=>e.trim().toLowerCase()).includes(e.trim().toLowerCase())}static _GetTagArray(e){return e.trim().split(" ")}static _CompareTag(t,s){return""===t?1===this.length&&""===this[0]:this.some(e=>C33.compare(e.trim(),s,t.trim()))}GetCurrentNodeParent(e){const t=this.GetCurrentNode();if(t){if(C33.IsFiniteNumber(e)){const s=t.GetParentFlowchartIds(),n=s?s[e]:void 0;if(C33.IsFiniteNumber(n))return this.GetFlowchartElementById(n)}if("string"==typeof e)for(const i of t.GetParentFlowchartIds()){const r=this.GetFlowchartElementById(i);if(r.HasTags(e))return this.GetFlowchartElementById(r.GetFlowchartId())}}}GetCurrentNodeParentTag(e){const t=this.GetCurrentNodeParent(e);return t?t.GetTag():""}GetCurrentNodeParentTags(e){const t=this.GetCurrentNodeParent(e);return t?t.GetTags():""}GetCurrentNodeParentIndex(e){const t=this.GetCurrentNode();if(!t)return-1;const s=t.GetParentFlowchartIds();if(!s)return-1;const n=this.GetCurrentNodeParent(e);return n?s.indexOf(n.GetFlowchartId()):-1}GetCurrentNodeParentCount(){const e=this.GetCurrentNode();if(!e)return 0;const t=e.GetParentFlowchartIds();return t?t.length:0}GetFlowchartElementById(e){return this._flowchartDataItem.GetFlowchartElementById(e)}Reset(){const e=this._GetRootFlowchartState();e._Reset(!0)}_Reset(e){if(this._GetReferenceFlowchartStates()){for(const[t,s]of this._GetReferenceFlowchartStates().entries())s._Reset(!1);this._GetReferenceFlowchartStates().clear()}if(this._referenceFlowchartStates=null,this._previousFlowchartState=null,this._previousFlowchartStateStartNode=null,this._currentReferenceFlowchartState=null,this._previousFlowchartStateTag="",this._referenceFlowchartStatesJson=null,this._currentReferenceFlowchartStateTag="",this._rootFlowchartStateTag="",this._previousFlowchartNodeIds=[],e){this._flowchartManager.SetCurrentFlowchartState(this);const n=this._startFlowchartNode.GetFlowchartId();n!==this._currentFlowchartNodeId&&this._GotoFlowchartNode(n)}else this._currentFlowchartNodeId=this._startFlowchartNode.GetFlowchartId()}GetCurrentNodeOutputCount(){const e=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return e?e.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemCount():0}GetCurrentNodeOutputNameAt(e){const t=this._GetFlowchartNodeOutputAt(e);return t?t.GetName():""}GetCurrentNodeOutputValueAt(e){let t;return C33.IsFiniteNumber(e)&&(t=this._GetFlowchartNodeOutputAt(e)),"string"==typeof e&&(t=this._GetFlowchartNodeOutputByName(e)),"number"!=typeof e&&"string"!=typeof e&&console.warn("[Flowcharts] unexpected argument type in GetCurrentNodeOutputValueAt expression"),t?t.GetValue():""}GotoNextFlowchartNode(e){let t;if(C33.IsFiniteNumber(e)&&(t=this._GetFlowchartNodeOutputAt(e)),t="string"==typeof e?this._GetFlowchartNodeOutputByName(e):t){const s=t.GetConnectedFlowchartNodeFlowchartId();C33.IsFiniteNumber(s)&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(s))}}GotoAnyFlowchartNode(e){const t=this._flowchartDataItem.GetFlowchartNodeByTags(e);if(t){const s=this._flowchartDataItem.GetFlowchartElementById(t.GetFlowchartId());s&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(s.GetFlowchartId()))}}GotoPreviousFlowchartNode(){const e=this._previousFlowchartNodeIds.pop();C33.IsFiniteNumber(e)?this._GotoFlowchartNode(e):this._GetPreviousFlowchartState()&&(this._flowchartManager.SetCurrentFlowchartState(this._GetPreviousFlowchartState(),!0,!1,!1),this._GetPreviousFlowchartState()._GotoFlowchartNode(this._GetPreviousFlowchartStateStartNodeId()),this._GetRootFlowchartState()._SetCurrentReferenceFlowchart(this._GetPreviousFlowchartState()))}GotoParentFlowchartNode(e){const t=this.GetCurrentNode();if(t){t.GetFlowchartId();const s=this.GetCurrentNodeParent(e);s&&(this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId),this._GotoFlowchartNode(s.GetFlowchartId()))}}HasOutput(t){if(C33.IsFiniteNumber(t)){const e=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId),s=e.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();return!!s[t]}if("string"==typeof t){const n=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId),i=n.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();for(let e=0;e<i.length;e++)if(i[e].GetName()===t)return!0}return!1}MarkForRelease(){this._markForRelease=!0}IsInTriggerState(){return 0<this._triggerCount}PushIsTriggerState(){this._triggerCount++}PopIsTriggerState(){this._triggerCount--,0===this._triggerCount&&this._markForRelease&&this._flowchartManager.RemoveFlowchartState(this)}_GotoFlowchartNode(e){const s=this._currentFlowchartNodeId,t=this.GetPluginInstance().GetInstance();if(this.PushIsTriggerState(),this._flowchartManager.PushFlowchartState(this),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChange,t),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChange,t),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChangeInFlowchart,t),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChangeInFlowchart,t),this._currentFlowchartNodeId=e,this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnAnyNodeChange,t),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnTaggedNodeChange,t),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnAnyNodeChangeInFlowchart,t),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnTaggedNodeChangeInFlowchart,t),this._flowchartManager.PopFlowchartState(),this.PopIsTriggerState(),!this.WasReleased()){const n=this.GetFlowchartElementById(this._currentFlowchartNodeId);if("reference"===n.GetType()){const i=n.GetReferenceFlowchartName();if(this._HasReferenceFlowchartState(n)){this._previousFlowchartNodeIds.pop();const r=this._GetReferenceFlowchartState(n),a=(this._flowchartManager.SetCurrentFlowchartState(r,!0,!0,!1),r._SetPreviousFlowchart(this,s),this._GetRootFlowchartState());a._SetCurrentReferenceFlowchart(r)}else{const o=n.GetReferenceFlowchartStartNodeTag();if(i){this._previousFlowchartNodeIds.pop();let t=n.GetReferenceFlowchartTag();if(t){let e=this._flowchartManager.GetFlowchartState(t);for(;e;)t=C33.IncrementNumberAtEndOf(t),e=this._flowchartManager.GetFlowchartState(t)}else{t=i+"-ref";let e=this._flowchartManager.GetFlowchartState(t);for(;e;)t=C33.IncrementNumberAtEndOf(t),e=this._flowchartManager.GetFlowchartState(t)}const l=this._flowchartManager.AddFlowchartState(i,o,t,this._pluginInstance,!0),h=(l._SetPreviousFlowchart(this,s),this._SetReferenceFlowchartState(n,l),this._GetRootFlowchartState());l._SetRootFlowchartState(h),h._SetCurrentReferenceFlowchart(l)}}}}}_GetFlowchartNodeOutputAt(e){const t=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);if(!t)return null;const s=t.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();if(!s)return null;const n=s[e];return n||null}_GetFlowchartNodeOutputByName(e){const t=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);if(!t)return null;const s=t.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemByName(e);return s||null}_SetStartFlowchartNode(t){if("number"==typeof t){let e=this.GetFlowchartElementById(t);e=e||this._flowchartDataItem.GetFlowchartStartNode(),this._startFlowchartNode=e}else{let e=this._flowchartDataItem.GetFlowchartNodeByTags(this._startNodeTag);e=e||this._flowchartDataItem.GetFlowchartStartNode(),this._startFlowchartNode=e}}_SaveToJson(){return this._markForRelease?null:{flowchartName:this._flowchartName,flowchartTag:this._tag,startNodeTag:this._startNodeTag,currentNodeId:this._currentFlowchartNodeId,previousNodeIds:this._previousFlowchartNodeIds,pluginUID:this._pluginInstance.GetInstance().GetUID(),reference:{previousFlowchartTag:this._GetPreviousFlowchartState()?this._GetPreviousFlowchartState().GetTag():"",previousStartNodeId:C33.IsFiniteNumber(this._GetPreviousFlowchartStateStartNodeId())?this._GetPreviousFlowchartStateStartNodeId():NaN,referencesJson:this._GetFlowchartReferencesJson(),currentReferenceFlowchartTag:this.GetCurrentReferenceFlowchart()?this.GetCurrentReferenceFlowchart().GetTag():"",rootFlowchartTag:this._GetRootFlowchartState()?this._GetRootFlowchartState().GetTag():""}}}_GetFlowchartReferencesJson(){if(!this._HasReferenceFlowchartStates())return null;const e=[];for(const[t,s]of this._GetReferenceFlowchartStates().entries())e.push({flowchartElementId:t.GetFlowchartId(),flowchartStateTag:s.GetTag()});return e.length?e:null}_LoadFromJson(e){if(e){if(this._flowchartName=e.flowchartName,this._tag=e.flowchartTag,this._startNodeTag=e.startNodeTag,this._currentFlowchartNodeId=e.currentNodeId,this._previousFlowchartNodeIds=e.previousNodeIds,this._pluginUID=e.pluginUID,e.hasOwnProperty("reference")){const t=e.reference;this._previousFlowchartStateTag=t.previousFlowchartTag,this._previousFlowchartStateStartNodeId=t.previousStartNodeId,this._referenceFlowchartStatesJson=t.referencesJson,this._currentReferenceFlowchartStateTag=t.currentReferenceFlowchartTag,this._rootFlowchartStateTag=t.rootFlowchartTag}this._SetStartFlowchartNode()}}_GetPreviousFlowchartState(){return"string"==typeof this._previousFlowchartStateTag&&this._previousFlowchartStateTag&&(this._previousFlowchartState=this._flowchartManager.GetFlowchartState(this._previousFlowchartStateTag),this._previousFlowchartStateTag=""),this._previousFlowchartState}_GetPreviousFlowchartStateStartNodeId(){return this._previousFlowchartStateStartNodeId}_SetPreviousFlowchart(e,t){this._previousFlowchartState=e,this._previousFlowchartStateStartNodeId=t}GetCurrentReferenceFlowchart(){return"string"==typeof this._currentReferenceFlowchartStateTag&&this._currentReferenceFlowchartStateTag&&(this._currentReferenceFlowchartState=this._flowchartManager.GetFlowchartState(this._currentReferenceFlowchartStateTag),this._currentReferenceFlowchartStateTag=""),this._currentReferenceFlowchartState}_SetCurrentReferenceFlowchart(e){this._currentReferenceFlowchartState=e,this._currentReferenceFlowchartState===this&&(this._currentReferenceFlowchartState=null)}_GetRootFlowchartState(){return"string"==typeof this._rootFlowchartStateTag&&this._rootFlowchartStateTag&&(this._rootFlowchartState=this._flowchartManager.GetFlowchartState(this._rootFlowchartStateTag),this._rootFlowchartStateTag=""),this._rootFlowchartState||this}_SetRootFlowchartState(e){this._rootFlowchartState=e}_HasReferenceFlowchartStates(){return this._RebuildReferenceFlowchartStates(),!!this._referenceFlowchartStates}_HasReferenceFlowchartState(e){return this._RebuildReferenceFlowchartStates(),this._referenceFlowchartStates&&this._referenceFlowchartStates.has(e)}_RebuildReferenceFlowchartStates(){if(this._referenceFlowchartStatesJson){this._referenceFlowchartStates&&this._referenceFlowchartStates.clear(),this._referenceFlowchartStates||(this._referenceFlowchartStates=new Map);for(const e of this._referenceFlowchartStatesJson){const t=this._flowchartManager.GetFlowchartState(e.flowchartStateTag),s=t.GetFlowchartElementById(e.flowchartElementId);this._referenceFlowchartStates.set(s,t)}this._referenceFlowchartStatesJson=null}}_GetReferenceFlowchartStates(){return this._RebuildReferenceFlowchartStates(),this._referenceFlowchartStates}_GetReferenceFlowchartState(e){return this._RebuildReferenceFlowchartStates(),this._referenceFlowchartStates.get(e)}_SetReferenceFlowchartState(e,t){this._referenceFlowchartStates||(this._referenceFlowchartStates=new Map),this._referenceFlowchartStates.set(e,t)}}}{const C33=self.C3;C33.FlowchartStateManager=class{constructor(e){this._runtime=e,this._flowchartStates=new Map,this._currentFlowchartState=null,this._flowchartStateStack=[],this._on_after_load=()=>this._OnAfterLoad(),this._loadJson=null}Release(){C33.clearArray(this._flowchartStateStack),this._flowchartStateStack=null,this._flowchartStates.clear(),this._flowchartStates=null,this._currentFlowchartState=null,this._runtime=null,this._loadJson=null}GetRuntime(){return this._runtime}AddFlowchartState(e,t,s,n,i,r){const a=this._runtime.GetFlowchartManager().GetFlowchartDataItemByName(e);if(a){if(!this._flowchartStates.has(s)){const o=new C33.FlowchartState(e,s,t,a,this,n,r);return this._flowchartStates.set(s,o),i&&this.SetCurrentFlowchartState(o,!0),o}{const l=this._flowchartStates.get(s);l&&this.RemoveFlowchartState(l)}}else console.warn(`[Flowcharts] no flowchart found with name '${e}'`)}RemoveFlowchartState(e){if(e.MarkForRelease(),!e.IsInTriggerState()){const t=e.GetTag();this._flowchartStates.delete(t),e.Release(),this._currentFlowchartState===e&&(this._currentFlowchartState=null)}}ResetFlowchartState(e){e.Reset()}GetFlowchartState(e){return this._flowchartStates.get(e)}PushFlowchartState(e){this._flowchartStateStack.push(e)}PopFlowchartState(){this._flowchartStateStack.pop()}SetCurrentFlowchartState(e,t=!1,s=!1,n=!0){if(n){const i=e.GetCurrentReferenceFlowchart();e=i||e}e!==this._currentFlowchartState&&(this._TriggerBeforeFlowchartChange(),this._TriggerAfterFlowchartChange(e,t,s))}GetCurrentFlowchartState(e){return"string"==typeof e?this.GetFlowchartState(e):this._flowchartStateStack.length?this._flowchartStateStack[this._flowchartStateStack.length-1]:this._currentFlowchartState}_TriggerBeforeFlowchartChange(){if(this._currentFlowchartState&&!this._currentFlowchartState.WasReleased()){const e=this._currentFlowchartState.GetPluginInstance().GetInstance();this._currentFlowchartState.PushIsTriggerState(),this.PushFlowchartState(this._currentFlowchartState),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnBeforeFlowchartChange,e),this.PopFlowchartState(),this._currentFlowchartState.PopIsTriggerState()}}_TriggerAfterFlowchartChange(e,t=!1,s=!1){if(this._currentFlowchartState=e,this._currentFlowchartState&&!this._currentFlowchartState.WasReleased()){const n=this._currentFlowchartState.GetPluginInstance().GetInstance();this._currentFlowchartState.PushIsTriggerState(),this.PushFlowchartState(this._currentFlowchartState),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnFlowchartChange,n),!0!==s&&"number"!=typeof s||this._currentFlowchartState._SetStartFlowchartNode(s),t&&(this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnAnyNodeChange,n),this._runtime.Trigger(C33.Plugins.Flowchart.Cnds.OnTaggedNodeChange,n)),this.PopFlowchartState(),this._currentFlowchartState.PopIsTriggerState()}}_SaveToJson(){return{flowchartJsonObjects:[...this._flowchartStates.values()].map(e=>e._SaveToJson()),currentFlowchartTag:this._currentFlowchartState?this._currentFlowchartState.GetTag():null}}_LoadFromJson(e){if(e){this._loadJson=e;const t=new Map;for(const s of this._loadJson.flowchartJsonObjects){const n=s.flowchartTag;if(this._flowchartStates.has(n)){const i=this._flowchartStates.get(n);i._LoadFromJson(s),t.set(n,i)}else{const r=this.AddFlowchartState(s.flowchartName,s.startNodeTag,s.flowchartTag,null,!1,s.pluginUID);r._LoadFromJson(s),t.set(s.flowchartTag,r)}}for(const[a,o]of this._flowchartStates.entries())t.has(a)||o.Release();this._flowchartStates.clear(),this._flowchartStates=t,this._runtime.IsLoadingState()?this._runtime.Dispatcher().addEventListener("afterload",this._on_after_load):this._OnAfterLoad()}}_OnAfterLoad(){this._runtime.Dispatcher().removeEventListener("afterload",this._on_after_load);const e=this._flowchartStates.get(this._loadJson.currentFlowchartTag);e&&this.SetCurrentFlowchartState(e,!0),this._loadJson=null}}}{const C33=self.C3;C33.FlowchartDataManager=class{constructor(){this._flowchartDataItems=new Map}Release(){for(const e of this._flowchartDataItems.values())e.Release();this._flowchartDataItems.clear(),this._flowchartDataItems=null}Add(e){const t=new C33.FlowchartDataItem(e),s=t.GetName();this._flowchartDataItems.set(s,t)}Get(e){return this._flowchartDataItems.get(e)}HasFlowcharts(){return!!this._flowchartDataItems.size}static CreateDataItems(e,t,s,n){if(t)for(const i of t){const r=new s(i,n);e.push(r)}}}}{const C33=self.C3,NAME=0,NODES=1;C33.FlowchartDataItem=class{constructor(e){this._name=e[NAME],this._flowchartNodeData=new C33.FlowchartNodeData(e[NODES],this)}Release(){this._flowchartNodeData.Release(),this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartElementById(e){return this._flowchartNodeData.GetFlowchartElementById(e)}GetFlowchartNodeByTags(e){return this._flowchartNodeData.GetFlowchartNodeByTags(e)}GetFlowchartStartNode(){return this._flowchartNodeData.GetFlowchartStartNode()}GetName(){return this._name}}}{const C33=self.C3,FLOWCHART_ID=0,TAG=1,PARENT_FLOWCHART_IDS=2,PARENT_OUTPUT_FLOWCHART_IDS=3,CHILDREN_FLOWCHART_IDS=4,OUTPUTS=5,IS_START=6,TYPE=7,REFERENCE_FLOWCHART=8,REFERENCE_FLOWCHART_START_NODE=9,REFERENCE_FLOWCHART_TAG=10;class FlowchartNodeDataItem{constructor(e,t){this._flowchartNodeData=t,this._type=e[TYPE],this._flowchartId=e[FLOWCHART_ID],this._tag=e[TAG],this._tag?this._tags=this._tag.trim().split(" ").map(e=>e.trim()):this._tags=[],this._parentFlowchartIds=e[PARENT_FLOWCHART_IDS],this._parentOutputFlowchartIds=null,this._childrenFlowchartIds=null,"dictionary"===this._type&&(this._parentOutputFlowchartIds=e[PARENT_OUTPUT_FLOWCHART_IDS],this._childrenFlowchartIds=e[CHILDREN_FLOWCHART_IDS]),this._isStart=e[IS_START],this._referenceFlowchartName=null,this._referenceFlowchartStartNodeTag=null,this._referenceFlowchartTag=null,"reference"===this._type&&(this._referenceFlowchartName=e[REFERENCE_FLOWCHART],this._referenceFlowchartStartNodeTag=e[REFERENCE_FLOWCHART_START_NODE],this._referenceFlowchartTag=e[REFERENCE_FLOWCHART_TAG]),this._flowchartNodeOutputData=new C33.FlowchartNodeOutputData(e[OUTPUTS],this)}Release(){this._flowchartNodeData=null}GetFlowchartNodeData(){return this._flowchartNodeData}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetTag(){return this._tag}GetTags(){return this._tags}HasTags(e){if(!this._tags)return!1;if(!this._tags.length)return!1;const t=C33.FlowchartState._GetTagArray(e);return!(!t||!t.length)&&t.every(C33.FlowchartState._HasTag,this._tags)}GetIsStart(){return this._isStart}GetParentFlowchartIds(){return this._parentFlowchartIds}GetParentOutputFlowchartIds(){return this._parentOutputFlowchartIds}GetChildrenFlowchartIds(){return this._childrenFlowchartIds}GetType(){return this._type}GetReferenceFlowchartName(){return this._referenceFlowchartName}GetReferenceFlowchartStartNodeTag(){return this._referenceFlowchartStartNodeTag}GetReferenceFlowchartTag(){return this._referenceFlowchartTag}}C33.FlowchartNodeData=class{constructor(e,t){this._flowchartDataItem=t,this._flowchartNodeItems=[],this._flowchartNodeItemsIdMap=new Map,this._flowchartNodeItemsTagMap=new Map,this._flowchartNodeStartItem=null,C33.FlowchartDataManager.CreateDataItems(this._flowchartNodeItems,e,FlowchartNodeDataItem,this);for(const s of this._flowchartNodeItems){const n=s.GetFlowchartId(),i=s.GetTag(),r=s.GetTags(),a=s.GetIsStart();if(this._flowchartNodeItemsIdMap.set(n,s),i)for(const l of r)this._flowchartNodeItemsTagMap.has(l)||this._flowchartNodeItemsTagMap.set(l,new Set),this._flowchartNodeItemsTagMap.get(l).add(s);a&&(this._flowchartNodeStartItem=s);const o=s.GetFlowchartNodeOutputData();for(const h of o.flowchartNodeOutputDataItems()){const c=h.GetFlowchartId();this._flowchartNodeItemsIdMap.set(c,h)}}}Release(){this._flowchartDataItem=null;for(const e of this._flowchartNodeItems)e.Release();C33.clearArray(this._flowchartNodeItems),this._flowchartNodeItems=null}GetFlowchartDataItem(){return this._flowchartDataItem}GetFlowchartElementById(e){return this._flowchartNodeItemsIdMap.get(e)}GetFlowchartNodeByTags(e){if(!e||!e.length)return null;const s=[];for(const n of e.trim().split(" ")){let e=this._flowchartNodeItemsTagMap.get(n.trim())??new Set;if(0===e.size)return null;s.push(e)}const t=s.reduce((e,t)=>t.size<e.size?t:e);return[...t].filter(t=>s.every(e=>e.has(t)))[0]}GetFlowchartStartNode(){return this._flowchartNodeStartItem}*flowchartNodeDataItems(){for(const e of this._flowchartNodeItems)yield e}}}{const C33=self.C3,FLOWCHART_ID=0,NAME=1,VALUE=2,CONNECTED_FLOWCHART_NODE_FLOWCHART_ID=3;class FlowchartNodeDataOutputItem{constructor(e,t){this._flowchartNodeOutputData=t,this._flowchartId=e[FLOWCHART_ID],this._name=e[NAME],this._value=e[VALUE],this._connectedFlowchartNodeFlowchartId=e[CONNECTED_FLOWCHART_NODE_FLOWCHART_ID]}Release(){this._flowchartNodeOutputData=null}GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData}GetFlowchartId(){return this._flowchartId}GetName(){return this._name}GetValue(){return this._value}GetConnectedFlowchartNodeFlowchartId(){return this._connectedFlowchartNodeFlowchartId}}C33.FlowchartNodeOutputData=class{constructor(e,t){this._flowchartDataNodeItem=t,this._flowchartNodeOutputItems=[],this._flowchartNodeOutputItemsNameMap=new Map,C33.FlowchartDataManager.CreateDataItems(this._flowchartNodeOutputItems,e,FlowchartNodeDataOutputItem,this);for(const s of this._flowchartNodeOutputItems)this._flowchartNodeOutputItemsNameMap.set(s.GetName(),s)}Release(){this._flowchartDataNodeItem=null;for(const e of this._flowchartNodeOutputItems)e.Release();C33.clearArray(this._flowchartNodeOutputItems),this._flowchartNodeOutputItems=null}GetFlowchartNodeDataItem(){return this._flowchartDataNodeItem}GetFlowchartNodeOutputDataItemCount(){return this._flowchartNodeOutputItems.length}GetFlowchartNodeOutputDataItems(){return this._flowchartNodeOutputItems}GetFlowchartNodeOutputDataItemByName(e){return this._flowchartNodeOutputItemsNameMap.get(e)}*flowchartNodeOutputDataItems(){for(const e of this._flowchartNodeOutputItems)yield e}}}{const C33=self.C3;C33.SolStack=class extends C33.DefendedBase{constructor(e){super(),this._objectClass=e,this._stack=[],this._stack.push(C33.New(C33.Sol,this)),this._index=0,this._current=this._stack[0]}Release(){for(const e of this._stack)e.Release();C33.clearArray(this._stack),this._current=null,this._objectClass=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}GetOneBelowCurrentSol(){return this._stack[this._index-1]}Clear(){this.GetCurrentSol().Clear()}PushClean(){const e=this._stack,t=++this._index;if(t===e.length){const s=C33.New(C33.Sol,this);e.push(s),this._current=s}else{const n=e[t];n.Reset(),this._current=n}}PushCopy(){const e=this._stack,t=++this._index,s=(t===e.length&&e.push(C33.New(C33.Sol,this)),e[t]);s.Copy(e[t-1]),this._current=s}Pop(){this._current=this._stack[--this._index]}RemoveInstances(s){const n=this._stack;for(let e=0,t=n.length;e<t;++e)n[e].RemoveInstances(s)}}}{const C33=self.C3;C33.Sol=class extends C33.DefendedBase{constructor(e){super(),this._stack=e,this._objectClass=this._stack.GetObjectClass(),this._eventStack=this._objectClass.GetRuntime().GetEventStack(),this._selectAll=!0,this._instances=[],this._elseInstances=[]}Release(){this.ClearArrays(),this._stack=null,this._objectClass=null,this._eventStack=null}ClearArrays(){C33.clearArray(this._instances),C33.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){return this._selectAll?!!this._objectClass.GetInstanceCount():!!this._instances.length}GetInstances(){return this._selectAll?this._objectClass.GetInstances():this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){const e=this.GetInstances();return e.length?e:this._elseInstances}Reset(){this._selectAll=!0,C33.clearArray(this._elseInstances)}Clear(){this._selectAll=!0}Copy(e){e.IsSelectAll()?this.Reset():(this._selectAll=!1,C33.shallowAssignArray(this._instances,e._instances),C33.clearArray(this._elseInstances))}_PushInstance(e){this._instances.push(e)}_PushElseInstance(e){this._elseInstances.push(e)}_SetSelectAll(e){this._selectAll=!!e}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(e){this._selectAll=!1,C33.clearArray(this._instances),this._instances.push(e)}SetArrayPicked(e){this._selectAll=!1,C33.shallowAssignArray(this._instances,e)}SetSetPicked(e){this._selectAll=!1,C33.clearArray(this._instances);for(const t of e)this._instances.push(t)}AddElseInstances(e,t){for(const s of t)e.has(s)||this._elseInstances.push(s)}TransferElseInstancesToOwn(e){for(const t of e)this._instances.push(t);C33.arrayRemoveAllInSet(this._elseInstances,e)}ClearElseInstances(){C33.clearArray(this._elseInstances)}PickOne(e){if(e)if(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()){this.IsSelectAll()&&(C33.clearArray(this._instances),C33.shallowAssignArray(this._elseInstances,e.GetObjectClass().GetInstances()),this._selectAll=!1);const t=this._elseInstances.indexOf(e);-1!==t&&(this._instances.push(this._elseInstances[t]),this._elseInstances.splice(t,1))}else this.SetSinglePicked(e)}RemoveInstances(e){C33.arrayRemoveAllInSet(this._instances,e),C33.arrayRemoveAllInSet(this._elseInstances,e)}}}{const C33=self.C3;C33.EventStack=class extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._stack.push(C33.New(C33.EventStackFrame,this,null)),this._index=0,this._expFuncStack=[]}Release(){for(const e of this._stack)e.Release();C33.clearArray(this._stack),C33.clearArray(this._expFuncStack),this._eventSheetManager=null,this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}GetAllStackFrames(){return this._stack}GetCurrentStackFrameIndex(){return this._index}Push(e){const t=this._stack,s=++this._index;if(s===t.length){const n=C33.New(C33.EventStackFrame,this,e);return t.push(n),n}{const i=t[s];return i.Reset(e),i}}Pop(){--this._index}PushExpFunc(e){this._expFuncStack.push(e)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){const e=this._expFuncStack;return 0===e.length?null:e.at(-1)}}}{const C33=self.C3;C33.EventStackFrame=class extends C33.DefendedBase{constructor(e,t){super(),this._stack=e,this._runtime=this._stack.GetRuntime(),this._currentEvent=t,this._cndIndex=0,this._actIndex=0,this._lastEventTrue=!1,this._elseBranchRan=!1,this._expressionObjectClass=null,this._functionReturnType=0,this._functionReturnValue=0,this._dynamicSolModifiers=null}Release(){this.Reset(null),this._stack=null,this._runtime=null}Reset(e){this._currentEvent=e,this._cndIndex=0,this._actIndex=0,this._lastEventTrue=!1,this._elseBranchRan=!1,this._dynamicSolModifiers=null}_Restore(e,t){this._currentEvent=e,this._cndIndex=0,this._actIndex=t}ResetQuick(){this._cndIndex=0,this._actIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(e){this._currentEvent=e}GetConditionIndex(){return this._cndIndex}SetConditionIndex(e){this._cndIndex=e}GetActionIndex(){return this._actIndex}SetActionIndex(e){this._actIndex=e}SetLastEventTrue(e){this._lastEventTrue=!!e}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(e){this._elseBranchRan=!!e}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(e){this._expressionObjectClass=e}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(e,t){this._functionReturnType=e,this._functionReturnValue=t}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(e){this._functionReturnValue=e}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){const e=this._currentEvent;return!!e.IsSolWriterAfterCnds()||this._cndIndex<e.GetConditionCount()-1&&!!e.GetSolModifiers().length}SetDynamicSolModifiers(e){this._dynamicSolModifiers=e}GetDynamicSolModifiers(){return this._dynamicSolModifiers}}}{const C33=self.C3;C33.LocalVarStack=class extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1,this._current=null,this._initialValues=[]}Release(){C33.clearArray(this._stack),this._eventSheetManager=null,this._runtime=null}_SetInitialValues(e){this._initialValues=e;const t=this._initialValues.slice(0);this._stack.push(t),this._index=0,this._current=t}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){const e=++this._index,t=this._stack;e===t.length?t.push(this._initialValues.slice(0)):C33.shallowAssignArray(t[e],this._initialValues),this._current=t[e]}Pop(){this._current=this._stack[--this._index]}}}{const C33=self.C3;C33.LoopStack=class extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1}Release(){C33.clearArray(this._stack),this._eventSheetManager=null,this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return 0<=this._index}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){const e=C33.New(C33.Loop,this);return this._stack.push(e),e}{const t=this._stack[this._index];return t.Reset(),t}}Pop(){--this._index}FindByName(t){const s=this._stack;for(let e=this._index;0<=e;--e){const n=s[e];if(n.GetName()===t)return n}return null}_GetStack(){return this._stack.slice(0,this._index+1)}}}{const C33=self.C3;C33.Loop=class extends C33.DefendedBase{constructor(e){super(),this._loopStack=e,this._name="",this._index=0,this._isStopped=!1,this._end=NaN}Reset(){this._name="",this._index=0,this._isStopped=!1,this._end=NaN}SetName(e){this._name=e}GetName(){return this._name}SetIndex(e){this._index=e}GetIndex(){return this._index}Stop(){this._isStopped=!0}IsStopped(){return this._isStopped}SetEnd(e){this._end=e}GetEnd(){return this._end}}}{const C33=self.C3;C33.ArrayStack=class extends C33.DefendedBase{constructor(){super(),this._stack=[],this._index=-1}Release(){C33.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index!==this._stack.length)return this._stack[this._index];{const e=[];return this._stack.push(e),e}}Pop(){--this._index}}}{let SortSolArray2=function(e,t){return e.GetIndex()-t.GetIndex()},IsSolArrayIdentical2=function(s,n){for(let e=0,t=s.length;e<t;++e)if(s[e]!==n[e])return!1;return!0};SortSolArray=SortSolArray2,IsSolArrayIdentical=IsSolArrayIdentical2;const C33=self.C3,assert=self.assert;C33.EventSheetManager=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._allSheets=[],this._sheetsByName=new Map,this._allGroups=[],this._groupsByName=new Map,this._blocksBySid=new Map,this._cndsBySid=new Map,this._actsBySid=new Map,this._allUniqueSolModifiers=new Map,this._eventVarsBySid=new Map,this._nextLocalVarIndex=0,this._allGlobalVars=[],this._allLocalVars=[],this._localVarInitialValues=[],this._functionBlocksByName=new Map,this._customActionBlocksMap=new Map,this._eventStack=C33.New(C33.EventStack,this),this._localVarStack=C33.New(C33.LocalVarStack,this),this._loopStack=C33.New(C33.LoopStack,this),this._triggersToPostInit=[],this._queuedTriggers=[],this._queuedDebugTriggers=[],this._runningEventsDepth=0,this._executingTriggerDepth=0,this._blockFlushingDepth=0,this._scheduledWaits=[],this._asyncActionPromises=[],this._signalTags=[],this._signalPromises=new Map,this._instSignals=new Map,self.c3_callFunction=(e,t)=>this._InvokeFunctionFromJS(e,t)}Release(){this.ClearAllScheduledWaits(),this._eventStack.Release(),this._eventStack=null,this._localVarStack.Release(),this._localVarStack=null,C33.clearArray(this._queuedTriggers),C33.clearArray(this._queuedDebugTriggers),this._runtime=null,C33.clearArray(this._allSheets),this._sheetsByName.clear()}Create(e){const t=C33.New(C33.EventSheet,this,e);this._allSheets.push(t),this._sheetsByName.set(t.GetName().toLowerCase(),t)}_AddTriggerToPostInit(e){this._triggersToPostInit.push(e)}_PostInit(){for(const e of this._customActionBlocksMap.values())e._CheckOverrideState();for(const t of this._functionBlocksByName.values())t._PostInit();for(const s of this._customActionBlocksMap.values())s._PostInit();for(const n of this._allSheets)n._PostInit();for(const i of this._allSheets)i._UpdateDeepIncludes();for(const r of this._triggersToPostInit)r._PostInit(!1);C33.clearArray(this._triggersToPostInit),this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(e){return this._sheetsByName.get(e.toLowerCase())||null}_RegisterGroup(e){this._allGroups.push(e),this._groupsByName.set(e.GetGroupName(),e)}_RegisterEventBlock(e){this._blocksBySid.set(e.GetSID(),e)}_RegisterCondition(e){this._cndsBySid.set(e.GetSID(),e)}_RegisterAction(e){this._actsBySid.set(e.GetSID(),e)}_RegisterFunctionBlock(e){switch(e.GetFunctionType()){case 0:this._functionBlocksByName.set(e.GetFunctionName().toLowerCase(),e);break;case 1:this._customActionBlocksMap.set(e.GetFunctionName().toLowerCase(),e)}}_RegisterEventVariable(e){this._eventVarsBySid.set(e.GetSID(),e),(e.IsGlobal()?this._allGlobalVars:this._allLocalVars).push(e)}_DeduplicateSolModifierList(s){2<=s.length&&s.sort(SortSolArray2);let n=this._allUniqueSolModifiers.get(s.length);n||(n=[],this._allUniqueSolModifiers.set(s.length,n));for(let e=0,t=n.length;e<t;++e){const i=n[e];if(IsSolArrayIdentical2(s,i))return i}return n.push(s),s}_GetNextLocalVarIndex(e){return this._localVarInitialValues.push(e.GetInitialValue()),this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){const e=this.GetCurrentEventStackFrame(),t=e.GetCurrentEvent();return t.GetConditionAt(e.GetConditionIndex())}GetCurrentAction(){const e=this.GetCurrentEventStackFrame(),t=e.GetCurrentEvent();return t.GetActionAt(e.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(e){const t=[];for(e=e.GetScopeParent();e;)C33.appendArray(t,e._GetAllLocalVariablesInScope()),e=e.GetScopeParent();return t}_GetLocalVariablesScriptInterface(e){const t={};for(const s of this.GetAllLocalVariablesInScope(e))t[s.GetJsPropName()]=s._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,t)}GetEventVariableBySID(e){return this._eventVarsBySid.get(e)||null}GetEventBlockBySID(e){return this._blocksBySid.get(e)||null}GetConditionBySID(e){return this._cndsBySid.get(e)||null}GetActionBySID(e){return this._actsBySid.get(e)||null}GetFunctionBlockByName(e){return this._functionBlocksByName.get(e.toLowerCase())||null}GetCustomActionBlockByName(e,t){let s=this._customActionBlocksMap.get((e.GetName()+"."+t).toLowerCase());if(s)return s;if(!e.IsFamily())for(const n of e.GetFamilies())if(s=this._customActionBlocksMap.get((n.GetName()+"."+t).toLowerCase()))return s;return null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(e){for(const t of this._allGlobalVars)t.ResetToInitialValue();if(e)for(const s of this._allLocalVars)s.IsStatic()&&s.ResetToInitialValue()}GetEventGroupByName(e){return this._groupsByName.get(e.toLowerCase())||null}GetEventGroupBySID(e){const t=this._blocksBySid.get(e);return t&&t.IsGroup()?t:null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(const e of this._allGroups)e.ResetInitialActivation()}_ResetAllHasRunFlags(){for(const e of this._allSheets)e._ResetHasRunFlag()}RunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of e.runningLayouts()){const s=t.GetEventSheet();s&&(this._runtime.PushCurrentLayout(t),s.Run(),this._runtime.PopCurrentLayout())}this._runningEventsDepth--}async DebugRunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of this._DebugRunEventsGen(e))await this._runtime.DebugBreak(t);this._runningEventsDepth--}*_DebugRunEventsGen(e){for(const t of e.runningLayouts()){const s=t.GetEventSheet();s&&(this._runtime.PushCurrentLayout(t),yield*s.DebugRun(),this._runtime.PopCurrentLayout())}}_Trigger(e,t,s,n){let i=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,n);this._executingTriggerDepth++;for(const r of e.runningLayouts()){const a=r.GetEventSheet();if(a){this._runtime.PushCurrentLayout(r);for(const l of a.deepIncludes()){const h=l._Trigger(t,s,n);i=i||h}const o=a._Trigger(t,s,n);i=i||o,this._runtime.PopCurrentLayout()}}return this._executingTriggerDepth--,i}*_DebugTrigger(e,t,s,n){let i=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,n);this._executingTriggerDepth++;for(const r of e.runningLayouts()){const a=r.GetEventSheet();if(a){this._runtime.PushCurrentLayout(r);for(const l of a.deepIncludes()){const h=yield*l._DebugTrigger(t,s,n);i=i||h}const o=yield*a._DebugTrigger(t,s,n);i=i||o,this._runtime.PopCurrentLayout()}}return this._executingTriggerDepth--,i}QueueTrigger(e,t,s){return this._queuedTriggers.push([e,t,s]),!1}QueueDebugTrigger(e,t,s){let n=null,i=new Promise(e=>n=e);return this._queuedDebugTriggers.push([e,t,s,n]),i}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw new Error("should not be in breakpoint");const e=this._runtime.GetLayoutManager();for(;this._queuedDebugTriggers.length;){const[t,s,n,i]=this._queuedDebugTriggers.shift(),r=yield*this._DebugTrigger(e,t,s,n);i(r)}}async RunQueuedDebugTriggersAsync(){for(const e of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(e)}_FastTrigger(e,s,n,i){let r=!1,t=e.GetMainRunningLayout(),a=t.GetEventSheet();if(a){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(t);const o=a.deepIncludes();for(let e=0,t=o.length;e<t;++e){const h=o[e]._FastTrigger(s,n,i);r=r||h}const l=a._FastTrigger(s,n,i);return r=r||l,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}}*_DebugFastTrigger(e,s,n,i){let r=!1,t=e.GetMainRunningLayout(),a=t.GetEventSheet();if(a){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(t);const o=a.deepIncludes();for(let e=0,t=o.length;e<t;++e){const h=yield*o[e]._DebugFastTrigger(s,n,i);r=r||h}const l=yield*a._DebugFastTrigger(s,n,i);return r=r||l,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return 0<this.GetTriggerDepth()}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return 0<this._runningEventsDepth}IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger()}_RunQueuedTriggers(e){for(const[t,s,n]of this._queuedTriggers)this._Trigger(e,t,s,n);C33.clearArray(this._queuedTriggers)}BlockFlushingInstances(e){e?this._blockFlushingDepth++:this._blockFlushingDepth--}IsFlushingBlocked(){return 0<this._blockFlushingDepth}ClearSol(s){for(let e=0,t=s.length;e<t;++e)s[e].GetSolStack().Clear()}PushCleanSol(s){for(let e=0,t=s.length;e<t;++e)s[e].GetSolStack().PushClean()}PushCopySol(s){for(let e=0,t=s.length;e<t;++e)s[e].GetSolStack().PushCopy()}PopSol(s){for(let e=0,t=s.length;e<t;++e)s[e].GetSolStack().Pop()}GetDynamicSolModifiersSet(t){const s=new Set,n=this._eventStack.GetAllStackFrames(),i=this._eventStack.GetCurrentStackFrameIndex();for(let e=0;e<=i;++e){const r=n[e].GetDynamicSolModifiers();if(r)for(const a of r)t&&t.has(a)||s.add(a)}return s}PushCleanSolDynamic(e){const t=new Set([...e]),s=this.GetDynamicSolModifiersSet(t);if(0<s.size){for(const n of s)n.GetSolStack().PushClean();return[...s]}return null}AddScheduledWait(){const e=C33.New(C33.ScheduledWait,this);return this._scheduledWaits.push(e),e}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(this._scheduledWaits.length){let s=this.GetCurrentEventStackFrame(),n=!1;this._runningEventsDepth++;for(let e=0,t=this._scheduledWaits.length;e<t;++e){const i=this._scheduledWaits[e];i._ShouldRun()&&i._Run(s),i.ShouldRelease()&&(n=!0)}n&&(this._FilterScheduledWaitsToRelease(),s.Reset(null)),this._runningEventsDepth--}}async DebugRunScheduledWaits(){if(this._scheduledWaits.length){let s=this.GetCurrentEventStackFrame(),n=!1;this._runningEventsDepth++;for(let e=0,t=this._scheduledWaits.length;e<t;++e){const i=this._scheduledWaits[e];i._ShouldRun()&&await i._DebugRun(s),i.ShouldRelease()&&(n=!0)}n&&(this._FilterScheduledWaitsToRelease(),s.Reset(null)),this._runningEventsDepth--}}_FilterScheduledWaitsToRelease(){const e=C33.arrayFilterOut(this._scheduledWaits,e=>e.ShouldRelease());for(const t of e)t.Release()}ClearAllScheduledWaits(){for(const e of this._scheduledWaits)e.Release();C33.clearArray(this._scheduledWaits)}_OnInstancesReleased(e){for(const t of this._scheduledWaits)t.RemoveInstances(e);for(const s of e){const n=this._instSignals.get(s);if(this._instSignals.delete(s),n)for(const{resolve:i}of n.signalPromises.values())i(!0)}}AddAsyncActionPromise(e){this._asyncActionPromises.push({promise:e,triggerDepth:this.GetTriggerDepth()})}ClearAsyncActionPromises(){C33.clearArray(this._asyncActionPromises)}ClearNestedAsyncActionPromises(){const t=this.GetTriggerDepth();this._asyncActionPromises=this._asyncActionPromises.filter(e=>e.triggerDepth<=t)}GetPromiseForAllAsyncActions(){const e=Promise.all(this._asyncActionPromises.map(e=>e.promise));return this._asyncActionPromises=[],e}Signal(e){const t=e.toLowerCase();this._signalTags.push(t),this._runtime.Trigger(C33.Plugins.System.Cnds.OnSignal,null),this._signalTags.pop();for(const n of this._runtime.GetEventSheetManager().scheduledWaits())n.IsSignal()&&n.GetSignalTag()===t&&n.SetSignalled();const s=this._signalPromises.get(t);s&&(s.resolve(),this._signalPromises.delete(t))}WaitForSignal(e){const s=e.toLowerCase(),t=this._signalPromises.get(s);if(t)return t.promise;{let t=null,e=new Promise(e=>t=e);return this._signalPromises.set(s,{promise:e,resolve:t}),e}}GetCurrentSignalTag(){if(0===this._signalTags.length)throw new Error("not in a signal");return this._signalTags.at(-1)}_GetInstanceSignalState(e){let t=this._instSignals.get(e);return t||(t={signalTags:[],signalPromises:new Map},this._instSignals.set(e,t)),t}InstanceSignal(e,t){const s=this._GetInstanceSignalState(e),n=t.toLowerCase();s.signalTags.push(n),this._runtime.Trigger(e.GetPlugin().GetConstructor().Cnds.OnInstanceSignal,e),s.signalTags.pop();for(const r of this._runtime.GetEventSheetManager().scheduledWaits())r.IsInstanceSignals()&&r.GetSignalTag()===n&&r.SetInstanceSignalled(e);const i=s.signalPromises.get(n);i&&(i.resolve(!1),s.signalPromises.delete(n)),0===s.signalTags.length&&0===s.signalPromises.size&&this._instSignals.delete(e)}WaitForInstanceSignal(e,t){const s=this._GetInstanceSignalState(e),n=t.toLowerCase(),i=s.signalPromises.get(n);if(i)return i.promise;{let t=null,e=new Promise(e=>t=e);return s.signalPromises.set(n,{promise:e,resolve:t}),e}}GetCurrentInstanceSignalTag(e){const t=this._GetInstanceSignalState(e);if(t&&0!==t.signalTags.length)return t.signalTags.at(-1);throw new Error("not in a signal")}_SaveToJson(){return{groups:this._SaveGroupsToJson(),cnds:this._SaveCndsToJson(),acts:this._SaveActsToJson(),vars:this._SaveVarsToJson(),waits:this._SaveScheduledWaitsToJson()}}_LoadFromJson(e){this._LoadGroupsFromJson(e.groups),this._LoadCndsFromJson(e.cnds),this._LoadActsFromJson(e.acts),this._LoadVarsFromJson(e.vars),this._LoadScheduledWaitsFromJson(e.waits)}_SaveGroupsToJson(){const e={};for(const t of this.GetAllGroups())e[t.GetSID().toString()]=t.IsGroupActive();return e}_LoadGroupsFromJson(e){for(const[t,s]of Object.entries(e)){const n=parseInt(t,10),i=this.GetEventGroupBySID(n);i&&i.SetGroupActive(s)}}_SaveCndsToJson(){const e={};for(const[t,s]of this._cndsBySid){const n=s._SaveToJson();n&&(e[t.toString()]=n)}return e}_LoadCndsFromJson(e){const t=new Map;for(const[s,n]of Object.entries(e))t.set(parseInt(s,10),n);for(const[i,r]of this._cndsBySid)r._LoadFromJson(t.get(i)||null)}_SaveActsToJson(){const e={};for(const[t,s]of this._actsBySid){const n=s._SaveToJson();n&&(e[t.toString()]=n)}return e}_LoadActsFromJson(e){const t=new Map;for(const[s,n]of Object.entries(e))t.set(parseInt(s,10),n);for(const[i,r]of this._actsBySid)r._LoadFromJson(t.get(i)||null)}_SaveVarsToJson(){const e={};for(const[t,s]of this._eventVarsBySid)s.IsConstant()||!s.IsGlobal()&&!s.IsStatic()||(e[t.toString()]=s.GetValue());return e}_LoadVarsFromJson(e){for(const[t,s]of Object.entries(e)){const n=parseInt(t,10),i=this.GetEventVariableBySID(n);i&&i.SetValue(s)}}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter(e=>!e.IsPromise()).map(e=>e._SaveToJson())}_LoadScheduledWaitsFromJson(e){this.ClearAllScheduledWaits();for(const t of e){const s=C33.ScheduledWait._CreateFromJson(this,t);s&&this._scheduledWaits.push(s)}}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map(e=>e.GetEventSheet()).filter(e=>e).map(e=>e._GetPerfRecord())}FindFirstFunctionBlockParent(e){for(;e;){const t=e.GetScopeParent();if(t instanceof C33.FunctionBlock)return t;e=t}return null}_InvokeFunctionFromJS(e,t){Array.isArray(t)||(t=[]);const s=this.GetFunctionBlockByName(e.toLowerCase());if(!s)return null;if(!s.IsEnabled())return s.GetDefaultReturnValue();const n=s.GetFunctionParameters();if(t.length<n.length)for(t=t.slice(0);t.push(n[t.length].GetInitialValue()),t.length<n.length;);const i=s.GetEventBlock();return i.RunAsExpressionFunctionCall(i.GetSolModifiersIncludingParents(),!1,s.GetReturnType(),s.GetDefaultReturnValue(),...t)}}}{const C33=self.C3;C33.EventSheet=class extends C33.DefendedBase{constructor(e,t){super(),this._eventSheetManager=e,this._runtime=e.GetRuntime(),this._name=t[0],this._events=[],this._triggers=new Map,this._fastTriggers=new Map,this._eventsByDisplayNumber=new Map,this._hasRun=!1,this._shallowIncludes=[],this._deepIncludes=[],this._alreadyIncludedSheets=new Set;for(const s of t[1])this._CreateEvent(s,null,this._events);this._perfRecord=this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,children:[]}:null}Release(){this._eventSheetManager=null,this._runtime=null}_CreateEvent(e,t,s){switch(e[0]){case 0:case 3:this._CreateEventBlock(e,t,s);break;case 1:this._CreateEventVariable(e,t,s);break;case 2:this._CreateInclude(e,t,s);break;case 4:this._CreateFunctionBlock(e,t);break;case 5:this._CreateScriptBlock(e,t,s);break;case 6:this._CreateCustomACEBlock(e,t);break;default:throw new Error("invalid event type")}}_CreateEventBlock(e,t,s){const n=C33.EventBlock.Create(this,t,e);if(n.IsOrBlock()){s.push(n);const i=n.GetConditions();for(let e=0,t=i.length;e<t;++e)i[e].IsTrigger()&&this._InitTrigger(n,e)}else n.IsTrigger()?this._InitTrigger(n,0):s.push(n)}_CreateFunctionBlock(e,t){const s=C33.FunctionBlock.CreateFunctionBlock(this,t,e);this._eventSheetManager._RegisterFunctionBlock(s)}_CreateCustomACEBlock(e,t){const s=C33.FunctionBlock.CreateCustomACEBlock(this,t,e);this._eventSheetManager._RegisterFunctionBlock(s)}_CreateEventVariable(e,t,s){const n=C33.EventVariable.Create(this,t,e);s.push(n)}_CreateInclude(e,t,s){const n=C33.EventInclude.Create(this,t,e);s.push(n)}_CreateScriptBlock(e,t,s){const n=C33.EventScript.Create(this,t,e);s.push(n)}_InitTrigger(i,r){i.IsOrBlock()||this._eventSheetManager._AddTriggerToPostInit(i);const a=i.GetConditionAt(r),o=a._GetFunc(),l=a.GetObjectClass();if(a.IsFastTrigger()){let e=this._fastTriggers.get(l),t=(e||(e=new Map,this._fastTriggers.set(l,e)),a.GetFastTriggerValue().toLowerCase()),s=e.get(o),n=(s||(s=new Map,e.set(o,s)),s.get(t));n||(n=[],s.set(t,n)),n.push([i,r])}else{let e=this._triggers.get(l),t=(e||(e={methodMap:new Map,behaviors:new Map},this._triggers.set(l,e)),a.GetBehaviorType()),s,n=(t?(s=e.behaviors.get(t))||(s=new Map,e.behaviors.set(t,s)):s=e.methodMap,s.get(o));n||(n=[],s.set(o,n)),n.push([i,r])}}_PostInit(){const s=this._events;for(let e=0,t=s.length;e<t;++e){const n=e<t-1&&s[e+1]instanceof C33.EventBlock&&s[e+1].IsElseBlock();s[e]._PostInit(n)}}_AddShallowInclude(e){this._shallowIncludes.push(e)}_UpdateDeepIncludes(){C33.clearArray(this._deepIncludes),this._AddDeepIncludes(this),this._alreadyIncludedSheets.clear()}_AddDeepIncludes(e){const t=e._deepIncludes,s=e._alreadyIncludedSheets;for(const n of this._shallowIncludes){const i=n.GetIncludeSheet();n.IsActive()&&e!==i&&!s.has(i)&&(s.add(i),i._AddDeepIncludes(e),t.push(i))}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(e,t){this._eventsByDisplayNumber.set(t,e)}_GetEventByDisplayNumber(e){return this._eventsByDisplayNumber.get(e)||null}_ResetHasRunFlag(){this._hasRun=!1}Run(){if(!this._hasRun){const e=this._runtime,t=e.IsCPUProfiling(),s=t?performance.now():0,n=(this._hasRun=!0,this.GetEventSheetManager()),i=n.GetCurrentEventStackFrame();for(const r of this._events)r.Run(i),n.ClearSol(r.GetSolModifiers()),n.ClearAsyncActionPromises(),e.FlushPendingInstances();i.Reset(null),t&&(this._perfRecord.totalTimeCounter+=performance.now()-s)}}*DebugRun(){if(!this._hasRun){this._hasRun=!0;const e=this._runtime,t=this.GetEventSheetManager(),s=t.GetCurrentEventStackFrame();for(const n of this._events)yield*n.DebugRun(s),t.ClearSol(n.GetSolModifiers()),t.ClearAsyncActionPromises(),e.FlushPendingInstances();s.Reset(null)}}_Trigger(n,i,r){if(!i)return this._TriggerForClass(n,i,null,null);{let e=i.GetObjectClass(),t=!1,s=this._TriggerForClass(n,i,e,r);t=t||s;for(const a of e.GetFamilies())s=this._TriggerForClass(n,i,a,r),t=t||s}}_TriggerForClass(e,t,s,n){const i=this._triggers.get(s);if(!i)return!1;const r=n?i.behaviors.get(n):i.methodMap;if(!r)return!1;const a=r.get(e);if(!a)return!1;let o=!1;for(const[l,h]of a){const c=this._ExecuteTrigger(t,l,h);o=o||c}return o}*_DebugTrigger(n,i,r){if(!i)return yield*this._DebugTriggerForClass(n,i,null,null);{let e=i.GetObjectClass(),t=!1,s=yield*this._DebugTriggerForClass(n,i,e,r);t=t||s;for(const a of e.GetFamilies())s=yield*this._DebugTriggerForClass(n,i,a,r),t=t||s}}*_DebugTriggerForClass(e,t,s,n){const i=this._triggers.get(s);if(!i)return!1;const r=n?i.behaviors.get(n):i.methodMap;if(!r)return!1;const a=r.get(e);if(!a)return!1;let o=!1;for(const[l,h]of a){let e;e=l.DebugCanRunFast()?this._ExecuteTrigger(t,l,h):yield*this._DebugExecuteTrigger(t,l,h),o=o||e}return o}_FastTrigger(e,t,s){const n=t.GetObjectClass(),i=this._fastTriggers.get(n);if(!i)return!1;const r=i.get(e);if(!r)return!1;const a=r.get(s);if(!a)return!1;let o=!1;for(let e=0,t=a.length;e<t;++e){const l=a[e],h=this._ExecuteTrigger(null,l[0],l[1]);o=o||h}return o}*_DebugFastTrigger(e,t,s){const n=t.GetObjectClass(),i=this._fastTriggers.get(n);if(!i)return!1;const r=i.get(e);if(!r)return!1;const a=r.get(s);if(!a)return!1;let o=!1;for(let i=0,e=a.length;i<e;++i){let e=a[i],t=e[0],s=e[1],n;n=t.DebugCanRunFast()?this._ExecuteTrigger(null,t,s):yield*this._DebugExecuteTrigger(null,t,s),o=o||n}return o}_ExecuteTrigger(e,t,s){let n=this._runtime,i=this._eventSheetManager,r=i.GetCurrentEvent(),a=i.GetEventStack(),o=i.GetTriggerDepth(),l=!1;r&&i.PushCleanSol(r.GetSolModifiersIncludingParents()),i.PushCleanSol(t.GetSolModifiersIncludingParents());const h=1<o,c=(h&&i.GetLocalVarStack().Push(),a.Push(t));if(e){const d=t.GetConditions()[s].GetObjectClass(),_=d.GetCurrentSol();_.SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()}let u=!0;if(t.GetParent()){const p=t.GetTriggerParents();for(let e=0,t=p.length;e<t;++e)if(!p[e].RunPreTrigger(c)){u=!1;break}}return u&&(t.IsOrBlock()?t.RunOrBlockTrigger(c,s):t.Run(c),l=c.GetLastEventTrue()),a.Pop(),h&&i.GetLocalVarStack().Pop(),i.PopSol(t.GetSolModifiersIncludingParents()),r&&i.PopSol(r.GetSolModifiersIncludingParents()),r||1!==o||(i.ClearAsyncActionPromises(),i.IsFlushingBlocked())||n.FlushPendingInstances(),l}*_DebugExecuteTrigger(e,t,s){let n=this._runtime,i=this._eventSheetManager,r=i.GetCurrentEvent(),a=i.GetEventStack(),o=i.GetTriggerDepth(),l=!1;r&&i.PushCleanSol(r.GetSolModifiersIncludingParents()),i.PushCleanSol(t.GetSolModifiersIncludingParents());const h=1<o,c=(h&&i.GetLocalVarStack().Push(),a.Push(t));if(e){const d=t.GetConditions()[s].GetObjectClass(),_=d.GetCurrentSol();_.SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()}let u=!0;if(t.GetParent()){const p=t.GetTriggerParents();for(let e=0,t=p.length;e<t;++e)if(!(yield*p[e].DebugRunPreTrigger(c))){u=!1;break}}return u&&(t.IsOrBlock()?yield*t.DebugRunOrBlockTrigger(c,s):yield*t.DebugRun(c),l=c.GetLastEventTrue()),a.Pop(),h&&i.GetLocalVarStack().Pop(),i.PopSol(t.GetSolModifiersIncludingParents()),r&&i.PopSol(r.GetSolModifiersIncludingParents()),r||1!==o||(i.ClearAsyncActionPromises(),i.IsFlushingBlocked())||n.FlushPendingInstances(),l}_GetPerfRecord(){return this._perfRecord}}}{let NoActions2=function(e,t){return!0};NoActions=NoActions2;const C33=self.C3,EMPTY_ARRAY=[];function*DebugNoActions(e,t){return!0}C33.EventBlock=class extends C33.DefendedBase{constructor(e,t,s){super(),this._eventSheet=e,this._runtime=e.GetRuntime(),this._parent=t,this._scopeParent=null,this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._solModifiers=[],this._solModifiersIncludingParents=[],this._hasGotSolModifiersIncludingParents=!1,this._isSolWriterAfterCnds=!1,this._isTopLevelGroup=!1,this._hasElseBlock=!1,this._isOrBlock=!!s[2],this._isElseBlock=!1,this._triggerParents=null,this._conditions=[],this._actions=[],this._subEvents=[],this._RunActions=NoActions2,this._DebugRunActions=DebugNoActions,this._isGroup=!1,this._isInitiallyActive=!1,this._groupName="",this._isGroupActive=!1,this._containedIncludes=null,this._perfRecord=null,this._sid=s[4],this._displayNumber=s[5],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=this._runtime.IsDebug()?{isBreakpoint:s[3][0],isBreakable:s[3][1],canRunAllConditionsFast:!1,canRunAllActionsFast:!1,canRunAllSubEventsFast:!1,canRunSelfFast:!1}:null,this.GetEventSheetManager()._RegisterEventBlock(this),3===s[0]&&this._InitGroup(s[1]);let n=0;for(const i of s[6]){const r=C33.Condition.Create(this,i,n++);this._conditions.push(r),this._AddSolModifier(r.GetObjectClass())}n=0;for(const a of s[7]){const o=C33.Action.Create(this,a,n++);this._actions.push(o)}if(9===s.length){const l=s[8];for(const h of l)this._eventSheet._CreateEvent(h,this,this._subEvents)}this._conditions.length&&(this._isElseBlock=null===this._conditions[0].GetObjectClass()&&this._conditions[0]._GetFunc()===C33.Plugins.System.Cnds.Else),0===this._conditions.length&&(this._conditions=EMPTY_ARRAY),0===this._actions.length&&(this._actions=EMPTY_ARRAY),0===this._subEvents.length&&(this._subEvents=EMPTY_ARRAY)}static Create(e,t,s){return C33.New(C33.EventBlock,e,t,s)}_InitGroup(e){this._isGroup=!0,this._isInitiallyActive=!!e[0],this._isGroupActive=this._isInitiallyActive,this._groupName=e[1].toLowerCase(),this._containedIncludes=[],this.GetEventSheetManager()._RegisterGroup(this),this._runtime.IsDebug()&&(this._perfRecord={type:"group",name:e[1],totalTimeCounter:0,children:[]})}_AddContainedInclude(e){this._containedIncludes.push(e)}_AddContainerSolModifierToList(e,t){for(const s of e.GetContainer().objectTypes())t.includes(s)||t.push(s)}_AddSolModifierToList(e,t){if(e)if(t.includes(e)||t.push(e),e.IsFamily())for(const s of e.GetFamilyMembers())s.IsInContainer()&&this._AddContainerSolModifierToList(s,t);else e.IsInContainer()&&this._AddContainerSolModifierToList(e,t)}_AddSolModifier(e){this._AddSolModifierToList(e,this._solModifiers)}_AddParentSolModifier(e){this._AddSolModifierToList(e,this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(e){this._hasElseBlock=!!e,this._IdentifyTopLevelGroup(),this._IdentifyTriggerParents();for(const t of this._conditions)t._PostInit();if(0<this._actions.length){let e=!1;for(const n of this._actions)n._PostInit(),n.HasReturnType()&&(e=!0);e?(this._RunActions=this._RunActions_ReturnValue,this._DebugRunActions=this._DebugRunActions_ReturnValue):(this._RunActions=this._RunActions_Fast,this._DebugRunActions=this._DebugRunActions_Fast)}const s=this._subEvents;for(let e=0,t=s.length;e<t;++e){const i=e<t-1&&s[e+1]instanceof C33.EventBlock&&s[e+1].IsElseBlock();s[e]._PostInit(i)}this._debugData&&this._UpdateCanRunFast(),this._perfRecord&&this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let e=this.GetParent();for(;e;){if(e.IsGroup())return e;e=e.GetParent()}return this._eventSheet}_UpdateCanRunFast(){const e=this._debugData;e.canRunAllConditionsFast=this._conditions.every(e=>e.DebugCanRunFast()),e.canRunAllActionsFast=this._actions.every(e=>e.DebugCanRunFast()),e.canRunAllSubEventsFast=this._subEvents.every(e=>e.DebugCanRunFast()),e.canRunSelfFast=e.canRunAllConditionsFast&&e.canRunAllActionsFast&&e.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let e=this;for(;e._UpdateCanRunFast(),e=e.GetParent(););}_IdentifyTopLevelGroup(){if(this.IsGroup()){let e=this.GetParent();for(this._isTopLevelGroup=!0;e;){if(!e.IsGroup()){this._isTopLevelGroup=!1;break}e=e.GetParent()}}}_IdentifySolModifiersIncludingParents(){const e=this._runtime.GetAllObjectClasses();if(this._solModifiers===e)this._solModifiersIncludingParents=e;else{this._solModifiersIncludingParents=C33.cloneArray(this._solModifiers);let e=this.GetParent();for(;e;){for(const s of e._solModifiers)this._AddParentSolModifier(s);e=e.GetParent()}const t=this.GetEventSheetManager();this._solModifiers=t._DeduplicateSolModifierList(this._solModifiers),this._solModifiersIncludingParents=t._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(this.HasAnyTriggeredCondition()){this._triggerParents=[];let e=this.GetParent();for(;e;)this._triggerParents.push(e),e=e.GetParent();this._triggerParents.reverse()}}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=!0,this._parent&&this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){return this._hasGotSolModifiersIncludingParents||(this._hasGotSolModifiersIncludingParents=!0,this._IdentifySolModifiersIncludingParents()),this._solModifiersIncludingParents}HasSolModifier(e){return this._solModifiers.includes(e)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(e){this._scopeParent=e}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e,this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(e){if(e=!!e,!this._isGroup)throw new Error("not a group");if(this._isGroupActive!==e){this._isGroupActive=e;for(const t of this._containedIncludes)t.UpdateActive();if(this._containedIncludes.length){const s=this._runtime.GetCurrentLayout(),n=s.GetEventSheet();n&&n._UpdateDeepIncludes()}}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof C33.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some(e=>e.IsTrigger())}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(e){if((e=Math.floor(e))<0||e>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[e]}GetConditionByDebugIndex(e){return this.GetConditionAt(e)}IsFirstConditionOfType(e){let t=e.GetIndex();if(0!==t){--t;const s=e.IsSystemOrSingleGlobalCondition()?e.GetFirstObjectParameterObjectClass():e.GetObjectClass();for(;0<=t;--t){const n=this._conditions[t];if(s===n.GetObjectClass()||n.IsSystemOrSingleGlobalCondition()&&n.GetFirstObjectParameterObjectClass()===s)return!1}}return!0}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(e){if((e=Math.floor(e))<0||e>=this._actions.length)throw new RangeError("invalid action index");return this._actions[e]}GetActionByDebugIndex(t){t=Math.floor(t);const e=this._actions.find(e=>e.GetDebugIndex()===t);if(e)return e;throw new RangeError("invalid action debug index")}_HasActionIndex(e){return 0<=(e=Math.floor(e))&&e<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter(e=>e instanceof C33.EventVariable)}RunPreTrigger(s){s.SetCurrentEvent(this);let n=this._conditions,i=0===n.length;for(let e=0,t=n.length;e<t;++e){const r=n[e];if(s.SetConditionIndex(e),r.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");if(r.Run())i=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||i}RunOrBlockTrigger(e,t){e.SetCurrentEvent(this),e.SetConditionIndex(t),this._conditions[t].Run()&&(this._RunActions(e,0)&&this._RunSubEvents(e),e.SetLastEventTrue(!0))}*DebugRunPreTrigger(s){s.SetCurrentEvent(this);let n=this._conditions,i=0===n.length;for(let e=0,t=n.length;e<t;++e){const r=n[e];if(s.SetConditionIndex(e),r.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");if(r.DebugCanRunFast()?r.Run():yield*r.DebugRun())i=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||i}*DebugRunOrBlockTrigger(e,t){e.SetCurrentEvent(this),e.SetConditionIndex(t);let s=this._conditions[t];if(s.DebugCanRunFast()?s.Run():yield*s.DebugRun())(this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.SetLastEventTrue(!0)}Run(e){e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?this._RunOrBlock(e):this._RunAndBlock(e)}*DebugRun(e){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?yield*this._DebugRunOrBlock(e):yield*this._DebugRunAndBlock(e)}_RunOrBlock(s){let n=this._conditions,i=0===n.length;for(let e=0,t=n.length;e<t;++e){const r=n[e];if(!r.IsTrigger()){s.SetConditionIndex(e);const a=r.Run();i=i||a}}s.SetLastEventTrue(i),i&&(this._RunActions(s,0)&&this._RunSubEvents(s),this._hasElseBlock)&&s.SetElseBranchRan(!0)}*_DebugRunOrBlock(s){let n=this._conditions,i=0===n.length;for(let t=0,e=n.length;t<e;++t){const r=n[t];if(!r.IsTrigger()){s.SetConditionIndex(t);let e;e=r.DebugCanRunFast()?r.Run():yield*r.DebugRun(),i=i||e}}if(s.SetLastEventTrue(i),i)(this.DebugCanRunActionsFast()?this._RunActions(s,0):yield*this._DebugRunActions(s,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),this._hasElseBlock&&s.SetElseBranchRan(!0)}_RunAndBlock(s){const n=this._conditions;for(let e=0,t=n.length;e<t;++e){const i=n[e],r=(s.SetConditionIndex(e),i.Run());if(!r)return void s.SetLastEventTrue(!1)}s.SetLastEventTrue(!0),this._RunActions(s,0)&&this._RunSubEvents(s),s.GetLastEventTrue()&&this._hasElseBlock&&s.SetElseBranchRan(!0)}*_DebugRunAndBlock(s){const n=this._conditions;for(let e=0,t=n.length;e<t;++e){const i=n[e];s.SetConditionIndex(e);if(!(i.DebugCanRunFast()?i.Run():yield*i.DebugRun()))return void s.SetLastEventTrue(!1)}s.SetLastEventTrue(!0);(this.DebugCanRunActionsFast()?this._RunActions(s,0):yield*this._DebugRunActions(s,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),s.GetLastEventTrue()&&this._hasElseBlock&&s.SetElseBranchRan(!0)}_RunActions_Fast(s,n){const i=this._actions;for(let e=n,t=i.length;e<t;++e){const r=i[e];s.SetActionIndex(e),r.Run()}return!0}*_DebugRunActions_Fast(s,n){const i=this._actions;for(let e=n,t=i.length;e<t;++e){const r=i[e];s.SetActionIndex(e),r.DebugCanRunFast()?r.Run():yield*r.DebugRun()}return!0}_RunActions_ReturnValue(s,n){const i=this.GetEventSheetManager(),r=this._actions;for(let e=n,t=r.length;e<t;++e){const a=r[e],o=(s.SetActionIndex(e),a.Run());if(a.CanBailOut()&&!0===o)return!1;a.IsAsync()&&o instanceof Promise&&i.AddAsyncActionPromise(o)}return!0}*_DebugRunActions_ReturnValue(s,n){const i=this.GetEventSheetManager(),r=this._actions;for(let t=n,e=r.length;t<e;++t){const a=r[t];s.SetActionIndex(t);let e;if(e=a.DebugCanRunFast()?a.Run():yield*a.DebugRun(),a.CanBailOut()&&!0===e)return!1;a.IsAsync()&&e instanceof Promise&&i.AddAsyncActionPromise(e)}return!0}_ResumeActionsAndSubEvents(e){this._RunActions(e,e.GetActionIndex())&&this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(e){(yield*this._DebugRunActions(e,e.GetActionIndex()))&&(yield*this._DebugRunSubEvents())}_RunSubEvents(){if(this._subEvents.length){const e=this.IsGroup()&&this._runtime.IsCPUProfiling(),t=e?performance.now():0,s=this._eventStack,n=s.Push(this);this._isSolWriterAfterCnds?this._RunSubEvents_SolWriterAfterCnds(n):this._RunSubEvents_Fast(n),s.Pop(),e&&(this._perfRecord.totalTimeCounter+=performance.now()-t)}}_RunSubEvents_SolWriterAfterCnds(n){const i=this._isGroup,r=this._isTopLevelGroup,a=this.GetEventSheetManager(),o=this._subEvents;for(let e=0,t=o.length,s=t-1;e<t;++e){const l=o[e],h=l.GetSolModifiers(),c=!r||!i&&e<s;c&&a.PushCopySol(h),l.Run(n),c?a.PopSol(h):a.ClearSol(h)}}_RunSubEvents_Fast(s){const n=this._subEvents;for(let e=0,t=n.length;e<t;++e)n[e].Run(s)}*_DebugRunSubEvents(){if(this._subEvents.length){const e=this._eventStack,t=e.Push(this);this._isSolWriterAfterCnds?yield*this._DebugRunSubEvents_SolWriterAfterCnds(t):yield*this._DebugRunSubEvents_Fast(t),e.Pop()}}*_DebugRunSubEvents_SolWriterAfterCnds(n){const i=this._isGroup,r=this._isTopLevelGroup,a=this.GetEventSheetManager(),o=this._subEvents;for(let e=0,t=o.length,s=t-1;e<t;++e){const l=o[e],h=l.GetSolModifiers(),c=!r||!i&&e<s;c&&a.PushCopySol(h),yield*l.DebugRun(n),c?a.PopSol(h):a.ClearSol(h)}}*_DebugRunSubEvents_Fast(s){const n=this._subEvents;for(let e=0,t=n.length;e<t;++e)yield*n[e].DebugRun(s)}Retrigger(s,n){n.ResetQuick();const i=this._conditions;if(!this.IsOrBlock())for(let e=s.GetConditionIndex()+1,t=i.length;e<t;++e){const r=i[e],a=(n.SetConditionIndex(e),r.Run());if(!a)return!1}return this._RunActions(n,0)&&this._RunSubEvents(n),!0}*DebugRetrigger(s,n){n.ResetQuick();const i=this._conditions;if(!this.IsOrBlock())for(let e=s.GetConditionIndex()+1,t=i.length;e<t;++e){const r=i[e];n.SetConditionIndex(e);if(!(r.DebugCanRunFast()?r.Run():yield*r.DebugRun()))return!1}return(this.DebugCanRunActionsFast()?this._RunActions(n,0):yield*this._DebugRunActions(n,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),!0}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(s){if(this.GetParent()){const n=this.GetTriggerParents();for(let e=0,t=n.length;e<t;++e)if(!n[e].RunPreTrigger(s))return!1}return!0}*_DebugCheckParentsOKToRun(s){if(this.GetParent()){const n=this.GetTriggerParents();for(let e=0,t=n.length;e<t;++e)if(!(yield*n[e].DebugRunPreTrigger(s)))return!1}return!0}_EvaluateFunctionCallParameters(e,t,s){if(0<t.length)if(s){const n=t.map(e=>e.Get(0));e.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(n)}else this._scopeParent.EvaluateFunctionParameters(t);else s&&e.GetLocalVarStack().Push()}RunAsFunctionCall(e,t,s,n){let i,r,a=0<e.length,o=null,l=this._runtime,h=this._eventStack,c=l.GetEventSheetManager(),u=this._scopeParent,d=u.IsAsync(),_=c._IncTriggerDepth(),p=1<_;if(this._EvaluateFunctionCallParameters(c,t,p),a&&(s?c.PushCopySol(e):c.PushCleanSol(e)),null!==n){if(n.copyFromObjectClass){const g=s?n.copyFromObjectClass.GetCurrentSol():n.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol(),f=n.copyToObjectClass.GetCurrentSol();f.SetArrayPicked(g.GetInstances()),f.ClearElseInstances(),s||n.copyToObjectClass.ApplySolToContainer()}else if(n.pickObjectClass){const S=n.pickObjectClass.GetCurrentSol();S.SetArrayPicked(n.pickInstances),S.ClearElseInstances()}n.pushCleanSolDynamic&&(o=c.PushCleanSolDynamic(e))}const m=h.Push(this);return s&&m.SetDynamicSolModifiers(e),this._CheckParentsOKToRun(m)&&(m.SetCurrentEvent(this),d&&([r,i]=u.StartAsyncFunctionCall()),this._RunAndBlock(m),d)&&u.MaybeFinishAsyncFunctionCall(r),h.Pop(),p&&c.GetLocalVarStack().Pop(),null!==o&&c.PopSol(o),a&&c.PopSol(e),c._DecTriggerDepth(),d||c.ClearNestedAsyncActionPromises(),i}*DebugRunAsFunctionCall(e,t,s,n){let i,r,a=((this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),0<e.length),o=null,l=this._runtime,h=this._eventStack,c=l.GetEventSheetManager(),u=this._scopeParent,d=u.IsAsync(),_=c._IncTriggerDepth(),p=1<_;if(this._EvaluateFunctionCallParameters(c,t,p),a&&(s?c.PushCopySol(e):c.PushCleanSol(e)),null!==n){if(n.copyFromObjectClass){const g=s?n.copyFromObjectClass.GetCurrentSol():n.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol(),f=n.copyToObjectClass.GetCurrentSol();f.SetArrayPicked(g.GetInstances()),f.ClearElseInstances(),s||n.copyToObjectClass.ApplySolToContainer()}else if(n.pickObjectClass){const S=n.pickObjectClass.GetCurrentSol();S.SetArrayPicked(n.pickInstances),S.ClearElseInstances()}n.pushCleanSolDynamic&&(o=c.PushCleanSolDynamic(e))}const m=h.Push(this);return s&&m.SetDynamicSolModifiers(e),(yield*this._DebugCheckParentsOKToRun(m))&&(m.SetCurrentEvent(this),d&&([r,i]=u.StartAsyncFunctionCall()),yield*this._DebugRunAndBlock(m),d)&&u.MaybeFinishAsyncFunctionCall(r),h.Pop(),p&&c.GetLocalVarStack().Pop(),null!==o&&c.PopSol(o),a&&c.PopSol(e),c._DecTriggerDepth(),d||c.ClearNestedAsyncActionPromises(),i}RunAsMappedFunctionCall(e,t){const s=this.GetSolModifiersIncludingParents(),n=0<s.length,i=this._runtime,r=this._eventStack,a=i.GetEventSheetManager(),o=a._IncTriggerDepth(),l=1<o,h=(l&&a.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),n&&(t?a.PushCopySol(s):a.PushCleanSol(s)),r.Push(this));this._CheckParentsOKToRun(h)&&(h.SetCurrentEvent(this),this._RunAndBlock(h)),r.Pop(),l&&a.GetLocalVarStack().Pop(),n&&a.PopSol(s),a._DecTriggerDepth(),a.ClearNestedAsyncActionPromises()}*DebugRunAsMappedFunctionCall(e,t){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const s=this.GetSolModifiersIncludingParents(),n=0<s.length,i=this._runtime,r=this._eventStack,a=i.GetEventSheetManager(),o=a._IncTriggerDepth(),l=1<o,h=(l&&a.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),n&&(t?a.PushCopySol(s):a.PushCleanSol(s)),r.Push(this));(yield*this._DebugCheckParentsOKToRun(h))&&(h.SetCurrentEvent(this),yield*this._DebugRunAndBlock(h)),r.Pop(),l&&a.GetLocalVarStack().Pop(),n&&a.PopSol(s),a._DecTriggerDepth(),a.ClearNestedAsyncActionPromises()}RunAsExpressionFunctionCall(e,t,s,n,...i){let r,a,o=0<e.length,l=this._runtime,h=this._eventStack,c=l.GetEventSheetManager(),u=this._scopeParent,d=u.IsAsync(),_=c._IncTriggerDepth(),p=1<_,m=(p&&c.GetLocalVarStack().Push(),0<i.length&&this._scopeParent.SetFunctionParameters(i),o&&(t?c.PushCopySol(e):c.PushCleanSol(e)),h.Push(this));return m.InitCallFunctionExpression(s,n),h.PushExpFunc(m),l.SetDebuggingEnabled(!1),this._CheckParentsOKToRun(m)&&(m.SetCurrentEvent(this),d&&([a,r]=u.StartAsyncFunctionCall()),this._RunAndBlock(m),d)&&u.MaybeFinishAsyncFunctionCall(a),l.SetDebuggingEnabled(!0),h.Pop(),h.PopExpFunc(),p&&c.GetLocalVarStack().Pop(),o&&c.PopSol(e),c._DecTriggerDepth(),d||c.ClearNestedAsyncActionPromises(),r||m.GetFunctionReturnValue()}}}{let C33=self.C3,EMPTY_SOL_MODIFIERS=[],hadUserScriptException=!1;C33.EventScript=class extends C33.DefendedBase{constructor(e,t,s){super();const n=e.GetRuntime(),i=e.GetEventSheetManager(),r=(this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,n.GetObjectReference(s[1]));this._func=r,this._displayNumber=s[2],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=n.IsDebug()?{isBreakpoint:s[3][0],isBreakable:s[3][1]}:null}static Create(e,t,s){return C33.New(C33.EventScript,e,t,s)}_PostInit(){const e=this._func,t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e}IsElseBlock(){return!1}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetSolModifiersIncludingParents(){return this._parent?this._parent.GetSolModifiersIncludingParents():EMPTY_SOL_MODIFIERS}Run(e){e.SetCurrentEvent(this),this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(e){console.error(`Unhandled exception running script %c${this.GetEventSheet().GetName()}, event ${this.GetDisplayNumber()}:`,"font-size: 1.2em; font-weight: bold;",e),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),hadUserScriptException||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),hadUserScriptException=!0)}}*DebugRun(e){e.SetCurrentEvent(this),(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.Run(e)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()}static HadUserScriptException(){return hadUserScriptException}static SetHadUserScriptException(){hadUserScriptException=!0}}}{const C33=self.C3,assert=self.assert;C33.FunctionBlock=class extends C33.DefendedBase{constructor(e,t,s){super(),this._eventSheet=e,this._runtime=e.GetRuntime(),this._parent=t,this._functionType=0,this._functionName="",this._returnType=0,this._functionParameters=[],this._isEnabled=!0,this._aceName="",this._objectClass=null,this._hasOverrides=!1,this._innerLocalVariables=[],this._isCopyPicked=!1,this._isAsync=!1,this._nextAsyncId=0,this._currentAsyncId=-1,this._asyncMap=new Map,this._eventBlock=C33.EventBlock.Create(e,t,s),this._eventBlock._SetScopeParent(this)}InitFunctionBlock(e){this._functionType=0,this._functionName=e[0],this._returnType=e[1],this._functionParameters=e[2].map(e=>C33.EventVariable.Create(this._eventSheet,this,e)),this._isEnabled=e[3],this._isAsync=e[4],this._isCopyPicked=e[5]}InitCustomACEBlock(e){this._functionType=1,this._aceName=e[1],this._objectClass=this._runtime.GetObjectClassByIndex(e[2]),this._eventBlock._AddSolModifier(this._objectClass),this._functionName=this._objectClass.GetName()+"."+this._aceName,this._returnType=e[3],this._functionParameters=e[4].map(e=>C33.EventVariable.Create(this._eventSheet,this,e)),this._isEnabled=e[5],this._isAsync=e[6],this._isCopyPicked=e[7],this._objectClass.AddCustomAction(this)}static CreateFunctionBlock(e,t,s){const n=C33.New(C33.FunctionBlock,e,t,s),i=s[1];return n.InitFunctionBlock(i),n}static CreateCustomACEBlock(e,t,s){const n=C33.New(C33.FunctionBlock,e,t,s),i=s[1];return n.InitCustomACEBlock(i),n}_CheckOverrideState(){if(this._objectClass&&this._objectClass.IsFamily())for(const e of this._objectClass.GetFamilyMembers())if(e.HasOwnCustomActionByName(this._aceName)){this._hasOverrides=!0;break}}_PostInit(){for(const e of this._functionParameters)e._PostInit();this._eventBlock._PostInit(!1)}GetFunctionType(){return this._functionType}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(e){this._innerLocalVariables.push(e)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(s){const n=this._functionParameters;for(let e=0,t=n.length;e<t;++e)n[e].SetValue(s[e].Get(0))}SetFunctionParameters(s){const n=this._functionParameters;for(let e=0,t=n.length;e<t;++e)n[e].SetValue(s[e])}CaptureFunctionParameters(){return this._functionParameters.map(e=>e.GetValue())}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetACEName(){return this._aceName}HasCustomACEOverrides(){return this._hasOverrides}GetReturnType(){return this._returnType}GetObjectClass(){return this._objectClass}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsCopyPicked(){return this._isCopyPicked}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){const e=this._nextAsyncId++;this._currentAsyncId=e;let t,s=new Promise(e=>t=e);return this._asyncMap.set(e,{resolve:t,pauseCount:0}),[e,s]}MaybeFinishAsyncFunctionCall(e){const t=this._asyncMap.get(e);0===t.pauseCount&&(t.resolve(),this._asyncMap.delete(e)),this._currentAsyncId=-1}PauseCurrentAsyncFunction(){const e=this._asyncMap.get(this._currentAsyncId);return e.pauseCount++,this._currentAsyncId}ResumeAsyncFunction(e){this._currentAsyncId=e;const t=this._asyncMap.get(e);t.pauseCount--}RunAsFamilyCustomActionWithOverrides(e,t){const s=new Map,n=[];for(const i of this._objectClass.GetCurrentSol().GetInstances()){const r=i.GetObjectClass();if(r.HasOwnCustomActionByName(this._aceName)){const a=s.get(r);Array.isArray(a)?a.push(i):s.set(r,[i])}else n.push(i)}if(0<n.length&&this._eventBlock.RunAsFunctionCall(e,t,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:n}),0<s.size)for(const[o,l]of s){const h=o.GetOwnCustomActionByName(this._aceName).GetEventBlock(),c=[...new Set([...e,...h.GetSolModifiers()])];h.RunAsFunctionCall(c,t,this._isCopyPicked,{pickObjectClass:o,pickInstances:l})}}*DebugRunAsFamilyCustomActionWithOverrides(e,t){const s=new Map,n=[];for(const i of this._objectClass.GetCurrentSol().GetInstances()){const r=i.GetObjectClass();if(r.HasOwnCustomActionByName(this._aceName)){const a=s.get(r);Array.isArray(a)?a.push(i):s.set(r,[i])}else n.push(i)}if(0<n.length&&(yield*this._eventBlock.DebugRunAsFunctionCall(e,t,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:n})),0<s.size)for(const[o,l]of s){const h=o.GetOwnCustomActionByName(this._aceName).GetEventBlock(),c=[...new Set([...e,...h.GetSolModifiers()])];yield*h.DebugRunAsFunctionCall(c,t,this._isCopyPicked,{pickObjectClass:o,pickInstances:l})}}}}{const C33=self.C3,EMPTY_SOL_MODIFIERS=[];C33.EventVariable=class extends C33.DefendedBase{constructor(e,t,s){super();const n=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=n,this._runtime=e.GetRuntime(),this._parent=t,this._localVarStack=n.GetLocalVarStack(),this._name=s[1],this._type=s[2],this._initialValue=s[3],this._isStatic=!!s[4],this._isConstant=!!s[5],this._isFunctionParameter=t instanceof C33.FunctionBlock,this._sid=s[6],this._jsPropName=this._runtime.GetJsPropName(s[8]),this._scriptSetter=e=>this.SetValue(e),this._scriptGetter=()=>this.GetValue(),this._hasSingleValue=!this._parent||this._isStatic||this._isConstant,this._value=this._initialValue,this._localIndex=-1,this.IsBoolean()&&(this._value=this._value?1:0),!this.IsLocal()||this.IsStatic()||this.IsConstant()||(this._localIndex=n._GetNextLocalVarIndex(this)),n._RegisterEventVariable(this)}static Create(e,t,s){return C33.New(C33.EventVariable,e,t,s)}_PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&!this.IsFunctionParameter()){const e=this._eventSheetManager.FindFirstFunctionBlockParent(this);e&&e._RegisterLocalVariable(this)}}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return 0===this._type}IsString(){return 1===this._type}IsBoolean(){return 2===this._type}IsElseBlock(){return!1}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}Run(e){!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return!0}*DebugRun(e){this.Run(e)}SetValue(e){this.IsNumber()?"number"!=typeof e&&(e=parseFloat(e)):this.IsString()?"string"!=typeof e&&(e=e.toString()):this.IsBoolean()&&(e=e?1:0),this._hasSingleValue?this._value=e:this._localVarStack.GetCurrent()[this._localIndex]=e}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let e=this.GetValue();return this.IsBoolean()?!!e:e}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:!1,enumerable:!0,get:this._scriptGetter,set:this._scriptSetter}}}}{const C33=self.C3,assert=self.assert,EMPTY_SOL_MODIFIERS=[];C33.EventInclude=class extends C33.DefendedBase{constructor(e,t,s){super();const n=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=n,this._runtime=e.GetRuntime(),this._parent=t,this._includeSheet=null,this._includeSheetName=s[1],this._isActive=!0}static Create(e,t,s){return C33.New(C33.EventInclude,e,t,s)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName),this._eventSheet._AddShallowInclude(this);let e=this.GetParent();for(;e;)e instanceof C33.EventBlock&&e.IsGroup()&&e._AddContainedInclude(this),e=e.GetParent();this.UpdateActive(),this._runtime.IsDebug()&&this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return EMPTY_SOL_MODIFIERS}GetIncludeSheet(){return this._includeSheet}Run(e){const t=!!this.GetParent(),s=this._runtime.GetAllObjectClasses();t&&this._eventSheetManager.PushCleanSol(s),this._includeSheet.Run(),t&&this._eventSheetManager.PopSol(s)}*DebugRun(e){const t=!!this.GetParent(),s=this._runtime.GetAllObjectClasses();t&&this._eventSheetManager.PushCleanSol(s),yield*this._includeSheet.DebugRun(),t&&this._eventSheetManager.PopSol(s)}DebugCanRunFast(){return!1}IsActive(){return this._isActive}UpdateActive(){let e=this.GetParent();for(;e;){if(e instanceof C33.EventBlock&&e.IsGroup()&&!e.IsGroupActive())return void(this._isActive=!1);e=e.GetParent()}this._isActive=!0}}}{let WrapIndex2=function(e,t){return t<=e?e%t:(e<0&&(e<=-t&&(e%=t),e<0)&&(e+=t),e)};WrapIndex=WrapIndex2;const C33=self.C3,assert=self.assert;C33.ExpNode=class extends C33.DefendedBase{constructor(e){super(),this._owner=e,this._runtime=e.GetRuntime()}_PostInit(){}static CreateNode(e,t){const s=t[0],n=[BehaviorExpressionNode,ObjectExpressionNode,InstVarExpressionNode,EventVarExpNode,SystemExpressionExpNode,CallFunctionExpressionExpNode];return C33.New(n[s],e,t)}};class SystemExpressionExpNode extends C33.ExpNode{constructor(e,t){super(e),this._systemPlugin=this._runtime.GetSystemPlugin(),this._func=this._runtime.GetObjectReference(t[1]),this._func!==C33.Plugins.System.Exps.random&&this._func!==C33.Plugins.System.Exps.choose||this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}class CallFunctionExpressionExpNode extends C33.ExpNode{constructor(e,t){super(e),this._functionBlock=null,this._functionName=t[1],this._owner.SetVariesPerInstance()}_PostInit(){const e=this._runtime.GetEventSheetManager(),t=(this._functionBlock=e.GetFunctionBlockByName(this._functionName),this._functionName=null,this._owner.GetEventBlock()),s=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...new Set([...t.GetSolModifiersIncludingParents(),...s.GetSolModifiersIncludingParents()])],this._combinedSolModifiers=e._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){const e=this._functionBlock;if(e.IsEnabled()){const t=e.GetEventBlock();return C33.EventBlock.prototype.RunAsExpressionFunctionCall.bind(t,this._combinedSolModifiers,e.IsCopyPicked(),e.GetReturnType(),e.GetDefaultReturnValue())}{const s=e.GetDefaultReturnValue();return()=>s}}}class ObjectExpressionNode extends C33.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._func=this._runtime.GetObjectReference(t[2]),this._returnsString=!!t[3],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...e){const t=this._objectClass,s=t.GetCurrentSol().GetExpressionInstances(),n=s.length;if(0===n)return this._returnsString?"":0;const i=WrapIndex2(this._owner.GetSolIndex(),n);return this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),this._func.apply(s[i].GetSdkInstance(),e)}ExpObject_InstExpr(e,...t){const s=this._objectClass,n=s.GetInstances(),i=n.length;if(0===i)return this._returnsString?"":0;const r=WrapIndex2(e,i);return this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),this._func.apply(n[r].GetSdkInstance(),t)}}class InstVarExpressionNode extends C33.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._varIndex=t[3],this._returnsString=!!t[2],this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){const e=this._objectClass.GetCurrentSol().GetExpressionInstances(),t=e.length;if(0===t)return this._returnsString?"":0;const s=WrapIndex2(this._owner.GetSolIndex(),t);return e[s]._GetInstanceVariableValueUnchecked(this._varIndex)}ExpInstVar_Family(){const e=this._objectClass,t=e.GetCurrentSol().GetExpressionInstances(),s=t.length;if(0===s)return this._returnsString?"":0;const n=WrapIndex2(this._owner.GetSolIndex(),s),i=t[n],r=i.GetObjectClass().GetFamilyInstanceVariableOffset(e.GetFamilyIndex());return i._GetInstanceVariableValueUnchecked(this._varIndex+r)}ExpInstVar_InstExpr(e){const t=this._objectClass,s=t.GetInstances(),n=s.length;if(0===n)return this._returnsString?"":0;let i=WrapIndex2(e,n),r=s[i],a=0;return t.IsFamily()&&(a=r.GetObjectClass().GetFamilyInstanceVariableOffset(t.GetFamilyIndex())),r._GetInstanceVariableValueUnchecked(this._varIndex+a)}}class BehaviorExpressionNode extends C33.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2]),this._func=this._runtime.GetObjectReference(t[3]),this._returnsString=!!t[4],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...e){const t=this._objectClass,s=t.GetCurrentSol().GetExpressionInstances(),n=s.length;if(0===n)return this._returnsString?"":0;let i=WrapIndex2(this._owner.GetSolIndex(),n),r=(this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),s[i]),a=0;return t.IsFamily()&&(a=r.GetObjectClass().GetFamilyBehaviorOffset(t.GetFamilyIndex())),this._func.apply(r.GetBehaviorInstances()[this._behaviorIndex+a].GetSdkInstance(),e)}ExpBehavior_InstExpr(e,...t){const s=this._objectClass,n=s.GetInstances(),i=n.length;if(0===i)return this._returnsString?"":0;let r=WrapIndex2(e,i),a=(this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),n[r]),o=0;return s.IsFamily()&&(o=a.GetObjectClass().GetFamilyBehaviorOffset(s.GetFamilyIndex())),this._func.apply(a.GetBehaviorInstances()[this._behaviorIndex+o].GetSdkInstance(),t)}}class EventVarExpNode extends C33.ExpNode{constructor(e,t){super(e),this._eventVar=null,this._eventVarSid=t[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}}}{let GetExpressionFunc2=function(e){const t=self.C3_ExpressionFuncs[e];if(t)return t;throw new Error("invalid expression number")};GetExpressionFunc=GetExpressionFunc2;const C33=self.C3,assert=self.assert;C33.Parameter=class extends C33.DefendedBase{constructor(e,t,s){super(),this._owner=e,this._index=s,this._type=t,this.Get=null,this._variesPerInstance=!1,this._isConstant=!1}static Create(e,t,s){const n=t[0],i=[ExpressionParameter,StringExpressionParameter,FileParameter,ComboParameter,ObjectParameter,LayerExpressionParameter,LayoutParameter,ExpressionParameter,ComboParameter,ComboParameter,InstVarParameter,EventVarParameter,FileParameter,VariadicParameter,StringExpressionParameter,TimelineParameter,BooleanParameter,FunctionParameter,EaseParameter,TilemapBrushParameter,TemplateExpressionParameter,FlowchartParameter];return C33.New(i[n],e,n,s,t)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=!0}_MaybeVaryFor(e){this._variesPerInstance||!e||e.GetPlugin().IsSingleGlobal()||(this._variesPerInstance=!0)}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}IsObjectParameter(){return 4===this._type}};class ExpressionParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._solIndex=0;const i=n[1];this._expressionNumber=i[0],this._numberedNodes=[],this._expressionFunc=null;for(let e=1,t=i.length;e<t;++e)this._numberedNodes.push(C33.ExpNode.CreateNode(this,i[e]));this._numberedNodes.length?this.Get=this.GetExpression:(this.Get=GetExpressionFunc2(this._expressionNumber),this._isConstant=!0)}_GetNode(e){if(e<0||e>=this._numberedNodes.length)throw new RangeError("invalid numbered node");return this._numberedNodes[e]}_PostInit(){for(const t of this._numberedNodes)t._PostInit();const e=GetExpressionFunc2(this._expressionNumber);this._numberedNodes.length?this._expressionFunc=e(this):this._expressionFunc=e}GetSolIndex(){return this._solIndex}GetExpression(e){return this._solIndex=e,this._expressionFunc()}}class StringExpressionParameter extends ExpressionParameter{constructor(e,t,s,n){super(e,t,s,n),this.Get=this.GetStringExpression,14===t&&(this.GetEventBlock().SetAllSolModifiers(),this._owner instanceof C33.Action)&&this.GetEventBlock().SetSolWriterAfterCnds()}GetStringExpression(e){this._solIndex=e;const t=this._expressionFunc();return"string"==typeof t?t:""}_GetFastTriggerValue(){return GetExpressionFunc2(this._expressionNumber)()}}class LayerExpressionParameter extends ExpressionParameter{constructor(e,t,s,n){super(e,t,s,n),2<=e.GetImplementationSdkVersion()?this.Get=this.GetILayer:this.Get=this.GetLayer,this._isConstant=!1}GetLayer(e){this._solIndex=e;const t=this._expressionFunc(),s=this.GetRuntime().GetCurrentLayout();return s.GetLayer(t)}GetILayer(e){const t=this.GetLayer(e);return t?t.GetILayer():null}}class ComboParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._combo=n[1],this.Get=this.GetCombo,this._isConstant=!0}GetCombo(){return this._combo}}class BooleanParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._bool=n[1],this.Get=this.GetBoolean,this._isConstant=!0}GetBoolean(){return this._bool}}class ObjectParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._objectClass=this.GetRuntime().GetObjectClassByIndex(n[1]),2<=e.GetImplementationSdkVersion()?this.Get=this.GetIObjectClass:this.Get=this.GetObjectClass;const i=this.GetEventBlock();i._AddSolModifier(this._objectClass),this._owner instanceof C33.Action?i.SetSolWriterAfterCnds():i.GetParent()&&i.GetParent().SetSolWriterAfterCnds(),this._isConstant=!0}GetObjectClass(){return this._objectClass}GetIObjectClass(){return this._objectClass?this._objectClass.GetIObjectClass():null}}class LayoutParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(n[1]),2<=e.GetImplementationSdkVersion()?this.Get=this.GetILayout:this.Get=this.GetLayout,this._isConstant=!0}GetLayout(){return this._layout}GetILayout(){return this._layout?this._layout.GetILayout():null}}class TimelineParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(n[1]),2<=e.GetImplementationSdkVersion()?this.Get=this.GetITimelineState:this.Get=this.GetTimeline,this._isConstant=!0}GetTimeline(){return this._timeline}GetITimelineState(){return this._timeline?this._timeline.GetITimelineState():null}}class FileParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._fileInfo=n[1],this.Get=this.GetFile,this._isConstant=!0}GetFile(){return this._fileInfo}}class InstVarParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._instVarIndex=n[1];const i=this._owner.GetObjectClass();this._owner instanceof C33.Condition&&this._owner.IsStatic()||!i||!i.IsFamily()?(this.Get=this.GetInstanceVariable,this._isConstant=!0):(this.Get=this.GetFamilyInstanceVariable,this.SetVariesPerInstance())}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(e){e=e||0;let t=this._owner.GetObjectClass(),s=t.GetCurrentSol(),n=s.GetInstances(),i=null;if(n.length)i=n[e%n.length].GetObjectClass();else if(s.HasAnyElseInstances()){const r=s.GetElseInstances();i=r[e%r.length].GetObjectClass()}else{if(!(0<t.GetInstanceCount()))return 0;{const a=t.GetInstances();i=a[e%a.length].GetObjectClass()}}return this._instVarIndex+i.GetFamilyInstanceVariableOffset(t.GetFamilyIndex())}}class EventVarParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._eventVarSid=n[1],this._eventVar=null,2<=e.GetImplementationSdkVersion()?this.Get=this.GetIEventVariable:this.Get=this.GetEventVariable,this._isConstant=!0}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}GetIEventVariable(){return null}}class FunctionParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._functionBlockName=n[1],this._functionBlock=null,2<=e.GetImplementationSdkVersion()?this.Get=this.GetIFunction:this.Get=this.GetFunction,this._isConstant=!0}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName),this._functionBlockName=null}GetFunction(){return this._functionBlock}GetIFunction(){return null}}class VariadicParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._subParams=[],this._variadicRet=[],this._isConstant=!0;for(let e=1,t=n.length;e<t;++e){const i=C33.Parameter.Create(this._owner,n[e],0);this._subParams.push(i),this._variadicRet.push(0),i.IsConstant()||(this._isConstant=!1)}this.Get=this.GetVariadic}_PostInit(){for(const e of this._subParams)e._PostInit()}GetVariadic(){const s=this._subParams,n=this._variadicRet;for(let e=0,t=s.length;e<t;++e)n[e]=s[e].Get(0);return n}}class EaseParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._easeIndex=n[1],this.Get=this.GetEase,this._isConstant=!0}GetEase(){return this._easeIndex}}class TilemapBrushParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._brushIndex=n[1],this.Get=this.GetTilemapBrush,this._isConstant=!0}GetTilemapBrush(){return this._brushIndex}}class TemplateExpressionParameter extends ExpressionParameter{constructor(e,t,s,n){super(e,t,s,n),this.Get=this.GetTemplateName,this._isConstant=!1}GetTemplateName(){return this._expressionFunc()}}class FlowchartParameter extends C33.Parameter{constructor(e,t,s,n){super(e,t,s),this._flowchartDataItem=this.GetRuntime().GetFlowchartManager().GetFlowchartDataItemByName(n[1]),this.Get=this.GetFlowchartName,this._isConstant=!0}GetFlowchartName(){return this._flowchartDataItem.GetName()}}}{let EvalParams2=function(s,n){for(let e=0,t=s.length;e<t;++e)n[e]=s[e].Get(0)};EvalParams=EvalParams2;const C33=self.C3,assert=self.assert,EMPTY_PARAMS_ARRAY=[],noop=function(){};C33.Condition=class extends C33.DefendedBase{constructor(e,s,t){if(super(),this._eventBlock=e,this._runtime=e.GetRuntime(),this._index=t,this._func=this._runtime.GetObjectReference(s[1]),this._isTrigger=0<s[3],this._isFastTrigger=2===s[3],this._isLooping=!!s[4],this._isInverted=!!s[5],this._isStatic=!!s[6],this._sid=s[7],this._isInOrBlock=this._eventBlock.IsOrBlock(),this._objectClass=null,this._behaviorType=null,this._behaviorIndex=-1,this._systemPlugin=null,this.Run=noop,this.DebugRun=noop,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._savedData=null,this._unsavedData=null,this._debugData=this._runtime.IsDebug()?{isBreakpoint:s[8][0],canDebug:s[8][1]}:null,-1===s[0]?this._systemPlugin=this._runtime.GetSystemPlugin():(this._objectClass=this._runtime.GetObjectClassByIndex(s[0]),s[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(s[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(s[2])),this._eventBlock.GetParent()&&this._eventBlock.GetParent().SetSolWriterAfterCnds()),10===s.length){let t=s[9];for(let e of t)this._parameters.push(C33.Parameter.Create(this,e,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._parameters=EMPTY_PARAMS_ARRAY,this._results=EMPTY_PARAMS_ARRAY),this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(e,t,s){return C33.New(C33.Condition,e,t,s)}_PostInit(){for(const e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);this._isFastTrigger?(this.Run=this._RunFastTrigger,this.DebugRun=this._DebugRunFastTrigger):this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this._isStatic?(this.Run=this._RunStatic,this.DebugRun=this._DebugRunStatic):(this.Run=this._RunObject,this.DebugRun=this._DebugRunObject)}_SetSystemRunMethod(){const e=this._systemPlugin,t=this._systemPlugin;this._SetRunMethodForBoundFunc(e,t,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(e,t,s){const n=this._func,i=this._isInverted,r=this._parameters;if(0===r.length){const a=e._GetBoundACEMethod(n,t);i?this.Run=function(){return C33.xor(a(),i)}:this.Run=a}else if(1===r.length){const o=r[0];if(!i&&o.IsConstant())this.Run=e._GetBoundACEMethod_1param(n,t,o.Get(0));else{const l=e._GetBoundACEMethod(n,t);this.Run=function(){return C33.xor(l(o.Get(0)),i)}}}else if(2===r.length){const h=r[0],c=r[1];if(!i&&h.IsConstant()&&c.IsConstant())this.Run=e._GetBoundACEMethod_2params(n,t,h.Get(0),c.Get(0));else{const u=e._GetBoundACEMethod(n,t);this.Run=function(){return C33.xor(u(h.Get(0),c.Get(0)),i)}}}else if(3===r.length){const d=r[0],_=r[1],p=r[2];if(!i&&d.IsConstant()&&_.IsConstant()&&p.IsConstant())this.Run=e._GetBoundACEMethod_3params(n,t,d.Get(0),_.Get(0),p.Get(0));else{const m=e._GetBoundACEMethod(n,t);this.Run=function(){return C33.xor(m(d.Get(0),_.Get(0),p.Get(0)),i)}}}else this.Run=s}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetImplementationAddon(){return this._behaviorType?this._behaviorType.GetBehavior():this._objectClass?this._objectClass.GetPlugin():null}GetImplementationSdkVersion(){const e=this.GetImplementationAddon();return e?e.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsStatic(){return this._isStatic}IsBreakpoint(){return this._debugData.isBreakpoint}IsSystemCondition(){return!!this._systemPlugin}IsSystemOrSingleGlobalCondition(){return this.IsSystemCondition()||this._objectClass.GetPlugin().IsSingleGlobal()}GetFirstObjectParameterObjectClass(){for(const e of this._parameters)if(e.IsObjectParameter())return e.GetObjectClass();return null}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const e=this._results;return EvalParams2(this._parameters,e),C33.xor(this._func.apply(this._systemPlugin,e),this._isInverted)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._results;EvalParams2(this._parameters,t);let e=this._func.apply(this._systemPlugin,t);return C33.IsIterator(e)&&(e=yield*e),C33.xor(e,this._isInverted)}return this.Run()}_RunSingleGlobal(){const e=this._results,t=(EvalParams2(this._parameters,e),this._objectClass.GetSingleGlobalInstance().GetSdkInstance());return C33.xor(this._func.apply(t,e),this._isInverted)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){let e=this._results,t=(EvalParams2(this._parameters,e),this._objectClass.GetSingleGlobalInstance().GetSdkInstance()),s=this._func.apply(t,e);return C33.IsIterator(s)&&(s=yield*s),C33.xor(s,this._isInverted)}return this.Run()}_RunFastTrigger(){return!0}*_DebugRunFastTrigger(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),!0}_GetStaticConditionThis(){if(this._behaviorType){if(2<=this._behaviorType.GetBehavior().GetSdkVersion())throw new Error("not yet implemented");return this._behaviorType}return 2<=this._objectClass.GetPlugin().GetSdkVersion()?this._objectClass.GetIObjectClass():this._objectClass}_RunStatic(){const e=this._results,t=(EvalParams2(this._parameters,e),this._func.apply(this._GetStaticConditionThis(),e));return this._objectClass.ApplySolToContainer(),t}*_DebugRunStatic(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._results;EvalParams2(this._parameters,t);let e=this._func.apply(this._GetStaticConditionThis(),t);return C33.IsIterator(e)&&(e=yield*e),this._objectClass.ApplySolToContainer(),e}return this.Run()}_RunObject(){const s=this._parameters,n=this._results,e=this._objectClass.GetCurrentSol();for(let e=0,t=s.length;e<t;++e){const i=s[e];i.VariesPerInstance()||(n[e]=i.Get(0))}return e.IsSelectAll()?this._RunObject_FirstFilter(e):this._RunObject_NextFilter(e)}*_DebugRunObject(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._RunObject()}_EvaluateVaryingParameters(s){const n=this._parameters,i=this._results;for(let e=0,t=n.length;e<t;++e){const r=n[e];r.VariesPerInstance()&&(i[e]=r.Get(s))}}_RunObject_FirstFilter(s){const e=this._objectClass,n=e.IsFamily(),i=e.GetFamilyIndex(),r=this._behaviorIndex,a=0<=r,o=e.GetInstances(),l=this._anyParamVariesPerInstance,h=this._results,c=this._func,u=this._isInverted,d=this._isInOrBlock&&!this._isTrigger;s.ClearArrays();for(let t=0,e=o.length;t<e;++t){const _=o[t];l&&this._EvaluateVaryingParameters(t);let e;if(a){const p=n?_.GetObjectClass().GetFamilyBehaviorOffset(i):0;e=c.apply(_.GetBehaviorInstances()[r+p].GetSdkInstance(),h)}else e=c.apply(_.GetSdkInstance(),h);C33.xor(e,u)?s._PushInstance(_):d&&s._PushElseInstance(_)}return e.FinishCondition(!0),s._SetSelectAll(!1),e.ApplySolToContainer(),s.HasAnyInstances()}_RunObject_NextFilter(e){let t=this._objectClass,s=t.IsFamily(),n=t.GetFamilyIndex(),i=t.IsInContainer(),r=this._behaviorIndex,a=0<=r,o=this._anyParamVariesPerInstance,l=this._results,h=this._func,c=this._isInverted,u=this._isInOrBlock&&!this._isTrigger,d=e._GetOwnInstances(),_=e._GetOwnElseInstances(),p=u&&!this._eventBlock.IsFirstConditionOfType(this),m=p?_:d,g=0,f=!1;for(let t=0,e=m.length;t<e;++t){const y=m[t];o&&this._EvaluateVaryingParameters(t);let e;if(a){const C=s?y.GetObjectClass().GetFamilyBehaviorOffset(n):0;e=h.apply(y.GetBehaviorInstances()[r+C].GetSdkInstance(),l)}else e=h.apply(y.GetSdkInstance(),l);C33.xor(e,c)?(f=!0,p?(d.push(y),i&&y._PushSiblingsToSolInstances()):(m[g]=y,i&&y._SetSiblingsToSolInstancesIndex(g),++g)):p?(m[g]=y,i&&y._SetSiblingsToSolElseInstancesIndex(g),++g):u&&(_.push(y),i)&&y._PushSiblingsToSolElseInstances()}C33.truncateArray(m,g),i&&t._TruncateContainerSols(p,g);const S=f;return p&&!f&&(f=this._OrBlockCheckInstances(d)),t.FinishCondition(S||u),u?f:e.HasAnyInstances()}_OrBlockCheckInstances(s){const e=this._objectClass,n=e.IsFamily(),i=e.GetFamilyIndex(),r=this._anyParamVariesPerInstance,a=this._behaviorIndex,o=0<=a,l=this._results,h=this._func,c=this._isInverted;for(let t=0,e=s.length;t<e;++t){const u=s[t];r&&this._EvaluateVaryingParameters(t);let e;if(o){const d=n?u.GetObjectClass().GetFamilyBehaviorOffset(i):0;e=h.apply(u.GetBehaviorInstances()[a+d].GetSdkInstance(),l)}else e=h.apply(u.GetSdkInstance(),l);if(C33.xor(e,c))return!0}return!1}ReevaluateParameter(e,t){return this._parameters[e].Get(t)}GetFastTriggerValue(){const e=this._parameters;if(e.length)return e[0]._GetFastTriggerValue();throw new Error("no parameters")}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;const t={};for(const[s,n]of this._savedData.entries()){let e=n;"collmemory"===s&&(e=[...n.entries()].map(e=>[e[0].GetUID(),e[1].GetUID(),e[2]])),t[s]=e}return{ex:t}}_LoadFromJson(e){if(this._savedData&&(this._savedData.clear(),this._savedData=null),e){const t=this._runtime,s=e.ex;if(s){const n=this.GetSavedDataMap();n.clear();for(const[i,r]of Object.entries(s)){let e=r;"collmemory"===i&&(e=C33.New(C33.PairMap,r.map(e=>[t.GetInstanceByUID(e[0]),t.GetInstanceByUID(e[1]),e[2]]).filter(e=>e[0]&&e[1]))),n.set(i,e)}}}}}}{let EvalParams2=function(s,n){for(let e=0,t=s.length;e<t;++e)n[e]=s[e].Get(0)};EvalParams=EvalParams2;const C33=self.C3,assert=self.assert,EMPTY_PARAMS_ARRAY=[],noop=function(){},noopGenerator=function*(){},FLAG_CANPICKANYOBJECTCLASS=1,FLAG_COPYPICKED=2,FLAG_CUSTOM_ACE=4,FLAG_IS_ASYNC=8,FLAG_CAN_BAIL_OUT=16;C33.Action=class extends C33.DefendedBase{constructor(e,t,s){super();const n=(this._eventBlock=e).GetRuntime(),i=(this._runtime=n,this._index=s,this._sid=4<=t.length?t[3]:-1,this._actionType=5<=t.length?255&t[4]:0,this._flags=5<=t.length?t[4]>>8:0,this._func=null,this._objectClass=null,this._behaviorType=null,this._behaviorIndex=-1,this._systemPlugin=null,this._callFunctionName="",this._callCustomAceObjectClass=null,this._callEventBlock=null,this.Run=noop,this.DebugRun=noop,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._savedData=null,this._unsavedData=null,-3===t[0]),r=i?t[2]:t[5];if(this._debugData=n.IsDebug()||i?{isBreakpoint:r[0],canDebug:r[1],index:r[2]}:null,-1===t[0])this._systemPlugin=n.GetSystemPlugin(),this._func=n.GetObjectReference(t[1]);else if(-2===t[0])this._callFunctionName=t[1];else if(i){const a=n.GetObjectReference(t[1]);this._func=a,this.Run=this.RunUserScript,this.DebugRun=this.DebugRunUserScript,this._flags|=FLAG_IS_ASYNC}else this._objectClass=n.GetObjectClassByIndex(t[0]),this._flags&FLAG_CUSTOM_ACE?(this._callFunctionName=t[1],this._callCustomAceObjectClass=n.GetObjectClassByIndex(t[2])):(t[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2])),this._func=n.GetObjectReference(t[1]));if(7===t.length){const o=t[6];for(const l of o)this._parameters.push(C33.Parameter.Create(this,l,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._parameters=EMPTY_PARAMS_ARRAY,this._results=EMPTY_PARAMS_ARRAY),this.CanPickAnyObjectClass()&&(this._eventBlock.SetAllSolModifiers(),this._eventBlock.SetSolWriterAfterCnds()),this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(e,t,s){return C33.New(C33.Action,e,t,s)}_PostInit(){for(const e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);if(this._systemPlugin)this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem;else if(this._callFunctionName)this._flags&FLAG_CUSTOM_ACE?this._SetCallCustomActionRunMethod():this._SetCallFunctionRunMethod(),this._callFunctionName="",this._callCustomAceObjectClass=null;else if(this.Run===this.RunUserScript){const t=this._func,s=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=t.bind(null,this._runtime.GetIRuntime(),s)}else this._behaviorType?this.IsAsync()?(this.Run=this._RunBehavior_Async,this.DebugRun=this._DebugRunBehavior_Async):(this.Run=this._RunBehavior,this.DebugRun=this._DebugRunBehavior):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this.IsStatic()?(this.Run=this._RunObject_Static,this.DebugRun=this._DebugRunObject_Static):this.IsAsync()?(this.Run=this._RunObject_Async,this.DebugRun=this._DebugRunObject_Async):this.CallBeforeAfterHooks()?(this.Run=this._RunObject_BeforeAfterHooks,this.DebugRun=this._DebugRunObject_BeforeAfterHooks):this._parameters.length?this._parameters.every(e=>e.VariesPerInstance())?(this.Run=this._RunObject_AllParamsVary,this.DebugRun=this._DebugRunObject_AllParamsVary):this._anyParamVariesPerInstance?(this.Run=this._RunObject_SomeParamsVary,this.DebugRun=this._DebugRunObject_SomeParamsVary):this._parameters.every(e=>e.IsConstant())?(EvalParams2(this._parameters,this._results),this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst):(this.Run=this._RunObject_ParamsDontVary,this.DebugRun=this._DebugRunObject_ParamsDontVary):(this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst)}_SetSystemRunMethod(){const e=this._systemPlugin,t=this._systemPlugin;this._SetRunMethodForBoundFunc(e,t,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){const e=this._eventBlock.GetEventSheetManager(),s=e.GetFunctionBlockByName(this._callFunctionName);if(s.IsEnabled()){const n=0!=(this._flags&FLAG_COPYPICKED);this._callEventBlock=s.GetEventBlock();let t=[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents()])];t=e._DeduplicateSolModifierList(t);const i=!s.IsCopyPicked()&&this._HasCopyPickedParent()?{pushCleanSolDynamic:!0}:null;if(this.Run=C33.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,t,this._parameters,n,i),this._runtime.IsDebug()){const r=this;this.DebugRun=function*(){(r.IsBreakpoint()||r._runtime.DebugBreakNext())&&(yield r);const e=yield*r._callEventBlock.DebugRunAsFunctionCall(t,r._parameters,n,i);return e}}else this.DebugRun=noopGenerator}else this.Run=noop,this.DebugRun=noopGenerator}_SetCallCustomActionRunMethod(){const r=this._eventBlock.GetEventSheetManager(),a=r.GetCustomActionBlockByName(this._callCustomAceObjectClass,this._callFunctionName);if(a.IsEnabled()){const o=0!=(this._flags&FLAG_COPYPICKED);this._callEventBlock=a.GetEventBlock();let t=[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents(),this._objectClass,a.GetObjectClass()])],e=(t=r._DeduplicateSolModifierList(t),!this._objectClass.IsFamily()&&!a.GetObjectClass().IsFamily()),s=!this._objectClass.IsFamily()&&a.GetObjectClass().IsFamily(),n=this._objectClass.IsFamily(),i=null;if(!a.IsCopyPicked()&&this._HasCopyPickedParent()&&((i=i||{}).pushCleanSolDynamic=!0),!s&&o||((i=i||{}).copyFromObjectClass=this._objectClass,i.copyToObjectClass=a.GetObjectClass()),e||s||n&&!a.HasCustomACEOverrides()?this.Run=C33.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,t,this._parameters,o,i):n&&(this.Run=C33.FunctionBlock.prototype.RunAsFamilyCustomActionWithOverrides.bind(a,t,this._parameters)),this._runtime.IsDebug()){const l=this;e||s||n&&!a.HasCustomACEOverrides()?this.DebugRun=function*(){(l.IsBreakpoint()||l._runtime.DebugBreakNext())&&(yield l);const e=yield*l._callEventBlock.DebugRunAsFunctionCall(t,l._parameters,o,i);return e}:n&&(this.DebugRun=function*(){(l.IsBreakpoint()||l._runtime.DebugBreakNext())&&(yield l);const e=yield*a.DebugRunAsFamilyCustomActionWithOverrides(t,l._parameters);return e})}else this.DebugRun=noopGenerator}else this.Run=noop,this.DebugRun=noopGenerator}_SetRunMethodForBoundFunc(e,t,s){const n=this._func,i=this._parameters;if(0===i.length)this.Run=e._GetBoundACEMethod(n,t);else if(1===i.length){const r=i[0];if(r.IsConstant())this.Run=e._GetBoundACEMethod_1param(n,t,r.Get(0));else{const a=e._GetBoundACEMethod(n,t);this.Run=function(){return a(r.Get(0))}}}else if(2===i.length){const o=i[0],l=i[1];if(o.IsConstant()&&l.IsConstant())this.Run=e._GetBoundACEMethod_2params(n,t,o.Get(0),l.Get(0));else{const h=e._GetBoundACEMethod(n,t);this.Run=function(){return h(o.Get(0),l.Get(0))}}}else if(3===i.length){const c=i[0],u=i[1],d=i[2];if(c.IsConstant()&&u.IsConstant()&&d.IsConstant())this.Run=e._GetBoundACEMethod_3params(n,t,c.Get(0),u.Get(0),d.Get(0));else{const _=e._GetBoundACEMethod(n,t);this.Run=function(){return _(c.Get(0),u.Get(0),d.Get(0))}}}else this.Run=s}GetSID(){return this._sid}IsAsync(){return 0!=(this._flags&FLAG_IS_ASYNC)}CanBailOut(){return 0!=(this._flags&FLAG_CAN_BAIL_OUT)}CallBeforeAfterHooks(){return 1===this._actionType}IsStatic(){return 2===this._actionType}CanPickAnyObjectClass(){return 0!=(this._flags&FLAG_CANPICKANYOBJECTCLASS)}HasReturnType(){return this.IsAsync()||this.CanBailOut()}GetObjectClass(){return this._objectClass}GetImplementationAddon(){return this._behaviorType?this._behaviorType.GetBehavior():this._objectClass?this._objectClass.GetPlugin():null}GetImplementationSdkVersion(){const e=this.GetImplementationAddon();return e?e.GetSdkVersion():1}GetEventBlock(){return this._eventBlock}_HasCopyPickedParent(){let e=this._eventBlock;do{if(e instanceof C33.FunctionBlock&&e.IsCopyPicked())return!0}while(e=e.GetScopeParent());return!1}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const e=this._results;return EvalParams2(this._parameters,e),this._func.apply(this._systemPlugin,e)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results,t=(EvalParams2(this._parameters,e),yield*this._func.apply(this._systemPlugin,e));return t}return this.Run()}_RunSingleGlobal(){const e=this._results;return EvalParams2(this._parameters,e),this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results,t=(EvalParams2(this._parameters,e),yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e));return t}return this.Run()}_RunObject_ParamsConst(){const s=this._results,n=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=n.length;e<t;++e)this._func.apply(n[e].GetSdkInstance(),s)}*_DebugRunObject_ParamsConst(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const s=this._results,n=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=n.length;e<t;++e)yield*this._func.apply(n[e].GetSdkInstance(),s)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){const s=this._results,n=(EvalParams2(this._parameters,s),this._objectClass.GetCurrentSol().GetInstances());for(let e=0,t=n.length;e<t;++e)this._func.apply(n[e].GetSdkInstance(),s)}*_DebugRunObject_ParamsDontVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const s=this._results,n=(EvalParams2(this._parameters,s),this._objectClass.GetCurrentSol().GetInstances());for(let e=0,t=n.length;e<t;++e)yield*this._func.apply(n[e].GetSdkInstance(),s)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){const n=this._parameters,i=this._results,t=this._func,r=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,e=r.length;s<e;++s){const a=r[s];for(let e=0,t=n.length;e<t;++e)i[e]=n[e].Get(s);t.apply(a.GetSdkInstance(),i)}}*_DebugRunObject_AllParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const n=this._parameters,i=this._results,t=this._func,r=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,e=r.length;s<e;++s){const a=r[s];for(let e=0,t=n.length;e<t;++e)i[e]=n[e].Get(s);yield*t.apply(a.GetSdkInstance(),i)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){const n=this._parameters,i=this._results,t=this._func,r=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=n.length;e<t;++e){const s=n[e];s.VariesPerInstance()||(i[e]=s.Get(0))}for(let s=0,e=r.length;s<e;++s){const a=r[s];for(let e=0,t=n.length;e<t;++e){const o=n[e];o.VariesPerInstance()&&(i[e]=o.Get(s))}t.apply(a.GetSdkInstance(),i)}}*_DebugRunObject_SomeParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const n=this._parameters,i=this._results,t=this._func,r=this._objectClass.GetCurrentSol().GetInstances();for(let e=0,t=n.length;e<t;++e){const s=n[e];s.VariesPerInstance()||(i[e]=s.Get(0))}for(let s=0,e=r.length;s<e;++s){const a=r[s];for(let e=0,t=n.length;e<t;++e){const o=n[e];o.VariesPerInstance()&&(i[e]=o.Get(s))}yield*t.apply(a.GetSdkInstance(),i)}}else this._RunObject_SomeParamsVary()}_RunObject_BeforeAfterHooks(){const n=this._parameters,i=this._results,t=this._func,e=this._objectClass,s=e.GetSdkType(),r=e.GetCurrentSol().GetInstances();s.BeforeRunAction(t);for(let s=0,e=r.length;s<e;++s){const a=r[s];for(let e=0,t=n.length;e<t;++e)i[e]=n[e].Get(s);t.apply(a.GetSdkInstance(),i)}s.AfterRunAction(t)}*_DebugRunObject_BeforeAfterHooks(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const n=this._parameters,i=this._results,t=this._func,e=this._objectClass,s=e.GetSdkType(),r=e.GetCurrentSol().GetInstances();s.BeforeRunAction(t);for(let s=0,e=r.length;s<e;++s){const a=r[s];for(let e=0,t=n.length;e<t;++e)i[e]=n[e].Get(s);yield*t.apply(a.GetSdkInstance(),i)}s.AfterRunAction(t)}else this._RunObject_BeforeAfterHooks()}_RunObject_Static(){const e=this._results;return EvalParams2(this._parameters,e),this._func.apply(this._behaviorType||this._objectClass,e)}*_DebugRunObject_Static(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._results;EvalParams2(this._parameters,t);let e=this._func.apply(this._behaviorType||this._objectClass,t);return C33.IsIterator(e)?yield*e:e}return this._RunObject_Static()}_RunBehavior(){const e=this._objectClass,t=e.IsFamily(),n=e.GetFamilyIndex(),i=this._parameters,r=this._anyParamVariesPerInstance,a=this._results,o=this._func,l=this._behaviorIndex,h=e.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){const s=i[e];s.VariesPerInstance()||(a[e]=s.Get(0))}for(let s=0,e=h.length;s<e;++s){const c=h[s];if(r)for(let e=0,t=i.length;e<t;++e){const d=i[e];d.VariesPerInstance()&&(a[e]=d.Get(s))}const u=t?c.GetObjectClass().GetFamilyBehaviorOffset(n):0;o.apply(c.GetBehaviorInstances()[l+u].GetSdkInstance(),a)}}*_DebugRunBehavior(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._objectClass,t=e.IsFamily(),n=e.GetFamilyIndex(),i=this._parameters,r=this._anyParamVariesPerInstance,a=this._results,o=this._func,l=this._behaviorIndex,h=e.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){const s=i[e];s.VariesPerInstance()||(a[e]=s.Get(0))}for(let s=0,e=h.length;s<e;++s){const c=h[s];if(r)for(let e=0,t=i.length;e<t;++e){const d=i[e];d.VariesPerInstance()&&(a[e]=d.Get(s))}const u=t?c.GetObjectClass().GetFamilyBehaviorOffset(n):0;yield*o.apply(c.GetBehaviorInstances()[l+u].GetSdkInstance(),a)}}else this._RunBehavior()}_RunObject_Async(){const n=this._parameters,i=this._results,t=this._func,r=this._objectClass.GetCurrentSol().GetInstances(),a=[];for(let s=0,e=r.length;s<e;++s){const o=r[s];for(let e=0,t=n.length;e<t;++e)i[e]=n[e].Get(s);a.push(t.apply(o.GetSdkInstance(),i))}return Promise.all(a)}*_DebugRunObject_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const n=this._parameters,i=this._results,t=this._func,r=this._objectClass.GetCurrentSol().GetInstances(),a=[];for(let s=0,e=r.length;s<e;++s){const o=r[s];for(let e=0,t=n.length;e<t;++e)i[e]=n[e].Get(s);a.push(yield*t.apply(o.GetSdkInstance(),i))}return Promise.all(a)}return this._RunObject_Async()}_RunBehavior_Async(){const e=this._objectClass,t=e.IsFamily(),n=e.GetFamilyIndex(),i=this._parameters,r=this._results,a=this._func,o=this._behaviorIndex,l=e.GetCurrentSol().GetInstances(),h=[];for(let s=0,e=l.length;s<e;++s){const c=l[s];for(let e=0,t=i.length;e<t;++e)r[e]=i[e].Get(s);const u=t?c.GetObjectClass().GetFamilyBehaviorOffset(n):0;h.push(a.apply(c.GetBehaviorInstances()[o+u].GetSdkInstance(),r))}return Promise.all(h)}*_DebugRunBehavior_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._objectClass,t=e.IsFamily(),n=e.GetFamilyIndex(),i=this._parameters,r=this._results,a=this._func,o=this._behaviorIndex,l=e.GetCurrentSol().GetInstances(),h=[];for(let s=0,e=l.length;s<e;++s){const c=l[s];for(let e=0,t=i.length;e<t;++e)r[e]=i[e].Get(s);const u=t?c.GetObjectClass().GetFamilyBehaviorOffset(n):0;h.push(yield*a.apply(c.GetBehaviorInstances()[o+u].GetSdkInstance(),r))}return Promise.all(h)}return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(e){console.error(`Unhandled exception running script %c${this._eventBlock.GetEventSheet().GetName()}, event ${this._eventBlock.GetDisplayNumber()}, action ${this.GetDebugIndex()+1}:`,"font-size: 1.2em; font-weight: bold;",e),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),C33.EventScript.HadUserScriptException()||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),C33.EventScript.SetHadUserScriptException())}}*DebugRunUserScript(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.RunUserScript()}_SaveToJson(){return this._savedData&&this._savedData.size?{ex:C33.ToSuperJSON(this._savedData)}:null}_LoadFromJson(e){if(this._savedData&&(this._savedData.clear(),this._savedData=null),e){const t=e.ex;t&&(this._savedData=C33.FromSuperJSON(t))}}}}{let GetInst2=function(e){return e instanceof IInstance?runtime._UnwrapScriptInterface(e):e.GetInstance()},GetWorldInfo2=function(e){return GetInst2(e).GetWorldInfo()},GetInst_SDKv22=function(e){return runtime._UnwrapScriptInterface(e)},GetWorldInfo_SDKv22=function(e){return GetInst_SDKv22(e).GetWorldInfo()},CollMemory_Add2=function(e,t,s,n){const i=t.GetUID(),r=s.GetUID();i<r?e.Set(t,s,n):e.Set(s,t,n)},CollMemory_Remove2=function(e,t,s){const n=t.GetUID(),i=s.GetUID();n<i?e.Delete(t,s):e.Delete(s,t)},CollMemory_RemoveInstance2=function(e,t){e.DeleteEither(t)},CollMemory_Get2=function(e,t,s){const n=t.GetUID(),i=s.GetUID();return n<i?e.Get(t,s):e.Get(s,t)},DoOverlapCondition2=function(e,t,s,n){if(!t)return!1;const i=0!==s||0!==n,r=e.GetWorldInfo(),a=runtime.GetCollisionEngine(),o=runtime.GetCurrentCondition(),l=o.GetEventBlock().IsOrBlock(),h=o.GetObjectClass(),c=o.IsInverted(),u=t.GetCurrentSol(),d=h!==t;rPickType=t,needsCollisionFinish=d&&!c;let _,p=0,m=0,g=rPickFromElseInstances=!1;u.IsSelectAll()?(tempRect.copy(r.GetBoundingBox()),tempRect.offset(s,n),a.GetCollisionCandidates(r.GetLayer(),t,tempRect,tempCandidates2),_=tempCandidates2):!l||runtime.IsCurrentConditionFirst()&&!u._GetOwnElseInstances().length&&u._GetOwnInstances().length?_=u._GetOwnInstances():(_=u._GetOwnElseInstances(),rPickFromElseInstances=!0),i&&(p=r.GetX(),m=r.GetY(),r.OffsetXY(s,n),r.SetBboxChanged());for(const f of _)if(a.TestOverlap(e,f)){if(g=!0,c)break;d&&rToPick.add(f)}return i&&(r.SetXY(p,m),r.SetBboxChanged()),C33.clearArray(tempCandidates2),g},FinishCollisionConditionPicking2=function(e){const t=runtime.GetCurrentEvent().IsOrBlock(),s=rPickType.GetCurrentSol(),n=s._GetOwnInstances(),i=s._GetOwnElseInstances();s.IsSelectAll()?(s.SetSetPicked(rToPick),t&&(C33.clearArray(i),s.AddElseInstances(rToPick,rPickType.GetInstances()))):t?rPickFromElseInstances?s.TransferElseInstancesToOwn(rToPick):(s.AddElseInstances(rToPick,n),s.SetSetPicked(rToPick)):s.SetSetPicked(rToPick),rPickType.ApplySolToContainer()},FinishCollisionCondition2=function(e,t){needsCollisionFinish&&(t&&FinishCollisionConditionPicking2(e),rToPick.clear(),rPickType=null,needsCollisionFinish=!1)},PickByUID_Normal2=function(e,t){const s=runtime.GetInstanceByUID(t);if(s){const n=e.GetCurrentSol();if(n.IsSelectAll()||n._GetOwnInstances().includes(s))if(e.IsFamily()){if(s.GetObjectClass().BelongsToFamily(e))return n.PickOne(s),e.ApplySolToContainer(),!0}else if(s.GetObjectClass()===e)return n.PickOne(s),e.ApplySolToContainer(),!0}return!1},PickByUID_Inverted2=function(e,i){const r=e.GetCurrentSol();if(r.IsSelectAll()){r._SetSelectAll(!1),r.ClearArrays();const s=e.GetInstances();for(let e=0,t=s.length;e<t;++e){const n=s[e];n.GetUID()===i?r._PushElseInstance(n):r._PushInstance(n)}return e.ApplySolToContainer(),!!r._GetOwnInstances().length}{let s=r._GetOwnInstances(),n=0;for(let e=0,t=s.length;e<t;++e){const a=s[e];(s[n]=a).GetUID()===i?r._PushElseInstance(a):++n}return C33.truncateArray(s,n),e.ApplySolToContainer(),!!s.length}},C33=(GetInst=GetInst2,GetWorldInfo=GetWorldInfo2,GetInst_SDKv2=GetInst_SDKv22,GetWorldInfo_SDKv2=GetWorldInfo_SDKv22,CollMemory_Add=CollMemory_Add2,CollMemory_Remove=CollMemory_Remove2,CollMemory_RemoveInstance=CollMemory_RemoveInstance2,CollMemory_Get=CollMemory_Get2,DoOverlapCondition=DoOverlapCondition2,FinishCollisionConditionPicking=FinishCollisionConditionPicking2,FinishCollisionCondition=FinishCollisionCondition2,PickByUID_Normal=PickByUID_Normal2,PickByUID_Inverted=PickByUID_Inverted2,self.C3),tempColor=new C33.Color,AnySDK={},SDKv1={},SDKv2={},runtime=null,IInstance=(C33.CommonACES_SetRuntime=function(e){runtime=e},self.IInstance),tempRect=(SDKv1.CompareX=function(e,t){return C33.compare(this.GetWorldInfo().GetX(),e,t)},SDKv2.CompareX=function(e,t){return C33.compare(this.x,e,t)},SDKv1.CompareY=function(e,t){return C33.compare(this.GetWorldInfo().GetY(),e,t)},SDKv2.CompareY=function(e,t){return C33.compare(this.y,e,t)},SDKv1.IsOnScreen=function(){return this.GetWorldInfo().IsInViewport2()},SDKv2.IsOnScreen=function(){return this.isOnScreen()},AnySDK.IsOutsideLayout=function(){const e=GetWorldInfo2(this),t=e.GetLayout(),s=e.GetBoundingBox();return s.getRight()<0||s.getBottom()<0||s.getLeft()>t.GetWidth()||s.getTop()>t.GetHeight()},AnySDK.PickDistance=function(s,n,i){const e=this.GetCurrentSol(),r=e.GetInstances();if(!r.length)return!1;let a=r[0],o=a.GetWorldInfo(),l=a,h=C33.distanceSquared(o.GetX(),o.GetY(),n,i);for(let e=1,t=r.length;e<t;++e){a=r[e],o=a.GetWorldInfo();const c=C33.distanceSquared(o.GetX(),o.GetY(),n,i);(0===s&&c<h||1===s&&c>h)&&(h=c,l=a)}return e.PickOne(l),!0},SDKv1.SetX=function(e){const t=this.GetWorldInfo();t.GetX()!==e&&(t.SetX(e),t.SetBboxChanged())},SDKv2.SetX=function(e){this.x=+e},SDKv1.SetY=function(e){const t=this.GetWorldInfo();t.GetY()!==e&&(t.SetY(e),t.SetBboxChanged())},SDKv2.SetY=function(e){this.y=+e},SDKv1.SetPos=function(e,t){const s=this.GetWorldInfo();s.EqualsXY(e,t)||(s.SetXY(e,t),s.SetBboxChanged())},SDKv2.SetPos=function(e,t){this.setPosition(e,t)},AnySDK.SetPosToObject=function(e,t){if(e){const s=GetInst2(this),n=e.GetPairedInstance(s);if(n){const[i,r]=n.GetImagePoint(t),a=s.GetWorldInfo();a.GetX()===i&&a.GetY()===r||(a.SetXY(i,r),a.SetBboxChanged())}}},AnySDK.MoveForward=function(e){if(0!==e){const t=GetWorldInfo2(this);t.OffsetXY(t.GetCosAngle()*e,t.GetSinAngle()*e),t.SetBboxChanged()}},SDKv1.MoveAtAngle=function(e,t){if(0!==t){const s=this.GetWorldInfo();e=C33.toRadians(e),s.OffsetXY(Math.cos(e)*t,Math.sin(e)*t),s.SetBboxChanged()}},SDKv2.MoveAtAngle=function(e,t){0!==t&&(e=C33.toRadians(e),this.offsetPosition(Math.cos(e)*t,Math.sin(e)*t))},SDKv1.GetX=function(){return this.GetWorldInfo().GetX()},SDKv2.GetX=function(){return this.x},SDKv1.GetY=function(){return this.GetWorldInfo().GetY()},SDKv2.GetY=function(){return this.y},AnySDK.GetDt=function(){return runtime.GetDt(GetInst2(this))},SDKv1.CompareWidth=function(e,t){return C33.compare(this.GetWorldInfo().GetWidth(),e,t)},SDKv2.CompareWidth=function(e,t){return C33.compare(this.width,e,t)},SDKv1.CompareHeight=function(e,t){return C33.compare(this.GetWorldInfo().GetHeight(),e,t)},SDKv2.CompareHeight=function(e,t){return C33.compare(this.height,e,t)},SDKv1.SetWidth=function(e){const t=this.GetWorldInfo();t.GetWidth()!==e&&(t.SetWidth(e),t.SetBboxChanged())},SDKv2.SetWidth=function(e){this.width=e},SDKv1.SetHeight=function(e){const t=this.GetWorldInfo();t.GetHeight()!==e&&(t.SetHeight(e),t.SetBboxChanged())},SDKv2.SetHeight=function(e){this.height=e},SDKv1.SetSize=function(e,t){const s=GetWorldInfo2(this);s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())},SDKv2.SetSize=function(e,t){this.setSize(e,t)},SDKv1.GetWidth=function(){return this.GetWorldInfo().GetWidth()},SDKv2.GetWidth=function(){return this.width},SDKv1.GetHeight=function(){return this.GetWorldInfo().GetHeight()},SDKv2.GetHeight=function(){return this.height},AnySDK.GetBboxLeft=function(){return GetWorldInfo2(this).GetBoundingBox().getLeft()},AnySDK.GetBboxTop=function(){return GetWorldInfo2(this).GetBoundingBox().getTop()},AnySDK.GetBboxRight=function(){return GetWorldInfo2(this).GetBoundingBox().getRight()},AnySDK.GetBboxBottom=function(){return GetWorldInfo2(this).GetBoundingBox().getBottom()},AnySDK.GetBboxMidX=function(){const e=GetWorldInfo2(this).GetBoundingBox();return(e.getLeft()+e.getRight())/2},AnySDK.GetBboxMidY=function(){const e=GetWorldInfo2(this).GetBoundingBox();return(e.getTop()+e.getBottom())/2},AnySDK.IsAngleWithin=function(e,t){return C33.angleDiff(GetWorldInfo2(this).GetAngle(),C33.toRadians(t))<=C33.toRadians(e)},AnySDK.IsAngleClockwiseFrom=function(e){return C33.angleClockwise(GetWorldInfo2(this).GetAngle(),C33.toRadians(e))},AnySDK.IsBetweenAngles=function(e,t){const s=C33.toRadians(e),n=C33.toRadians(t),i=GetWorldInfo2(this).GetAngle(),r=!C33.angleClockwise(n,s);return r?!(!C33.angleClockwise(i,s)&&C33.angleClockwise(i,n)):C33.angleClockwise(i,s)&&!C33.angleClockwise(i,n)},SDKv1.SetAngle=function(e){const t=this.GetWorldInfo(),s=C33.clampAngle(C33.toRadians(e));isNaN(s)||t.GetAngle()===s||(t.SetAngle(s),t.SetBboxChanged())},SDKv2.SetAngle=function(e){this.angleDegrees=e},AnySDK.RotateClockwise=function(e){if(!isNaN(e)&&0!==e){const t=GetWorldInfo2(this);t.SetAngle(t.GetAngle()+C33.toRadians(e)),t.SetBboxChanged()}},AnySDK.RotateCounterclockwise=function(e){if(!isNaN(e)&&0!==e){const t=GetWorldInfo2(this);t.SetAngle(t.GetAngle()-C33.toRadians(e)),t.SetBboxChanged()}},AnySDK.RotateTowardAngle=function(e,t){const s=GetWorldInfo2(this),n=s.GetAngle(),i=C33.angleRotate(n,C33.toRadians(t),C33.toRadians(e));isNaN(i)||n===i||(s.SetAngle(i),s.SetBboxChanged())},AnySDK.RotateTowardPosition=function(e,t,s){const n=GetWorldInfo2(this),i=n.GetAngle(),r=t-n.GetX(),a=s-n.GetY(),o=Math.atan2(a,r),l=C33.angleRotate(i,o,C33.toRadians(e));isNaN(l)||i===l||(n.SetAngle(l),n.SetBboxChanged())},AnySDK.SetTowardPosition=function(e,t){const s=GetWorldInfo2(this),n=s.GetAngle(),i=e-s.GetX(),r=t-s.GetY(),a=Math.atan2(r,i);isNaN(a)||n===a||(s.SetAngle(a),s.SetBboxChanged())},SDKv1.GetAngle=function(){return C33.toDegrees(this.GetWorldInfo().GetAngle())},SDKv2.GetAngle=function(){return this.angleDegrees},AnySDK.CompareOpacity=function(e,t){return C33.compare(C33.roundToDp(100*GetWorldInfo2(this).GetOpacity(),6),e,t)},SDKv1.IsVisible=function(){return this.GetWorldInfo().IsVisible()},SDKv2.IsVisible=function(){return this.isVisible},AnySDK.SetVisible=function(e){const t=GetWorldInfo2(this);e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&(t.SetVisible(e),runtime.UpdateRender())},AnySDK.SetOpacity=function(e){const t=C33.clamp(e/100,0,1),s=GetWorldInfo2(this);if(s.GetTransformWithParentOpacity()){if(s._GetSceneGraphInfo().GetOwnOpacity()===t)return}else if(s.GetOpacity()===t)return;s.SetOpacity(t),runtime.UpdateRender()},AnySDK.SetDefaultColor=function(e){tempColor.setFromRgbValue(e);const t=GetWorldInfo2(this);t.GetUnpremultipliedColor().equalsIgnoringAlpha(tempColor)||(t.SetUnpremultipliedColor(tempColor),runtime.UpdateRender())},AnySDK.GetColor=function(){const e=GetWorldInfo2(this).GetUnpremultipliedColor();return C33.PackRGBAEx(e.getR(),e.getG(),e.getB(),e.getA())},AnySDK.GetOpacity=function(){return C33.roundToDp(100*GetWorldInfo2(this).GetOpacity(),6)},AnySDK.IsOnLayer=function(e){return!!e&&GetWorldInfo2(this).GetLayer()===e},AnySDK.PickTopBottom=function(s){const e=this.GetCurrentSol(),n=e.GetInstances();if(!n.length)return!1;let t=n[0],i=t;for(let e=1,t=n.length;e<t;++e){const r=n[e],a=r.GetWorldInfo(),o=i.GetWorldInfo(),l=a.GetLayer().GetIndex(),h=o.GetLayer().GetIndex();0===s?(h<l||l===h&&a.GetZIndex()>o.GetZIndex())&&(i=r):(l<h||l===h&&a.GetZIndex()<o.GetZIndex())&&(i=r)}return e.PickOne(i),!0},SDKv1.CompareZElevation=function(e,t,s){const n=this.GetWorldInfo(),i=0===e?n.GetZElevation():n.GetTotalZElevation();return C33.compare(i,t,s)},SDKv2.CompareZElevation=function(e,t,s){const n=0===e?this.zElevation:this.totalZElevation;return C33.compare(n,t,s)},SDKv1.MoveToTop=function(){this.GetWorldInfo().ZOrderMoveToTop()},SDKv2.MoveToTop=function(){this.moveToTop()},SDKv1.MoveToBottom=function(){this.GetWorldInfo().ZOrderMoveToBottom()},SDKv2.MoveToBottom=function(){this.moveToBottom()},AnySDK.MoveToLayer=function(e){e&&GetWorldInfo2(this).ZOrderMoveToLayer(e)},AnySDK.ZMoveToObject=function(e,t){const s=0===e;if(t){const n=GetInst2(this),i=t.GetFirstPicked(n);i&&n.GetWorldInfo().ZOrderMoveAdjacentToInstance(i,s)}},SDKv1.SetZElevation=function(e){const t=this.GetWorldInfo();t.GetZElevation()!==e&&(t.SetZElevation(e),runtime.UpdateRender())},SDKv2.SetZElevation=function(e){this.zElevation=e},AnySDK.LayerNumber=function(){return GetWorldInfo2(this).GetLayer().GetIndex()},AnySDK.LayerName=function(){return GetWorldInfo2(this).GetLayer().GetName()},SDKv1.ZIndex=function(){return this.GetWorldInfo().GetZIndex()},SDKv2.ZIndex=function(){return this.zIndex},SDKv1.ZElevation=function(){return this.GetWorldInfo().GetZElevation()},SDKv2.ZElevation=function(){return this.zElevation},SDKv1.TotalZElevation=function(){return this.GetWorldInfo().GetTotalZElevation()},SDKv2.TotalZElevation=function(){return this.totalZElevation},AnySDK.IsEffectEnabled=function(e){const t=GetInst2(this),s=t.GetObjectClass().GetEffectList().GetEffectTypeByName(e);if(s){const n=s.GetIndex(),i=t.GetWorldInfo().GetInstanceEffectList();return i.IsEffectIndexActive(n)}},AnySDK.SetEffectEnabled=function(e,t){const s=GetInst2(this),n=s.GetObjectClass().GetEffectList().GetEffectTypeByName(t);if(n){const i=n.GetIndex(),r=1===e,a=s.GetWorldInfo().GetInstanceEffectList();a.IsEffectIndexActive(i)!==r&&(a.SetEffectIndexActive(i,r),a.UpdateActiveEffects(),runtime.UpdateRender())}},AnySDK.SetEffectParam=function(e,t,s){const n=GetInst2(this),i=n.GetObjectClass().GetEffectList().GetEffectTypeByName(e);if(i){t=Math.floor(t);const r=i.GetShaderProgram().GetParameterType(t);if(r){"color"===r?(tempColor.setFromRgbValue(s),s=tempColor):"percent"===r&&(s/=100);const a=i.GetIndex(),o=n.GetWorldInfo().GetInstanceEffectList(),l=o.SetEffectParameter(a,t,s);l&&o.IsEffectIndexActive(a)&&runtime.UpdateRender()}}},C33.New(C33.Rect)),tempCandidates1=[],tempCandidates2=[],needsCollisionFinish=!1,rPickType=null,rPickFromElseInstances=!1,rToPick=new Set;function*DebugOnCollision(S){if(S){let e=this._runtime,t=e.GetCollisionEngine(),n=e.GetEventSheetManager(),s=n.GetEventStack(),i=n.GetCurrentCondition(),r=i.GetObjectClass(),a=i.GetSavedDataMap(),o=i.GetUnsavedDataMap(),l=s.GetCurrentStackFrame(),h=e.GetTickCount(),c=h-1,u=l.GetCurrentEvent(),d=s.Push(u),_=a.get("collmemory"),p=(_||(_=C33.New(C33.PairMap),a.set("collmemory",_)),o.get("collisionCreatedDestroyCallback")||(o.set("collisionCreatedDestroyCallback",!0),e.Dispatcher().addEventListener("instancedestroy",e=>CollMemory_RemoveInstance2(_,e.instance))),r.GetCurrentSol()),m=S.GetCurrentSol(),g=p.GetInstances(),f=null;for(let e=0;e<g.length;++e){const y=g[e];m.IsSelectAll()?(t.GetCollisionCandidates(y.GetWorldInfo().GetLayer(),S,y.GetWorldInfo().GetBoundingBox(),tempCandidates1),f=tempCandidates1,t.AddRegisteredCollisionCandidates(y,S,f)):f=m.GetInstances();for(let e=0;e<f.length;++e){const C=f[e];if(t.TestOverlap(y,C)||t.CheckRegisteredCollision(y,C)){let e=CollMemory_Get2(_,y,C),t=!1,s=-2;"number"==typeof e&&(t=!0,s=e);const G=!t||s<c;if(CollMemory_Add2(_,y,C,h),G){const T=u.GetSolModifiers(),I=(n.PushCopySol(T),r.GetCurrentSol()),b=S.GetCurrentSol();if(I._SetSelectAll(!1),b._SetSelectAll(!1),r===S){const A=I._GetOwnInstances();C33.clearArray(A),A.push(y),A.push(C),r.ApplySolToContainer()}else{const P=I._GetOwnInstances(),E=b._GetOwnInstances();C33.clearArray(P),C33.clearArray(E),P.push(y),E.push(C),r.ApplySolToContainer(),S.ApplySolToContainer()}yield*u.DebugRetrigger(l,d),n.PopSol(T)}}else CollMemory_Remove2(_,y,C)}C33.clearArray(tempCandidates1)}s.Pop()}return!1}AnySDK.OnCollision=function(S){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,S);if(S){let e=this._runtime,t=e.GetCollisionEngine(),n=e.GetEventSheetManager(),s=n.GetEventStack(),i=n.GetCurrentCondition(),r=i.GetObjectClass(),a=i.GetSavedDataMap(),o=i.GetUnsavedDataMap(),l=s.GetCurrentStackFrame(),h=e.GetTickCount(),c=h-1,u=l.GetCurrentEvent(),d=s.Push(u),_=a.get("collmemory"),p=(_||(_=C33.New(C33.PairMap),a.set("collmemory",_)),o.get("collisionCreatedDestroyCallback")||(o.set("collisionCreatedDestroyCallback",!0),e.Dispatcher().addEventListener("instancedestroy",e=>CollMemory_RemoveInstance2(_,e.instance))),r.GetCurrentSol()),m=S.GetCurrentSol(),g=p.GetInstances(),f=null;for(let e=0;e<g.length;++e){const y=g[e];m.IsSelectAll()?(t.GetCollisionCandidates(y.GetWorldInfo().GetLayer(),S,y.GetWorldInfo().GetBoundingBox(),tempCandidates1),f=tempCandidates1,t.AddRegisteredCollisionCandidates(y,S,f)):f=m.GetInstances();for(let e=0;e<f.length;++e){const C=f[e];if(t.TestOverlap(y,C)||t.CheckRegisteredCollision(y,C)){let e=CollMemory_Get2(_,y,C),t=!1,s=-2;"number"==typeof e&&(t=!0,s=e);const G=!t||s<c;if(CollMemory_Add2(_,y,C,h),G){const T=u.GetSolModifiers(),I=(n.PushCopySol(T),r.GetCurrentSol()),b=S.GetCurrentSol();if(I._SetSelectAll(!1),b._SetSelectAll(!1),r===S){const A=I._GetOwnInstances();C33.clearArray(A),A.push(y),A.push(C),r.ApplySolToContainer()}else{const P=I._GetOwnInstances(),E=b._GetOwnInstances();C33.clearArray(P),C33.clearArray(E),P.push(y),E.push(C),r.ApplySolToContainer(),S.ApplySolToContainer()}u.Retrigger(l,d),n.PopSol(T)}}else CollMemory_Remove2(_,y,C)}C33.clearArray(tempCandidates1)}s.Pop()}return!1},AnySDK.IsOverlapping=function(e){return DoOverlapCondition2(GetInst2(this),e,0,0)},AnySDK.IsOverlappingOffset=function(e,t,s){return DoOverlapCondition2(GetInst2(this),e,t,s)},AnySDK.HasParent=function(){return GetWorldInfo2(this).HasParent()},AnySDK.HasChildren=function(){return GetWorldInfo2(this).HasChildren()},AnySDK.PickParent=function(s,n){const e=this.GetCurrentSol(),i=e.GetInstances();if(0===i.length)return!1;let t=s.GetCurrentSol(),r=t.GetInstances();if(t.IsSelectAll()){const l=[...this._runtime.instancesPendingCreateForObjectClass(s)];0<l.length&&(r=r.concat(l))}if(0===r.length)return!1;const a=t.IsSelectAll()?null:new Set(r),o=new Set;for(let e=0,t=i.length;e<t;++e){const h=i[e];if(1===n)for(const c of h.parents())c.BelongsToObjectClass(s)&&(null===a||a.has(c))&&o.add(c);else{let e;if(0===n){if(null===(e=h.GetParent()))continue}else e=h.GetTopParent();e.BelongsToObjectClass(s)&&(null===a||a.has(e))&&o.add(e)}}return 0!==o.size&&(t.SetSetPicked(o),s.ApplySolToContainer(),!0)},AnySDK.PickChildren=function(s,n){const e=this.GetCurrentSol(),i=e.GetInstances();if(0===i.length)return!1;let t=s.GetCurrentSol(),r=t.GetInstances();if(t.IsSelectAll()){const l=[...this._runtime.instancesPendingCreateForObjectClass(s)];0<l.length&&(r=r.concat(l))}if(0===r.length)return!1;const a=t.IsSelectAll()?null:new Set(r),o=new Set;for(let e=0,t=i.length;e<t;++e){const h=i[e];2!==n||h.HasChildren()||!h.BelongsToObjectClass(s)||null!==a&&!a.has(h)||o.add(h);for(const c of 0===n?h.children():h.allChildren())2===n&&c.HasChildren()||c.BelongsToObjectClass(s)&&(null===a||a.has(c))&&o.add(c)}return 0!==o.size&&(t.SetSetPicked(o),s.ApplySolToContainer(),!0)},AnySDK.PickNthChild=function(s,n,i){const e=this.GetCurrentSol(),r=e.GetInstances();if(0===r.length)return!1;let t=s.GetCurrentSol(),a=t.GetInstances();if(t.IsSelectAll()){const h=[...this._runtime.instancesPendingCreateForObjectClass(s)];0<h.length&&(a=a.concat(h))}if(0===a.length)return!1;const o=t.IsSelectAll()?null:new Set(a),l=[];for(let e=0,t=r.length;e<t;++e){const c=r[e];if(0===n){const u=c.GetChildAt(i);null!==u&&u.BelongsToObjectClass(s)&&(null===o||o.has(u))&&l.push(u)}else if(1===n)for(const d of c.children())if(d.BelongsToObjectClass(s)){if(0===i){null!==o&&!o.has(d)||l.push(d);break}--i}}return 0!==l.length&&(t.SetArrayPicked(l),s.ApplySolToContainer(),!0)},AnySDK.CompareChildCount=function(e,t,s){const n=GetInst2(this);switch(e){case 0:default:return C33.compare(n.GetChildCount(),t,s);case 1:return C33.compare(n.GetAllChildCount(),t,s)}},AnySDK.AddChild=function(e,t,s,n,i,r,a,o,l,h){const c=GetInst2(this),u=runtime.GetCurrentAction().GetObjectClass();for(const d of e.allCorrespondingInstances(c,u)){if(!d.GetPlugin().SupportsSceneGraph())return;c.AddChild(d,{transformX:t,transformY:s,transformWidth:n,transformHeight:i,transformAngle:r,transformOpacity:a,transformZElevation:o,transformVisibility:l,destroyWithParent:h})}},AnySDK.RemoveChild=function(e){const t=GetInst2(this),s=runtime.GetCurrentAction().GetObjectClass();for(const n of e.allCorrespondingInstances(t,s))t.RemoveChild(n)},AnySDK.RemoveFromParent=function(){const e=GetInst2(this);if(e.HasParent()){const t=e.GetParent();t.RemoveChild(e)}},AnySDK.ChildCount=function(){return GetInst2(this).GetChildCount()},AnySDK.AllChildCount=function(){return GetInst2(this).GetAllChildCount()},AnySDK.SetMeshSize=function(e,t){e=Math.floor(e),t=Math.floor(t);const s=GetWorldInfo2(this);e<2||t<2||!isFinite(e)||!isFinite(t)?(s.ReleaseMesh(),s.SetBboxChanged()):s.CreateMesh(e,t)},AnySDK.SetMeshPoint=function(e,t,s,n,i,r,a,o){const l=GetWorldInfo2(this),h=l.SetMeshPoint(e,t,{mode:0===s?"absolute":"relative",x:n,y:i,zElevation:r,u:a,v:o});h&&l.SetBboxChanged()},AnySDK.MeshColumns=function(){const e=GetWorldInfo2(this);return e.HasMesh()?e.GetSourceMesh().GetHSize():0},AnySDK.MeshRows=function(){const e=GetWorldInfo2(this);return e.HasMesh()?e.GetSourceMesh().GetVSize():0},AnySDK.SetElementVisible=function(e){const t=GetWorldInfo2(this);e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&t.SetVisible(e)},AnySDK.SetElementCSSStyle=function(e,t){this instanceof self.IInstance?this.setElementCSSStyle(e,t):this.SetElementCSSStyle(e,t)},AnySDK.SetElementAttribute=function(e,t){this instanceof self.IInstance?this.setElementAttribute(e,""+t):this.SetElementAttribute(e,""+t)},AnySDK.RemoveElementAttribute=function(e){this instanceof self.IInstance?this.removeElementAttribute(e):this.RemoveElementAttribute(e)},AnySDK.SetElementFocus=function(){this instanceof self.IInstance?this.focusElement():this.FocusElement()},AnySDK.SetElementBlur=function(){this instanceof self.IInstance?this.blurElement():this.BlurElement()},AnySDK.IsElementFocused=function(){return this instanceof self.IInstance?this.isElementFocused():this.IsElementFocused()},AnySDK.SetElementEnabled=function(e){this instanceof self.IInstance?this._setEnabled(0!==e):this._SetEnabled(0!==e)},AnySDK.IsElementEnabled=function(){return this instanceof self.IInstance?this._isEnabled():this._IsEnabled()},SDKv1.CompareInstanceVar=function(e,t,s){return C33.compare(this.GetInstance().GetInstanceVariableValue(e),t,s)},SDKv2.CompareInstanceVar=function(e,t,s){return C33.compare(GetInst_SDKv22(this).GetInstanceVariableValue(e),t,s)},SDKv1.IsBoolInstanceVarSet=function(e){return!!this.GetInstance().GetInstanceVariableValue(e)},SDKv2.IsBoolInstanceVarSet=function(e){return!!GetInst_SDKv22(this).GetInstanceVariableValue(e)},AnySDK.PickInstVarHiLow=function(s,n){const e=this.GetCurrentSol(),i=e.GetInstances();if(!i.length)return!1;let r=this.IsFamily(),a=null,o=0;for(let e=0,t=i.length;e<t;++e){const l=i[e],h=r?l.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0,c=l.GetInstanceVariableValue(h+n);(null===a||0===s&&c<o||1===s&&c>o)&&(o=c,a=l)}return e.PickOne(a),!0},AnySDK.PickByUID=function(e){return(this._runtime.GetCurrentCondition().IsInverted()?PickByUID_Inverted2:PickByUID_Normal2)(this,e)},AnySDK.HasTags=function(e){const t=new Set(C33.splitStringAndNormalize(e)),s=GetInst2(this).GetTagsSet();return t.isSubsetOf(s)},AnySDK.Tags=function(){return GetInst2(this).GetTagsString()},AnySDK.TagsCount=function(){return GetInst2(this).GetTagsSet().size},AnySDK.TagAt=function(e){return GetInst2(this).GetTagAt(e)},AnySDK.ChangeTags=function(e,t){const s=C33.splitStringAndNormalize(t);if(0!==s.length){const n=GetInst2(this),i=new Set(n.GetTagsSet());if(0===e)for(const r of s)i.add(r);else if(1===e)for(const a of s)i.delete(a);n.SetTagsSet(i)}},AnySDK.Destroy=function(){runtime.DestroyInstance(GetInst2(this))},AnySDK.OnCreated=function(){return!0},AnySDK.OnDestroyed=function(){return!0},SDKv1.SetInstanceVar=function(e,t){this.GetInstance().SetInstanceVariableValue(e,t)},SDKv2.SetInstanceVar=function(e,t){GetInst_SDKv22(this).SetInstanceVariableValue(e,t)},SDKv1.AddInstanceVar=function(e,t){const s=this.GetInstance(),n=s.GetInstanceVariableValue(e);"number"==typeof n&&"number"!=typeof t?t=parseFloat(t):"string"==typeof n&&"string"!=typeof t&&(t=t.toString()),s.SetInstanceVariableValue(e,n+t)},SDKv2.AddInstanceVar=function(e,t){const s=GetInst_SDKv22(this),n=s.GetInstanceVariableValue(e);"number"==typeof n&&"number"!=typeof t?t=parseFloat(t):"string"==typeof n&&"string"!=typeof t&&(t=t.toString()),s.SetInstanceVariableValue(e,n+t)},SDKv1.SubInstanceVar=function(e,t){const s=this.GetInstance(),n=s.GetInstanceVariableValue(e);"number"==typeof n&&("number"!=typeof t&&(t=parseFloat(t)),s.SetInstanceVariableValue(e,n-t))},SDKv2.SubInstanceVar=function(e,t){const s=GetInst_SDKv22(this),n=s.GetInstanceVariableValue(e);"number"==typeof n&&("number"!=typeof t&&(t=parseFloat(t)),s.SetInstanceVariableValue(e,n-t))},SDKv1.SetBoolInstanceVar=function(e,t){this.GetInstance().SetInstanceVariableValue(e,t?1:0)},SDKv2.SetBoolInstanceVar=function(e,t){GetInst_SDKv22(this).SetInstanceVariableValue(e,t?1:0)},SDKv1.ToggleBoolInstanceVar=function(e){const t=this.GetInstance();t.SetInstanceVariableValue(e,0===t.GetInstanceVariableValue(e)?1:0)},SDKv2.ToggleBoolInstanceVar=function(e){const t=GetInst_SDKv22(this);t.SetInstanceVariableValue(e,0===t.GetInstanceVariableValue(e)?1:0)},AnySDK.LoadFromJsonString=function(e){let t;try{t=JSON.parse(e)}catch(e){return void console.error("Failed to load from JSON string: ",e)}const s=GetInst2(this);runtime.ClearIntancesNeedingAfterLoad(),s._OnBeforeLoad("state"),s.LoadFromJson(t,"state"),runtime.DoAfterLoad("state",{setFromJson:!0})},AnySDK.AsJSON=function(){return JSON.stringify(GetInst2(this).SaveToJson("state"))},AnySDK.ObjectTypeName=function(){return GetInst2(this).GetObjectClass().GetName()},AnySDK.Count=function(){let e=runtime.GetCurrentEventStackFrame().GetExpressionObjectClass(),t=e.GetInstanceCount();for(const s of runtime.instancesPendingCreateForObjectClass(e))++t;return t},AnySDK.PickedCount=function(){return runtime.GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length},SDKv1.GetIID=function(){return this.GetInstance().GetIID()},SDKv2.GetIID=function(){return GetInst_SDKv22(this).GetIID()},SDKv1.GetUID=function(){return this.GetInstance().GetUID()},SDKv2.GetUID=function(){return GetInst_SDKv22(this).GetUID()},AnySDK.OnInstanceSignal=function(e){const t=GetInst2(this);return e.toLowerCase()===runtime.GetEventSheetManager().GetCurrentInstanceSignalTag(t)},AnySDK.InstanceSignal=function(e){const t=GetInst2(this);runtime.GetEventSheetManager().InstanceSignal(t,e)},AnySDK.InstanceWaitForSignal=function(e){return runtime.GetEventSheetManager().AddScheduledWait().InitInstanceSignals(this.GetCurrentSol().GetInstances(),e),!0},AnySDK.TemplateName=function(){return GetInst2(this).GetTemplateName()},C33.AddCommonACEs=function(e,t,s){const n=e[1],i=e[3],r=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[10],u=e[11],d=e[12],_=e[13],p=e[14],m=e[15],g=e[16],f=t.Cnds,S=t.Acts,y=t.Exps,C=Object.assign({},AnySDK,2<=s?SDKv2:SDKv1);i&&(f.CompareX=C.CompareX,f.CompareY=C.CompareY,f.IsOnScreen=C.IsOnScreen,f.IsOutsideLayout=C.IsOutsideLayout,f.PickDistance=C.PickDistance,S.SetX=C.SetX,S.SetY=C.SetY,S.SetPos=C.SetPos,S.SetPosToObject=C.SetPosToObject,S.MoveForward=C.MoveForward,S.MoveAtAngle=C.MoveAtAngle,y.X=C.GetX,y.Y=C.GetY,y.dt=C.GetDt),r&&(f.CompareWidth=C.CompareWidth,f.CompareHeight=C.CompareHeight,S.SetWidth=C.SetWidth,S.SetHeight=C.SetHeight,S.SetSize=C.SetSize,y.Width=C.GetWidth,y.Height=C.GetHeight,y.BBoxLeft=C.GetBboxLeft,y.BBoxTop=C.GetBboxTop,y.BBoxRight=C.GetBboxRight,y.BBoxBottom=C.GetBboxBottom,y.BBoxMidX=C.GetBboxMidX,y.BBoxMidY=C.GetBboxMidY),a&&(f.AngleWithin=C.IsAngleWithin,f.IsClockwiseFrom=C.IsAngleClockwiseFrom,f.IsBetweenAngles=C.IsBetweenAngles,S.SetAngle=C.SetAngle,S.RotateClockwise=C.RotateClockwise,S.RotateCounterclockwise=C.RotateCounterclockwise,S.RotateTowardAngle=C.RotateTowardAngle,S.RotateTowardPosition=C.RotateTowardPosition,S.SetTowardPosition=C.SetTowardPosition,y.Angle=C.GetAngle),o&&(f.IsVisible=C.IsVisible,f.CompareOpacity=C.CompareOpacity,S.SetVisible=C.SetVisible,S.SetOpacity=C.SetOpacity,S.SetDefaultColor=C.SetDefaultColor,y.Opacity=C.GetOpacity,y.ColorValue=C.GetColor),l&&(f.IsOnLayer=C.IsOnLayer,f.PickTopBottom=C.PickTopBottom,f.CompareZElevation=C.CompareZElevation,S.MoveToTop=C.MoveToTop,S.MoveToBottom=C.MoveToBottom,S.MoveToLayer=C.MoveToLayer,S.ZMoveToObject=C.ZMoveToObject,S.SetZElevation=C.SetZElevation,y.LayerNumber=C.LayerNumber,y.LayerName=C.LayerName,y.ZIndex=C.ZIndex,y.ZElevation=C.ZElevation,y.TotalZElevation=C.TotalZElevation),h&&(f.IsEffectEnabled=C.IsEffectEnabled,S.SetEffectEnabled=C.SetEffectEnabled,S.SetEffectParam=C.SetEffectParam),_&&(f.HasParent=C.HasParent,f.HasChildren=C.HasChildren,f.PickParent=C.PickParent,f.PickChildren=C.PickChildren,f.PickNthChild=C.PickNthChild,f.CompareChildCount=C.CompareChildCount,S.AddChild=C.AddChild,S.RemoveChild=C.RemoveChild,S.RemoveFromParent=C.RemoveFromParent,y.ChildCount=C.ChildCount,y.AllChildCount=C.AllChildCount),p&&(S.SetMeshSize=C.SetMeshSize,S.SetMeshPoint=C.SetMeshPoint,y.MeshColumns=C.MeshColumns,y.MeshRows=C.MeshRows),c&&(f.IsVisible=C.IsVisible,S.SetVisible=C.SetElementVisible,S.SetCSSStyle=C.SetElementCSSStyle,S.SetElemAttribute=C.SetElementAttribute,S.RemoveElemAttribute=C.RemoveElementAttribute),u&&(f.IsFocused=C.IsElementFocused,S.SetFocus=C.SetElementFocus,S.SetBlur=C.SetElementBlur),d&&(f.IsEnabled=C.IsElementEnabled,S.SetEnabled=C.SetElementEnabled),m&&(f.OnCollision=C.OnCollision,f.IsOverlapping=C.IsOverlapping,f.IsOverlappingOffset=C.IsOverlappingOffset,t.FinishCollisionCondition=FinishCollisionCondition2),n||(f.CompareInstanceVar=C.CompareInstanceVar,f.IsBoolInstanceVarSet=C.IsBoolInstanceVarSet,f.PickInstVarHiLow=C.PickInstVarHiLow,f.PickByUID=C.PickByUID,f.HasTags=C.HasTags,S.SetInstanceVar=C.SetInstanceVar,S.AddInstanceVar=C.AddInstanceVar,S.SubInstanceVar=C.SubInstanceVar,S.SetBoolInstanceVar=C.SetBoolInstanceVar,S.ToggleBoolInstanceVar=C.ToggleBoolInstanceVar,S.ChangeTags=C.ChangeTags,f.OnCreated=C.OnCreated,f.OnDestroyed=C.OnDestroyed,S.Destroy=C.Destroy,S.LoadFromJsonString||(S.LoadFromJsonString=C.LoadFromJsonString),y.AsJSON||(y.AsJSON=C.AsJSON),y.Count=C.Count,y.PickedCount=C.PickedCount,y.IID=C.GetIID,y.UID=C.GetUID,y.ObjectTypeName=C.ObjectTypeName,y.Tags=C.Tags,y.TagsCount=C.TagsCount,y.TagAt=C.TagAt,f.OnInstanceSignal=C.OnInstanceSignal,S.InstanceSignal=C.InstanceSignal,S.InstanceWaitForSignal=C.InstanceWaitForSignal),g&&(y.TemplateName=C.TemplateName)}}{const C33=self.C3;C33.ScheduledWait=class extends C33.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._type="",this._time=-1,this._signalTag="",this._isSignalled=!1,this._event=null,this._actIndex=0,this._solModifiers=[],this._dynamicSolModifiers=null,this._sols=new Map,this._pendingInstances=null,this._callingFunctionBlock=null,this._asyncId=-1,this._functionParameters=null,this._functionInnerLocalVars=null,this._shouldRelease=!1}Release(){this._type="",this._time=-1,this._signalTag="",this._event=null,this._callingFunctionBlock=null,this._functionParameters=null,this._functionInnerLocalVars=null,this._asyncId=-1,C33.clearArray(this._solModifiers),this._dynamicSolModifiers&&(this._dynamicSolModifiers.clear(),this._dynamicSolModifiers=null);for(const e of this._sols.values())e.Release();this._sols.clear(),this._pendingInstances=null}_Init(){const e=this._eventSheetManager,t=e.GetRuntime().GetAllObjectClasses(),s=e.GetCurrentEventStackFrame(),n=(this._event=s.GetCurrentEvent(),this._actIndex=s.GetActionIndex()+1,e.FindFirstFunctionBlockParent(this._event));n&&(this._callingFunctionBlock=n,this._functionParameters=n.CaptureFunctionParameters(),this._functionInnerLocalVars=n._GetAllInnerLocalVariables().map(e=>e.GetValue()),n.IsAsync())&&(this._asyncId=n.PauseCurrentAsyncFunction());for(const r of t){const a=r.GetCurrentSol();a.IsSelectAll()&&!this._event.HasSolModifier(r)||(this._solModifiers.push(r),this._sols.set(r,C33.New(C33.SolState,a)))}const i=e.GetDynamicSolModifiersSet();this._dynamicSolModifiers=0<i.size?i:null}InitTimer(e){this._type="timer",this._Init(),this._time=this._eventSheetManager.GetRuntime().GetGameTime()+e}InitSignal(e){this._type="signal",this._Init(),this._signalTag=e.toLowerCase()}InitInstanceSignals(e,t){this._type="instance-signals",this._Init(),this._signalTag=t.toLowerCase(),this._pendingInstances=new Set(e)}InitPromise(e){this._type="promise",this._Init(),e.then(()=>this.SetSignalled()).catch(e=>{console.warn("[C3 runtime] Promise rejected in 'Wait for previous actions to complete': ",e),this.SetSignalled()})}IsTimer(){return"timer"===this._type}IsSignal(){return"signal"===this._type}IsInstanceSignals(){return"instance-signals"===this._type}IsPromise(){return"promise"===this._type}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=!0}SetInstanceSignalled(e){this._pendingInstances.delete(e),0===this._pendingInstances.size&&this.SetSignalled()}_ShouldRun(){return this.IsTimer()?this._time<=this._eventSheetManager.GetRuntime().GetGameTime():this.IsSignalled()}_RestoreState(e){e._Restore(this._event,this._actIndex);for(const[s,n]of this._sols.entries()){const i=s.GetCurrentSol();n._Restore(i)}this._dynamicSolModifiers&&e.SetDynamicSolModifiers([...this._dynamicSolModifiers]);const t=this._callingFunctionBlock;t&&(t.SetFunctionParameters(this._functionParameters),t._GetAllInnerLocalVariables().map((e,t)=>e.SetValue(this._functionInnerLocalVars[t])),t.IsAsync())&&t.ResumeAsyncFunction(this._asyncId)}_Run(e){this._RestoreState(e),this._event._ResumeActionsAndSubEvents(e),this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}async _DebugRun(e){this._RestoreState(e);for(const t of this._event._DebugResumeActionsAndSubEvents(e))await this._eventSheetManager.GetRuntime().DebugBreak(t);this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}ShouldRelease(){return this._shouldRelease}RemoveInstances(e){for(const t of this._sols.values())t.RemoveInstances(e);if("instance-signals"===this._type){for(const s of e)this._pendingInstances.delete(s);0===this._pendingInstances.size&&this.SetSignalled()}}_SaveToJson(){const e={},t={wt:this._type,t:this._time,st:this._signalTag,s:this._isSignalled,ev:this._event.GetSID(),sm:this._solModifiers.map(e=>e.GetSID()),dsm:this._dynamicSolModifiers?[...this._dynamicSolModifiers].map(e=>e.GetSID()):null,sols:e};this._event._HasActionIndex(this._actIndex)&&(t.act=this._event.GetActionAt(this._actIndex).GetSID());for(const[s,n]of this._sols)e[s.GetSID().toString()]=n._SaveToJson();return"instance-signals"===this._type&&(t.pi=[...this._pendingInstances].map(e=>e.GetUID())),t}static _CreateFromJson(e,t){const s=e.GetRuntime(),n=e.GetEventBlockBySID(t.ev);if(!n)return null;let i=0;if(t.hasOwnProperty("act")){const a=e.GetActionBySID(t.act);if(!a)return null;i=a.GetIndex()}const r=C33.New(C33.ScheduledWait,e);r._time=t.t,t.hasOwnProperty("wt")?r._type=t.wt:r._type=-1===r._time?"signal":"timer",r._signalTag=t.st,r._isSignalled=t.s,r._event=n,r._actIndex=i;for(const o of t.sm){const l=s.GetObjectClassBySID(o);l&&r._solModifiers.push(l)}if(Array.isArray(t.dsm))for(const h of t.dsm){const c=s.GetObjectClassBySID(h);c&&(r._dynamicSolModifiers||(r._dynamicSolModifiers=new Set),r._dynamicSolModifiers.add(c))}for(const[u,d]of Object.entries(t.sols)){const _=parseInt(u,10),p=s.GetObjectClassBySID(_);if(p){const m=C33.New(C33.SolState,null);m._LoadFromJson(e,d),r._sols.set(p,m)}}if("instance-signals"===r._type){r._pendingInstances=new Set;for(const g of t.pi){const f=s.GetInstanceByUID(g);f&&r._pendingInstances.add(f)}}return r}}}{const C33=self.C3;C33.SolState=class extends C33.DefendedBase{constructor(e){super(),this._objectClass=null,this._isSelectAll=!0,this._instances=[],e&&(this._objectClass=e.GetObjectClass(),this._isSelectAll=e.IsSelectAll(),C33.shallowAssignArray(this._instances,e._GetOwnInstances()))}Release(){this._objectClass=null,C33.clearArray(this._instances)}_Restore(e){e._SetSelectAll(this._isSelectAll),C33.shallowAssignArray(e._GetOwnInstances(),this._instances)}RemoveInstances(e){C33.arrayRemoveAllInSet(this._instances,e)}_SaveToJson(){return{sa:this._isSelectAll,insts:this._instances.map(e=>e.GetUID())}}_LoadFromJson(e,t){const s=e.GetRuntime();this._isSelectAll=!!t.sa,C33.clearArray(this._instances);for(const n of t.insts){const i=s.GetInstanceByUID(n);i&&this._instances.push(i)}}}}{let GetNextParamMap2=function(e,t){let s=e.get(t);return s||(s=new Map,e.set(t,s)),s};GetNextParamMap=GetNextParamMap2;const C33=self.C3;C33.SDKPluginBase=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._isSingleGlobal=!!e.isSingleGlobal,this._isWorldType=!!e.isWorld,this._isRotatable=!!e.isRotatable,this._mustPredraw=!!e.mustPredraw,this._hasEffects=!!e.hasEffects,this._supportsSceneGraph=!!e.supportsSceneGraph,this._supportsMesh=!!e.supportsMesh,this._isHTMLElementType=!!e.isHTMLElementType,this._is3d=!!e.is3d,this._sdkVersion=e.sdkVersion,this._singleGlobalObjectClass=null,this._boundACEMethodCache=new Map,this._boundACEMethodCache_1param=new Map,this._boundACEMethodCache_2params=new Map,this._boundACEMethodCache_3params=new Map,this._scriptInterfaceClass=e.scriptInterfaceClass,this._iPlugin=null}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetConstructor(){return(2<=this.GetSdkVersion()?this._iPlugin:this).constructor}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(e=!1){let t=this._scriptInterfaceClass;return e&&"function"!=typeof t&&2<=this.GetSdkVersion()?globalThis.ISDKPluginBase:t}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsHTMLElementType(){return this._isHTMLElementType}Is3D(){return this._is3d}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(e,t){if(!t)throw new Error("missing 'this' binding");let s=this._boundACEMethodCache.get(e);return s||(s=e.bind(t),this._boundACEMethodCache.set(e,s)),s}_GetBoundACEMethod_1param(e,t,s){if(!t)throw new Error("missing 'this' binding");let n=GetNextParamMap2(this._boundACEMethodCache_1param,e),i=n.get(s);return i||(i=e.bind(t,s),n.set(s,i)),i}_GetBoundACEMethod_2params(e,t,s,n){if(!t)throw new Error("missing 'this' binding");let i=GetNextParamMap2(this._boundACEMethodCache_2params,e),r=GetNextParamMap2(i,s),a=r.get(n);return a||(a=e.bind(t,s,n),r.set(n,a)),a}_GetBoundACEMethod_3params(e,t,s,n,i){if(!t)throw new Error("missing 'this' binding");let r=GetNextParamMap2(this._boundACEMethodCache_3params,e),a=GetNextParamMap2(r,s),o=GetNextParamMap2(a,n),l=o.get(i);return l||(l=e.bind(t,s,n,i),o.set(i,l)),l}_SetSingleGlobalObjectClass(e){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");this._singleGlobalObjectClass=e}GetSingleGlobalObjectClass(){if(this.IsSingleGlobal())return this._singleGlobalObjectClass;throw new Error("must be single-global plugin")}GetSingleGlobalInstance(){if(this.IsSingleGlobal())return this._singleGlobalObjectClass.GetSingleGlobalInstance();throw new Error("must be single-global plugin")}_InitScriptInterface(){const e=this.GetSdkVersion(),t=(C33.AddonManager._PushInitObject(this,e),this.GetScriptInterfaceClass(!0));if(t){if(this._iPlugin=new t,!(this._iPlugin instanceof self.IPlugin))throw new TypeError("plugin class must derive from IPlugin")}else this._iPlugin=new self.IPlugin;C33.AddonManager._PopInitObject(e)}GetIPlugin(){return this._iPlugin}}}{const C33=self.C3;C33.SDKDOMPluginBase=class extends C33.SDKPluginBase{constructor(e,t){super(e),this._domComponentId=t,this._nextElementId=0,this._instMap=new Map,this.AddElementMessageHandler("elem-focused",e=>e._OnElemFocused()),this.AddElementMessageHandler("elem-blurred",e=>{e&&e._OnElemBlurred()})}Release(){super.Release()}_AddElement(e){const t=this._nextElementId++;return this._instMap.set(t,e),t}_RemoveElement(e){this._instMap.delete(e)}AddElementMessageHandler(e,s){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,e=>{const t=this._instMap.get(e.elementId);s(t,e)})}}}{const C33=self.C3;C33.SDKTypeBase=class extends C33.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}Release(){this._objectClass=null,this._runtime=null,this._plugin=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}OnCreate(){}FinishCondition(e){}BeforeRunAction(e){}AfterRunAction(e){}LoadTextures(e){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(e){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,s){const n=C33.New(C33.Event,e,t);n.objectClass=this,s&&Object.assign(n,s),this.GetObjectClass().DispatchUserScriptEvent(n)}}}{const C33=self.C3;C33.SDKInstanceBase=class extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._domComponentId=t,this._wrapperComponentId=null,this._runtime=e.GetRuntime(),this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._tickFunc=null,this._tick2Func=null,this._isTicking=!1,this._isTicking2=!1,this._disposables=null,this._wasReleased=!1}Release(){this._wasReleased=!0,this._StopTicking(),this._StopTicking2(),this._tickFunc=null,this._tick2Func=null,this._disposables&&(this._disposables.Release(),this._disposables=null),this._inst=null,this._runtime=null,this._objectClass=null,this._sdkType=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(e){return this._runtime.Trigger(e,this._inst,null)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,null)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,null)}FastTrigger(e,t){return this._runtime.FastTrigger(e,this._inst,t)}DebugFastTrigger(e,t){return this._runtime.DebugFastTrigger(e,this._inst,t)}ScheduleTriggers(e){return this._runtime.ScheduleTriggers(e)}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}AddDOMMessageHandlers(e){for(const[t,s]of e)this.AddDOMMessageHandler(t,s)}PostToDOM(e,t){this._runtime.PostComponentMessageToDOM(this._domComponentId,e,t)}PostToDOMAsync(e,t){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,e,t)}_PostToDOMMaybeSync(e,t){if(!this._runtime.IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._domComponentId,handler:e,data:t,responseId:null});this.PostToDOM(e,t)}SetWrapperExtensionComponentId(e){if(!e)throw new Error("cannot set empty component id");this._wrapperComponentId=e}IsWrapperExtensionAvailable(){if(this._wrapperComponentId)return this._runtime.HasWrapperComponentId(this._wrapperComponentId);throw new Error("wrapper extension component id not set")}AddWrapperExtensionMessageHandler(e,t){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.AddWrapperExtensionMessageHandler(this._wrapperComponentId,e,t)}AddWrapperExtensionMessageHandlers(e){for(const[t,s]of e)this.AddWrapperExtensionMessageHandler(t,s)}SendWrapperExtensionMessage(e,t){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.SendWrapperExtensionMessage(this._wrapperComponentId,e,t)}SendWrapperExtensionMessageAsync(e,t){if(this._wrapperComponentId)return this._runtime.SendWrapperExtensionMessageAsync(this._wrapperComponentId,e,t);throw new Error("wrapper extension component id not set")}Tick(){}Tick2(){}_StartTicking(){this._isTicking||(this._tickFunc||(this._tickFunc=()=>this.Tick()),this._runtime.Dispatcher().addEventListener("tick",this._tickFunc),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._tick2Func||(this._tick2Func=()=>this.Tick2()),this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t,s){if(0!==t){const n=this.GetPropertyValueByIndex(e);if("number"!=typeof n)throw new Error("expected number");this.SetPropertyValueByIndex(e,n+t,s)}}SetPropertyColorOffsetValueByIndex(e,t,s,n){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,s){if(this._inst.HasScriptInterface()){const n=this.GetScriptInterface(),i=C33.New(C33.Event,e,t);i.instance=n,s&&Object.assign(i,s),n.dispatchEvent(i)}}MustPreDraw(){return!1}}}{const C33=self.C3;C33.SDKWorldInstanceBase=class extends C33.SDKInstanceBase{constructor(e,t){super(e,t),this._worldInfo=e.GetWorldInfo(),this._renderercontextlost_handler=null,this._renderercontextrestored_handler=null}Release(){if(this._renderercontextlost_handler){const e=this._runtime.Dispatcher();e.removeEventListener("renderercontextlost",this._renderercontextlost_handler),e.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler),this._renderercontextlost_handler=null,this._renderercontextrestored_handler=null}this._worldInfo=null,super.Release()}HandleWebGLContextLoss(){this.HandleRendererContextLoss()}OnWebGLContextLost(){}OnWebGLContextRestored(){}HandleRendererContextLoss(){if(!this._renderercontextlost_handler){this._renderercontextlost_handler=()=>this.OnRendererContextLost(),this._renderercontextrestored_handler=()=>this.OnRendererContextRestored();const e=this._runtime.Dispatcher();e.addEventListener("renderercontextlost",this._renderercontextlost_handler),e.addEventListener("renderercontextrestored",this._renderercontextrestored_handler)}}OnRendererContextLost(){this.OnWebGLContextLost()}OnRendererContextRestored(){this.OnWebGLContextRestored()}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return!1}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetWidth()}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetHeight()}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){const e=this.GetCurrentImageInfo();if(e){const t=e.GetTexture();if(t)return[t.GetWidth(),t.GetHeight()]}return[100,100]}GetCurrentTexRect(){const e=this.GetCurrentImageInfo();return e?e.GetTexRect():null}GetCurrentTexQuad(){const e=this.GetCurrentImageInfo();return e?e.GetTexQuad():null}IsCurrentTexRotated(){const e=this.GetCurrentImageInfo();return!!e&&e.IsRotated()}GetImagePoint(e){const t=this._inst.GetWorldInfo();return[t.GetX(),t.GetY(),t.GetTotalZElevation()]}LoadTilemapData(e,t,s){}TestPointOverlapTile(e,t){}RendersToOwnZPlane(){return!0}}}{const C33=self.C3,tempRect=C33.New(C33.Rect);C33.SDKDOMInstanceBase=class extends C33.SDKWorldInstanceBase{constructor(e,t){super(e,t),this._elementId=this.GetPlugin()._AddElement(this),this._isElementShowing=!0,this._elemHasFocus=!1,this._autoFontSize=!1,this._autoFontSizeOffset=-.2,this._lastRect=C33.New(C33.Rect,0,0,-1,-1);const s=this._runtime.GetCanvasManager();this._lastWindowWidth=s.GetLastWidth(),this._lastWindowHeight=s.GetLastHeight(),this._lastHTMLIndex=-1,this._lastHTMLZIndex=-1,this._isPendingUpdateState=!1,this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId),this.PostToDOMElement("destroy"),this._elementId=-1,super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw new Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(e,t){(t=t||{}).elementId=this._elementId,this.PostToDOM(e,t)}_PostToDOMElementMaybeSync(e,t){return(t=t||{}).elementId=this._elementId,this._PostToDOMMaybeSync(e,t)}PostToDOMElementAsync(e,t){return(t=t||{}).elementId=this._elementId,this.PostToDOMAsync(e,t)}CreateElement(e){e=e||{};const t=this.GetWorldInfo();e.elementId=this._elementId,e.isVisible=t.IsVisible(),e.htmlIndex=t.GetLayer().GetHTMLIndex(),e.htmlZIndex=t.GetHTMLZIndex(),Object.assign(e,this.GetElementState()),this._isElementShowing=!!e.isVisible,this._PostToDOMMaybeSync("create",e),this._UpdatePosition(!0)}SetElementVisible(e){this._isElementShowing!==(e=!!e)&&(this._isElementShowing=e,this.PostToDOMElement("set-visible",{isVisible:e}))}Tick(){this._UpdatePosition(!1)}_ShouldPreserveElement(){const e=this._runtime.GetCanvasManager().GetFullscreenMode();return"Android"===C33.Platform.OS&&("scale-inner"===e||"scale-outer"===e||"crop"===e)}_UpdatePosition(c){if(!this.GetInstance().IsDestroyed()){let e=this.GetWorldInfo(),t=e.GetLayer(),s=e.GetBoundingBox(),[n,i]=t.LayerToCanvasCss(s.getLeft(),s.getTop()),[r,a]=t.LayerToCanvasCss(s.getRight(),s.getBottom()),o=this._runtime.GetCanvasManager(),l=o.GetCssWidth(),h=o.GetCssHeight();if(e.IsVisible()&&t.IsVisible())if(!this._ShouldPreserveElement()&&(r<=0||a<=0||l<=n||h<=i))this.SetElementVisible(!1);else{tempRect.set(n,i,r,a);const u=o.GetLastWidth(),d=o.GetLastHeight(),_=t.GetHTMLIndex(),p=e.GetHTMLZIndex();if(!c&&tempRect.equals(this._lastRect)&&this._lastWindowWidth===u&&this._lastWindowHeight===d&&this._lastHTMLIndex===_&&this._lastHTMLZIndex===p)this.SetElementVisible(!0);else{this._lastRect.copy(tempRect),this._lastWindowWidth=u,this._lastWindowHeight=d,this._lastHTMLIndex=_,this._lastHTMLZIndex=p,this.SetElementVisible(!0);let e=null;this._autoFontSize&&(e=t.GetDisplayScale()+this._autoFontSizeOffset),this.PostToDOMElement("update-position",{left:Math.round(this._lastRect.getLeft()),top:Math.round(this._lastRect.getTop()),width:Math.round(this._lastRect.width()),height:Math.round(this._lastRect.height()),htmlIndex:_,htmlZIndex:p,fontSize:e})}}else this.SetElementVisible(!1)}}FocusElement(){this._PostToDOMElementMaybeSync("focus",{focus:!0})}BlurElement(){this._PostToDOMElementMaybeSync("focus",{focus:!1})}_OnElemFocused(){this._elemHasFocus=!0}_OnElemBlurred(){this._elemHasFocus=!1}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(e,t){this.PostToDOMElement("set-css-style",{prop:C33.CSSToCamelCase(e),val:t})}SetElementAttribute(e,t){this.PostToDOMElement("set-attribute",{name:e,val:t})}RemoveElementAttribute(e){this.PostToDOMElement("remove-attribute",{name:e})}UpdateElementState(){this._isPendingUpdateState||(this._isPendingUpdateState=!0,Promise.resolve().then(()=>{this._isPendingUpdateState=!1,this.PostToDOMElement("update-state",this.GetElementState())}))}GetElementState(){}GetElementId(){return this._elementId}}}{const C33=self.C3,IBehavior=self.IBehavior;C33.SDKBehaviorBase=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._myObjectClasses=C33.New(C33.ArraySet),this._myInstances=C33.New(C33.ArraySet),this._sdkVersion=e.sdkVersion,this._scriptInterfaceClass=e.scriptInterfaceClass,this._iBehavior=null}Release(){this._myInstances.Release(),this._myObjectClasses.Release(),this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}GetSdkVersion(){return this._sdkVersion}GetScriptInterfaceClass(e=!1){let t=this._scriptInterfaceClass;return e&&"function"!=typeof t&&2<=this.GetSdkVersion()?globalThis.ISDKBehaviorBase:t}_AddObjectClass(e){this._myObjectClasses.Add(e)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(e){this._myInstances.Add(e)}_RemoveInstance(e){this._myInstances.Delete(e)}GetInstances(){return this._myInstances.GetArray()}_InitScriptInterface(){const e=this.GetSdkVersion(),t=(C33.AddonManager._PushInitObject(this,e),this.GetScriptInterfaceClass(!0));if(t){if(this._iBehavior=new t,!(this._iBehavior instanceof IBehavior))throw new TypeError("behavior class must derive from IBehavior")}else this._iBehavior=new IBehavior;C33.AddonManager._PopInitObject(e)}GetIBehavior(){return this._iBehavior}}}{const C33=self.C3;C33.SDKBehaviorTypeBase=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e.GetRuntime(),this._behaviorType=e,this._objectClass=e.GetObjectClass(),this._behavior=e.GetBehavior(),this._behavior._AddObjectClass(this._objectClass)}Release(){this._runtime=null,this._behaviorType=null,this._objectClass=null,this._behavior=null}OnCreate(){}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}}}{const C33=self.C3;C33.SDKBehaviorInstanceBase=class extends C33.DefendedBase{constructor(e,t){super(),this._behInst=e,this._domComponentId=t,this._inst=e.GetObjectInstance(),this._runtime=e.GetRuntime(),this._behaviorType=e.GetBehaviorType(),this._sdkType=this._behaviorType.GetSdkType(),this._isTicking=!1,this._isTicking2=!1,this._isPostTicking=!1,this._disposables=null}Release(){this._StopTicking(),this._StopTicking2(),this._StopPostTicking(),this._disposables&&(this._disposables.Release(),this._disposables=null),this._behInst=null,this._inst=null,this._runtime=null,this._behaviorType=null,this._sdkType=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(e){return this._runtime.Trigger(e,this._inst,this._behaviorType)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,this._behaviorType)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){this._isTicking||(this._runtime._AddBehInstToTick(this),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime._RemoveBehInstToTick(this),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._runtime._AddBehInstToTick2(this),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime._RemoveBehInstToTick2(this),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}_StartPostTicking(){this._isPostTicking||(this._runtime._AddBehInstToPostTick(this),this._isPostTicking=!0)}_StopPostTicking(){this._isPostTicking&&(this._runtime._RemoveBehInstToPostTick(this),this._isPostTicking=!1)}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}OnSpriteFrameChanged(e,t){}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0!==t){const s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw new Error("expected number");this.SetPropertyValueByIndex(e,s+t)}}SetPropertyColorOffsetValueByIndex(e,t,s,n){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(e,t,s){if(this._behInst.HasScriptInterface()){const n=this.GetScriptInterface(),i=C33.New(C33.Event,e,t);i.behaviorInstance=n,i.instance=n.instance,s&&Object.assign(i,s),n.dispatchEvent(i)}}}}{let ValidateInternalAPIToken2=function(e){if(e!==internalApiToken)throw new Error("invalid internal API token")},C33=(ValidateInternalAPIToken=ValidateInternalAPIToken2,self.C3),internalApiToken=(C33.Plugins={},C33.Behaviors={},C33._GetInternalAPIToken()),initObjectStack=[],initObjectStack2=[],initPropertiesStack=[],originalPushInitObject=null,originalPopInitObject=null,originalGetInitObject=null,originalGetInitObject2=null,pluginsByCtor=new Map,behaviorsByCtor=new Map;C33.AddonManager=class extends C33.DefendedBase{constructor(e,t){super(),this._runtime=e,this._allPlugins=[],this._systemPlugin=null,this._allBehaviors=[],this._delayCreateBehaviors=new Map,this._solidBehavior=null,this._jumpthruBehavior=null,this._wrapperComponentIds=new Set(t)}CreatePlugin(e){const t=e[19],s=this._runtime.GetObjectReference(e[0]);if(!s)throw new Error("missing plugin");C33.AddCommonACEs(e,s,t);const n=2<=t?C33.SDKPluginBase:s,i=C33.New(n,{runtime:this._runtime,isSingleGlobal:e[1],isWorld:e[2],isRotatable:e[5],hasEffects:e[8],mustPredraw:e[9],supportsSceneGraph:e[13],supportsMesh:e[14],isHTMLElementType:e[17],is3d:e[18],sdkVersion:t,scriptInterfaceClass:2<=t?s:null});i.OnCreate(),this._allPlugins.push(i),pluginsByCtor.set(s,i)}CreateSystemPlugin(){this._systemPlugin=C33.New(C33.Plugins.System,{runtime:this._runtime,isSingleGlobal:!0}),this._systemPlugin.OnCreate()}CreateBehavior(e){const s=e[1],n=this._runtime.GetObjectReference(e[0]);if(!n)throw new Error("missing behavior");this._delayCreateBehaviors.set(n,()=>{const e=2<=s?C33.SDKBehaviorBase:n,t=C33.New(e,{runtime:this._runtime,sdkVersion:s,scriptInterfaceClass:2<=s?n:null});t.OnCreate(),this._allBehaviors.push(t),behaviorsByCtor.set(n,t),!this._solidBehavior&&C33.Behaviors.solid&&t instanceof C33.Behaviors.solid?this._solidBehavior=t:!this._jumpthruBehavior&&C33.Behaviors.jumpthru&&t instanceof C33.Behaviors.jumpthru&&(this._jumpthruBehavior=t),t._InitScriptInterface()})}_DelayCreateBehavior(e){const t=this._delayCreateBehaviors.get(e);t&&(t(),this._delayCreateBehaviors.delete(e))}static _PushInitObject(e,t=1){if(C33.AddonManager._PushInitObject!==originalPushInitObject)throw new Error("invalid method");1===t&&initObjectStack.push(e),initObjectStack2.push(e)}static _PopInitObject(e=1){if(C33.AddonManager._PopInitObject!==originalPopInitObject)throw new Error("invalid method");1===e&&initObjectStack.pop(),initObjectStack2.pop()}static _GetInitObject(){if(C33.AddonManager._GetInitObject!==originalGetInitObject)throw new Error("invalid method");if(0===initObjectStack.length)throw new Error("no init object set");return initObjectStack.at(-1)}static _GetInitObject2(e){if(C33.AddonManager._GetInitObject2!==originalGetInitObject2)throw new Error("invalid method");if(ValidateInternalAPIToken2(e),0===initObjectStack2.length)throw new Error("no init object set");return initObjectStack2.at(-1)}static _PushInitProperties(e){initPropertiesStack.push(e)}static _PopInitProperties(){initPropertiesStack.pop()}static _GetInitProperties(){if(0===initPropertiesStack.length)throw new Error("no init properties set");return initPropertiesStack.at(-1)}_InitAddonScriptInterfaces(){for(const e of this._allPlugins)e._InitScriptInterface()}static GetPluginByConstructorFunction(e){return pluginsByCtor.get(e)||null}static GetBehaviorByConstructorFunction(e){return behaviorsByCtor.get(e)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}HasWrapperComponentId(e){return this._wrapperComponentIds.has(e)}},originalPushInitObject=C33.AddonManager._PushInitObject,originalPopInitObject=C33.AddonManager._PopInitObject,originalGetInitObject=C33.AddonManager._GetInitObject,originalGetInitObject2=C33.AddonManager._GetInitObject2}{const C33=self.C3,allImageInfos=new Set;C33.ImageInfo=class extends C33.DefendedBase{constructor(){super(),this._generation=0,this._url="",this._size=0,this._offsetX=0,this._offsetY=0,this._width=0,this._height=0,this._isRotated=!1,this._hasMetaData=!1,this._imageAsset=null,this._textureState="",this._rcTex=C33.New(C33.Rect),this._quadTex=C33.New(C33.Quad),this._blobUrl="",this._iImageInfo=new self.IImageInfo(this),allImageInfos.add(this)}Release(){this.ReleaseTexture(),this._imageAsset&&0===this._imageAsset.GetRefCount()&&this._imageAsset.Release(),this._imageAsset=null,allImageInfos.delete(this),this.ReleaseBlobURL()}static OnRendererContextLost(){for(const e of allImageInfos)e._textureState="",e._rcTex.set(0,0,0,0),e._quadTex.setFromRect(e._rcTex)}LoadData(e){this._url=e[0],this._size=e[1],this._offsetX=e[2],this._offsetY=e[3],this._width=e[4],this._height=e[5],this._isRotated=e[6],this._hasMetaData=!0}LoadDynamicAsset(e,t){if(this._imageAsset)throw new Error("already loaded asset");this._url=t;const s={};return C33.IsAbsoluteURL(t)&&(s.loadPolicy="remote"),this.LoadAsset(e,s),this._imageAsset.Load()}LoadDynamicBlobAsset(e,t){if(this._imageAsset)throw new Error("already loaded asset");this._url="",this._size=t.size,this._imageAsset=C33.New(C33.ImageAsset,e.GetAssetManager(),{blob:t,size:this._size,loadPolicy:"local"})}ReplaceWith(e){if(e===this)throw new Error("cannot replace with self");this._generation++,this.ReleaseTexture(),this._url=e._url,this._size=e._size,this._offsetX=e._offsetX,this._offsetY=e._offsetY,this._width=e._width,this._height=e._height,this._isRotated=e._isRotated,this._hasMetaData=e._hasMetaData,this._imageAsset=e._imageAsset,this._textureState=e._textureState,this._rcTex=e._rcTex,this._quadTex=e._quadTex,this.ReleaseBlobURL()}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(e,t){if(this._imageAsset)throw new Error("already got asset");t=Object.assign({},t,{url:this.GetURL(),size:this.GetSize()}),this._imageAsset=e.LoadImage(t)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(e,t){if(!this._imageAsset)throw new Error("no asset");if(this._textureState)throw new Error("already loaded texture");const s=this._generation,n=(this._textureState="loading",await this._imageAsset.LoadStaticTexture(e,t));if(this._generation!==s)return null;if(!n)return this._textureState="",null;this._textureState="loaded",this._hasMetaData||(this._width=n.GetWidth(),this._height=n.GetHeight(),this._hasMetaData=!0);const i=this._isRotated?this._height:this._width,r=this._isRotated?this._width:this._height;return this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+i,this._offsetY+r),this._rcTex.divide(n.GetWidth(),n.GetHeight()),this._quadTex.setFromRect(this._rcTex),this._isRotated&&this._quadTex.rotatePointsAnticlockwise(),n}ReleaseTexture(){this._textureState&&(this._imageAsset&&this._imageAsset.ReleaseTexture(),this._textureState="",this._rcTex.set(0,0,0,0),this._quadTex.setFromRect(this._rcTex))}GetTexture(){return this._imageAsset&&"loaded"===this._textureState?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}GetIImageInfo(){return this._iImageInfo}GetImageAsset(){return this._imageAsset}async ExtractImageToCanvas(e){e=e||await this._imageAsset.LoadToDrawable();const t=C33.CreateCanvas(this._width,this._height),s=t.getContext("2d");return this._isRotated?(s.rotate(Math.PI/-2),s.translate(-this._height,0),s.drawImage(e,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width)):s.drawImage(e,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height),t}async ExtractImageToBlobURL(e){if(!this._blobUrl){const t=await this.ExtractImageToCanvas(e),s=await C33.CanvasToBlob(t);this._blobUrl=URL.createObjectURL(s)}return this._blobUrl}ReleaseBlobURL(){this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl="")}}}{const C33=self.C3;C33.AnimationInfo=class extends C33.DefendedBase{constructor(e){super(),this._name=e[0],this._speed=e[1],this._isLooping=!!e[2],this._repeatCount=e[3],this._repeatTo=e[4],this._isPingPong=!!e[5],this._sid=e[6],this._frames=e[7].map(e=>C33.New(C33.AnimationFrameInfo,e)),this._iAnimation=new self.IAnimation(this)}static CreateDynamic(e,t){const s=C33.New(C33.AnimationInfo,[t,0,!1,0,0,!1,Math.floor(1e15*Math.random()),[]]);return s._frames.push(C33.AnimationFrameInfo.CreateDynamic(e)),s}Release(){for(const e of this._frames)e.Release();C33.clearArray(this._frames)}LoadAllAssets(e){for(const t of this._frames)t.GetImageInfo().LoadAsset(e)}LoadAllTextures(t,s){return Promise.all(this._frames.map(e=>e.GetImageInfo().LoadStaticTexture(t,s)))}ReleaseAllTextures(){for(const e of this._frames)e.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(e){if((e=Math.floor(e))<0||e>=this._frames.length)throw new RangeError("invalid frame");return this._frames[e]}InsertFrameAt(e,t){(t=Math.floor(t))<0?this._frames.unshift(e):t>=this._frames.length?this._frames.push(e):this._frames.splice(t,0,e)}RemoveFrameAt(e){if((e=Math.floor(e))<0||e>=this._frames.length)throw new RangeError("invalid frame");this._frames[e].Release(),this._frames.splice(e,1)}GetFrameIndexByTag(s){for(let e=0,t=this._frames.length;e<t;++e)if(C33.equalsNoCase(this._frames[e].GetTag(),s))return e;return-1}FrameTagOrIndexToIndex(e){if("string"!=typeof e)return e;{const t=this.GetFrameIndexByTag(e);if(-1===t)throw new Error("cannot find animation frame with tag "+e);return t}}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}GetIAnimation(){return this._iAnimation}}}{const C33=self.C3,EMPTY_IMAGE_BLOB=(()=>{const s=atob("iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAAAXNSR0IArs4c6QAAAANQTFRFAAAAp3o92gAAAAF0Uk5TAEDm2GYAAAATSURBVBgZYxgFo2AUjIJRQFcAAAV4AAHcRQIbAAAAAElFTkSuQmCC"),n=new Uint8Array(s.length);for(let e=0,t=s.length;e<t;++e)n[e]=s.charCodeAt(e);return new Blob([n],{type:"image/png"})})();C33.AnimationFrameInfo=class extends C33.DefendedBase{constructor(e){super(),this._imageInfo=C33.New(C33.ImageInfo),this._imageInfo.LoadData(e),this._duration=e[7],this._origin=C33.New(C33.Vector2,e[8],e[9]),this._imagePoints=e[10].map(e=>C33.New(C33.ImagePoint,this,e)),this._imagePointsByName=new Map;for(const s of this._imagePoints)this._imagePointsByName.set(s.GetName().toLowerCase(),s);this._collisionPoly=null;const t=e[11];6<=t.length&&(this._collisionPoly=C33.New(C33.CollisionPoly,t)),this._tag=e[12]||"",this._iAnimationFrame=new self.IAnimationFrame(this)}static CreateDynamic(e){const t=C33.New(C33.AnimationFrameInfo,["",0,0,0,100,100,!1,1,0,0,[],[],""]);return t._imageInfo.LoadDynamicBlobAsset(e,EMPTY_IMAGE_BLOB),t}Release(){this._collisionPoly&&(this._collisionPoly.Release(),this._collisionPoly=null),this._imageInfo.Release(),this._imageInfo=null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(e){return this._imagePointsByName.get(e.toLowerCase())||null}GetImagePointByIndex(e){return(e=Math.floor(e))<0||e>=this._imagePoints.length?null:this._imagePoints[e]}GetImagePointCount(){return this._imagePoints.length}GetTag(){return this._tag}GetIAnimationFrame(){return this._iAnimationFrame}}}{const C33=self.C3;C33.ImagePoint=class extends C33.DefendedBase{constructor(e,t){super(),this._afi=e,this._name=t[0],this._pos=C33.New(C33.Vector2,t[1],t[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}}}{const C33=self.C3,C3Debugger=self.C3Debugger,IObjectClass=self.IObjectClass,assert=self.assert;C33.ObjectClass=class extends C33.DefendedBase{constructor(t,e,s){super();const n=t.GetObjectReference(s[1]),[i,r]=(this._runtime=t,this._plugin=C33.AddonManager.GetPluginByConstructorFunction(n),this._sdkType=null,this._instSdkCtor=n.Instance,this._index=e,this._sid=s[11],this._name=s[0],this._jsPropName=this._runtime.GetJsPropName(s[14]),this._isGlobal=!!s[9],this._isFamily=!!s[2],this._isOnLoaderLayout=!!s[10],this._instVars=s[3].map(e=>({sid:e[0],type:e[1],name:e[2],jsPropName:t.GetJsPropName(e[3])})),this._behaviorsCount=s[4],this._effectsCount=s[5],this._isWorldType=this._plugin.IsWorldType(),this._dispatcher=C33.New(C33.Event.Dispatcher),this._effectList=null,t.GetCollisionEngine().GetCollisionCellSize());if(this._collisionGrid=C33.New(C33.SparseGrid,i,r),this._anyCollisionCellChanged=!0,this._familyMembers=null,this._familyMembersSet=null,this._familyIndex=-1,this._families=null,this._familiesSet=null,this._familyInstVarMap=null,this._familyBehaviorMap=null,this._familyEffectMap=null,this._isInContainer=!1,this._container=null,this._behaviorTypes=s[8].map(e=>C33.BehaviorType.Create(this,e)),this._behaviorTypesIncludingInherited=[],this._behaviorsByName=new Map,this._behaviorNameToIndex=new Map,this._usedBehaviorCtors=new Set,this._customActionMap=new Map,this._solStack=C33.New(C33.SolStack,this),this._defaultInstanceData=null,this._defaultLayerIndex=0,this._isContained=!1,this._container=null,this._imageInfo=null,this._animations=null,this._animationsByName=null,this._animationsBySid=null,this._textureRefCount=0,this._savedData=new Map,this._unsavedData=new Map,this._instances=[],this._worldInfosByLayer=new Map,this._iidsStale=!0,this._plugin.HasEffects()&&(this._effectList=C33.New(C33.EffectList,this,s[12])),s[6]&&(this._imageInfo=C33.New(C33.ImageInfo),this._imageInfo.LoadData(s[6])),s[7]){this._animations=s[7].map(e=>C33.New(C33.AnimationInfo,e)),this._animationsByName=new Map,this._animationsBySid=new Map;for(const l of this._animations)this._animationsByName.set(l.GetName().toLowerCase(),l),this._animationsBySid.set(l.GetSID(),l)}this._isFamily?(this._familyMembers=[],this._familyMembersSet=new Set,this._familyIndex=this._runtime._GetNextFamilyIndex()):(this._families=[],this._familiesSet=new Set,this._familyInstVarMap=[],this._familyBehaviorMap=[],this._familyEffectMap=[]);const a=this._plugin.GetSdkVersion();if(a<2&&(this._sdkType=C33.New(n.Type,this,s[15]),!(this._sdkType instanceof C33.SDKTypeBase)))throw new Error("v1 sdk type must derive from SDKTypeBase");this._iObjectClass=null,this._instanceUserScriptClass=null,this._userScriptDispatcher=C33.New(C33.Event.Dispatcher),C33.AddonManager._PushInitObject(this,a);let o;if(o=2<=a?(o=n.Type)||globalThis.ISDKObjectTypeBase:this._sdkType.GetScriptInterfaceClass()){if(this._iObjectClass=new o(a<2?this:null),a<2&&!(this._iObjectClass instanceof IObjectClass))throw new TypeError("script interface class must derive from IObjectClass");if(2<=a&&!(this._iObjectClass instanceof globalThis.ISDKObjectTypeBase))throw new TypeError("script interface class must derive from ISDKObjectTypeBase")}else this._iObjectClass=new IObjectClass;if(C33.AddonManager._PopInitObject(a),s[13]){const h=s[13];if(h){const c=h[0],u=h[1],d=h[2];this._sdkType.LoadTilemapData(c,u,d)}}this._runtime.UsesLoaderLayout()&&!this._isFamily&&!this._isOnLoaderLayout&&this._isWorldType||this.OnCreate(),this._plugin.IsSingleGlobal()&&(this._plugin._SetSingleGlobalObjectClass(this),this._CreateSingleGlobalInstance(s)),this._loadInstancesJson=null}static Create(e,t,s){return C33.New(C33.ObjectClass,e,t,s)}Release(){if(this._dispatcher.Release(),this._dispatcher=null,this._imageInfo&&(this._imageInfo.Release(),this._imageInfo=null),this._animations){for(const e of this._animations)e.Release();C33.clearArray(this._animations),this._animationsByName.clear(),this._animationsBySid.clear()}this._loadInstancesJson=null,this._solStack.Release(),this._solStack=null,this._savedData.clear(),this._unsavedData.clear(),this._container=null,this._runtime=null}_LoadFamily(s){for(let e=1,t=s.length;e<t;++e){const n=this._runtime.GetObjectClassByIndex(s[e]);this._familyMembers.push(n),this._familyMembersSet.add(n),n._families.push(this),n._familiesSet.add(this)}}_SetContainer(e){this._isInContainer=!0,this._container=e}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){let e=0;if(!this._isFamily)for(const t of this._families)for(const s of t.GetBehaviorTypes()){const n=s.GetName().toLowerCase();this._behaviorsByName.set(n,s),this._behaviorNameToIndex.set(n,e),this._behaviorTypesIncludingInherited.push(s),++e}for(const i of this.GetBehaviorTypes()){const r=i.GetName().toLowerCase();this._behaviorsByName.set(r,i),this._behaviorNameToIndex.set(r,e),this._behaviorTypesIncludingInherited.push(i),++e}for(const a of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(a.GetBehavior().constructor);if(!this._isFamily&&this._families.length){let e=this._runtime.GetFamilyCount(),t=(C33.extendArray(this._familyInstVarMap,e,0),C33.extendArray(this._familyBehaviorMap,e,0),C33.extendArray(this._familyEffectMap,e,0),[]),s=0,n=0,i=0;for(const o of this._families){const l=o.GetFamilyIndex(),h=(this._familyInstVarMap[l]=s,s+=o.GetInstanceVariablesCount(),this._familyBehaviorMap[l]=n,n+=o.GetBehaviorTypesCount(),this._familyEffectMap[l]=i,i+=o.GetEffectTypesCount(),o.GetEffectList());if(h&&this._effectList)for(const c of h.GetAllEffectTypes())t.push(c.Clone(this._effectList))}this._effectList&&this._effectList.PrependEffectTypes(t)}}_CreateSingleGlobalInstance(e){const t=this._runtime._GetNewUID(),s=C33.New(C33.Instance,{runtime:this._runtime,objectType:this,uid:t});s._CreateSdkInstance(e[16],[]),this._runtime._MapInstanceByUID(t,s),this._instances.push(s)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}Dispatcher(){return this._dispatcher}OnCreate(){this._isFamily||(this._sdkType?this._sdkType.OnCreate():this._iObjectClass._onCreate())}HasLoadedTextures(){return 0<this._textureRefCount}async LoadTextures(e){this._isFamily||(this._textureRefCount++,1===this._textureRefCount&&(this._sdkType?await this._sdkType.LoadTextures(e):await this._iObjectClass._loadTextures(this._runtime.GetCanvasManager().GetIRenderer())))}ReleaseTextures(){if(!this._isFamily){if(this._textureRefCount--,this._textureRefCount<0)throw new Error("released textures too many times");0===this._textureRefCount&&(this._sdkType?this._sdkType.ReleaseTextures():this._iObjectClass._releaseTextures(this._runtime.GetCanvasManager().GetIRenderer()))}}OnDynamicTextureLoadComplete(){if(this._isFamily)throw new Error("not applicable to family");this._sdkType?this._sdkType.OnDynamicTextureLoadComplete():this._iObjectClass._onDynamicTextureLoadComplete()}async PreloadTexturesWithInstances(e){this._isFamily||(this._sdkType?await this._sdkType.PreloadTexturesWithInstances(e):await this._iObjectClass._preloadTexturesWithInstances(this._runtime.GetCanvasManager().GetIRenderer()))}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(e){return e&&this._usedBehaviorCtors.has(e)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map(e=>e.sid)}GetInstanceVariableIndexBySID(t){return this._instVars.findIndex(e=>e.sid===t)}GetInstanceVariableIndexByName(t){return this._instVars.findIndex(e=>e.name===t)}_GetAllInstanceVariableNames(){return this._instVars.map(e=>e.name)}_GetAllInstanceVariableJsPropNames(){return this._instVars.map(e=>e.jsPropName)}GetInstanceVariableType(e){if((e=Math.floor(e))<0||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].type}GetInstanceVariableName(e){if((e=Math.floor(e))<0||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(e){return this._behaviorsByName.get(e.toLowerCase())||null}GetBehaviorIndexByName(e){const t=this._behaviorNameToIndex.get(e.toLowerCase());return void 0===t?-1:t}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(e){this._defaultInstanceData=e}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(e){this._defaultLayerIndex=e}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(e){return this._familiesSet.has(e)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(e){return this._familyMembersSet.has(e)}GetFamilyBehaviorOffset(e){return this._familyBehaviorMap[e]}GetFamilyInstanceVariableOffset(e){return this._familyInstVarMap[e]}AddCustomAction(e){this._customActionMap.set(e.GetACEName().toLowerCase(),e)}HasOwnCustomActionByName(e){return!!this.GetOwnCustomActionByName(e)}GetOwnCustomActionByName(e){const t=this._customActionMap.get(e.toLowerCase());return t&&t.IsEnabled()?t:null}GetAllAnimations(){return this._animations}GetAnimationByName(e){if(this._animations)return this._animationsByName.get(e.toLowerCase())||null;throw new Error("no animations")}GetAnimationBySID(e){if(this._animations)return this._animationsBySid.get(e)||null;throw new Error("no animations")}AddAnimation(e){if(this.GetAnimationByName(e))throw new Error(`animation name '${e}' already exists`);const t=C33.AnimationInfo.CreateDynamic(this.GetRuntime(),e);return this._animations.push(t),this._animationsByName.set(t.GetName().toLowerCase(),t),this._animationsBySid.set(t.GetSID(),t),t}RemoveAnimation(e){const t=this.GetAnimationByName(e);if(!t)throw new Error(`animation name '${e}' does not exist`);if(1===this._animations.length)throw new Error("cannot remove last animation");const s=this._animations.indexOf(t);this._animations.splice(s,1),this._animationsByName.delete(t.GetName().toLowerCase()),this._animationsBySid.delete(t.GetSID()),t.Release()}GetFirstAnimation(){if(this._animations)return this._animations[0];throw new Error("no animations")}GetFirstAnimationFrame(){return this.GetFirstAnimation().GetFrameAt(0)}GetDefaultInstanceSize(){if(this._animations){const e=this.GetFirstAnimationFrame().GetImageInfo();return[e.GetWidth(),e.GetHeight()]}return this._imageInfo?[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()]:[100,100]}GetSingleGlobalInstance(){if(this._plugin.IsSingleGlobal())return this._instances[0];throw new Error("not a single-global plugin")}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances,yield*this._runtime.instancesPendingCreateForObjectClass(this)}GetInstanceCount(){return this._instances.length}_AddInstance(e){this._instances.push(e)}_SetIIDsStale(){this._iidsStale=!0}_UpdateIIDs(){if(this._iidsStale&&!this._isFamily){let t=this._instances,s=0;for(let e=t.length;s<e;++s)t[s]._SetIID(s);const e=this._runtime._GetInstancesPendingCreate();for(const n of e)n.GetObjectClass()===this&&n._SetIID(s++);this._iidsStale=!1}}GetInstanceByIID(e){const t=this._instances;if(e<t.length)return t[e];e-=t.length;const s=this._runtime._GetInstancesPendingCreate();for(const n of s)if(n.GetObjectClass()===this){if(0===e)return n;--e}return null}GetFirstPicked(e){if(e&&e.IsInContainer()&&e.GetObjectClass()!==this)for(const s of e.siblings())if(s.GetObjectClass()===this)return s;const t=this.GetCurrentSol().GetInstances();return t.length?t[0]:null}GetPairedInstance(e){const t=this.GetCurrentSol().GetInstances();return 0<t.length?t[e.GetIID()%t.length]:null}*allCorrespondingInstances(e,t){let s=this.GetCurrentSol().GetInstances(),n=s.length,i=t.GetCurrentSol(),r=t.GetCurrentSol().GetInstances(),a=r.length,o=e.GetIID(),l=(!t.IsFamily()&&i.IsSelectAll()||(o=r.indexOf(e)),Math.ceil(n/a)),h=n%a,c=0,u;u=0==h||o<h?(c=o*l,l):(c=h*l+(o-h)*(l-1),l-1);for(let e=c,t=c+u;e<t;++e)yield s[e]}FinishCondition(e){this._sdkType?.FinishCondition(e)}ApplySolToContainer(){if(this._isInContainer&&!this._isFamily){this._UpdateIIDs();const e=this.GetCurrentSol(),t=e._GetOwnInstances(),s=e.IsSelectAll(),n=this._runtime.GetCurrentEventStackFrame(),i=n&&n.GetCurrentEvent()&&n.GetCurrentEvent().IsOrBlock();for(const r of this._container.objectTypes())if(r!==this){r._UpdateIIDs();const a=r.GetCurrentSol();if(a._SetSelectAll(s),!s){const o=a._GetOwnInstances();C33.clearArray(o);for(const l of t)o.push(r.GetInstanceByIID(l.GetIID()));if(i){const h=e._GetOwnElseInstances(),c=a._GetOwnElseInstances();C33.clearArray(c);for(const u of h)c.push(r.GetInstanceByIID(u.GetIID()))}}}}}_TruncateContainerSols(e,t){for(const s of this.GetContainer().objectTypes()){const n=s.GetCurrentSol();e?C33.truncateArray(n._GetOwnElseInstances(),t):C33.truncateArray(n._GetOwnInstances(),t)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(e){this._anyCollisionCellChanged=!!e}_UpdateAllCollisionCells(){if(this._anyCollisionCellChanged&&this._isWorldType){for(const e of this._instances)e.GetWorldInfo()._UpdateCollisionCell();for(const t of this._runtime._GetInstancesPendingCreate())t.GetObjectClass()===this&&t.GetWorldInfo()._UpdateCollisionCell();this._anyCollisionCellChanged=!1}}_OnWorldInstanceLayerChanged(t,e,s){if(e){const n=this._worldInfosByLayer.get(e);n&&(n.delete(t),0===n.size)&&this._worldInfosByLayer.delete(e)}if(s){let e=this._worldInfosByLayer.get(s);e||(e=new Set,this._worldInfosByLayer.set(s,e)),e.add(t)}}layersHasInstancesOn(){if(this.IsFamily()){const e=new Set;for(const t of this._familyMembers)for(const s of t.layersHasInstancesOn())e.add(s);return e.values()}return this._worldInfosByLayer.keys()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.solid)}HasJumpthruBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.jumpthru)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(C33.Behaviors.Persist)}_SaveToJson(){const e={instances:this._instances.map(e=>e.SaveToJson())};return this._savedData&&this._savedData.size&&(e.ex=C33.ToSuperJSON(this._savedData)),e}_LoadFromJson(e,n){this._savedData&&(this._savedData.clear(),this._savedData=null);const t=e.ex,i=(t&&(this._savedData=C33.FromSuperJSON(t)),this._instances),r=e.instances;for(let e=0,t=Math.min(i.length,r.length);e<t;++e)i[e].LoadFromJson(r[e]);for(let e=r.length,t=i.length;e<t;++e)this._runtime.DestroyInstance(i[e]);for(let s=i.length,e=r.length;s<e;++s){let e=r[s],t=null;if(!this.IsWorldType()||(t=this._runtime.GetMainRunningLayout().GetLayerBySID(e.w.l))){const a=this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,t,!1,0,0,!0);a.LoadFromJson(e),n&&n.add(a)}}this._loadInstancesJson=r,this._SetIIDsStale()}_GetLoadInstancesJson(){return this._loadInstancesJson}_ClearLoadInstancesJson(){this._loadInstancesJson=null}_SetupSceneGraphConnectionsOnChangeOfLayout(){for(let e=0,t=this._instances;e<t;++e)this._instances[e]._SetupSceneGraphConnectionsOnChangeOfLayout()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(e){this._instanceUserScriptClass=e}DispatchUserScriptEvent(e){const t=this._runtime,s=t.IsDebug()&&!t.GetEventSheetManager().IsInEventEngine();s&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),s&&C3Debugger.AddScriptTime()}}}{const C33=self.C3;C33.Container=class extends C33.DefendedBase{constructor(e,t){super(),this._runtime=e,this._objectTypes=t;for(const s of this._objectTypes)s._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some(e=>e.IsWorldType())}}}{let C33=self.C3,C3Debugger=self.C3Debugger,IInstance=self.IInstance,originalAddonManager=C33.AddonManager,EMPTY_ARRAY=[],nextPuid=0,savedDataMaps=new WeakMap,unsavedDataMaps=new WeakMap,FLAG_DESTROYED=1,FLAG_TILEMAP=2,FLAG_MUST_PREDRAW=4,FLAG_SOLID_ENABLED=8,FLAG_JUMPTHRU_ENABLED=16,FLAG_MUST_MITIGATE_Z_FIGHTING=32,FLAG_IS_DRAWING_WITH_EFFECTS=64;C33.Instance=class extends C33.DefendedBase{constructor(e){if(C33.AddonManager!==originalAddonManager)throw new Error("invalid addon manager");super(),this._runtime=e.runtime,this._objectType=e.objectType,this._worldInfo=null,this._sdkInst=null,this._iScriptInterface=null,this._iid=0,this._uid=e.uid,this._puid=nextPuid++,this._flags=0,this._tagsSet=null;const t=C33.splitStringAndNormalize(e.tags),s=(0<t.length&&(this._tagsSet=new Set(t)),this._instVarValues=EMPTY_ARRAY,this._behaviorInstances=EMPTY_ARRAY,this._objectType.GetBehaviorTypesIncludingInherited()),n=(0<s.length&&(this._behaviorInstances=s.map((e,t)=>C33.New(C33.BehaviorInstance,{runtime:this._runtime,behaviorType:e,instance:this,index:t}))),this._siblings=this._objectType.IsInContainer()?[]:null,this._timeScale=-1,this._dispatcher=null,this.GetPlugin());if(n.MustPreDraw()&&(this._flags|=FLAG_MUST_PREDRAW),n.IsWorldType())if(this._worldInfo=C33.New(C33.WorldInfo,this,e.layer),e.worldData)this._worldInfo.Init(e.worldData);else{this._worldInfo.InitNoData();const[i,r]=this._objectType.GetDefaultInstanceSize();this._worldInfo.SetSize(i,r),this.GetObjectClass().UsesEffects()&&this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters()}e.instVarData?this._LoadInstanceVariableData(e.instVarData):this._LoadDefaultInstanceVariables()}Release(){if(this._iScriptInterface&&(this._iScriptInterface._release(),this._iScriptInterface=null),0<this._behaviorInstances.length){for(const s of this._behaviorInstances)s.Release();C33.clearArray(this._behaviorInstances)}this._sdkInst&&(this._sdkInst.Release(),this._sdkInst=null);const e=savedDataMaps.get(this),t=(e&&(e.clear(),savedDataMaps.delete(this)),unsavedDataMaps.get(this));t&&(t.clear(),unsavedDataMaps.delete(this)),this._siblings&&C33.clearArray(this._siblings),this._dispatcher&&(this._dispatcher.Release(),this._dispatcher=null),this._tagsSet&&this._tagsSet.clear(),this._tagsSet=null,this._runtime=null,this._objectType=null,0<this._instVarValues.length&&C33.clearArray(this._instVarValues),this._worldInfo&&(this._worldInfo.Release(),this._worldInfo=null)}_LoadInstanceVariableData(e){0<e.length&&(this._instVarValues=[],C33.shallowAssignArray(this._instVarValues,e))}_LoadDefaultInstanceVariables(){const t=this._objectType.GetInstanceVariablesCount();if(0!==t){this._instVarValues=[];const s=[0,0,""];for(let e=0;e<t;++e)this._instVarValues.push(s[this._objectType.GetInstanceVariableType(e)])}}_CreateSdkInstance(e,s){if(this._sdkInst)throw new Error("already got sdk instance");for(let e=0,t=this._behaviorInstances.length;e<t;++e){const n=this._behaviorInstances[e];n._CreateSdkInstance(s?s[e]:null)}const t=this.GetPlugin().GetSdkVersion();if(t<2){if(this._sdkInst=C33.New(this._objectType.GetInstanceSdkCtor(),this,e),!(this._sdkInst instanceof C33.SDKInstanceBase))throw new Error("sdk type must derive from SDKInstanceBase");!this.GetPlugin().IsWorldType()&&this._objectType._GetUserScriptInstanceClass()&&this.GetInterfaceClass()}else{const i=this.GetPlugin().GetScriptInterfaceClass();this._InitUserScriptInterface(i.Instance,e)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){const e=this._timeScale;return-1===e?this.GetRuntime().GetTimeScale():e}SetTimeScale(e){((e=+e)<0||!isFinite(e))&&(e=0),this._timeScale=e,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!0)}RestoreTimeScale(){this._timeScale=-1,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!1)}GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this)}Dispatcher(){return this._dispatcher||(this._dispatcher=C33.New(C33.Event.Dispatcher)),this._dispatcher}Draw(e){this._sdkInst?this._sdkInst.Draw(e):this._iScriptInterface._draw(this._runtime.GetCanvasManager().GetIRenderer())}OnCreate(e){this._sdkInst.OnCreate(e)}_SetHasTilemap(){this._flags|=FLAG_TILEMAP}HasTilemap(){return 0!=(this._flags&FLAG_TILEMAP)}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}IsDestroyed(){return 0!=(this._flags&FLAG_DESTROYED)}MustPreDraw(){return 0!=(this._flags&FLAG_MUST_PREDRAW)||this._sdkInst.MustPreDraw()}SetMustMitigateZFighting(){this._flags|=FLAG_MUST_MITIGATE_Z_FIGHTING}MustMitigateZFighting(){return 0!=(this._flags&FLAG_MUST_MITIGATE_Z_FIGHTING)}_IsSolidEnabled(){return 0!=(this._flags&FLAG_SOLID_ENABLED)}_SetSolidEnabled(e){e?this._flags|=FLAG_SOLID_ENABLED:this._flags&=~FLAG_SOLID_ENABLED}_IsJumpthruEnabled(){return 0!=(this._flags&FLAG_JUMPTHRU_ENABLED)}_SetJumpthruEnabled(e){e?this._flags|=FLAG_JUMPTHRU_ENABLED:this._flags&=~FLAG_JUMPTHRU_ENABLED}_IsDrawingWithEffects(){return 0!=(this._flags&FLAG_IS_DRAWING_WITH_EFFECTS)}_SetIsDrawingWithEffects(e){e?this._flags|=FLAG_IS_DRAWING_WITH_EFFECTS:this._flags&=~FLAG_IS_DRAWING_WITH_EFFECTS}SetFlag(e,t){e<<=16,t?this._flags|=e:this._flags&=~e}GetFlag(e){return 0!=(this._flags&e<<16)}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(e){return this._sdkInst.GetImagePoint(e)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(e){return e.IsFamily()?e.FamilyHasMember(this.GetObjectClass()):this.GetObjectClass()===e}CollectInstancesToPick(i,e,t){const s=(e,t)=>{const s=t||e.GetObjectClass(),n=i.get(s);n?n.add(e):i.set(s,new Set([e]))};if(s(this,e),this.IsInContainer())for(const n of this.siblings())s(n);if(t)for(const r of this.allChildren())s(r)}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw new Error("object does not support scene graph")}HasParent(){return null!==this.GetParent()}GetParent(){const e=this.GetWorldInfo();if(!e)return null;const t=e.GetParent();return t?t.GetInstance():null}GetTopParent(){const e=this.GetWorldInfo();if(!e)return null;const t=e.GetTopParent();return t?t.GetInstance():null}*parents(){const e=this.GetWorldInfo();if(e)for(const t of e.parents())yield t.GetInstance()}HasChild(e){if(e)for(const t of this.children())if(t===e)return!0;return!1}HasChildren(){const e=this.GetWorldInfo();return!!e&&e.HasChildren()}GetChildrenOfObjectClass(e){const t=this.GetWorldInfo();if(!t)return[];const s=e.GetName();return t.GetChildren().map(e=>e.GetInstance()).filter(e=>e.GetObjectClass().GetName()===s)}GetChildren(){const e=this.GetWorldInfo();return e?e.GetChildren().map(e=>e.GetInstance()):[]}*children(){const e=this.GetWorldInfo();if(e)for(const t of e.children())yield t.GetInstance()}*allChildren(){const e=this.GetWorldInfo();if(e)for(const t of e.allChildren())yield t.GetInstance()}GetChildCount(){const e=this.GetWorldInfo();return e?e.GetChildCount():0}GetParentCount(){return[...this.parents()].length}GetAllChildCount(){const e=this.GetWorldInfo();return e?e.GetAllChildCount():0}GetChildAt(e){const t=this.GetWorldInfo();if(!t)return null;const s=t.GetChildAt(e);return s?s.GetInstance():null}GetIndexInParent(){const e=this.GetWorldInfo();if(!e)return NaN;const t=e.GetParent();return t?t.GetChildIndex(e):NaN}HasChildWithUID(e){for(const t of this.GetWorldInfo().GetChildren())if(t.GetInstance().GetUID()===e)return!0;return!1}AddChild(e,t){this.VerifySupportsSceneGraph(),e.VerifySupportsSceneGraph(),this.GetWorldInfo().AddChild(e.GetWorldInfo(),t||{})}RemoveChild(e){const t=this.GetWorldInfo();t&&t.RemoveChild(e.GetWorldInfo())}GetDestroyWithParent(){const e=this.GetWorldInfo();return!!e&&e.GetDestroyWithParent()}SetupInitialSceneGraphConnections(){const e=this.GetWorldInfo();if(e){const t=e.GetSceneGraphChildrenExportData();if(t)for(const s of t){const n=this._runtime.GetInstanceByUID(s[2]);if(n){const i=s[3];this.AddChild(n,{transformX:!!(i>>0&1),transformY:!!(i>>1&1),transformWidth:!!(i>>2&1),transformHeight:!!(i>>3&1),transformAngle:!!(i>>4&1),destroyWithParent:!!(i>>5&1),transformZElevation:!!(i>>6&1),transformOpacity:!!(i>>7&1),transformVisibility:!!(i>>8&1)})}}}}SetupPersistedSceneGraphConnections(e,t){const s=e.get(this);if(s)for(const n of s.sceneGraphJson.children){const i=t.get(n.index);if(i){const r=n.flags;this.AddChild(i,{transformX:!!(r>>0&1),transformY:!!(r>>1&1),transformWidth:!!(r>>2&1),transformHeight:!!(r>>3&1),transformAngle:!!(r>>4&1),destroyWithParent:!!(r>>5&1),transformZElevation:!!(r>>6&1),transformOpacity:!!(r>>7&1),transformVisibility:!!(r>>8&1)})}}}GetTemplateName(){const e=this._runtime.GetTemplateManager();return e?e.GetInstanceTemplateName(this):""}IsInContainer(){return null!==this._siblings}_AddSibling(e){this._siblings.push(e)}GetSiblings(){return this._siblings}HasSibling(e){return!!this.GetSibling(e)}GetSibling(e){const t=this.siblings();if(null===t||0===t.length)return!1;for(const s of t)if(s.GetObjectClass()===e)return s;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol().SetSinglePicked(e)}_PushSiblingsToSolInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushInstance(e)}_SetSiblingsToSolInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnInstances()[e]=t}_PushSiblingsToSolElseInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushElseInstance(e)}_SetSiblingsToSolElseInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[e]=t}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(e){this._iid=e}GetIID(){return this._objectType._UpdateIIDs(),this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}_SetTagsSetFromJson(e){e?this.SetTagsSet(new Set(e)):this._tagsSet=null}SetTagsSet(e){if(0===e.size)this._tagsSet=null;else{this._tagsSet?this._tagsSet.clear():this._tagsSet=new Set;for(const t of e)this._tagsSet.add(t)}}GetTagsSet(){return this._tagsSet??new Set}GetTagsString(){return Array.from(this.GetTagsSet()).join(" ")}GetTagAt(e){e=Math.floor(e);for(const t of this.GetTagsSet()){if(0===e)return t;--e}return""}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(e){if(e)for(const t of this._behaviorInstances)if(t.GetBehavior()instanceof e)return t;return null}GetBehaviorSdkInstanceFromCtor(e){if(!e)return null;const t=this.GetBehaviorInstanceFromCtor(e);return t?t.GetSdkInstance():null}GetBehaviorIndexBySID(s){const n=this._behaviorInstances;for(let e=0,t=n.length;e<t;++e)if(n[e].GetBehaviorType().GetSID()===s)return e;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(e){const t=this._instVarValues;if((e|=0)<0||e>=t.length)throw new RangeError("invalid instance variable");return t[e]}_GetInstanceVariableValueUnchecked(e){return this._instVarValues[e]}_GetInstanceVariableTypedValue(e){const t=this._instVarValues[e];return 0===this._objectType.GetInstanceVariableType(e)?!!t:t}SetInstanceVariableValue(e,t){const s=this._instVarValues;if((e|=0)<0||e>=s.length)throw new RangeError("invalid instance variable");const n=this._objectType.GetInstanceVariableType(e);switch(n){case 0:s[e]=t?1:0;break;case 1:s[e]="number"==typeof t?t:parseFloat(t);break;case 2:s[e]="string"==typeof t?t:t.toString();break;default:throw new Error("unknown instance variable type")}}SetInstanceVariableOffset(e,t){if(0!==t){const s=this._instVarValues;if((e|=0)<0||e>=s.length)throw new RangeError("invalid instance variable");const n=s[e];if("number"!=typeof n)throw"boolean"==typeof n?new Error("can not set offset of boolean variable"):"string"==typeof n?new Error("can not set offset of string variable"):new Error("unknown instance variable type");s[e]+="number"==typeof t?t:parseFloat(t)}}GetSavedDataMap(){let e=savedDataMaps.get(this);return e||(e=new Map,savedDataMaps.set(this,e)),e}GetUnsavedDataMap(){let e=unsavedDataMaps.get(this);return e||(e=new Map,unsavedDataMaps.set(this,e)),e}_HasAnyCreateDestroyHandler(e){const t=this.GetObjectClass();if(t.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;for(const s of t.GetFamilies())if(s.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;return!!this._runtime.UserScriptDispatcher().HasAnyHandlerFor(e)}_TriggerOnCreatedOnSelfAndRelated(){const e=new Set,t=(e.add(this),this.GetWorldInfo());if(t&&t.HasChildren())for(const s of this.allChildren())if(e.add(s),s.IsInContainer())for(const n of s.siblings())e.add(n);if(this.IsInContainer())for(const i of this.siblings())e.add(i);for(const r of e.values())r._TriggerOnCreated()}_OnCreatedCommon(){this._objectType._GetUserScriptInstanceClass()&&this.GetInterfaceClass();for(const e of this._behaviorInstances)e.PostCreate()}_OnCreatedForLoadingSavegame(){this._OnCreatedCommon()}_TriggerOnCreated(){if(this._OnCreatedCommon(),this._HasAnyCreateDestroyHandler("instancecreate")){const e=this.GetObjectClass(),t=new C33.Event("instancecreate");t.instance=this.GetInterfaceClass(),e.DispatchUserScriptEvent(t);for(const s of e.GetFamilies())s.DispatchUserScriptEvent(t);this._runtime.DispatchUserScriptEvent(t)}this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().GetConstructor().Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(e){if(this._iScriptInterface){const t=new C33.Event("destroy");t.isEndingLayout=e,this.DispatchUserScriptEvent(t)}if(this._HasAnyCreateDestroyHandler("instancedestroy")){const s=this.GetObjectClass(),n=new C33.Event("instancedestroy");n.instance=this.GetInterfaceClass(),n.isEndingLayout=e,s.DispatchUserScriptEvent(n);for(const i of s.GetFamilies())i.DispatchUserScriptEvent(n);this._runtime.DispatchUserScriptEvent(n)}}_GetDebuggerProperties(){return this._sdkInst?this._sdkInst.GetDebuggerProperties():this._iScriptInterface._getDebuggerProperties()}SaveToJson(e="full",t=null){const s={},n=("full"===e?s.uid=this.GetUID():s.c3=!0,this.GetTagsSet());if(0<n.size&&(s.tags=Array.from(n)),"visual-state"!==e){const r=savedDataMaps.get(this);if(r&&r.size&&(s.ex=C33.ToSuperJSON(r)),-1!==this.GetTimeScale()&&(s.mts=this.GetTimeScale()),0<this._objectType.GetInstanceVariablesCount()){const a={},o=this._objectType.GetInstanceVariableSIDs();for(let e=0,t=this._instVarValues.length;e<t;++e)a[o[e].toString()]=this._instVarValues[e];s.ivs=a}if(this._behaviorInstances.length){const l={};for(const h of this._behaviorInstances){const c=h.SaveToJson(e);c&&(l[h.GetBehaviorType().GetSID().toString()]=c)}s.behs=l}}this._worldInfo&&(s.w=this._worldInfo._SaveToJson(e,t));const i=this._sdkInst?this._sdkInst.SaveToJson():this._iScriptInterface._saveToJson();return i&&(s.data=i),s}_OnBeforeLoad(e="full",t){this._worldInfo&&this._worldInfo._OnBeforeLoad(e)}_OnAfterLoad(e,t="full",s=null){this._worldInfo&&this._worldInfo._OnAfterLoad(e,t,s)}_OnAfterLoad2(e,t="full",s=null){this._worldInfo&&this._worldInfo._OnAfterLoad2(e,t,s)}_SetupSceneGraphConnectionsOnChangeOfLayout(){this.GetPlugin().IsWorldType()&&this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout()}LoadFromJson(t,e="full",s){if("full"===e)this._uid=t.uid;else if(!t.c3)return;if(this._SetTagsSetFromJson(t.tags),"visual-state"!==e){let e=savedDataMaps.get(this);e&&(e.clear(),savedDataMaps.delete(this));const i=t.ex,r=(i&&(e=C33.FromSuperJSON(i),savedDataMaps.set(this,e)),this._timeScale=t.hasOwnProperty("mts")?t.mts:-1,t.ivs);if(r)for(const[a,o]of Object.entries(r)){const l=parseInt(a,10),h=this._objectType.GetInstanceVariableIndexBySID(l);if(!(h<0||h>=this._instVarValues.length)){let e=o;null===e&&(e=NaN),this._instVarValues[h]=e}}}if(this.GetPlugin().IsWorldType()){const c=t.w;if(c){const u=c.l;if(this._worldInfo.GetLayer().GetSID()!==u){const d=this._worldInfo.GetLayer(),_=d.GetLayout().GetLayerBySID(u);_?(this._worldInfo._SetLayer(_),d._RemoveInstance(this,!0),_._AddInstance(this,!0),_.SetZIndicesChanged(this),this._worldInfo.SetBboxChanged()):"full"===e&&this._runtime.DestroyInstance(this)}this._worldInfo._LoadFromJson(c,e)}}if("visual-state"!==e){const p=t.behs;if(p)for(const[m,g]of Object.entries(p)){const f=parseInt(m,10),S=this.GetBehaviorIndexBySID(f);S<0||S>=this._behaviorInstances.length||this._behaviorInstances[S].LoadFromJson(g,e)}}const n=t.data;n&&(this._sdkInst?this._sdkInst.LoadFromJson(n,e):this._iScriptInterface._loadFromJson(n))}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}_InitUserScriptInterface(e,t){const s=this._worldInfo?e?self.ISDKWorldInstanceBase:self.IWorldInstance:e?self.ISDKInstanceBase:self.IInstance,n=e||this._sdkInst.GetScriptInterfaceClass(),i=this._objectType._GetUserScriptInstanceClass(),r=i||n||s,a=this.GetPlugin().GetSdkVersion();if(C33.AddonManager._PushInitObject(this,a),C33.AddonManager._PushInitProperties(t),this._iScriptInterface=new r,C33.AddonManager._PopInitProperties(),C33.AddonManager._PopInitObject(a),n&&!(this._iScriptInterface instanceof s))throw new TypeError(`script interface class '${n.name}' does not extend the right base class '${s.name}'`);if(i){const o=n||s;if(!(this._iScriptInterface instanceof o))throw new TypeError(`setInstanceClass(): class '${i.name}' does not extend the right base class - check it extends the right class, e.g. globalThis.InstanceType.MyObjectName`)}return this._iScriptInterface}_GetInstVarsScriptDescriptor(e){if(0!==this._instVarValues.length){const s={},n=this._objectType._GetAllInstanceVariableJsPropNames();for(let e=0,t=n.length;e<t;++e)s[n[e]]={configurable:!1,enumerable:!0,get:C33.Instance.prototype._GetInstanceVariableTypedValue.bind(this,e),set:C33.Instance.prototype.SetInstanceVariableValue.bind(this,e)};const t=Object.create(Object.prototype,s);e.instVars={value:t,writable:!1}}}_GetBehaviorsScriptDescriptor(e){const t=this._behaviorInstances;if(0!==t.length){const s={};for(const i of t)s[i.GetBehaviorType().GetJsPropName()]={value:i.GetScriptInterface(),writable:!1};const n=Object.create(Object.prototype,s);e.behaviors={value:n,writable:!1}}}DispatchUserScriptEvent(e){if(this.HasScriptInterface()){const t=this.GetInterfaceClass(),s=(e.instance=t,this._runtime),n=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine();n&&C3Debugger.StartMeasuringScriptTime(),t.dispatchEvent(e),n&&C3Debugger.AddScriptTime()}}}}{const C33=self.C3;C33.SceneGraphInfo=class extends C33.DefendedBase{constructor(n){super(),this._owner=n,this._parent=null,this._children=[],this._startWidth=n.GetWidth(),this._startHeight=n.GetHeight(),this._startScaleX=1,this._startScaleY=1,this._parentStartAngle=0,this._ownOpacity=1,this._startOpacity=n.GetOpacity(),this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._indexInParent=NaN,this._originalSizeKnown=!1,this._originalWidth=NaN,this._originalHeight=NaN,this._on_instance_create=e=>{if(e.instance===this._parent.GetInstance()){const t=n.GetRuntime(),s=(t.Dispatcher().removeEventListener("instancecreate",this._on_instance_create),this._parent.GetInstance().GetSdkInstance());this._originalSizeKnown=!!s.IsOriginalSizeKnown(),this._originalWidth=this._originalSizeKnown?s.GetOriginalWidth():NaN,this._originalHeight=this._originalSizeKnown?s.GetOriginalHeight():NaN}}}Release(){this._parent=null,this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._indexInParent=NaN,this._originalSizeKnown=!1,this._originalWidth=NaN,this._originalHeight=NaN,C33.clearArray(this._children)}SetParent(e){if(this._ownOpacity=this._owner.GetOpacity(),this._startOpacity=this._ownOpacity,this._parent=e,this._parentStartAngle=e?e.GetAngle():0,this._parent){const t=this._owner,s=t.GetRuntime(),n=this._parent.GetInstance().GetPlugin().GetSdkVersion();if(n<2){const i=this._parent.GetInstance().GetSdkInstance();i?(this._originalSizeKnown=!!i.IsOriginalSizeKnown(),this._originalWidth=this._originalSizeKnown?i.GetOriginalWidth():NaN,this._originalHeight=this._originalSizeKnown?i.GetOriginalHeight():NaN):this._parent.GetInstance().IsDestroyed()||s.Dispatcher().addEventListener("instancecreate",this._on_instance_create)}else this._originalSizeKnown=!1,this._originalWidth=NaN,this._originalHeight=NaN}else this._originalSizeKnown=!1,this._originalWidth=NaN,this._originalHeight=NaN}GetParent(){return this._parent}HasChildren(){return 0<this._children.length}GetChildren(){return this._children}_MaybeSortChildren(){this.HasChildren()&&1!==this._children.length&&(this._tmpSceneGraphChildrenIndexes?this._children.sort((e,t)=>{const s=this._tmpSceneGraphChildrenIndexes.get(e.GetInstance()),n=this._tmpSceneGraphChildrenIndexes.get(t.GetInstance());return C33.IsFiniteNumber(s)&&C33.IsFiniteNumber(n)?s-n:0}):this._children.sort((e,t)=>{const s=e._GetSceneGraphInfo()._GetIndexInParent(),n=t._GetSceneGraphInfo()._GetIndexInParent();return C33.IsFiniteNumber(s)&&C33.IsFiniteNumber(n)?s-n:0}))}_GetIndexInParent(){return this._indexInParent}GetStartScaleX(){return this._startScaleX}SetStartScaleX(e){this._startScaleX=e}GetStartScaleY(){return this._startScaleY}SetStartScaleY(e){this._startScaleY=e}GetStartOpacity(){return this._startOpacity}GetOwnOpacity(){return this._ownOpacity}SetOwnOpacity(e){this._ownOpacity=e}_GetStartWidth(){return 0===this._startWidth?Number.EPSILON:this._startWidth}_GetStartHeight(){return 0===this._startHeight?Number.EPSILON:this._startHeight}GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){let e=this._parent,t=e.GetWidth(),s=e._GetSceneGraphInfo()._GetStartWidth();return 0===t&&(t=Number.EPSILON),s===Number.EPSILON&&t===Number.EPSILON?1:s===Number.EPSILON&&t!==Number.EPSILON&&this._originalSizeKnown?1+t/this._originalWidth:t/s}return 1}GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){let e=this._parent,t=e.GetHeight(),s=e._GetSceneGraphInfo()._GetStartHeight();return 0===t&&(t=Number.EPSILON),s===Number.EPSILON&&t===Number.EPSILON?1:s===Number.EPSILON&&t!==Number.EPSILON&&this._originalSizeKnown?1+t/this._originalHeight:t/s}return 1}GetParentStartAngle(){return 0}_SaveToJsonProperties(){return{sw:this._startWidth,sh:this._startHeight,sx:this._startScaleX,sy:this._startScaleY,psa:this._parentStartAngle,oo:this._ownOpacity,so:this._startOpacity,pi:this._owner.GetInstance().GetIndexInParent()}}_SaveToJson(e,t=null){const s=this._SaveToJsonProperties();return t&&t.selfOnly?Object.assign(s,{p:null,c:[]}):Object.assign(s,{p:this._GetParentJson(e),c:this._GetChildrenJson(e)})}_GetFlagsString(e){let t="";return e.GetTransformWithParentX()&&(t+="x"),e.GetTransformWithParentY()&&(t+="y"),e.GetTransformWithParentWidth()&&(t+="w"),e.GetTransformWithParentHeight()&&(t+="h"),e.GetTransformWithParentAngle()&&(t+="a"),e.GetTransformWithParentZElevation()&&(t+="z"),e.GetDestroyWithParent()&&(t+="d"),e.GetTransformWithParentOpacity()&&(t+="o"),e.GetTransformWithParentVisibility()&&(t+="v"),t}_GetParentJson(e){return this._parent&&this._parent.GetInstance()&&!this._parent.GetInstance().IsDestroyed()?this._GetInstanceJson(this._parent,this._owner,e):null}_GetChildrenJson(t){return this._children.map(e=>this._GetInstanceJson(e,e,t)).filter(e=>e)}_GetInstanceJson(e,t,s){const n=e.GetInstance();if(n&&n.IsDestroyed())return null;const i={};return i.uid=n.GetUID(),i.f=this._GetFlagsString(t),i.offsets=t._SaveSceneGraphPropertiesToJson(),i.data=C33.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(n),i.oci=n.GetObjectClass().GetIndex(),"state"===s?(i.inst=n.SaveToJson("full",{selfOnly:!0}),i.instIndex=NaN):(i.instIndex=n.GetObjectClass().GetInstances().indexOf(n),i.inst=null),i}_LoadFromJson(e){this._startWidth=e.sw,this._startHeight=e.sh,this._startScaleX=e.sx,this._startScaleY=e.sy,this._parentStartAngle=e.psa,this._ownOpacity=e.oo,this._startOpacity=e.so,this._indexInParent=C33.IsFiniteNumber(e.pi)?e.pi:NaN}_SetTmpSceneGraphChildren(e,t){if(!e&&!t&&this._tmpSceneGraphChildren)for(const s of this._tmpSceneGraphChildren)s.IsDestroyed()||s.HasParent()||s.GetRuntime().DestroyInstance(s);this._tmpSceneGraphChildren=e,this._tmpSceneGraphChildrenIndexes=t}_OnAfterLoad(e,t){const s=this._owner,n=s.GetRuntime(),i=new Set;if(e.p&&!this._parent){const o=e.p.uid,l=n.GetInstanceByUID(o);if(t?.setFromJson,l){const h=l.GetWorldInfo();if(l.HasChild(s.GetInstance()))this._parent=h;else{l.HasChildWithUID(s.GetInstance().GetUID())?n.DestroyInstance(s.GetInstance()):l.AddChild(s.GetInstance(),this._GetFlagsObj(e.p.f)),i.has(s)||(s._LoadSceneGraphPropertiesFromJson(e.p.offsets),this._LoadInstancePropertiesFromJson(l,e.p,t)),i.add(s);const c=l.GetWorldInfo();c._GetSceneGraphInfo()._MaybeSortChildren()}}else if(C33.IsFiniteNumber(e.p.oci)){const u=n.GetObjectClassByIndex(e.p.oci),d=(n.GetSystemPlugin(),n.CreateInstance(u,s.GetLayer(),0,0,!0));if(t?.setFromJson,d){const _=this._GetInstanceData(e.p,n),p=(_&&d.LoadFromJson(_),d.GetWorldInfo()),m=(p.GetLayer().SortAndAddInstancesByZIndex(d),d.AddChild(s.GetInstance(),this._GetFlagsObj(e.p.f)),d.GetWorldInfo());m._GetSceneGraphInfo()._MaybeSortChildren()}}}const r=[];for(const g of e.c){const f=g.uid,S=n.GetInstanceByUID(f);S&&r.push(S)}let a=0;for(const y of e.c){const C=y.uid,G=n.GetInstanceByUID(C);if(t?.setFromJson,G){if(this._tmpSceneGraphChildren){if(this._tmpSceneGraphChildren.includes(G)){const A=G;if(A.GetObjectClass()!==G.GetObjectClass()){a++;continue}if(A.IsDestroyed()){a++;continue}const P=e.c[a];if(!t?.setFromJson&&this._HasAllChildrenOfType(A,r,s)){this._UpdateInstance(a,P,s,i,t),a++;continue}if(A.HasParent()&&A.GetParent()!==s.GetInstance()){const E=this._CreateNewChildInstance(P,t);this._AddAndSetChildInstance(E,P,i,t),a++;continue}this._AddAndSetChildInstance(A.GetWorldInfo(),P,i,t,!0),a++;continue}if(this._tmpSceneGraphChildren[a]){const v=this._tmpSceneGraphChildren[a];if(v.GetObjectClass()!==G.GetObjectClass()){a++;continue}if(v.IsDestroyed()){a++;continue}const R=e.c[a];if(!t?.setFromJson&&this._HasAllChildrenOfType(v,r,s)){this._UpdateInstance(a,R,s,i,t),a++;continue}if(v.HasParent()&&v.GetParent()!==s.GetInstance()){const x=this._CreateNewChildInstance(R,t);this._AddAndSetChildInstance(x,R,i,t),a++;continue}this._AddAndSetChildInstance(v.GetWorldInfo(),R,i,t,!0),a++;continue}}const T=G.GetObjectClass(),I=this._GetInstancesOfObjectClassCount(r,T),b=s.GetInstance().GetChildrenOfObjectClass(T).length;if(I===b){const w=s.GetInstance().GetChildAt(a);if(w){const D=w.GetWorldInfo();D&&(i.has(D)||(D._LoadSceneGraphPropertiesFromJson(y.offsets),this._LoadInstancePropertiesFromJson(w,y,t)),i.add(D))}a++;continue}if(G.HasParent()&&G.GetParent()!==s.GetInstance()){const M=this._CreateNewChildInstance(y,t);this._AddAndSetChildInstance(M,y,i,t),a++;continue}this._AddAndSetChildInstance(G.GetWorldInfo(),y,i,t)}else if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[a]){const O=this._tmpSceneGraphChildren[a],L=n.GetObjectClassByIndex(this._GetObjectClassIndex(y));if(O.GetObjectClass()!==L){a++;continue}if(O.IsDestroyed()){a++;continue}const F=e.c[a];if(!t?.setFromJson&&this._HasAllChildrenOfType(O,r,s)){this._UpdateInstance(a,F,s,i,t),a++;continue}if(O.HasParent()&&O.GetParent()!==s.GetInstance()){const k=this._CreateNewChildInstance(F,t);this._AddAndSetChildInstance(k,F,i,t),a++;continue}this._AddAndSetChildInstance(O.GetWorldInfo(),F,i,t)}else{const B=this._CreateNewChildInstance(y,t);this._AddAndSetChildInstance(B,y,i,t)}a++}}_HasAllChildrenOfType(e,t,s){const n=e.GetObjectClass(),i=this._GetInstancesOfObjectClassCount(t,n),r=s.GetInstance().GetChildrenOfObjectClass(n).length;return i===r}_UpdateInstance(e,t,s,n,i){const r=s.GetInstance().GetChildAt(e,t);if(r){const a=r.GetWorldInfo();a&&(n.has(a)||(a._LoadSceneGraphPropertiesFromJson(t.offsets),this._LoadInstancePropertiesFromJson(r,t,i)),n.add(a))}}_GetFlagsObj(e){const t={};return t.transformX=e.includes("x"),t.transformY=e.includes("y"),t.transformWidth=e.includes("w"),t.transformHeight=e.includes("h"),t.transformAngle=e.includes("a"),t.transformZElevation=e.includes("z"),t.destroyWithParent=e.includes("d"),t.transformOpacity=e.includes("o"),t.transformVisibility=e.includes("v"),t}_GetObjectClassIndex(e){return C33.IsFiniteNumber(e.oci)?e.oci:e[1]}_CreateNewChildInstance(n,i){if(C33.IsFiniteNumber(n.oci)){let e=this._owner,t=e.GetRuntime(),s;if(n.data)s=t.CreateInstanceFromData(n.data,e.GetLayer(),!1,0,0,!1,!0);else{const r=t.GetObjectClassByIndex(n.oci);s=t.CreateInstance(r,e.GetLayer(),0,0,!0)}if(i?.setFromJson,s){const a=this._GetInstanceData(n,t),o=(a&&s.LoadFromJson(a),s.GetWorldInfo());return o.GetLayer().SortAndAddInstancesByZIndex(s,!0),o}}}_AddAndSetChildInstance(e,t,s,n,i=!0){const r=this._owner,a=r.AddChild(e,this._GetFlagsObj(t.f));a&&i&&(s.has(e)||(e._LoadSceneGraphPropertiesFromJson(t.offsets),this._LoadInstancePropertiesFromJson(e.GetInstance(),t,n)),s.add(e)),this._MaybeSortChildren()}_LoadInstancePropertiesFromJson(e,t,s){let n=this._GetInstanceData(t,this._owner.GetRuntime());n&&((n=JSON.parse(JSON.stringify(n))).w=null,e.LoadFromJson(n))}_GetInstancesOfObjectClassCount(e,t){return e.filter(e=>e.GetObjectClass().GetName()===t.GetName()).length}_GetInstanceData(e,t){if(C33.IsFiniteNumber(e.instIndex)){const s=t.GetObjectClassByIndex(e.oci),n=s._GetLoadInstancesJson();return n?n[e.instIndex]:null}return C33.IsString(e.inst)?JSON.parse(e.inst):e.inst||void 0}static GetSceneGraphInstanceDataFromInstance(e){let t=e.GetWorldInfo().GetLayer().GetInitialInstanceData(e.GetUID());if(!t)return null;t=JSON.parse(JSON.stringify(t));const s=[];for(const n of[...e.GetChildren()]){const i=n.GetWorldInfo();s.push([i.GetLayout().GetSID(),i.GetLayer().GetIndex(),n.GetUID(),C33.SceneGraphInfo._GetFlagsNumber(i),n.GetObjectClass().IsInContainer()?1:0,i.GetZIndex(),C33.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(n)])}return C33.IsArray(t[0][14])?t[0][14][1]=s:(t[0][14]=[],t[0][14][0]=C33.SceneGraphInfo._GetDefaultFlagsNumber(),t[0][14][1]=s,t[0][14][2]=e.GetWorldInfo().GetZIndex()),t}static _GetFlagsNumber(e){let t=0;return(t|=Number(e.GetTransformWithParentVisibility())<<8)|Number(e.GetTransformWithParentOpacity())<<7|Number(e.GetTransformWithParentZElevation())<<6|Number(e.GetDestroyWithParent())<<5|Number(e.GetTransformWithParentAngle())<<4|Number(e.GetTransformWithParentHeight())<<3|Number(e.GetTransformWithParentWidth())<<2|Number(e.GetTransformWithParentY())<<1|Number(e.GetTransformWithParentX())<<0}static _GetDefaultFlagsNumber(e){let t=0;return t,511}}}{let C33=self.C3,glMatrix=self.glMatrix,vec32=glMatrix.vec3,vec42=glMatrix.vec4,tempRect=C33.New(C33.Rect),tempQuad=C33.New(C33.Quad),bboxChangeEvent=C33.New(C33.Event,"bboxchange",!1),tempColor=C33.New(C33.Color,0,0,0,0),tempCollisionPoly=C33.New(C33.CollisionPoly),DEFAULT_COLOR=C33.New(C33.Color,1,1,1,1),DEFAULT_RENDER_CELLS=C33.New(C33.Rect,0,0,-1,-1),DEFAULT_COLLISION_CELLS=C33.New(C33.Rect,0,0,-1,-1),VALID_SET_MESH_POINT_MODES=new Set(["absolute","relative"]),EMPTY_ARRAY=[],enableUpdateRendererStateGroup=!0,FLAG_IS_VISIBLE=1,FLAG_BBOX_CHANGED=2,FLAG_ENABLE_BBOX_CHANGED_EVENT=4,FLAG_COLLISION_ENABLED=8,FLAG_COLLISION_CELL_CHANGED=16,FLAG_SOLID_FILTER_INCLUSIVE=32,FLAG_HAS_ANY_ACTIVE_EFFECT=64,FLAG_IS_ROTATABLE=128,FLAG_DESTROYED=256,FLAG_DESTROY_WITH_PARENT=512,FLAG_TRANSFORM_WITH_PARENT_X=1024,FLAG_TRANSFORM_WITH_PARENT_Y=2048,FLAG_TRANSFORM_WITH_PARENT_W=4096,FLAG_TRANSFORM_WITH_PARENT_H=8192,FLAG_TRANSFORM_WITH_PARENT_A=16384,FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION=32768,FLAG_TRANSFORM_WITH_PARENT_OPACITY=1<<22,FLAG_TRANSFORM_WITH_PARENT_VISIBILITY=1<<23,MASK_ALL_SCENE_GRAPH_FLAGS=FLAG_DESTROY_WITH_PARENT|FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y|FLAG_TRANSFORM_WITH_PARENT_W|FLAG_TRANSFORM_WITH_PARENT_H|FLAG_TRANSFORM_WITH_PARENT_A|FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION|FLAG_TRANSFORM_WITH_PARENT_OPACITY|FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,FLAG_MESH_CHANGED=65536,FLAG_PHYSICS_BODY_CHANGED=1<<17,FLAG_SIN_COS_ANGLE_CHANGED=1<<18,FLAG_USE_POINTS_SHADER_PROGRAM=1<<19,FLAG_DRAW_BACK_FACE_ONLY=1<<20,FLAG_DRAW_NON_BACK_FACES_ONLY=1<<21,FLAG_BLEND_MODE_BIT_OFFSET=26,FLAG_BLEND_MODE_MASK=31<<FLAG_BLEND_MODE_BIT_OFFSET,sceneGraphExportDataMap=new WeakMap,sceneGraphZIndexMap=new WeakMap;C33.WorldInfo=class extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=e.GetObjectClass(),this._runtime=e.GetRuntime(),this._layer=t,this._objectClass._OnWorldInstanceLayerChanged(this,null,t),this._zIndex=-1,this._htmlZIndex=-1,this._flags=FLAG_IS_VISIBLE|FLAG_BBOX_CHANGED|FLAG_COLLISION_ENABLED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED|FLAG_PHYSICS_BODY_CHANGED,this._objectClass.GetPlugin().IsRotatable()&&(this._flags|=FLAG_IS_ROTATABLE),this._x=NaN,this._y=NaN,this._zElevation=NaN,this._w=NaN,this._h=NaN,this._depth=NaN,this._a=NaN,this._sinA=NaN,this._cosA=NaN,this._ox=NaN,this._oy=NaN,this._boundingBox=C33.New(C33.Rect),this._boundingQuad=C33.New(C33.Quad),this._collisionCells=DEFAULT_COLLISION_CELLS,this._renderCells=DEFAULT_RENDER_CELLS,this._sourceCollisionPoly=null,this._transformedPolyInfo=null,this._solidFilterTags=null,this._color=DEFAULT_COLOR,this._colorPremultiplied=DEFAULT_COLOR,this._stateGroup=null,this._instanceEffectList=null,this._inst.GetObjectClass().UsesEffects()&&(this._instanceEffectList=C33.New(C33.InstanceEffectList,this._inst,this)),this._sceneGraphInfo=null,this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._tmpHierarchyPosition=-1,this._meshInfo=null}_MarkDestroyed(){this._flags|=FLAG_DESTROYED}Release(){if(this._objectClass._OnWorldInstanceLayerChanged(this,this._layer,null),this._stateGroup&&(this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup),this._stateGroup=null),this._sourceCollisionPoly=null,this._transformedPolyInfo&&(this._transformedPolyInfo.poly.Release(),this._transformedPolyInfo=null),this._solidFilterTags&&(this._solidFilterTags.clear(),this._solidFilterTags=null),this.ReleaseMesh(),this._instanceEffectList&&this._instanceEffectList.Release(),this.HasParent()&&this.GetParent().RemoveChild(this),this.HasChildren()){const e=[...this.GetChildren()];for(const t of e)this.RemoveChild(t)}this._ReleaseSceneGraphInfo(),this._ReleaseTmpSceneGraphInfo(),sceneGraphExportDataMap.delete(this),sceneGraphZIndexMap.delete(this),this._inst=null,this._objectClass=null,this._runtime=null,this._layer=null}Init(e){if(enableUpdateRendererStateGroup=!1,this.SetXY(e[0],e[1]),this.SetZElevation(e[2]),this.SetSize(e[3],e[4]),this._depth=0,this.IsRotatable()?this.SetAngle(e[6]):this._a=0,tempColor.setFromJSON(e[7]),this._SetColor(tempColor),this.SetOriginX(e[8]),this.SetOriginY(e[9]),this.SetBlendMode(e[10]),this._instanceEffectList&&this._instanceEffectList._LoadEffectParameters(e[12]),e[14]&&sceneGraphExportDataMap.set(this,{childrenData:e[14][1],zIndexData:e[14][2]}),e[15]){const t=e[15],n=(this.CreateMesh(t[0],t[1]),this.GetSourceMesh()),i=t[2];for(let s=0,e=i.length;s<e;++s){const r=i[s];for(let e=0,t=r.length;e<t;++e){const a=r[e],o=n.GetMeshPointAt(e,s);o.SetX(a[0]),o.SetY(a[1]),o.SetZElevation(a[2]),o.SetU(a[3]),o.SetV(a[4])}}}if(e[16]){const s=e[16][0],l=e[16][1],h=!!l,c=!h,u=this._runtime.GetTemplateManager();h&&u&&u.MapInstanceToTemplateName(this.GetInstance(),l),c&&u&&u.MapInstanceToTemplateName(this.GetInstance(),s)}enableUpdateRendererStateGroup=!0,this._UpdateRendererStateGroup()}InitNoData(){this._x=0,this._y=0,this._zElevation=0,this._w=0,this._h=0,this._depth=0,this._a=0,this._sinA=0,this._cosA=1,this._ox=0,this._oy=0,this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){return this.GetTransformWithParentAngle()?this._MaybeReflectAngleForMirrorFlip(this.GetParent()._GetAngleNoReflect()-this._sceneGraphInfo.GetParentStartAngle()):0}SetX(e){if(e=+e,this.GetTransformWithParentX()){const t=this._sceneGraphInfo,s=e-this.GetX(),n=-this._GetParentOffsetAngle();0==n?this._x+=s/t.GetParentScaleX():(this._x+=Math.cos(n)*s/t.GetParentScaleX(),this.GetTransformWithParentY()&&(this._y+=Math.sin(n)*s/t.GetParentScaleY()))}else this._x=e}OffsetX(e,t=!1){e=+e,!t&&this.GetTransformWithParentX()?this.SetX(this.GetX()+e):this._x+=e}GetX(){if(this.GetTransformWithParentX()){let e=this._x,t=this._sceneGraphInfo,s=this.GetParent(),n=this._GetParentOffsetAngle();return 0===n?e*=t.GetParentScaleX():(e=e*t.GetParentScaleX()*Math.cos(n),this.GetTransformWithParentY()&&(e-=this._y*t.GetParentScaleY()*Math.sin(n))),s.GetX()+e}return this._x}SetY(e){if(e=+e,this.GetTransformWithParentY()){const t=this._sceneGraphInfo,s=e-this.GetY(),n=-this._GetParentOffsetAngle();0==n?this._y+=s/t.GetParentScaleY():(this.GetTransformWithParentX()&&(this._x-=Math.sin(n)*s/t.GetParentScaleX()),this._y+=Math.cos(n)*s/t.GetParentScaleY())}else this._y=e}OffsetY(e,t=!1){e=+e,!t&&this.GetTransformWithParentY()?this.SetY(this.GetY()+e):this._y+=e}GetY(){if(this.GetTransformWithParentY()){let e=this._y,t=this._sceneGraphInfo,s=this.GetParent(),n=this._GetParentOffsetAngle();return 0===n?e*=t.GetParentScaleY():(e=e*t.GetParentScaleY()*Math.cos(n),this.GetTransformWithParentX()&&(e+=this._x*t.GetParentScaleX()*Math.sin(n))),s.GetY()+e}return this._y}SetXY(e,t){if(e=+e,t=+t,this.GetTransformWithParentXOrY()){const s=this.GetTransformWithParentX(),n=this.GetTransformWithParentY(),i=this._sceneGraphInfo,r=e-this.GetX(),a=t-this.GetY(),o=-this._GetParentOffsetAngle();if(0==o)s?this._x+=r/i.GetParentScaleX():this._x=e,n?this._y+=a/i.GetParentScaleY():this._y=t;else{const l=Math.sin(o),h=Math.cos(o);s?this._x+=n?(h*r-l*a)/i.GetParentScaleX():h*r/i.GetParentScaleX():this._x=e,n?this._y+=s?(l*r+h*a)/i.GetParentScaleY():h*a/i.GetParentScaleY():this._y=t}}else this._x=e,this._y=t}GetXY(){return[this.GetX(),this.GetY()]}OffsetXY(e,t){e=+e,t=+t,this.GetTransformWithParentXOrY()?this.SetXY(this.GetX()+e,this.GetY()+t):(this._x+=e,this._y+=t)}EqualsXY(e,t){return this.GetX()===e&&this.GetY()===t}SetZElevation(e){if(e=+e,this.GetTransformWithParentZElevation()&&(e-=this.GetParent().GetZElevation()),this._zElevation!==e){this._zElevation=e,this._UpdateZElevation();const t=this.GetLayer();0!==this._zElevation&&t._SetAnyInstanceZElevated(),t.SetZIndicesChanged(this)}}_UpdateZElevation(){if(this._UpdateRendererStateGroup(),this.HasChildren()){const s=this.GetChildren();for(let e=0,t=s.length;e<t;e++){const n=s[e];n.GetTransformWithParentZElevation()&&n._UpdateZElevation()}}}OffsetZElevation(e){this.SetZElevation(this.GetZElevation()+e)}GetZElevation(){return this.GetTransformWithParentZElevation()?this.GetParent().GetZElevation()+this._zElevation:this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}IsOriginalSizeKnown(){const e=this.GetInstance().GetPlugin().GetSdkVersion();return e<2&&this.GetInstance().GetSdkInstance().IsOriginalSizeKnown()}SetWidth(e){if(e=+e,this.GetTransformWithParentWidth()){const t=this.GetWidth();0===t?this._w=Number.EPSILON:this._w*=e/t}else this._w=e;this._MarkSinCosAngleChanged()}OffsetWidth(e,t){e=+e,!t&&this.GetTransformWithParentWidth()?this.SetWidth(this.GetWidth()+e):this._w+=e,this._MarkSinCosAngleChanged()}GetWidth(){if(this.GetTransformWithParentWidth()){const e=this.GetParent(),t=e.GetWidth(),s=e._GetSceneGraphInfo()._GetStartWidth();return s===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartWidth()+t)*this._w:t*this._w}return this._w}SetHeight(e){if(e=+e,this.GetTransformWithParentHeight()){const t=this.GetHeight();0===t?this._h=Number.EPSILON:this._h*=e/t}else this._h=e;this._MarkSinCosAngleChanged()}OffsetHeight(e,t){e=+e,!t&&this.GetTransformWithParentHeight()?this.SetHeight(this.GetHeight()+e):this._h+=e,this._MarkSinCosAngleChanged()}GetHeight(){if(this.GetTransformWithParentHeight()){const e=this.GetParent(),t=e.GetHeight(),s=e._GetSceneGraphInfo()._GetStartHeight();return s===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartHeight()+t)*this._h:t*this._h}return this._h}SetSize(e,t){if(e=+e,t=+t,this.GetTransformWithParentWidth()){const s=this.GetWidth();0===s?this._w=Number.EPSILON:this._w*=e/s}else this._w=e;if(this.GetTransformWithParentHeight()){const n=this.GetHeight();0===n?this._h=Number.EPSILON:this._h*=t/n}else this._h=t;this._MarkSinCosAngleChanged()}GetSize(){return[this.GetWidth(),this.GetHeight()]}GetDepth(){return this._depth}SetDepth(e){if(e<0)throw new RangeError("invalid depth");this._depth=e}GetSceneGraphScale(){if(this.HasParent()){const e=this._sceneGraphInfo;return Math.min(e.GetParentScaleX(),e.GetParentScaleY())}return 1}IsRotatable(){return 0!=(this._flags&FLAG_IS_ROTATABLE)}SetAngle(e){e=+e,this.IsRotatable()&&(this.GetTransformWithParentAngle()&&(e-=this.GetParent().GetAngle()),e=C33.clampAngle(e),this._a!==e)&&(this._a=e,this._MarkSinCosAngleChanged())}OffsetAngle(e){0!=(e=+e)&&this.IsRotatable()&&(this._a=C33.clampAngle(this._a+e),this._MarkSinCosAngleChanged())}_MarkSinCosAngleChanged(){if(this._flags|=FLAG_SIN_COS_ANGLE_CHANGED,this.HasChildren()){const s=this.GetChildren();for(let e=0,t=s.length;e<t;e++)s[e]._MarkSinCosAngleChanged()}}GetAngle(){return this.GetTransformWithParentAngle()&&this.IsRotatable()?this._MaybeReflectAngleForMirrorFlip(C33.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a)):this._a}_GetAngleNoReflect(){return this.GetTransformWithParentAngle()&&this.IsRotatable()?C33.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a):this._a}_MaybeReflectAngleForMirrorFlip(e){return this.GetTransformWithParentWidth()&&this.GetTopParent().GetWidth()<0&&(e=C33.clampAngle(C33.angleReflect(e,this.GetTopParent().GetAngle()+Math.PI))),this.GetTransformWithParentHeight()&&this.GetTopParent().GetHeight()<0?C33.angleReflect(e,this.GetTopParent().GetAngle()):e}_NeedsReflectAngleForMirrorOrFlip(){const e=this.GetParent();return!!(this.GetTransformWithParentWidth()&&e.GetWidth()<0)||!!(this.GetTransformWithParentHeight()&&e.GetHeight()<0)}_NeedsReflectAngleForMirrorAndFlip(){const e=this.GetParent();return!!(this.GetTransformWithParentWidth()&&e.GetWidth()<0&&this.GetTransformWithParentHeight()&&e.GetHeight()<0)}_MaybeUpdateSinCosAngle(){const e=this._flags;if(0!=(e&FLAG_SIN_COS_ANGLE_CHANGED)){const t=this.GetAngle();this._sinA=Math.sin(t),this._cosA=Math.cos(t),this._flags=e&~FLAG_SIN_COS_ANGLE_CHANGED}}GetSinAngle(){return this._MaybeUpdateSinCosAngle(),this._sinA}GetCosAngle(){return this._MaybeUpdateSinCosAngle(),this._cosA}SetOriginX(e){this._ox=+e}OffsetOriginX(e){this._ox+=+e}GetOriginX(){return this._ox}SetOriginY(e){this._oy=+e}OffsetOriginY(e){this._oy+=+e}GetOriginY(){return this._oy}_SetColor(e){this._color.equals(e)||(this._color===DEFAULT_COLOR?(this._color=C33.New(C33.Color,e),this._colorPremultiplied=C33.New(C33.Color,e),this._colorPremultiplied.premultiply()):e.equalsRgba(1,1,1,1)?(this._color=DEFAULT_COLOR,this._colorPremultiplied=DEFAULT_COLOR):(this._color.set(e),this._colorPremultiplied.set(e),this._colorPremultiplied.premultiply()),this._UpdateRendererStateGroup())}SetOpacity(e){if(e=C33.clamp(+e,0,1),this.GetTransformWithParentOpacity()){if(this._GetSceneGraphInfo().GetOwnOpacity()===e)return;this._GetSceneGraphInfo().SetOwnOpacity(e),e=this.GetOpacity()}else if(this._color.a===e)return;this._SetColorWithOpacity(e)}_SetOpacityOfChildren(){if(this.HasChildren()){const s=this.GetChildren();for(let e=0,t=s.length;e<t;e++){const n=s[e];n._SetColorWithOpacity(n.GetOpacity())}}}_SetColorWithOpacity(e){tempColor.copyRgb(this._color),tempColor.a=e,this._SetColor(tempColor),this._SetOpacityOfChildren()}OffsetOpacity(e){this.GetTransformWithParentOpacity()?this.SetOpacity(this._GetSceneGraphInfo().GetOwnOpacity()+e):this.SetOpacity(this.GetOpacity()+e)}GetOpacity(){return this.GetTransformWithParentOpacity()?this.GetParent().GetOpacity()*this._GetSceneGraphInfo().GetOwnOpacity():this._color.a}SetUnpremultipliedColor(e){this._color.equalsIgnoringAlpha(e)||(tempColor.copyRgb(e),tempColor.a=this.GetOpacity(),this._SetColor(tempColor))}SetUnpremultipliedColorRGB(e,t,s){tempColor.setRgb(e,t,s),this.SetUnpremultipliedColor(tempColor)}OffsetUnpremultipliedColorRGB(e,t,s){0===e&&0===t&&0===s||(tempColor.copyRgb(this._color),tempColor.r+=e,tempColor.g+=t,tempColor.b+=s,this.SetUnpremultipliedColor(tempColor))}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return 0!=(this._flags&FLAG_DESTROY_WITH_PARENT)}SetDestroyWithParent(e){this._SetFlag(FLAG_DESTROY_WITH_PARENT,e)}GetTransformWithParentX(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_X)}SetTransformWithParentX(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_X,e)}GetTransformWithParentY(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_Y)}GetTransformWithParentXOrY(){return 0!=(this._flags&(FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y))}SetTransformWithParentY(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Y,e)}GetTransformWithParentWidth(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_W)}SetTransformWithParentWidth(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_W,e)}GetTransformWithParentHeight(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_H)}SetTransformWithParentHeight(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_H,e)}GetTransformWithParentAngle(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_A)}SetTransformWithParentAngle(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_A,e)}GetTransformWithParentZElevation(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION)}SetTransformWithParentZElevation(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,e)}GetTransformWithParentOpacity(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_OPACITY)}SetTransformWithParentOpacity(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_OPACITY,e)}GetTransformWithParentVisibility(){return 0!=(this._flags&FLAG_TRANSFORM_WITH_PARENT_VISIBILITY)}SetTransformWithParentVisibility(e){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,e)}_ClearAllSceneGraphFlags(){this._flags&=~MASK_ALL_SCENE_GRAPH_FLAGS}AddChild(e,t){if(e===this)return!1;if(e.HasParent())return!1;if(this._HasChildRecursive(e))return!1;if(this._HasAnyParent(e))return!1;const s=e.GetX(),n=e.GetY(),i=e.GetWidth(),r=e.GetHeight(),a=e.GetAngle(),o=e.GetZElevation(),l=e.GetOpacity(),h=(e._SetParent(this),e.SetTransformWithParentX(t.transformX),e.SetTransformWithParentY(t.transformY),e.SetTransformWithParentWidth(t.transformWidth),e.SetTransformWithParentHeight(t.transformHeight),e.SetTransformWithParentAngle(t.transformAngle),e.SetTransformWithParentZElevation(t.transformZElevation),e.SetTransformWithParentOpacity(t.transformOpacity),e.SetTransformWithParentVisibility(t.transformVisibility),e.SetDestroyWithParent(t.destroyWithParent),s-this.GetX()),c=n-this.GetY(),u=-this.GetAngle(),d=Math.cos(u),_=Math.sin(u);if(t.transformX&&(t.transformAngle?e._x=h*d-c*_:e._x=h,t.transformWidth)){const p=this.GetWidth()/this._sceneGraphInfo._GetStartWidth();0!=p&&(e._x/=p)}if(t.transformY&&(t.transformAngle?e._y=h*_+c*d:e._y=c,t.transformHeight)){const m=this.GetHeight()/this._sceneGraphInfo._GetStartHeight();0!=m&&(e._y/=m)}if(t.transformWidth){const g=this.GetWidth();0===g||g===Number.EPSILON?(e._w=1,e._sceneGraphInfo.SetStartScaleX(1)):(e._w=i/this.GetWidth(),e._sceneGraphInfo.SetStartScaleX(e._w))}if(t.transformHeight){const f=this.GetHeight();0===f||f===Number.EPSILON?(e._h=1,e._sceneGraphInfo.SetStartScaleY(1)):(e._h=r/this.GetHeight(),e._sceneGraphInfo.SetStartScaleY(e._h))}return t.transformAngle&&(e._a=a-this.GetAngle()),t.transformZElevation&&(e._zElevation=o-this.GetZElevation()),t.transformOpacity&&e._sceneGraphInfo.SetOwnOpacity(l),t.transformVisibility&&e.SetVisible(this.IsVisible()),this._AddChildToSceneGraphInfo(e),this.SetBboxChanged(),this._SetOpacityOfChildren(),!0}RemoveChild(e){if(e.GetParent()===this){const t=e.GetX(),s=e.GetY(),n=e.GetWidth(),i=e.GetHeight(),r=e.GetAngle(),a=e.GetZElevation(),o=e.GetOpacity();e._SetParent(null),e._ClearAllSceneGraphFlags(),e.SetXY(t,s),e.SetSize(n,i),e.SetAngle(r),e.SetZElevation(a),e.SetOpacity(o),this._RemoveChildFromSceneGraphInfo(e),this.SetBboxChanged()}}GetTmpHierarchyPosition(){return this._tmpHierarchyPosition}_ResetAllSceneGraphState(){this._BuildTmpSceneGraphData();const e=[...this.children()];for(const s of e)this.RemoveChild(s);const t=this.GetParent();t&&t.RemoveChild(this),this._ClearAllSceneGraphFlags()}_BuildTmpSceneGraphData(){if(this._SetTmpHierarchyPosition(),!this._tmpSceneGraphChildren){const t=[...this.children()];t.length&&(this._tmpSceneGraphChildren=[],this._tmpSceneGraphChildrenIndexes=new WeakMap);let e=0;for(const s of t){const n=s.GetInstance();this._tmpSceneGraphChildren.push(n),this._tmpSceneGraphChildrenIndexes.set(n,e),e++}}const e=this.GetParent();e&&e._BuildTmpSceneGraphData()}_SetTmpHierarchyPosition(){if(-1===this._tmpHierarchyPosition){const e=[...this.parents()];this._tmpHierarchyPosition=e.length;for(const s of e)s._SetTmpHierarchyPosition();const t=[...this.children()];for(const n of t)n._SetTmpHierarchyPosition()}}_ReleaseTmpSceneGraphInfo(){this._tmpSceneGraphChildren&&(this._tmpSceneGraphChildren.length=0),this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null;const e=this.GetParent();e&&e._ReleaseTmpSceneGraphInfo(),this._tmpHierarchyPosition=-1}HasParent(){return null!==this.GetParent()}GetParent(){const e=this._sceneGraphInfo;return null!==e?e.GetParent():null}GetTopParent(){let e=this;for(;e.HasParent();)e=e.GetParent();return e}*parents(){let e=this.GetParent();for(;e;)yield e,e=e.GetParent()}HasChild(e){return this.GetChildren().includes(e)}HasChildren(){const e=this._sceneGraphInfo;return null!==e&&e.HasChildren()}GetChildren(){const e=this._sceneGraphInfo;return null!==e?e.GetChildren():EMPTY_ARRAY}children(){return this.GetChildren()}*allChildren(){for(const e of this.children())yield e,yield*e.allChildren()}GetChildCount(){return this.GetChildren().length}GetAllChildCount(){return[...this.allChildren()].length}GetChildAt(e){const t=this.GetChildren();return(e=Math.floor(+e))<0||e>=t.length?null:t[e]}GetChildIndex(t){if(t){const s=this.GetChildren();if(s)for(let e=0;e<s.length;e++)if(t===s[e])return e}return NaN}_CreateSceneGraphInfo(e){this._sceneGraphInfo||(this._sceneGraphInfo=C33.New(C33.SceneGraphInfo,this)),e&&this._sceneGraphInfo.SetParent(e)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){this._sceneGraphInfo&&(this._sceneGraphInfo.Release(),this._sceneGraphInfo=null)}_SetParent(e){e?(e._CreateSceneGraphInfo(null),this._CreateSceneGraphInfo(e)):(this._sceneGraphInfo&&this._sceneGraphInfo.SetParent(null),this.HasChildren()||this._ReleaseSceneGraphInfo())}_HasAnyParent(e){if(!this.HasParent())return!1;const t=this.GetParent();return t===e||t._HasAnyParent(e)}_HasChildRecursive(e){if(this.HasChild(e))return!0;for(const t of this.GetChildren())if(t._HasChildRecursive(e))return!0;return!1}_AddChildToSceneGraphInfo(e){this._sceneGraphInfo.GetChildren().push(e)}_RemoveChildFromSceneGraphInfo(e){const t=this._sceneGraphInfo.GetChildren(),s=t.indexOf(e);-1!==s&&t.splice(s,1),0!==t.length||this.HasParent()||this._ReleaseSceneGraphInfo(),e.HasChildren()||e._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){const e=sceneGraphExportDataMap.get(this);return e?e.childrenData:null}GetSceneGraphZIndexExportData(){const e=sceneGraphExportDataMap.get(this);return e?e.zIndexData:NaN}GetSceneGraphZIndex(){const e=sceneGraphZIndexMap.get(this);return C33.IsFiniteNumber(e)?e:NaN}SetSceneGraphZIndex(e){sceneGraphZIndexMap.set(this,e)}SetUsePointsShaderProgram(){this._SetFlag(FLAG_USE_POINTS_SHADER_PROGRAM,!0),this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(enableUpdateRendererStateGroup){const t=this._runtime.GetRenderer();this._stateGroup&&t.ReleaseStateGroup(this._stateGroup);let e;e=0!=(this._flags&FLAG_USE_POINTS_SHADER_PROGRAM)?t.GetPointsRenderingProgram()||"<point>":t.GetTextureFillShaderProgram()||"<default>",this._stateGroup=t.AcquireStateGroup(e,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===DEFAULT_COLOR}SetBlendMode(e){if((e|=0)<0||31<e)throw new RangeError("invalid blend mode");this.GetBlendMode()!==e&&(this._flags=this._flags&~FLAG_BLEND_MODE_MASK|e<<FLAG_BLEND_MODE_BIT_OFFSET,this._UpdateRendererStateGroup())}GetBlendMode(){return(this._flags&FLAG_BLEND_MODE_MASK)>>FLAG_BLEND_MODE_BIT_OFFSET}_SetLayer(e,t){const s=t&&this._layer!==e;s&&this._RemoveFromRenderCells(),this._objectClass._OnWorldInstanceLayerChanged(this,this._layer,e),this._layer=e,s&&this._UpdateRenderCell(),0!==this.GetZElevation()&&this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(e){this._zIndex=0|e}GetZIndex(){return this._layer._UpdateZIndices(),this._zIndex}_SetHTMLZIndex(e){this._htmlZIndex=0|e}GetHTMLZIndex(){return this._layer._UpdateHTMLZIndices(),this._htmlZIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(e,t){t?this._flags|=e:this._flags&=~e}IsVisible(){return 0!=(this._flags&FLAG_IS_VISIBLE)}SetVisible(e){if(this._SetFlag(FLAG_IS_VISIBLE,e),this.HasChildren())for(const t of this.GetChildren())t.GetTransformWithParentVisibility()&&t.SetVisible(e)}IsCollisionEnabled(){return 0!=(this._flags&FLAG_COLLISION_ENABLED)}SetCollisionEnabled(e){e=!!e,this.IsCollisionEnabled()!==e&&(this._SetFlag(FLAG_COLLISION_ENABLED,e),e?this.SetBboxChanged():this._RemoveFromCollisionCells())}SetSolidCollisionFilter(e,t){if(this._SetFlag(FLAG_SOLID_FILTER_INCLUSIVE,e),this._solidFilterTags&&this._solidFilterTags.clear(),t.trim()){this._solidFilterTags||(this._solidFilterTags=new Set);for(const s of t.split(" "))s&&this._solidFilterTags.add(s.toLowerCase())}else this._solidFilterTags=null}IsSolidCollisionAllowed(e){const t=0!=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE),s=this._solidFilterTags;if(e&&s)for(const n of s)if(e.has(n))return t;return!t}SetBboxChanged(){if(this._flags|=FLAG_BBOX_CHANGED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED,this._objectClass._SetAnyCollisionCellChanged(!0),this._runtime.UpdateRender(),this._layer.UsesRenderCells()&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateRenderCell()),0!=(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)&&this._inst.Dispatcher().dispatchEvent(bboxChangeEvent),null!==this._sceneGraphInfo){const s=this._sceneGraphInfo.GetChildren();for(let e=0,t=s.length;e<t;++e)s[e].SetBboxChanged()}}CalculateBbox(e,t,s){const n=this.GetX(),i=this.GetY(),r=this.GetWidth(),a=this.GetHeight(),o=this.GetAngle();e.setWH(n-this._ox*r,i-this._oy*a,r,a),s&&this.HasMesh()&&this._ExpandBboxForMesh(e),0===o?t.setFromRect(e):(e.offset(-n,-i),t.setFromRotatedRectPrecalc(e,this.GetSinAngle(),this.GetCosAngle()),t.offset(n,i),t.getBoundingBox(e)),e.normalize()}_UpdateBbox(){const e=this._flags;0!=(e&FLAG_BBOX_CHANGED)&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags=e&~FLAG_BBOX_CHANGED)}GetBoundingBox(){return this._UpdateBbox(),this._boundingBox}GetBoundingQuad(){return this._UpdateBbox(),this._boundingQuad}PixelRoundQuad(e){const t=this.GetX(),s=this.GetY(),n=Math.round(t)-t,i=Math.round(s)-s;return 0==n&&0==i?e:(tempQuad.copy(e),tempQuad.offset(n,i),tempQuad)}OverwriteBoundingBox(e){this._boundingBox.copy(e),this._boundingQuad.setFromRect(this._boundingBox),this._flags&=~FLAG_BBOX_CHANGED,this._UpdateCollisionCell(),this._UpdateRenderCell()}SetBboxChangeEventEnabled(e){this._SetFlag(FLAG_ENABLE_BBOX_CHANGED_EVENT,e)}IsBboxChangeEventEnabled(){return 0!=(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)}IsInViewport(e,t,s){return t&&0!==this.GetDepth()?this.IsInViewport3D(this.GetLayer()._GetViewFrustum()):0===this.GetZElevation()||s?e.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){const e=this.GetLayer(),t=this.GetTotalZElevation();return!(t>=e.Get2DCameraZ())&&(e.GetViewportForZ(t,tempRect),tempRect.intersectsRect(this.GetBoundingBox()))}IsInViewport3D(e){const t=this.GetBoundingBox(),s=t.getLeft(),n=t.getRight(),i=t.getTop(),r=t.getBottom(),a=this.GetTotalZElevation(),o=a+this.GetDepth();return e.ContainsAABB(s,i,a,n,r,o)}IsInViewport2(){const e=this.GetLayer();if(e.Has3DCamera())return this.IsInViewport3D(e._GetViewFrustum());{const t=e.GetLayout();return this.IsInViewport(e.GetViewport(),t.HasVanishingPointOutsideViewport(),t.IsOrthographicProjection())}}_SetDrawBackFaceOnly(e){this._SetFlag(FLAG_DRAW_BACK_FACE_ONLY,e)}_SetDrawNonBackFacesOnly(e){this._SetFlag(FLAG_DRAW_NON_BACK_FACES_ONLY,e)}IsDrawBackFaceOnly(){return 0!=(this._flags&FLAG_DRAW_BACK_FACE_ONLY)}IsDrawNonBackFacesOnly(){return 0!=(this._flags&FLAG_DRAW_NON_BACK_FACES_ONLY)}SetSourceCollisionPoly(e){this._sourceCollisionPoly=e,this._DiscardTransformedCollisionPoly(),this.HasMesh()&&(this._meshInfo.meshPoly=null)}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return null!==this._sourceCollisionPoly||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(e,t,s){let n=0,i=1;return 0!==s&&(n=Math.sin(s),i=Math.cos(s)),this._GetCustomTransformedCollisionPolyPrecalc(e,t,s,n,i)}_GetCustomTransformedCollisionPolyPrecalc(i,r,e,a,o){let t=this._transformedPolyInfo;null===t&&(t={poly:C33.New(C33.CollisionPoly),width:NaN,height:NaN,angle:NaN},this._transformedPolyInfo=t);const l=t.poly;if(t.width!==i||t.height!==r||t.angle!==e){const h=this._sourceCollisionPoly;if(this.HasMesh()){let e=this.GetOriginX(),t=this.GetOriginY(),s=this.GetSourceMesh(),n=this._meshInfo.meshPoly;n||(h?(tempCollisionPoly.copy(h),tempCollisionPoly.offset(e,t)):tempCollisionPoly.setDefaultPoints(),n=s.InsertPolyMeshVertices(tempCollisionPoly),this._meshInfo.meshPoly=n),s.TransformCollisionPoly(n,l),l.offset(-e,-t),l.transformPrecalc(i,r,a,o)}else h?(l.copy(h),l.transformPrecalc(i,r,a,o)):l.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());t.width=i,t.height=r,t.angle=e}return l}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(!0);const e=this._transformedPolyInfo;null!==e&&(e.width=NaN)}CreateMesh(e,t){if(e=Math.floor(e),t=Math.floor(t),!this.GetInstance().GetPlugin().SupportsMesh())throw new Error("object does not support mesh");this.ReleaseMesh(),this._meshInfo={sourceMesh:C33.New(C33.Gfx.Mesh,e,t),transformedMesh:C33.New(C33.Gfx.Mesh,e,t),meshPoly:null}}HasMesh(){return null!==this._meshInfo}GetSourceMesh(){if(this.HasMesh())return this._meshInfo.sourceMesh;throw new Error("no mesh")}GetTransformedMesh(){if(this.HasMesh())return this._meshInfo.transformedMesh;throw new Error("no mesh")}SetMeshChanged(e){this._SetFlag(FLAG_MESH_CHANGED,e)}IsMeshChanged(){return 0!=(this._flags&FLAG_MESH_CHANGED)}SetPhysicsBodyChanged(e){this._SetFlag(FLAG_PHYSICS_BODY_CHANGED,e)}IsPhysicsBodyChanged(){return 0!=(this._flags&FLAG_PHYSICS_BODY_CHANGED)}_ExpandBboxForMesh(e){const t=this._meshInfo.sourceMesh,s=Math.min(t.GetMinX(),0),n=Math.min(t.GetMinY(),0),i=Math.max(t.GetMaxX(),1),r=Math.max(t.GetMaxY(),1),a=e.width(),o=e.height();e.offsetLeft(s*a),e.offsetTop(n*o),e.offsetRight((i-1)*a),e.offsetBottom((r-1)*o),this._depth=t.GetMaxZ()}ReleaseMesh(){this._meshInfo&&(this._meshInfo.sourceMesh.Release(),this._meshInfo.transformedMesh.Release(),this._meshInfo=null,this._DiscardTransformedCollisionPoly())}SetMeshPoint(e,t,s){e=Math.floor(e),t=Math.floor(t);const n=s.mode||"absolute";if(!VALID_SET_MESH_POINT_MODES.has(n))throw new Error("invalid mode");let i="relative"===n,r=s.x,a=s.y,o=s.zElevation,l="number"==typeof s.u?s.u:i?0:-1,h="number"==typeof s.v?s.v:i?0:-1;if(!this.HasMesh())return!1;const c=this.GetSourceMesh(),u=c.GetMeshPointAt(e,t);if(null===u)return!1;let d=!1;return"number"==typeof o&&u.GetZElevation()!==o&&(u.SetZElevation(o),d=!0),i&&(r+=e/(c.GetHSize()-1),a+=t/(c.GetVSize()-1)),l=-1!==l||i?(i&&(l+=e/(c.GetHSize()-1)),C33.clamp(l,0,1)):u.GetU(),h=-1!==h||i?(i&&(h+=t/(c.GetVSize()-1)),C33.clamp(h,0,1)):u.GetV(),u.GetX()===r&&u.GetY()===a&&u.GetU()===l&&u.GetV()===h?d:(u.SetX(r),u.SetY(a),u.SetU(l),u.SetV(h),this._DiscardTransformedCollisionPoly(),!0)}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(e,t){return!!this.GetBoundingBox().containsPoint(e,t)&&!!this.GetBoundingQuad().containsPoint(e,t)&&(this.HasTilemap()?this._inst.GetSdkInstance().TestPointOverlapTile(e,t):!this.HasOwnCollisionPoly()||this.GetTransformedCollisionPoly().containsPoint(e-this.GetX(),t-this.GetY()))}_IsCollisionCellChanged(){return 0!=(this._flags&FLAG_COLLISION_CELL_CHANGED)}_UpdateCollisionCell(){if(this._IsCollisionCellChanged()&&this.IsCollisionEnabled()&&0==(this._flags&FLAG_DESTROYED)){const e=this.GetBoundingBox(),t=this._objectClass._GetCollisionCellGrid(),s=this._collisionCells;if(tempRect.set(t.XToCell(e.getLeft()),t.YToCell(e.getTop()),t.XToCell(e.getRight()),t.YToCell(e.getBottom())),!s.equals(tempRect)){const n=this._inst;s===DEFAULT_COLLISION_CELLS?(t.Update(n,null,tempRect),this._collisionCells=C33.New(C33.Rect,tempRect)):(t.Update(n,s,tempRect),s.copy(tempRect)),this._flags&=~FLAG_COLLISION_CELL_CHANGED}}}_SetCollisionCellChanged(){this._flags|=FLAG_COLLISION_CELL_CHANGED}_RemoveFromCollisionCells(){const e=this._collisionCells;e!==DEFAULT_COLLISION_CELLS&&(this._objectClass._GetCollisionCellGrid().Update(this._inst,e,null),this._collisionCells=DEFAULT_COLLISION_CELLS)}_UpdateRenderCell(){const e=this.GetLayer();if(e.UsesRenderCells()&&0==(this._flags&FLAG_DESTROYED)){const t=e.GetRenderGrid(),s=this.GetBoundingBox(),n=this._renderCells;if(tempRect.set(t.XToCell(s.getLeft()),t.YToCell(s.getTop()),t.XToCell(s.getRight()),t.YToCell(s.getBottom())),!n.equals(tempRect)){const i=this._inst;n===DEFAULT_RENDER_CELLS?(t.Update(i,null,tempRect),this._renderCells=C33.New(C33.Rect,tempRect)):(t.Update(i,n,tempRect),n.copy(tempRect)),e.SetRenderListStale()}}}_RemoveFromRenderCells(){const e=this._renderCells;e!==DEFAULT_RENDER_CELLS&&(this.GetLayer().GetRenderGrid().Update(this._inst,e,null),this._renderCells=DEFAULT_RENDER_CELLS)}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s.at(-1)===e||(t._RemoveInstance(e,!1),t._AddInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToBottom(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s[0]===e||(t._RemoveInstance(e,!1),t._PrependInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToLayer(e){const t=this._inst,s=this._layer;if(s.GetLayout()!==e.GetLayout())throw new Error("layer from different layout");e!==s&&(s._RemoveInstance(t,!0),this._SetLayer(e),e._AddInstance(t,!0),this._runtime.UpdateRender())}ZOrderMoveAdjacentToInstance(e,t){let s=this._inst,n=!1,i=this._layer;if(e.GetUID()!==s.GetUID()){const r=e.GetWorldInfo();if(!r)throw new Error("expected world instance");const a=r.GetLayer(),o=(i.GetIndex()!==a.GetIndex()&&(i._RemoveInstance(s,!0),this._SetLayer(a),a._AddInstance(s,!0),n=!0),a.MoveInstanceAdjacent(s,e,!!t));(n||o)&&this._runtime.UpdateRender()}}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(e){this._SetFlag(FLAG_HAS_ANY_ACTIVE_EFFECT,e)}HasAnyActiveEffect(){return 0!=(this._flags&FLAG_HAS_ANY_ACTIVE_EFFECT)}_SaveToJson(e,t=null){const s={x:this.GetX(),y:this.GetY(),w:this.GetWidth(),h:this.GetHeight(),l:this.GetLayer().GetSID(),zi:this.GetZIndex()},n=(0!==this.GetZElevation()&&(s.ze=this.GetZElevation()),0!==this.GetAngle()&&(s.a=this._GetAngleNoReflect()),this.HasDefaultColor()||(s.c=this._color.toJSON()),.5!==this.GetOriginX()&&(s.oX=this.GetOriginX()),.5!==this.GetOriginY()&&(s.oY=this.GetOriginY()),0!==this.GetBlendMode()&&(s.bm=this.GetBlendMode()),this.IsVisible()||(s.v=this.IsVisible()),this.IsCollisionEnabled()||(s.ce=this.IsCollisionEnabled()),this.IsBboxChangeEventEnabled()&&(s.be=this.IsBboxChangeEventEnabled()),this._instanceEffectList&&(s.fx=this._instanceEffectList._SaveToJson()),0!=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE));return n&&(s.sfi=n),this._solidFilterTags&&(s.sft=[...this._solidFilterTags].join(" ")),this._sceneGraphInfo&&"visual-state"!==e&&(s.sgi=this._sceneGraphInfo._SaveToJson(e,t),sceneGraphExportDataMap.has(this))&&(s.sgcd=sceneGraphExportDataMap.get(this).childrenData,s.sgzid=sceneGraphExportDataMap.get(this).zIndexData),this.HasMesh()&&(s.mesh=this.GetSourceMesh().SaveToJson()),s}_SaveSceneGraphPropertiesToJson(){return{x:this._x,y:this._y,z:this._zElevation,w:this._w,h:this._h,a:this._a,sgi:this._GetSceneGraphInfo()?this._GetSceneGraphInfo()._SaveToJsonProperties():null}}_LoadSceneGraphPropertiesFromJson(e){e&&(this._x=e.x,this._y=e.y,this._zElevation=e.z,this._w=e.w,this._h=e.h,this._a=e.a,e.sgi&&this._GetSceneGraphInfo()&&this._GetSceneGraphInfo()._LoadFromJson(e.sgi),this._MarkSinCosAngleChanged(),this.SetBboxChanged())}_SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo(),this._ResetAllSceneGraphState(),this._CreateSceneGraphInfo(null),this._sceneGraphInfo&&this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes)}_OnBeforeLoad(e){"visual-state"!==e&&this._ResetAllSceneGraphState()}_OnAfterLoad(e,t="full",s=null){e.hasOwnProperty("sgi")&&"visual-state"!==t&&0==(this._flags&FLAG_DESTROYED)&&this._sceneGraphInfo._OnAfterLoad(e.sgi,s)}_OnAfterLoad2(e,t="full",s){e.hasOwnProperty("sgi")&&"visual-state"!==t&&0==(this._flags&FLAG_DESTROYED)&&(this._sceneGraphInfo._SetTmpSceneGraphChildren(null,null),this._ReleaseTmpSceneGraphInfo(),this.SetBboxChanged())}_LoadFromJson(e,t){if(enableUpdateRendererStateGroup=!1,this.SetX(e.x),this.SetY(e.y),this.SetWidth(e.w),this.SetHeight(e.h),this._SetZIndex(e.zi),this.SetZElevation(e.hasOwnProperty("ze")?e.ze:0),this.SetAngle(e.hasOwnProperty("a")?e.a:0),e.hasOwnProperty("c")?tempColor.setFromJSON(e.c):e.hasOwnProperty("o")?(tempColor.copyRgb(this._color),tempColor.a=e.o):tempColor.setRgba(1,1,1,1),this._SetColor(tempColor),this.SetOriginX(e.hasOwnProperty("oX")?e.oX:.5),this.SetOriginY(e.hasOwnProperty("oY")?e.oY:.5),this.SetBlendMode(e.hasOwnProperty("bm")?e.bm:0),this.SetVisible(!e.hasOwnProperty("v")||e.v),this.SetCollisionEnabled(!e.hasOwnProperty("ce")||e.ce),this.SetBboxChangeEventEnabled(!!e.hasOwnProperty("be")&&e.be),this.SetSolidCollisionFilter(!!e.hasOwnProperty("sfi")&&e.sfi,e.hasOwnProperty("sft")?e.sft:""),this._instanceEffectList&&e.hasOwnProperty("fx")&&this._instanceEffectList._LoadFromJson(e.fx),!e.hasOwnProperty("sgi")&&"visual-state"!==t&&this._tmpSceneGraphChildren)for(const s of this._tmpSceneGraphChildren)s.IsDestroyed()||this._runtime.DestroyInstance(s);if(e.hasOwnProperty("sgi")&&"visual-state"!==t){this._CreateSceneGraphInfo(null);const n=this._sceneGraphInfo,i=e.sgi;n._LoadFromJson(i),n._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes),e.sgcd&&C33.IsFiniteNumber(e.sgzid)&&sceneGraphExportDataMap.set(this,{childrenData:e.sgcd,zIndexData:e.sgzid})}if(e.hasOwnProperty("mesh")){const r=e.mesh;this.CreateMesh(r.cols,r.rows),this.GetSourceMesh().LoadFromJson(r)}else this.ReleaseMesh();this.SetBboxChanged(),enableUpdateRendererStateGroup=!0,this._UpdateRendererStateGroup(),"visual-state"!==t&&this._runtime.AddInstanceNeedingAfterLoad(this.GetInstance(),e)}}}{const C33=self.C3;C33.BehaviorType=class extends C33.DefendedBase{constructor(e,t){super();const s=e.GetRuntime(),n=s.GetObjectReference(t[1]),i=(s.GetAddonManager()._DelayCreateBehavior(n),this._runtime=s,this._objectClass=e,this._behavior=C33.AddonManager.GetBehaviorByConstructorFunction(n),this._sdkType=null,this._iBehaviorType=null,this._instSdkCtor=n.Instance,this._sid=t[2],this._name=t[0],this._jsPropName=this._runtime.GetJsPropName(t[3]),this._behavior.GetSdkVersion());if(i<2&&(this._sdkType=C33.New(n.Type,this),!(this._sdkType instanceof C33.SDKBehaviorTypeBase)))throw new Error("v1 sdk type must derive from SDKBehaviorBase");if(C33.AddonManager._PushInitObject(this,i),2<=i){const r=n.Type??globalThis.ISDKBehaviorTypeBase;if(this._iBehaviorType=new r,!(this._iBehaviorType instanceof globalThis.ISDKBehaviorTypeBase))throw new Error("script interface class must derive from ISDKBehaviorTypeBase")}else this._iBehaviorType=new globalThis.IBehaviorType;C33.AddonManager._PopInitObject(i),this.OnCreate()}static Create(e,t){return C33.New(C33.BehaviorType,e,t)}Release(){this._runtime=null,this._behavior=null,this._sdkType&&(this._sdkType.Release(),this._sdkType=null),this._instSdkCtor=null}GetSdkType(){return this._sdkType}OnCreate(){this._sdkType?this._sdkType.OnCreate():this._iBehaviorType&&this._iBehaviorType._onCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetIBehaviorType(){return this._iBehaviorType}GetJsPropName(){return this._jsPropName}}}{const C33=self.C3,IBehaviorInstance=self.IBehaviorInstance;C33.BehaviorInstance=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._behaviorType=e.behaviorType,this._behavior=this._behaviorType.GetBehavior(),this._inst=e.instance,this._index=e.index,this._sdkInst=null,this._iScriptInterface=null,this._behavior._AddInstance(this._inst)}Release(){this._iScriptInterface&&(this._iScriptInterface._release(),this._iScriptInterface=null),this._behavior._RemoveInstance(this._inst),this._sdkInst&&(this._sdkInst.Release(),this._sdkInst=null),this._runtime=null,this._behaviorType=null,this._behavior=null,this._inst=null}_CreateSdkInstance(e){if(this._sdkInst)throw new Error("already got sdk instance");const t=this.GetBehavior().GetSdkVersion();if(t<2){if(this._sdkInst=C33.New(this._behaviorType.GetInstanceSdkCtor(),this,e),!(this._sdkInst instanceof C33.SDKBehaviorInstanceBase))throw new Error("v1 sdk type must derive from SDKBehaviorInstanceBase")}else{const s=this.GetBehavior().GetScriptInterfaceClass();this._InitScriptInterface(s.Instance,e)}}GetSdkInstance(){return this._sdkInst??this._iScriptInterface}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){this._sdkInst?this._sdkInst.PostCreate():this._iScriptInterface._postCreate()}OnSpriteFrameChanged(e,t){this._sdkInst&&this._sdkInst.OnSpriteFrameChanged(e,t)}_GetDebuggerProperties(){return this._sdkInst?this._sdkInst.GetDebuggerProperties():this._iScriptInterface._getDebuggerProperties()}SaveToJson(e="full"){return this._sdkInst?this._sdkInst.SaveToJson(e):this._iScriptInterface._saveToJson(e)}LoadFromJson(e,t="full"){if(this._sdkInst)return this._sdkInst.LoadFromJson(e,t);this._iScriptInterface._loadFromJson(e,t)}static SortByTickSequence(e,t,s){let n=globalThis.ISDKBehaviorInstanceBase,i,r;i=t instanceof n?e._UnwrapScriptInterface(t):t.GetBehaviorInstance(),r=s instanceof n?e._UnwrapScriptInterface(s):s.GetBehaviorInstance();const a=i.GetObjectInstance(),o=r.GetObjectInstance(),l=a.GetObjectClass().GetIndex(),h=o.GetObjectClass().GetIndex();if(l!==h)return l-h;const c=a.GetPUID(),u=o.GetPUID();return c!==u?c-u:i._GetIndex()-r._GetIndex()}_InitScriptInterface(e,t){const s=IBehaviorInstance,n=e??this._sdkInst.GetScriptInterfaceClass(),i=n||s,r=this.GetBehavior().GetSdkVersion();if(C33.AddonManager._PushInitObject(this,r),C33.AddonManager._PushInitProperties(t),this._iScriptInterface=new i,C33.AddonManager._PopInitProperties(),C33.AddonManager._PopInitObject(r),!n||this._iScriptInterface instanceof s)return this._iScriptInterface;throw new TypeError(`script interface class '${n.name}' does not extend the right base class '${s.name}'`)}GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}}}{const C33=self.C3;C33.EffectList=class extends C33.DefendedBase{constructor(e,t){super(),this._owner=e,this._allEffectTypes=[],this._activeEffectTypes=[],this._effectTypesByName=new Map,this._effectParams=[],this._effectParamBuffers=[],this._allInstanceEffectLists=new Set,this._preservesOpaqueness=!0;for(const s of t){const n=C33.New(C33.EffectType,this,s,this._allEffectTypes.length);this._allEffectTypes.push(n),this._effectTypesByName.set(n.GetName().toLowerCase(),n),3<=s.length&&this._effectParams.push(this._LoadSingleEffectParameters(n,s[2]))}this.GetRuntime()._AddEffectList(this)}Release(){this.GetRuntime()._RemoveEffectList(this);for(const e of this._effectParamBuffers)e.Release();C33.clearArray(this._effectParamBuffers),C33.clearArray(this._allEffectTypes),C33.clearArray(this._activeEffectTypes),this._effectTypesByName.clear(),C33.clearArray(this._effectParams),this._owner=null}_AddInstanceEffectList(e){this._allInstanceEffectLists.add(e)}_RemoveInstanceEffectList(e){this._allInstanceEffectLists.delete(e)}_InitRenderer(e){e.IsWebGPU()&&(this._effectParamBuffers=this._allEffectTypes.map(e=>{const t=e.GetShaderProgram();return 0<t.GetCustomParametersByteSize()?C33.New(C33.Gfx.WebGPUEffectCustomParamsBuffer,t):null}),this._UpdateAllEffectParamBuffers());for(const t of this._allInstanceEffectLists)t._InitRenderer(e)}PrependEffectTypes(e){if(e.length){this._allEffectTypes=e.concat(this._allEffectTypes);for(const t of e)this._effectTypesByName.set(t.GetName().toLowerCase(),t);for(let e=0,t=this._allEffectTypes.length;e<t;++e)this._allEffectTypes[e]._SetIndex(e)}}_LoadSingleEffectParameters(e,t){e.SetActive(t[0]);const s=t.slice(1);for(let e=0,t=s.length;e<t;++e){const n=s[e];if(Array.isArray(n)){const i=C33.New(C33.Color);i.setFromJSON(n),s[e]=i}}return s}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){C33.clearArray(this._activeEffectTypes);let e=!0;for(const t of this._allEffectTypes)t.IsActive()&&(this._activeEffectTypes.push(t),t.GetShaderProgram().PreservesOpaqueness()||(e=!1));this._preservesOpaqueness=e}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return 0<this._allEffectTypes.length}GetEffectTypeByName(e){return this._effectTypesByName.get(e.toLowerCase())||null}GetEffectTypeByIndex(e){if((e=Math.floor(+e))<0||e>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[e]}IsEffectIndexActive(e){return this.GetEffectTypeByIndex(e).IsActive()}SetEffectIndexActive(e,t){this.GetEffectTypeByIndex(e).SetActive(t)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return 0<this._activeEffectTypes.length}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return(e<this._effectParamBuffers.length?this._effectParamBuffers:this._effectParams)[e]}GetEffectParameter(e,t){if(e<0||e>=this._effectParams.length)return null;const s=this._effectParams[e];return t<0||t>=s.length?null:s[t]}SetEffectParameter(e,t,s){if(e<0||e>=this._effectParams.length)return!1;const n=this._effectParams[e];if(t<0||t>=n.length)return!1;const i=n[t];if(i instanceof C33.Color){if(i.equalsIgnoringAlpha(s))return!1;i.copyRgb(s)}else{if(i===s)return!1;n[t]=s}return e<this._effectParamBuffers.length&&this._effectParamBuffers[e].SetParameterValue(t,s),!0}_UpdateAllEffectParamBuffers(){const s=this._effectParams,n=this._effectParamBuffers;for(let e=0,t=Math.min(s.length,n.length);e<t;++e){const i=n[e],r=s[e];for(let e=0,t=r.length;e<t;++e)i.SetParameterValue(e,r[e])}}static SaveFxParamToJson(e){return e&&e instanceof C33.Color?{t:"color",v:e.toJSON()}:e}static LoadFxParamFromJson(e){if(null===e)return NaN;if("object"!=typeof e)return e;{const t=e.t;if("color"!==t)throw new Error("invalid effect parameter type");{const s=C33.New(C33.Color);return s.setFromJSON(e.v),s}}}static SaveFxParamsToJson(e){return e.map(C33.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(e){return e.map(C33.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map(e=>({name:e.GetName(),active:e.IsActive(),params:C33.EffectList.SaveFxParamsToJson(this._effectParams[e.GetIndex()])}))}LoadFromJson(e){for(const t of e){const s=this.GetEffectTypeByName(t.name);s&&(s.SetActive(t.active),this._effectParams[s.GetIndex()]=C33.EffectList.LoadFxParamsFromJson(t.params))}this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}}}{const C33=self.C3;C33.EffectType=class extends C33.DefendedBase{constructor(e,t,s){super(),this._effectList=e,this._id=t[0],this._name=t[1],this._index=s,this._shaderProgram=null,this._isActive=!0}Release(){this._effectList=null,this._shaderProgram=null}Clone(e){const t=C33.New(C33.EffectType,e,[this._id,this._name],-1);return t._shaderProgram=this._shaderProgram,t._isActive=this._isActive,t}_InitRenderer(e){const t=e.GetShaderProgramByName(this._id);if(!t)throw new Error("failed to find shader program '"+this._id+"'");this._shaderProgram=t}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(e){this._isActive=!!e}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){const s=[];for(let e=0,t=this._shaderProgram.GetParameterCount();e<t;++e){const n=this._shaderProgram.GetParameterType(e);if("float"===n||"percent"===n)s.push(0);else{if("color"!==n)throw new TypeError("unknown effect parameter type");s.push(C33.New(C33.Color,1,1,1,1))}}return s}}}{const C33=self.C3;C33.InstanceEffectList=class extends C33.DefendedBase{constructor(e,t){super(),this._inst=e,this._wi=t,this._effectList=e.GetObjectClass().GetEffectList(),this._needsRebuildSteps=!0,this._wasDefaultColor=!0,this._was3D=!1,this._wasRotatedOrNegativeSize=!1,this._wasTexRotated=!1,this._wasMustPreDraw=!1,this._effectChain=C33.New(C33.Gfx.EffectChain,e.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(e,t)=>{const s=t.GetContentObject(),n=s.GetWorldInfo();e.SetColor(n.GetPremultipliedColor()),e.SetCurrentZ(n.GetTotalZElevation()),s.Draw(e),e.SetCurrentZ(0)},getSourceTextureInfo:e=>{const t=e.GetCurrentTexRect(),[s,n]=e.GetCurrentSurfaceSize();return{srcTexRect:t,srcWidth:s,srcHeight:n}},getShaderParameters:e=>this._GetEffectChainShaderParametersForIndex(e)}),this._activeEffectFlags=[],this._activeEffectTypes=[],this._preservesOpaqueness=!0,this._effectParams=[],this._effectParamBuffers=[],this._InitRenderer(e.GetRuntime().GetRenderer());for(let e=0,t=this._effectList.GetAllEffectTypes().length;e<t;++e)this._activeEffectFlags.push(!0);this.UpdateActiveEffects(),this._effectList._AddInstanceEffectList(this)}Release(){this._effectList._RemoveInstanceEffectList(this);for(const e of this._effectParamBuffers)e&&e.Release();C33.clearArray(this._effectParamBuffers),this._effectChain.Release(),this._effectChain=null,C33.clearArray(this._activeEffectFlags),C33.clearArray(this._activeEffectTypes),C33.clearArray(this._effectParams),this._inst=null,this._effectList=null}_InitRenderer(e){e.IsWebGPU()&&(this._effectParamBuffers=this._effectList.GetAllEffectTypes().map(e=>{const t=e.GetShaderProgram();return 0<t.GetCustomParametersByteSize()?C33.New(C33.Gfx.WebGPUEffectCustomParamsBuffer,t):null}))}_LoadEffectParameters(e){let t=0;for(const s of e)this._effectParams.push(this._LoadSingleEffectParameters(t,s)),++t;this._UpdateAllEffectParamBuffers(),this.UpdateActiveEffects()}_LoadSingleEffectParameters(e,t){this._activeEffectFlags[e]=t[0];const s=t.slice(1);for(let e=0,t=s.length;e<t;++e){const n=s[e];if(Array.isArray(n)){const i=C33.New(C33.Color);i.setFromJSON(n),s[e]=i}}return s}LoadDefaultEffectParameters(){for(const e of this._effectList.GetAllEffectTypes())this._effectParams.push(e.GetDefaultParameterValues());this._UpdateAllEffectParamBuffers()}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){C33.clearArray(this._activeEffectTypes);let e=this._wi,s=this._effectList.GetAllEffectTypes(),n=this._activeEffectTypes,i=this._activeEffectFlags,r=!0;for(let e=0,t=s.length;e<t;++e)if(i[e]){const a=s[e];n.push(a),a.GetShaderProgram().PreservesOpaqueness()||(r=!1)}this._preservesOpaqueness=r,e._SetHasAnyActiveEffect(!!n.length),this._needsRebuildSteps=!0}_MaybeRebuildEffectChainSteps(){const e=this._inst,t=this._wi,s=t.HasDefaultColor(),n=e.GetPlugin().Is3D(),i=0!==t.GetAngle()||0!==t.GetLayer().GetAngle()||t.GetWidth()<0||t.GetHeight()<0,r=e.IsCurrentTexRotated(),a=e.MustPreDraw();(this._needsRebuildSteps||s!==this._wasDefaultColor||n!==this._was3D||i!==this._wasRotatedOrNegativeSize||r!==this._wasTexRotated||a!==this._wasMustPreDraw||this._effectChain.NeedsRebuild())&&(this._effectChain.BuildSteps(this._activeEffectTypes.map(e=>e.GetShaderProgram()),{indexMap:this._activeEffectTypes.map(e=>e.GetIndex()),forcePreDraw:!s||a,is3D:n,isSourceTextureRotated:r,isRotatedOrNegativeSizeInstance:i}),this._needsRebuildSteps=!1,this._wasDefaultColor=s,this._was3D=n,this._wasRotatedOrNegativeSize=i,this._wasTexRotated=r,this._wasMustPreDraw=a)}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return(e<this._effectParamBuffers.length?this._effectParamBuffers:this._effectParams)[e]}GetEffectParameter(e,t){if(e<0||e>=this._effectParams.length)return null;const s=this._effectParams[e];return t<0||t>=s.length?null:s[t]}SetEffectParameter(e,t,s){if(e<0||e>=this._effectParams.length)return!1;const n=this._effectParams[e];if(t<0||t>=n.length)return!1;const i=n[t];if(i instanceof C33.Color){if(i.equalsIgnoringAlpha(s))return!1;i.copyRgb(s)}else{if(i===s)return!1;n[t]=s}return e<this._effectParamBuffers.length&&this._effectParamBuffers[e].SetParameterValue(t,s),!0}_UpdateAllEffectParamBuffers(){const s=this._effectParams,n=this._effectParamBuffers;for(let e=0,t=n.length;e<t;++e){const i=n[e],r=s[e];for(let e=0,t=r.length;e<t;++e)i.SetParameterValue(e,r[e])}}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some(e=>e.GetShaderProgram().BlendsBackground())}IsEffectIndexActive(e){return this._activeEffectFlags[e]}SetEffectIndexActive(e,t){this._activeEffectFlags[e]=!!t}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map(e=>({name:e.GetName(),active:this._activeEffectFlags[e.GetIndex()],params:C33.EffectList.SaveFxParamsToJson(this._effectParams[e.GetIndex()])}))}_LoadFromJson(e){for(const t of e){const s=this._effectList.GetEffectTypeByName(t.name);s&&(this._activeEffectFlags[s.GetIndex()]=t.active,this._effectParams[s.GetIndex()]=C33.EffectList.LoadFxParamsFromJson(t.params))}this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}}}{let C33=self.C3,tempCandidates=[],tileCollRectCandidates=[],tempJumpthruRet=[],tempPolyA=C33.New(C33.CollisionPoly),tempPolyB=C33.New(C33.CollisionPoly),tempQuad=C33.New(C33.Quad),tempRect=C33.New(C33.Rect),tempRect2=C33.New(C33.Rect),tempPolyC=null,tempRect3=null,tempQuadB=null;C33.CollisionEngine=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._collisionCellWidth=0,this._collisionCellHeight=0,this._registeredCollisions=[],this._collisionCheckCount=0,this._collisionCheckSec=0,this._polyCheckCount=0,this._polyCheckSec=0,this._iCollisionEngine=new self.ICollisionEngine(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetICollisionEngine(){return this._iCollisionEngine}_Update1sStats(){this._collisionCheckSec=this._collisionCheckCount,this._collisionCheckCount=0,this._polyCheckSec=this._polyCheckCount,this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(e,t){const s=e.GetWorldInfo(),n=t.GetWorldInfo();s&&n&&s.IsCollisionEnabled()&&n.IsCollisionEnabled()&&this._registeredCollisions.push([e,t])}AddRegisteredCollisionCandidates(t,s,n){for(const[i,r]of this._registeredCollisions){let e=null;if(t===i)e=r;else{if(t!==r)continue;e=i}e.BelongsToObjectClass(s)&&!n.includes(e)&&n.push(e)}}CheckRegisteredCollision(e,t){if(this._registeredCollisions.length)for(const[s,n]of this._registeredCollisions)if(e===s&&t===n||e===n&&t===s)return!0;return!1}ClearRegisteredCollisions(){C33.clearArray(this._registeredCollisions)}TestOverlap(e,t){if(!e||!t||e===t)return!1;const s=e.GetWorldInfo(),n=t.GetWorldInfo();if(!s.IsCollisionEnabled()||!n.IsCollisionEnabled())return!1;this._collisionCheckCount++;const i=s.GetLayer(),r=n.GetLayer(),a=i.IsTransformCompatibleWith(r);return a?this._TestOverlap_SameLayers(s,n):this._TestOverlap_DifferentLayers(s,n)}_TestOverlap_SameLayers(e,t){if(!e.GetBoundingBox().intersectsRect(t.GetBoundingBox()))return!1;if(this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(t.GetBoundingQuad()))return!1;if(e.HasTilemap()&&t.HasTilemap())return!1;if(e.HasTilemap())return this.TestTilemapOverlap(e,t);if(t.HasTilemap())return this.TestTilemapOverlap(t,e);if(!e.HasOwnCollisionPoly()&&!t.HasOwnCollisionPoly())return!0;const s=e.GetTransformedCollisionPoly(),n=t.GetTransformedCollisionPoly();return s.intersectsPoly(n,t.GetX()-e.GetX(),t.GetY()-e.GetY())}_TestOverlap_DifferentLayers(s,n){const e=s.HasTilemap(),t=n.HasTilemap();if(e&&!t)return this.TestTilemapOverlapDifferentLayers(s,n);if(t&&!e)return this.TestTilemapOverlapDifferentLayers(n,s);if(t||e)return!1;{const i=s.GetLayer(),r=n.GetLayer(),a=(tempPolyA.copy(s.GetTransformedCollisionPoly()),tempPolyB.copy(n.GetTransformedCollisionPoly()),tempPolyA.pointsArr());for(let e=0,t=a.length;e<t;e+=2){const l=e+1,h=a[e],c=a[l],[u,d]=i.LayerToCanvasCss(h+s.GetX(),c+s.GetY());a[e]=u,a[l]=d}const o=tempPolyB.pointsArr();for(let e=0,t=o.length;e<t;e+=2){const _=e+1,p=o[e],m=o[_],[g,f]=r.LayerToCanvasCss(p+n.GetX(),m+n.GetY());o[e]=g,o[_]=f}return tempPolyA.setBboxChanged(),tempPolyB.setBboxChanged(),this._polyCheckCount++,tempPolyA.intersectsPoly(tempPolyB,0,0)}}TestTilemapOverlapDifferentLayers(e,t){const s=e.GetLayer(),n=t.GetLayer(),i=(tempPolyC=tempPolyC||C33.New(C33.CollisionPoly),tempRect3=tempRect3||C33.New(C33.Rect),tempQuadB=tempQuadB||C33.New(C33.Quad),t.GetX()),r=t.GetY(),[a,o]=n.LayerToCanvasCss(i,r),[l,h]=s.CanvasCssToLayer(a,o),c=l-i,u=h-r;if(tempRect3.copy(t.GetBoundingBox()),tempRect3.offset(c,u),!e.GetBoundingBox().intersectsRect(tempRect3))return!1;if(tempQuadB.copy(t.GetBoundingQuad()),tempQuadB.offset(c,u),this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(tempQuadB))return!1;tempPolyC.copy(t.GetTransformedCollisionPoly());const d=tempPolyC.pointsArr();for(let e=0,t=d.length;e<t;e+=2){const _=e+1;d[e]+=c,d[_]+=u}return tempPolyC.setBboxChanged(),this.TestTilemapOverlap(e,t,l,h,tempPolyC,tempRect3,tempQuadB)}TestTilemapOverlap(e,n,t,s,i,r,a){const o=void 0!==r?r:n.GetBoundingBox(),l=e.GetX(),h=e.GetY(),c=e.GetInstance().GetSdkInstance(),u=void 0!==t?t:n.GetX(),d=void 0!==s?s:n.GetY(),_=n.HasOwnCollisionPoly(),p=void 0!==a?a:n.GetBoundingQuad(),m=tileCollRectCandidates;c.GetCollisionRectCandidates(o,m);for(let e=0,t=m.length;e<t;++e){const g=m[e],f=g.GetRect();if(this._collisionCheckCount++,o.intersectsRectOffset(f,l,h)&&(tempQuad.setFromRect(f),tempQuad.offset(l,h),tempQuad.intersectsQuad(p)))if(_){let e=void 0!==i?i:n.GetTransformedCollisionPoly(),t=u,s=d;void 0!==i&&(t=n.GetX(),s=n.GetY());const S=g.GetPoly();if(S){if(this._polyCheckCount++,S.intersectsPoly(e,t-(l+f.getLeft()),s-(h+f.getTop())))return C33.clearArray(m),!0}else if(tempPolyA.setFromQuad(tempQuad,0,0),tempPolyA.intersectsPoly(e,t,s))return C33.clearArray(m),!0}else{const y=g.GetPoly();if(!y)return C33.clearArray(m),!0;if(tempPolyA.setFromQuad(p,0,0),y.intersectsPoly(tempPolyA,-(l+f.getLeft()),-(h+f.getTop())))return C33.clearArray(m),!0}}return C33.clearArray(m),!1}TestAndSelectCanvasPointOverlap(e,o,l){const h=e.GetCurrentSol(),t=this._runtime.GetCurrentEvent();if(!t)throw new Error("cannot call outside event");const c=t.IsOrBlock(),s=new Map,u=e=>{let t=s.get(e);return void 0===t&&(t=e.IsSelfAndParentsInteractive(),s.set(e,t)),t};if(h.IsSelectAll()){l||(h._SetSelectAll(!1),C33.clearArray(h._GetOwnInstances())),c&&C33.clearArray(h._GetOwnElseInstances());for(const n of e.GetInstances()){let i=n.GetWorldInfo(),r=i.GetLayer();if(!(!u(r)||!i.IsInViewport2())&&o.some(([e,t])=>{const[s,n]=r.CanvasCssToLayer(e,t,i.GetTotalZElevation());return i.ContainsPoint(s,n)})){if(l)return!1;h._PushInstance(n)}else c&&h._PushElseInstance(n)}}else{let s,n=!1,a=(!c||t.IsFirstConditionOfType(this._runtime.GetCurrentCondition())||this._runtime.IsCurrentConditionFirst()&&!h._GetOwnElseInstances().length&&h._GetOwnInstances().length?s=h._GetOwnInstances():(s=h._GetOwnElseInstances(),n=!0),0);for(let t=0,e=s.length;t<e;++t){let e=s[t],i=e.GetWorldInfo(),r=i.GetLayer();if(!(!u(r)||!i.IsInViewport2())&&o.some(([e,t])=>{const[s,n]=r.CanvasCssToLayer(e,t,i.GetTotalZElevation());return i.ContainsPoint(s,n)})){if(l)return!1;n?h._PushInstance(e):s[a++]=e}else n?s[a++]=e:c&&h._PushElseInstance(e)}l||(s.length=a)}return e.ApplySolToContainer(),s.clear(),!!l||h.HasAnyInstances()}_ObjectClassCanUseCollisionCells(e,t){if(e)for(const s of t.layersHasInstancesOn())if(!e.IsTransformCompatibleWith(s))return!1;return!0}GetCollisionCandidates(e,t,s,n){if(t.IsFamily())for(const i of t.GetFamilyMembers())this._ObjectClassCanUseCollisionCells(e,i)?(i._UpdateAllCollisionCells(),i._GetCollisionCellGrid().QueryRange(s,n)):C33.appendArray(n,i.GetInstances());else this._ObjectClassCanUseCollisionCells(e,t)?(t._UpdateAllCollisionCells(),t._GetCollisionCellGrid().QueryRange(s,n)):C33.appendArray(n,t.GetInstances())}GetObjectClassesCollisionCandidates(e,t,s,n){for(const i of t)this.GetCollisionCandidates(e,i,s,n)}GetSolidCollisionCandidates(e,t,s){const n=this._runtime.GetSolidBehavior();n&&this.GetObjectClassesCollisionCandidates(e,n.GetObjectClasses(),t,s)}GetJumpthruCollisionCandidates(e,t,s){const n=this._runtime.GetJumpthruBehavior();n&&this.GetObjectClassesCollisionCandidates(e,n.GetObjectClasses(),t,s)}IsSolidCollisionAllowed(e,t){return e._IsSolidEnabled()&&(!t||t.GetWorldInfo().IsSolidCollisionAllowed(e.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(e){const t=e.GetWorldInfo();this.GetSolidCollisionCandidates(t.GetLayer(),t.GetBoundingBox(),tempCandidates);for(const s of tempCandidates)if(this.IsSolidCollisionAllowed(s,e)&&this.TestOverlap(e,s))return C33.clearArray(tempCandidates),s;return C33.clearArray(tempCandidates),null}TestRectOverlapSolid(e,t){this.GetSolidCollisionCandidates(null,e,tempCandidates);for(const s of tempCandidates)if(this.IsSolidCollisionAllowed(s,t)&&this.TestRectOverlap(e,s))return C33.clearArray(tempCandidates),s;return C33.clearArray(tempCandidates),null}TestOverlapJumpthru(e,t){let s=null;t&&(s=tempJumpthruRet,C33.clearArray(s));const n=e.GetWorldInfo();this.GetJumpthruCollisionCandidates(n.GetLayer(),n.GetBoundingBox(),tempCandidates);for(const i of tempCandidates)if(i._IsJumpthruEnabled()&&this.TestOverlap(e,i)){if(!t)return C33.clearArray(tempCandidates),i;s.push(i)}return C33.clearArray(tempCandidates),s}PushOut(t,s,n,i,r){i=i||50;const a=t.GetWorldInfo(),o=a.GetX(),l=a.GetY();for(let e=0;e<i;++e)if(a.SetXY(o+s*e,l+n*e),a.SetBboxChanged(),!this.TestOverlap(t,r))return!0;return a.SetXY(o,l),a.SetBboxChanged(),!1}PushOutSolid(t,s,n,i,r,a){i=i||50;let o=t.GetWorldInfo(),l=o.GetX(),h=o.GetY(),c=null,u=null;for(let e=0;e<i;++e)if(o.SetXY(l+s*e,h+n*e),o.SetBboxChanged(),!this.TestOverlap(t,c))if(c=this.TestOverlapSolid(t))u=c;else if(r&&(c=a?this.TestOverlap(t,a)?a:null:this.TestOverlapJumpthru(t))&&(u=c),!c)return u&&this.PushInFractional(t,s,n,u,16,!0),!0;return o.SetXY(l,h),o.SetBboxChanged(),!1}PushOutSolidAxis(s,n,i,e){e=e||50;let r=s.GetWorldInfo(),a=r.GetX(),o=r.GetY(),l=null,h=null;for(let t=0;t<e;++t)for(let e=0;e<2;++e){const c=2*e-1;if(r.SetXY(a+n*t*c,o+i*t*c),r.SetBboxChanged(),!this.TestOverlap(s,l)){if(!(l=this.TestOverlapSolid(s)))return h&&this.PushInFractional(s,n*c,i*c,h,16,!0),!0;h=l}}return r.SetXY(a,o),r.SetBboxChanged(),!1}PushInFractional(e,t,s,n,i,r){let a=2,o=!1,l=!1,h=e.GetWorldInfo(),c=h.GetX(),u=h.GetY();for(;a<=i;){const d=1/a;a*=2,h.OffsetXY(t*d*(o?1:-1),s*d*(o?1:-1)),h.SetBboxChanged(),this.TestOverlap(e,n)||r&&this.TestOverlapSolid(e)?(o=!0,l=!0):(o=!1,l=!1,c=h.GetX(),u=h.GetY())}l&&(h.SetXY(c,u),h.SetBboxChanged())}PushOutSolidNearest(s,e=100){let n=0,i=s.GetWorldInfo(),r=i.GetX(),a=i.GetY(),o=0,l=this.TestOverlapSolid(s);if(!l)return!0;for(;n<=e;){let e=0,t=0;switch(o){case 0:e=0,t=-1,n++;break;case 1:e=1,t=-1;break;case 2:e=1,t=0;break;case 3:e=1,t=1;break;case 4:e=0,t=1;break;case 5:e=-1,t=1;break;case 6:e=-1,t=0;break;case 7:e=-1,t=-1}if(o=(o+1)%8,i.SetXY(Math.floor(r+e*n),Math.floor(a+t*n)),i.SetBboxChanged(),!this.TestOverlap(s,l)&&!(l=this.TestOverlapSolid(s)))return!0}return i.SetXY(r,a),i.SetBboxChanged(),!1}CalculateBounceAngle(e,t,s,n){const i=e.GetWorldInfo(),r=i.GetX(),a=i.GetY(),o=Math.max(10,C33.distanceTo(t,s,r,a)),l=C33.angleTo(t,s,r,a),h=n||this.TestOverlapSolid(e);if(!h)return C33.clampAngle(l+Math.PI);let c=h,u=0,d=0,_=C33.toRadians(5),p;for(p=1;p<36;++p){const b=l-p*_;if(i.SetXY(t+Math.cos(b)*o,s+Math.sin(b)*o),i.SetBboxChanged(),!this.TestOverlap(e,c)&&!(c=n?null:this.TestOverlapSolid(e))){u=b;break}}for(36===p&&(u=C33.clampAngle(l+Math.PI)),c=h,p=1;p<36;++p){const A=l+p*_;if(i.SetXY(t+Math.cos(A)*o,s+Math.sin(A)*o),i.SetBboxChanged(),!this.TestOverlap(e,c)&&!(c=n?null:this.TestOverlapSolid(e))){d=A;break}}if(36===p&&(d=C33.clampAngle(l+Math.PI)),i.SetXY(r,a),i.SetBboxChanged(),d===u)return d;let m=C33.angleDiff(d,u)/2,g;g=C33.angleClockwise(d,u)?C33.clampAngle(u+m+Math.PI):C33.clampAngle(d+m);const f=Math.cos(l),S=Math.sin(l),y=Math.cos(g),C=Math.sin(g),G=f*y+S*C,T=f-2*G*y,I=S-2*G*C;return C33.angleTo(0,0,T,I)}TestSegmentOverlap(e,t,s,n,i){if(!i)return!1;const r=i.GetWorldInfo();if(!r.IsCollisionEnabled())return!1;if(this._collisionCheckCount++,tempRect.set(Math.min(e,s),Math.min(t,n),Math.max(e,s),Math.max(t,n)),!r.GetBoundingBox().intersectsRect(tempRect))return!1;if(i.HasTilemap())return this._TestSegmentOverlapTilemap(e,t,s,n,i,r);if(this._polyCheckCount++,!r.GetBoundingQuad().intersectsSegment(e,t,s,n))return!1;if(!r.HasOwnCollisionPoly())return!0;const a=r.GetTransformedCollisionPoly();return a.intersectsSegment(r.GetX(),r.GetY(),e,t,s,n)}_TestSegmentOverlapTilemap(s,n,i,r,e,t){const a=t.GetX(),o=t.GetY(),l=e.GetSdkInstance(),h=tileCollRectCandidates;tempRect2.set(s,n,i,r),tempRect2.normalize(),l.GetCollisionRectCandidates(tempRect2,h);for(let e=0,t=h.length;e<t;++e){const c=h[e],u=c.GetRect();if(this._collisionCheckCount++,tempRect.intersectsRectOffset(u,a,o)&&(tempQuad.setFromRect(u),tempQuad.offset(a,o),tempQuad.intersectsSegment(s,n,i,r))){const d=c.GetPoly();if(!d)return C33.clearArray(h),!0;if(this._polyCheckCount++,d.intersectsSegment(a+u.getLeft(),o+u.getTop(),s,n,i,r))return C33.clearArray(h),!0}}return C33.clearArray(h),!1}TestRectOverlap(e,t){if(!t)return!1;const s=t.GetWorldInfo();if(!s.IsCollisionEnabled())return!1;if(this._collisionCheckCount++,!s.GetBoundingBox().intersectsRect(e))return!1;if(t.HasTilemap())return this._TestRectOverlapTilemap(e,t,s);if(this._polyCheckCount++,tempQuad.setFromRect(e),!s.GetBoundingQuad().intersectsQuad(tempQuad))return!1;if(!s.HasOwnCollisionPoly())return!0;const n=tempPolyA,i=(n.setFromRect(e,s.GetX(),s.GetY()),s.GetTransformedCollisionPoly());return n.intersectsPoly(i,0,0)}_TestRectOverlapTilemap(s,e,t){const n=t.GetX(),i=t.GetY(),r=e.GetSdkInstance(),a=tileCollRectCandidates;r.GetCollisionRectCandidates(s,a);for(let e=0,t=a.length;e<t;++e){const o=a[e],l=o.GetRect();if(this._collisionCheckCount++,s.intersectsRectOffset(l,n,i)){const h=o.GetPoly();if(!h)return C33.clearArray(a),!0;if(this._polyCheckCount++,tempPolyA.setFromRect(s,0,0),h.intersectsPoly(tempPolyA,-(n+l.getLeft()),-(i+l.getTop())))return C33.clearArray(a),!0}}return C33.clearArray(a),!1}TestRayIntersectsInstance(e,t){if(e){const s=e.GetWorldInfo();s.IsCollisionEnabled()&&(this._collisionCheckCount++,s.GetBoundingBox().intersectsRect(t.rect))&&(e.HasTilemap()?this._TestRayIntersectsTilemap(e,s,t):(this._polyCheckCount++,s.HasOwnCollisionPoly()?t.TestInstancePoly(e,s.GetX(),s.GetY(),s.GetTransformedCollisionPoly()):t.TestInstanceQuad(e,s.GetBoundingQuad())))}}_TestRayIntersectsTilemap(s,n,i){const r=n.GetX(),a=n.GetY(),o=tileCollRectCandidates;s.GetSdkInstance().GetCollisionRectCandidates(i.rect,o);for(let e=0,t=o.length;e<t;e++){const l=o[e],h=l.GetRect();if(this._collisionCheckCount++,i.rect.intersectsRectOffset(h,r,a)){const c=l.GetPoly();this._polyCheckCount++,c?i.TestInstancePoly(s,r+h.getLeft(),a+h.getTop(),c):i.TestInstanceRect(s,n.GetX(),n.GetY(),h)}}C33.clearArray(o)}SetCollisionCellSize(e,t){if(e!==this._collisionCellWidth||t!==this._collisionCellHeight){this._collisionCellWidth=e,this._collisionCellHeight=t;const s=this._runtime.GetAllObjectClasses();for(const n of s)if(n.IsWorldType()){for(const i of n.instancesIncludingPendingCreate())i.GetWorldInfo()._RemoveFromCollisionCells();n._GetCollisionCellGrid().SetCellSize(e,t),n._SetAnyCollisionCellChanged();for(const r of n.instancesIncludingPendingCreate()){const a=r.GetWorldInfo();a._SetCollisionCellChanged(),a._UpdateCollisionCell()}}}}GetCollisionCellSize(){return[this._collisionCellWidth,this._collisionCellHeight]}_InitCollisionCellSize(e,t){this._collisionCellWidth=e,this._collisionCellHeight=t}}}{const C33=self.C3;C33.SparseGrid=class extends C33.DefendedBase{constructor(e,t){super(),this._cellWidth=e,this._cellHeight=t,this._cells=C33.New(C33.PairMap)}Release(){this._cells.Release(),this._cells=null}SetCellSize(e,t){if(!this._cells.IsEmpty())throw new Error("grid not empty");this._cellWidth=e,this._cellHeight=t}GetCell(e,t,s){let n=this._cells.Get(e,t);return n||(s?(n=C33.New(C33.GridCell,this,e,t),this._cells.Set(e,t,n),n):null)}XToCell(e){const t=Math.floor(e/this._cellWidth);return isFinite(t)?t:0}YToCell(e){const t=Math.floor(e/this._cellHeight);return isFinite(t)?t:0}Update(n,i,r){if(i)for(let s=i.getLeft(),e=i.getRight();s<=e;++s)for(let e=i.getTop(),t=i.getBottom();e<=t;++e)if(!r||!r.containsPoint(s,e)){const a=this.GetCell(s,e,!1);a&&(a.Remove(n),a.IsEmpty())&&this._cells.Delete(s,e)}if(r)for(let s=r.getLeft(),e=r.getRight();s<=e;++s)for(let e=r.getTop(),t=r.getBottom();e<=t;++e)i&&i.containsPoint(s,e)||this.GetCell(s,e,!0).Insert(n)}QueryRange(e,t){let s=this.XToCell(e.getLeft()),n=this.YToCell(e.getTop()),i=this.XToCell(e.getRight()),r=this.YToCell(e.getBottom());if(isFinite(i)&&isFinite(r))for(;s<=i;++s)for(let e=n;e<=r;++e){const a=this.GetCell(s,e,!1);a&&a.Dump(t)}}}}{const C33=self.C3;C33.GridCell=class extends C33.DefendedBase{constructor(e,t,s){super(),this._grid=e,this._x=t,this._y=s,this._instances=C33.New(C33.ArraySet)}Release(){this._instances.Release(),this._instances=null,this._grid=null}IsEmpty(){return this._instances.IsEmpty()}Insert(e){this._instances.Add(e)}Remove(e){this._instances.Delete(e)}Dump(e){C33.appendArray(e,this._instances.GetArray())}}}{const C33=self.C3,PADDING=1e-6,NO_HIT=2;C33.Ray=class{constructor(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.dx=0,this.dy=0,this.rect=new C33.Rect,this.hitFraction=NO_HIT,this.hitUid=null,this.hitNormal=0,this.hitNormalDx=0,this.hitNormalDy=0,this.hitX=0,this.hitY=0,this.distance=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0}DidCollide(){return this.hitFraction<1+PADDING}Reset(){this.hitFraction=NO_HIT}Set(e,t,s,n){return this.x1=e,this.y1=t,this.x2=s,this.y2=n,this.dx=s-e,this.dy=n-t,this.rect.set(e,t,s,n),this.rect.normalize(),this.hitFraction=NO_HIT,this.hitUid=null,this.hitNormal=0,this.hitNormalDx=0,this.hitNormalDy=0,this.hitX=0,this.hitY=0,this.distance=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0,this}Complete(){if(!1!==this.DidCollide()){const e=this.dx*this.hitFraction,t=this.dy*this.hitFraction,s=Math.hypot(e,t),n=e/s,i=t/s,r=(this.distance=s-PADDING,this.hitX=this.x1+n*this.distance,this.hitY=this.y1+i*this.distance,this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2,this.normalX=Math.cos(this.hitNormal),this.normalY=Math.sin(this.hitNormal),n*this.normalX+i*this.normalY);if(this.reflectionX=n-2*this.normalX*r,this.reflectionY=i-2*this.normalY*r,0<r){const a=Math.PI;this.hitNormal=C33.clampAngle(this.hitNormal+a),this.normalX=-this.normalX,this.normalY=-this.normalY}}}TestInstanceSegment(e,t,s,n,i){const r=C33.rayIntersect(this.x1,this.y1,this.x2,this.y2,t,s,n,i);0<=r&&r<this.hitFraction&&(this.hitFraction=r,this.hitUid=e.GetUID(),this.hitNormalDx=t-n,this.hitNormalDy=s-i)}TestInstanceRect(e,t,s,n){const i=t+n.getLeft(),r=t+n.getRight(),a=s+n.getTop(),o=s+n.getBottom();this.TestInstanceSegment(e,i,a,r,a),this.TestInstanceSegment(e,r,a,r,o),this.TestInstanceSegment(e,r,o,i,o),this.TestInstanceSegment(e,i,o,i,a)}TestInstanceQuad(e,t){const s=t.getTlx(),n=t.getTly(),i=t.getTrx(),r=t.getTry(),a=t.getBrx(),o=t.getBry(),l=t.getBlx(),h=t.getBly();this.TestInstanceSegment(e,s,n,i,r),this.TestInstanceSegment(e,i,r,a,o),this.TestInstanceSegment(e,a,o,l,h),this.TestInstanceSegment(e,l,h,s,n)}TestInstancePoly(s,n,i,e){const r=e.pointsArr();for(let e=0,t=r.length;e<t;e+=2){const a=(e+2)%t,o=r[e]+n,l=r[e+1]+i,h=r[a]+n,c=r[1+a]+i;this.TestInstanceSegment(s,o,l,h,c)}}}}{const C33=self.C3,VALID_FULLSCREEN_MODES=new Set(["off","crop","scale-inner","scale-outer","letterbox-scale","letterbox-integer-scale"]),VALID_FULLSCREEN_SCALING_QUALITIES=new Set(["high","low"]),glMatrix=self.glMatrix,mat42=glMatrix.mat4,vec32=glMatrix.vec3,tempProjection=mat42.create(),PERCENTTEXT_WIDTH=300,PERCENTTEXT_HEIGHT=200,PROGRESSBAR_WIDTH=120,PROGRESSBAR_HEIGHT=8,tempQuad=C33.New(C33.Quad),tempRect=C33.New(C33.Rect),SPLASH_MIN_DISPLAY_TIME=3e3,SPLASH_AFTER_FADEOUT_WAIT_TIME=200,SPLASH_FADE_DURATION=300;C33.CanvasManager=class extends C33.DefendedBase{constructor(e){super(),this._runtime=e,this._canvasLayers=[],this._isWebGPUEnabled=!1,this._webglRenderer=null,this._webgpuRenderer=null,this._iRenderer=null,this._gpuPreference="high-performance",this._isLimitedToWebGL1=!1,this._windowInnerWidth=0,this._windowInnerHeight=0,this._cssDisplayMode="",this._canvasCssWidth=0,this._canvasCssHeight=0,this._canvasDeviceWidth=0,this._canvasDeviceHeight=0,this._canvasCssOffsetX=0,this._canvasCssOffsetY=0,this._zAxisScale="normalized",this._initFieldOfView=0,this._zNear=1,this._zFar=1e4,this._enableMipmaps=!0,this._textureAnisotropy=0,this._drawWidth=0,this._drawHeight=0,this._fullscreenMode="letterbox-scale",this._documentFullscreenMode="letterbox-scale",this._deviceTransformOffX=0,this._deviceTransformOffY=0,this._defaultProjectionMatrix=mat42.create(),this._wantFullscreenScalingQuality="high",this._fullscreenScalingQuality=this._wantFullscreenScalingQuality,this._isDocumentFullscreen=!1,this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets=new Set,this._shaderData=self.C3_Shaders,this._effectChainManager=C33.New(C33.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:e=>this.ReleaseEffectCompositorRenderTarget(e),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()}),this._gpuTimeStartFrame=0,this._gpuTimeEndFrame=0,this._gpuLastUtilisation=NaN,this._gpuFrameTimingsBuffer=null,this._layersGpuProfile=new Map,this._gpuCurUtilisation=NaN,this._webgpuFrameTimings=new Map,this._snapshotFormat="",this._snapshotQuality=1,this._snapshotArea=C33.New(C33.Rect),this._snapshotUrl="",this._snapshotPromise=null,this._snapshotResolve=null,this._isPastingToDrawingCanvas=0,this._loaderStartTime=0,this._rafId=-1,this._loadingProgress=0,this._loadingprogress_handler=e=>this._loadingProgress=e.progress,this._percentText=null,this._splashTextures={logo:null,powered:null,website:null},this._splashFrameNumber=0,this._splashFadeInFinishTime=0,this._splashFadeOutStartTime=0,this._splashState="fade-in",this._splashDoneResolve=null,this._splashDonePromise=new Promise(e=>this._splashDoneResolve=e)}_SetGPUPowerPreference(e){this._gpuPreference=e}_SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e}_SetZAxisScale(e){this._zAxisScale=e}GetZAxisScale(){return this._zAxisScale}_SetInitFieldOfView(e){this._initFieldOfView=e}_SetZDistances(e,t){this._zNear=e,this._zFar=t}_SetLimitedToWebGL1(e){this._isLimitedToWebGL1=!!e}async CreateCanvas(e){let t=e.canvas,s=(this._canvasLayers.push({canvas:t,ctx:null}),this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",e=>this._OnWindowResize(e)),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",e=>this._OnFullscreenChange(e)),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",e=>this._OnFullscreenError(e)),t.addEventListener("webglcontextlost",e=>this._OnWebGLContextLost(e)),t.addEventListener("webglcontextrestored",e=>this._OnWebGLContextRestored(e)),this._isDocumentFullscreen=!!e.isFullscreen,this._cssDisplayMode=e.cssDisplayMode,navigator.gpu&&this._isWebGPUEnabled),n=!1;if(s)try{await this._InitWebGPUContext(!0)}catch(e){this._MaybeLogRendererError("WebGPU",e),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!0)}catch(e){this._MaybeLogRendererError("WebGL",e),this._webglRenderer=null}if(this.GetRenderer()||(n=!0),!this.GetRenderer()&&s)try{await this._InitWebGPUContext(!1)}catch(e){this._MaybeLogRendererError("WebGPU",e),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!1)}catch(e){this._MaybeLogRendererError("WebGL",e),this._webglRenderer=null}const i=this.GetRenderer();if(!i)throw new Error("failed to acquire a renderer - check WebGL or WebGPU is supported");i.SetHasMajorPerformanceCaveat(n),this._webgpuRenderer&&(this._webgpuRenderer.ondevicelost=()=>this._OnWebGPUDeviceLost(),this._webgpuRenderer.ondevicerestored=()=>this._OnWebGPUDeviceRestored()),"normalized"===this._zAxisScale?i.SetZAxisScaleNormalized():(i.SetZAxisScaleRegular(),i.SetFovY(this._initFieldOfView)),this.SetSize(e.windowInnerWidth,e.windowInnerHeight,!0),await this._InitRenderer()}_MaybeLogRendererError(e,t){t&&"string"==typeof t.message&&t.message.startsWith("renderer-unavailable")||console.error(`Error creating ${e} renderer: `,t)}async _InitWebGPUContext(e){const t={nearZ:this._zNear,farZ:this._zFar},s={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:e,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),canSampleDepth:this._runtime.UsesAnyDepthSampling()};this._webgpuRenderer=C33.New(C33.Gfx.WebGPURenderer,t),await this._webgpuRenderer.Create(this._canvasLayers[0].canvas,s)}async _InitWebGLContext(e){const t={alpha:!0,powerPreference:this._gpuPreference,enableGpuProfiling:"xbox-uwp-webview2"!==this._runtime.GetExportType(),depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:e,nearZ:this._zNear,farZ:this._zFar};this._isLimitedToWebGL1&&(t.maxWebGLVersion=1),this._webglRenderer=C33.New(C33.Gfx.WebGLRenderer,this._canvasLayers[0].canvas,t),await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){const e=[];for(const[t,s]of Object.entries(this._shaderData)){s.src=s.wgsl;const n=C33.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();e.push(this._webgpuRenderer.CreateShaderProgram(Object.assign({vertexSrc:n,name:t},s)))}await Promise.all(e)}}async _InitWebGL(){if(this._shaderData){const t=[];for(const[s,n]of Object.entries(this._shaderData)){let e;if(n.glslWebGL2&&2<=this._webglRenderer.GetWebGLVersionNumber())n.src=n.glslWebGL2,e=C33.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();else{if(!n.glsl)throw new Error(`shader '${s}' does not support WebGL 1`);n.src=n.glsl,e=C33.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource()}t.push(this._webglRenderer.CreateShaderProgram(Object.assign({vertexSrc:e,name:s},n)))}await Promise.all(t),this._webglRenderer.ResetLastProgram(),this._webglRenderer.SetTextureFillMode()}this._webglRenderer.SupportsGPUProfiling()&&(this._gpuFrameTimingsBuffer=C33.New(C33.Gfx.WebGLQueryResultBuffer,this._webglRenderer))}async _InitRenderer(){this._webgpuRenderer?await this._InitWebGPU():this._webglRenderer&&await this._InitWebGL();const e=this.GetRenderer();e.SetMipmapsEnabled(this._enableMipmaps),e.SupportsGPUProfiling()&&(this._gpuLastUtilisation=0);for(const t of this._runtime._GetAllEffectLists()){for(const s of t.GetAllEffectTypes())s._InitRenderer(e);t._InitRenderer(e),t.UpdateActiveEffects()}this._iRenderer=new self.IRenderer(this._runtime,e)}Release(){this._runtime=null,this._webglRenderer=null,this._canvasLayers.length=0}IsInWorker(){return this._runtime.IsInWorker()}_OnWindowResize(e){const t=this._runtime;if(!t.IsExportToVideo()){const s=e.devicePixelRatio,n=(this.IsInWorker()&&(self.devicePixelRatio=s),t._SetDevicePixelRatio(s),this._isDocumentFullscreen=!!e.isFullscreen,this._cssDisplayMode=e.cssDisplayMode,this.SetSize(e.innerWidth,e.innerHeight),t.UpdateRender(),new C33.Event("window-resize")),i=(n.data=e,t.Dispatcher().dispatchEventAndWaitAsyncSequential(n),new C33.Event("resize"));i.cssWidth=this.GetCssWidth(),i.cssHeight=this.GetCssHeight(),i.deviceWidth=this.GetDeviceWidth(),i.deviceHeight=this.GetDeviceHeight(),t.DispatchUserScriptEvent(i),t.IsDebug()&&(t.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused())&&t.Render()}}_OnFullscreenChange(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}_OnFullscreenError(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}SetSize(e,t,s=!1){if(e=Math.floor(e),t=Math.floor(t),e<=0||t<=0)throw new Error("invalid size");if(this._windowInnerWidth!==e||this._windowInnerHeight!==t||s){this._windowInnerWidth=e,this._windowInnerHeight=t;const n=this.GetCurrentFullscreenMode();"letterbox-scale"===n?this._CalculateLetterboxScale(e,t):"letterbox-integer-scale"===n?this._CalculateLetterboxIntegerScale(e,t):"off"===n?this._CalculateFixedSizeCanvas(e,t):this._CalculateFullsizeCanvas(e,t),this._UpdateFullscreenScalingQuality(n);for(const{canvas:a}of this._canvasLayers)a.width=this._canvasDeviceWidth,a.height=this._canvasDeviceHeight;this._runtime.PostComponentMessageToDOM("canvas","update-size",{marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight,displayScale:this.GetDisplayScale()});const i=this.GetRenderer();i.SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,!0);for(const o of this._availableAdditionalRenderTargets)i.DeleteRenderTarget(o);C33.clearArray(this._availableAdditionalRenderTargets),this.UpdateDefaultProjectionMatrix();const r=this._runtime.GetLayoutManager();r.SetAllLayerProjectionChanged(),r.SetAllLayerMVChanged()}}UpdateDefaultProjectionMatrix(){this.GetRenderer().CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight())}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(e,t){const s=this._runtime.GetDevicePixelRatio(),n=this._runtime.GetOriginalViewportWidth(),i=this._runtime.GetOriginalViewportHeight(),r=n/i,a=e/t;if(r<a){const o=t*r;this._canvasCssWidth=Math.round(o),this._canvasCssHeight=t,this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=0}else{const l=e/r;this._canvasCssWidth=e,this._canvasCssHeight=Math.round(l),this._canvasCssOffsetX=0,this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)}this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._runtime.SetViewportSize(n,i)}_CalculateLetterboxIntegerScale(e,t){let s=this._runtime.GetDevicePixelRatio(),n=(1!==s&&(e+=1,t+=1),this._runtime.GetOriginalViewportWidth()),i=this._runtime.GetOriginalViewportHeight(),r=n/i,a=e/t,o;if(r<a){const l=t*r;o=l*s/n}else{const h=e/r;o=h*s/i}1<o?o=Math.floor(o):o<1&&(o=1/Math.ceil(1/o)),this._canvasDeviceWidth=Math.round(n*o),this._canvasDeviceHeight=Math.round(i*o),this._canvasCssWidth=this._canvasDeviceWidth/s,this._canvasCssHeight=this._canvasDeviceHeight/s,this._canvasCssOffsetX=Math.max(Math.floor((e-this._canvasCssWidth)/2),0),this._canvasCssOffsetY=Math.max(Math.floor((t-this._canvasCssHeight)/2),0),this._runtime.SetViewportSize(n,i)}_CalculateFullsizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio(),n=(this._canvasCssWidth=e,this._canvasCssHeight=t,this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._canvasCssOffsetX=0,this._canvasCssOffsetY=0,this.GetDisplayScale());this._runtime.SetViewportSize(this._canvasCssWidth/n,this._canvasCssHeight/n)}_CalculateFixedSizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth(),this._canvasCssHeight=this._runtime.GetViewportHeight(),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this.IsDocumentFullscreen()?(this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)):(this._canvasCssOffsetX=0,this._canvasCssOffsetY=0),this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(s){if("high"===this._wantFullscreenScalingQuality)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else{let e,t;if(t="off"===this.GetCurrentFullscreenMode()?(e=this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight()):(e=this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight()),this._canvasDeviceWidth<e||this._canvasDeviceHeight<t)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else if(this._drawWidth=e,this._drawHeight=t,this._fullscreenScalingQuality="low","scale-inner"===s){const n=e/t,i=this._windowInnerWidth/this._windowInnerHeight;i<n?this._drawWidth=this._drawHeight*i:n<i&&(this._drawHeight=this._drawWidth/i)}else if("scale-outer"===s){const r=e/t,a=this._windowInnerWidth/this._windowInnerHeight;r<a?this._drawWidth=this._drawHeight*a:a<r&&(this._drawHeight=this._drawWidth/a)}}}GetRuntime(){return this._runtime}GetMainCanvas(){return this._canvasLayers[0].canvas}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}GetCssDisplayMode(){return this._cssDisplayMode}SetFullscreenMode(e){if(!VALID_FULLSCREEN_MODES.has(e))throw new Error("invalid fullscreen mode");this._fullscreenMode=e;const t=this._runtime.GetLayoutManager();t.SetAllLayerProjectionChanged(),t.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(e){if(!VALID_FULLSCREEN_MODES.has(e))throw new Error("invalid fullscreen mode");this._documentFullscreenMode=e;const t=this._runtime.GetLayoutManager();t.SetAllLayerProjectionChanged(),t.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){return this.IsDocumentFullscreen()?this.GetDocumentFullscreenMode():this.GetFullscreenMode()}SetFullscreenScalingQuality(e){if(!VALID_FULLSCREEN_SCALING_QUALITIES.has(e))throw new Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=e,this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(e){switch(e){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw new Error("invalid fullscreen mode")}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(e){this._enableMipmaps=!!e}_SetTextureAnisotropy(e){this._textureAnisotropy=e}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(e){console.log("[Construct] WebGL context lost"),e.preventDefault(),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._webglRenderer.OnContextLost(),this._runtime._OnRendererContextLost()}_OnWebGPUDeviceLost(){console.log("[Construct] WebGPU device lost"),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._runtime._OnRendererContextLost()}async _OnWebGLContextRestored(e){await this._webglRenderer.OnContextRestored(),await this._InitRenderer(),await this._runtime._OnRendererContextRestored(),console.log("[Construct] WebGL context restored")}async _OnWebGPUDeviceRestored(){await this._InitRenderer(),await this._runtime._OnRendererContextRestored(),console.log("[Construct] WebGPU device restored")}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetIRenderer(){return this._iRenderer}GetRendererString(){let e="";return e=this._runtime.GetWebGPURenderer()?"webgpu":"webgl"+this._runtime.GetWebGLRenderer().GetWebGLVersionNumber(),this._runtime.GetRenderer().HasMajorPerformanceCaveat()&&(e+="-software"),e}GetRendererDetailString(){return this._runtime.GetWebGPURenderer()?this._runtime.GetWebGPURenderer().GetAdapterInfoString():this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()}GetRenderScale(){return"low"===this._fullscreenScalingQuality?1/this._runtime.GetDevicePixelRatio():this.GetDisplayScale()}GetDisplayScale(){const e=this.GetCurrentFullscreenMode();if("off"===e||"crop"===e)return 1;const t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight(),n=t/s,i=this._canvasDeviceWidth/this._canvasDeviceHeight;return"scale-inner"!==e&&n<i||"scale-inner"===e&&i<n?this._canvasCssHeight/s:this._canvasCssWidth/t}GetEffectLayerScaleParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(e,t){this._deviceTransformOffX=e,this._deviceTransformOffY=t}SetDeviceTransform(t,s,n,e=!0){s=s||this._drawWidth,n=n||this._drawHeight;const i=s/2+this._deviceTransformOffX,r=n/2+this._deviceTransformOffY;if(e){let e=this.GetDefaultProjectionMatrix();s===this._drawWidth&&n===this._drawHeight||(t.CalculatePerspectiveMatrix(tempProjection,s/n),e=tempProjection),t.SetProjectionMatrix(e)}const a=t.CalculateLookAtModelView2(i,r,t.GetDefaultCameraZ(n),i,r,0,n);t.SetModelViewMatrix(a)}SetCssTransform(e,t=!0){const s=this.GetCssWidth(),n=this.GetCssHeight(),i=s/2,r=n/2,a=(t&&e.SetProjectionMatrix(this.GetDefaultProjectionMatrix()),e.CalculateLookAtModelView2(i,r,e.GetDefaultCameraZ(n),i,r,0,n));e.SetModelViewMatrix(a)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetHTMLLayerCount(){return this._canvasLayers.length}_CanUseImageBitmapRenderingContext(){return"undefined"!=typeof OffscreenCanvas&&this.GetMainCanvas()instanceof OffscreenCanvas&&("Chromium"!==C33.Platform.BrowserEngine||124<=C33.Platform.BrowserVersionNumber)}async SetHTMLLayerCount(n,i=!1){if(n<1)throw new Error("invalid HTML layer count");if(this._canvasLayers.length!==n){let e=this._runtime.GetLayoutManager().GetMainRunningLayout(),t={count:n,layersDomState:e._GetRootLayers().filter(e=>e.IsHTMLElementsLayer()).map(e=>e._GetHTMLLayerDOMState()),immediate:i,marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight},s;if(s=this.IsInWorker()?await this._runtime.PostComponentMessageToDOMAsync("canvas","set-html-layer-count",t):self.c3_runtimeInterface._OnSetHTMLLayerCount(t),n<this._canvasLayers.length)this._canvasLayers.length=n;else for(const r of s.addedCanvases){r.width=this._canvasDeviceWidth,r.height=this._canvasDeviceHeight;const a=this._CanUseImageBitmapRenderingContext()?"bitmaprenderer":"2d",o=r.getContext(a);if(!o)throw new Error(`failed to acquire '${a}' canvas context`);this._canvasLayers.push({canvas:r,ctx:o})}this._runtime.UpdateRender()}}BlitMainCanvasToHTMLLayerCanvas(e){if(!(e>=this._canvasLayers.length)){const t=this.GetMainCanvas(),s=this._canvasLayers[e].ctx;this._CanUseImageBitmapRenderingContext()?s.transferFromImageBitmap(t.transferToImageBitmap()):(s.globalCompositeOperation="copy",s.drawImage(t,0,0))}}GetAdditionalRenderTarget(t){t.depth=this._runtime.Uses3DFeatures();let e=this._availableAdditionalRenderTargets,s=e.findIndex(e=>e.IsCompatibleWithOptions(t)),n;return-1!==s?(n=e[s],e.splice(s,1)):n=this.GetRenderer().CreateRenderTarget(t),this._usedAdditionalRenderTargets.add(n),n}ReleaseAdditionalRenderTarget(e){if(!this._usedAdditionalRenderTargets.has(e))throw new Error("render target not in use");this._usedAdditionalRenderTargets.delete(e),this._availableAdditionalRenderTargets.push(e)}GetEffectCompositorRenderTarget(){const e={sampling:this._runtime.GetSampling()};return"low"===this.GetCurrentFullscreenScalingQuality()&&(e.width=this.GetDrawWidth(),e.height=this.GetDrawHeight()),this.GetAdditionalRenderTarget(e)}ReleaseEffectCompositorRenderTarget(e){this.ReleaseAdditionalRenderTarget(e)}*activeLayersGpuProfiles(){for(const e of this._runtime.GetLayoutManager().runningLayouts())for(const t of e.GetLayers()){const s=this._layersGpuProfile.get(t);s&&(yield s)}}GetLayerTimingsBuffer(e){if(!this.GetRenderer().SupportsGPUProfiling())return null;let t=this._layersGpuProfile.get(e);return t||(t={layer:e,name:e.GetName(),timingsBuffer:C33.New(C33.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastTotalUtilisation:0,lastSelfUtilisation:0},this._layersGpuProfile.set(e,t)),t.timingsBuffer}_Update1sFrameRange(){const e=this.GetRenderer();if(e.SupportsGPUProfiling()&&0===this._gpuTimeEndFrame){this._gpuTimeEndFrame=e.GetFrameNumber(),this._gpuCurUtilisation=NaN;for(const t of this.activeLayersGpuProfiles())t.curUtilisation=NaN}}_UpdateTick(){this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGL(),this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(isNaN(this._gpuCurUtilisation)&&(this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),!isNaN(this._gpuCurUtilisation))){if(this._runtime.IsDebug())for(const e of this.activeLayersGpuProfiles())if(e.curUtilisation=e.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),isNaN(e.curUtilisation))return;if(this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1),this._runtime.IsDebug()){const s=new Map;for(const i of this.activeLayersGpuProfiles())i.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),i.lastTotalUtilisation=Math.min(i.curUtilisation,1),s.set(i.layer,i.lastTotalUtilisation);for(const r of this.activeLayersGpuProfiles()){const a=r.layer,o=s.get(a)||0,l=o-a.GetSubLayers().reduce((e,t)=>e+(s.get(t)||0),0);r.lastSelfUtilisation=C33.clamp(l,0,1)}const t=this._runtime.GetMainRunningLayout(),n=this._gpuLastUtilisation-t._GetRootLayers().reduce((e,t)=>e+(s.get(t)||0),0);self.C3Debugger.UpdateGPUProfile(C33.clamp(n,0,1),this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(0!==this._gpuTimeEndFrame){for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){const s=this._webgpuFrameTimings.get(e);if(s&&!s.HasResult())return}let e=this._runtime.GetMainRunningLayout(),a=C33.MakeFilledArray(e.GetLayerCount()+1,0),t=0;for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){const o=this._webgpuFrameTimings.get(e);if(o){let s=o.GetResult(),n=BigInt(0),i=BigInt(0),r=BigInt(0);for(let e=0,t=Math.min(a.length,s.length/2);e<t;++e){const c=s[2*e],u=s[2*e+1],d=(c!==r&&(n===r||c<n)&&(n=c),u>i&&(i=u),u-c),_=Number(d)/1e9;a[e]+=_}const l=i-n,h=Number(l)/1e9;t+=h}}if(this._gpuLastUtilisation=C33.clamp(t,0,1),this._runtime.IsDebug()){const n=e.GetLayers(),i=new Map;for(let e=0,t=Math.min(n.length,a.length-1);e<t;++e){const g=a[e+1];i.set(n[e],g)}const r=[],p=new Map;for(const[f,S]of i){const y=[...f.selfAndAllSubLayers()].reduce((e,t)=>e+(i.get(t)||0),0);p.set(f,y),r.push({name:f.GetName(),lastSelfUtilisation:C33.clamp(S,0,1),lastTotalUtilisation:C33.clamp(y,0,1)})}const m=this._gpuLastUtilisation-e._GetRootLayers().reduce((e,t)=>e+(p.get(t)||0),0);self.C3Debugger.UpdateGPUProfile(C33.clamp(m,0,1),this._gpuLastUtilisation,r)}for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e)this._webgpuFrameTimings.delete(e);this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}_AddWebGPUFrameTiming(e){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),e)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(e,t,s,n,i,r){return this._snapshotFormat=e,this._snapshotQuality=t,this._snapshotArea.setWH(s,n,i,r),this._snapshotPromise||(this._snapshotPromise=new Promise(e=>{this._snapshotResolve=e})),this._snapshotPromise}_MaybeTakeSnapshot(){if(this._snapshotFormat){let e=this.GetMainCanvas(),t=this._snapshotArea,s=C33.clamp(Math.floor(t.getLeft()),0,e.width),n=C33.clamp(Math.floor(t.getTop()),0,e.height),i=t.width(),r=(i=0===i?e.width-s:C33.clamp(Math.floor(i),0,e.width-s),t.height());if(r=0===r?e.height-n:C33.clamp(Math.floor(r),0,e.height-n),(0!==s||0!==n||i!==e.width||r!==e.height)&&0<i&&0<r){const a=C33.CreateCanvas(i,r),o=a.getContext("2d");o.drawImage(e,s,n,i,r,0,0,i,r),e=a}C33.CanvasToBlob(e,this._snapshotFormat,this._snapshotQuality).then(e=>{this._snapshotUrl&&URL.revokeObjectURL(this._snapshotUrl),this._snapshotUrl=URL.createObjectURL(e),this._snapshotPromise=null,this._snapshotResolve(this._snapshotUrl)}),this._snapshotFormat="",this._snapshotQuality=1}}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(e){e?this._isPastingToDrawingCanvas++:this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return 0<this._isPastingToDrawingCanvas}InitLoadingScreen(e){const t=this.GetRenderer();if(2===e)this._percentText=C33.New(C33.Gfx.RendererText,this.GetRenderer()),this._percentText.SetFontName("Arial"),this._percentText.SetFontSize(16),this._percentText.SetHorizontalAlignment("center"),this._percentText.SetVerticalAlignment("center"),this._percentText.SetSize(PERCENTTEXT_WIDTH,PERCENTTEXT_HEIGHT);else if(0===e){const s=this._runtime.GetLoadingLogoAsset();s&&s.LoadStaticTexture(t).catch(e=>console.warn("[C3 runtime] Failed to create texture for loading logo: ",e))}else 4===e&&(this._LoadSvgSplashImage("splash-images/splash-logo.svg").then(e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.logo=e}).catch(e=>console.warn("Failed to load splash image: ",e)),this._LoadBitmapSplashImage("splash-images/splash-poweredby-512.png").then(e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.powered=e}).catch(e=>console.warn("Failed to load splash image: ",e)),this._LoadBitmapSplashImage("splash-images/splash-website-512.png").then(e=>{"done"===this._splashState?t.DeleteTexture(e):this._splashTextures.website=e}).catch(e=>console.warn("Failed to load splash image: ",e)))}async _LoadSvgSplashImage(e){e=new URL(e,this._runtime.GetRuntimeBaseURL()).toString();const t=await C33.FetchBlob(e),s=await this._runtime.RasterSvgImage(t,2048,2048);return this.GetRenderer().CreateStaticTextureAsync(s,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(e){e=new URL(e,this._runtime.GetRuntimeBaseURL()).toString();const t=await C33.FetchBlob(e);return this.GetRenderer().CreateStaticTextureAsync(t,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now(),this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler),this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen());const e=this._runtime.GetLoaderStyle();3!==e&&this.HideCordovaSplashScreen()}async EndLoadingScreen(){const e=this.GetRenderer(),t=(this._loadingProgress=1,this._runtime.GetLoaderStyle());4===t&&await this._splashDonePromise,this._splashDoneResolve=null,this._splashDonePromise=null,-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1),this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler),this._loadingprogress_handler=null,this._percentText&&(this._percentText.Release(),this._percentText=null),this._runtime.ReleaseLoadingLogoAsset(),e.Start(),this._splashTextures.logo&&(e.DeleteTexture(this._splashTextures.logo),this._splashTextures.logo=null),this._splashTextures.powered&&(e.DeleteTexture(this._splashTextures.powered),this._splashTextures.powered=null),this._splashTextures.website&&(e.DeleteTexture(this._splashTextures.website),this._splashTextures.website=null),e.ClearRgba(0,0,0,0),e.Finish(),this._splashState="done",this._gpuTimeStartFrame=e.GetFrameNumber(),3===t&&this.HideCordovaSplashScreen()}_DrawLoadingScreen(){if(-1!==this._rafId){const e=this.GetRenderer(),t=(e.Start(),this._rafId=-1,this._runtime.GetAssetManager().HasHadErrorLoading()),s=this._runtime.GetLoaderStyle();if(3!==s&&(this.SetCssTransform(e),e.ClearRgba(0,0,0,0),e.ResetColor(),e.SetTextureFillMode(),e.SetTexture(null)),0===s)this._DrawProgressBarAndLogoLoadingScreen(t);else if(1===s)this._DrawProgressBarLoadingScreen(t,PROGRESSBAR_WIDTH,0);else if(2===s)this._DrawPercentTextLoadingScreen(t);else if(3===s)C33.noop();else{if(4!==s)throw new Error("invalid loader style");this._DrawSplashLoadingScreen(t)}e.Finish(),this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen())}}_DrawPercentTextLoadingScreen(e){e?this._percentText.SetColorRgb(1,0,0):this._percentText.SetColorRgb(.6,.6,.6),this._percentText.SetText(Math.round(100*this._loadingProgress)+"%");const t=this._canvasCssWidth/2,s=this._canvasCssHeight/2,n=PERCENTTEXT_WIDTH/2,i=PERCENTTEXT_HEIGHT/2,r=(tempQuad.setRect(t-n,s-i,t+n,s+i),this.GetRenderer());r.SetTexture(this._percentText.GetTexture()),r.Quad3(tempQuad,this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(e,t,s){const n=this.GetRenderer(),i=PROGRESSBAR_HEIGHT,r=(n.SetColorFillMode(),e?n.SetColorRgba(1,0,0,1):n.SetColorRgba(.118,.565,1,1),this._canvasCssWidth/2),a=this._canvasCssHeight/2,o=t/2,l=i/2;tempRect.setWH(r-o,a-l+s,Math.floor(t*this._loadingProgress),i),n.Rect(tempRect),tempRect.setWH(r-o,a-l+s,t,i),tempRect.offset(-.5,-.5),tempRect.inflate(.5,.5),n.SetColorRgba(0,0,0,1),n.LineRect2(tempRect),tempRect.inflate(1,1),n.SetColorRgba(1,1,1,1),n.LineRect2(tempRect)}_DrawProgressBarAndLogoLoadingScreen(e){const t=this.GetRenderer(),s=this._runtime.GetLoadingLogoAsset();if(s){const n=s.GetTexture();if(n){const i=n.GetWidth(),r=n.GetHeight(),a=this._canvasCssWidth/2,o=this._canvasCssHeight/2,l=i/2,h=r/2;tempQuad.setRect(a-l,o-h,a+l,o+h),t.SetTexture(n),t.Quad(tempQuad),this._DrawProgressBarLoadingScreen(e,i,16+h)}else this._DrawProgressBarLoadingScreen(e,PROGRESSBAR_WIDTH,0)}else this._DrawProgressBarLoadingScreen(e,PROGRESSBAR_WIDTH,0)}_DrawSplashLoadingScreen(e){let t=this.GetRenderer(),s=this._splashTextures.logo,n=this._splashTextures.powered,i=this._splashTextures.website,r=Date.now(),a=(0===this._splashFrameNumber&&(this._loaderStartTime=r),this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova()),o=a?0:SPLASH_AFTER_FADEOUT_WAIT_TIME,l=a?0:SPLASH_MIN_DISPLAY_TIME,h=1,c=("fade-in"===this._splashState?h=Math.min((r-this._loaderStartTime)/SPLASH_FADE_DURATION,1):"fade-out"===this._splashState&&(h=Math.max(1-(r-this._splashFadeOutStartTime)/SPLASH_FADE_DURATION,0)),t.SetColorFillMode(),t.SetColorRgba(.231*h,.251*h,.271*h,h),tempRect.set(0,0,this._canvasCssWidth,this._canvasCssHeight),t.Rect(tempRect),Math.ceil(this._canvasCssWidth)),u=Math.ceil(this._canvasCssHeight),d,_;256<this._canvasCssHeight?(t.SetColorRgba(.302*h,.334*h,.365*h,h),d=c,_=Math.max(.005*u,2),tempRect.setWH(0,.8*u-_/2,d,_),t.Rect(tempRect),e?t.SetColorRgba(h,0,0,h):t.SetColorRgba(.161*h,.953*h,.816*h,h),d=c*this._loadingProgress,tempRect.setWH(.5*c-d/2,.8*u-_/2,d,_),t.Rect(tempRect),t.SetColorRgba(h,h,h,h),t.SetTextureFillMode(),n&&(d=1.5*C33.clamp(.22*u,105,.6*c),_=d/8,tempRect.setWH(.5*c-d/2,.2*u-_/2,d,_),t.SetTexture(n),t.Rect(tempRect)),s&&(d=Math.min(.395*u,.95*c),_=d,tempRect.setWH(.5*c-d/2,.485*u-_/2,d,_),t.SetTexture(s),t.Rect(tempRect)),i&&(d=1.5*C33.clamp(.22*u,105,.6*c),_=d/8,tempRect.setWH(.5*c-d/2,.868*u-_/2,d,_),t.SetTexture(i),t.Rect(tempRect))):(t.SetColorRgba(.302*h,.334*h,.365*h,h),d=c,_=Math.max(.005*u,2),tempRect.setWH(0,.85*u-_/2,d,_),t.Rect(tempRect),e?t.SetColorRgba(h,0,0,h):t.SetColorRgba(.161*h,.953*h,.816*h,h),d=c*this._loadingProgress,tempRect.setWH(.5*c-d/2,.85*u-_/2,d,_),t.Rect(tempRect),t.SetColorRgba(h,h,h,h),t.SetTextureFillMode(),s&&(d=.55*u,_=d,tempRect.setWH(.5*c-d/2,.45*u-_/2,d,_),t.SetTexture(s),t.Rect(tempRect))),this._splashFrameNumber++,"fade-in"===this._splashState&&r-this._loaderStartTime>=SPLASH_FADE_DURATION&&2<=this._splashFrameNumber&&(this._splashState="wait",this._splashFadeInFinishTime=r),"wait"===this._splashState&&r-this._splashFadeInFinishTime>=l&&1<=this._loadingProgress&&(this._splashState="fade-out",this._splashFadeOutStartTime=r),("fade-out"===this._splashState&&r-this._splashFadeOutStartTime>=SPLASH_FADE_DURATION+o||a&&1<=this._loadingProgress&&r-this._loaderStartTime<500)&&this._splashDoneResolve()}}}{let C33=self.C3,C3Debugger=self.C3Debugger,assert=self.assert,DEFAULT_RUNTIME_OPTS={messagePort:null,runtimeBaseUrl:"",headless:!1,hasDom:!0,isInWorker:!1,useAudio:!0,exportType:""},ife=!0;C33.Runtime=class extends C33.DefendedBase{constructor(e){e=Object.assign({},DEFAULT_RUNTIME_OPTS,e),super(),this._messagePort=e.messagePort,this._runtimeBaseUrl=e.runtimeBaseUrl,this._previewUrl=e.previewUrl,this._isHeadless=!!e.headless,this._hasDom=!!e.hasDom,this._isInWorker=!!e.isInWorker,ife=e.ife,this._useAudio=!!e.useAudio,this._exportType=e.exportType,this._isNWjs=e.isNWjs,this._isiOSCordova=!!e.isiOSCordova,this._isiOSWebView=!!e.isiOSWebView,this._isWindowsWebView2=!!e.isWindowsWebView2,this._isAnyWebView2Wrapper=!!e.isAnyWebView2Wrapper,this._isFBInstantAvailable=!!e.isFBInstantAvailable,this._isDebug=!("preview"!==this._exportType||!e.isDebug),this._breakpointsEnabled=this._isDebug,this._isDebugging=this._isDebug,this._debuggingDisabled=0,this._additionalLoadPromises=[],this._additionalCreatePromises=[],this._isUsingCreatePromises=!1,this._projectName="",this._projectVersion="",this._projectUniqueId="",this._appId="",this._originalViewportWidth=0,this._originalViewportHeight=0,this._devicePixelRatio=self.devicePixelRatio,this._parallaxXorigin=0,this._parallaxYorigin=0,this._viewportWidth=0,this._viewportHeight=0,this._loaderStyle=0,this._usesLoaderLayout=!1,this._isLoading=!0,this._usesAnyBackgroundBlending=!1,this._usesAnyCrossSampling=!1,this._usesAnyDepthSampling=!1,this._loadingLogoAsset=null,this._assetManager=C33.New(C33.AssetManager,this,e),this._layoutManager=C33.New(C33.LayoutManager,this),this._eventSheetManager=C33.New(C33.EventSheetManager,this),this._addonManager=C33.New(C33.AddonManager,this,e.wrapperComponentIds),this._collisionEngine=C33.New(C33.CollisionEngine,this),this._timelineManager=C33.New(C33.TimelineManager,this),this._transitionManager=C33.New(C33.TransitionManager,this),this._templateManager=C33.New(C33.TemplateManager,this),this._flowchartManager=C33.New(C33.FlowchartManager,this),this._textIconManager=C33.New(C33.TextIconManager,{getIconSetMeta:e=>this._GetTextIconSetMeta(e),getIconSetContent:e=>this._GetTextIconSetContent(e)}),this._iconChangeHandlers=new Map,this._allObjectClasses=[],this._objectClassesByName=new Map,this._objectClassesBySid=new Map,this._familyCount=0,this._allContainers=[],this._allEffectLists=new Set,this._currentLayoutStack=[],this._instancesPendingCreate=[],this._instancesPendingDestroy=new Map,this._hasPendingInstances=!1,this._isFlushingPendingInstances=!1,this._objectCount=0,this._nextUid=0,this._instancesByUid=new Map,this._instancesPendingRelease=new Set,this._instancesPendingReleaseAffectedObjectClasses=new Set,this._objectReferenceTable=[],this._jsPropNameTable=[],this._canvasManager=null,this._uses3dFeatures=!1,this._framerateMode="vsync",this._sampling="trilinear",this._isPixelRoundingEnabled=!1,this._needRender=!0,this._pauseOnBlur=!1,this._isPausedOnBlur=!1,this._exportToVideo=null,this._tickCallbacks={normal:e=>{this._rafId=-1,this._ruafId=-1,this.Tick(e)},tickOnly:e=>{this._ruafId=-1,this.Tick(e,!1,"skip-render")},renderOnly:()=>{this._rafId=-1,this.Render()}},this._rafId=-1,this._ruafId=-1,this._tickCount=0,this._tickCountNoSave=0,this._hasStarted=!1,this._isInTick=!1,this._hasStartedTicking=!1,this._isLayoutFirstTick=!0,this._isAutoSuspendEnabled=!0,this._isPageVisibilitySuspended=!1,this._suspendCount=0,this._scheduleTriggersThrottle=new C33.PromiseThrottle(1),this._randomNumberCallback=()=>Math.random(),this._startTime=0,this._lastTickTime=0,this._dtRaw=0,this._dt1=0,this._dt=0,this._timeScale=1,this._maxDt=1/30,this._minDt=0,this._gameTime=C33.New(C33.KahanSum),this._gameTimeRaw=C33.New(C33.KahanSum),this._wallTime=C33.New(C33.KahanSum),this._instanceTimes=new Map,this._fpsFrameCount=-1,this._fpsLastTime=0,this._fps=0,this._tpsTickCount=-1,this._tps=0,this._mainThreadTimeCounter=0,this._mainThreadTime=0,this._isLoadingState=!1,this._saveToSlotName="",this._saveToJsonString=!1,this._loadFromSlotName="",this._loadFromJson=null,this._lastSaveJson="",this._projectStorage=null,this._savegamesStorage=null,this._dispatcher=C33.New(C33.Event.Dispatcher),this._domEventHandlers=new Map,this._pendingResponsePromises=new Map,this._nextDomResponseId=0,this._didRequestDeviceOrientationEvent=!1,this._didRequestDeviceMotionEvent=!1,this._isReadyToHandleEvents=!1,this._waitingToHandleEvents=[],this._eventObjects={pretick:C33.New(C33.Event,"pretick",!1),tick:C33.New(C33.Event,"tick",!1),tick2:C33.New(C33.Event,"tick2",!1),instancecreate:C33.New(C33.Event,"instancecreate",!1),instancedestroy:C33.New(C33.Event,"instancedestroy",!1),beforelayoutchange:C33.New(C33.Event,"beforelayoutchange",!1),layoutchange:C33.New(C33.Event,"layoutchange",!1)},this._eventObjects.instancecreate.instance=null,this._eventObjects.instancedestroy.instance=null,this._userScriptDispatcher=C33.New(C33.Event.Dispatcher),this._userScriptEventObjects=null;const t=(e,t)=>C33.BehaviorInstance.SortByTickSequence(this,e,t);this._behInstsToTick=C33.New(C33.RedBlackSet,t),this._behInstsToPostTick=C33.New(C33.RedBlackSet,t),this._behInstsToTick2=C33.New(C33.RedBlackSet,t),this._jobScheduler=C33.New(C33.JobSchedulerRuntime,this,e.jobScheduler),e.canvas&&(this._canvasManager=C33.New(C33.CanvasManager,this)),this._messagePort.onmessage=e=>this._OnMessageFromDOM(e.data),this.AddDOMComponentMessageHandler("runtime","visibilitychange",e=>this._OnVisibilityChange(e)),this.AddDOMComponentMessageHandler("runtime","wrapper-extension-message",e=>this._OnWrapperExtensionMessage(e)),this.AddDOMComponentMessageHandler("runtime","opus-decode",e=>this._WasmDecodeWebMOpus(e.arrayBuffer)),this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",()=>this._GetRemotePreviewStatusInfo()),this.AddDOMComponentMessageHandler("runtime","js-invoke-function",e=>this._InvokeFunctionFromJS(e)),this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self.goToLastErrorScript),this.AddDOMComponentMessageHandler("runtime","offline-audio-render-completed",e=>this._OnOfflineAudioRenderCompleted(e)),this._dispatcher.addEventListener("window-blur",e=>this._OnWindowBlur(e)),this._dispatcher.addEventListener("window-focus",()=>this._OnWindowFocus()),this._timelineManager.AddRuntimeListeners(),this._templateManager.AddRuntimeListeners(),this._iRuntime=null,this._interfaceMap=new WeakMap,this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null,timelineController:null},this._instancesNeedingAfterLoadMap=new WeakMap,this._instancesNeedingAfterLoadArray=[]}static Create(e){return C33.New(C33.Runtime,e)}Release(){C33.clearArray(this._allObjectClasses),this._objectClassesByName.clear(),this._objectClassesBySid.clear(),this._layoutManager.Release(),this._layoutManager=null,this._eventSheetManager.Release(),this._eventSheetManager=null,this._addonManager.Release(),this._addonManager=null,this._assetManager.Release(),this._assetManager=null,this._collisionEngine.Release(),this._collisionEngine=null,this._timelineManager.Release(),this._timelineManager=null,this._transitionManager.Release(),this._transitionManager=null,this._templateManager.Release(),this._templateManager=null,this._flowchartManager.Release(),this._flowchartManager=null,this._textIconManager.Release(),this._textIconManager=null,this._canvasManager&&(this._canvasManager.Release(),this._canvasManager=null),this._dispatcher.Release(),this._dispatcher=null,this._tickEvent=null}["_OnMessageFromDOM"](e){const t=e.type;if("event"===t)this._OnEventFromDOM(e);else{if("result"!==t)throw new Error(`unknown message '${t}'`);this._OnResultFromDOM(e)}}_OnEventFromDOM(e){if(this._isReadyToHandleEvents){const t=e.component,s=e.handler,n=e.data,i=e.dispatchOpts,r=!(!i||!i.dispatchRuntimeEvent),a=!(!i||!i.dispatchUserScriptEvent),o=e.responseId;if("runtime"===t){if(r){const h=new C33.Event(s);h.data=n,this._dispatcher.dispatchEventAndWaitAsyncSequential(h)}if(a){const c=new C33.Event(s,!0);for(const[u,d]of Object.entries(n))c[u]=d;this.DispatchUserScriptEvent(c)}}const l=this._domEventHandlers.get(t);if(l){const _=l.get(s);if(_){let e=null;try{e=_(n)}catch(e){return console.error(`Exception in '${t}' handler '${s}':`,e),void(null!==o&&this._PostResultToDOM(o,!1,""+e))}null!==o&&(e&&e.then?e.then(e=>this._PostResultToDOM(o,!0,e)).catch(e=>{console.error(`Rejection from '${t}' handler '${s}':`,e),this._PostResultToDOM(o,!1,""+e)}):this._PostResultToDOM(o,!0,e))}else r||a||console.warn(`[Runtime] No DOM handler '${s}' for component '${t}'`)}else r||a||console.warn(`[Runtime] No DOM event handlers for component '${t}'`)}else this._waitingToHandleEvents.push(e)}_PostResultToDOM(e,t,s){this._messagePort.postMessage({type:"result",responseId:e,isOk:t,result:s})}_OnResultFromDOM(e){const t=e.responseId,s=e.isOk,n=e.result,i=this._pendingResponsePromises.get(t);s?i.resolve(n):i.reject(n),this._pendingResponsePromises.delete(t)}AddDOMComponentMessageHandler(e,t,s){let n=this._domEventHandlers.get(e);if(n||(n=new Map,this._domEventHandlers.set(e,n)),n.has(t))throw new Error(`[Runtime] Component '${e}' already has handler '${t}'`);n.set(t,s)}PostComponentMessageToDOM(e,t,s,n){this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:null},n)}PostComponentMessageToDOMAsync(e,t,s,n){const i=this._nextDomResponseId++,r=new Promise((e,t)=>{this._pendingResponsePromises.set(i,{resolve:e,reject:t})});return this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:i},n),r}SendWrapperExtensionMessage(e,t,s,n=-1){this.PostComponentMessageToDOM("runtime","send-wrapper-extension-message",{componentId:e,messageId:t,params:s,asyncId:n})}SendWrapperExtensionMessageAsync(e,t,s){const n=this._nextDomResponseId++,i=new Promise((e,t)=>{this._pendingResponsePromises.set(n,{resolve:e,reject:t})});return this.SendWrapperExtensionMessage(e,t,s,n),i}_OnWrapperExtensionMessage(e){if(-1!==e.asyncId){const t=e.asyncId,s=this._pendingResponsePromises.get(t);s.resolve(e.params),this._pendingResponsePromises.delete(t)}else this._OnEventFromDOM({component:"wrapper-extension:"+e.componentId,handler:e.messageId,data:e.params,responseId:null})}AddWrapperExtensionMessageHandler(e,t,s){this.AddDOMComponentMessageHandler("wrapper-extension:"+e,t,s)}HasWrapperComponentId(e){return this._addonManager.HasWrapperComponentId(e)}PostToDebugger(e){if(!this.IsDebug())throw new Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",e)}async Init(e){C33.CommonACES_SetRuntime(this),this.IsDebug()?await C3Debugger.Init(this):self.C3Debugger&&self.C3Debugger.InitPreview(this);const[t]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);if(await this._LoadDataJson(t),await this._InitialiseCanvas(e),this.IsPreview()||console.info("%cMade with Construct, the game and animation creation tool. Visit: https://www.construct.net","font-weight: bold"),this.GetWebGLRenderer()){const s=this.GetWebGLRenderer();console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGL ${s.GetWebGLVersionNumber()} [${s.GetUnmaskedRenderer()}]`)}else this.GetWebGPURenderer()&&console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGPU [${this.GetWebGPURenderer().GetAdapterInfoString()}]`);this.GetRenderer().HasMajorPerformanceCaveat()&&console.warn("[C3 runtime] The renderer indicates a major performance caveat. Software rendering may be in use. This can result in significantly degraded performance."),this._isReadyToHandleEvents=!0;for(const n of this._waitingToHandleEvents)this._OnEventFromDOM(n);C33.clearArray(this._waitingToHandleEvents),this._canvasManager&&this._canvasManager.StartLoadingScreen();for(const i of e.runOnStartupFunctions)this._additionalLoadPromises.push(this._RunOnStartupFunction(i));if(await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]),C33.clearArray(this._additionalLoadPromises),!this._assetManager.HasHadErrorLoading())return this._canvasManager&&await this._canvasManager.EndLoadingScreen(),await this._dispatcher.dispatchEventAndWaitAsync(new C33.Event("beforeruntimestart")),await this.Start(),this._messagePort.postMessage({type:"runtime-ready"}),this;this._canvasManager&&this._canvasManager.HideCordovaSplashScreen()}async _RunOnStartupFunction(e){try{await e(this._iRuntime)}catch(e){console.error("[C3 runtime] Error in runOnStartup function: ",e)}}async _LoadDataJson(e){const t=e.project,s=(this._projectName=t[0],this._projectVersion=t[16],this._projectUniqueId=t[31],this._appId=t[38],t[39]||"loading-logo.png"),n=(this._isPixelRoundingEnabled=!!t[9],this._originalViewportWidth=this._viewportWidth=t[10],this._originalViewportHeight=this._viewportHeight=t[11],this._collisionEngine._InitCollisionCellSize(this._originalViewportWidth,this._originalViewportHeight),this._parallaxXorigin=this._originalViewportWidth/2,this._parallaxYorigin=this._originalViewportHeight/2,this._framerateMode=t[37],this._uses3dFeatures=!!t[40],this._sampling=t[14],this._usesAnyBackgroundBlending=t[15],this._usesAnyCrossSampling=t[42],this._usesAnyDepthSampling=t[17],this._usesLoaderLayout=!!t[18],this._loaderStyle=t[19],this._nextUid=t[21],this._pauseOnBlur=t[22],this._assetManager);if(n._SetFileStructure(t[45]),n._SetAudioFiles(t[7],t[25]),n._SetMediaSubfolder(t[8]),n._SetFontsSubfolder(t[32]),n._SetIconsSubfolder(t[28]),n._SetWebFonts(t[29]),0===this._loaderStyle){let e;(e="flat"===n.GetFileStructure()?n.GetIconsSubfolder()+s:s)&&(this._loadingLogoAsset=n.LoadImage({url:e}))}this._canvasManager&&(this._canvasManager.SetFullscreenMode(C33.CanvasManager._FullscreenModeNumberToString(t[12])),this._canvasManager.SetFullscreenScalingQuality(t[23]?"high":"low"),this._canvasManager.SetMipmapsEnabled(0!==t[24]),this._canvasManager._SetGPUPowerPreference(t[34]),this._canvasManager._SetTextureAnisotropy(t[41]),this._canvasManager._SetWebGPUEnabled(t[13]),this._canvasManager._SetZAxisScale(t[30]),this._canvasManager._SetZDistances(t[46],t[47]),this._canvasManager._SetInitFieldOfView(t[26]),this._canvasManager._SetLimitedToWebGL1(t[48]));const i=t[43],r=(i&&await this._LoadExportToVideoData(i),this._InitScriptInterfaces(),this._addonManager.CreateSystemPlugin(),this._objectReferenceTable=self.C3_GetObjectRefTable(),t[2]);for(const h of r[1])this._addonManager.CreateBehavior(h);for(const c of r[0])this._addonManager.CreatePlugin(c);this._objectReferenceTable=self.C3_GetObjectRefTable(),this._LoadJsPropNameTable(),this._addonManager._InitAddonScriptInterfaces();for(const u of t[3]){const d=C33.ObjectClass.Create(this,this._allObjectClasses.length,u);this._allObjectClasses.push(d),this._objectClassesByName.set(d.GetName().toLowerCase(),d),this._objectClassesBySid.set(d.GetSID(),d)}for(const _ of t[4]){const p=this._allObjectClasses[_[0]];p._LoadFamily(_)}for(const m of t[27]){const g=m.map(e=>this._allObjectClasses[e]);this._allContainers.push(C33.New(C33.Container,this,g))}this._InitObjectsScriptInterface();for(const f of this._allObjectClasses)f._OnAfterCreate();for(const S of t[5])this._layoutManager.Create(S);const a=t[1];if(a){const y=this._layoutManager.GetLayoutByName(a);y&&this._layoutManager.SetFirstLayout(y)}for(const C of t[35])this._transitionManager.Create(C);for(const G of t[33])this._timelineManager.Create(G);for(const T of t[44])this._templateManager.Create(T);this._templateManager.HasTemplates()||(this._templateManager.Release(),this._templateManager=null);for(const I of t[49])this._flowchartManager.Create(I);this._flowchartManager.HasFlowcharts()||(this._flowchartManager.Release(),this._flowchartManager=null);for(const b of t[6])this._eventSheetManager.Create(b);this._eventSheetManager._PostInit(),this._InitGlobalVariableScriptInterface(),C33.clearArray(this._objectReferenceTable),this.FlushPendingInstances();let o="any",l=t[20];1===l?o="portrait":2===l&&(o="landscape"),this.PostComponentMessageToDOM("runtime","set-target-orientation",{targetOrientation:o})}async _LoadExportToVideoData(e){const t=e.format;"image-sequence"===t?this._exportToVideo=new self.C3ExportToImageSequence(this,e):"image-sequence-gif"===t?this._exportToVideo=new self.C3ExportToGIF(this,e):"webm"===t?this._exportToVideo=new self.C3ExportToWebMVideo(this,e):"mp4"===t&&(this._exportToVideo=new self.C3ExportToMP4Video(this,e)),this._framerateMode="unlimited-frame",this._canvasManager.SetFullscreenMode("off"),this._devicePixelRatio=1,self.devicePixelRatio=1,await this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{message:this._exportToVideo.GetExportingMessageForPercent(0),duration:this._exportToVideo.GetDuration()})}GetLoaderStyle(){return this._loaderStyle}IsExportToVideo(){return null!==this._exportToVideo}GetExportVideoDuration(){return this._exportToVideo.GetDuration()}GetExportVideoFramerate(){return this._exportToVideo.GetFramerate()}_InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),height:this._canvasManager.GetDeviceHeight()})}_ExportToVideoAddFrame(){const e=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetMainCanvas(),e)}_ExportToVideoAddKeyframe(){this._exportToVideo&&this._exportToVideo.AddKeyframe()}_OnOfflineAudioRenderCompleted(e){this._exportToVideo.OnOfflineAudioRenderCompleted(e)}_ExportToVideoFinish(){return this._exportToVideo.Finish()}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(e){this._additionalLoadPromises.push(e)}SetUsingCreatePromises(e){this._isUsingCreatePromises=!!e}AddCreatePromise(e){this._isUsingCreatePromises&&this._additionalCreatePromises.push(e)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(e){this._allEffectLists.add(e)}_RemoveEffectList(e){this._allEffectLists.delete(e)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(e){this._canvasManager&&(await this._canvasManager.CreateCanvas(e),this._canvasManager.InitLoadingScreen(this._loaderStyle))}async _MaybeLoadOpusDecoder(){const i=this._assetManager;if(!i.IsAudioFormatSupported("audio/webm; codecs=opus")){let e=null,t=i.GetScriptSubfolder(),s=t+"opus.wasm.js",n=t+"opus.wasm.wasm";try{e=this.IsiOSCordova()&&i.IsFileProtocol()?await i.CordovaFetchLocalFileAsArrayBuffer(n):await i.FetchArrayBuffer(n)}catch(e){return void console.info("Failed to fetch Opus decoder WASM; assuming project has no Opus audio.",e)}this.AddJobWorkerBuffer(e,"opus-decoder-wasm"),await this.AddJobWorkerScripts([s])}}async _WasmDecodeWebMOpus(e){const t=await this.AddJob("OpusDecode",{arrayBuffer:e},[e]);return t}async Start(){this._hasStarted=!0,this._startTime=Date.now();let t=null,e=new Promise(e=>t=e);if(this._usesLoaderLayout){for(const i of this._allObjectClasses)i.IsFamily()||i.IsOnLoaderLayout()||!i.IsWorldType()||i.OnCreate();(async()=>{await this._assetManager.WaitForAllToLoad(),await e,this._isLoading=!1,this._OnLoadFinished()})()}else this._isLoading=!1;this._assetManager.SetInitialLoadFinished(),this.IsDebug()&&C3Debugger.RuntimeInit(ife);for(const r of this._layoutManager.GetAllLayouts())r._CreateGlobalNonWorlds();this.IsExportToVideo()&&await this._InitExportToVideo();const s=this._layoutManager.GetFirstLayout(),n=(await s._Load(null,this.GetRenderer()),await s._StartRunning(!0),this._fpsLastTime=performance.now(),t(),this._usesLoaderLayout||this._OnLoadFinished(),await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking"));n.isSuspended&&!this.IsExportToVideo()?(this._suspendCount++,this._isPageVisibilitySuspended=!0):this.Tick()}_OnLoadFinished(){this.Trigger(C33.Plugins.System.Cnds.OnLoadFinished,null,null),this.PostComponentMessageToDOM("runtime","register-sw")}GetObjectReference(e){e=Math.floor(e);const t=this._objectReferenceTable;if(e<0||e>=t.length)throw new Error("invalid object reference");return t[e]}_LoadJsPropNameTable(){for(const e of self.C3_JsPropNameTable){const t=C33.first(Object.keys(e));this._jsPropNameTable.push(t)}}GetJsPropName(e){e=Math.floor(e);const t=this._jsPropNameTable;if(e<0||e>=t.length)throw new Error("invalid prop reference");return t[e]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetRuntimeBaseURL(){return this._runtimeBaseUrl}GetPreviewURL(){return this._previewUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return 0===this.GetCurrentEventStackFrame().GetConditionIndex()}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetAddonManager(){return this._addonManager}GetSystemPlugin(){return this._addonManager.GetSystemPlugin()}GetObjectClassByIndex(e){if((e=Math.floor(e))<0||e>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[e]}GetObjectClassByName(e){return this._objectClassesByName.get(e.toLowerCase())||null}GetObjectClassBySID(e){return this._objectClassesBySid.get(e)||null}GetSingleGlobalObjectClassByCtor(e){const t=C33.AddonManager.GetPluginByConstructorFunction(e);return t?t.GetSingleGlobalObjectClass():null}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(const e of this._allObjectClasses)e.IsFamily()||(yield*e.instances())}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();const t=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();t&&C3Debugger.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),t&&C3Debugger.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.runtime=this.GetIRuntime(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(e,t){if(this._originalViewportWidth!==e||this._originalViewportHeight!==t){this._originalViewportWidth=e,this._originalViewportHeight=t;const s=this.GetLayoutManager();s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged()}}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(e,t){if(this._viewportWidth!==e||this._viewportHeight!==t){this._viewportWidth=e,this._viewportHeight=t;const s=this.GetLayoutManager();s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged()}}_SetDevicePixelRatio(e){this.IsExportToVideo()||(this._devicePixelRatio=e)}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){return this._canvasManager?this._canvasManager.GetDrawWidth():this._viewportWidth}GetDrawHeight(){return this._canvasManager?this._canvasManager.GetDrawHeight():this._viewportHeight}GetRenderScale(){return this._canvasManager?this._canvasManager.GetRenderScale():1}GetDisplayScale(){return this._canvasManager?this._canvasManager.GetDisplayScale():1}GetEffectLayerScaleParam(){return this._canvasManager?this._canvasManager.GetEffectLayerScaleParam():1}GetEffectDevicePixelRatioParam(){return this._canvasManager?this._canvasManager.GetEffectDevicePixelRatioParam():1}GetCanvasClientX(){return this._canvasManager?this._canvasManager.GetCanvasClientX():0}GetCanvasClientY(){return this._canvasManager?this._canvasManager.GetCanvasClientY():0}GetCanvasCssWidth(){return this._canvasManager?this._canvasManager.GetCssWidth():0}GetCanvasCssHeight(){return this._canvasManager?this._canvasManager.GetCssHeight():0}GetFullscreenMode(){return this._canvasManager?this._canvasManager.GetFullscreenMode():"off"}GetAdditionalRenderTarget(e){return this._canvasManager?this._canvasManager.GetAdditionalRenderTarget(e):null}ReleaseAdditionalRenderTarget(e){this._canvasManager&&this._canvasManager.ReleaseAdditionalRenderTarget(e)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyCrossSampling(){return this._usesAnyCrossSampling}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){return this._canvasManager?this._canvasManager.GetGPUUtilisation():NaN}IsLinearSampling(){return"nearest"!==this.GetSampling()}GetFramerateMode(){return this._framerateMode}_SetFramerateMode(e){this._framerateMode!==e&&(this._framerateMode=e,-1!==this._rafId||-1!==this._ruafId)&&(this._CancelAnimationFrame(),this._RequestAnimationFrame())}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){this._loadingLogoAsset&&(this._loadingLogoAsset.ReleaseTexture(),this._loadingLogoAsset.Release(),this._loadingLogoAsset=null)}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetTemplateManager(){return this._templateManager}GetFlowchartManager(){return this._flowchartManager}GetAssetManager(){return this._assetManager}LoadImage(e){return this._assetManager.LoadImage(e)}CreateInstance(e,t,s,n,i,r){if(r&&this._templateManager){if(e instanceof C33.ObjectClass&&e.IsFamily()){const o=e.GetFamilyMembers(),l=Math.floor(this.Random()*o.length);return this.CreateInstance(o[l],t,s,n,i,r)}const a=this._templateManager.GetTemplateData(e,r);if(a){const h=this.CreateInstanceFromData(a,t,!1,s,n,!1,i,void 0,i);return this._templateManager.MapInstanceToTemplateName(h,r),h}}return this.CreateInstanceFromData(e,t,!1,s,n,!1,i,void 0,i)}CreateInstanceFromData(e,t,s,n,i,r,a,o,l){let h=null,c=null;if(e instanceof C33.ObjectClass){if((c=e).IsFamily()){const C=c.GetFamilyMembers(),G=Math.floor(this.Random()*C.length);c=C[G]}h=c.GetDefaultInstanceData()}else h=e,c=this.GetObjectClassByIndex(h[1]);const u=c.GetPlugin().IsWorldType();if(this._isLoading&&u&&!c.IsOnLoaderLayout())return null;const d=t;u||(t=null);let _;_=s&&!r&&h&&!this._instancesByUid.has(h[2])?h[2]:this._nextUid++;const p=h?h[0]:null,m=C33.New(C33.Instance,{runtime:this,objectType:c,layer:t,worldData:p,instVarData:h?h[3]:null,uid:_,tags:h?h[6]:null});this._instancesByUid.set(_,m);let g=null,f=(u&&(g=m.GetWorldInfo(),void 0!==n&&void 0!==i&&(g.SetX(n),g.SetY(i)),c._SetAnyCollisionCellChanged(!0)),t&&(l||t._AddInstance(m,!0),t.GetLayout().MaybeLoadTexturesFor(c)),this._objectCount++,!0);if(o){const T=o.GetObjectClass();if(T.IsInContainer()&&c.IsInContainer()){const I=c.GetContainer(),b=T.GetContainer();I===b&&(f=!1)}}if(c.IsInContainer()&&!s&&!r&&f){const A=new Set;for(const P of c.GetContainer().objectTypes())if(P!==c){const E=this._MaybeGetChildInstanceForObjectTypeData(P,g,A);if(E){const v=this.CreateInstanceFromData(E,d,!1,g?g.GetX():n,g?g.GetY():i,!0,!1,void 0,l);m._AddSibling(v)}else{const B=this.CreateInstanceFromData(P,d,!1,g?g.GetX():n,g?g.GetY():i,!0,!1,void 0,l);m._AddSibling(B)}}for(const R of m.siblings()){R._AddSibling(m);for(const x of m.siblings())R!==x&&R._AddSibling(x)}}if(u&&!s&&a&&this._CreateChildInstancesFromData(m,p,g,t,n,i,l),c.IsInContainer()&&!s&&!r&&a)for(const w of m.siblings()){const D=w.GetWorldInfo();if(D){const N=w.GetPlugin(),M=w.GetObjectClass().GetDefaultInstanceData()[0];N.IsWorldType()?this._CreateChildInstancesFromData(w,M,D,t,D.GetX(),D.GetY(),l):this._CreateChildInstancesFromData(w,M,D,t,void 0,void 0,l)}}if(!r&&a){void 0===n&&(n=p[0]),void 0===i&&(i=p[1]);const O=g.GetTopParent(),W=n-g.GetX()+O.GetX(),V=i-g.GetY()+O.GetY();O.SetXY(W,V)}c._SetIIDsStale();const L=h?C33.cloneArray(h[5]):null,k=h?h[4].map(e=>C33.cloneArray(e)):null,S=u&&p&&p[13];if(S&&m._SetHasTilemap(),m._CreateSdkInstance(L,k),S){const F=p[13];m.GetSdkInstance().LoadTilemapData(F[2],F[0],F[1])}this._instancesPendingCreate.push(m),this._hasPendingInstances=!0,this.IsDebug()&&C3Debugger.InstanceCreated(m);const y=this._eventObjects.instancecreate;return y.instance=m,this._dispatcher.dispatchEvent(y),m}_GetInstanceData(e){const t=e[0],s=e[1],n=e[2],i=e[6];if(i)return i;const r=this._layoutManager.GetLayoutBySID(t),a=r.GetLayer(s);return a.GetInitialInstanceData(n)}_MaybeGetChildInstanceForObjectTypeData(e,t,s){const n=t?.GetSceneGraphChildrenExportData()??[];for(const i of n){const r=this._GetInstanceData(i),a=!!i[4],o=this.GetObjectClassByIndex(r[1]);if(!s.has(r)&&e===o&&a)return s.add(r),r}}_CreateChildInstancesFromData(l,e,t,h,c,u,d){const s=t.GetSceneGraphZIndexExportData(),n=t.GetSceneGraphChildrenExportData();if(l.GetWorldInfo().SetSceneGraphZIndex(s),n){void 0===c&&(c=e[0]),void 0===u&&(u=e[1]);const _=new Set,p=e[0],m=e[1];for(const g of n){let e=g[0],t=g[1],s=g[2],n=g[3],i=!!g[4],r=g[5],a=g[6],o;if(a)o=a;else{const C=this._layoutManager.GetLayoutBySID(e),G=C.GetLayer(t);o=G.GetInitialInstanceData(s)}const f=this.GetObjectClassByIndex(o[1]),S=l.HasSibling(f),y=_.has(f);if(S&&!y&&i){const T=l.GetSibling(f),I=(T.GetWorldInfo().Init(o[0]),c+o[0][0]-p),b=u+o[0][1]-m;T.GetWorldInfo().SetXY(I,b),T.GetWorldInfo().SetSceneGraphZIndex(r),l.AddChild(T,{transformX:!!(n>>0&1),transformY:!!(n>>1&1),transformWidth:!!(n>>2&1),transformHeight:!!(n>>3&1),transformAngle:!!(n>>4&1),destroyWithParent:!!(n>>5&1),transformZElevation:!!(n>>6&1),transformOpacity:!!(n>>7&1),transformVisibility:!!(n>>8&1)}),_.add(f)}else{const A=c+o[0][0]-p,P=u+o[0][1]-m,E=this.CreateInstanceFromData(o,h,!1,A,P,!1,!0,l,d);E.GetWorldInfo().SetSceneGraphZIndex(r),l.AddChild(E,{transformX:!!(n>>0&1),transformY:!!(n>>1&1),transformWidth:!!(n>>2&1),transformHeight:!!(n>>3&1),transformAngle:!!(n>>4&1),destroyWithParent:!!(n>>5&1),transformZElevation:!!(n>>6&1),transformOpacity:!!(n>>7&1),transformVisibility:!!(n>>8&1)})}}}}DestroyInstance(s){if(!this._instancesPendingRelease.has(s)){let e=s.GetObjectClass(),t=this._instancesPendingDestroy.get(e);if(t){if(t.has(s))return;t.add(s)}else(t=new Set).add(s),this._instancesPendingDestroy.set(e,t);if(this.IsDebug()&&C3Debugger.InstanceDestroyed(s),s._MarkDestroyed(),this._hasPendingInstances=!0,s.IsInContainer())for(const n of s.siblings())this.DestroyInstance(n);for(const i of s.children())i.GetDestroyWithParent()&&this.DestroyInstance(i);if(!this._layoutManager.IsEndingLayout()&&!this._isLoadingState){const r=this.GetEventSheetManager();r.BlockFlushingInstances(!0),s._TriggerOnDestroyed(),r.BlockFlushingInstances(!1)}s._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}}FlushPendingInstances(){this._hasPendingInstances&&(this._isFlushingPendingInstances=!0,this._FlushInstancesPendingCreate(),this._FlushInstancesPendingDestroy(),this._isFlushingPendingInstances=!1,this._hasPendingInstances=!1,this.UpdateRender())}_FlushInstancesPendingCreate(){for(const e of this._instancesPendingCreate){const t=e.GetObjectClass();t._AddInstance(e);for(const s of t.GetFamilies())s._AddInstance(e),s._SetIIDsStale()}C33.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(!0);for(const[e,t]of this._instancesPendingDestroy.entries())this._FlushInstancesPendingDestroyForObjectClass(e,t),t.clear();this._instancesPendingDestroy.clear(),this._dispatcher.SetDelayRemoveEventsEnabled(!1)}_FlushInstancesPendingDestroyForObjectClass(e,t){for(const s of t){const n=this._eventObjects.instancedestroy,i=(n.instance=s,this._dispatcher.dispatchEvent(n),this._instancesByUid.delete(s.GetUID()),this._instanceTimes.delete(s),s.GetWorldInfo());i&&(i._RemoveFromCollisionCells(),i._RemoveFromRenderCells(),i._MarkDestroyed()),this._instancesPendingRelease.add(s),this._objectCount--}C33.arrayRemoveAllInSet(e.GetInstances(),t),e._SetIIDsStale(),this._instancesPendingReleaseAffectedObjectClasses.add(e);for(const r of e.GetFamilies())C33.arrayRemoveAllInSet(r.GetInstances(),t),r._SetIIDsStale(),this._instancesPendingReleaseAffectedObjectClasses.add(r);if(e.GetPlugin().IsWorldType()){const a=new Set([...t].map(e=>e.GetWorldInfo().GetLayer()));for(const o of a)o._RemoveAllInstancesInSet(t)}}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(e){for(const t of this._GetInstancesPendingCreate())e.IsFamily()?t.GetObjectClass().BelongsToFamily(e)&&(yield t):t.GetObjectClass()===e&&(yield t)}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(e,t){this._instancesByUid.set(e,t)}_SetAutoSuspendEnabled(e){this._isAutoSuspendEnabled!==(e=!!e)&&(this._isAutoSuspendEnabled=!!e,this._isAutoSuspendEnabled)&&this._isPageVisibilitySuspended&&(this.SetSuspended(!1),this._isPageVisibilitySuspended=!1)}_IsAutoSuspendEnabled(){return this._isAutoSuspendEnabled}_OnRendererContextLost(){this._dispatcher.dispatchEvent(C33.New(C33.Event,"renderercontextlost")),this.SetSuspended(!0);for(const t of this._allObjectClasses)!t.IsFamily()&&t.HasLoadedTextures()&&t.ReleaseTextures();const e=this.GetMainRunningLayout();e&&e._OnRendererContextLost(),C33.ImageInfo.OnRendererContextLost(),C33.ImageAsset.OnRendererContextLost()}async _OnRendererContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetRenderer()),this._dispatcher.dispatchEvent(C33.New(C33.Event,"renderercontextrestored")),this.SetSuspended(!1),this.UpdateRender()}_OnVisibilityChange(e){if(this._isAutoSuspendEnabled){const t=e.hidden;this.SetSuspended(t),(this._isPageVisibilitySuspended=t)||this.UpdateRender()}}_OnWindowBlur(e){this.IsPreview()&&this._pauseOnBlur&&!C33.Platform.IsMobile&&!e.data.parentHasFocus&&(this.SetSuspended(!0),this._isPausedOnBlur=!0)}_OnWindowFocus(){this._isPausedOnBlur&&(this.SetSuspended(!1),this._isPausedOnBlur=!1)}_RequestAnimationFrame(){const e=this._tickCallbacks;"vsync"===this._framerateMode?-1===this._rafId&&(this._rafId=self.requestAnimationFrame(e.normal)):"unlimited-tick"===this._framerateMode?(-1===this._ruafId&&(this._ruafId=C33.RequestUnlimitedAnimationFrame(e.tickOnly)),-1===this._rafId&&(this._rafId=self.requestAnimationFrame(e.renderOnly))):-1===this._ruafId&&(this._ruafId=C33.RequestUnlimitedAnimationFrame(e.normal))}_CancelAnimationFrame(){-1!==this._rafId&&(self.cancelAnimationFrame(this._rafId),this._rafId=-1),-1!==this._ruafId&&(C33.CancelUnlimitedAnimationFrame(this._ruafId),this._ruafId=-1)}IsSuspended(){return 0<this._suspendCount}SetSuspended(e){if(!this.IsExportToVideo()){const t=this.IsSuspended(),s=(this._suspendCount+=e?1:-1,this._suspendCount<0&&(this._suspendCount=0),this.IsSuspended());if(!t&&s)console.log("[Construct] Suspending"),this._CancelAnimationFrame(),this._dispatcher.dispatchEvent(C33.New(C33.Event,"suspend")),this.Trigger(C33.Plugins.System.Cnds.OnSuspend,null,null);else if(t&&!s){console.log("[Construct] Resuming");const n=performance.now();this._lastTickTime=n,this._fpsLastTime=n,this._fpsFrameCount=0,this._fps=0,this._tpsTickCount=0,this._tps=0,this._mainThreadTime=0,this._mainThreadTimeCounter=0,this._dispatcher.dispatchEvent(C33.New(C33.Event,"resume")),this.Trigger(C33.Plugins.System.Cnds.OnResume,null,null),this.HitBreakpoint()||this.Tick(n)}}}_AddBehInstToTick(e){this._behInstsToTick.Add(e)}_AddBehInstToPostTick(e){this._behInstsToPostTick.Add(e)}_AddBehInstToTick2(e){this._behInstsToTick2.Add(e)}_RemoveBehInstToTick(e){this._behInstsToTick.Remove(e)}_RemoveBehInstToPostTick(e){this._behInstsToPostTick.Remove(e)}_RemoveBehInstToTick2(e){this._behInstsToTick2.Remove(e)}_BehaviorTick(){const e=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(!0);for(const t of this._behInstsToTick)t instanceof e?t._tick():t.Tick();this._behInstsToTick.SetQueueingEnabled(!1)}_BehaviorPostTick(){const e=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(!0);for(const t of this._behInstsToPostTick)t instanceof e?t._postTick():t.PostTick();this._behInstsToPostTick.SetQueueingEnabled(!1)}_BehaviorTick2(){const e=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(!0);for(const t of this._behInstsToTick2)t instanceof e?t._tick2():t.Tick2();this._behInstsToTick2.SetQueueingEnabled(!1)}*_DebugBehaviorTick(){const t=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick.SetQueueingEnabled(!0);for(const s of this._behInstsToTick){let e;e=s instanceof t?s._tick():s.Tick(),C33.IsIterator(e)&&(yield*e)}this._behInstsToTick.SetQueueingEnabled(!1)}*_DebugBehaviorPostTick(){const t=globalThis.ISDKBehaviorInstanceBase;this._behInstsToPostTick.SetQueueingEnabled(!0);for(const s of this._behInstsToPostTick){let e;e=s instanceof t?s._postTick():s.PostTick(),C33.IsIterator(e)&&(yield*e)}this._behInstsToPostTick.SetQueueingEnabled(!1)}*_DebugBehaviorTick2(){const t=globalThis.ISDKBehaviorInstanceBase;this._behInstsToTick2.SetQueueingEnabled(!0);for(const s of this._behInstsToTick2){let e;e=s instanceof t?s._tick2():s.Tick2(),C33.IsIterator(e)&&(yield*e)}this._behInstsToTick2.SetQueueingEnabled(!1)}async Tick(l,e,t){this._hasStartedTicking=!0;const h="background-wake"===t,c="background-wake"!==t&&"skip-render"!==t,u=this.GetLayoutManager(),d=this.GetCanvasManager();if(this._hasStarted&&(!this.IsSuspended()||e||h)){let e=performance.now(),t=(this._isInTick=!0,this._MeasureDt(l||0),this._tpsTickCount++,this._ReleasePendingInstances(),this.Step_BeforePreTick()),s=(this.IsDebugging()&&await t,this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects.pretick)),n=(s instanceof Promise&&await s,this.Step_AfterPreTick()),i=(this.IsDebugging()&&await n,this._NeedsHandleSaveOrLoad()&&await this._HandleSaveOrLoad(),u.IsPendingChangeMainLayout()&&await this._MaybeChangeLayout(),this.Step_RunEventsEtc()),r=(this.IsDebugging()&&await i,u.GetMainRunningLayout()),a=r._GetPendingSetHTMLLayerCount(),o=!1;if(-1!==a&&(r._ResetPendingHTMLLayerCount(),d.GetHTMLLayerCount()!==a)){const _=this.GetCanvasManager().SetHTMLLayerCount(a);this.IsInWorker()&&(o=!0,await _)}this.PostComponentMessageToDOM("canvas","update-html-layer-dom-state",{layersDomState:r._GetRootLayers().filter(e=>e.IsHTMLElementsLayer()).map(e=>e._GetHTMLLayerDOMState())}),c&&this.Render(),o&&this.PostComponentMessageToDOM("canvas","cleanup-html-layers"),this.IsExportToVideo()&&(await this._ExportToVideoAddFrame(),this.GetGameTime()>=this.GetExportVideoDuration())?this._ExportToVideoFinish():(this.IsSuspended()||h||this._RequestAnimationFrame(),this._tickCount++,this._tickCountNoSave++,this._isInTick=!1,this._mainThreadTimeCounter+=performance.now()-e)}}async Step_BeforePreTick(){const e=this._eventSheetManager,t=this.IsDebug();this.FlushPendingInstances(),e.BlockFlushingInstances(!0),this.PushCurrentLayout(this.GetMainRunningLayout()),t&&C3Debugger.StartMeasuringTime(),this.IsDebugging()?await e.DebugRunScheduledWaits():e.RunScheduledWaits(),t&&C3Debugger.AddEventsTime(),this.PopCurrentLayout(),e.BlockFlushingInstances(!1),this.FlushPendingInstances(),e.BlockFlushingInstances(!0)}async Step_AfterPreTick(){const e=this.IsDebug(),t=this.IsDebugging(),s=this._dispatcher,n=this._eventObjects,i=this._userScriptEventObjects;e&&C3Debugger.StartMeasuringTime(),t?await this.DebugIterateAndBreak(this._DebugBehaviorTick()):this._BehaviorTick(),t?await this.DebugIterateAndBreak(this._DebugBehaviorPostTick()):this._BehaviorPostTick(),e&&C3Debugger.AddBehaviorTickTime(),e&&C3Debugger.StartMeasuringTime(),t?await this.DebugFireGeneratorEventAndBreak(n.tick):s.dispatchEvent(n.tick),e&&C3Debugger.AddPluginTickTime(),this._eventSheetManager.BlockFlushingInstances(!1),this.DispatchUserScriptEvent(i.tick)}async Step_RunEventsEtc(){const e=this._eventSheetManager,t=this._dispatcher,s=this._eventObjects,n=this.IsDebug(),i=this.IsDebugging();n&&C3Debugger.StartMeasuringTime(),i?await e.DebugRunEvents(this._layoutManager):e.RunEvents(this._layoutManager),n&&C3Debugger.AddEventsTime(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleasePendingInstances(),this._isLayoutFirstTick=!1,e.BlockFlushingInstances(!0),n&&C3Debugger.StartMeasuringTime(),i?await this.DebugIterateAndBreak(this._DebugBehaviorTick2()):this._BehaviorTick2(),n&&C3Debugger.AddBehaviorTickTime(),n&&C3Debugger.StartMeasuringTime(),i?await this.DebugFireGeneratorEventAndBreak(s.tick2):t.dispatchEvent(s.tick2),n&&C3Debugger.AddPluginTickTime(),e.BlockFlushingInstances(!1),i&&await e.RunQueuedDebugTriggersAsync()}_ReleasePendingInstances(){if(0!==this._instancesPendingRelease.size){const e=this._dispatcher;e.SetDelayRemoveEventsEnabled(!0);for(const t of this._instancesPendingReleaseAffectedObjectClasses)t.GetSolStack().RemoveInstances(this._instancesPendingRelease);this._instancesPendingReleaseAffectedObjectClasses.clear(),this._eventSheetManager._OnInstancesReleased(this._instancesPendingRelease);for(const s of this._instancesPendingRelease)s.Release();this._instancesPendingRelease.clear(),e.SetDelayRemoveEventsEnabled(!1)}}async _MaybeChangeLayout(){let e=this.GetLayoutManager(),t=0;for(;e.IsPendingChangeMainLayout()&&t++<10;)await this._DoChangeLayout(e.GetPendingChangeMainLayout())}_MeasureDt(e){let t=0;if(this.IsExportToVideo())t=1/this.GetExportVideoFramerate(),this._dtRaw=t,this._dt1=t;else if(0!==this._lastTickTime){const s=Math.max(e-this._lastTickTime,0);.5<(t=s/1e3)&&(t=0),this._dtRaw=t,this._dt1=C33.clamp(t,this._minDt,this._maxDt)}this._lastTickTime=e,this._dt=this._dt1*this._timeScale,this._gameTime.Add(this._dt),this._gameTimeRaw.Add(t*this._timeScale),this._wallTime.Add(this._dt1);for(const[n,i]of this._instanceTimes)i.Add(this._dt1*n.GetTimeScale());this._canvasManager&&this._canvasManager._UpdateTick(),1e3<=e-this._fpsLastTime&&(this._fpsLastTime+=1e3,1e3<=e-this._fpsLastTime&&(this._fpsLastTime=e),this._fps=this._fpsFrameCount,this._fpsFrameCount=0,this._tps=this._tpsTickCount,this._tpsTickCount=0,this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1e3,1),this._mainThreadTimeCounter=0,this._canvasManager&&this._canvasManager._Update1sFrameRange(),this._collisionEngine._Update1sStats(),this.IsDebug())&&C3Debugger.Update1sPerfStats()}_SetTrackingInstanceTime(e,t){if(t){if(!this._instanceTimes.has(e)){const s=C33.New(C33.KahanSum);s.Copy(this._gameTime),this._instanceTimes.set(e,s)}}else this._instanceTimes.delete(e)}_GetInstanceGameTime(e){const t=this._instanceTimes.get(e);return t?t.Get():this.GetGameTime()}async _DoChangeLayout(e){const t=this._dispatcher,s=this.GetLayoutManager(),n=s.GetMainRunningLayout();await n._StopRunning(),n._Unload(e,this.GetRenderer()),n===e&&this._eventSheetManager.ClearAllScheduledWaits(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleasePendingInstances(),t.dispatchEvent(this._eventObjects.beforelayoutchange),C33.Asyncify.SetHighThroughputMode(!0),await e._Load(n,this.GetRenderer()),C33.Asyncify.SetHighThroughputMode(!1),await e._StartRunning(!1),t.dispatchEvent(this._eventObjects.layoutchange),this.UpdateRender(),this._isLayoutFirstTick=!0,this.FlushPendingInstances(),this._ExportToVideoAddKeyframe()}UpdateRender(){this._needRender=!0}GetWebGLRenderer(){return this._canvasManager?this._canvasManager.GetWebGLRenderer():null}GetWebGPURenderer(){return this._canvasManager?this._canvasManager.GetWebGPURenderer():null}GetRenderer(){return this._canvasManager?this._canvasManager.GetRenderer():null}Render(){const s=this._canvasManager;if(s&&!s.IsRendererContextLost()){const n=this.GetRenderer(),e=n.SupportsGPUProfiling(),i=e&&n.IsWebGL(),r=e&&n.IsWebGPU();if(i&&n.CheckForQueryResults(),this._needRender||this.IsExportToVideo()){const a=this._layoutManager.GetMainRunningLayout(),o=(this._fpsFrameCount++,n.Start(),this.IsDebug());o&&C3Debugger.StartMeasuringTime(),this._needRender=!1;let e=null,t=(i&&(e=s.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery(),n.StartQuery(e)),null);r&&(t=n.StartFrameTiming(2*(1+a.GetLayerCount())),n.StartMeasuringRenderPassTime(0,1)),this.Uses3DFeatures()&&"low"===s.GetCurrentFullscreenScalingQuality()?n.SetFixedSizeDepthBuffer(s.GetDrawWidth(),s.GetDrawHeight()):n.SetAutoSizeDepthBuffer(),this._Render(this.GetRenderer(),a),e&&n.EndQuery(e),r&&(n.StopMeasuringRenderPassTime(),this._canvasManager._AddWebGPUFrameTiming(t)),n.Finish(),o&&(C3Debugger.AddDrawCallsTime(),C3Debugger.UpdateInspectHighlight()),s&&s._MaybeTakeSnapshot()}else n.IncrementFrameNumber()}}_NeedsHTMLLayerCompositing(e){return"low"===this.GetCanvasManager().GetCurrentFullscreenScalingQuality()||e.IsWebGL()&&(this.UsesAnyBackgroundBlending()||this.Uses3DFeatures())}_Render(t,s){t.SetTextureFillMode(),t.SetAlphaBlend(),t.SetColorRgba(1,1,1,1),t.SetRenderTarget(null),t.SetTexture(null),t.SetDepthEnabled(this.Uses3DFeatures()),this._NeedsHTMLLayerCompositing(t)&&s._MaybeStartDrawToOwnTexture(t);const n=s.GetHTMLLayerCount();for(let e=1;e<n;++e)s.DrawForHTMLLayerIndex(t,e),t.IsWebGPU()&&t.Restart();this._NeedsHTMLLayerCompositing(t)||s._MaybeStartDrawToOwnTexture(t),s.DrawMain(t)}Trigger(e,t,s){if(!this._hasStarted)return!1;let n=!this._isInTick&&!this._eventSheetManager.IsInTrigger(),i=0;n&&(i=performance.now());const r=this.IsDebug(),a=(r&&this.SetDebuggingEnabled(!1),this._eventSheetManager._Trigger(this._layoutManager,e,t,s));if(n){const o=performance.now()-i;this._mainThreadTimeCounter+=o,r&&C3Debugger.AddTriggersTime(o)}return r&&this.SetDebuggingEnabled(!0),a}DebugTrigger(e,t,s){if(!this.IsDebugging())return this.Trigger(e,t,s);if(this.HitBreakpoint())throw new Error("called DebugTrigger() while stopped on breakpoint");if(this._isInTick||this._eventSheetManager.IsInTrigger())return this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s);throw new Error("called DebugTrigger() outside of event code - use TriggerAsync() instead")}async TriggerAsync(e,t,s){if(!this.IsDebugging())return this.Trigger(e,t,s);if(!this._hasStarted)return!1;if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(e,t,s);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(e,t,s);let n=performance.now(),i=this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s),r=i.next();for(;!r.done;)await this.DebugBreak(r.value),r=i.next();return this.IsSuspended()||this._eventSheetManager.IsInTrigger()||(await this._eventSheetManager.RunQueuedDebugTriggersAsync(),this._hasStartedTicking&&!this._isInTick&&this._RequestAnimationFrame()),this._mainThreadTimeCounter+=performance.now()-n,r.value}FastTrigger(e,t,s){const n=this.IsDebug(),i=(n&&this.SetDebuggingEnabled(!1),this._eventSheetManager._FastTrigger(this._layoutManager,e,t,s));return n&&this.SetDebuggingEnabled(!0),i}DebugFastTrigger(e,t,s){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,e,t,s)}ScheduleTriggers(e){return this._scheduleTriggersThrottle.Add(e)}PushCurrentLayout(e){this._currentLayoutStack.push(e)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw new Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){return this._currentLayoutStack.length?this._currentLayoutStack.at(-1):this.GetMainRunningLayout()}GetDt(e){return e&&-1!==e.GetTimeScale()?this._dt1*e.GetTimeScale():this._dt}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetDtRaw(){return this._dtRaw}GetTimeScale(){return this._timeScale}SetTimeScale(e){(isNaN(e)||e<0)&&(e=0),this._timeScale=e}SetMinDt(e){this._minDt=Math.max(e,0)}GetMinDt(){return this._minDt}SetMaxDt(e){this._maxDt=Math.max(e,0)}GetMaxDt(){return this._maxDt}GetFramesPerSecond(){return this._fps}GetTicksPerSecond(){return this._tps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(e){if(this._isLoadingState)throw new Error("cannot call while loading state - wait until afterload event");return this._instancesByUid.get(e)||null}_RefreshUidMap(){this._instancesByUid.clear();for(const e of this._allObjectClasses)if(!e.IsFamily())for(const t of e.GetInstances())this._instancesByUid.set(t.GetUID(),t)}IsPreview(){return"preview"===this._exportType}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsNWjs(){return"nwjs"===this.GetExportType()||this._isNWjs}IsCordova(){return"cordova"===this._exportType}IsAndroidWebView(){return"Android"===C33.Platform.OS&&("cordova"===this._exportType||"playable-ad-single-file"===this._exportType||"playable-ad-zip"===this._exportType||"instant-games"===this._exportType)}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}IsWindowsWebView2(){return this._isWindowsWebView2}IsAnyWebView2Wrapper(){return this._isAnyWebView2Wrapper}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._addonManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._addonManager.GetJumpthruBehavior()}Uses3DFeatures(){return this._uses3dFeatures}GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight())}GetDefaultCameraZ(e){return this.GetRenderer().GetDefaultCameraZ(e||this.GetViewportHeight())}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(e){this._isPixelRoundingEnabled!==(e=!!e)&&(this._isPixelRoundingEnabled=e,this.GetLayoutManager().SetAllLayerMVChanged(),this.UpdateRender())}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}GetTextIconSet(e){if(!this._iconChangeHandlers.has(e)){const s=()=>this.DeleteTextIconSet(e);this._iconChangeHandlers.set(e,s),e.Dispatcher().addEventListener("animationframeimagechange",s)}const t=this._textIconManager.GetIconSet(e);return t.HasLoaded()||t.LoadContent().then(()=>this.UpdateRender()),t}DeleteTextIconSet(e){this._textIconManager.DeleteIconSet(e)}_GetTextIconSetMeta(e){const t=[];for(const s of e.GetAnimations())for(const n of s.GetFrames()){const i=n.GetImageInfo();t.push({source:n,width:i.GetWidth(),height:i.GetHeight(),tag:n.GetTag()})}return{icons:t}}async _GetTextIconSetContent(e){const t=C33.New(C33.PromiseThrottle),s=[],i=new Map;for(const a of e.GetAnimations())for(const o of a.GetFrames()){const l=o.GetImageInfo().GetImageAsset();i.has(l)||(i.set(l,null),s.push(t.Add(async()=>{const e=await l.LoadToDrawable();i.set(l,e)})))}await Promise.all(s);const n=[];for(const h of e.GetAnimations())for(const c of h.GetFrames())n.push(t.Add(async()=>{const e=c.GetImageInfo(),t=i.get(e.GetImageAsset()),s=await e.ExtractImageToCanvas(t),n=await createImageBitmap(s);return{drawable:n}}));const r=await Promise.all(n);for(const u of i.values())u instanceof ImageBitmap&&u.close&&u.close();return{icons:r}}SaveToSlot(e){this._saveToSlotName=e,this._saveToJsonString=!1}SaveToJsonString(){this._saveToSlotName="",this._saveToJsonString=!0}LoadFromSlot(e){this._loadFromSlotName=e}LoadFromJsonString(e){this._loadFromJson=e}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!!(this._saveToSlotName||this._saveToJsonString||this._loadFromSlotName||null!==this._loadFromJson)}async _HandleSaveOrLoad(){if(this._saveToSlotName&&(this.FlushPendingInstances(),await this._DoSaveToSlot(this._saveToSlotName),this._ClearSaveOrLoad()),this._loadFromSlotName&&(await this._DoLoadFromSlot(this._loadFromSlotName),this._ClearSaveOrLoad(),this.IsDebug())&&C3Debugger.StepIfPausedInDebugger(),this._saveToJsonString){const e=await this._SaveToJsonString();this._lastSaveJson=e,await this.TriggerAsync(C33.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson="",this._ClearSaveOrLoad()}if(null!==this._loadFromJson){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson),this._lastSaveJson=this._loadFromJson,await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(e){console.error("[Construct] Failed to load state from JSON string: ",e),await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._saveToSlotName="",this._saveToJsonString=!1,this._loadFromSlotName="",this._loadFromJson=null}_GetProjectStorage(){return this._projectStorage||(this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._projectStorage}_GetSavegamesStorage(){return this._savegamesStorage||(this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._savegamesStorage}async _DoSaveToSlot(e){const t=await this._SaveToJsonString();try{await this._GetSavegamesStorage().setItem(e,t),console.log("[Construct] Saved state to storage ("+t.length+" chars)"),this._lastSaveJson=t,await this.TriggerAsync(C33.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson=""}catch(e){console.error("[Construct] Failed to save state to storage: ",e),await this.TriggerAsync(C33.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(e){try{const t=await this._GetSavegamesStorage().getItem(e);if(!t)throw new Error("empty slot");console.log("[Construct] Loaded state from storage ("+t.length+" chars)"),await this._DoLoadFromJsonString(t),this._lastSaveJson=t,await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(e){console.error("[Construct] Failed to load state from storage: ",e),await this.TriggerAsync(C33.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){const e={c3save:!0,version:1,rt:{time:this.GetGameTime(),timeRaw:this.GetGameTimeRaw(),walltime:this.GetWallTime(),timescale:this.GetTimeScale(),tickcount:this.GetTickCount(),next_uid:this._nextUid,running_layout:this.GetMainRunningLayout().GetSID(),start_time_offset:Date.now()-this._startTime},types:{},layouts:{},events:this._eventSheetManager._SaveToJson(),timelines:this._timelineManager._SaveToJson(),user_script_data:null};for(const s of this._allObjectClasses)s.IsFamily()||s.HasNoSaveBehavior()||(e.types[s.GetSID().toString()]=s._SaveToJson());for(const n of this._layoutManager.GetAllLayouts())e.layouts[n.GetSID().toString()]=n._SaveToJson();const t=this._CreateUserScriptEvent("save");return t.saveData=null,await this.DispatchUserScriptEventAsyncWait(t),e.user_script_data=t.saveData,JSON.stringify(e)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(e){const t=this.GetLayoutManager(),s=JSON.parse(e);if(s.c2save)throw new Error("C2 saves are incompatible with C3 runtime");if(!s.c3save)throw new Error("not valid C3 save data");if(1<s.version)throw new Error("C3 save data from future version");this.ClearIntancesNeedingAfterLoad(),this._dispatcher.dispatchEvent(C33.New(C33.Event,"beforeload"));for(const l of this.allInstances()){const h=l.GetObjectClass();h.HasNoSaveBehavior()||l._OnBeforeLoad()}let n=s.rt,i=(this._gameTime.Set(n.time),n.hasOwnProperty("timeRaw")&&this._gameTimeRaw.Set(n.timeRaw),this._wallTime.Set(n.walltime),this._timeScale=n.timescale,this._tickCount=n.tickcount,this._startTime=Date.now()-n.start_time_offset,n.running_layout),r=!(this._isLoadingState=!0);if(i!==this.GetMainRunningLayout().GetSID()){const c=t.GetLayoutBySID(i);if(!c)return;await this._DoChangeLayout(c),r=!0}for(const[u,d]of Object.entries(s.layouts)){const _=parseInt(u,10),p=t.GetLayoutBySID(_);p&&p._LoadFromJson(d)}const a=new Set;for(const[m,g]of Object.entries(s.types)){const f=parseInt(m,10),S=this.GetObjectClassBySID(f);!S||S.IsFamily()||S.HasNoSaveBehavior()||S._LoadFromJson(g,a)}for(const y of this._layoutManager.GetAllLayouts())for(const C of y.allLayers())C._LoadFromJsonAfterInstances();if(this.FlushPendingInstances(),this._RefreshUidMap(),this._isLoadingState=!1,r){for(const G of this.allInstances())G.SetupInitialSceneGraphConnections();for(const[T,I]of Object.entries(s.types)){const b=parseInt(T,10),A=this.GetObjectClassBySID(b);!A||A.IsFamily()||A.HasNoSaveBehavior()||A._SetupSceneGraphConnectionsOnChangeOfLayout(I)}}this._nextUid=n.next_uid,this._eventSheetManager._LoadFromJson(s.events);for(const P of this._allObjectClasses)if(!P.IsFamily()&&P.IsInContainer())for(const E of P.GetInstances()){const v=E.GetIID();for(const R of P.GetContainer().objectTypes())if(R!==P){const x=R.GetInstances();if(v<0||v>=x.length)throw new Error("missing sibling instance");E._AddSibling(x[v])}}this._timelineManager._LoadFromJson(s.timelines),t.SetAllLayerProjectionChanged(),t.SetAllLayerMVChanged();for(const w of a)w._OnCreatedForLoadingSavegame();this.DoAfterLoad(),this._dispatcher.dispatchEvent(C33.New(C33.Event,"afterload")),this.DispatchUserScriptEvent(this._CreateUserScriptEvent("afterload"));for(const[D,M]of Object.entries(s.types)){const O=parseInt(D,10),F=this.GetObjectClassBySID(O);F&&F._ClearLoadInstancesJson()}const o=this._CreateUserScriptEvent("load");o.saveData=s.user_script_data,await this.DispatchUserScriptEventAsyncWait(o),this.UpdateRender()}SortOnTmpHierarchyPosition(e,t){return e.GetWorldInfo().GetTmpHierarchyPosition()-t.GetWorldInfo().GetTmpHierarchyPosition()}AddInstanceNeedingAfterLoad(e,t){e.GetWorldInfo()&&!this._instancesNeedingAfterLoadMap.has(e)&&(this._instancesNeedingAfterLoadMap.set(e,t),this._instancesNeedingAfterLoadArray.push(e))}ClearIntancesNeedingAfterLoad(){this._instancesNeedingAfterLoadMap=new WeakMap,C33.clearArray(this._instancesNeedingAfterLoadArray)}DoAfterLoad(e="full",t=null){this._instancesNeedingAfterLoadArray.sort(this.SortOnTmpHierarchyPosition);for(const s of this._instancesNeedingAfterLoadArray)s._OnAfterLoad(this._instancesNeedingAfterLoadMap.get(s),e,t);for(const n of this._instancesNeedingAfterLoadArray)n._OnAfterLoad2(this._instancesNeedingAfterLoadMap.get(n),e,t);this.ClearIntancesNeedingAfterLoad()}async AddJobWorkerScripts(e){const t=await Promise.all(e.map(async e=>{const t=this.IsCordova()&&this._assetManager.IsFileProtocol();if(t||"playable-ad-single-file"===this.GetExportType()){const s=await this._assetManager.FetchBlob(e);return URL.createObjectURL(s)}return new URL(e,location.href).toString()}));this._jobScheduler.ImportScriptsToJobWorkers(t)}AddJobWorkerBlob(e,t){this._jobScheduler.SendBlobToJobWorkers(e,t)}AddJobWorkerBuffer(e,t){this._jobScheduler.SendBufferToJobWorkers(e,t)}AddJob(e,t,s,n){return this._jobScheduler.AddJob(e,t,s,null,null,n)}BroadcastJob(e,t,s,n){return this._jobScheduler.BroadcastJob(e,t,s,n)}GetMaxNumJobWorkers(){return this._jobScheduler.GetMaxNumWorkers()}InvokeDownload(e,t){this.PostComponentMessageToDOM("runtime","invoke-download",{url:e,filename:t})}async RasterSvgImage(e,t,s,n,i,r){if(n=n||t,i=i||s,this.IsInWorker()){const a=await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{blob:e,imageWidth:t,imageHeight:s,surfaceWidth:n,surfaceHeight:i,imageBitmapOpts:r});return a.imageBitmap}{const o=await self.C3_RasterSvgImageBlob(e,t,s,n,i);return r?self.createImageBitmap(o,r):o}}async GetSvgImageSize(e){return this.IsInWorker()?this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{blob:e}):self.C3_GetSvgImageSize(e)}RequestDeviceOrientationEvent(){this._didRequestDeviceOrientationEvent||(this._didRequestDeviceOrientationEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-orientation"))}RequestDeviceMotionEvent(){this._didRequestDeviceMotionEvent||(this._didRequestDeviceMotionEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-motion"))}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(e){this._randomNumberCallback=e}_GetRemotePreviewStatusInfo(){const e=this.GetRenderer();return{fps:this.GetFramesPerSecond(),tps:this.GetTicksPerSecond(),cpu:this.GetMainThreadTime(),gpu:this.GetGPUUtilisation(),layout:this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"",renderer:e.IsWebGL()?e.GetUnmaskedRenderer():e.GetAdapterInfoString()}}HitBreakpoint(){return!!this.IsDebug()&&C3Debugger.HitBreakpoint()}DebugBreak(e){return this.IsDebugging()?C3Debugger.DebugBreak(e):Promise.resolve()}DebugBreakNext(){return!!this.IsDebugging()&&C3Debugger.BreakNext()}SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=!!e,this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(e){e?this._debuggingDisabled--:this._debuggingDisabled++,this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&0===this._debuggingDisabled}IsCPUProfiling(){return this.IsDebug()&&C3Debugger.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&C3Debugger.IsGPUProfiling()}async DebugIterateAndBreak(e){if(e)for(const t of e)await this.DebugBreak(t)}DebugFireGeneratorEventAndBreak(e){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(e))}_InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e.name,e.params)}_GetHTMLLayerWrapElement(e){if(this.IsInWorker())throw new Error("not supported in worker mode");return self.c3_runtimeInterface._GetHTMLWrapElement(e)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(e){const t=C33.New(C33.Event,e,!1);return t.runtime=this._iRuntime,t}_InitScriptInterfaces(){this._iRuntime=new self.IRuntime(this),this._userScriptEventObjects={tick:this._CreateUserScriptEvent("tick")}}_InitObjectsScriptInterface(){const e={};for(const t of this._allObjectClasses)e[t.GetJsPropName()]={value:t.GetIObjectClass(),enumerable:!0,writable:!1};this._iRuntime._InitObjects(e)}_InitGlobalVariableScriptInterface(){const e={};for(const t of this.GetEventSheetManager().GetAllGlobalVariables())e[t.GetJsPropName()]=t._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(e)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(e,t){this._interfaceMap.set(e,t)}_UnwrapScriptInterface(e){return this._interfaceMap.get(e)}_UnwrapIObjectClass(e){if(!(e instanceof self.IObjectClass))throw new TypeError("expected IObjectClass");const t=this._UnwrapScriptInterface(e);if(t&&t instanceof C33.ObjectClass)return t;throw new Error("invalid IObjectClass")}_UnwrapIInstance(e){if(!(e instanceof self.IInstance))throw new TypeError("expected IInstance");const t=this._UnwrapScriptInterface(e);if(t&&t instanceof C33.Instance)return t;throw new Error("invalid IInstance")}_UnwrapIWorldInstance(e){if(!(e instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");const t=this._UnwrapScriptInterface(e);if(t&&t instanceof C33.Instance)return t;throw new Error("invalid IInstance")}},self.C3_CreateRuntime=C33.Runtime.Create,self.C3_InitRuntime=(e,t)=>e.Init(t)}{const C33=self.C3;C33.JobSchedulerRuntime=class extends C33.DefendedBase{constructor(e,t){super(),this._runtime=e,this._jobPromises=new Map,this._nextJobId=0,this._inputPort=t.inputPort,t.outputPort.onmessage=e=>this._OnJobWorkerMessage(e),this._maxNumWorkers=t.maxNumWorkers,this._jobWorkerCount=1,this._isCreatingWorker=!1,this._hadErrorCreatingWorker=!1}async Init(){}GetMaxNumWorkers(){return this._maxNumWorkers}ImportScriptsToJobWorkers(e){this._inputPort.postMessage({type:"_import_scripts",scripts:e})}SendBlobToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_blob",blob:e,id:t})}SendBufferToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_buffer",buffer:e,id:t},[e])}AddJob(e,t,s,n,i,r){if(s=s||[],"number"==typeof r&&(r=Math.floor(r))<=0)throw new Error("invalid maxWorkerNum");const a=this._nextJobId++,o={type:e,isBroadcast:!1,maxWorkerNum:r,jobId:a,params:t,transferables:s},l=new Promise((e,t)=>{this._jobPromises.set(a,{resolve:e,progress:n,reject:t,cancelled:!1,maxWorkerNum:r})});return i&&i.SetAction(()=>this._CancelJob(a)),this._inputPort.postMessage(o,s),this._MaybeCreateExtraWorker(),l}BroadcastJob(e,t,s,n){if(s=s||[],"number"==typeof n&&(n=Math.floor(n))<=0)throw new Error("invalid maxWorkerNum");const i=this._nextJobId++,r={type:e,isBroadcast:!0,maxWorkerNum:n,jobId:i,params:t,transferables:s};this._inputPort.postMessage(r,s)}_CancelJob(e){const t=this._jobPromises.get(e);t&&(t.cancelled=!0,t.resolve=null,t.progress=null,t.reject=null,this._inputPort.postMessage({type:"_cancel",jobId:e}))}_OnJobWorkerMessage(e){const t=e.data,s=t.type,n=t.jobId;switch(s){case"result":this._OnJobResult(n,t.result);break;case"progress":this._OnJobProgress(n,t.progress);break;case"error":this._OnJobError(n,t.error);break;case"ready":this._OnJobWorkerReady();break;default:throw new Error(`unknown message from worker '${s}'`)}}_OnJobResult(e,t){const s=this._jobPromises.get(e);if(!s)throw new Error("invalid job ID");s.cancelled||s.resolve(t),this._jobPromises.delete(e)}_OnJobProgress(e,t){const s=this._jobPromises.get(e);if(!s)throw new Error("invalid job ID");!s.cancelled&&s.progress&&s.progress(t)}_OnJobError(e,t){const s=this._jobPromises.get(e);if(!s)throw new Error("invalid job ID");s.cancelled||s.reject(t),this._jobPromises.delete(e)}_OnJobWorkerReady(){this._isCreatingWorker&&(this._isCreatingWorker=!1,this._jobWorkerCount++,this._jobWorkerCount<this._maxNumWorkers?this._MaybeCreateExtraWorker():this._inputPort.postMessage({type:"_no_more_workers"}))}_GetWorkerCountNeededForPendingJobs(){let e=0,t=[...this._jobPromises.values()].sort((e,t)=>{const s=e.maxWorkerNum||1/0,n=t.maxWorkerNum||1/0;return s-n});for(const s of t){const n=s.maxWorkerNum||1/0;e<n&&e++}return e}async _MaybeCreateExtraWorker(){if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._GetWorkerCountNeededForPendingJobs()<=this._jobWorkerCount))try{this._isCreatingWorker=!0;const e=await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker");e.outputPort.onmessage=e=>this._OnJobWorkerMessage(e)}catch(e){this._hadErrorCreatingWorker=!0,this._isCreatingWorker=!1,console.error(`[Construct] Failed to create job worker; stopping creating any more (created ${this._jobWorkerCount} so far)`,e)}}}}self.C3_Shaders={},self.C3_Shaders.ultimatedropshadowcolor={glsl:"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vTex;\nuniform sampler2D samplerFront;\nuniform float uDistance;\nuniform float uAngle;\nuniform float uOpacity;\nuniform float uHue;\nuniform float uSaturation;\nuniform float uBrightness;\nuniform float uBlurRadius;\nvec3 rgb2hsv(vec3 c);\nvec3 hsv2rgb(vec3 c);\nvoid main(void) {\nfloat angleRad = uAngle * 3.14159265 / 180.0;\nvec2 offset = uDistance * 0.001 * vec2(cos(angleRad), sin(angleRad));\nvec4 shadow = vec4(0.0);\nfor(int i = -4; i <= 4; i++) {\nfor(int j = -4; j <= 4; j++) {\nvec2 sampledCoord = vTex + offset + vec2(i, j) * (uBlurRadius * 0.01) * 0.001;\nshadow += texture2D(samplerFront, sampledCoord);\n}\n}\nshadow /= 81.0;\nshadow.a *= uOpacity;\nshadow.rgb = vec3(1.0, 0.0, 0.0);\nvec3 shadowHSV = rgb2hsv(shadow.rgb);\nshadowHSV.x = mod(shadowHSV.x + uHue / 360.0, 1.0); // Normalize hue to [0, 1] range and ensure it wraps around\nshadowHSV.y = uSaturation;\nshadowHSV.z = uBrightness;\nshadow.rgb = hsv2rgb(shadowHSV);\nvec4 col = texture2D(samplerFront, vTex);\nvec4 shadowColor = mix(col, shadow, shadow.a);\ngl_FragColor = mix(shadowColor, col, col.a);\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\nvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}",glslWebGL2:"",wgsl:"",blendsBackground:!0,usesDepth:!1,extendBoxHorizontal:55,extendBoxVertical:55,crossSampling:!0,mustPreDraw:!1,preservesOpaqueness:!1,supports3dDirectRendering:!1,animated:!1,parameters:[["uDistance",0,"float"],["uAngle",0,"float"],["uOpacity",0,"percent"],["uHue",0,"float"],["uSaturation",0,"percent"],["uBrightness",0,"percent"],["uBlurRadius",0,"float"]]},self.C3_Shaders.tint={glsl:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform lowp vec3 tintColor;\nvoid main(void)\n{\nlowp vec4 front = texture2D(samplerFront, vTex);\ngl_FragColor = front * vec4(tintColor.r, tintColor.g, tintColor.b, 1.0);\n}",glslWebGL2:"",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\nstruct ShaderParams {\ntintColor : vec3<f32>\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n@fragment\nfn main(input : FragmentInput) -> FragmentOutput {\nvar front : vec4<f32> = textureSample(textureFront, samplerFront, input.fragUV);\nvar output : FragmentOutput;\noutput.color = front * vec4<f32>(shaderParams.tintColor, 1.0);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,supports3dDirectRendering:!1,animated:!1,parameters:[["tintColor",0,"color"]]},self.C3_Shaders.hsladjust={glsl:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nprecision mediump float;\nuniform float huerotate;\nuniform float satadjust;\nuniform float lumadjust;\nvec3 rgb_to_hsl(vec3 color)\n{\nvec3 hsl = vec3(0.0, 0.0, 0.0);\nfloat fmin = min(min(color.r, color.g), color.b);\nfloat fmax = max(max(color.r, color.g), color.b);\nfloat delta = fmax - fmin;\nhsl.z = (fmax + fmin) / 2.0;\nif (delta == 0.0)\n{\nhsl.x = 0.0;\nhsl.y = 0.0;\n}\nelse\n{\nif (hsl.z < 0.5)\nhsl.y = delta / (fmax + fmin);\nelse\nhsl.y = delta / (2.0 - fmax - fmin);\nfloat dR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;\nfloat dG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;\nfloat dB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;\nif (color.r == fmax)\nhsl.x = dB - dG;\nelse if (color.g == fmax)\nhsl.x = (1.0 / 3.0) + dR - dB;\nelse if (color.b == fmax)\nhsl.x = (2.0 / 3.0) + dG - dR;\nif (hsl.x < 0.0)\nhsl.x += 1.0;\nelse if (hsl.x > 1.0)\nhsl.x -= 1.0;\n}\nreturn hsl;\n}\nfloat hue_to_rgb(float f1, float f2, float hue)\n{\nif (hue < 0.0)\nhue += 1.0;\nelse if (hue > 1.0)\nhue -= 1.0;\nfloat ret;\nif ((6.0 * hue) < 1.0)\nret = f1 + (f2 - f1) * 6.0 * hue;\nelse if ((2.0 * hue) < 1.0)\nret = f2;\nelse if ((3.0 * hue) < 2.0)\nret = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\nelse\nret = f1;\nreturn ret;\n}\nvec3 hsl_to_rgb(vec3 hsl)\n{\nvec3 rgb = vec3(hsl.z);\nif (hsl.y != 0.0)\n{\nfloat f2;\nif (hsl.z < 0.5)\nf2 = hsl.z * (1.0 + hsl.y);\nelse\nf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);\nfloat f1 = 2.0 * hsl.z - f2;\nrgb.r = hue_to_rgb(f1, f2, hsl.x + (1.0 / 3.0));\nrgb.g = hue_to_rgb(f1, f2, hsl.x);\nrgb.b = hue_to_rgb(f1, f2, hsl.x - (1.0 / 3.0));\n}\nreturn rgb;\n}\nvoid main(void)\n{\nvec4 front = texture2D(samplerFront, vTex);\nvec3 rgb = rgb_to_hsl(front.rgb) + vec3((huerotate > 0.5 ? huerotate - 1.0 : huerotate), 0, (lumadjust - 1.0) * front.a);\nrgb.y *= satadjust;\nrgb = hsl_to_rgb(rgb);\ngl_FragColor = vec4(rgb, front.a);\n}",glslWebGL2:"",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\nstruct ShaderParams {\nhuerotate : f32,\nsatadjust : f32,\nlumadjust : f32\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n@fragment\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar front : vec4<f32> = textureSample(textureFront, samplerFront, input.fragUV);\nvar huerotate : f32 = shaderParams.huerotate;\nif (huerotate > 0.5)\n{\nhuerotate = huerotate - 1.0;\n}\nvar rgb : vec3<f32> = c3_RGBtoHSL(front.rgb) + vec3<f32>(huerotate, 0.0, (shaderParams.lumadjust - 1.0) * front.a);\nrgb.y = rgb.y * shaderParams.satadjust;\nrgb = c3_HSLtoRGB(rgb);\nvar output : FragmentOutput;\noutput.color = vec4<f32>(rgb, front.a);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,supports3dDirectRendering:!1,animated:!1,parameters:[["huerotate",0,"percent"],["satadjust",0,"percent"],["lumadjust",0,"percent"]]},self.C3_Shaders.replacecolor={glsl:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform lowp vec3 sourceColor;\nuniform lowp vec3 destColor;\nuniform lowp float tolerance;\nvoid main(void)\n{\nlowp vec4 front = texture2D(samplerFront, vTex);\nlowp float a = front.a;\nif (a != 0.0)\nfront.rgb /= a;\nlowp float diff = length(front.rgb - sourceColor);\nif (diff <= tolerance)\n{\nfront.rgb = mix(front.rgb, destColor, 1.0 - diff / tolerance);\n}\nfront.rgb *= a;\ngl_FragColor = front;\n}",glslWebGL2:"",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\nstruct ShaderParams {\nsourceColor : vec3<f32>,\ndestColor : vec3<f32>,\ntolerance : f32\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n@fragment\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar front : vec4<f32> = c3_unpremultiply(textureSample(textureFront, samplerFront, input.fragUV));\nvar rgb : vec3<f32> = front.rgb;\nvar diff : f32 = length(rgb - shaderParams.sourceColor);\nif (diff <= shaderParams.tolerance)\n{\nrgb = mix(rgb, shaderParams.destColor, 1.0 - diff / shaderParams.tolerance);\n}\nvar output : FragmentOutput;\noutput.color = vec4<f32>(rgb * front.a, front.a);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,supports3dDirectRendering:!1,animated:!1,parameters:[["sourceColor",0,"color"],["destColor",0,"color"],["tolerance",0,"percent"]]},self.C3_Shaders.grayscale={glsl:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform lowp float intensity;\nvoid main(void)\n{\nlowp vec4 front = texture2D(samplerFront, vTex);\nlowp float gray = front.r * 0.299 + front.g * 0.587 + front.b * 0.114;\ngl_FragColor = mix(front, vec4(gray, gray, gray, front.a), intensity);\n}",glslWebGL2:"",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\nstruct ShaderParams {\nintensity : f32\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n@fragment\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar front : vec4<f32> = textureSample(textureFront, samplerFront, input.fragUV);\nvar gray : f32 = c3_grayscale(front.rgb);\nvar output : FragmentOutput;\noutput.color = mix(front, vec4<f32>(gray, gray, gray, front.a), shaderParams.intensity);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,supports3dDirectRendering:!1,animated:!1,parameters:[["intensity",0,"percent"]]};{let ForEachOrdered_SortInstances2=function(e,t){const s=e[1],n=t[1];if("number"==typeof s&&"number"==typeof n)return s-n;{const i=""+s,r=""+n;return i<r?-1:r<i?1:0}},a=(ForEachOrdered_SortInstances=ForEachOrdered_SortInstances2,self.C3),r=null,n="",s="",o=[],u="",l="",c="",i=a.New(a.ArrayStack);a.Plugins.System=class extends a.SDKPluginBase{constructor(e){super(e),this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack(),this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._imagesLoadingTotal=0,this._imagesLoadingComplete=0,this._functionMaps=new Map}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(e){this._runtime.Trigger(e,null,null)}GetRegex(e,t){return r&&e===n&&t===s||(r=new RegExp(e,t),n=e,s=t),r.lastIndex=0,r}GetRegexMatches(e,t,s){if(e!==u||t!==l||s!==c){const n=this.GetRegex(t,s);o=e.match(n),u=e,l=t,c=s}return o}async _LoadTexturesForObjectClasses(e,t){if(t.length){this._imagesLoadingTotal+=t.length;const s=[];for(const n of t)s.push(e.MaybeLoadTexturesFor(n));await a.PromiseAllWithProgress(s,()=>{this._imagesLoadingComplete++}),this._imagesLoadingComplete++,this._imagesLoadingComplete===this._imagesLoadingTotal&&(this._imagesLoadingComplete=0,this._imagesLoadingTotal=0,this._runtime.Trigger(a.Plugins.System.Cnds.OnImageLoadingComplete,null,null))}}_UnloadTexturesForObjectClasses(e,t){for(const s of t)0===s.GetInstanceCount()&&e.MaybeUnloadTexturesFor(s)}_GetForEachStack(){return i}_Repeat(t){const s=this._runtime.GetEventSheetManager(),e=s.GetEventStack(),n=e.GetCurrentStackFrame(),i=n.GetCurrentEvent(),r=i.GetSolModifiers(),a=n.IsSolModifierAfterCnds(),o=e.Push(i),l=s.GetLoopStack(),h=l.Push();if(h.SetEnd(t),a)for(let e=0;e<t&&!h.IsStopped();++e)s.PushCopySol(r),h.SetIndex(e),i.Retrigger(n,o),s.PopSol(r);else for(let e=0;e<t&&!h.IsStopped();++e)h.SetIndex(e),i.Retrigger(n,o);return e.Pop(),l.Pop(),!1}*_DebugRepeat(t){const s=this._runtime.GetEventSheetManager(),e=s.GetEventStack(),n=e.GetCurrentStackFrame(),i=n.GetCurrentEvent(),r=i.GetSolModifiers(),a=n.IsSolModifierAfterCnds(),o=e.Push(i),l=s.GetLoopStack(),h=l.Push();if(h.SetEnd(t),a)for(let e=0;e<t&&!h.IsStopped();++e)s.PushCopySol(r),h.SetIndex(e),yield*i.DebugRetrigger(n,o),s.PopSol(r);else for(let e=0;e<t&&!h.IsStopped();++e)h.SetIndex(e),yield*i.DebugRetrigger(n,o);return e.Pop(),l.Pop(),!1}_While(){const t=this._runtime.GetEventSheetManager(),e=t.GetEventStack(),s=e.GetCurrentStackFrame(),n=s.GetCurrentEvent(),i=n.GetSolModifiers(),r=s.IsSolModifierAfterCnds(),a=e.Push(n),o=t.GetLoopStack(),l=o.Push();if(r)for(let e=0;!l.IsStopped();++e)t.PushCopySol(i),l.SetIndex(e),n.Retrigger(s,a)||l.Stop(),t.PopSol(i);else for(let e=0;!l.IsStopped();++e)l.SetIndex(e),n.Retrigger(s,a)||l.Stop();return e.Pop(),o.Pop(),!1}*_DebugWhile(){const t=this._runtime.GetEventSheetManager(),e=t.GetEventStack(),s=e.GetCurrentStackFrame(),n=s.GetCurrentEvent(),i=n.GetSolModifiers(),r=s.IsSolModifierAfterCnds(),a=e.Push(n),o=t.GetLoopStack(),l=o.Push();if(r)for(let e=0;!l.IsStopped();++e){t.PushCopySol(i),l.SetIndex(e);const h=yield*n.DebugRetrigger(s,a);h||l.Stop(),t.PopSol(i)}else for(let e=0;!l.IsStopped();++e){l.SetIndex(e);const c=yield*n.DebugRetrigger(s,a);c||l.Stop()}return e.Pop(),o.Pop(),!1}_For(e,t,s){const n=this._runtime.GetEventSheetManager(),i=n.GetEventStack(),r=i.GetCurrentStackFrame(),a=r.GetCurrentEvent(),o=a.GetSolModifiers(),l=r.IsSolModifierAfterCnds(),h=i.Push(a),c=n.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(l)for(let e=t;e>=s&&!u.IsStopped();--e)n.PushCopySol(o),u.SetIndex(e),a.Retrigger(r,h),n.PopSol(o);else for(let e=t;e>=s&&!u.IsStopped();--e)u.SetIndex(e),a.Retrigger(r,h);else if(l)for(let e=t;e<=s&&!u.IsStopped();++e)n.PushCopySol(o),u.SetIndex(e),a.Retrigger(r,h),n.PopSol(o);else for(let e=t;e<=s&&!u.IsStopped();++e)u.SetIndex(e),a.Retrigger(r,h);return i.Pop(),c.Pop(),!1}*_DebugFor(e,t,s){const n=this._runtime.GetEventSheetManager(),i=n.GetEventStack(),r=i.GetCurrentStackFrame(),a=r.GetCurrentEvent(),o=a.GetSolModifiers(),l=r.IsSolModifierAfterCnds(),h=i.Push(a),c=n.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(l)for(let e=t;e>=s&&!u.IsStopped();--e)n.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(r,h),n.PopSol(o);else for(let e=t;e>=s&&!u.IsStopped();--e)u.SetIndex(e),yield*a.DebugRetrigger(r,h);else if(l)for(let e=t;e<=s&&!u.IsStopped();++e)n.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(r,h),n.PopSol(o);else for(let e=t;e<=s&&!u.IsStopped();++e)u.SetIndex(e),yield*a.DebugRetrigger(r,h);return i.Pop(),c.Pop(),!1}_ForEach(s){const e=s.GetCurrentSol(),t=e.GetInstances();if(0!==t.length){const n=this._runtime.GetEventSheetManager(),r=n.GetEventStack(),o=r.GetCurrentStackFrame(),l=o.GetCurrentEvent(),h=l.GetSolModifiers(),c=o.IsSolModifierAfterCnds(),u=r.Push(l),d=n.GetLoopStack(),_=d.Push(),p=s.IsInContainer(),m=i.Push();if(a.shallowAssignArray(m,t),_.SetEnd(m.length),c)for(let e=0,t=m.length;e<t&&!_.IsStopped();++e){n.PushCopySol(h);const g=m[e];s.GetCurrentSol().SetSinglePicked(g),p&&g.SetSiblingsSinglePicked(),_.SetIndex(e),l.Retrigger(o,u),n.PopSol(h)}else{e._SetSelectAll(!1);const f=e._GetOwnInstances();a.clearArray(f),f.push(null);for(let e=0,t=m.length;e<t&&!_.IsStopped();++e){const S=m[e];f[0]=S,p&&S.SetSiblingsSinglePicked(),_.SetIndex(e),l.Retrigger(o,u)}}r.Pop(),d.Pop(),a.clearArray(m),i.Pop()}return!1}*_DebugForEach(s){const e=s.GetCurrentSol(),t=e.GetInstances();if(0!==t.length){const n=this._runtime.GetEventSheetManager(),r=n.GetEventStack(),o=r.GetCurrentStackFrame(),l=o.GetCurrentEvent(),h=l.GetSolModifiers(),c=o.IsSolModifierAfterCnds(),u=r.Push(l),d=n.GetLoopStack(),_=d.Push(),p=s.IsInContainer(),m=i.Push();if(a.shallowAssignArray(m,t),_.SetEnd(m.length),c)for(let e=0,t=m.length;e<t&&!_.IsStopped();++e){n.PushCopySol(h);const g=m[e];s.GetCurrentSol().SetSinglePicked(g),p&&g.SetSiblingsSinglePicked(),_.SetIndex(e),yield*l.DebugRetrigger(o,u),n.PopSol(h)}else{e._SetSelectAll(!1);const f=e._GetOwnInstances();a.clearArray(f),f.push(null);for(let e=0,t=m.length;e<t&&!_.IsStopped();++e){const S=m[e];f[0]=S,p&&S.SetSiblingsSinglePicked(),_.SetIndex(e),yield*l.DebugRetrigger(o,u)}}r.Pop(),d.Pop(),a.clearArray(m),i.Pop()}return!1}_ForEachOrdered(s,e){const t=s.GetCurrentSol(),n=t.GetInstances();if(0!==n.length){const r=this._runtime.GetEventSheetManager(),o=r.GetEventStack(),l=r.GetCurrentCondition(),h=o.GetCurrentStackFrame(),c=h.GetCurrentEvent(),u=c.GetSolModifiers(),d=h.IsSolModifierAfterCnds(),_=o.Push(c),p=r.GetLoopStack(),m=p.Push(),g=s.IsInContainer(),f=i.Push();a.clearArray(f),m.SetEnd(n.length);for(let e=0,t=n.length;e<t;++e)f.push([n[e],l.ReevaluateParameter(1,e)]);if(f.sort(ForEachOrdered_SortInstances2),1===e&&f.reverse(),d)for(let e=0,t=f.length;e<t&&!m.IsStopped();++e){r.PushCopySol(u);const S=f[e][0];s.GetCurrentSol().SetSinglePicked(S),g&&S.SetSiblingsSinglePicked(),m.SetIndex(e),c.Retrigger(h,_),r.PopSol(u)}else{t._SetSelectAll(!1);const y=t._GetOwnInstances();a.clearArray(y),y.push(null);for(let e=0,t=f.length;e<t&&!m.IsStopped();++e){const C=f[e][0];y[0]=C,g&&C.SetSiblingsSinglePicked(),m.SetIndex(e),c.Retrigger(h,_)}}o.Pop(),p.Pop(),a.clearArray(f),i.Pop()}return!1}*_DebugForEachOrdered(s,e){const t=s.GetCurrentSol(),n=t.GetInstances();if(0!==n.length){const r=this._runtime.GetEventSheetManager(),o=r.GetEventStack(),l=r.GetCurrentCondition(),h=o.GetCurrentStackFrame(),c=h.GetCurrentEvent(),u=c.GetSolModifiers(),d=h.IsSolModifierAfterCnds(),_=o.Push(c),p=r.GetLoopStack(),m=p.Push(),g=s.IsInContainer(),f=i.Push();a.clearArray(f),m.SetEnd(n.length);for(let e=0,t=n.length;e<t;++e)f.push([n[e],l.ReevaluateParameter(1,e)]);if(f.sort(ForEachOrdered_SortInstances2),1===e&&f.reverse(),d)for(let e=0,t=f.length;e<t&&!m.IsStopped();++e){r.PushCopySol(u);const S=f[e][0];s.GetCurrentSol().SetSinglePicked(S),g&&S.SetSiblingsSinglePicked(),m.SetIndex(e),yield*c.DebugRetrigger(h,_),r.PopSol(u)}else{t._SetSelectAll(!1);const y=t._GetOwnInstances();a.clearArray(y),y.push(null);for(let e=0,t=f.length;e<t&&!m.IsStopped();++e){const C=f[e][0];y[0]=C,g&&C.SetSiblingsSinglePicked(),m.SetIndex(e),yield*c.DebugRetrigger(h,_)}}o.Pop(),p.Pop(),a.clearArray(f),i.Pop()}return!1}_GetFunctionMap(e,t){let s=this._functionMaps.get(e);if(!s){if(!t)return null;s={defaultFunc:null,strMap:new Map},this._functionMaps.set(e,s)}return s}_DoCallMappedFunction(e,t,s,n,i){t.GetEventBlock().RunAsMappedFunctionCall(s,t.IsCopyPicked()),n&&e.PopSol(i)}*_DebugDoCallMappedFunction(e,t,s,n,i){yield*t.GetEventBlock().DebugRunAsMappedFunctionCall(s,t.IsCopyPicked()),n&&e.PopSol(i)}}}{const a1=self.C3;a1.Plugins.System.Type=class extends a1.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}OnCreate(){}Release(){this._objectClass=null,this._runtime=null,this._plugin=null}}}{const d1=self.C3;d1.Plugins.System.Instance=class extends d1.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._runtime=this._inst.GetRuntime()}Release(){this._inst=null,this._objectClass=null,this._sdkType=null,this._runtime=null}}}{const h1=self.C3,i1=[];h1.Plugins.System.Cnds={EveryTick(){return!0},OnLayoutStart(){return!0},OnLayoutEnd(){return!0},OnSuspend(){return!0},OnResume(){return!0},IsSuspended(){return this._runtime.IsSuspended()},Else(){const e=this._runtime.GetCurrentEventStackFrame();return!e.GetElseBranchRan()&&!e.GetLastEventTrue()},TriggerOnce(){let e=this._runtime.GetCurrentCondition(),t=e.GetSavedDataMap(),s=t.get("TriggerOnce_lastTick");void 0===s&&(s=-1,t.set("TriggerOnce_lastTick",-1));const n=this._runtime.GetTickCount();return t.set("TriggerOnce_lastTick",n),this._runtime.IsLayoutFirstTick()||s!==n-1},Every(e){const t=this._runtime.GetCurrentCondition(),s=t.GetSavedDataMap(),n=s.get("Every_lastTime")||0,i=this._runtime.GetGameTime(),r=(s.has("Every_seconds")||s.set("Every_seconds",e),s.get("Every_seconds"));return n+r<=i?(s.set("Every_lastTime",n+r),i>=s.get("Every_lastTime")+.04&&s.set("Every_lastTime",i),s.set("Every_seconds",e),!0):(i<n-.1&&s.set("Every_lastTime",i),!1)},IsGroupActive(e){const t=this._runtime.GetEventSheetManager().GetEventGroupByName(e);return t&&t.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile(){return h1.Platform.IsMobile},OnLoadFinished(){return!0},OnCanvasSnapshot(){return!0},EffectsSupported(){return!0},OnSaveComplete(){return!0},OnSaveFailed(){return!0},OnLoadComplete(){return!0},OnLoadFailed(){return!0},ObjectUIDExists(e){return!!this._runtime.GetInstanceByUID(e)},IsOnPlatform(e){switch(e){case 0:return"browser"===h1.Platform.Context;case 1:return"iOS"===h1.Platform.OS;case 2:return"Android"===h1.Platform.OS;case 8:return"cordova"===h1.Platform.Context;case 9:return"scirra-arcade"===this._runtime.GetExportType();case 10:return"nwjs"===h1.Platform.Context;case 13:return"windows-uwp"===this._runtime.GetExportType();default:return!1}},RegexTest(e,t,s){const n=this.GetRegex(t,s);return n.test(e)},Compare(e,t,s){return h1.compare(e,t,s)},CompareBetween(e,t,s){return t<=e&&e<=s},CompareVar(e,t,s){return h1.compare(e.GetValue(),t,s)},CompareBoolVar(e){return!!e.GetValue()},CompareTime(e,t){const s=this._runtime.GetGameTime();if(0!==e)return h1.compare(s,e,t);{const n=this._runtime.GetCurrentCondition(),i=n.GetSavedDataMap();return!i.get("CompareTime_executed")&&t<=s&&(i.set("CompareTime_executed",!0),!0)}},IsNaN(e){return isNaN(e)},AngleWithin(e,t,s){return h1.angleDiff(h1.toRadians(e),h1.toRadians(s))<=h1.toRadians(t)},IsClockwiseFrom(e,t){return h1.angleClockwise(h1.toRadians(e),h1.toRadians(t))},IsBetweenAngles(e,t,s){let n=h1.toRadians(e),i=h1.toRadians(t),r=h1.toRadians(s),a=!h1.angleClockwise(r,i);return a?!(!h1.angleClockwise(n,i)&&h1.angleClockwise(n,r)):h1.angleClockwise(n,i)&&!h1.angleClockwise(n,r)},IsValueType(e,t){return"number"==typeof e?0===t:1===t},EvaluateExpression(e){return!!e},OnSignal(e){return e.toLowerCase()===this._runtime.GetEventSheetManager().GetCurrentSignalTag()},PickByComparison(e,s,n,i){if(!e)return!1;let t=this._GetForEachStack(),r=t.Push(),a=e.GetCurrentSol(),o=(h1.shallowAssignArray(r,a.GetInstances()),a.IsSelectAll()&&h1.clearArray(a._GetOwnElseInstances()),this._runtime.GetCurrentCondition()),l=0;for(let e=0,t=r.length;e<t;++e){const c=r[e];r[l]=c,s=o.ReevaluateParameter(1,e),i=o.ReevaluateParameter(3,e),h1.compare(s,n,i)?++l:a._PushElseInstance(c)}h1.truncateArray(r,l),a.SetArrayPicked(r);const h=!!r.length;return h1.clearArray(r),t.Pop(),e.ApplySolToContainer(),h},PickByEvaluate(e,t){if(!e)return!1;let s=this._GetForEachStack(),n=s.Push(),i=e.GetCurrentSol(),r=(h1.shallowAssignArray(n,i.GetInstances()),i.IsSelectAll()&&h1.clearArray(i._GetOwnElseInstances()),this._runtime.GetCurrentCondition()),a=0;for(let e=0,t=n.length;e<t;++e){const l=n[e];n[a]=l,r.ReevaluateParameter(1,e)?++a:i._PushElseInstance(l)}h1.truncateArray(n,a),i.SetArrayPicked(n);const o=!!n.length;return h1.clearArray(n),s.Pop(),e.ApplySolToContainer(),o},PickByHighestLowestValue(e,s,n){if(!e)return!1;const t=e.GetCurrentSol(),i=t.GetInstances();if(0===i.length)return!1;let r=this._runtime.GetCurrentCondition(),a=null,o=0;for(let e=0,t=i.length;e<t;++e){const l=i[e];n=r.ReevaluateParameter(2,e),(null===a||0===s&&n<o||1===s&&n>o)&&(o=n,a=l)}return t.PickOne(a),e.ApplySolToContainer(),!0},PickNth(e,t){if(!e)return!1;const s=e.GetCurrentSol(),n=s.GetInstances();if((t=Math.floor(t))>=n.length)return!1;const i=n[t];return s.PickOne(i),e.ApplySolToContainer(),!0},PickRandom(e){if(!e)return!1;const t=e.GetCurrentSol(),s=t.GetInstances(),n=Math.floor(this._runtime.Random()*s.length);if(n>=s.length)return!1;const i=s[n];return t.PickOne(i),e.ApplySolToContainer(),!0},PickAll(e){if(!e)return!1;if(!e.GetInstanceCount())return!1;const t=e.GetCurrentSol();return t._SetSelectAll(!0),e.ApplySolToContainer(),!0},PickOverlappingPoint(e,s,n){if(!e)return!1;const i=e.GetCurrentSol(),t=i.GetInstances(),r=this._runtime.GetCurrentEvent(),a=r.IsOrBlock(),o=this._runtime.GetCurrentCondition().IsInverted();i.IsSelectAll()?(h1.shallowAssignArray(i1,t),i.ClearArrays(),i._SetSelectAll(!1)):a?(h1.shallowAssignArray(i1,i._GetOwnElseInstances()),h1.clearArray(i._GetOwnElseInstances())):(h1.shallowAssignArray(i1,i._GetOwnInstances()),h1.clearArray(i._GetOwnInstances()));for(let e=0,t=i1.length;e<t;++e){const l=i1[e];h1.xor(l.GetWorldInfo().ContainsPoint(s,n),o)?i._PushInstance(l):i._PushElseInstance(l)}return e.ApplySolToContainer(),h1.xor(!!i._GetOwnInstances().length,o)},PickLastCreated(t){if(!t)return!1;let s=t.IsFamily(),n=null,i=this._runtime._GetInstancesPendingCreate();for(let e=i.length-1;0<=e;--e){const r=i[e];if(s){if(r.GetObjectClass().BelongsToFamily(t)){n=r;break}}else if(r.GetObjectClass()===t){n=r;break}}if(!n){const a=t.GetInstances();a.length&&(n=a.at(-1))}if(!n)return!1;const e=t.GetCurrentSol();return e.PickOne(n),t.ApplySolToContainer(),!0},Repeat(e){return this._runtime.IsDebugging()?this._DebugRepeat(e):this._Repeat(e)},While(){return this._runtime.IsDebugging()?this._DebugWhile():this._While()},For(e,t,s){return this._runtime.IsDebugging()?this._DebugFor(e,t,s):this._For(e,t,s)},ForEach(e){return this._runtime.IsDebugging()?this._DebugForEach(e):this._ForEach(e)},ForEachOrdered(e,t,s){return this._runtime.IsDebugging()?this._DebugForEachOrdered(e,s):this._ForEachOrdered(e,s)},LayerVisible(e){return!!e&&e.IsVisible()},LayerInteractive(e){return!!e&&e.IsSelfAndParentsInteractive()},LayerIsHTML(e){return!!e&&e.IsHTMLElementsLayer()},LayerEmpty(e){return!!e&&!e.GetInstanceCount()},LayerCmpOpacity(e,t,s){return!!e&&h1.compare(100*e.GetOpacity(),t,s)},LayerNameExists(e){const t=this._runtime.GetMainRunningLayout();return!!t&&t.HasLayerByName(e)},OnImageLoadingComplete(){return!0},IsLoadingImages(){return 0<this._imagesLoadingTotal},TemplateExists(e,t){const s=this._runtime.GetTemplateManager();return!!s&&!!t&&!!s.GetTemplateData(e,t)}}}{let SortZOrderList2=function(e,t){const s=e[0],n=t[0],i=s-n;if(0!=i)return i;const r=e[1],a=t[1];return r-a},SortInstancesByValue2=function(e,t){return e[1]-t[1]};SortZOrderList=SortZOrderList2,SortInstancesByValue=SortInstancesByValue2;const M2=self.C3,N2=[],O2=[],P2=M2.New(M2.Rect),Q2=M2.New(M2.Color),R2=[];M2.Plugins.System.Acts={SetVar(e,t){e.SetValue(t)},AddVar(e,t){e.IsNumber()&&"number"!=typeof t&&(t=parseFloat(t)),e.SetValue(e.GetValue()+t)},SubVar(e,t){e.IsNumber()&&e.SetValue(e.GetValue()-t)},SetBoolVar(e,t){e.SetValue(!!t)},ToggleBoolVar(e){e.SetValue(!e.GetValue())},ResetEventVar(e){e.SetValue(e.GetInitialValue())},ResetGlobals(e){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue(e)},CreateObject(e,t,s,n,i,r){if(e&&t){const a=this._runtime.CreateInstance(e,t,s,n,i,r);if(a){i&&t.SortAndAddInstancesByZIndex(a);const o=this._runtime.GetEventSheetManager(),l=(o.BlockFlushingInstances(!0),a._TriggerOnCreatedOnSelfAndRelated(),o.BlockFlushingInstances(!1),new Map);a.CollectInstancesToPick(l,e,i);for(const[h,c]of l)h.GetCurrentSol().SetSetPicked(c)}}},CreateObjectByName(e,t,s,n,i,r){if(e&&t){const a=this._runtime.GetObjectClassByName(e);a&&M2.Plugins.System.Acts.CreateObject.call(this,a,t,s,n,i,r)}},RecreateInitialObjects(i,r,a,o,l,e,h,c,u,d,_){if(i){let t=this._runtime.GetCurrentLayout(),s=t;if(e){const p=this._runtime.GetLayoutManager().GetLayoutByName(e);if(!p)return;s=p}let n=null;if(!("number"!=typeof h||0<=h)||(n=s.GetLayer(h))){let e=null;if(!("number"!=typeof c||0<=c)||(e=t.GetLayer(c))){P2.set(r,a,o,l);const m=s.RecreateInitialObjects(i,P2,n,e,u,d,_);i.GetCurrentSol().SetArrayPicked(m),i.ApplySolToContainer()}}}},StopLoop(){const e=this._loopStack;e.IsInLoop()&&e.GetCurrent().Stop()},SetGroupActive(e,t){const s=this._runtime.GetEventSheetManager().GetEventGroupByName(e);s&&(0===t?s.SetGroupActive(!1):1===t?s.SetGroupActive(!0):s.SetGroupActive(!s.IsGroupActive()))},SetTimescale(e){this._runtime.SetTimeScale(e)},SetObjectTimescale(e,t){if(t<0&&(t=0),e){const s=e.GetCurrentSol(),n=s.GetInstances();for(const i of n)i.SetTimeScale(t)}},RestoreObjectTimescale(e){if(e){const t=e.GetCurrentSol(),s=t.GetInstances();for(const n of s)n.RestoreTimeScale()}},Wait(e){if(!(e<0))return this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(e),!0},WaitForSignal(e){return this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(e),!0},WaitForPreviousActions(){const e=this._runtime.GetEventSheetManager();return e.AddScheduledWait().InitPromise(e.GetPromiseForAllAsyncActions()),!0},Signal(e){this._runtime.GetEventSheetManager().Signal(e)},async SnapshotCanvas(e,t,s,n,i,r){const a=this._runtime.GetCanvasManager();a&&(this.UpdateRender(),await a.SnapshotCanvas(0===e?"image/png":"image/jpeg",t/100,s,n,i,r),await this._runtime.TriggerAsync(M2.Plugins.System.Cnds.OnCanvasSnapshot,null))},SetCanvasSize(e,t){if(!(e<=0||t<=0)){this._runtime.SetViewportSize(e,t),this._runtime.GetCurrentLayout().BoundScrolling();const s=this._runtime.GetCanvasManager();s&&("off"!==s.GetCurrentFullscreenMode()&&this._runtime.SetOriginalViewportSize(e,t),s.SetSize(s.GetLastWidth(),s.GetLastHeight(),!0),this._runtime.UpdateRender())}},SetFullscreenQuality(e){const t=this._runtime.GetCanvasManager();t&&"off"!==t.GetCurrentFullscreenMode()&&(t.SetFullscreenScalingQuality(0!==e?"high":"low"),t.SetSize(t.GetLastWidth(),t.GetLastHeight(),!0))},SaveState(e){this._runtime.SaveToSlot(e)},SaveStateJSON(){this._runtime.SaveToJsonString()},LoadState(e){this._runtime.LoadFromSlot(e)},LoadStateJSON(e){this._runtime.LoadFromJsonString(e)},SetHalfFramerateMode(e){},ResetPersisted(){for(const e of this._runtime.GetLayoutManager().GetAllLayouts())e.ResetPersistData()},SetPixelRounding(e){this._runtime.SetPixelRoundingEnabled(0!==e)},SetFramerateMinMax(e,t){this._runtime.SetMaxDt(1/e),this._runtime.SetMinDt(1/t)},SetDeltaTimeMinMax(e,t){this._runtime.SetMinDt(e),this._runtime.SetMaxDt(t)},SetFramerateMode(e){this._runtime._SetFramerateMode(["vsync","unlimited-tick","unlimited-frame"][e])},SortZOrderByInstVar(e,s){if(e){const t=e.GetCurrentSol(),n=t.GetInstances(),i=N2,r=O2,a=this._runtime.GetCurrentLayout(),o=e.IsFamily(),l=e.GetFamilyIndex();for(let e=0,t=n.length;e<t;++e){const h=n[e],c=h.GetWorldInfo();if(c){let e;e=o?h.GetInstanceVariableValue(s+h.GetObjectClass().GetFamilyInstanceVariableOffset(l)):h.GetInstanceVariableValue(s),i.push([c.GetLayer().GetIndex(),c.GetZIndex()]),r.push([h,e])}}if(i.length){i.sort(SortZOrderList2),r.sort(SortInstancesByValue2);let s=!1;for(let e=0,t=i.length;e<t;++e){const u=r[e][0],d=a.GetLayerByIndex(i[e][0]),_=i[e][1],p=d._GetInstances();p[_]!==u&&((p[_]=u).GetWorldInfo()._SetLayer(d,!0),d.SetZIndicesChanged(u),s=!0)}s&&this._runtime.UpdateRender(),M2.clearArray(N2),M2.clearArray(O2)}}},SetCollisionCellSize(e,t){e=Math.floor(e),t=Math.floor(t),e<=0||t<=0||!Number.isFinite(e)||!Number.isFinite(t)||this._runtime.GetCollisionEngine().SetCollisionCellSize(e,t)},GoToLayout(e){if(!this._runtime.IsLoading()){const t=this._runtime.GetLayoutManager();t.IsPendingChangeMainLayout()||t.ChangeMainLayout(e)}},GoToLayoutByName(e){if(!this._runtime.IsLoading()){const t=this._runtime.GetLayoutManager();if(!t.IsPendingChangeMainLayout()){const s=t.GetLayoutByName(e);s&&t.ChangeMainLayout(s)}}},NextPrevLayout(e){if(!this._runtime.IsLoading()){const t=this._runtime.GetLayoutManager();if(!t.IsPendingChangeMainLayout()){const s=t.GetAllLayouts(),n=s.indexOf(t.GetMainRunningLayout());if((!e||0!==n)&&(e||n!==s.length-1)){const i=s[n+(e?-1:1)];t.ChangeMainLayout(i)}}}},RestartLayout(){if(!this._runtime.IsLoading()){const e=this._runtime.GetLayoutManager();e.IsPendingChangeMainLayout()||(e.ChangeMainLayout(e.GetMainRunningLayout()),this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation())}},SetLayerVisible(e,t){e&&e.SetVisible(t)},SetLayerInteractive(e,t){e&&e.SetInteractive(t)},SetLayerHTML(e,t){e&&e.SetIsHTMLElementsLayer(t)},SetLayerOpacity(e,t){e&&e.SetOpacity(t/100)},SetLayerScale(e,t){e&&e.SetOwnScale(t)},SetLayerScaleRate(e,t){e&&e.SetScaleRate(t)},SetLayerAngle(e,t){e&&e.SetAngle(M2.toRadians(+t))},SetLayerScroll(e,t,s){e&&(e.SetOwnScrollPositionEnabled(!0),e.SetScrollX(t),e.SetScrollY(s))},RestoreLayerScroll(e){e&&e.SetOwnScrollPositionEnabled(!1)},SetLayerParallax(e,t,s){e&&e.SetParallax(t/100,s/100)},SetLayerZElevation(e,t){e&&e.SetZElevation(+t)},SetLayerBackground(e,t){if(e){Q2.setFromRgbValue(t),Q2.clamp();const s=e.GetBackgroundColor();s.equalsIgnoringAlpha(Q2)||(s.copyRgb(Q2),this.UpdateRender())}},SetLayerTransparent(e,t){e&&e.SetTransparent(t)},SetLayerBlendMode(e,t){e&&e.SetBlendMode(t)},SetLayerEffectEnabled(e,t,s){if(e){const n=e.GetEffectList(),i=n.GetEffectTypeByName(s);if(i){const r=1===t;i.IsActive()!==r&&(i.SetActive(r),e.UpdateActiveEffects(),this._runtime.UpdateRender())}}},SetLayerEffectParam(e,t,s,n){if(e){const i=e.GetEffectList(),r=i.GetEffectTypeByName(t);if(r){s=Math.floor(s);const a=r.GetShaderProgram().GetParameterType(s);if(a){"color"===a?(Q2.setFromRgbValue(n),n=Q2):"percent"===a&&(n/=100);const o=i.SetEffectParameter(r.GetIndex(),s,n);o&&r.IsActive()&&this._runtime.UpdateRender()}}}},SetLayerForceOwnTexture(e,t){e&&e.SetForceOwnTexture(t)},SetLayoutScale(e){this._runtime.GetCurrentLayout().SetScale(+e)},SetLayoutAngle(e){this._runtime.GetCurrentLayout().SetAngle(M2.toRadians(+e))},SetLayoutEffectEnabled(e,t){const s=this._runtime.GetCurrentLayout(),n=s.GetEffectList(),i=n.GetEffectTypeByName(t);if(i){const r=1===e;i.IsActive()!==r&&(i.SetActive(r),s.UpdateActiveEffects(),this._runtime.UpdateRender())}},SetLayoutEffectParam(e,t,s){const n=this._runtime.GetCurrentLayout(),i=n.GetEffectList(),r=i.GetEffectTypeByName(e);if(r){t=Math.floor(t);const a=r.GetShaderProgram().GetParameterType(t);if(a){"color"===a?(Q2.setFromRgbValue(s),s=Q2):"percent"===a&&(s/=100);const o=i.SetEffectParameter(r.GetIndex(),t,s);o&&r.IsActive()&&this._runtime.UpdateRender()}}},SetLayoutVanishingPoint(e,t){const s=this._runtime.GetCurrentLayout();s.SetVanishingPointXY(e/100,t/100)},SetLayoutProjection(e){const t=this._runtime.GetCurrentLayout();0===e?t.SetPerspectiveProjection():t.SetOrthographicProjection()},ScrollX(e){const t=this._runtime.GetCurrentLayout();t.SetScrollX(e)},ScrollY(e){const t=this._runtime.GetCurrentLayout();t.SetScrollY(e)},Scroll(e,t){const s=this._runtime.GetCurrentLayout();s.SetScrollX(e),s.SetScrollY(t)},ScrollToObject(e){if(e){const t=e.GetFirstPicked();if(t){const s=t.GetWorldInfo();if(s){const n=this._runtime.GetCurrentLayout();n.SetScrollX(s.GetX()),n.SetScrollY(s.GetY())}}}},AddLayer(e,t,s){const n=this._runtime.GetCurrentLayout();try{n.AddLayer(e,t,s)}catch(e){console.warn("[Construct] Cannot add layer: ",e)}},MoveLayer(e,t,s){if(e){const n=this._runtime.GetCurrentLayout();try{n.MoveLayer(e,t,s)}catch(e){console.warn("[Construct] Cannot move layer: ",e)}}},RemoveLayer(e){if(e){const t=this._runtime.GetCurrentLayout();t.RemoveLayer(e)}},RemoveAllDynamicLayers(){this._runtime.GetCurrentLayout().RemoveAllDynamicLayers()},async LoadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();if(t&&e&&!this._runtime.IsLoading()){const s=e.IsFamily()?e.GetFamilyMembers():[e];await this._LoadTexturesForObjectClasses(t,s)}},async LoadObjectTexturesByName(e){await M2.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(e))},UnloadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();if(t&&e){const s=e.IsFamily()?e.GetFamilyMembers():[e];this._UnloadTexturesForObjectClasses(t,s)}},UnloadObjectTexturesByName(e){M2.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(e))},UnloadUnusedTextures(){const e=this._runtime.GetMainRunningLayout();if(e){const t=e._GetTextureLoadedObjectTypes();this._UnloadTexturesForObjectClasses(e,t)}},async LoadLayoutTextures(e){const t=this._runtime.GetMainRunningLayout();e&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},async LoadLayoutTexturesByName(e){const t=this._runtime.GetMainRunningLayout(),s=this._runtime.GetLayoutManager().GetLayoutByName(e);s&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,s._GetInitialObjectClasses())},SetFunctionReturnValue(e){const t=this._eventStack.GetCurrentExpFuncStackFrame();if(t)switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:t.SetFunctionReturnValue(e)}},MapFunction(e,t,s){const n=this._GetFunctionMap(e.toLowerCase(),!0),i=n.strMap,r=t.toLowerCase(),a=(i.has(r)&&console.warn(`[Construct] Function map '${e}' string '${t}' already in map; overwriting entry`),M2.first(i.values())||n.defaultFunc);if(a){const o=0!==a.GetReturnType(),l=0!==s.GetReturnType();if(o!=l)return void console.error(`[Construct] Function map '${e}' string '${t}' function return type not compatible with other functions in the map; entry ignored`)}i.set(r,s)},MapFunctionDefault(e,t){const s=this._GetFunctionMap(e.toLowerCase(),!0),n=(s.defaultFunc&&console.warn(`[Construct] Function map '${e}' already has a default; overwriting entry`),M2.first(s.strMap.values())||s.defaultFunc);if(n){const i=0!==n.GetReturnType(),r=0!==t.GetReturnType();if(i!=r)return void console.error(`[Construct] Function map '${e}' default: function return type not compatible with other functions in the map; entry ignored`)}s.defaultFunc=t},CallMappedFunction(e,t,s){const n=this._runtime,i=n.IsDebugging()?R2:null,r=(s=Math.floor(s),this._GetFunctionMap(e.toLowerCase(),!1));if(!r)return console.warn(`[Construct] Call mapped function: map name '${e}' not found; call ignored`),i;let a=r.strMap.get(t.toLowerCase());if(!a){if(!r.defaultFunc)return console.warn(`[Construct] Call mapped function: no function associated with map '${e}' string '${t}'; call ignored (consider setting a default)`),i;a=r.defaultFunc,s=0}if(!a.IsEnabled())return i;if(0!==a.GetReturnType())return console.warn(`[Construct] Call mapped function: map '${e}' string '${t}' has a return type so cannot be called`),i;const o=n.GetEventSheetManager(),l=o.GetCurrentEvent(),h=l.GetSolModifiersIncludingParents(),c=0<h.length,u=(c&&(a.IsCopyPicked()?o.PushCopySol(h):o.PushCleanSol(h)),[]),d=o.FindFirstFunctionBlockParent(l);if(d){const p=d.GetFunctionParameters();for(let e=s,t=p.length;e<t;++e)u.push(p[e].GetValue())}const _=a.GetFunctionParameters();for(let e=u.length,t=_.length;e<t;++e)u.push(_[e].GetInitialValue());return n.IsDebugging()?this._DebugDoCallMappedFunction(o,a,u,c,h):this._DoCallMappedFunction(o,a,u,c,h)}}}{const Vf=self.C3;Vf.Plugins.System.Exps={int:function(e){return"string"==typeof e&&(e=parseInt(e,10),isNaN(e))&&(e=0),Math.floor(e)},float:function(e){return"string"==typeof e&&(e=parseFloat(e),isNaN(e))?0:e},str(e){return e.toString()},len(e){return"string"==typeof e?e.length:0},random(e,t){return void 0===t?this._runtime.Random()*e:this._runtime.Random()*(t-e)+e},choose(...e){const t=Math.floor(this._runtime.Random()*e.length);return e[t]},chooseindex(e,...t){return"number"!=typeof e&&(e=0),t[e=Vf.clamp(Math.floor(e),0,t.length-1)]},pi(){return Math.PI},infinity(){return 1/0},sqrt(e){return Math.sqrt(e)},abs(e){return Math.abs(e)},round(e){return Math.round(e)},roundtodp(e,t){t=Math.max(Math.floor(t),0);const s=Math.pow(10,t);return Math.round((e+Number.EPSILON)*s)/s},floor(e){return Math.floor(e)},ceil(e){return Math.ceil(e)},sign(e){return Math.sign(e)},sin(e){return Math.sin(Vf.toRadians(e))},cos(e){return Math.cos(Vf.toRadians(e))},tan(e){return Math.tan(Vf.toRadians(e))},asin(e){return Vf.toDegrees(Math.asin(e))},acos(e){return Vf.toDegrees(Math.acos(e))},atan(e){return Vf.toDegrees(Math.atan(e))},exp(e){return Math.exp(e)},ln(e){return Math.log(e)},log10(e){return Math.log10(e)},max(...s){let n=s[0];"number"!=typeof n&&(n=0);for(let t=1,e=s.length;t<e;++t){let e=s[t];"number"==typeof e&&n<e&&(n=e)}return n},min(...s){let n=s[0];"number"!=typeof n&&(n=0);for(let t=1,e=s.length;t<e;++t){let e=s[t];"number"==typeof e&&n>e&&(n=e)}return n},clamp(e,t,s){return Vf.clamp(e,t,s)},distance(e,t,s,n){return Vf.distanceTo(e,t,s,n)},angle(e,t,s,n){return Vf.toDegrees(Vf.angleTo(e,t,s,n))},lerp(e,t,s){return Vf.lerp(e,t,s)},unlerp(e,t,s){return Vf.unlerp(e,t,s)},qarp(e,t,s,n){return Vf.qarp(e,t,s,n)},cubic(e,t,s,n,i){return Vf.cubic(e,t,s,n,i)},cosp(e,t,s){return Vf.cosp(e,t,s)},anglediff(e,t){return Vf.toDegrees(Vf.angleDiff(Vf.toRadians(e),Vf.toRadians(t)))},anglelerp(e,t,s){return Vf.toDegrees(Vf.angleLerp(Vf.toRadians(e),Vf.toRadians(t),s))},anglerotate(e,t,s){return Vf.toDegrees(Vf.angleRotate(Vf.toRadians(e),Vf.toRadians(t),Vf.toRadians(s)))},setbit(e,t,s){return(e|=0)&~(1<<(t|=0))|(s=0!==s?1:0)<<t},togglebit(e,t){return(e|=0)^1<<(0|t)},getbit(e,t){return(e|=0)&1<<(0|t)?1:0},newline(){return"\n"},uppercase(e){return"string"==typeof e?e.toUpperCase():""},lowercase(e){return"string"==typeof e?e.toLowerCase():""},left(e,t){return"string"==typeof e?e.substr(0,t):""},mid(e,t,s){return"string"!=typeof e?"":s<0?e.substr(t):e.substr(t,s)},right(e,t){return"string"==typeof e?e.substr(Math.max(e.length-t,0)):""},trim(e){return"string"==typeof e?e.trim():""},tokenat(e,t,s){if("string"!=typeof e||"string"!=typeof s)return"";let n=e.split(s);return(t=Math.floor(t))<0||t>=n.length?"":n[t]},tokencount(e,t){return"string"==typeof e&&"string"==typeof t&&e.length?e.split(t).length:0},find(e,t){return"string"==typeof e&&"string"==typeof t?e.search(new RegExp(Vf.EscapeRegex(t),"i")):-1},findcase(e,t){return"string"==typeof e&&"string"==typeof t?e.search(new RegExp(Vf.EscapeRegex(t),"")):-1},replace(e,t,s){return"string"==typeof e&&"string"==typeof t&&"string"==typeof s?e.replace(new RegExp(Vf.EscapeRegex(t),"gi"),s):"string"==typeof e?e:""},stringsub(e,...s){let n=e;for(let e=0,t=s.length;e<t;++e)n=n.replaceAll(`{${e}}`,s[e].toString());return n},regexsearch(e,t,s){const n=this.GetRegex(t,s);return e?e.search(n):-1},regexreplace(e,t,s,n){const i=this.GetRegex(t,s);return e?e.replace(i,n):""},regexmatchcount(e,t,s){const n=this.GetRegexMatches(e.toString(),t,s);return n?n.length:0},regexmatchat(e,t,s,n){n=Math.floor(n);const i=this.GetRegexMatches(e.toString(),t,s);return!i||n<0||n>=i.length?"":i[n]},zeropad(e,t){let s=e<0?"-":"",n=t-(e=e<0?-e:e).toString().length;return(s+="0".repeat(Math.max(n,0)))+e.toString()},urlencode(e){return encodeURIComponent(e)},urldecode(e){return decodeURIComponent(e)},dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1e3},unixtime(){return Date.now()},time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFramesPerSecond()},cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return Vf.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},vanishingpointx(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointX()},vanishingpointy(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointY()},viewportleft(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getLeft():0},viewporttop(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getTop():0},viewportright(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getRight():0},viewportbottom(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getBottom():0},viewportwidth(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().width():0},viewportheight(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().height():0},viewportmidx(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);if(t){const s=t.GetViewport3D();return(s.getLeft()+s.getRight())/2}return 0},viewportmidy(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);if(t){const s=t.GetViewport3D();return(s.getTop()+s.getBottom())/2}return 0},canvastolayerx(e,t,s){const n=this._runtime.GetCurrentLayout().GetLayer(e);return n?n.CanvasCssToLayer(t,s)[0]:0},canvastolayery(e,t,s){const n=this._runtime.GetCurrentLayout().GetLayer(e);return n?n.CanvasCssToLayer(t,s)[1]:0},layertocanvasx(e,t,s){const n=this._runtime.GetCurrentLayout().GetLayer(e);return n?n.LayerToCanvasCss(t,s)[0]:0},layertocanvasy(e,t,s){const n=this._runtime.GetCurrentLayout().GetLayer(e);return n?n.LayerToCanvasCss(t,s)[1]:0},layertolayerx(e,t,s,n){const i=this._runtime.GetCurrentLayout(),r=i.GetLayer(e),a=i.GetLayer(t);if(!r||!a||r===a)return s;const[o,l]=r.LayerToCanvasCss(s,n);return a.CanvasCssToLayer(o,l)[0]},layertolayery(e,t,s,n){const i=this._runtime.GetCurrentLayout(),r=i.GetLayer(e),a=i.GetLayer(t);if(!r||!a||r===a)return n;const[o,l]=r.LayerToCanvasCss(s,n);return a.CanvasCssToLayer(o,l)[1]},layerscale(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetOwnScale():0},layerangle(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?Vf.toDegrees(t.GetOwnAngle()):0},layeropacity(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?100*t.GetOpacity():0},layerscalerate(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetScaleRate():0},layerscrollx(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetScrollX():0},layerscrolly(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetScrollY():0},layerparallaxx(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?100*t.GetParallaxX():0},layerparallaxy(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?100*t.GetParallaxY():0},layerzelevation(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetZElevation():0},layerindex(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetIndex():-1},canvassnapshot(){const e=this._runtime.GetCanvasManager();return e?e.GetCanvasSnapshotUrl():""},loopindex(e){const t=this._loopStack;if(!t.IsInLoop())return 0;if(e){const s=t.FindByName(e);return s?s.GetIndex():0}return t.GetCurrent().GetIndex()},savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(e,t,...s){const n=this._GetFunctionMap(e.toLowerCase(),!1);if(!n)return console.warn(`[Construct] Call mapped function: map name '${e}' not found; returning 0`),0;let i=n.strMap.get(t.toLowerCase());if(!i){if(!n.defaultFunc)return console.warn(`[Construct] Call mapped function: no function associated with map '${e}' string '${t}'; returning 0 (consider setting a default)`),0;i=n.defaultFunc}const r=i.GetReturnType(),a=i.GetDefaultReturnValue();if(0===r)return console.warn(`[Construct] Call mapped function: map '${e}' string '${t}' has no return type so cannot be called from an expression; returning 0`),0;if(!i.IsEnabled())return a;const o=this._runtime,l=o.GetEventSheetManager(),h=l.GetCurrentEvent(),c=h.GetSolModifiersIncludingParents(),u=0<c.length,d=(u&&(i.IsCopyPicked()?l.PushCopySol(c):l.PushCleanSol(c)),i.GetFunctionParameters());for(let e=s.length,t=d.length;e<t;++e)s.push(d[e].GetInitialValue());const _=i.GetEventBlock(),p=_.RunAsExpressionFunctionCall(_.GetSolModifiersIncludingParents(),i.IsCopyPicked(),r,a,...s);return u&&l.PopSol(c),p},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},imageloadingprogress(){return 0===this._imagesLoadingTotal?1:this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){return this._runtime.GetWebGPURenderer()?"webgpu":"webgl"},rendererdetail(){return this._runtime.GetWebGPURenderer()?this._runtime.GetWebGPURenderer().GetAdapterInfoString():this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){let e=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*e/1048576)/100},rgb(e,t,s){return Vf.PackRGB(e,t,s)},rgbex(e,t,s){return Vf.PackRGBEx(e/100,t/100,s/100)},rgba(e,t,s,n){return Vf.PackRGBAEx(e/100,t/100,s/100,n/100)},rgbex255(e,t,s){return Vf.PackRGBEx(e/255,t/255,s/255)},rgba255(e,t,s,n){return Vf.PackRGBAEx(e/255,t/255,s/255,n/255)},projectname(){return this._runtime.GetProjectName()},projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}}}{const a=self.C3;a.Plugins.AJAX=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.AJAX.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3;g.Plugins.AJAX.Instance=class extends g.SDKInstanceBase{constructor(e,t){if(super(e),this._lastData="",this._lastStatusCode=0,this._curTag="",this._progress=0,this._timeout=-1,this._nextRequestHeaders=new Map,this._nextReponseBinaryData=null,this._nextRequestOverrideMimeType="",this._nextRequestWithCredentials=!1,this._nwjsFs=null,this._nwjsPath=null,this._nwjsAppFolder=null,this._isNWjs=this._runtime.IsNWjs(),this._isNWjs){this._nwjsFs=__require("fs"),this._nwjsPath=__require("path");const s=self.process||nw.process;this._nwjsAppFolder=this._nwjsPath.dirname(s.execPath)+"\\"}}Release(){super.Release()}async _TriggerError(e,t,s){console.error(`[Construct] AJAX request to '${t}' (tag '${e}') failed: `,s),this._curTag=e,await this.TriggerAsync(g.Plugins.AJAX.Cnds.OnAnyError),this._curTag=e,await this.TriggerAsync(g.Plugins.AJAX.Cnds.OnError)}async _TriggerComplete(e){this._curTag=e,await this.TriggerAsync(g.Plugins.AJAX.Cnds.OnAnyComplete),this._curTag=e,await this.TriggerAsync(g.Plugins.AJAX.Cnds.OnComplete)}async _OnProgress(e,t){t.lengthComputable&&(this._progress=t.loaded/t.total,this._curTag=e,await this.TriggerAsync(g.Plugins.AJAX.Cnds.OnProgress))}async _OnUploadProgress(e,t){t.lengthComputable&&(this._progress=t.loaded/t.total,this._curTag=e,await this.TriggerAsync(g.Plugins.AJAX.Cnds.OnUploadProgress))}_OnError(s,n,e){if(this._isNWjs){const t=this._nwjsFs,i=this._nwjsAppFolder+n;t.existsSync(i)?t.readFile(i,{encoding:"utf8"},(e,t)=>{e?this._TriggerError(s,n,e):(this._lastData=t.replace(/\r\n/g,"\n"),this._TriggerComplete(s))}):this._TriggerError(s,n,e)}else this._TriggerError(s,n,e)}async _DoCordovaRequest(t,s){const e=this._runtime.GetAssetManager(),n=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{if(n){const i=await e.CordovaFetchLocalFileAsArrayBuffer(s);n.SetArrayBufferTransfer(i),this._lastData=""}else{const r=await e.CordovaFetchLocalFileAsText(s);this._lastData=r.replace(/\r\n/g,"\n")}this._lastStatusCode=0,this._TriggerComplete(t)}catch(e){this._TriggerError(t,s,e)}}_DoRequest(o,l,e,h){return new Promise(t=>{const s=e=>{this._OnError(o,l,e),t()},n=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{const i=new XMLHttpRequest;i.onreadystatechange=()=>{if(4===i.readyState){if(n?this._lastData="":this._lastData=(i.responseText||"").replace(/\r\n/g,"\n"),this._lastStatusCode=i.status,400<=i.status)this._TriggerError(o,l,i.status+i.statusText);else{const e=this._lastData.length||n&&i.response instanceof ArrayBuffer;this._isNWjs&&!e||!this._isNWjs&&0===i.status&&!e||(n&&n.SetArrayBufferTransfer(i.response),this._TriggerComplete(o))}t()}},i.onerror=s,i.ontimeout=s,i.onabort=s,i.onprogress=e=>this._OnProgress(o,e),i.upload.onprogress=e=>this._OnUploadProgress(o,e),i.open(e,l),0<=this._timeout&&void 0!==i.timeout&&(i.timeout=this._timeout),i.responseType=n?"arraybuffer":"text",h&&!this._nextRequestHeaders.has("Content-Type")&&("string"!=typeof h?i.setRequestHeader("Content-Type","application/octet-stream"):i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));for(const[r,a]of this._nextRequestHeaders)try{i.setRequestHeader(r,a)}catch(e){console.error(`[Construct] AJAX: Failed to set header '${r}: ${a}': `,e)}if(this._nextRequestHeaders.clear(),this._nextRequestOverrideMimeType){try{i.overrideMimeType(this._nextRequestOverrideMimeType)}catch(e){console.error("[Construct] AJAX: failed to override MIME type: ",e)}this._nextRequestOverrideMimeType=""}this._nextRequestWithCredentials&&(i.withCredentials=!0,this._nextRequestWithCredentials=!1),h?i.send(h):i.send()}catch(e){s(e)}})}GetDebuggerProperties(){const e="plugins.ajax.debugger";return[{title:e+".title",properties:[{name:e+".last-status-code",value:this._lastStatusCode},{name:e+".last-data",value:this._lastData}]}]}SaveToJson(){return{lastData:this._lastData,lastStatusCode:this._lastStatusCode}}LoadFromJson(e){this._lastData=e.lastData,this._lastStatusCode=e.hasOwnProperty("lastStatusCode")?e.lastStatusCode:0,this._curTag="",this._progress=0}}}{const $=self.C3;$.Plugins.AJAX.Cnds={OnComplete(e){return $.equalsNoCase(this._curTag,e)},OnAnyComplete(){return!0},OnError(e){return $.equalsNoCase(this._curTag,e)},OnAnyError(){return!0},OnProgress(e){return $.equalsNoCase(this._curTag,e)},OnUploadProgress(e){return $.equalsNoCase(this._curTag,e)}}}{const da=self.C3;da.Plugins.AJAX.Acts={async Request(e,t){this._runtime.IsCordova()&&da.IsRelativeURL(t)&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(e,t):await this._DoRequest(e,t,"GET",null)},async RequestFile(e,t){this._runtime.IsCordova()&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(e,t):await this._DoRequest(e,t,"GET",null)},async Post(e,t,s,n){await this._DoRequest(e,t,n,s)},async PostBinary(e,t,s,n){if(s){const i=s.GetFirstPicked(this._inst);if(i){const r=i.GetSdkInstance(),a=r.GetArrayBufferReadOnly();await this._DoRequest(e,t,n,a)}}},SetTimeout(e){this._timeout=1e3*e},SetHeader(e,t){this._nextRequestHeaders.set(e,t)},SetResponseBinary(e){if(e){const t=e.GetFirstPicked(this._inst);t&&(this._nextReponseBinaryData=t.GetSdkInstance())}},OverrideMIMEType(e){this._nextRequestOverrideMimeType=e},SetWithCredentials(e){this._nextRequestWithCredentials=!!e}}}{const Aa=self.C3;Aa.Plugins.AJAX.Exps={LastData(){return this._lastData},LastStatusCode(){return this._lastStatusCode},Progress(){return this._progress},Tag(){return this._curTag}}}{const a=self.C3;a.Plugins.Arr=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Arr.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{let ResizeArray2=function(t,s,n){if(s<t.length)g.truncateArray(t,s);else if(s>t.length)if("function"==typeof n)for(let e=t.length;e<s;++e)t.push(n());else for(let e=t.length;e<s;++e)t.push(n)};ResizeArray=ResizeArray2;const g=self.C3,h=self.C3X,i=self.IInstance,j=(g.Plugins.Arr.Instance=class extends g.SDKInstanceBase{constructor(e,t){super(e),this._cx=10,this._cy=1,this._cz=1,this._arr=null,this._forX=[],this._forY=[],this._forZ=[],this._forDepth=-1,t&&(this._cx=t[0],this._cy=t[1],this._cz=t[2]),this._arr=g.MakeFilledArray(this._cx,()=>g.MakeFilledArray(this._cy,()=>g.MakeFilledArray(this._cz,0)))}Release(){this._arr=null,super.Release()}At(e,t,s){return e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),0<=e&&e<this._cx&&0<=t&&t<this._cy&&0<=s&&s<this._cz?this._arr[e][t][s]:0}Set(e,t,s,n){e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),0<=e&&e<this._cx&&0<=t&&t<this._cy&&0<=s&&s<this._cz&&(this._arr[e][t][s]=n)}SetSize(e,s,n){if(e=Math.floor(e),s=Math.floor(s),n=Math.floor(n),s<0&&(s=0),n<0&&(n=0),this._cx!==(e=e<0?0:e)||this._cy!==s||this._cz!==n){this._cx=e,this._cy=s,this._cz=n;const i=this._arr;ResizeArray2(i,e,()=>g.MakeFilledArray(s,()=>g.MakeFilledArray(n,0)));for(let t=0;t<e;++t){ResizeArray2(i[t],s,()=>g.MakeFilledArray(n,0));for(let e=0;e<s;++e)ResizeArray2(i[t][e],n,0)}}}GetWidth(){return this._cx}GetHeight(){return this._cy}GetDepth(){return this._cz}_ShuffleHelper(e,t,s,n,i){for(;0<t;){const r=Math.floor(this._runtime.Random()*t);if(--t,0===e){const a=this.At(t,n,i),o=this.At(r,n,i);this.Set(t,n,i,o),this.Set(r,n,i,a)}else if(1===e){const l=this.At(s,t,i),h=this.At(s,r,i);this.Set(s,t,i,h),this.Set(s,r,i,l)}else if(2===e){const c=this.At(s,n,t),u=this.At(s,n,r);this.Set(s,n,t,u),this.Set(s,n,r,c)}}}GetDebuggerProperties(){const e="plugins.arr.debugger",t="plugins.arr.properties",s=[{title:e+".array-properties.title",properties:[{name:t+".width.name",value:this._cx,onedit:e=>this.SetSize(e,this._cy,this._cz)},{name:t+".height.name",value:this._cy,onedit:e=>this.SetSize(this._cx,e,this._cz)},{name:t+".depth.name",value:this._cz,onedit:e=>this.SetSize(this._cx,this._cy,e)},{name:t+".elements.name",value:this._cx*this._cy*this._cz}]}],n=[];if(1===this._cy&&1===this._cz)for(let t=0;t<this._cx;++t)n.push({name:"$"+t,value:this._arr[t][0][0],onedit:e=>this._arr[t][0][0]=e});else for(let e=0;e<this._cx;++e)n.push({name:"$"+e,value:this._arr[e].toString()});return n.length&&s.push({title:e+".array-data.title",properties:n}),s}GetAsJsonString(){return JSON.stringify({c2array:!0,size:[this._cx,this._cy,this._cz],data:this._arr})}SaveToJson(){return{size:[this._cx,this._cy,this._cz],data:this._arr}}LoadFromJson(e){const t=e.size;this._cx=t[0],this._cy=t[1],this._cz=t[2],this._arr=e.data}_GetForX(){return 0<=this._forDepth&&this._forDepth<this._forX.length?this._forX[this._forDepth]:0}_GetForY(){return 0<=this._forDepth&&this._forDepth<this._forY.length?this._forY[this._forDepth]:0}_GetForZ(){return 0<=this._forDepth&&this._forDepth<this._forZ.length?this._forZ[this._forDepth]:0}GetScriptInterfaceClass(){return self.IArrayInstance}},new WeakMap);self.IArrayInstance=class extends i{constructor(){super(),j.set(this,i._GetInitInst().GetSdkInstance())}get width(){return j.get(this).GetWidth()}get height(){return j.get(this).GetHeight()}get depth(){return j.get(this).GetDepth()}setSize(e,t=1,s=1){h.RequireFiniteNumber(e),h.RequireFiniteNumber(t),h.RequireFiniteNumber(s),j.get(this).SetSize(e,t,s)}getAt(e,t=0,s=0){return h.RequireFiniteNumber(e),h.RequireFiniteNumber(t),h.RequireFiniteNumber(s),j.get(this).At(e,t,s)}setAt(e,t,s=0,n=0){if(h.RequireFiniteNumber(t),h.RequireFiniteNumber(s),h.RequireFiniteNumber(n),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid type");j.get(this).Set(t,s,n,e)}}}{let DoForEachTrigger2=function(e,t,s,n,i,r){e.PushCopySol(s);const a=r.GetObjectClass().GetCurrentSol();a.PickOne(r.GetInstance()),t.Retrigger(n,i),e.PopSol(s)};DoForEachTrigger=DoForEachTrigger2;const ma=self.C3;ma.Plugins.Arr.Cnds={CompareX(e,t,s){return ma.compare(this.At(e,0,0),t,s)},CompareXY(e,t,s,n){return ma.compare(this.At(e,t,0),s,n)},CompareXYZ(e,t,s,n,i){return ma.compare(this.At(e,t,s),n,i)},ArrForEach(e){const t=this._runtime,n=t.GetEventSheetManager(),i=t.GetCurrentEvent(),r=i.GetSolModifiers(),s=t.GetEventStack(),a=s.GetCurrentStackFrame(),o=s.Push(i),l=++this._forDepth,h=this._forX,c=this._forY,u=this._forZ,d=this._cx,_=this._cy,p=this._cz;if(l===this._forX.length?(h.push(0),c.push(0),u.push(0)):(h[l]=0,c[l]=0,u[l]=0),t.SetDebuggingEnabled(!1),0===e)for(let s=0;s<d;++s)for(let t=0;t<_;++t)for(let e=0;e<p;++e)h[l]=s,c[l]=t,u[l]=e,DoForEachTrigger2(n,i,r,a,o,this);else if(1===e)for(let t=0;t<d;++t)for(let e=0;e<_;++e)h[l]=t,c[l]=e,DoForEachTrigger2(n,i,r,a,o,this);else for(let e=0;e<d;++e)h[l]=e,DoForEachTrigger2(n,i,r,a,o,this);return t.SetDebuggingEnabled(!0),this._forDepth--,s.Pop(),!1},CompareCurrent(e,t){return ma.compare(this.At(this._GetForX(),this._GetForY(),this._GetForZ()),e,t)},Contains(n){const e=this._cx,i=this._cy,r=this._cz,a=this._arr;for(let s=0;s<e;++s)for(let t=0;t<i;++t)for(let e=0;e<r;++e)if(a[s][t][e]===n)return!0;return!1},IsEmpty(){return 0===this._cx||0===this._cy||0===this._cz},CompareSize(e,t,s){let n=0;switch(e){case 0:n=this._cx;break;case 1:n=this._cy;break;case 2:n=this._cz}return ma.compare(n,t,s)}}}{let CompareValues2=function(e,t){if("number"==typeof e&&"number"==typeof t)return e-t;{const s=e.toString(),n=t.toString();return s<n?-1:n<s?1:0}};CompareValues=CompareValues2;const n0=self.C3;n0.Plugins.Arr.Acts={Clear(n){const e=this._cx,i=this._cy,r=this._cz,a=this._arr;for(let s=0;s<e;++s)for(let t=0;t<i;++t)for(let e=0;e<r;++e)a[s][t][e]=n},SetSize(e,t,s){this.SetSize(e,t,s)},SetX(e,t){this.Set(e,0,0,t)},SetXY(e,t,s){this.Set(e,t,0,s)},SetXYZ(e,t,s,n){this.Set(e,t,s,n)},Push(s,n,e){const i=this._cx,r=this._cy,t=this._cz,a=this._arr;if(0===e){const o=n0.MakeFilledArray(r,()=>n0.MakeFilledArray(t,n));0===s?a.push(o):a.unshift(o),this._cx++}else if(1===e){for(let e=0;e<i;++e){const l=n0.MakeFilledArray(t,n);0===s?a[e].push(l):a[e].unshift(l)}this._cy++}else{for(let t=0;t<i;++t)for(let e=0;e<r;++e)0===s?a[t][e].push(n):a[t][e].unshift(n);this._cz++}},Pop(s,e){const n=this._cx,i=this._cy,t=this._cz,r=this._arr;if(0===e)0!==n&&(0===s?r.pop():r.shift(),this._cx--);else if(1===e){if(0!==i){for(let e=0;e<n;++e)0===s?r[e].pop():r[e].shift();this._cy--}}else if(0!==t){for(let t=0;t<n;++t)for(let e=0;e<i;++e)0===s?r[t][e].pop():r[t][e].shift();this._cz--}},Reverse(e){const s=this._cx,n=this._cy,t=this._cz,i=this._arr;if(0!==s&&0!==n&&0!==t)if(0===e)i.reverse();else if(1===e)for(let e=0;e<s;++e)i[e].reverse();else for(let t=0;t<s;++t)for(let e=0;e<n;++e)i[t][e].reverse()},Sort(e){const s=this._cx,n=this._cy,t=this._cz,i=this._arr;if(0!==s&&0!==n&&0!==t)if(0===e)i.sort((e,t)=>CompareValues2(e[0][0],t[0][0]));else if(1===e)for(let e=0;e<s;++e)i[e].sort((e,t)=>CompareValues2(e[0],t[0]));else for(let t=0;t<s;++t)for(let e=0;e<n;++e)i[t][e].sort(CompareValues2)},Shuffle(s){const n=this._cx,i=this._cy,r=this._cz;if(0!==n&&0!==i&&0!==r)if(0===s)for(let t=0;t<i;++t)for(let e=0;e<r;++e)this._ShuffleHelper(s,n,0,t,e);else if(1===s)for(let t=0;t<n;++t)for(let e=0;e<r;++e)this._ShuffleHelper(s,i,t,0,e);else for(let t=0;t<n;++t)for(let e=0;e<i;++e)this._ShuffleHelper(s,r,t,e,0)},Delete(s,e){if(!((s=Math.floor(s))<0)){const n=this._cx,i=this._cy,t=this._cz,r=this._arr;if(0===e)n<=s||(r.splice(s,1),this._cx--);else if(1===e){if(!(i<=s)){for(let e=0;e<n;++e)r[e].splice(s,1);this._cy--}}else if(!(t<=s)){for(let t=0;t<n;++t)for(let e=0;e<i;++e)r[t][e].splice(s,1);this._cz--}}},Insert(s,n,e){if(!((n=Math.floor(n))<0)){const i=this._cx,r=this._cy,t=this._cz,a=this._arr;if(0===e)i<n||(a.splice(n,0,n0.MakeFilledArray(r,()=>n0.MakeFilledArray(t,s))),this._cx++);else if(1===e){if(!(r<n)){for(let e=0;e<i;++e)a[e].splice(n,0,n0.MakeFilledArray(t,s));this._cy++}}else if(!(n>t)){for(let t=0;t<i;++t)for(let e=0;e<r;++e)a[t][e].splice(n,0,s);this._cz++}}},SplitString(e,t,s){const n=e.split(t);this.SetSize(n.length,1,1);for(let t=0,e=n.length;t<e;++t){let e=n[t];0===s?String(Number(e))===e&&(e=Number(e)):2===s&&(e=Number(e)),this.Set(t,0,0,e)}},JSONLoad(e){let t=null;try{t=JSON.parse(e)}catch(e){return void console.error("[Construct] Failed to parse JSON: ",e)}if(t.c2array){const s=t.size;this._cx=s[0],this._cy=s[1],this._cz=s[2],this._arr=t.data}},JSONDownload(e){const t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}{const n1=self.C3;n1.Plugins.Arr.Exps={At(e,t,s){return this.At(e,t||0,s||0)},Width(){return this._cx},Height(){return this._cy},Depth(){return this._cz},CurX(){return this._GetForX()},CurY(){return this._GetForY()},CurZ(){return this._GetForZ()},CurValue(){return this.At(this._GetForX(),this._GetForY(),this._GetForZ())},Front(){return this.At(0,0,0)},Back(){return this.At(this._cx-1,0,0)},IndexOf(s){const n=this._arr;for(let e=0,t=this._cx;e<t;++e)if(n[e][0][0]===s)return e;return-1},LastIndexOf(t){const s=this._arr;for(let e=this._cx-1;0<=e;--e)if(s[e][0][0]===t)return e;return-1},JoinString(e){let t=[];for(let e=0;e<this._cx;++e)t.push(this.At(e,0,0));return t.join(e)},AsJSON(){return this.GetAsJsonString()}}}{const a=self.C3;a.Plugins.Touch=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let GetTouchSdkInstance2=function(){return s.GetSingleGlobalInstance().GetSdkInstance()};GetTouchSdkInstance=GetTouchSdkInstance2;const d=self.C3,e=self.C3X;d.Plugins.Touch.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}};let s=null;self.ITouchObjectType=class extends self.IObjectClass{constructor(e){super(e),(s=e).GetRuntime()._GetCommonScriptInterfaces().touch=this}requestPermission(t){e.RequireString(t);const s=GetTouchSdkInstance2();if("orientation"===t)return s._RequestPermission(0);if("motion"===t)return s._RequestPermission(1);throw new Error("invalid type")}}}{const m=self.C3,n="touch";m.Plugins.Touch.Instance=class extends m.SDKInstanceBase{constructor(e,t){super(e,n),this._touches=new Map,this._useMouseInput=!1,this._isMouseDown=!1,this._orientCompassHeading=0,this._orientAlpha=0,this._orientBeta=0,this._orientGamma=0,this._accX=0,this._accY=0,this._accZ=0,this._accWithGX=0,this._accWithGY=0,this._accWithGZ=0,this._triggerIndex=0,this._triggerId=0,this._triggerPermission=0,this._curTouchX=0,this._curTouchY=0,this._getTouchIndex=0,this._triggerType=0,this._permissionPromises=[],t&&(this._useMouseInput=t[0]),this.AddDOMMessageHandler("permission-result",e=>this._OnPermissionResult(e));const s=this.GetRuntime().Dispatcher();this._disposables=new m.CompositeDisposable(m.Disposable.From(s,"pointerdown",e=>this._OnPointerDown(e.data)),m.Disposable.From(s,"pointermove",e=>this._OnPointerMove(e.data)),m.Disposable.From(s,"pointerup",e=>this._OnPointerUp(e.data,!1)),m.Disposable.From(s,"pointercancel",e=>this._OnPointerUp(e.data,!0)),m.Disposable.From(s,"deviceorientation",e=>this._OnDeviceOrientation(e.data)),m.Disposable.From(s,"deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e.data)),m.Disposable.From(s,"devicemotion",e=>this._OnDeviceMotion(e.data)),m.Disposable.From(s,"tick2",e=>this._OnTick2()))}Release(){this._touches.clear(),super.Release()}_OnPointerDown(e){if("mouse"===e.pointerType){if(!this._useMouseInput)return;this._isMouseDown=!0}const t=e.pointerId;if(!this._touches.has(t)){const s=e.pageX-this._runtime.GetCanvasClientX(),n=e.pageY-this._runtime.GetCanvasClientY(),i=performance.now(),r=this._touches.size,a=(this._triggerIndex=r,this._triggerId=t,m.New(m.Plugins.Touch.TouchInfo));a.Init(i,s,n,t,r),this._touches.set(t,a),this.Trigger(m.Plugins.Touch.Cnds.OnNthTouchStart),this.Trigger(m.Plugins.Touch.Cnds.OnTouchStart),this._curTouchX=s,this._curTouchY=n,this._triggerType=0,this.Trigger(m.Plugins.Touch.Cnds.OnTouchObject)}}_OnPointerMove(e){if("mouse"!==e.pointerType||this._isMouseDown){const t=this._touches.get(e.pointerId);if(t){const s=performance.now();if(!(s-t.GetTime()<2)){const n=e.pageX-this._runtime.GetCanvasClientX(),i=e.pageY-this._runtime.GetCanvasClientY();t.Update(s,n,i,e.width,e.height,e.pressure)}}}}_OnPointerUp(e,t){if("mouse"===e.pointerType){if(!this._isMouseDown)return;this._isMouseDown=!1}const s=performance.now(),n=e.pointerId,i=this._touches.get(n);if(i){if(this._triggerIndex=i.GetStartIndex(),this._triggerId=i.GetId(),!t){const r=e.pageX-this._runtime.GetCanvasClientX(),a=e.pageY-this._runtime.GetCanvasClientY();this._curTouchX=r,this._curTouchY=a,this._triggerType=1,this.Trigger(m.Plugins.Touch.Cnds.OnTouchObject)}if(this.Trigger(m.Plugins.Touch.Cnds.OnNthTouchEnd),this.Trigger(m.Plugins.Touch.Cnds.OnTouchEnd),!t){const o=i.ShouldTriggerTap(s);"single-tap"===o?(this.Trigger(m.Plugins.Touch.Cnds.OnTapGesture),this._curTouchX=i.GetX(),this._curTouchY=i.GetY(),this.Trigger(m.Plugins.Touch.Cnds.OnTapGestureObject)):"double-tap"===o&&(this.Trigger(m.Plugins.Touch.Cnds.OnDoubleTapGesture),this._curTouchX=i.GetX(),this._curTouchY=i.GetY(),this.Trigger(m.Plugins.Touch.Cnds.OnDoubleTapGestureObject))}i.Release(),this._touches.delete(n)}}_RequestPermission(s){return this._PostToDOMMaybeSync("request-permission",{type:s}),new Promise((e,t)=>{this._permissionPromises.push({type:s,resolve:e,reject:t})})}_OnPermissionResult(e){const t=e.result,s=e.type,n=(this._triggerPermission=s,this._permissionPromises.filter(e=>e.type===s));for(const i of n)i.resolve(t?"granted":"denied");this._permissionPromises=this._permissionPromises.filter(e=>e.type!==s),t?(this.Trigger(m.Plugins.Touch.Cnds.OnPermissionGranted),0===s?this._runtime.RequestDeviceOrientationEvent():this._runtime.RequestDeviceMotionEvent()):this.Trigger(m.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(e){"number"==typeof e.webkitCompassHeading?this._orientCompassHeading=e.webkitCompassHeading:e.absolute&&(this._orientCompassHeading=e.alpha),this._orientAlpha=e.alpha,this._orientBeta=e.beta,this._orientGamma=e.gamma}_OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e.alpha}_OnDeviceMotion(e){const t=e.acceleration,s=(t&&(this._accX=t.x,this._accY=t.y,this._accZ=t.z),e.accelerationIncludingGravity);s&&(this._accWithGX=s.x,this._accWithGY=s.y,this._accWithGZ=s.z)}_OnTick2(){let e=performance.now(),t=0;for(const s of this._touches.values())s.GetTime()<=e-50&&s._SetLastTime(e),s.ShouldTriggerHold(e)&&(this._triggerIndex=s.GetStartIndex(),this._triggerId=s.GetId(),this._getTouchIndex=t,this.Trigger(m.Plugins.Touch.Cnds.OnHoldGesture),this._curTouchX=s.GetX(),this._curTouchY=s.GetY(),this.Trigger(m.Plugins.Touch.Cnds.OnHoldGestureObject),this._getTouchIndex=0),++t}_GetTouchByIndex(e){e=Math.floor(e);for(const t of this._touches.values()){if(0===e)return t;--e}return null}_IsClientPosOnCanvas(e,t){return 0<=e&&0<=t&&e<this._runtime.GetCanvasCssWidth()&&t<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){return[{title:"plugins.touch.debugger.touches",properties:[...this._touches.values()].map(e=>({name:"$"+e.GetId(),value:e.GetX()+", "+e.GetY()}))}]}}}{const ra=self.C3,sa=[];ra.Plugins.Touch.Cnds={OnTouchStart(){return!0},OnTouchEnd(){return!0},IsInTouch(){return 0<this._touches.size},OnTouchObject(e,t){return!!e&&t===this._triggerType&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},IsTouchingObject(e){if(!e)return!1;const t=this._runtime.GetCurrentCondition(),s=t.IsInverted(),n=[...this._touches.values()].filter(e=>this._IsClientPosOnCanvas(e.GetX(),e.GetY())).map(e=>[e.GetX(),e.GetY()]);return ra.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,n,s),s)},CompareTouchSpeed(e,t,s){const n=this._GetTouchByIndex(e);return!!n&&ra.compare(n.GetSpeed(),t,s)},OrientationSupported(){return!0},MotionSupported(){return!0},CompareOrientation(e,t,s){this._runtime.RequestDeviceOrientationEvent();let n;return n=0===e?this._orientAlpha:1===e?this._orientBeta:this._orientGamma,ra.compare(n,t,s)},CompareAcceleration(e,t,s){this._runtime.RequestDeviceMotionEvent();let n;return n=0===e?this._accWithGX:1===e?this._accWithGY:2===e?this._accWithGZ:3===e?this._accX:4===e?this._accY:this._accZ,ra.compare(n,t,s)},OnNthTouchStart(e){return(e=Math.floor(e))===this._triggerIndex},OnNthTouchEnd(e){return(e=Math.floor(e))===this._triggerIndex},HasNthTouch(e){return e=Math.floor(e),this._touches.size>=e+1},OnHoldGesture(){return!0},OnTapGesture(){return!0},OnDoubleTapGesture(){return!0},OnHoldGestureObject(e){return!!e&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},OnTapGestureObject(e){return!!e&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},OnDoubleTapGestureObject(e){return!!e&&!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,[[this._curTouchX,this._curTouchY]],!1)},OnPermissionGranted(e){return this._triggerPermission===e},OnPermissionDenied(e){return this._triggerPermission===e}}}{const Va=self.C3;Va.Plugins.Touch.Acts={RequestPermission(e){this._RequestPermission(e)}}}{const Xa=self.C3;Xa.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!0):0},Y(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!1):0},XAt(e,t){const s=this._GetTouchByIndex(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YAt(e,t){const s=this._GetTouchByIndex(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},XForID(e,t){const s=this._touches.get(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YForID(e,t){const s=this._touches.get(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},AbsoluteX(){const e=this._GetTouchByIndex(0);return e?e.GetX():0},AbsoluteY(){const e=this._GetTouchByIndex(0);return e?e.GetY():0},AbsoluteXAt(e){const t=this._GetTouchByIndex(e);return t?t.GetX():0},AbsoluteYAt(e){const t=this._GetTouchByIndex(e);return t?t.GetY():0},AbsoluteXForID(e){const t=this._touches.get(e);return t?t.GetX():0},AbsoluteYForID(e){const t=this._touches.get(e);return t?t.GetY():0},SpeedAt(e){const t=this._GetTouchByIndex(e);return t?t.GetSpeed():0},SpeedForID(e){const t=this._touches.get(e);return t?t.GetSpeed():0},AngleAt(e){const t=this._GetTouchByIndex(e);return t?Xa.toDegrees(t.GetAngle()):0},AngleForID(e){const t=this._touches.get(e);return t?Xa.toDegrees(t.GetAngle()):0},CompassHeading(){return this._runtime.RequestDeviceOrientationEvent(),this._orientCompassHeading},Alpha(){return this._runtime.RequestDeviceOrientationEvent(),this._orientAlpha},Beta(){return this._runtime.RequestDeviceOrientationEvent(),this._orientBeta},Gamma(){return this._runtime.RequestDeviceOrientationEvent(),this._orientGamma},AccelerationXWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGX},AccelerationYWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGY},AccelerationZWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGZ},AccelerationX(){return this._runtime.RequestDeviceMotionEvent(),this._accX},AccelerationY(){return this._runtime.RequestDeviceMotionEvent(),this._accY},AccelerationZ(){return this._runtime.RequestDeviceMotionEvent(),this._accZ},TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(e){const t=this._touches.get(e);return t?t.GetWidth():0},HeightForID(e){const t=this._touches.get(e);return t?t.GetHeight():0},PressureForID(e){const t=this._touches.get(e);return t?t.GetPressure():0}}}{let C33=self.C3,GESTURE_HOLD_THRESHOLD=15,GESTURE_HOLD_TIMEOUT=500,GESTURE_TAP_TIMEOUT=333,GESTURE_DOUBLETAP_THRESHOLD=25,lastTapX=-1e3,lastTapY=-1e3,lastTapTime=-1e4;C33.Plugins.Touch.TouchInfo=class extends C33.DefendedBase{constructor(){super(),this._pointerId=0,this._startIndex=0,this._startTime=0,this._time=0,this._lastTime=0,this._startX=0,this._startY=0,this._x=0,this._y=0,this._lastX=0,this._lastY=0,this._width=0,this._height=0,this._pressure=0,this._hasTriggeredHold=!1,this._isTooFarForHold=!1}Release(){}Init(e,t,s,n,i){this._pointerId=n,this._startIndex=i,this._time=e,this._lastTime=e,this._startTime=e,this._startX=t,this._startY=s,this._x=t,this._y=s,this._lastX=t,this._lastY=s}Update(e,t,s,n,i,r){this._lastTime=this._time,this._time=e,this._lastX=this._x,this._lastY=this._y,this._x=t,this._y=s,this._width=n,this._height=i,this._pressure=r,!this._isTooFarForHold&&C33.distanceTo(this._startX,this._startY,this._x,this._y)>=GESTURE_HOLD_THRESHOLD&&(this._isTooFarForHold=!0)}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(e){this._lastTime=e}GetX(){return this._x}GetY(){return this._y}GetSpeed(){const e=C33.distanceTo(this._x,this._y,this._lastX,this._lastY),t=(this._time-this._lastTime)/1e3;return 0<t?e/t:0}GetAngle(){return C33.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(e){return!this._hasTriggeredHold&&e-this._startTime>=GESTURE_HOLD_TIMEOUT&&!this._isTooFarForHold&&C33.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD&&(this._hasTriggeredHold=!0)}ShouldTriggerTap(e){return!this._hasTriggeredHold&&e-this._startTime<=GESTURE_TAP_TIMEOUT&&!this._isTooFarForHold&&C33.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD?e-lastTapTime<=2*GESTURE_TAP_TIMEOUT&&C33.distanceTo(lastTapX,lastTapY,this._x,this._y)<GESTURE_DOUBLETAP_THRESHOLD?(lastTapX=-1e3,lastTapY=-1e3,lastTapTime=-1e4,"double-tap"):(lastTapX=this._x,lastTapY=this._y,lastTapTime=e,"single-tap"):""}GetPositionForLayer(e,t,s){if(void 0===t){const n=e.GetLayerByIndex(0);return n.CanvasCssToLayer_DefaultTransform(this._x,this._y)[s?0:1]}{const i=e.GetLayer(t);return i?i.CanvasCssToLayer(this._x,this._y)[s?0:1]:0}}}}{const a=self.C3;a.Plugins.LocalStorage=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.LocalStorage.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h="localstorage";g.Plugins.LocalStorage.Instance=class extends g.SDKInstanceBase{constructor(e,t){super(e,h),this._currentKey="",this._lastValue="",this._keyNamesList=[],this._errorMessage="",this._isPersistent=!1,this._pendingGets=0,this._pendingSets=0,this._isInMemoryOnly=!1,t&&(this._isInMemoryOnly=t[0]);const s=this._runtime._GetProjectStorage();this._storage=null,this._isInMemoryOnly?this._storage=s.createInstance({forceInMemoryFallback:!0}):this._storage=s,this._debugCache=new Map,this._isLoadingDebugCache=!1,this._runtime.AddLoadPromise(this._Init())}async _Init(){const e=await Promise.race([this.PostToDOMAsync("init"),g.Wait(3e3)]);e&&(this._isPersistent=e.isPersistent)}Release(){super.Release()}async _TriggerStorageError(e){this._errorMessage=this._GetErrorString(e),await this.TriggerAsync(g.Plugins.LocalStorage.Cnds.OnError)}_GetErrorString(e){return e?"string"==typeof e?e:"string"==typeof e.message?e.message:"string"==typeof e.name?e.name:"string"==typeof e.data?e.data:"unknown error":"unknown error"}GetDebuggerProperties(){return this._isLoadingDebugCache||this._DebugCacheStorage(),[{title:"plugins.localstorage.name",properties:[...this._debugCache.entries()].map(t=>({name:"$"+t[0],value:t[1],onedit:e=>this._storage.setItem(t[0],e)}))}]}async _DebugCacheStorage(){this._isLoadingDebugCache=!0;try{const s=await this._storage.keys(),n=(s.sort((e,t)=>{const s=e.toLowerCase(),n=t.toLowerCase();return s<n?-1:n<s?1:0}),await Promise.all(s.map(e=>this._storage.getItem(e))));this._debugCache.clear();for(let e=0,t=s.length;e<t;++e)this._debugCache.set(s[e],n[e])}catch(e){console.warn("[C3 debugger] Error displaying local storage: ",e)}finally{this._isLoadingDebugCache=!1}}}}{const B=self.C3;B.Plugins.LocalStorage.Cnds={OnItemSet(e){return this._currentKey===e},OnAnyItemSet(){return!0},OnItemGet(e){return this._currentKey===e},OnAnyItemGet(){return!0},OnItemRemoved(e){return this._currentKey===e},OnAnyItemRemoved(){return!0},OnCleared(){return!0},OnAllKeyNamesLoaded(){return!0},OnError(){return!0},OnItemExists(e){return this._currentKey===e},OnItemMissing(e){return this._currentKey===e},CompareKey(e,t){return B.compare(this._currentKey,e,t)},CompareValue(e,t){return B.compare(this._lastValue,e,t)},IsProcessingSets(){return 0<this._pendingSets},IsProcessingGets(){return 0<this._pendingGets},OnAllSetsComplete(){return!0},OnAllGetsComplete(){return!0},IsPersistent(){return this._isPersistent}}}{let IsExpressionType2=function(e){return"string"==typeof e||"number"==typeof e};IsExpressionType=IsExpressionType2;const L=self.C3;L.Plugins.LocalStorage.Acts={async SetItem(e,t){this._pendingSets++;try{const s=await this._storage.setItem(e,t);await this.ScheduleTriggers(async()=>{this._currentKey=e,this._lastValue=s,await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemSet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}},async SetBinaryItem(e,t){if(t){const s=t.GetFirstPicked(this._inst);if(s){const n=s.GetSdkInstance();if(n){const i=n.GetArrayBufferReadOnly();this._pendingSets++;try{await this._storage.setItem(e,i),await this.ScheduleTriggers(async()=>{this._currentKey=e,this._lastValue="",await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemSet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}}}}},async GetItem(e){this._pendingGets++;try{const t=await this._storage.getItem(e);await this.ScheduleTriggers(async()=>{this._currentKey=e,this._lastValue=IsExpressionType2(t)?t:"",await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemGet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}},async GetBinaryItem(t,e){if(e){const s=e.GetFirstPicked(this._inst);if(s){const n=s.GetSdkInstance();this._pendingGets++;try{let e=await this._storage.getItem(t);e=e instanceof ArrayBuffer?e:new ArrayBuffer(0),await this.ScheduleTriggers(async()=>{this._lastValue="",this._currentKey=t,n.SetArrayBufferTransfer(e),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemGet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}}}},async CheckItemExists(e){try{const t=await this._storage.getItem(e);await this.ScheduleTriggers(async()=>{this._currentKey=e,null==t?(this._lastValue="",await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemMissing)):(this._lastValue=IsExpressionType2(t)?t:"",await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemExists))})}catch(e){await this._TriggerStorageError(e)}},async RemoveItem(e){try{await this._storage.removeItem(e),await this.ScheduleTriggers(async()=>{this._currentKey=e,this._lastValue="",await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAnyItemRemoved),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnItemRemoved)})}catch(e){await this._TriggerStorageError(e)}},async ClearStorage(){try{await this._storage.clear(),await this.ScheduleTriggers(async()=>{this._currentKey="",this._lastValue="",L.clearArray(this._keyNamesList),await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnCleared)})}catch(e){await this._TriggerStorageError(e)}},async GetAllKeyNames(){try{const e=await this._storage.keys();await this.ScheduleTriggers(async()=>{this._keyNamesList=e,await this.TriggerAsync(L.Plugins.LocalStorage.Cnds.OnAllKeyNamesLoaded)})}catch(e){await this._TriggerStorageError(e)}},async RequestPersistent(){const e=await this.PostToDOMAsync("request-persistent");e.isOk&&(this._isPersistent=e.isPersistent)},LoadMemoryFromJSON(t){if(this._isInMemoryOnly){let e;try{e=JSON.parse(t)}catch(e){return void console.error("[Local Storage] Failed to parse memory storage JSON: ",e)}e&&e["is-c3-storage"]&&Array.isArray(e.items)||console.error("[Local Storage] Failed to load memory storage JSON: invalid data"),this._storage.SetMemoryStorage(new Map(e.items))}}}}{const qa=self.C3;qa.Plugins.LocalStorage.Exps={ItemValue(){return this._lastValue},Key(){return this._currentKey},KeyCount(){return this._keyNamesList.length},KeyAt(e){return(e=Math.floor(e))<0||e>=this._keyNamesList.length?"":this._keyNamesList[e]},ErrorMessage(){return this._errorMessage},MemoryStorageAsJSON(){return this._isInMemoryOnly?JSON.stringify({"is-c3-storage":!0,items:[...this._storage.GetMemoryStorage()]}):""}}}{const a=self.C3;a.Plugins.Dictionary=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Dictionary.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=self.C3X,i=self.IInstance,j=(g.Plugins.Dictionary.Instance=class extends g.SDKInstanceBase{constructor(e,t){super(e),this._data=new Map,this._curKey=""}Release(){this._data.clear(),super.Release()}GetAsJsonString(){return JSON.stringify({c2dictionary:!0,data:g.MapToObject(this._data)})}GetDataMap(){return this._data}SaveToJson(){return g.MapToObject(this._data)}LoadFromJson(e){g.ObjectToMap(e,this._data)}GetDebuggerProperties(){const e="plugins.dictionary";return[{title:e+".name",properties:[{name:e+".debugger.key-count",value:this._data.size},...[...this._data].map(t=>({name:"$"+t[0],value:t[1],onedit:e=>this._data.set(t[0],e)}))]}]}GetScriptInterfaceClass(){return self.IDictionaryInstance}},new WeakMap);self.IDictionaryInstance=class extends i{constructor(){super(),j.set(this,i._GetInitInst().GetSdkInstance())}getDataMap(){return j.get(this).GetDataMap()}}}{const s=self.C3;s.Plugins.Dictionary.Cnds={CompareValue(e,t,n){const i=this._data.get(e);return void 0!==i&&s.compare(i,t,n)},ForEachKey(){const e=this._runtime,t=e.GetEventSheetManager(),s=e.GetCurrentEvent(),n=s.GetSolModifiers(),i=e.GetEventStack(),r=i.GetCurrentStackFrame(),a=i.Push(s);e.SetDebuggingEnabled(!1);for(const o of this._data.keys()){this._curKey=o,t.PushCopySol(n);const l=this.GetObjectClass().GetCurrentSol();l.PickOne(this.GetInstance()),s.Retrigger(r,a),t.PopSol(n)}return e.SetDebuggingEnabled(!0),this._curKey="",i.Pop(),!1},CompareCurrentValue(e,t){const n=this._data.get(this._curKey);return void 0!==n&&s.compare(n,e,t)},HasKey(e){return this._data.has(e)},IsEmpty(){return 0===this._data.size}}}{const K=self.C3;K.Plugins.Dictionary.Acts={AddKey(e,t){this._data.set(e,t)},SetKey(e,t){this._data.has(e)&&this._data.set(e,t)},DeleteKey(e){this._data.delete(e)},Clear(){this._data.clear()},JSONLoad(e){let t=null;try{t=JSON.parse(e)}catch(e){return void console.error("[Construct] Error parsing JSON: ",e)}t.c2dictionary&&K.ObjectToMap(t.data,this._data)},JSONDownload(e){const t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}{const V=self.C3;V.Plugins.Dictionary.Exps={Get(e){const t=this._data.get(e);return void 0===t?0:t},GetDefault(e,t){const s=this._data.get(e);return void 0===s?t:s},KeyCount(){return this._data.size},CurrentKey(){return this._curKey},CurrentValue(){return this._data.get(this._curKey)??0},AsJSON(){return this.GetAsJsonString()}}}{const a=self.C3;a.Plugins.Mouse=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let GetMouseSdkInstance2=function(){return t.GetSingleGlobalInstance().GetSdkInstance()};GetMouseSdkInstance=GetMouseSdkInstance2;const d=self.C3,e=self.C3X;d.Plugins.Mouse.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IMouseObjectType}};let t=null;self.IMouseObjectType=class extends self.IObjectClass{constructor(e){super(e),(t=e).GetRuntime()._GetCommonScriptInterfaces().mouse=this}getMouseX(e){return GetMouseSdkInstance2().GetMousePositionForLayer(e)[0]}getMouseY(e){return GetMouseSdkInstance2().GetMousePositionForLayer(e)[1]}getMousePosition(e){return GetMouseSdkInstance2().GetMousePositionForLayer(e)}isMouseButtonDown(e){return GetMouseSdkInstance2().IsMouseButtonDown(e)}setCursorStyle(t){e.RequireString(t),GetMouseSdkInstance2().SetCursorStyle(t)}setCursorObjectClass(e){const t=GetMouseSdkInstance2(),s=t.GetRuntime(),n=s._UnwrapIObjectClass(e);t.SetCursorObjectClass(n)}}}{let t=self.C3,u="mouse",a=null;t.Plugins.Mouse.Instance=class extends t.SDKInstanceBase{constructor(e,s){super(e,u),this._buttonMap=[!1,!1,!1,!1,!1],this._mouseXcanvas=0,this._mouseYcanvas=0,this._triggerButton=0,this._triggerType=0,this._triggerDir=0,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._hasPointerLock=!1,this._movementX=0,this._movementY=0,this.AddDOMMessageHandlers([["pointer-lock-change",e=>this._OnPointerLockChange(e)],["pointer-lock-error",e=>this._OnPointerLockError(e)]]);const n=this.GetRuntime().Dispatcher();this._disposables=new t.CompositeDisposable(t.Disposable.From(n,"pointermove",e=>this._OnPointerMove(e.data)),t.Disposable.From(n,"pointerdown",e=>this._OnPointerDown(e.data)),t.Disposable.From(n,"pointerup",e=>this._OnPointerUp(e.data)),t.Disposable.From(n,"dblclick",e=>this._OnDoubleClick(e.data)),t.Disposable.From(n,"wheel",e=>this._OnMouseWheel(e.data)),t.Disposable.From(n,"window-blur",()=>this._OnWindowBlur()))}Release(){super.Release()}_OnPointerDown(e){"mouse"===e.pointerType&&(this._mouseXcanvas=e.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=e.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(e.lastButtons,e.buttons))}_OnPointerMove(e){this._movementX=e.movementX,this._movementY=e.movementY,this.Trigger(t.Plugins.Mouse.Cnds.OnMovement),this._movementX=0,this._movementY=0,"mouse"===e.pointerType&&(this._mouseXcanvas=e.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=e.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(e.lastButtons,e.buttons))}_OnPointerUp(e){"mouse"===e.pointerType&&this._CheckButtonChanges(e.lastButtons,e.buttons)}_CheckButtonChanges(e,t){this._CheckButtonChange(e,t,1,0),this._CheckButtonChange(e,t,4,1),this._CheckButtonChange(e,t,2,2),this._CheckButtonChange(e,t,8,3),this._CheckButtonChange(e,t,16,4)}_CheckButtonChange(e,t,s,n){!(e&s)&&t&s?this._OnMouseDown(n):e&s&&!(t&s)&&this._OnMouseUp(n)}_OnMouseDown(e){this._buttonMap[e]=!0,this.Trigger(t.Plugins.Mouse.Cnds.OnAnyClick),this._triggerButton=e,this._triggerType=0,this.Trigger(t.Plugins.Mouse.Cnds.OnClick),this.Trigger(t.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseUp(e){this._buttonMap[e]&&(this._buttonMap[e]=!1,this._triggerButton=e,this.Trigger(t.Plugins.Mouse.Cnds.OnRelease))}_OnDoubleClick(e){this._triggerButton=e.button,this._triggerType=1,this.Trigger(t.Plugins.Mouse.Cnds.OnClick),this.Trigger(t.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseWheel(e){this._triggerDir=e.deltaY<0?1:0,this._wheelDeltaX=e.deltaX,this._wheelDeltaY=e.deltaY,this._wheelDeltaZ=e.deltaZ,this.Trigger(t.Plugins.Mouse.Cnds.OnWheel)}_OnWindowBlur(){for(let e=0,s=this._buttonMap.length;e<s;++e){if(!this._buttonMap[e])return;this._buttonMap[e]=!1,this._triggerButton=e,this.Trigger(t.Plugins.Mouse.Cnds.OnRelease)}}GetMousePositionForLayer(e){const t=this._runtime.GetMainRunningLayout(),s=this._mouseXcanvas,n=this._mouseYcanvas;if(void 0===e){const i=t.GetLayerByIndex(0);return i.CanvasCssToLayer_DefaultTransform(s,n)}{const r=t.GetLayer(e);return r?r.CanvasCssToLayer(s,n):[0,0]}}IsMouseButtonDown(e){return e=Math.floor(e),!!this._buttonMap[e]}_IsMouseOverCanvas(){return 0<=this._mouseXcanvas&&0<=this._mouseYcanvas&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight()}SetCursorStyle(e){a!==e&&(a=e,this.PostToDOM("cursor",e))}async SetCursorObjectClass(e){if(!t.Platform.IsMobile&&e){const s=e.GetFirstPicked();if(s){const n=s.GetWorldInfo(),i=s.GetCurrentImageInfo();if(n&&i&&a!==i){const r=await(a=i).ExtractImageToBlobURL(),o=`url(${r}) ${Math.round(n.GetOriginX()*i.GetWidth())} ${Math.round(n.GetOriginY()*i.GetHeight())}, auto`;this.PostToDOM("cursor",o)}}}}_OnPointerLockChange(e){this._UpdatePointerLockState(e["has-pointer-lock"])}_OnPointerLockError(e){this._UpdatePointerLockState(e["has-pointer-lock"]),this.Trigger(t.Plugins.Mouse.Cnds.OnPointerLockError)}_UpdatePointerLockState(e){this._hasPointerLock!==e&&(this._hasPointerLock=e,this._hasPointerLock?this.Trigger(t.Plugins.Mouse.Cnds.OnPointerLocked):this.Trigger(t.Plugins.Mouse.Cnds.OnPointerUnlocked))}GetDebuggerProperties(){const e="plugins.mouse";return[{title:e+".name",properties:[{name:e+".debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:e+".debugger.left-button",value:this._buttonMap[0]},{name:e+".debugger.middle-button",value:this._buttonMap[1]},{name:e+".debugger.right-button",value:this._buttonMap[2]},{name:e+".debugger.button-4",value:this._buttonMap[3]},{name:e+".debugger.button-5",value:this._buttonMap[4]}]},{title:e+".debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map(e=>({name:"$"+e.GetName(),value:e.CanvasCssToLayer(this._mouseXcanvas,this._mouseYcanvas).join(", ")}))}]}}}{const na=self.C3;na.Plugins.Mouse.Cnds={OnClick(e,t){return this._triggerButton===e&&this._triggerType===t},OnAnyClick(){return!0},IsButtonDown(e){return this._buttonMap[e]},OnRelease(e){return this._triggerButton===e},IsOverObject(e){const t=this._runtime.GetCurrentCondition(),s=t.IsInverted(),n=[];return this._IsMouseOverCanvas()&&n.push([this._mouseXcanvas,this._mouseYcanvas]),na.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,n,s),s)},OnObjectClicked(e,t,s){if(e!==this._triggerButton||t!==this._triggerType)return!1;if(!this._IsMouseOverCanvas())return!1;const n=this._mouseXcanvas,i=this._mouseYcanvas;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(s,[[n,i]],!1)},OnWheel(e){return 2===e||this._triggerDir===e},OnPointerLocked(){return!0},OnPointerUnlocked(){return!0},OnPointerLockError(){return!0},HasPointerLock(){return this._hasPointerLock},OnMovement(){return!0}}}{const Ca=self.C3,Da=["auto","pointer","text","crosshair","move","help","wait","none"];Ca.Plugins.Mouse.Acts={SetCursor(e){this.SetCursorStyle(Da[e])},SetCursorSprite(e){this.SetCursorObjectClass(e)},RequestPointerLock(e){this._PostToDOMMaybeSync("request-pointer-lock",{unadjustedMovement:e})},ReleasePointerLock(){this.PostToDOM("release-pointer-lock")}}}{const Ha=self.C3;Ha.Plugins.Mouse.Exps={X(e){return this.GetMousePositionForLayer(e)[0]},Y(e){return this.GetMousePositionForLayer(e)[1]},AbsoluteX(){return this._mouseXcanvas},AbsoluteY(){return this._mouseYcanvas},MovementX(){return this._movementX},MovementY(){return this._movementY},WheelDeltaX(){return this._wheelDeltaX},WheelDeltaY(){return this._wheelDeltaY},WheelDeltaZ(){return this._wheelDeltaZ}}}{const C33=self.C3;C33.Plugins.Browser=class BrowserPlugin extends C33.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const C33=self.C3;C33.Plugins.Browser.Type=class BrowserType extends C33.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const C33=self.C3,DOM_COMPONENT_ID="browser";C33.Plugins.Browser.Instance=class BrowserInstance extends C33.SDKInstanceBase{constructor(e,t){super(e,DOM_COMPONENT_ID),this._initLocationStr="",this._isOnline=!1,this._referrer="",this._docTitle="",this._isCookieEnabled=!1,this._screenWidth=0,this._screenHeight=0,this._windowOuterWidth=0,this._windowOuterHeight=0,this._isConstructArcade=!1,this._cssStyleMap=new Map,this._isInstallAvailable=!1,this._installResult="",this._isWarnOnCloseEnabled=!1,this.AddDOMMessageHandlers([["online-state",e=>this._OnOnlineStateChanged(e)],["backbutton",()=>this._OnBackButton()],["sw-message",e=>this._OnSWMessage(e)],["hashchange",e=>this._OnHashChange(e)],["install-available",()=>this._OnInstallAvailable()],["app-installed",e=>this._OnAppInstalled(e)]]);const s=this.GetRuntime().Dispatcher();this._disposables=new C33.CompositeDisposable(C33.Disposable.From(s,"afterfirstlayoutstart",()=>this._OnAfterFirstLayoutStart()),C33.Disposable.From(s,"window-resize",()=>this._OnWindowResize()),C33.Disposable.From(s,"suspend",()=>this._OnSuspend()),C33.Disposable.From(s,"resume",()=>this._OnResume())),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state",{exportType:this._runtime.GetExportType()}).then(e=>{this._initLocationStr=e.location,this._isOnline=e.isOnline,this._referrer=e.referrer,this._docTitle=e.title,this._isCookieEnabled=e.isCookieEnabled,this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._isConstructArcade=e.isConstructArcade}))}Release(){super.Release()}_OnAfterFirstLayoutStart(){this.PostToDOM("ready-for-sw-messages")}async _OnOnlineStateChanged(e){const t=!!e.isOnline;this._isOnline!==t&&(this._isOnline=t,this._isOnline?await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnOnline):await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnOffline))}async _OnWindowResize(){await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnResize)}_OnSuspend(){this.Trigger(C33.Plugins.Browser.Cnds.OnPageHidden)}_OnResume(){this.Trigger(C33.Plugins.Browser.Cnds.OnPageVisible)}async _OnBackButton(){await this.TriggerAsync(C33.Plugins.Browser.Cnds.OnBackButton)}_OnSWMessage(e){const t=e.type;"downloading-update"===t?this.Trigger(C33.Plugins.Browser.Cnds.OnUpdateFound):"update-ready"===t||"update-pending"===t?this.Trigger(C33.Plugins.Browser.Cnds.OnUpdateReady):"offline-ready"===t&&this.Trigger(C33.Plugins.Browser.Cnds.OnOfflineReady)}_OnHashChange(e){this._initLocationStr=e.location,this.Trigger(C33.Plugins.Browser.Cnds.OnHashChange)}_OnInstallAvailable(){this._isInstallAvailable=!0,this.Trigger(C33.Plugins.Browser.Cnds.OnInstallAvailable)}_OnAppInstalled(e){this._isInstallAvailable=!1,this.Trigger(C33.Plugins.Browser.Cnds.OnAppInstalled)}_IsWarnOnCloseEnabled(){return this._isWarnOnCloseEnabled}_SetWarnOnCloseEnabled(e){this._isWarnOnCloseEnabled!==(e=!!e)&&(this._isWarnOnCloseEnabled=e,this.PostToDOM("set-warn-on-close",{enabled:e}))}GetDebuggerProperties(){const e="plugins.browser.debugger";return[{title:"plugins.browser.name",properties:[{name:e+".user-agent",value:navigator.userAgent},{name:e+".is-online",value:this._isOnline},{name:e+".is-fullscreen",value:this._runtime.GetCanvasManager().IsDocumentFullscreen()}]}]}}}{const C33=self.C3;C33.Plugins.Browser.Cnds={IsOnline(){return this._isOnline},OnOnline(){return!0},OnOffline(){return!0},OnResize(){return!0},CookiesEnabled(){return this._isCookieEnabled},IsFullscreen(){return this._runtime.GetCanvasManager().IsDocumentFullscreen()},OnBackButton(){return!0},IsPortraitLandscape(e){const t=this._runtime.GetCanvasManager().GetLastWidth(),s=this._runtime.GetCanvasManager().GetLastHeight(),n=t<=s?0:1;return n===e},OnUpdateFound(){return!0},OnUpdateReady(){return!0},OnOfflineReady(){return!0},OnHashChange(){return!0},OnInstallAvailable(){return!0},IsInstallAvailable(){return this._isInstallAvailable},OnInstallResult(e){switch(e){case 0:return"accepted"===this._installResult;case 1:return"dismissed"===this._installResult;case 2:return"error"===this._installResult;case 3:return!0;default:return!1}},OnAppInstalled(){return!0},CompareDisplayMode(e){const t=this._runtime.GetCanvasManager().GetCssDisplayMode();switch(e){case 0:return"browser"===t;case 1:return"minimal-ui"===t;case 2:return"standalone"===t;case 3:return"fullscreen"===t;default:return!1}},IsWarnOnCloseEnabled(){return this._IsWarnOnCloseEnabled()},PageVisible(){return!this._runtime.IsSuspended()},OnPageHidden(){return!0},OnPageVisible(){return!0},HasJava(){return!1},IsDownloadingUpdate(){return!1},OnMenuButton(){return!1},OnSearchButton(){return!1},IsMetered(){return!1},IsCharging(){return!0},SupportsFullscreen(){return!0}}}{const C3=self.C3,ORIENTATIONS=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];C3.Plugins.Browser.Acts={Alert(e){this.PostToDOM("alert",{message:e.toString()})},Close(){this._isConstructArcade||(this._runtime.IsDebug()?self.C3Debugger.CloseWindow():this.PostToDOM("close"))},Focus(){this.PostToDOM("set-focus",{isFocus:!0})},Blur(){this.PostToDOM("set-focus",{isFocus:!1})},GoBack(){this._isConstructArcade||this.PostToDOM("navigate",{type:"back"})},GoForward(){this._isConstructArcade||this.PostToDOM("navigate",{type:"forward"})},GoHome(){},Reload(){this._isConstructArcade||(this._runtime.IsDebug()?this._runtime.PostToDebugger({type:"reload"}):this.PostToDOM("navigate",{type:"reload"}))},GoToURL(e,t){this._PostToDOMMaybeSync("navigate",{type:"url",url:e,target:t,exportType:this._runtime.GetExportType()})},GoToURLWindow(e,t){this._PostToDOMMaybeSync("navigate",{type:"new-window",url:e,tag:t,exportType:this._runtime.GetExportType()})},RequestFullScreen(e,t){2<=e&&(e+=1),1===(e=6===e?2:e)&&(e=0);const s=C3.CanvasManager._FullscreenModeNumberToString(e);this._runtime.GetCanvasManager().SetDocumentFullscreenMode(s),this._PostToDOMMaybeSync("request-fullscreen",{navUI:t})},CancelFullScreen(){this._PostToDOMMaybeSync("exit-fullscreen")},Vibrate(e){const s=e.split(",");for(let e=0,t=s.length;e<t;++e)s[e]=parseInt(s[e],10);this._PostToDOMMaybeSync("vibrate",{pattern:s})},async InvokeDownload(e,t){if(e&&t){const s=await this._runtime.GetAssetManager().GetProjectFileUrl(e);this._runtime.InvokeDownload(s,t)}},InvokeDownloadString(e,t,s){if(s){const n=`data:${t},`+encodeURIComponent(e);this._runtime.InvokeDownload(n,s)}},ConsoleLog(e,t){t=t.toString(),0===e?console.log(t):1===e?console.warn(t):2===e&&console.error(t)},ConsoleGroup(e){console.group(e)},ConsoleGroupEnd(){console.groupEnd()},ExecJs(jsStr){try{eval(jsStr)}catch(err){console.error("Error executing JavaScript: ",err)}},LockOrientation(e){if(!((e=Math.floor(e))<0||e>=ORIENTATIONS.length)){const t=ORIENTATIONS[e];this._PostToDOMMaybeSync("lock-orientation",{orientation:t})}},UnlockOrientation(){this._PostToDOMMaybeSync("unlock-orientation")},LoadStyleSheet(e){this._runtime.GetAssetManager().LoadStyleSheet(e)},async SetDocumentCSSStyle(e,t,s,n){await this.PostToDOMAsync("set-document-css-style",{prop:C3.CSSToCamelCase(e),value:t,selector:s,"is-all":0!==n})},async GetDocumentCSSStyle(e,t,s){const n=await this.PostToDOMAsync("get-document-css-style",{prop:e,selector:t});n.isOk&&this._cssStyleMap.set(s.toLowerCase(),n.result.trim())},SetHash(e){this.PostToDOM("set-hash",{hash:e})},SetWindowSize(e,t){this.PostToDOM("set-window-size",{windowWidth:e,windowHeight:t})},SetWindowPosition(e,t){this.PostToDOM("set-window-position",{windowX:e,windowY:t})},async RequestInstall(){const e=await this.PostToDOMAsync("request-install");this._installResult=e.result,this.Trigger(C3.Plugins.Browser.Cnds.OnInstallResult)},SetWarnOnClose(e){this._SetWarnOnCloseEnabled(e)}}}{const C3=self.C3;C3.Plugins.Browser.Exps={URL(){return this._runtime.IsInWorker()?this._initLocationStr:location.toString()},Protocol(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).protocol},Domain(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).hostname},Port(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).port},PathName(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).pathname},Hash(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).hash},QueryString(){return(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).search},QueryParam(e){const t=(this._runtime.IsInWorker()?new URL(this._initLocationStr):location).search,s=RegExp("[?&]"+e+"=([^&]*)").exec(t);return s?decodeURIComponent(s[1].replace(/\+/g," ")):""},Referrer(){return this._referrer},Title(){return this._docTitle},Language(){return navigator.language},Platform(){return navigator.platform},UserAgent(){return navigator.userAgent},ExecJS(jsStr){let result=0;try{result=eval(jsStr)}catch(err){console.error("Error executing JavaScript: ",err)}return"number"==typeof result||"string"==typeof result?result:"boolean"==typeof result&&result?1:0},CSSStyleValue(e){return this._cssStyleMap.get(e)||""},Name(){return navigator.appName},Version(){return navigator.appVersion},Product(){return navigator.product},Vendor(){return navigator.vendor},BatteryLevel(){return 1},BatteryTimeLeft(){return 1/0},Bandwidth(){const e=navigator.connection;return e&&(e.downlink||e.downlinkMax||e.bandwidth)||1/0},ConnectionType(){const e=navigator.connection;return e&&e.type||"unknown"},DevicePixelRatio(){return self.devicePixelRatio},ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterWidth},DisplayMode(){return this._runtime.GetCanvasManager().GetCssDisplayMode()},InstallResult(){return this._installResult}}}{const a=self.C3;a.Plugins.Date=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Date.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3;g.Plugins.Date.Instance=class extends g.SDKInstanceBase{constructor(e,t){super(e)}}}{const k=self.C3,l=[],m=(l[0]=[e=>k.Plugins.Date.Exps.GetYear(e),e=>k.Plugins.Date.Exps.GetMonth(e),e=>k.Plugins.Date.Exps.GetDate(e),e=>k.Plugins.Date.Exps.GetDay(e),e=>k.Plugins.Date.Exps.GetHours(e),e=>k.Plugins.Date.Exps.GetMinutes(e),e=>k.Plugins.Date.Exps.GetSeconds(e),e=>k.Plugins.Date.Exps.GetMilliseconds(e)],l[1]=[e=>k.Plugins.Date.Exps.GetUTCYear(e),e=>k.Plugins.Date.Exps.GetUTCMonth(e),e=>k.Plugins.Date.Exps.GetUTCDate(e),e=>k.Plugins.Date.Exps.GetUTCDay(e),e=>k.Plugins.Date.Exps.GetUTCHours(e),e=>k.Plugins.Date.Exps.GetUTCMinutes(e),e=>k.Plugins.Date.Exps.GetUTCSeconds(e),e=>k.Plugins.Date.Exps.GetUTCMilliseconds(e)],e=>k.Plugins.Date.Exps.Parse(e));k.Plugins.Date.Cnds={CompareTimeStamps(e,t,s){return k.compare(e,t,s)},CompareDateStrings(e,t,s){return k.compare(m(e),t,m(s))},CompareTimestampParts(e,t,s,n){return k.compare(l[1][n](e),t,l[1][n](s))},CompareDateStringParts(e,t,s,n,i){return k.compare(l[i][n](m(e)),t,l[i][n](m(s)))}}}{const T=self.C3;T.Plugins.Date.Acts={}}{const U=self.C3,V=self.Intl,W=new Map,X=(W.set("local",new Map([["year",e=>new Date(e).getFullYear()],["month",e=>new Date(e).getMonth()],["date",e=>new Date(e).getDate()],["day",e=>new Date(e).getDay()],["hours",e=>new Date(e).getHours()],["minutes",e=>new Date(e).getMinutes()],["seconds",e=>new Date(e).getSeconds()],["milliseconds",e=>new Date(e).getMilliseconds()]])),W.set("universal",new Map([["year",e=>new Date(e).getUTCFullYear()],["month",e=>new Date(e).getUTCMonth()],["date",e=>new Date(e).getUTCDate()],["day",e=>new Date(e).getUTCDay()],["hours",e=>new Date(e).getUTCHours()],["minutes",e=>new Date(e).getUTCMinutes()],["seconds",e=>new Date(e).getUTCSeconds()],["milliseconds",e=>new Date(e).getUTCMilliseconds()]])),new Map),Y=(X.set("local",new Map([["year",(e,t)=>new Date(e).setFullYear(t)],["month",(e,t)=>new Date(e).setMonth(t)],["date",(e,t)=>new Date(e).setDate(t)],["hours",(e,t)=>new Date(e).setHours(t)],["minutes",(e,t)=>new Date(e).setMinutes(t)],["seconds",(e,t)=>new Date(e).setSeconds(t)],["milliseconds",(e,t)=>new Date(e).setMilliseconds(t)]])),X.set("universal",new Map([["year",(e,t)=>new Date(e).setUTCFullYear(t)],["month",(e,t)=>new Date(e).setUTCMonth(t)],["date",(e,t)=>new Date(e).setUTCDate(t)],["hours",(e,t)=>new Date(e).setUTCHours(t)],["minutes",(e,t)=>new Date(e).setUTCMinutes(t)],["seconds",(e,t)=>new Date(e).setUTCSeconds(t)],["milliseconds",(e,t)=>new Date(e).setUTCMilliseconds(t)]])),function(e,t,s,n){s.includes(e)&&(n[t]=e)}),Z=function(e,t){e&&("12"===e?t.hour12=!0:"24"===e&&(t.hour12=!1))},$=function(e){try{return V.getCanonicalLocales(e)}catch(e){return self.navigator.language}},_=["full","long","medium","short"],aa=["full","long","medium","short"],ba=["long","short","narrow"],ca=["numeric","2-digit"],da=["numeric","2-digit","long","short","narrow"],ea=["numeric","2-digit"],fa=["numeric","2-digit"],ga=["numeric","2-digit"],ha=["numeric","2-digit"];U.Plugins.Date.Exps={ToString(e){return new Date(e).toString()},ToDateString(e){return new Date(e).toDateString()},ToTimeString(e){return new Date(e).toTimeString()},ToLocaleString(e){return new Date(e).toLocaleString()},ToLocaleDateString(e){return new Date(e).toLocaleDateString()},ToLocaleTimeString(e){return new Date(e).toLocaleTimeString()},ToUTCString(e){return new Date(e).toUTCString()},Parse(e){return Date.parse(e)},Get(e,t,s,n,i,r,a){return Date.UTC(e,t,s,n,i,r,a)},Now(){return Date.now()},TimezoneOffset(){return new Date(Date.now()).getTimezoneOffset()},GetYear(e){return W.get("local").get("year")(e)},GetUTCYear(e){return W.get("universal").get("year")(e)},GetMonth(e){return W.get("local").get("month")(e)},GetUTCMonth(e){return W.get("universal").get("month")(e)},GetDate(e){return W.get("local").get("date")(e)},GetUTCDate(e){return W.get("universal").get("date")(e)},GetDay(e){return W.get("local").get("day")(e)},GetUTCDay(e){return W.get("universal").get("day")(e)},GetHours(e){return W.get("local").get("hours")(e)},GetUTCHours(e){return W.get("universal").get("hours")(e)},GetMinutes(e){return W.get("local").get("minutes")(e)},GetUTCMinutes(e){return W.get("universal").get("minutes")(e)},GetSeconds(e){return W.get("local").get("seconds")(e)},GetUTCSeconds(e){return W.get("universal").get("seconds")(e)},GetMilliseconds(e){return W.get("local").get("milliseconds")(e)},GetUTCMilliseconds(e){return W.get("universal").get("milliseconds")(e)},ChangeYear(e,t){return X.get("local").get("year")(e,t)},ChangeUTCYear(e,t){return X.get("universal").get("year")(e,t)},ChangeMonth(e,t){return X.get("local").get("month")(e,t)},ChangeUTCMonth(e,t){return X.get("universal").get("month")(e,t)},ChangeDate(e,t){return X.get("local").get("date")(e,t)},ChangeUTCDate(e,t){return X.get("universal").get("date")(e,t)},ChangeDay(e,t){const s=U.Plugins.Date.Exps.GetYear(e),n=U.Plugins.Date.Exps.GetMonth(e),i=U.Plugins.Date.Exps.GetDate(e),r=U.Plugins.Date.Exps.GetHours(e),a=U.Plugins.Date.Exps.GetMinutes(e),o=U.Plugins.Date.Exps.GetSeconds(e),l=U.Plugins.Date.Exps.GetMilliseconds(e),h=U.Plugins.Date.Exps.GetDay(e),c=t-h;return new Date(s,n,i+c,r,a,o,l).getTime()},ChangeUTCDay(e,t){const s=U.Plugins.Date.Exps.GetUTCYear(e),n=U.Plugins.Date.Exps.GetUTCMonth(e),i=U.Plugins.Date.Exps.GetUTCDate(e),r=U.Plugins.Date.Exps.GetUTCHours(e),a=U.Plugins.Date.Exps.GetUTCMinutes(e),o=U.Plugins.Date.Exps.GetUTCSeconds(e),l=U.Plugins.Date.Exps.GetUTCMilliseconds(e),h=U.Plugins.Date.Exps.GetUTCDay(e),c=t-h;return U.Plugins.Date.Exps.Get(s,n,i+c,r,a,o,l)},ChangeHours(e,t){return X.get("local").get("hours")(e,t)},ChangeUTCHours(e,t){return X.get("universal").get("hours")(e,t)},ChangeMinutes(e,t){return X.get("local").get("minutes")(e,t)},ChangeUTCMinutes(e,t){return X.get("universal").get("minutes")(e,t)},ChangeSeconds(e,t){return X.get("local").get("seconds")(e,t)},ChangeUTCSeconds(e,t){return X.get("universal").get("seconds")(e,t)},ChangeMilliseconds(e,t){return X.get("local").get("milliseconds")(e,t)},ChangeUTCMilliseconds(e,t){return X.get("universal").get("milliseconds")(e,t)},Difference(e,t){return t-e},ToTimerHours(e){return Math.trunc(U.Plugins.Date.Exps.ToTotalHours(e))},ToTimerMinutes(e){return Math.trunc(U.Plugins.Date.Exps.ToTotalMinutes(e))%60},ToTimerSeconds(e){return Math.trunc(U.Plugins.Date.Exps.ToTotalSeconds(e))%60},ToTimerMilliseconds(e){return e%1e3},ToTotalHours(e){return e/36e5},ToTotalMinutes(e){return e/6e4},ToTotalSeconds(e){return e/1e3},FormatDateWithStyles(e,t,s,n,i){const r=$(e);if(r){let e={};return Y.call(this,s,"dateStyle",_,e),Y.call(this,n,"timeStyle",aa,e),Z.call(this,i,e),new V.DateTimeFormat(r,e).format(t)}},FormatDateWithComponents(e,t,s,n,i,r,a,o,l,h){const c=$(e);if(c){const u={};return Y.call(this,s,"weekday",ba,u),Y.call(this,n,"year",ca,u),Y.call(this,i,"month",da,u),Y.call(this,r,"day",ea,u),Y.call(this,a,"hour",fa,u),Y.call(this,o,"minute",ga,u),Y.call(this,l,"second",ha,u),Z.call(this,h,u),new V.DateTimeFormat(c,u).format(t)}}}}{const a=self.C3;a.Plugins.Clipboard=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Clipboard.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h="clipboard";g.Plugins.Clipboard.Instance=class extends g.SDKInstanceBase{constructor(e,t){super(e,h),this._copyResolve=null,this._requestPasteResolve=null,this._pastedText="",this._pastedBinaryArrayBuffer=null,this._pastedBinaryType="",this.AddDOMMessageHandlers([["copy-result",e=>this._OnCopyResult(e)],["request-paste-text-result",e=>this._OnRequestPasteTextResult(e)],["request-paste-binary-result",e=>this._OnRequestPasteBinaryResult(e)],["window-paste-text",e=>this._OnWindowPasteText(e)],["window-paste-binary",e=>this._OnWindowPasteBinary(e)]])}GetPastedText(){return this._pastedText}async _OnCopyResult(e){this._copyResolve&&(this._copyResolve(),this._copyResolve=null),e.isOk?await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnCopySuccess):await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnCopyError)}async _OnRequestPasteTextResult(e){this._requestPasteResolve&&(this._requestPasteResolve(),this._requestPasteResolve=null),e.isOk?(this._pastedText=e.text,await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnPasteText)):await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnPasteError)}async _OnRequestPasteBinaryResult(e){if(this._requestPasteResolve&&(this._requestPasteResolve(),this._requestPasteResolve=null),e.isOk){for(const[t,s]of e.binary)this._pastedBinaryType=t,this._pastedBinaryArrayBuffer=s,await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnPasteBinary);this._pastedBinaryType="",this._pastedBinaryArrayBuffer=null}else await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnPasteError)}async _OnWindowPasteText(e){this._pastedText=e.text,await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnPasteText)}async _OnWindowPasteBinary(e){this._pastedBinaryType=e.type,this._pastedBinaryArrayBuffer=e.arrayBuffer,await this.TriggerAsync(g.Plugins.Clipboard.Cnds.OnPasteBinary),this._pastedBinaryType="",this._pastedBinaryArrayBuffer=null}}}{const x=self.C3;x.Plugins.Clipboard.Cnds={OnCopySuccess(){return!0},OnCopyError(){return!0},OnPasteText(){return!0},OnPasteBinary(e,t){if(!x.equalsNoCase(this._pastedBinaryType,t))return!1;if(!e)return!1;const s=e.GetFirstPicked(this._inst);if(!s)return!1;const n=s.GetSdkInstance();return n.SetArrayBufferCopy(this._pastedBinaryArrayBuffer),!0},OnPasteError(){return!0}}}{const C=self.C3;C.Plugins.Clipboard.Acts={CopyText(e){return this._PostToDOMMaybeSync("copy-text",{text:e}),new Promise(e=>this._copyResolve=e)},CopyBinary(e,t){if(e){const s=e.GetFirstPicked(this._inst);if(s){const n=s.GetSdkInstance();return this._PostToDOMMaybeSync("copy-binary",{arrayBuffer:n.GetArrayBufferReadOnly(),type:t}),new Promise(e=>this._copyResolve=e)}}},RequestPasteText(){return this._PostToDOMMaybeSync("request-paste-text"),new Promise(e=>this._requestPasteResolve=e)},RequestPasteBinary(){return this._PostToDOMMaybeSync("request-paste-binary"),new Promise(e=>this._requestPasteResolve=e)}}}{const M=self.C3;M.Plugins.Clipboard.Exps={PastedText(){return this._pastedText}}}{const a=self.C3;a.Plugins.Keyboard=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let GetKeyboardSdkInstance2=function(){return r.GetSingleGlobalInstance().GetSdkInstance()};GetKeyboardSdkInstance=GetKeyboardSdkInstance2;const d=self.C3,e=self.C3X;d.Plugins.Keyboard.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IKeyboardObjectType}};let r=null;self.IKeyboardObjectType=class extends self.IObjectClass{constructor(e){super(e),(r=e).GetRuntime()._GetCommonScriptInterfaces().keyboard=this}isKeyDown(e){const t=GetKeyboardSdkInstance2();if("string"==typeof e)return t.IsKeyDown(e);if("number"==typeof e)return t.IsKeyCodeDown(e);throw new TypeError("expected string or number")}}}{const m=self.C3;m.Plugins.Keyboard.Instance=class extends m.SDKInstanceBase{constructor(e,t){super(e),this._keysDownByString=new Set,this._keysDownByWhich=new Set,this._triggerWhich=0,this._triggerString="",this._triggerTypedKey="";const s=this.GetRuntime().Dispatcher();this._disposables=new m.CompositeDisposable(m.Disposable.From(s,"keydown",e=>this._OnKeyDown(e.data)),m.Disposable.From(s,"keyup",e=>this._OnKeyUp(e.data)),m.Disposable.From(s,"window-blur",()=>this._OnWindowOrKeyboardBlur()),m.Disposable.From(s,"keyboard-blur",()=>this._OnWindowOrKeyboardBlur()))}Release(){super.Release()}_OnKeyDown(e){const t=e.which,s=e.code||t.toString(),n=e.key;this._keysDownByString.has(s)||(this._keysDownByString.add(s),this._keysDownByWhich.add(t),this._triggerString=s,this._triggerWhich=t,this._triggerTypedKey=n,this.Trigger(m.Plugins.Keyboard.Cnds.OnAnyKey),this.Trigger(m.Plugins.Keyboard.Cnds.OnKey),this.Trigger(m.Plugins.Keyboard.Cnds.OnLeftRightKeyPressed),this.Trigger(m.Plugins.Keyboard.Cnds.OnKeyCode))}_OnKeyUp(e){const t=e.which,s=e.code||t.toString(),n=e.key;this._keysDownByString.delete(s),this._keysDownByWhich.delete(t),this._triggerString=s,this._triggerWhich=t,this._triggerTypedKey=n,this.Trigger(m.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(m.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(m.Plugins.Keyboard.Cnds.OnLeftRightKeyReleased),this.Trigger(m.Plugins.Keyboard.Cnds.OnKeyCodeReleased)}_OnWindowOrKeyboardBlur(){for(const e of this._keysDownByWhich)this._keysDownByWhich.delete(e),this._triggerWhich=e,this.Trigger(m.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(m.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(m.Plugins.Keyboard.Cnds.OnKeyCodeReleased);this._keysDownByString.clear()}IsKeyDown(e){return this._keysDownByString.has(e)}IsKeyCodeDown(e){return this._keysDownByWhich.has(e)}SaveToJson(){return{tk:this._triggerWhich,tkk:this._triggerTypedKey}}LoadFromJson(e){this._triggerWhich=e.tk,e.hasOwnProperty("tkk")&&(this._triggerTypedKey=e.tkk)}GetDebuggerProperties(){const e="plugins.keyboard";return[{title:e+".name",properties:[{name:e+".debugger.last-key-code",value:this._triggerWhich},{name:e+".debugger.last-key-string",value:m.Plugins.Keyboard.Exps.StringFromKeyCode(this._triggerWhich)},{name:e+".debugger.last-typed-key",value:this._triggerTypedKey}]}]}}}{const G=self.C3,H=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"];G.Plugins.Keyboard.Cnds={IsKeyDown(e){return this._keysDownByWhich.has(e)},OnKey(e){return this._triggerWhich===e},OnAnyKey(){return!0},OnAnyKeyReleased(){return!0},OnKeyReleased(e){return this._triggerWhich===e},IsKeyCodeDown(e){return e=Math.floor(e),this._keysDownByWhich.has(e)},OnKeyCode(e){return this._triggerWhich===e},OnKeyCodeReleased(e){return this._triggerWhich===e},OnLeftRightKeyPressed(e){const t=H[e];return this._triggerString===t},OnLeftRightKeyReleased(e){const t=H[e];return this._triggerString===t},IsLeftRightKeyDown(e){const t=H[e];return this._keysDownByString.has(t)}}}{const U=self.C3;U.Plugins.Keyboard.Acts={}}{let StringFromCharCode2=function(e){switch(e=Math.floor(e)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"";case 38:return"";case 39:return"";case 40:return"";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}};StringFromCharCode=StringFromCharCode2;const V=self.C3;V.Plugins.Keyboard.Exps={LastKeyCode(){return this._triggerWhich},StringFromKeyCode(e){return StringFromCharCode2(e)},TypedKey(){return this._triggerTypedKey}}}{const a=self.C3;a.Plugins.Text=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Text.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}LoadTextures(e){}ReleaseTextures(){}}}{const h=self.C3,i=self.C3X,j=[0,0,0],k=0,l=1,m=2,n=3,o=4,p=5,q=6,r=7,s=8,t=9,u=10,v=11,w=12,x=13,y=14,z=15,A=["left","center","right"],B=["top","center","bottom"],C=["ltr","rtl"],D=["word","cjk","character"],E=new h.Rect,F=new h.Quad,G=new h.Color,H=h.New(h.Vector2),I=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["iconoffsety",null]]),J=(h.Plugins.Text.Instance=class extends h.SDKWorldInstanceBase{constructor(e,i){if(super(e),this._text="",this._enableBBcode=!0,this._faceName="Arial",this._ptSize=12,this._lineHeightOffset=0,this._isBold=!1,this._isItalic=!1,this._color=h.New(h.Color),this._horizontalAlign=0,this._verticalAlign=0,this._wrapMode="word",this._textDirection=0,this._resolutionMode="auto",this._fixedScaleFactor=1,this._iconObjectClass=null,this._htmlString="",this._isHtmlStringUpToDate=!1,this._readAloud=!1,this._screenReaderText=null,this._typewriterStartTime=-1,this._typewriterEndTime=-1,this._typewriterLength=0,this._rendererText=h.New(h.Gfx.RendererText,this._runtime.GetRenderer(),{timeout:5}),this._rendererText.ontextureupdate=()=>this._runtime.UpdateRender(),this._animationframeimagechange_handler=()=>this._OnIconObjectClassImageChanged(),this._pendingUpdateIconSet=!1,i){this._text=i[k],this._enableBBcode=!!i[l],this._faceName=i[m],this._ptSize=i[n],this._lineHeightOffset=i[o],this._isBold=!!i[p],this._isItalic=!!i[q],this._horizontalAlign=i[s],this._verticalAlign=i[t],this._wrapMode=D[i[u]],this._textDirection=i[v],this._SetIconObjectClass(this._runtime.GetObjectClassBySID(i[w]));const a=i[r];this._color.setRgb(a[0],a[1],a[2]),this.GetWorldInfo().SetVisible(i[x]),this._readAloud=!!i[z]}this._UpdateTextSettings(),this._UpdateScreenReaderText()}Release(){this._SetIconObjectClass(null),this._CancelTypewriter(),this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null),this._rendererText.Release(),this._rendererText=null,super.Release()}_UpdateTextSettings(){const e=this._rendererText;e.SetText(this._text),e.SetBBCodeEnabled(this._enableBBcode),this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass?this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass)):this._rendererText.SetIconSet(null),e.SetIconSmoothing("nearest"!==this._runtime.GetSampling()),e.SetFontName(this._faceName),e.SetLineHeight(this._lineHeightOffset),e.SetBold(this._isBold),e.SetItalic(this._isItalic),e.SetColor(this._color),e.SetHorizontalAlignment(A[this._horizontalAlign]),e.SetVerticalAlignment(B[this._verticalAlign]),e.SetWordWrapMode(this._wrapMode),e.SetTextDirection(C[this._textDirection])}_UpdateTextSize(){let e=this.GetWorldInfo(),t=(this._rendererText.SetFontSize(this._ptSize),this._rendererText.SetFontSizeScale(e.GetSceneGraphScale()),e.GetLayer()),s;"auto"===this._resolutionMode?s=t.GetResolutionScaleFactorToZ(e.GetTotalZElevation()):"fixed"===this._resolutionMode&&(s=this._fixedScaleFactor),e.HasMesh()&&s!==this._rendererText.GetZoom()&&e.SetMeshChanged(!0),this._rendererText.SetSize(e.GetWidth(),e.GetHeight(),s)}_SetIconObjectClass(e){e&&(e.IsFamily()||e.GetPlugin().constructor!==h.Plugins.Sprite)||e!==this._iconObjectClass&&(this._iconObjectClass&&this._iconObjectClass.Dispatcher().removeEventListener("animationframeimagechange",this._animationframeimagechange_handler),this._iconObjectClass=e,this._iconObjectClass&&this._iconObjectClass.Dispatcher().addEventListener("animationframeimagechange",this._animationframeimagechange_handler),this._UpdateTextSettings(),this._isHtmlStringUpToDate=!1,this._runtime.UpdateRender())}_OnIconObjectClassImageChanged(){this._runtime.DeleteTextIconSet(this._iconObjectClass),this._runtime.UpdateRender(),this._pendingUpdateIconSet=!0}_UpdateScreenReaderText(){if(this._readAloud){let e=this._text;this._enableBBcode&&(e=h.BBString.StripAnyTags(e)),this._screenReaderText?this._screenReaderText.SetText(e):this._screenReaderText=h.New(h.ScreenReaderText,this._runtime,e)}else this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null)}Draw(e){const t=this.GetWorldInfo(),s=(this._UpdateTextSize(),this._pendingUpdateIconSet&&(this._pendingUpdateIconSet=!1,this._rendererText.IsBBCodeEnabled())&&this._iconObjectClass&&this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass)),this._rendererText.GetTexture());if(s){const n=t.GetLayer();if(0===t.GetAngle()&&0===n.GetAngle()&&0===t.GetTotalZElevation()&&!t.HasMesh()&&n.RendersIn2DMode()){const i=t.GetBoundingQuad(),[r,a]=n.LayerToDrawSurface(i.getTlx(),i.getTly()),[o,l]=n.LayerToDrawSurface(i.getBrx(),i.getBry()),h=r-Math.round(r),c=a-Math.round(a),[u,d]=(E.set(r,a,o,l),E.offset(-h,-c),F.setFromRect(E),e.GetRenderTargetSize(e.GetRenderTarget()));this._runtime.GetCanvasManager().SetDeviceTransform(e,u,d),e.SetTexture(s),e.Quad3(F,this._rendererText.GetTexRect()),n._SetTransform(e)}else e.SetTexture(s),t.HasMesh()?this._DrawMesh(t,e):this._DrawStandard(t,e)}}_DrawStandard(e,t){let s=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(s=this._PixelRoundQuad(s)),t.Quad3(s,this._rendererText.GetTexRect())}_DrawMesh(t,e){const s=t.GetTransformedMesh();if(t.IsMeshChanged()){t.CalculateBbox(E,F,!1);let e=F;this._runtime.IsPixelRoundingEnabled()&&(e=this._PixelRoundQuad(e)),s.CalculateTransformedMesh(t.GetSourceMesh(),e,this._rendererText.GetTexRect()),t.SetMeshChanged(!1)}s.Draw(e)}_PixelRoundQuad(e){const t=e.getTlx()-Math.round(e.getTlx()),s=e.getTly()-Math.round(e.getTly());return 0==t&&0==s?e:(F.copy(e),F.offset(-t,-s),F)}GetCurrentSurfaceSize(){const e=this._rendererText.GetTexture();return e?[e.GetWidth(),e.GetHeight()]:[100,100]}GetCurrentTexRect(){return this._rendererText.GetTexRect()}IsCurrentTexRotated(){return!1}SaveToJson(){const e={t:this._text,c:this._color.toJSON(),fn:this._faceName,ps:this._ptSize};return this._enableBBcode&&(e.bbc=this._enableBBcode),0!==this._horizontalAlign&&(e.ha=this._horizontalAlign),0!==this._verticalAlign&&(e.va=this._verticalAlign),"word"!==this._wrapMode&&(e.wr=this._wrapMode),0!==this._lineHeightOffset&&(e.lho=this._lineHeightOffset),this._isBold&&(e.b=this._isBold),this._isItalic&&(e.i=this._isItalic),-1!==this._typewriterEndTime&&(e.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength}),this._iconObjectClass&&(e.ioc=this._iconObjectClass.GetSID()),"fixed"===this._resolutionMode&&(e.fs=this._fixedScaleFactor),e}LoadFromJson(e){if(this._CancelTypewriter(),this._text=e.t,this._color.setFromJSON(e.c),this._faceName=e.fn,this._ptSize=e.ps,this._enableBBcode=!!e.hasOwnProperty("bbc")&&e.bbc,this._horizontalAlign=e.hasOwnProperty("ha")?e.ha:0,this._verticalAlign=e.hasOwnProperty("va")?e.va:0,e.hasOwnProperty("wr")){const t=e.wr;this._wrapMode="boolean"==typeof t?t?"word":"character":t}else this._wrapMode="word";if(this._lineHeightOffset=e.hasOwnProperty("lho")?e.lho:0,this._isBold=!!e.hasOwnProperty("b")&&e.b,this._isItalic=!!e.hasOwnProperty("i")&&e.i,e.hasOwnProperty("tw")){const s=e.tw;this._typewriterStartTime=s.st,this._typewriterEndTime=s.en,this._typewriterLength=s.l}if(e.hasOwnProperty("ioc")){const n=this.GetRuntime().GetObjectClassBySID(e.ioc);n&&this._SetIconObjectClass(n)}else this._SetIconObjectClass(null);e.hasOwnProperty("fs")?(this._resolutionMode="fixed",this._fixedScaleFactor=e.fs):this._resolutionMode="auto",this._UpdateTextSettings(),this._UpdateScreenReaderText(),this._isHtmlStringUpToDate=!1,-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(e){switch(e){case k:return this.GetText();case l:return this._enableBBcode;case m:return this._GetFontFace();case n:return this._GetFontSize();case o:return this._GetLineHeight();case p:return this._IsBold();case q:return this._IsItalic();case r:return j[0]=this._color.getR(),j[1]=this._color.getG(),j[2]=this._color.getB(),j;case s:return this._GetHAlign();case t:return this._GetVAlign();case u:return this._GetWrapMode();case z:return this._IsReadAloud()}}SetPropertyValueByIndex(e,i){switch(e){case k:this._SetText(i);break;case l:this._enableBBcode!==!!i&&(this._enableBBcode=!!i,this._UpdateTextSettings());break;case m:this._SetFontFace(i);break;case n:this._SetFontSize(i);break;case o:this._SetLineHeight(i);break;case p:this._SetBold(i);break;case q:this._SetItalic(i);break;case r:const a=this._color,h=i;a.getR()===h[0]&&a.getG()===h[1]&&a.getB()===h[2]||(this._color.setRgb(h[0],h[1],h[2]),this._UpdateTextSettings());break;case s:this._SetHAlign(i);break;case t:this._SetVAlign(i);break;case u:this._SetWrapMode(i)}}SetPropertyColorOffsetValueByIndex(e,t,s,n){0===t&&0===s&&0===n||e===r&&(this._color.addRgb(t,s,n),this._UpdateTextSettings())}_SetText(e){this._text!==e&&(this._text=e,this._rendererText.SetText(e),this._UpdateScreenReaderText(),this._isHtmlStringUpToDate=!1,this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(e,t){this._UpdateTextSize(),this._SetText(e),this._typewriterStartTime=this._runtime.GetWallTime(),this._typewriterEndTime=this._typewriterStartTime+t/this.GetInstance().GetActiveTimeScale(),this._typewriterLength=this._rendererText.GetLengthInGraphemes(),this._rendererText.SetDrawMaxCharacterCount(0),this._StartTicking()}_CancelTypewriter(){this._typewriterStartTime=-1,this._typewriterEndTime=-1,this._typewriterLength=0,this._rendererText.SetDrawMaxCharacterCount(-1),this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(h.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetFontFace(e){this._faceName!==e&&(this._faceName=e,this._rendererText.SetFontName(e),this._runtime.UpdateRender())}_GetFontFace(){return this._faceName}_SetBold(e){this._isBold!==(e=!!e)&&(this._isBold=e,this._rendererText.SetBold(e),this._runtime.UpdateRender())}_IsBold(){return this._isBold}_SetItalic(e){this._isItalic!==(e=!!e)&&(this._isItalic=e,this._rendererText.SetItalic(e),this._runtime.UpdateRender())}_IsItalic(){return this._isItalic}_SetFontSize(e){this._ptSize!==e&&(this._ptSize=e,this._runtime.UpdateRender())}_GetFontSize(){return this._ptSize}_SetFontColor(e){this._color.equalsIgnoringAlpha(e)||(this._color.copyRgb(e),this._rendererText.SetColor(this._color),this._runtime.UpdateRender())}_GetFontColor(){return this._color}_SetLineHeight(e){this._lineHeightOffset!==e&&(this._lineHeightOffset=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeightOffset}_SetHAlign(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapModeByIndex(e){this._SetWrapMode(D[e])}_SetWrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetWrapMode(){return this._wrapMode}_SetTextDirection(e){this._textDirection!==e&&(this._textDirection=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetTextDirection(){return this._textDirection}_SetReadAloud(e){this._readAloud=!!e,this._UpdateScreenReaderText()}_IsReadAloud(){return this._readAloud}_SetResolutionMode(e){this._resolutionMode!==e&&(this._resolutionMode=e,this._runtime.UpdateRender())}_GetResolutionMode(){return this._resolutionMode}_SetFixedScaleFactor(e){this._fixedScaleFactor!==e&&(this._fixedScaleFactor=e,"fixed"===this._resolutionMode)&&this._runtime.UpdateRender()}_GetFixedScaleFactor(){return this._fixedScaleFactor}_GetTextWidth(){return this._UpdateTextSize(),this._rendererText.GetTextWidth()}_GetTextHeight(){return this._UpdateTextSize(),this._rendererText.GetTextHeight()}_GetTagAtPosition(e,t){this._UpdateTextSize();const s=this.GetWorldInfo(),n=(H.set(e-s.GetX(),t-s.GetY()),H.rotate(-s.GetAngle()),H.offset(s.GetWidth()*s.GetOriginX(),s.GetHeight()*s.GetOriginY()),H.divide(s.GetWidth(),s.GetHeight()),H.scale(this._rendererText.GetWidth(),this._rendererText.GetHeight()),this._rendererText.HitTestFragment(H.getX(),H.getY()));if(n){const i=n.GetStyleTag("tag");if(i)return i.param}return""}_HasTagAtPosition(e,t,s){const n=this._GetTagAtPosition(t,s);return n&&h.equalsNoCase(e,n)}_GetTagPosition(e,t){this._UpdateTextSize(),t=Math.floor(t);const s=this._rendererText.FindFragmentWithTag(e,t);if(!s)return null;const n=this.GetWorldInfo(),i=this._rendererText.GetDrawScale(),r=s.GetPosX(),a=s.GetPosY()-(s.GetHeight()-s.GetFontBoundingBoxDescent())*i,o=s.GetWidth()*i/this._rendererText.GetWidth()*n.GetWidth(),l=s.GetHeight()*i/this._rendererText.GetHeight()*n.GetHeight();return H.set(r,a),H.divide(this._rendererText.GetWidth(),this._rendererText.GetHeight()),H.scale(n.GetWidth(),n.GetHeight()),H.offset(-n.GetWidth()*n.GetOriginX(),-n.GetHeight()*n.GetOriginY()),H.rotate(n.GetAngle()),H.offset(n.GetX(),n.GetY()),{x:H.getX(),y:H.getY(),width:o,height:l}}_GetTagCount(e){return this._UpdateTextSize(),this._rendererText.CountFragmentsWithTag(e)}_GetHTMLCloseTag(e){let t=I.get(e);return null===t?"":`</${t||"span"||"span"}>`}_GetHTMLOpenTag(e,t){let s=I.get(e);if(null===s)return"";switch(s=s||"span",e){case"color":return`<${s} style="color: ${t}">`;case"font":return`<${s} style="font-family: '${t}'">`;case"opacity":return`<${s} style="opacity: ${t}%">`;case"size":return`<${s} style="font-size: ${t}pt">`;case"background":return`<${s} style="background-color: ${t}">`;case"hide":return`<${s} style="visibility: hidden">`;case"class":return`<${s} class="${t}">`;case"tag":return`<${s} data-tag="${t}">`;default:return`<${s}>`}}async _UpdateHTMLString(){if(!this._isHtmlStringUpToDate){let e=new h.BBString(this._text,{noEscape:!0}).toFragmentList(),t=new Map,i='<span class="c3-text"',s=[],r=(s.push(`font-family: '${this._GetFontFace()}';`),this._IsBold()&&s.push("font-weight: bold;"),this._IsItalic()&&s.push("font-style: italic;"),"character"===this._GetWrapMode()&&s.push("word-break: break-all;"),i+=` style="${s.join(" ")}">`,this._iconObjectClass?this.GetRuntime().GetTextIconSet(this._iconObjectClass):null);if(this._iconObjectClass){const o=h.New(h.PromiseThrottle),l=[],c=new Map;for(const d of e)if(d.IsIcon()){const _=d.GetTextIcon(r);if(_){const p=_.GetSource(),m=p.GetImageInfo().GetImageAsset();c.has(m)||(c.set(m,null),l.push(o.Add(async()=>{const e=await m.LoadToDrawable();c.set(m,e)})))}}await Promise.all(l);const u=[];for(const g of e)if(g.IsIcon()){const f=g.GetTextIcon(r);if(f){const S=f.GetSource(),y=S.GetImageInfo().GetImageAsset();u.push(o.Add(async()=>{const e=await S.GetImageInfo().ExtractImageToBlobURL(c.get(y));t.set(f,e)}))}}await Promise.all(u);for(const C of c.values())C instanceof ImageBitmap&&C.close&&C.close()}const a=new Map;for(const G of e){let n=G.GetStyleMap(),e=[...a.keys()];e.reverse();for(const T of e)n.has(T)&&n.get(T)===a.get(T)||(a.delete(T),i+=this._GetHTMLCloseTag(T));for(const[I,b]of n)a.has(I)||(a.set(I,b),i+=this._GetHTMLOpenTag(I,b));if(G.IsText()&&(i+=h.ReplaceAll(h.EscapeHTML(G.GetCharacterArray().join("")),"\n","<br>")),G.IsIcon()&&r){const A=G.GetTextIcon(r);if(A){const P=t.get(A);if(P){let e=[],t="0.2em",s=n.get("iconoffsety");if(s){let e=s.trim();t=e.endsWith("%")?parseFloat(e)/100+"em":e+"px"}e.push("top: "+t),"nearest"===this._runtime.GetSampling()&&e.push("image-rendering: pixelated"),i+=`<img class="c3-text-icon" data-icon="${G.GetIconParameter()}" width="${A.GetWidth()}" height="${A.GetHeight()}" style="${e.join(";")}" src="${P}">`}}}}const n=[...a.keys()];n.reverse();for(const E of n)i+=this._GetHTMLCloseTag(E);i+="</span>",this._htmlString=i,this._isHtmlStringUpToDate=!0}return this._htmlString}Tick(){const t=this._runtime.GetWallTime();if(t>=this._typewriterEndTime)this._CancelTypewriter(),this.Trigger(h.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender();else{let e=h.relerp(this._typewriterStartTime,this._typewriterEndTime,t,0,this._typewriterLength);(e=Math.floor(e))!==this._rendererText.GetDrawMaxCharacterCount()&&(this._rendererText.SetDrawMaxCharacterCount(e),this._runtime.UpdateRender())}}GetDebuggerProperties(){const e="plugins.text";return[{title:e+".name",properties:[{name:e+".properties.text.name",value:this.GetText(),onedit:e=>this._SetText(e)},{name:e+".properties.font.name",value:this._GetFontFace(),onedit:e=>this._SetFontFace(e)},{name:e+".properties.size.name",value:this._GetFontSize(),onedit:e=>this._SetFontSize(e)},{name:e+".properties.line-height.name",value:this._GetLineHeight(),onedit:e=>this._SetLineHeight(e)},{name:e+".properties.bold.name",value:this._IsBold(),onedit:e=>this._SetBold(e)},{name:e+".properties.italic.name",value:this._IsItalic(),onedit:e=>this._SetItalic(e)}]}]}GetScriptInterfaceClass(){return self.ITextInstance}},new WeakMap),K=new Map([["left",0],["center",1],["right",2]]),L=new Map([["top",0],["center",1],["bottom",2]]),M=["ltr","rtl"],N=new Set(["auto","fixed"]);self.ITextInstance=class extends self.IWorldInstance{constructor(){super(),J.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return J.get(this).GetText()}set text(e){i.RequireString(e);const t=J.get(this);t._CancelTypewriter(),t._SetText(e)}typewriterText(e,t){i.RequireString(e),i.RequireFiniteNumber(t);const s=J.get(this);s._CancelTypewriter(),s._StartTypewriter(e,t)}typewriterFinish(){J.get(this)._FinishTypewriter()}set fontFace(e){i.RequireString(e),J.get(this)._SetFontFace(e)}get fontFace(){return J.get(this)._GetFontFace()}set isBold(e){J.get(this)._SetBold(e)}get isBold(){return J.get(this)._IsBold()}set isItalic(e){J.get(this)._SetItalic(e)}get isItalic(){return J.get(this)._IsItalic()}set sizePt(e){i.RequireFiniteNumber(e),J.get(this)._SetFontSize(e)}get sizePt(){return J.get(this)._GetFontSize()}set fontColor(e){if(i.RequireArray(e),e.length<3)throw new Error("expected 3 elements");G.setRgb(e[0],e[1],e[2]),J.get(this)._SetFontColor(G)}get fontColor(){const e=J.get(this)._GetFontColor();return[e.getR(),e.getG(),e.getB()]}set lineHeight(e){i.RequireFiniteNumber(e),J.get(this)._SetLineHeight(e)}get lineHeight(){return J.get(this)._GetLineHeight()}set horizontalAlign(e){i.RequireString(e);const t=K.get(e);if(void 0===t)throw new Error("invalid mode");J.get(this)._SetHAlign(t)}get horizontalAlign(){return A[J.get(this)._GetHAlign()]}set verticalAlign(e){i.RequireString(e);const t=L.get(e);if(void 0===t)throw new Error("invalid mode");J.get(this)._SetVAlign(t)}get verticalAlign(){return B[J.get(this)._GetVAlign()]}set wordWrapMode(e){if(!D.includes(e))throw new Error("invalid mode");J.get(this)._SetWrapMode(e)}get wordWrapMode(){return J.get(this)._GetWrapMode()}set textDirection(e){i.RequireString(e);const t=M.indexOf(e);if(-1===t)throw new Error("invalid text direction");J.get(this)._SetTextDirection(t)}get textDirection(){return M[J.get(this)._GetTextDirection()]}set readAloud(e){J.get(this)._SetReadAloud(!!e)}get readAloud(){return J.get(this)._IsReadAloud()}setFixedResolutionMode(e){i.RequireFiniteNumber(e);const t=J.get(this);t._SetResolutionMode("fixed"),t._SetFixedScaleFactor(e)}setAutoResolutionMode(){J.get(this)._SetResolutionMode("auto")}get textWidth(){return J.get(this)._GetTextWidth()}get textHeight(){return J.get(this)._GetTextHeight()}getTextSize(){const e=J.get(this);return[e._GetTextWidth(),e._GetTextHeight()]}hasTagAtPosition(e,t,s){return i.RequireString(e),i.RequireFiniteNumber(t),i.RequireFiniteNumber(s),J.get(this)._HasTagAtPosition(e,t,s)}getTagAtPosition(e,t){return i.RequireFiniteNumber(e),i.RequireFiniteNumber(t),J.get(this)._GetTagAtPosition(e,t)}getTagPositionAndSize(e,t=0){return i.RequireString(e),i.RequireFiniteNumber(t),J.get(this)._GetTagPosition(e,t)}getTagCount(e){return i.RequireString(e),J.get(this)._GetTagCount(e)}changeIconSet(e){const t=J.get(this),s=t.GetRuntime()._UnwrapIObjectClass(e);t._SetIconObjectClass(s)}getAsHtmlString(){return J.get(this)._UpdateHTMLString()}}}{const Tb=self.C3;Tb.Plugins.Text.Cnds={CompareText(e,t){return t?this._text===e:Tb.equalsNoCase(this._text,e)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished(){return!0},HasTagAtPosition(e,t,s){return this._HasTagAtPosition(e,t,s)}}}{const Zb=self.C3,$b=Zb.New(Zb.Color);Zb.Plugins.Text.Acts={SetText(e){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),this._SetText(e.toString())},AppendText(e){this._CancelTypewriter(),(e=(e="number"==typeof e&&e<1e9?Math.round(1e10*e)/1e10:e).toString())&&this._SetText(this._text+e)},TypewriterText(e,t){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),this._StartTypewriter(e.toString(),t)},SetFontFace(e,t){let s=!1,n=!1;switch(t){case 1:s=!0;break;case 2:n=!0;break;case 3:s=!0,n=!0}e===this._faceName&&s===this._isBold&&n===this._isItalic||(this._SetFontFace(e),this._SetBold(s),this._SetItalic(n))},SetFontSize(e){this._SetFontSize(e)},SetFontColor(e){$b.setFromRgbValue(e),$b.clamp(),this._SetFontColor($b)},SetWebFont(e,t){console.warn("[Text] 'Set web font' action is deprecated and no longer has any effect")},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},TypewriterFinish(){this._FinishTypewriter()},SetLineHeight(e){this._SetLineHeight(e)},SetHAlign(e){this._SetHAlign(e)},SetVAlign(e){this._SetVAlign(e)},SetWrapping(e){this._SetWrapModeByIndex(e)},SetTextDirection(e){this._SetTextDirection(e)},ChangeIconSet(e){this._SetIconObjectClass(e)},UpdateHTML(){return this._UpdateHTMLString()},SetReadAloud(e){this._SetReadAloud(e)},SetResolutionMode(e,t){this._SetResolutionMode(["auto","fixed"][e]),this._SetFixedScaleFactor(t)}}}{const v1=self.C3;v1.Plugins.Text.Exps={Text(){return this._text},PlainText(){return this._enableBBcode?v1.BBString.StripAnyTags(this._text):this._text},FaceName(){return this._faceName},FaceSize(){return this._ptSize},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()},LineHeight(){return this._lineHeightOffset},TagAtPosition(e,t){return this._GetTagAtPosition(e,t)},TagCount(e){return this._GetTagCount(e)},TagX(e,t){const s=this._GetTagPosition(e,t);return s?s.x:0},TagY(e,t){const s=this._GetTagPosition(e,t);return s?s.y:0},TagWidth(e,t){const s=this._GetTagPosition(e,t);return s?s.width:0},TagHeight(e,t){const s=this._GetTagPosition(e,t);return s?s.height:0},AsHTML(){return this._htmlString}}}{const a=self.C3;a.Plugins.Json=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Json.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=self.C3X,i=self.IInstance,j=(g.Plugins.Json.Instance=class extends g.SDKInstanceBase{constructor(e,t){super(e),this._valueCache=[null,null],this._locationCache=[null,null],this._data={},this._path=[],this._currentKey="",this._currentValue=0}Release(){super.Release()}_InvalidateValueCache(){this._valueCache[0]=null,this._valueCache[1]=null}_HasValueCache(s,e){const n=this._valueCache[0];if(null!==s&&null!==n){if(n===s||g.arraysEqual(n,s))return!0;if(e&&0<n.length){for(let e=0,t=Math.min(s.length,n.length);e<t;++e)if(s[e]!==n[e])return!1;return!0}}return!1}_GetValueCache(){return this._valueCache[1]}_UpdateValueCache(e,t){this._valueCache[0]=e,this._valueCache[1]=t}_InvalidateLocationCache(){this._locationCache[0]=null,this._locationCache[1]=null}_HasLocationCache(e){return this._locationCache[0]===e}_GetLocationCache(){return this._locationCache[1]}_UpdateLocationCache(e,t){this._locationCache[0]=e,this._locationCache[1]=t}_SetData(e){this._data=e,this._InvalidateValueCache(),this._SetPath("")}_GetData(){return this._data}_SetPath(e){this._path=this._ParsePathUnsafe(e),this._InvalidateLocationCache()}_ParsePath(e){return g.cloneArray(this._ParsePathUnsafe(e))}_ParsePathUnsafe(e){let t=[],s=!1,n;if(this._HasLocationCache(e))return this._GetLocationCache();"."===e[0]?(n=g.cloneArray(this._path),e=e.slice(1)):n=[];for(const i of e)s?(t.push(i),s=!1):"\\"===i?s=!0:"."===i?(n.push(t.join("")),g.clearArray(t)):t.push(i);return 0!==t.length&&n.push(t.join("")),this._UpdateLocationCache(e,n),n}_GetValueAtFullPath(e,t){if(this._HasValueCache(e,!1))return this._GetValueCache();let s=this._data;for(const n of e)if(Array.isArray(s)){const i=parseInt(n,10);if(i<0||i>=s.length||!isFinite(i)){s=null;break}s=s[i]}else{if("object"!=typeof s||null===s){s=null;break}if(s.hasOwnProperty(n))s=s[n];else{if(!t){s=null;break}{const r={};s[n]=r,s=r}}}return this._UpdateValueCache(e,s),s}_GetValue(e){const t=this._ParsePath(e);if(!t.length)return this._data;const s=t.pop(),n=this._GetValueAtFullPath(t,!1);if(Array.isArray(n)){const i=parseInt(s,10);return 0<=i&&i<n.length?n[i]:null}return"object"==typeof n&&null!==n&&n.hasOwnProperty(s)?n[s]:null}_JSONTypeOf(e){return null===e?"null":Array.isArray(e)?"array":typeof e}_GetTypeOf(e){const t=this._GetValue(e);return this._JSONTypeOf(t)}_ToSafeValue(e){const t=typeof e;return"number"==t||"string"==t?e:"boolean"==t&&e?1:0}_GetSafeValue(e){return this._ToSafeValue(this._GetValue(e))}_HasKey(e){const t=this._ParsePath(e);if(!t.length)return!1;const s=t.pop(),n=this._GetValueAtFullPath(t,!1);if(Array.isArray(n)){const i=parseInt(s,10);return 0<=i&&i<n.length}return"object"==typeof n&&null!==n&&n.hasOwnProperty(s)}_SetValue(e,t){const s=this._ParsePath(e);if(!s.length)return!1;this._HasValueCache(s,!0)&&this._InvalidateValueCache();const n=s.pop(),i=this._GetValueAtFullPath(s,!0);if(Array.isArray(i)){const r=parseInt(n,10);return!(!isFinite(r)||r<0||r>=i.length||(i[r]=t,0))}return"object"==typeof i&&null!==i&&(i[n]=t,!0)}_DeleteKey(e){const t=this._ParsePath(e);if(!t.length)return!1;this._HasValueCache(t,!0)&&this._InvalidateValueCache();const s=t.pop(),n=this._GetValueAtFullPath(t,!1);return!Array.isArray(n)&&"object"==typeof n&&null!==n&&(delete n[s],!0)}SaveToJson(){return{path:this._path,data:this._data}}LoadFromJson(e){this._InvalidateValueCache(),this._InvalidateLocationCache(),this._path=e.path,this._data=e.data}_SanitizeValue(e){const t=typeof e;return"number"==t?isFinite(e)?e:0:"object"==typeof e?JSON.stringify(e):e+""}GetDebuggerProperties(){let e="plugins.json.debugger",t;try{t=this._SanitizeValue(this._data)}catch(e){t='"invalid"'}return[{title:e+".title",properties:[{name:e+".data",value:t,onedit:e=>{try{const t=JSON.parse(e);this._SetData(t)}catch(e){}}},{name:e+".path",value:this._path.map(e=>e.replace(/\./g,"\\.")).join(".")}]}]}GetScriptInterfaceClass(){return self.IJSONInstance}},new WeakMap);self.IJSONInstance=class extends i{constructor(){super(),j.set(this,i._GetInitInst().GetSdkInstance())}getJsonDataCopy(){const e=j.get(this)._GetData();return JSON.parse(JSON.stringify(e))}setJsonDataCopy(e){try{const t=JSON.parse(JSON.stringify(e));j.get(this)._SetData(t)}catch(e){throw console.error("[JSON plugin] setJsonData: object is not valid JSON: ",e),e}}setJsonString(e){h.RequireString(e);try{const t=JSON.parse(e);j.get(this)._SetData(t)}catch(e){throw console.error("[JSON plugin] setJsonString: string is not valid JSON: ",e),e}}toCompactString(){return JSON.stringify(j.get(this)._GetData())}toBeautifiedString(){return JSON.stringify(j.get(this)._GetData(),null,4)}}}{const Ba=self.C3,Ca=["null","boolean","number","string","object","array"];Ba.Plugins.Json.Cnds={HasKey(e){return this._HasKey(e)},CompareType(e,t){return this._GetTypeOf(e)===Ca[t]},CompareValue(e,t,s){return Ba.compare(this._GetSafeValue(e),t,s)},IsBooleanSet(e){return!0===this._GetValue(e)},ForEach(e){const t=this._GetValue(e);if("object"==typeof t&&null!==t){const s=this._runtime,n=s.GetEventSheetManager(),i=s.GetCurrentEvent(),r=i.GetSolModifiers(),a=s.GetEventStack(),o=a.GetCurrentStackFrame(),l=a.Push(i),h=this._path,c=this._currentKey,u=this._currentValue,d=this._ParsePathUnsafe(e);s.SetDebuggingEnabled(!1);for(const[_,p]of Object.entries(t)){this._path=Ba.cloneArray(d),this._path.push(_),this._currentKey=_,this._currentValue=p,n.PushCopySol(r);const m=this.GetObjectClass().GetCurrentSol();m.PickOne(this.GetInstance()),i.Retrigger(o,l),n.PopSol(r)}s.SetDebuggingEnabled(!0),this._path=h,this._InvalidateLocationCache(),this._currentKey=c,this._currentValue=u,a.Pop()}return!1},OnParseError(){return!0}}}{const $a=self.C3;$a.Plugins.Json.Acts={Parse(e){try{this._SetData(JSON.parse(e))}catch(e){console.warn("[JSON plugin] Failed to parse JSON data: ",e),this._SetData({}),this.Trigger($a.Plugins.Json.Cnds.OnParseError)}},SetPath(e){this._SetPath(e)},SetValue(e,t){this._SetValue(e,t)},SetArray(e,t){let s=this._GetValue(e);Array.isArray(s)?$a.resizeArray(s,t,0):(s=[],$a.extendArray(s,t,0),this._SetValue(e,s))},SetObject(e){this._SetValue(e,{})},SetJSON(e,t){let s=null;try{s=JSON.parse(t)}catch(e){console.warn("[JSON plugin] Failed to parse JSON data: ",e),this.Trigger($a.Plugins.Json.Cnds.OnParseError)}this._SetValue(e,s)},SetNull(e){this._SetValue(e,null)},SetBoolean(e,t){this._SetValue(e,0!==t)},ToggleBoolean(e){const t=this._GetValue(e);"boolean"==typeof t&&this._SetValue(e,!t)},AddTo(e,t){const s=this._GetValue(e);"number"==typeof s&&this._SetValue(e,s+t)},SubtractFrom(e,t){const s=this._GetValue(e);"number"==typeof s&&this._SetValue(e,s-t)},DeleteKey(e){this._DeleteKey(e)},PushValue(e,t,s){const n=this._GetValue(t);Array.isArray(n)&&(0===e?n.push(s):n.unshift(s),this._InvalidateValueCache())},PopValue(e,t){const s=this._GetValue(t);Array.isArray(s)&&(0===e?s.pop():s.shift(),this._InvalidateValueCache())},InsertValue(e,t,s){const n=this._GetValue(t);Array.isArray(n)&&(n.splice(s,0,e),this._InvalidateValueCache())},RemoveValues(e,t,s){const n=this._GetValue(t);Array.isArray(n)&&0<e&&(n.splice(s,e),this._InvalidateValueCache())}}}{const N0=self.C3;N0.Plugins.Json.Exps={ToCompactString(){try{return JSON.stringify(this._data)}catch(e){return""}},ToBeautifiedString(){try{return JSON.stringify(this._data,null,4)}catch(e){return""}},Get(e){return this._GetSafeValue(e)},GetAsCompactString(e){const t=this._GetValue(e);return JSON.stringify(t)},GetAsBeautifiedString(e){const t=this._GetValue(e);return JSON.stringify(t,null,4)},Front(e){const t=this._GetValue(e);if(Array.isArray(t)){const s=t[0];return this._ToSafeValue(s)}return-1},Back(e){const t=this._GetValue(e);if(Array.isArray(t)){const s=t.at(-1);return this._ToSafeValue(s)}return-1},Type(e){return this._GetTypeOf(e)},ArraySize(e){const t=this._GetValue(e);return Array.isArray(t)?t.length:-1},Path(){return this._path.map(e=>e.replace(/\./g,"\\.")).join(".")},CurrentKey(){return this._currentKey},CurrentValue(){return this._ToSafeValue(this._currentValue)},CurrentType(){return this._JSONTypeOf(this._currentValue)}}}{const a=self.C3;a.Plugins.Sprite=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3,e=self.C3X,f=[],g=(d.Plugins.Sprite.Type=class extends d.SDKTypeBase{constructor(e){super(e),this._animations=e.GetAnimations()}Release(){d.clearArray(this._animations),super.Release()}OnCreate(){for(const e of this._animations)e.LoadAllAssets(this._runtime)}LoadTextures(t){const s={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map(e=>e.LoadAllTextures(t,s)))}ReleaseTextures(){for(const e of this._animations)e.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(const e of this._objectClass.instancesIncludingPendingCreate())e.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(e){d.Plugins.Sprite.FinishCollisionCondition(this,e)}BeforeRunAction(e){f.push({objectClass:null,createHierarchy:!1,instances:[]})}_SpawnPickInstance(e,t,s){const n=f.at(-1);n.objectClass=e,n.createHierarchy=s,n.instances.push(t)}AfterRunAction(e){const t=f.pop(),s=t.objectClass,n=t.createHierarchy;if(s){const i=new Map;for(const r of t.instances)r.CollectInstancesToPick(i,s,n);for(const[a,o]of i)a.GetCurrentSol().SetSetPicked(o)}}_AddAnimation(e){const t=this.GetObjectClass().AddAnimation(e),s=this.GetRuntime(),n=t.GetFrameAt(0);return n.GetImageInfo().LoadStaticTexture(s.GetRenderer(),{sampling:s.GetSampling()}).then(()=>this._UpdateAllCurrentTexture()),t}_RemoveAnimation(e){for(const t of this._objectClass.instancesIncludingPendingCreate())t.GetSdkInstance()._OnAnimationRemoved(e);this.GetObjectClass().RemoveAnimation(e)}_AddAnimationFrame(e,t){const s=this._objectClass.GetAnimationByName(e);if(!s)throw new Error(`cannot find animation name '${e}'`);let n=s.FrameTagOrIndexToIndex(t);n<0&&(n+=s.GetFrameCount()+1);const i=d.AnimationFrameInfo.CreateDynamic(this.GetRuntime()),r=(s.InsertFrameAt(i,n),this.GetRuntime());i.GetImageInfo().LoadStaticTexture(r.GetRenderer(),{sampling:r.GetSampling()}).then(()=>this._UpdateAllCurrentTexture());for(const a of this._objectClass.instancesIncludingPendingCreate())a.GetSdkInstance()._OnAnimationFramesChanged();return i}_RemoveAnimationFrame(e,t){const s=this._objectClass.GetAnimationByName(e);if(!s)throw new Error(`cannot find animation name '${e}'`);if(1===s.GetFrameCount())throw new Error(`cannot remove last frame from animation '${e}'`);let n=s.FrameTagOrIndexToIndex(t);n<0&&(n+=s.GetFrameCount()),s.RemoveFrameAt(n);for(const i of this._objectClass.instancesIncludingPendingCreate())i.GetSdkInstance()._OnAnimationFramesChanged()}GetScriptInterfaceClass(){return self.ISpriteObjectType}},new WeakMap);self.ISpriteObjectType=class extends self.IObjectClass{constructor(e){super(e),g.set(this,e.GetSdkType())}getAnimation(t){e.RequireString(t);const s=g.get(this).GetObjectClass().GetAnimationByName(t);return s?s.GetIAnimation():null}getAllAnimations(){return g.get(this).GetObjectClass().GetAllAnimations().map(e=>e.GetIAnimation())}addAnimation(t){return e.RequireString(t),g.get(this)._AddAnimation(t).GetIAnimation()}removeAnimation(t){e.RequireString(t),g.get(this)._RemoveAnimation(t)}addAnimationFrame(t,s){if(e.RequireString(t),"number"!=typeof s&&"string"!=typeof s)throw new TypeError("invalid insert location");return g.get(this)._AddAnimationFrame(t,s).GetIAnimationFrame()}removeAnimationFrame(t,s){if(e.RequireString(t),"number"!=typeof s&&"string"!=typeof s)throw new TypeError("invalid insert location");g.get(this)._RemoveAnimationFrame(t,s)}}}{const ea=self.C3,fa=self.C3X,ga=0,ha=1,ia=2,ja=3,ka=ea.New(ea.Rect),la=ea.New(ea.Quad),ma=ea.New(ea.Vector2),na=1,oa=2,pa=4,qa=(ea.Plugins.Sprite.Instance=class extends ea.SDKWorldInstanceBase{constructor(e,t){super(e);let s=!0,n="",i=0,r=!0;t&&(s=!!t[ga],n=t[ha],i=t[ia],r=t[ja]),this._currentAnimation=this._objectClass.GetAnimationByName(n)||this._objectClass.GetAnimations()[0],this._currentFrameIndex=ea.clamp(i,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);const a=this._currentAnimationFrame.GetImageInfo(),o=(this._currentTexture=a.GetTexture(),this._currentRcTex=a.GetTexRect(),this._currentQuadTex=a.GetTexQuad(),this.HandleRendererContextLoss(),e.SetFlag(oa,!0),e.SetFlag(na,0<=this._currentAnimation.GetSpeed()),this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed()),this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo(),this._animationTimer=ea.New(ea.KahanSum),this._frameStartTime=0,this._animationRepeats=0,this._animTriggerName="",this._changeAnimFrameIndex=-1,this._changeAnimationName="",this._changeAnimationFrom=0,this.GetWorldInfo());this._bquadRef=o.GetBoundingQuad(),o.SetVisible(s),o.SetCollisionEnabled(r),o.SetOriginX(this._currentAnimationFrame.GetOriginX()),o.SetOriginY(this._currentAnimationFrame.GetOriginY()),o.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly()),o.SetBboxChanged(),1===this._objectClass.GetAnimationCount()&&1===this._objectClass.GetAnimations()[0].GetFrameCount()||0===this._currentAnimationSpeed||this._StartTicking()}Release(){this._currentAnimation=null,this._currentAnimationFrame=null,this._currentTexture=null,this._animationTimer=null,super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return!0}OnRendererContextLost(){this._currentTexture=null}OnRendererContextRestored(){this._UpdateCurrentTexture()}Draw(e){const t=this._currentTexture;if(null!==t){e.SetTexture(t);const s=this.GetWorldInfo();s.HasMesh()?this._DrawMesh(s,e):this._DrawStandard(s,e)}}_DrawStandard(e,t){let s=this._bquadRef;this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),t.Quad4(s,this._currentQuadTex)}_DrawMesh(t,e){const s=t.GetTransformedMesh();if(t.IsMeshChanged()){t.CalculateBbox(ka,la,!1);let e=la;this._runtime.IsPixelRoundingEnabled()&&(e=t.PixelRoundQuad(e)),s.CalculateTransformedMesh(t.GetSourceMesh(),e,this._currentQuadTex),t.SetMeshChanged(!1)}s.Draw(e)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(oa)}SetAnimationPlaying(e){this._inst.SetFlag(oa,e)}IsPlayingForwards(){return this._inst.GetFlag(na)}SetPlayingForwards(e){this._inst.SetFlag(na,e)}IsInAnimationTrigger(){return this._inst.GetFlag(pa)}SetInAnimationTrigger(e){this._inst.SetFlag(pa,e)}Tick(){this._changeAnimationName&&this._DoChangeAnimation(),0<=this._changeAnimFrameIndex&&this._DoChangeAnimFrame();const e=this._currentAnimationSpeed;if(this.IsAnimationPlaying()&&0!==e){const t=this._runtime.GetDt(this._inst),s=(this._animationTimer.Add(t),this.GetAnimationTime()),n=this._currentAnimationFrame,i=n.GetDuration()/e;if(!(s<this._frameStartTime+i)){const r=this._currentAnimation,a=this._currentAnimationRepeatTo,o=r.GetFrameCount(),l=r.GetRepeatCount(),h=r.IsLooping(),c=r.IsPingPong(),u=(this.IsPlayingForwards()?this._currentFrameIndex++:this._currentFrameIndex--,this._frameStartTime+=i,this._currentFrameIndex>=o&&(c?(this.SetPlayingForwards(!1),this._currentFrameIndex=o-2):!h&&(this._animationRepeats++,this._animationRepeats>=l)?this._FinishAnimation(!1):this._currentFrameIndex=a),this._currentFrameIndex<0&&(c?(this._currentFrameIndex=1,this.SetPlayingForwards(!0),h||(this._animationRepeats++,this._animationRepeats>=l&&this._FinishAnimation(!0))):!h&&(this._animationRepeats++,this._animationRepeats>=l)?this._FinishAnimation(!0):this._currentFrameIndex=a),this._currentFrameIndex=ea.clamp(this._currentFrameIndex,0,o-1),r.GetFrameAt(this._currentFrameIndex));s>this._frameStartTime+u.GetDuration()/e&&(this._frameStartTime=s),this._OnFrameChanged(n,u)}}else this._StopTicking()}_FinishAnimation(e){this._currentFrameIndex=e?0:this._currentAnimation.GetFrameCount()-1,this.SetAnimationPlaying(!1),this._animTriggerName=this._currentAnimation.GetName(),this.SetInAnimationTrigger(!0),this.DispatchScriptEvent("animationend",!1,{animationName:this._animTriggerName}),this.Trigger(ea.Plugins.Sprite.Cnds.OnAnyAnimFinished),this.Trigger(ea.Plugins.Sprite.Cnds.OnAnimFinished),this.SetInAnimationTrigger(!1),this._animationRepeats=0}_OnFrameChanged(s,n,e){if(s!==n){const t=this.GetWorldInfo(),i=s.GetImageInfo(),r=n.GetImageInfo(),a=i.GetWidth(),o=i.GetHeight(),l=r.GetWidth(),h=r.GetHeight(),c=(e&&e.onFrameChange?e.onFrameChange(t,a,o,l,h):(a!==l&&t.SetWidth(t.GetWidth()*(l/a)),o!==h&&t.SetHeight(t.GetHeight()*(h/o))),t.SetOriginX(n.GetOriginX()),t.SetOriginY(n.GetOriginY()),t.SetSourceCollisionPoly(n.GetCollisionPoly()),t.SetBboxChanged(),this._currentAnimationFrame=n,this._currentTexture=r.GetTexture(),this._currentRcTex=r.GetTexRect(),this._currentQuadTex=r.GetTexQuad(),this.GetInstance().GetBehaviorInstances());for(let e=0,t=c.length;e<t;++e)c[e].OnSpriteFrameChanged(s,n);this.DispatchScriptEvent("framechange",!1,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex}),this.Trigger(ea.Plugins.Sprite.Cnds.OnFrameChanged),this._runtime.UpdateRender()}}_StartAnim(e){this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),1===e&&0!==this._currentFrameIndex&&(this._changeAnimFrameIndex=0,this.IsInAnimationTrigger()||this._DoChangeAnimFrame()),this._StartTicking()}_SetAnim(e,t,s){this._changeAnimationName=e,this._changeAnimationFrom=t,this._StartTicking(),!s&&this.IsInAnimationTrigger()||this._DoChangeAnimation()}_GetCurrentAnimation(){return this._currentAnimation}_GetCurrentAnimationName(){return this._changeAnimationName||this._currentAnimation.GetName()}_OnAnimationRemoved(e){ea.equalsNoCase(e,this._GetCurrentAnimationName())&&this._SetAnim(this._objectClass.GetFirstAnimation().GetName(),1,!0)}_SetAnimFrame(e){if("string"==typeof e)if(String(Number(e))===e)e=Number(e);else{const t=this._objectClass.GetAnimationByName(this._GetCurrentAnimationName());if(!t)return;if(-1===(e=t.GetFrameIndexByTag(e)))return}isFinite(e)&&(this._changeAnimFrameIndex=e,this.IsInAnimationTrigger()||this._DoChangeAnimFrame())}_OnAnimationFramesChanged(){if(!this._changeAnimationName&&-1===this._changeAnimFrameIndex){const e=this._currentAnimationFrame,t=this._currentAnimation.GetFrameAt(ea.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1));e!==t&&this._OnFrameChanged(e,t),1<this._currentAnimation.GetFrameCount()&&0<this._currentAnimationSpeed&&this._StartTicking()}}_GetAnimFrame(){return this._currentFrameIndex}_GetAnimFrameTag(){return this._currentAnimationFrame.GetTag()}_SetAnimSpeed(e){this._currentAnimationSpeed=Math.abs(e),this.SetPlayingForwards(0<=e),0<this._currentAnimationSpeed&&this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(e){"string"==typeof e&&-1===(e=this._currentAnimation.GetFrameIndexByTag(e))||(e=ea.clamp(Math.floor(e),0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationRepeatTo=e)}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(e){const t=this._currentAnimationFrame,s=this._objectClass.GetAnimationByName(this._changeAnimationName);if(this._changeAnimationName="",s&&(s!==this._currentAnimation||!this.IsAnimationPlaying())){this._currentAnimation=s,this.SetPlayingForwards(0<=s.GetSpeed()),this._currentAnimationSpeed=Math.abs(s.GetSpeed()),this._currentAnimationRepeatTo=s.GetRepeatTo(),this._currentFrameIndex=ea.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1),1===this._changeAnimationFrom&&(this._currentFrameIndex=0),this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime();const n=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(t,n,e)}}_DoChangeAnimFrame(e){const t=this._currentAnimationFrame,s=this._currentFrameIndex;if(this._currentFrameIndex=ea.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1),this._changeAnimFrameIndex=-1,e||s!==this._currentFrameIndex){const n=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(t,n),this._frameStartTime=this.GetAnimationTime()}}_UpdateCurrentTexture(){const e=this._currentAnimationFrame.GetImageInfo();this._currentTexture=e.GetTexture(),this._currentRcTex=e.GetTexRect(),this._currentQuadTex=e.GetTexQuad(),this.GetWorldInfo().SetMeshChanged(!0)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(e){let t=this._currentAnimationFrame,s=this.GetWorldInfo(),n=null;if("string"==typeof e)n=t.GetImagePointByName(e);else{if("number"!=typeof e)throw new TypeError("expected string or number");n=t.GetImagePointByIndex(e-1)}let i=s.GetTotalZElevation();if(!n)return[s.GetX(),s.GetY(),i];if(ma.copy(n.GetVec2()),s.HasMesh()){const[r,a,o]=s.GetSourceMesh().TransformPoint(ma.getX(),ma.getY());ma.set(r,a),i+=o}return ma.offset(-t.GetOriginX(),-t.GetOriginY()),ma.scale(s.GetWidth(),s.GetHeight()),ma.rotate(s.GetAngle()),ma.offset(s.GetX(),s.GetY()),[ma.getX(),ma.getY(),i]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(e){e=Math.floor(e);const t=this.GetWorldInfo(),s=t.GetTransformedCollisionPoly(),n=s.pointCount();if((e=e===n?0:e)<0||n<=e)return[0,0];const i=s.pointsArr();return[i[2*e+0]+t.GetX(),i[2*e+1]+t.GetY()]}GetDebuggerProperties(){const t=ea.Plugins.Sprite.Acts,e="plugins.sprite.debugger.animation-properties";return[{title:e+".title",properties:[{name:e+".current-animation",value:this._currentAnimation.GetName(),onedit:e=>this.CallAction(t.SetAnim,e,0)},{name:e+".current-frame",value:this._currentFrameIndex,onedit:e=>this.CallAction(t.SetAnimFrame,e)},{name:e+".is-playing",value:this.IsAnimationPlaying(),onedit:e=>e?this.CallAction(t.StartAnim,0):this.CallAction(t.StopAnim)},{name:e+".speed",value:this._currentAnimationSpeed,onedit:e=>this.CallAction(t.SetAnimSpeed,e)},{name:e+".repeats",value:this._animationRepeats,onedit:e=>this._animationRepeats=e}]}]}SaveToJson(){const e={a:this._currentAnimation.GetSID()},t=(0!==this._frameStartTime&&(e.fs=this._frameStartTime),this.GetAnimationTime()),s=(0!==t&&(e.at=t),0!==this._currentFrameIndex&&(e.f=this._currentFrameIndex),0!==this._currentAnimationSpeed&&(e.cas=this._currentAnimationSpeed),1!==this._animationRepeats&&(e.ar=this._animationRepeats),0!==this._currentAnimationRepeatTo&&(e.rt=this._currentAnimationRepeatTo),this.IsAnimationPlaying()||(e.ap=this.IsAnimationPlaying()),this.IsPlayingForwards()||(e.af=this.IsPlayingForwards()),this.GetWorldInfo());return s.IsCollisionEnabled()&&(e.ce=s.IsCollisionEnabled()),e}LoadFromJson(e){const t=this.GetObjectClass().GetAnimationBySID(e.a),s=(t&&(this._currentAnimation=t),this._frameStartTime=e.hasOwnProperty("fs")?e.fs:0,this._animationTimer.Set(e.hasOwnProperty("at")?e.at:0),e.hasOwnProperty("f")?e.f:0),n=(this._currentFrameIndex=ea.clamp(s,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationSpeed=e.hasOwnProperty("cas")?e.cas:0,this._animationRepeats=e.hasOwnProperty("ar")?e.ar:1,e.hasOwnProperty("rt")?e.rt:0),i=(this._currentAnimationRepeatTo=ea.clamp(n,0,this._currentAnimation.GetFrameCount()-1),this.SetAnimationPlaying(!e.hasOwnProperty("ap")||!!e.ap),this.SetPlayingForwards(!e.hasOwnProperty("af")||!!e.af),this._currentAnimation.GetFrameAt(this._currentFrameIndex)),r=(this._currentAnimationFrame=i,this._UpdateCurrentTexture(),this.GetWorldInfo());r.SetOriginX(i.GetOriginX()),r.SetOriginY(i.GetOriginY()),r.SetSourceCollisionPoly(i.GetCollisionPoly()),r.SetCollisionEnabled(!!e.ce),this.IsAnimationPlaying()&&this._StartTicking()}GetPropertyValueByIndex(e){const t=this.GetWorldInfo();switch(e){case ja:return t.IsCollisionEnabled();case ia:return ea.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case ha:return this._currentAnimation.GetName()}}SetPropertyValueByIndex(e,t,s){const n=this.GetWorldInfo();switch(e){case ja:n.SetCollisionEnabled(!!t);break;case ia:{this.SetAnimationPlaying(!1);const i=this._currentAnimation.GetFrameCount()-1,r=t=ea.clamp(t,0,i),a=this._currentAnimation.GetFrameAt(this._currentFrameIndex),o=this._currentAnimation.GetFrameAt(r);this._OnFrameChanged(a,o,s),this._currentFrameIndex=ea.clamp(r,0,i);break}case ha:{this._changeAnimationName=t,this._DoChangeAnimation(s);const l=this._currentAnimation.GetFrameCount();1<l&&0<this._currentAnimation.GetSpeed()?this._StartTicking():this._StopTicking();break}}}GetScriptInterfaceClass(){return self.ISpriteInstance}},new WeakMap),ra=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=class extends self.IWorldInstance{constructor(){super(),qa.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return qa.get(this).GetImagePointCount()}getImagePointX(e){return this.getImagePoint(e)[0]}getImagePointY(e){return this.getImagePoint(e)[1]}getImagePointZ(e){return this.getImagePoint(e)[2]}getImagePoint(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return qa.get(this).GetImagePoint(e)}getPolyPointCount(){return qa.get(this).GetCollisionPolyPointCount()}getPolyPointX(e){return fa.RequireFiniteNumber(e),qa.get(this).GetCollisionPolyPoint(e)[0]}getPolyPointY(e){return fa.RequireFiniteNumber(e),qa.get(this).GetCollisionPolyPoint(e)[1]}getPolyPoint(e){return fa.RequireFiniteNumber(e),qa.get(this).GetCollisionPolyPoint(e)}stopAnimation(){qa.get(this).SetAnimationPlaying(!1)}startAnimation(e="current-frame"){fa.RequireString(e);const t=ra.get(e);if(void 0===t)throw new Error("invalid mode");qa.get(this)._StartAnim(t)}setAnimation(e,t="beginning"){fa.RequireString(e),fa.RequireString(t);const s=ra.get(t);if(void 0===s)throw new Error("invalid mode");const n=qa.get(this);if(!n.GetObjectClass().GetAnimationByName(e))throw new Error(`animation name "${e}" does not exist`);n._SetAnim(e,s)}getAnimation(e){fa.RequireString(e);const t=qa.get(this).GetObjectClass().GetAnimationByName(e);return t?t.GetIAnimation():null}get animation(){return qa.get(this)._GetCurrentAnimation().GetIAnimation()}get animationName(){return qa.get(this)._GetCurrentAnimationName()}set animationFrame(e){fa.RequireFiniteNumber(e),qa.get(this)._SetAnimFrame(e)}get animationFrame(){return qa.get(this)._GetAnimFrame()}set animationFrameTag(e){fa.RequireString(e),qa.get(this)._SetAnimFrame(e)}get animationFrameTag(){return qa.get(this)._GetAnimFrameTag()}set animationSpeed(e){fa.RequireFiniteNumber(e),qa.get(this)._SetAnimSpeed(e)}get animationSpeed(){return qa.get(this)._GetAnimSpeed()}set animationRepeatToFrame(e){fa.RequireFiniteNumber(e),qa.get(this)._SetAnimRepeatToFrame(e)}get animationRepeatToFrame(){return qa.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return qa.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return qa.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const e=qa.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}async replaceCurrentAnimationFrame(e){fa.RequireInstanceOf(e,Blob);const t=qa.get(this),s=t.GetRuntime(),n=t.GetCurrentImageInfo(),i=ea.New(ea.ImageInfo);if(i.LoadDynamicBlobAsset(s,e),await i.LoadStaticTexture(s.GetRenderer(),{sampling:s.GetSampling()}),t.WasReleased())i.Release();else{n.ReplaceWith(i);const r=t.GetSdkType();r._UpdateAllCurrentTexture(),r.GetObjectClass().Dispatcher().dispatchEvent(new ea.Event("animationframeimagechange")),s.UpdateRender()}}setSolidCollisionFilter(e,t){fa.RequireString(t),qa.get(this).GetWorldInfo().SetSolidCollisionFilter(!!e,t)}}}{const Vb=self.C3;Vb.Plugins.Sprite.Cnds={IsAnimPlaying(e){return Vb.equalsNoCase(this._GetCurrentAnimationName(),e)},CompareFrame(e,t){return Vb.compare(this._currentFrameIndex,e,t)},CompareFrameTag(e,t){if("string"!=typeof t)return!1;const s=this._currentAnimationFrame.GetTag();return Vb.compare(s.toLowerCase(),e,t.toLowerCase())},CompareAnimSpeed(e,t){return Vb.compare(this._GetAnimSpeed(),e,t)},OnAnimFinished(e){return Vb.equalsNoCase(this._animTriggerName,e)},OnAnyAnimFinished(){return!0},OnFrameChanged(){return!0},IsMirrored(){return this.GetWorldInfo().GetWidth()<0},IsFlipped(){return this.GetWorldInfo().GetHeight()<0},OnURLLoaded(){return!0},OnURLFailed(){return!0},IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}}}{const d1=self.C3;d1.Plugins.Sprite.Acts={Spawn(e,t,s,n,i){if(e&&t){const[r,a]=this.GetImagePoint(s),o=this._runtime.CreateInstance(e,t,r,a,n,i);if(o){if(n&&t.SortAndAddInstancesByZIndex(o),e.GetPlugin().IsRotatable()){const h=o.GetWorldInfo();h.SetAngle(this.GetWorldInfo().GetAngle()),h.SetBboxChanged()}const l=this._runtime.GetEventSheetManager();l.BlockFlushingInstances(!0),o._TriggerOnCreatedOnSelfAndRelated(),l.BlockFlushingInstances(!1),e!==this._runtime.GetCurrentAction().GetObjectClass()&&this._sdkType._SpawnPickInstance(e,o,n)}}},StopAnim(){this.SetAnimationPlaying(!1)},StartAnim(e){this._StartAnim(e)},SetAnim(e,t){this._SetAnim(e,t)},SetAnimFrame(e){this._SetAnimFrame(e)},SetAnimSpeed(e){this._SetAnimSpeed(e)},SetAnimRepeatToFrame(e){this._SetAnimRepeatToFrame(e)},AddRemoveAnimation(t,e){try{0===t?this.GetSdkType()._AddAnimation(e):this.GetSdkType()._RemoveAnimation(e)}catch(e){console.error(`[Construct] Error ${0===t?"adding":"removing"} animation: `,e)}},AddRemoveAnimationFrame(t,e,s){try{0===t?this.GetSdkType()._AddAnimationFrame(e,s):this.GetSdkType()._RemoveAnimationFrame(e,s)}catch(e){console.error(`[Construct] Error ${0===t?"adding":"removing"} animation frame: `,e)}},SetMirrored(e){const t=this.GetWorldInfo(),s=t.GetWidth(),n=Math.abs(s)*(0===e?-1:1);s!==n&&(t.SetWidth(n),t.SetBboxChanged())},SetFlipped(e){const t=this.GetWorldInfo(),s=t.GetHeight(),n=Math.abs(s)*(0===e?-1:1);s!==n&&(t.SetHeight(n),t.SetBboxChanged())},SetScale(e){const t=this._currentAnimationFrame,s=t.GetImageInfo(),n=this.GetWorldInfo(),i=n.GetWidth()<0?-1:1,r=n.GetHeight()<0?-1:1,a=s.GetWidth()*e*i,o=s.GetHeight()*e*r;n.GetWidth()===a&&n.GetHeight()===o||(n.SetSize(a,o),n.SetBboxChanged())},async LoadURL(e,t,s){const n=this._currentAnimationFrame,i=n.GetImageInfo(),r=this.GetWorldInfo(),a=this._runtime,o=this._sdkType;if(i.GetURL()===e)0===t&&(r.SetSize(i.GetWidth(),i.GetHeight()),r.SetBboxChanged()),this.Trigger(d1.Plugins.Sprite.Cnds.OnURLLoaded);else{const l=d1.New(d1.ImageInfo);try{if(await l.LoadDynamicAsset(a,e),!l.IsLoaded())throw new Error("image failed to load");if(this.WasReleased())return void l.Release();await l.LoadStaticTexture(a.GetRenderer(),{sampling:a.GetSampling()})}catch(e){return console.error("Load image from URL failed: ",e),void(this.WasReleased()||this.Trigger(d1.Plugins.Sprite.Cnds.OnURLFailed))}this.WasReleased()?l.Release():(i.ReplaceWith(l),o._UpdateAllCurrentTexture(),o.GetObjectClass().Dispatcher().dispatchEvent(new d1.Event("animationframeimagechange")),a.UpdateRender(),0===t&&(r.SetSize(i.GetWidth(),i.GetHeight()),r.SetBboxChanged()),await this.TriggerAsync(d1.Plugins.Sprite.Cnds.OnURLLoaded))}},SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e)},SetSolidCollisionFilter(e,t){this.GetWorldInfo().SetSolidCollisionFilter(0===e,t)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{const dc=self.C3;dc.Plugins.Sprite.Exps={AnimationFrame(){return this._GetAnimFrame()},AnimationFrameTag(){return this._GetAnimFrameTag()},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(e){return this.GetImagePoint(e)[0]},ImagePointY(e){return this.GetImagePoint(e)[1]},ImagePointZ(e){return this.GetImagePoint(e)[2]},ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(e){return this.GetCollisionPolyPoint(e)[0]},PolyPointYAt(e){return this.GetCollisionPolyPoint(e)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}}}{const a=self.C3;a.Plugins.NinePatch=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.NinePatch.Type=class extends d.SDKTypeBase{constructor(e){super(e),this._textureSet=null,this._drawable=null}Release(){this.ReleaseTextures(),super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}async LoadTextures(e){const t=this.GetImageInfo();this._drawable=await t.ExtractImageToCanvas()}CreatePatch(e,t,s,n){!this._textureSet&&this._drawable&&(this._textureSet=new self.NinePatchTextureSet(this),this._textureSet.CreateTextures(this._drawable,e,t,s,n))}ReleaseTextures(){this._textureSet&&(this._textureSet.Release(),this._textureSet=null)}GetTextureSet(){return this._textureSet}}}{const m=self.C3,n=0,o=1,p=2,q=3,r=4,s=5,t=6,u=7,v=8,w=m.New(m.Rect),x=m.New(m.Rect),y=m.New(m.Quad);m.Plugins.NinePatch.Instance=class extends m.SDKWorldInstanceBase{constructor(e,i){super(e),this._leftMargin=16,this._rightMargin=16,this._topMargin=16,this._bottomMargin=16,this._edges=1,this._fill=1,this._isSeamless=!0,this._callback3d=null,i&&(this._leftMargin=i[n],this._rightMargin=i[o],this._topMargin=i[p],this._bottomMargin=i[q],this._edges=i[r],this._fill=i[s],this._isSeamless=!!i[v],this.GetWorldInfo().SetVisible(!!i[t])),this._sdkType.CreatePatch(this._leftMargin,this._rightMargin,this._topMargin,this._bottomMargin)}Release(){super.Release()}_Set3DCallback(e){this._callback3d=e}Draw(e){const t=this.GetWorldInfo(),s=t.GetBoundingQuad();this._Draw(e,s.getTlx(),s.getTly(),t.GetWidth(),t.GetHeight())}_Draw(e,t,s,n,i){let r=this._sdkType.GetTextureSet();if(r||(this._sdkType.CreatePatch(this._leftMargin,this._rightMargin,this._topMargin,this._bottomMargin),r=this._sdkType.GetTextureSet())){const a=r.GetImageWidth(),o=r.GetImageHeight(),l=Math.min(this._leftMargin,a),h=Math.min(this._rightMargin,a),c=Math.min(this._topMargin,o),u=Math.min(this._bottomMargin,o),d=a-h,_=o-u,p=this._isSeamless?1:0,m=this._edges,g=this._fill;if(0<l&&0<c&&this._DrawPatch(e,r.GetTexture(),0,0,l+p,c+p,t,s,l+p,c+p),0<h&&0<c&&this._DrawPatch(e,r.GetTexture(),d-p,0,h+p,c+p,t+n-h-p,s,h+p,c+p),0<h&&0<u&&this._DrawPatch(e,r.GetTexture(),d-p,_-p,h+p,u+p,t+n-h-p,s+i-u-p,h+p,u+p),0<l&&0<u&&this._DrawPatch(e,r.GetTexture(),0,_-p,l+p,u+p,t,s+i-u-p,l+p,u+p),0===m){const f=2===g?0:p;0<l&&c<_&&this._TilePatch(e,r.GetLeftTexture(),t,s+c,l+f,i-c-u,0,0),0<h&&c<_&&this._TilePatch(e,r.GetRightTexture(),t+n-h-f,s+c,h+f,i-c-u,f,0),0<c&&l<d&&this._TilePatch(e,r.GetTopTexture(),t+l,s,n-l-h,c+f,0,0),0<u&&l<d&&this._TilePatch(e,r.GetBottomTexture(),t+l,s+i-u-f,n-l-h,u+f,0,f)}else 1===m&&(0<l&&c<_&&this._DrawPatch(e,r.GetTexture(),0,c,l,_-c,t,s+c,l,i-c-u),0<h&&c<_&&this._DrawPatch(e,r.GetTexture(),d,c,h,_-c,t+n-h,s+c,h,i-c-u),0<c&&l<d&&this._DrawPatch(e,r.GetTexture(),l,0,d-l,c,t+l,s,n-l-h,c),0<u)&&l<d&&this._DrawPatch(e,r.GetTexture(),l,_,d-l,u,t+l,s+i-u,n-l-h,u);c<_&&l<d&&(0===g?this._TilePatch(e,r.GetFillTexture(),t+l,s+c,n-l-h,i-c-u,0,0):1===g&&this._DrawPatch(e,r.GetTexture(),l,c,d-l,_-c,t+l,s+c,n-l-h,i-c-u))}}_DrawPatch(e,t,s,n,i,r,a,o,l,h){const c=t.GetWidth(),u=t.GetHeight();if(e.SetTexture(t),w.set(a,o,a+l,o+h),x.set(s/c,n/u,(s+i)/c,(n+r)/u),null===this._callback3d){const d=this.GetWorldInfo(),_=d.GetBoundingQuad(),p=_.getTlx(),m=_.getTly();w.offset(-p,-m),y.setFromRotatedRect(w,d.GetAngle()),y.offset(p,m),e.Quad3(y,x)}else this._callback3d(w,x)}_TilePatch(e,t,s,n,i,r,a,o){const l=t.GetWidth(),h=t.GetHeight();if(e.SetTexture(t),w.set(s,n,s+i,n+r),x.set(-a/l,-o/h,(i-a)/l,(r-o)/h),null===this._callback3d){const c=this.GetWorldInfo(),u=c.GetBoundingQuad(),d=u.getTlx(),_=u.getTly();w.offset(-d,-_),y.setFromRotatedRect(w,c.GetAngle()),y.offset(d,_),e.Quad3(y,x)}else this._callback3d(w,x)}GetCurrentImageInfo(){this._objectClass.GetImageInfo()}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}}}{const Da=self.C3;Da.Plugins.NinePatch.Cnds={}}{const Ea=self.C3;Ea.Plugins.NinePatch.Acts={SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{const Ga=self.C3;Ga.Plugins.NinePatch.Exps={}}{let CloneDrawable2=function(e){const t=C33.CreateCanvas(e.width,e.height),s=t.getContext("2d");return s.drawImage(e,0,0),t};CloneDrawable=CloneDrawable2;const C33=self.C3;self.NinePatchTextureSet=class{constructor(e){this._sdkType=e,this._runtime=this._sdkType.GetRuntime(),this._texture=null,this._fillTexture=null,this._leftTexture=null,this._rightTexture=null,this._topTexture=null,this._bottomTexture=null,this._imageWidth=0,this._imageHeight=0,this._renderer=this._runtime.GetRenderer(),this._isLoading=!1,this._wasReleased=!1}Release(){this._renderer.IsContextLost()||(this._renderer.DeleteTexture(this._texture),this._renderer.DeleteTexture(this._fillTexture),this._renderer.DeleteTexture(this._leftTexture),this._renderer.DeleteTexture(this._rightTexture),this._renderer.DeleteTexture(this._topTexture),this._renderer.DeleteTexture(this._bottomTexture)),this._texture=null,this._fillTexture=null,this._leftTexture=null,this._rightTexture=null,this._topTexture=null,this._bottomTexture=null,this._sdkType=null,this._renderer=null,this._wasReleased=!0}WasReleased(){return this._wasReleased}CreateTextures(e,t,s,n,i){this._SliceImage(e,t,s,n,i)}HasCreatedTextures(){return!!this._texture}_SliceImage(e,t,s,n,i){if(!this._wasReleased){const r=e.width,a=e.height,o=(this._imageWidth=r,this._imageHeight=a,t=Math.min(Math.floor(t),r),s=Math.min(Math.floor(s),r),n=Math.min(Math.floor(n),a),r-s),l=a-(i=Math.min(Math.floor(i),a)),h=this._runtime.GetSampling(),c=this._runtime.GetCanvasManager().GetTextureAnisotropy();this._texture=this._renderer.CreateStaticTexture(CloneDrawable2(e),{sampling:h,anisotropy:c}),t<o&&n<l&&(this._fillTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable2(e),t,n,o,l),{wrapX:"repeat",wrapY:"repeat",sampling:h,anisotropy:c})),0<t&&n<l&&(this._leftTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable2(e),0,n,t,l),{wrapY:"repeat",sampling:h,anisotropy:c})),0<s&&n<l&&(this._rightTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable2(e),o,n,r,l),{wrapY:"repeat",sampling:h,anisotropy:c})),0<n&&t<o&&(this._topTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable2(e),t,0,o,n),{wrapX:"repeat",sampling:h,anisotropy:c})),0<i&&t<o&&(this._bottomTexture=this._renderer.CreateStaticTexture(this._SliceSubImage(CloneDrawable2(e),t,l,o,a),{wrapX:"repeat",sampling:h,anisotropy:c}))}}_SliceSubImage(e,t,s,n,i){const r=n-t,a=i-s,o=C33.CreateCanvas(r,a),l=o.getContext("2d");return l.drawImage(e,t,s,r,a,0,0,r,a),o}GetImageWidth(){return this._imageWidth}GetImageHeight(){return this._imageHeight}GetTexture(){return this._texture}GetFillTexture(){return this._fillTexture}GetLeftTexture(){return this._leftTexture}GetRightTexture(){return this._rightTexture}GetTopTexture(){return this._topTexture}GetBottomTexture(){return this._bottomTexture}}}{const a=self.C3;a.Plugins.TiledBg=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{let WrapModeToStr2=function(e){switch(e){case 0:return"clamp-to-edge";case 1:return"repeat";case 2:return"mirror-repeat"}return"repeat"};WrapModeToStr=WrapModeToStr2;const d=self.C3;d.Plugins.TiledBg.Type=class extends d.SDKTypeBase{constructor(e,t){super(e),this._wrapX="repeat",this._wrapY="repeat",t&&(this._wrapX=WrapModeToStr2(t[0]),this._wrapY=WrapModeToStr2(t[1]))}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}GetWrapModeX(){return this._wrapX}GetWrapModeY(){return this._wrapY}}}{const j=self.C3,k=self.C3X,l=0,m=1,n=4,o=5,p=6,q=7,r=8,s=9,t=10,u=11,v=12,w=13,x=14,y=j.New(j.Rect),z=j.New(j.Quad),A=j.New(j.Rect),B=j.New(j.Quad),C=(j.Plugins.TiledBg.Instance=class extends j.SDKWorldInstanceBase{constructor(e,i){super(e),this._imageOffsetX=0,this._imageOffsetY=0,this._imageScaleX=1,this._imageScaleY=1,this._imageAngle=0,this._enableTileRandomization=!1,this._tileXRandom=0,this._tileYRandom=0,this._tileAngleRandom=0,this._tileBlendMarginX=0,this._tileBlendMarginY=0,this._ownImageInfo=null,i&&(this.GetWorldInfo().SetVisible(!!i[l]),this._imageOffsetX=i[n],this._imageOffsetY=i[o],this._imageScaleX=i[p],this._imageScaleY=i[q],this._imageAngle=j.toRadians(i[r]),this._enableTileRandomization=!!i[s],this._tileXRandom=i[t],this._tileYRandom=i[u],this._tileAngleRandom=i[v],this._tileBlendMarginX=i[w],this._tileBlendMarginY=i[x])}Release(){this._ReleaseOwnImage(),super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}CalculateTextureCoordsFor3DFace(e,t,s){const n=this.GetCurrentImageInfo(),i=n.GetWidth(),r=n.GetHeight(),a=this._imageOffsetX/i,o=this._imageOffsetY/r,l=this._imageAngle;A.set(0,0,e/(i*this._imageScaleX),t/(r*this._imageScaleY)),A.offset(-a,-o),0===l?s.setFromRect(A):s.setFromRotatedRect(A,-l)}SetTilingShaderProgram(e,t=!0){if(this._enableTileRandomization){const s=this.GetCurrentImageInfo();e.SetTileRandomizationMode(),e.SetTileRandomizationInfo(s.GetWidth()*this._imageScaleX,s.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,this._tileBlendMarginY)}else t&&e.SetTextureFillMode()}Draw(e){const t=this.GetCurrentImageInfo(),s=t.GetTexture();if(null!==s){this.SetTilingShaderProgram(e),e.SetTexture(s);const n=t.GetWidth(),i=t.GetHeight(),r=this._imageOffsetX/n,a=this._imageOffsetY/i,o=this.GetWorldInfo();A.set(0,0,o.GetWidth()/(n*this._imageScaleX),o.GetHeight()/(i*this._imageScaleY)),A.offset(-r,-a),o.HasMesh()?this._DrawMesh(o,e):this._DrawStandard(o,e)}}_DrawStandard(e,t){let s=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),0===this._imageAngle?t.Quad3(s,A):(B.setFromRotatedRect(A,-this._imageAngle),t.Quad4(s,B))}_DrawMesh(s,e){const n=s.GetTransformedMesh();if(s.IsMeshChanged()){s.CalculateBbox(y,z,!1);let e=z,t=(this._runtime.IsPixelRoundingEnabled()&&(e=s.PixelRoundQuad(e)),A);0!==this._imageAngle&&(B.setFromRotatedRect(A,-this._imageAngle),t=B),n.CalculateTransformedMesh(s.GetSourceMesh(),e,t),s.SetMeshChanged(!1)}n.Draw(e)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return!0}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(!0)}_SetImageOffsetX(e){this._imageOffsetX!==e&&(this._imageOffsetX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(e){this._imageOffsetY!==e&&(this._imageOffsetY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(e){this._imageScaleX!==e&&(this._imageScaleX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(e){this._imageScaleY!==e&&(this._imageScaleY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(e){this._imageAngle!==e&&(this._imageAngle=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageAngle(){return this._imageAngle}_SetTileRandomizationEnabled(e){this._enableTileRandomization!==(e=!!e)&&(this._enableTileRandomization=e,this._runtime.UpdateRender())}_IsTileRandomizationEnabled(){return this._enableTileRandomization}_SetTileXRandom(e){this._tileXRandom!==e&&(this._tileXRandom=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileXRandom(){return this._tileXRandom}_SetTileYRandom(e){this._tileYRandom!==e&&(this._tileYRandom=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileYRandom(){return this._tileYRandom}_SetTileAngleRandom(e){this._tileAngleRandom!==e&&(this._tileAngleRandom=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileAngleRandom(){return this._tileAngleRandom}_SetTileBlendMarginX(e){this._tileBlendMarginX!==e&&(this._tileBlendMarginX=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileBlendMarginX(){return this._tileBlendMarginX}_SetTileBlendMarginY(e){this._tileBlendMarginY!==e&&(this._tileBlendMarginY=e,this._IsTileRandomizationEnabled())&&this._runtime.UpdateRender()}_GetTileBlendMarginY(){return this._tileBlendMarginY}SaveToJson(){const e={};return 0!==this._imageOffsetX&&(e.iox=this._imageOffsetX),0!==this._imageOffsetY&&(e.ioy=this._imageOffsetY),1!==this._imageScaleX&&(e.isx=this._imageScaleX),1!==this._imageScaleY&&(e.isy=this._imageScaleY),0!==this._imageAngle&&(e.ia=this._imageAngle),this._enableTileRandomization&&(e.tr=!0),1!==this._tileXRandom&&(e.trx=this._tileXRandom),1!==this._tileYRandom&&(e.try=this._tileYRandom),1!==this._tileAngleRandom&&(e.tra=this._tileAngleRandom),.1!==this._tileBlendMarginX&&(e.trbmx=this._tileBlendMarginX),.1!==this._tileBlendMarginY&&(e.trbmy=this._tileBlendMarginY),e}LoadFromJson(e){this._imageOffsetX=e.iox||0,this._imageOffsetY=e.ioy||0,this._imageScaleX=e.hasOwnProperty("isx")?e.isx:1,this._imageScaleY=e.hasOwnProperty("isy")?e.isy:1,this._imageAngle=e.ia||0,this._enableTileRandomization=!!e.tr,this._tileXRandom=e.hasOwnProperty("trx")?e.trx:1,this._tileYRandom=e.hasOwnProperty("try")?e.try:1,this._tileAngleRandom=e.hasOwnProperty("tra")?e.tra:1,this._tileBlendMarginX=e.hasOwnProperty("trbmx")?e.trbmx:.1,this._tileBlendMarginY=e.hasOwnProperty("trbmy")?e.trbmy:.1}GetDebuggerProperties(){const e="plugins.tiledbg.properties";return[{title:e+".image-transform.name",properties:[{name:e+".image-offset-x.name",value:this._GetImageOffsetX(),onedit:e=>this._SetImageOffsetX(e)},{name:e+".image-offset-y.name",value:this._GetImageOffsetY(),onedit:e=>this._SetImageOffsetY(e)},{name:e+".image-scale-x.name",value:100*this._GetImageScaleX(),onedit:e=>this._SetImageScaleX(e/100)},{name:e+".image-scale-y.name",value:100*this._GetImageScaleY(),onedit:e=>this._SetImageScaleY(e/100)},{name:e+".image-angle.name",value:j.toDegrees(this._GetImageAngle()),onedit:e=>this._SetImageAngle(j.toRadians(e))}]},{title:e+".tile-randomization.name",properties:[{name:e+".enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:e=>this._SetTileRandomizationEnabled(e)},{name:e+".x-random.name",value:100*this._GetTileXRandom(),onedit:e=>this._SetTileXRandom(e/100)},{name:e+".y-random.name",value:100*this._GetTileYRandom(),onedit:e=>this._SetTileYRandom(e/100)},{name:e+".angle-random.name",value:100*this._GetTileAngleRandom(),onedit:e=>this._SetTileAngleRandom(e/100)},{name:e+".blend-margin-x.name",value:100*this._GetTileBlendMarginX(),onedit:e=>this._SetTileBlendMarginX(e/100)},{name:e+".blend-margin-y.name",value:100*this._GetTileBlendMarginY(),onedit:e=>this._SetTileBlendMarginY(e/100)}]}]}GetPropertyValueByIndex(e){switch(e){case n:return this._GetImageOffsetX();case o:return this._GetImageOffsetY();case p:return this._GetImageScaleX();case q:return this._GetImageScaleY();case r:return this._GetImageAngle();case s:return this._IsTileRandomizationEnabled();case t:return this._GetTileXRandom();case u:return this._GetTileYRandom();case v:return this._GetTileAngleRandom();case w:return this._GetTileBlendMarginX();case x:return this._GetTileBlendMarginY()}}SetPropertyValueByIndex(e,i){switch(e){case n:this._SetImageOffsetX(i);break;case o:this._SetImageOffsetY(i);break;case p:this._SetImageScaleX(i);break;case q:this._SetImageScaleY(i);break;case r:this._SetImageAngle(i);break;case s:this._SetTileRandomizationEnabled(!!i);break;case t:this._SetTileXRandom(i);break;case u:this._SetTileYRandom(i);break;case v:this._SetTileAngleRandom(i);break;case w:this._SetTileBlendMarginX(i);break;case x:this._SetTileBlendMarginY(i)}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}},new WeakMap);self.ITiledBackgroundInstance=class extends self.IWorldInstance{constructor(){super(),C.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(e){k.RequireFiniteNumber(e),C.get(this)._SetImageOffsetX(e)}get imageOffsetX(){return C.get(this)._GetImageOffsetX()}set imageOffsetY(e){k.RequireFiniteNumber(e),C.get(this)._SetImageOffsetY(e)}get imageOffsetY(){return C.get(this)._GetImageOffsetY()}setImageOffset(e,t){k.RequireFiniteNumber(e),k.RequireFiniteNumber(t);const s=C.get(this);s._SetImageOffsetX(e),s._SetImageOffsetY(t)}getImageOffset(){const e=C.get(this);return[e._GetImageOffsetX(),e._GetImageOffsetY()]}set imageScaleX(e){k.RequireFiniteNumber(e),C.get(this)._SetImageScaleX(e)}get imageScaleX(){return C.get(this)._GetImageScaleX()}set imageScaleY(e){k.RequireFiniteNumber(e),C.get(this)._SetImageScaleY(e)}get imageScaleY(){return C.get(this)._GetImageScaleY()}setImageScale(e,t){k.RequireFiniteNumber(e),k.RequireFiniteNumber(t);const s=C.get(this);s._SetImageScaleX(e),s._SetImageScaleY(t)}getImageScale(){const e=C.get(this);return[e._GetImageScaleX(),e._GetImageScaleY()]}set imageAngle(e){k.RequireFiniteNumber(e),C.get(this)._SetImageAngle(e)}get imageAngle(){return C.get(this)._GetImageAngle()}set imageAngleDegrees(e){k.RequireFiniteNumber(e),C.get(this)._SetImageAngle(j.toRadians(e))}get imageAngleDegrees(){return j.toDegrees(C.get(this)._GetImageAngle())}get imageWidth(){return C.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return C.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const e=C.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}set enableTileRandomization(e){C.get(this)._SetTileRandomizationEnabled(!!e)}get enableTileRandomization(){return C.get(this)._IsTileRandomizationEnabled()}set tileXRandom(e){k.RequireFiniteNumber(e),C.get(this)._SetTileXRandom(e)}get tileXRandom(){return C.get(this)._GetTileXRandom()}set tileYRandom(e){k.RequireFiniteNumber(e),C.get(this)._SetTileYRandom(e)}get tileYRandom(){return C.get(this)._GetTileYRandom()}setTileRandom(e,t){k.RequireFiniteNumber(e),k.RequireFiniteNumber(t);const s=C.get(this);s._SetTileXRandom(e),s._SetTileYRandom(t)}getTileRandom(){const e=C.get(this);return[e._GetTileXRandom(),e._GetTileYRandom()]}set tileAngleRandom(e){k.RequireFiniteNumber(e),C.get(this)._SetTileAngleRandom(e)}get tileAngleRandom(){return C.get(this)._GetTileAngleRandom()}set tileBlendMarginX(e){k.RequireFiniteNumber(e),C.get(this)._SetTileBlendMarginX(e)}get tileBlendMarginX(){return C.get(this)._GetTileBlendMarginX()}set tileBlendMarginY(e){k.RequireFiniteNumber(e),C.get(this)._SetTileBlendMarginY(e)}get tileBlendMarginY(){return C.get(this)._GetTileBlendMarginY()}setTileBlendMargin(e,t){k.RequireFiniteNumber(e),k.RequireFiniteNumber(t);const s=C.get(this);s._SetTileBlendMarginX(e),s._SetTileBlendMarginY(t)}getTileBlendMargin(){const e=C.get(this);return[e._GetTileBlendMarginX(),e._GetTileBlendMarginY()]}async replaceImage(e){k.RequireInstanceOf(e,Blob);const t=C.get(this),s=t.GetRuntime(),n=j.New(j.ImageInfo);n.LoadDynamicBlobAsset(s,e),await n.LoadStaticTexture(s.GetRenderer(),{sampling:s.GetSampling(),wrapX:t.GetSdkType().GetWrapModeX(),wrapY:t.GetSdkType().GetWrapModeY()}),t.WasReleased()?n.Release():(t._ReleaseOwnImage(),t._ownImageInfo=n,s.UpdateRender())}}}{const o0=self.C3;o0.Plugins.TiledBg.Cnds={OnURLLoaded(){return!0},OnURLFailed(){return!0},IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled()}}}{const p0=self.C3;p0.Plugins.TiledBg.Acts={SetImageOffsetX(e){this._SetImageOffsetX(e)},SetImageOffsetY(e){this._SetImageOffsetY(e)},SetImageScaleX(e){this._SetImageScaleX(e/100)},SetImageScaleY(e){this._SetImageScaleY(e/100)},SetImageAngle(e){this._SetImageAngle(p0.toRadians(e))},SetTileRandomizationEnabled(e){this._SetTileRandomizationEnabled(e)},SetTilePosRandom(e,t){this._SetTileXRandom(e/100),this._SetTileYRandom(t/100)},SetTileAngleRandom(e){this._SetTileAngleRandom(e/100)},SetTileBlendMargin(e,t){this._SetTileBlendMarginX(e/100),this._SetTileBlendMarginY(t/100)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},async LoadURL(e,t){if(!this._ownImageInfo||this._ownImageInfo.GetURL()!==e){const s=this._runtime,n=p0.New(p0.ImageInfo);try{if(await n.LoadDynamicAsset(s,e),!n.IsLoaded())throw new Error("image failed to load");if(this.WasReleased())return n.Release(),null;const i=await n.LoadStaticTexture(s.GetRenderer(),{sampling:s.GetSampling(),wrapX:this.GetSdkType().GetWrapModeX(),wrapY:this.GetSdkType().GetWrapModeY()});if(!i)return}catch(e){return console.error("Load image from URL failed: ",e),void(this.WasReleased()||this.Trigger(p0.Plugins.TiledBg.Cnds.OnURLFailed))}this.WasReleased()?n.Release():(this._ReleaseOwnImage(),this._ownImageInfo=n,s.UpdateRender(),await this.TriggerAsync(p0.Plugins.TiledBg.Cnds.OnURLLoaded))}}}}{const I0=self.C3;I0.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return 100*this._imageScaleX},ImageScaleY(){return 100*this._imageScaleY},ImageAngle(){return I0.toDegrees(this._imageAngle)},TileXRandom(){return 100*this._GetTileXRandom()},TileYRandom(){return 100*this._GetTileYRandom()},TileAngleRandom(){return 100*this._GetTileAngleRandom()},TileBlendMarginX(){return 100*this._GetTileBlendMarginX()},TileBlendMarginY(){return 100*this._GetTileBlendMarginY()}}}{const a=self.C3,b="text-input";a.Plugins.TextBox=class extends a.SDKDOMPluginBase{constructor(e){super(e,b),this.AddElementMessageHandler("click",(e,t)=>e._OnClick(t)),this.AddElementMessageHandler("dblclick",(e,t)=>e._OnDoubleClick(t)),this.AddElementMessageHandler("change",(e,t)=>e._OnChange(t))}Release(){super.Release()}}}{const k=self.C3;k.Plugins.TextBox.Type=class extends k.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const n=self.C3,o=self.C3X,p=0,q=1,r=2,s=3,t=4,u=5,v=6,w=7,x=8,y=9,z=10,A="text-input",B=["text","password","email","number","tel","url","textarea","search"],C=(n.Plugins.TextBox.Instance=class extends n.SDKDOMInstanceBase{constructor(e,n){super(e,A),this._text="",this._placeholder="",this._title="",this._isEnabled=!0,this._isReadOnly=!1,this._spellCheck=!1,this._type="text",this._autoFontSize=!0,this._maxLength=-1,this._id="",this._className="",n&&(this._text=n[p],this._placeholder=n[q],this._title=n[r],this.GetWorldInfo().SetVisible(n[s]),this._isEnabled=n[t],this._isReadOnly=n[u],this._spellCheck=n[v],this._type=B[n[w]],this._autoFontSize=n[x],this._id=n[y],this._className=n[z]),this.CreateElement({type:this._type,id:this._id,className:this._className})}Release(){super.Release()}GetElementState(){return{text:this._text,placeholder:this._placeholder,title:this._title,isEnabled:this._isEnabled,isReadOnly:this._isReadOnly,spellCheck:this._spellCheck,maxLength:this._maxLength}}async _OnClick(e){this.DispatchScriptEvent("click",!0),await this.TriggerAsync(n.Plugins.TextBox.Cnds.OnClicked)}async _OnDoubleClick(e){this.DispatchScriptEvent("dblclick",!0),await this.TriggerAsync(n.Plugins.TextBox.Cnds.OnDoubleClicked)}async _OnChange(e){this._text=e.text,this.DispatchScriptEvent("change",!0),await this.TriggerAsync(n.Plugins.TextBox.Cnds.OnTextChanged)}_SetText(e){this._text!==e&&(this._text=e,this.UpdateElementState())}_GetText(){return this._text}_SetPlaceholder(e){this._placeholder!==e&&(this._placeholder=e,this.UpdateElementState())}_GetPlaceholder(){return this._placeholder}_SetTooltip(e){this._title!==e&&(this._title=e,this.UpdateElementState())}_GetTooltip(){return this._title}_SetEnabled(e){this._isEnabled!==(e=!!e)&&(this._isEnabled=e,this.UpdateElementState())}_IsEnabled(){return this._isEnabled}_SetReadOnly(e){this._isReadOnly!==(e=!!e)&&(this._isReadOnly=e,this.UpdateElementState())}_IsReadOnly(){return this._isReadOnly}_SetMaxLength(e){e=Math.max(+e,-1),this._maxLength!==e&&(this._maxLength=e,this.UpdateElementState())}_GetMaxLength(){return this._maxLength}_ScrollToBottom(){Promise.resolve().then(()=>this.PostToDOMElement("scroll-to-bottom"))}Draw(e){}SaveToJson(){return{t:this._text,p:this._placeholder,ti:this._title,e:this._isEnabled,r:this._isReadOnly,sp:this._spellCheck,ml:this._maxLength,type:this._type,id:this._id}}LoadFromJson(e){this._text=e.t,this._placeholder=e.p,this._title=e.ti,this._isEnabled=e.e,this._isReadOnly=e.r,this._spellCheck=e.sp,this._maxLength=e.hasOwnProperty("ml")?e.ml:-1,this._type=e.type,this._id=e.id,this.UpdateElementState()}GetPropertyValueByIndex(e){switch(e){case p:return this._text;case q:return this._placeholder;case r:return this._title;case t:return this._isEnabled;case u:return this._isReadOnly;case v:return this._spellCheck;case x:return this._autoFontSize}}SetPropertyValueByIndex(e,s){switch(e){case p:this._text!==s&&(this._text=s,this.UpdateElementState());break;case q:this._placeholder!==s&&(this._placeholder=s,this.UpdateElementState());break;case r:this._title!==s&&(this._title=s,this.UpdateElementState());break;case t:this._isEnabled!==!!s&&(this._isEnabled=!!s,this.UpdateElementState());break;case u:this._isReadOnly!==!!s&&(this._isReadOnly=!!s,this.UpdateElementState());break;case v:this._spellCheck!==!!s&&(this._spellCheck=!!s,this.UpdateElementState());break;case x:this._autoFontSize=!!s}}GetDebuggerProperties(){const t=n.Plugins.TextBox.Acts,e="plugins.textbox";return[{title:e+".name",properties:[{name:e+".properties.text.name",value:this._text,onedit:e=>this.CallAction(t.SetText,e)},{name:e+".properties.enabled.name",value:this._isEnabled,onedit:e=>this.CallAction(t.SetEnabled,e)},{name:e+".properties.read-only.name",value:this._isReadOnly,onedit:e=>this.CallAction(t.SetReadOnly,e)}]}]}GetScriptInterfaceClass(){return self.ITextInputInstance}},new WeakMap);self.ITextInputInstance=class extends self.IDOMInstance{constructor(){super(),C.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set text(e){o.RequireString(e),C.get(this)._SetText(e)}get text(){return C.get(this)._GetText()}set placeholder(e){o.RequireString(e),C.get(this)._SetPlaceholder(e)}get placeholder(){return C.get(this)._GetPlaceholder()}set tooltip(e){o.RequireString(e),C.get(this)._SetTooltip(e)}get tooltip(){return C.get(this)._GetTooltip()}set isEnabled(e){C.get(this)._SetEnabled(e)}get isEnabled(){return C.get(this)._IsEnabled()}set isReadOnly(e){C.get(this)._SetReadOnly(e)}get isReadOnly(){return C.get(this)._IsReadOnly()}set maxLength(e){o.RequireFiniteNumber(e),C.get(this)._SetMaxLength(e)}get maxLength(){return C.get(this)._GetMaxLength()}scrollToBottom(){C.get(this)._ScrollToBottom()}}}{const ea=self.C3;ea.Plugins.TextBox.Cnds={CompareText(e,t){return 0===t?ea.equalsNoCase(this._text,e):this._text===e},OnTextChanged(){return!0},OnClicked(){return!0},OnDoubleClicked(){return!0}}}{const ha=self.C3;ha.Plugins.TextBox.Acts={SetText(e){this._SetText(e.toString())},AppendText(e){""!==e&&this._SetText(this._GetText()+e)},SetPlaceholder(e){this._SetPlaceholder(e)},SetTooltip(e){this._SetTooltip(e)},SetReadOnly(e){this._SetReadOnly(0===e)},ScrollToBottom(){this._ScrollToBottom()},SetMaxLength(e){this._SetMaxLength(e)}}}{const oa=self.C3;oa.Plugins.TextBox.Exps={Text(){return this._GetText()},MaxLength(){return this._GetMaxLength()}}}{const a=self.C3,b=[];a.Plugins.Audio=class extends a.SDKPluginBase{constructor(e){super(e)}_AddActionPromise(e){b.push(e)}static async WaitForAllActionPromises(){await Promise.all(b),a.clearArray(b)}Release(){super.Release()}}}{let GetAudioSdkInstance2=function(){return e.GetSingleGlobalInstance().GetSdkInstance()},GetAudioDOMInterface2=function(){if(self.C3Audio_DOMInterface)return self.C3Audio_DOMInterface;throw new Error("audio scripting API cannot be used here - make sure the project is using DOM mode, not worker mode")};GetAudioSdkInstance=GetAudioSdkInstance2,GetAudioDOMInterface=GetAudioDOMInterface2;const f=self.C3,g=self.C3X;f.Plugins.Audio.Type=class extends f.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IAudioObjectType}};let e=null;self.IAudioObjectType=class extends self.IObjectClass{constructor(t){super(t),e=t}get audioContext(){return GetAudioDOMInterface2().GetAudioContextExtern()}get destinationNode(){return GetAudioDOMInterface2().GetDestinationNodeExtern()}get isSilent(){return GetAudioSdkInstance2()._IsSilent()}set isSilent(e){GetAudioSdkInstance2()._SetSilent(e)}get masterVolume(){return GetAudioSdkInstance2()._GetMasterVolume()}set masterVolume(e){g.RequireFiniteNumber(e),GetAudioSdkInstance2()._SetMasterVolume(e)}stopAll(){GetAudioSdkInstance2()._StopAll()}}}{const o=self.C3,p="audio",q=["interactive","balanced","playback"];o.Plugins.Audio.Instance=class extends o.SDKInstanceBase{constructor(e,t){super(e,p),this._nextPlayTime=0,this._triggerTags=[],this._enableMultiTags=!0,this._timeScaleMode=0,this._saveLoadMode=0,this._playInBackground=!1,this._panningModel=1,this._distanceModel=1,this._listenerPos=[this._runtime.GetViewportWidth()/2,this._runtime.GetViewportHeight()/2,600],this._listenerForwardVec=[0,0,-1],this._listenerUpVec=[0,1,0],this._referenceDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._listenerInst=null,this._loadListenerUid=-1,this._masterVolume=1,this._isSilent=!1,this._sampleRate=0,this._audioContextState="suspended",this._outputLatency=0,this._effectCount=new Map,this._preloadTotal=0,this._preloadCount=0,this._bufferMetadata=new Map,this._remoteUrls=new Map;let s="interactive";t&&(this._timeScaleMode=t[0],this._saveLoadMode=t[1],this._playInBackground=t[2],s=q[t[3]],this._enableMultiTags=t[4],this._panningModel=t[5],this._distanceModel=t[6],this._listenerPos[2]=t[7],this._referenceDistance=t[8],this._maxDistance=t[9],this._rolloffFactor=t[10]),this._lastAIState=[],this._lastFxState=[],this._lastAnalysersData=[],this.AddDOMMessageHandlers([["state",e=>this._OnUpdateState(e)],["audiocontext-state",e=>this._OnAudioContextStateChanged(e)],["fxstate",e=>this._OnUpdateFxState(e)],["trigger",e=>this._OnTrigger(e)],["buffer-metadata",e=>this._OnBufferMetadata(e)]]);const n=this.GetRuntime().Dispatcher(),i=(this._disposables=new o.CompositeDisposable(o.Disposable.From(n,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),o.Disposable.From(n,"afterload",()=>this._OnAfterLoad()),o.Disposable.From(n,"suspend",()=>this._OnSuspend()),o.Disposable.From(n,"resume",()=>this._OnResume())),"Safari"===o.Platform.Browser),r=this._runtime.IsiOSWebView(),a=this._runtime.GetAssetManager().IsFileProtocol(),l="playable-ad-single-file"===this._runtime.GetExportType(),h=i||r||a||l;this._runtime.AddLoadPromise(this.PostToDOMAsync("create-audio-context",{preloadList:this._runtime.GetAssetManager().GetAudioToPreload().map(e=>({originalUrl:e.originalUrl,url:e.url,type:e.type,fileSize:e.fileSize})),timeScaleMode:this._timeScaleMode,latencyHint:s,panningModel:this._panningModel,distanceModel:this._distanceModel,refDistance:this._referenceDistance,maxDistance:this._maxDistance,rolloffFactor:this._rolloffFactor,listenerPos:this._listenerPos,usePlayMusicAsSoundWorkaround:h}).then(e=>{this._sampleRate=e.sampleRate,this._audioContextState=e.audioContextState,this._outputLatency=e.outputLatency})),this._StartTicking()}Release(){this._listenerInst=null,super.Release()}_SplitTags(e){return this._enableMultiTags?e.split(" ").filter(e=>!!e):e?[e]:[]}_MatchTagLists(t,e){for(const s of e){let e=!1;for(const n of t)if(o.equalsNoCase(n,s)){e=!0;break}if(!e)return!1}return!0}_MatchTagListToStr(e,t){return this._MatchTagLists(e,this._SplitTags(t))}_AddActionPromise(e){this.GetPlugin()._AddActionPromise(e)}_OnInstanceDestroyed(e){this._listenerInst===e&&(this._listenerInst=null)}DbToLinearNoCap(e){return Math.pow(10,e/20)}DbToLinear(e){const t=this.DbToLinearNoCap(e);return isFinite(t)?Math.max(Math.min(t,1),0):0}LinearToDbNoCap(e){return Math.log(e)/Math.log(10)*20}LinearToDb(e){return this.LinearToDbNoCap(Math.max(Math.min(e,1),0))}_OnSuspend(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!0})}_OnResume(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!1})}_OnUpdateState(e){const t=e.tickCount,s=(this._outputLatency=e.outputLatency,this._lastAIState.filter(e=>e.hasOwnProperty("placeholder")&&(e.placeholder>t||-1===e.placeholder)));this._lastAIState=e.audioInstances,this._lastAnalysersData=e.analysers,0<s.length&&o.appendArray(this._lastAIState,s)}_OnBufferMetadata(e){this._bufferMetadata.set(e.originalUrl,{duration:e.duration})}_OnAudioContextStateChanged(e){this._audioContextState=e.audioContextState}GetAudioContextState(){return this._runtime.IsExportToVideo()?"running":this._audioContextState}_OnUpdateFxState(e){this._lastFxState=e.fxstate}_GetFirstAudioStateByTags(e){const t=this._SplitTags(e);for(const s of this._lastAIState)if(this._MatchTagLists(s.tags,t))return s;return null}_IsTagPlaying(e){const t=this._SplitTags(e);return this._lastAIState.some(e=>this._MatchTagLists(e.tags,t)&&e.isPlaying)}_MaybeMarkAsPlaying(e,t,s,n,i){if(this._IsTagPlaying(t))return null;const r=this._bufferMetadata.get(e),a={tags:this._SplitTags(t),duration:r?r.duration:0,volume:i,isPlaying:!0,playbackTime:0,playbackRate:1,uid:-1,bufferOriginalUrl:e,bufferUrl:"",bufferType:"",isMusic:s,isLooping:n,isMuted:!1,resumePosition:0,pan:null,placeholder:-1};return this._lastAIState.push(a),a}_MaybeMarkAsStopped(e){const t=this._SplitTags(e);for(const s of this._lastAIState)this._MatchTagLists(s.tags,t)&&(s.isPlaying=!1)}async _OnTrigger(e){const t=e.type,s=(this._triggerTags=e.tags,e.aiid);if("ended"===t){for(const n of this._lastAIState)if(n.aiid===s){n.isPlaying=!1;break}await this.TriggerAsync(o.Plugins.Audio.Cnds.OnEnded)}else"fade-ended"===t&&await this.TriggerAsync(o.Plugins.Audio.Cnds.OnFadeEnded)}_MatchTriggerTag(e){return this._MatchTagListToStr(this._triggerTags,e)}Tick(){const e={timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),instPans:this.GetInstancePans(),tickCount:this._runtime.GetTickCountNoSave()};if(this._listenerInst){const t=this._listenerInst.GetWorldInfo();this._listenerPos[0]=t.GetX(),this._listenerPos[1]=t.GetY(),e.listenerPos=this._listenerPos,e.listenerOrientation=[...this._listenerForwardVec,...this._listenerUpVec]}this.PostToDOM("tick",e)}rotatePtAround(e,t,s,n,i){if(0!==s){const r=Math.sin(s),a=Math.cos(s),o=(e-=n)*r,l=(t-=i)*r,h=e*a,c=t*a;e=h-l,t=c+o,e+=n,t+=i}return[e,t]}GetInstancePans(){return this._lastAIState.filter(e=>-1!==e.uid).map(e=>this._runtime.GetInstanceByUID(e.uid)).filter(e=>e).map(e=>{const t=e.GetWorldInfo(),s=t.GetLayer().GetAngle(),[n,i]=this.rotatePtAround(t.GetX(),t.GetY(),-s,this._listenerPos[0],this._listenerPos[1]);return{uid:e.GetUID(),x:n,y:i,z:t.GetTotalZElevation(),angle:t.GetAngle()-s}})}GetAnalyserData(e,t){for(const s of this._lastAnalysersData)if(s.index===t&&o.equalsNoCase(s.tag,e))return s;return null}_IncrementEffectCount(e){for(const t of this._SplitTags(e)){const s=t.toLowerCase();this._effectCount.set(s,(this._effectCount.get(s)||0)+1)}}_IsSilent(){return this._isSilent}_SetSilent(e){this._isSilent!==(e=!!e)&&(this._isSilent=e,this.PostToDOM("set-silent",{isSilent:e}))}_GetMasterVolume(){return this._masterVolume}_SetMasterVolume(e){this._masterVolume!==e&&(this._masterVolume=e,this.PostToDOM("set-master-volume",{vol:e}))}_StopAll(){this.PostToDOM("stop-all");for(const e of this._lastAIState)e.isPlaying=!1}_ShouldSave(e){return!e.hasOwnProperty("placeholder")&&3!==this._saveLoadMode&&!(e.isMusic&&1===this._saveLoadMode||!e.isMusic&&2===this._saveLoadMode)}SaveToJson(){return{isSilent:this._isSilent,masterVolume:this._masterVolume,listenerZ:this._listenerPos[2],listenerForwardVec:this._listenerForwardVec,listenerUpVec:this._listenerUpVec,listenerUid:this._listenerInst?this._listenerInst.GetUID():-1,remoteUrls:[...this._remoteUrls.entries()],playing:this._lastAIState.filter(e=>this._ShouldSave(e)),effects:this._lastFxState,analysers:this._lastAnalysersData}}LoadFromJson(e){if(this._isSilent=e.isSilent,this._masterVolume=e.masterVolume,this._listenerPos[2]=e.listenerZ,this._listenerInst=null,this._loadListenerUid=e.listenerUid,e.hasOwnProperty("listenerForwardVec")?this._listenerForwardVec=e.listenerForwardVec:this._listenerForwardVec=[0,0,-1],e.hasOwnProperty("listenerUpVec")?this._listenerUpVec=e.listenerUpVec:this._listenerUpVec=[0,1,0],this._remoteUrls.clear(),e.remoteUrls)for(const[t,s]of e.remoteUrls)this._remoteUrls.set(t,s);this._lastAIState=e.playing;for(const n of this._lastAIState)n.hasOwnProperty("tag")&&!n.hasOwnProperty("tags")&&(n.tags=[n.tag].filter(e=>!!e));this._lastFxState=e.effects,this._lastAnalysersData=e.analysers}_OnAfterLoad(){if(-1!==this._loadListenerUid&&(this._listenerInst=this._runtime.GetInstanceByUID(this._loadListenerUid),this._loadListenerUid=-1,this._listenerInst)){const e=this._listenerInst.GetWorldInfo();this._listenerPos[0]=e.GetX(),this._listenerPos[1]=e.GetY()}for(const t of this._lastAIState){const s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t.bufferOriginalUrl);s?(t.bufferUrl=s.url,t.bufferType=s.type):t.bufferUrl=null}for(const n of Object.values(this._lastFxState))for(const i of n)if(i.hasOwnProperty("bufferOriginalUrl")){const r=this._runtime.GetAssetManager().GetProjectAudioFileUrl(i.bufferOriginalUrl);r&&(i.bufferUrl=r.url,i.bufferType=r.type)}this.PostToDOM("load-state",{saveLoadMode:this._saveLoadMode,timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),listenerPos:this._listenerPos,listenerOrientation:[...this._listenerForwardVec,...this._listenerUpVec],isSilent:this._isSilent,masterVolume:this._masterVolume,playing:this._lastAIState.filter(e=>null!==e.bufferUrl),effects:this._lastFxState})}GetDebuggerProperties(){const e=[];for(const[s,n]of Object.entries(this._lastFxState))e.push({name:"$"+s,value:n.map(e=>e.type).join(", ")});const t="plugins.audio.debugger";return[{title:t+".tag-effects",properties:e},{title:t+".currently-playing",properties:[{name:t+".currently-playing-count",value:this._lastAIState.length},...this._lastAIState.map((e,t)=>({name:"$#"+t,value:`${e.bufferOriginalUrl} ("${e.tags}") ${Math.round(10*e.playbackTime)/10} / `+Math.round(10*e.duration)/10}))]}]}}}{const w0=self.C3;w0.Plugins.Audio.Cnds={OnEnded(e){return this._MatchTriggerTag(e)},OnFadeEnded(e){return this._MatchTriggerTag(e)},PreloadsComplete(){return this._preloadCount===this._preloadTotal},AdvancedAudioSupported(){return!0},IsSilent(){return this._IsSilent()},IsAnyPlaying(){for(const e of this._lastAIState)if(e.isPlaying)return!0;return!1},IsTagPlaying(e){return this._IsTagPlaying(e)}}}{const B0=self.C3,C0=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];B0.Plugins.Audio.Acts={Play(e,t,s,n,i){const r=B0.Plugins.Audio.Acts._DoPlay.call(this,e,t,s,n,i);return this._AddActionPromise(r),r},PlayFromTimeline(e,t,s,n){B0.Plugins.Audio.Acts._DoPlay.call(this,e,0,t,0,s,n)},async _DoPlay(e,t,s,n,i,r){if(!this._isSilent){const a=e[1],o=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(o){const l=this._nextPlayTime,h=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(e[0],i,a,0!==t,this.DbToLinear(s)));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:o.url,type:o.type,isMusic:a,tags:this._SplitTags(i),isLooping:0!==t,vol:this.DbToLinear(s),stereoPan:B0.clamp(n/100,-1,1),pos:r||0,off:l,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{h&&(h.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPosition(e,t,s,n,i,r,a,o,l,h,c){if(!this._isSilent){const u=e[1],d=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(d){const _=this._nextPlayTime,p=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(e[0],c,u,0!==t,this.DbToLinear(s)));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:d.url,type:d.type,isMusic:u,tags:this._SplitTags(c),isLooping:0!==t,vol:this.DbToLinear(s),pos:0,off:_,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:n,y:i,z:r,angle:B0.toRadians(a),innerAngle:B0.toRadians(o),outerAngle:B0.toRadians(l),outerGain:this.DbToLinear(h)}})}finally{p&&(p.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObject(e,t,s,n,i,r,a,o){if(!this._isSilent&&n){const l=n.GetFirstPicked();if(l&&l.GetWorldInfo()){const h=l.GetWorldInfo(),c=h.GetLayer().GetAngle(),[u,d]=this.rotatePtAround(h.GetX(),h.GetY(),-c,this._listenerPos[0],this._listenerPos[1]),_=e[1],p=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(p){const m=this._nextPlayTime,g=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(e[0],o,_,0!==t,this.DbToLinear(s)));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:p.url,type:p.type,isMusic:_,tags:this._SplitTags(o),isLooping:0!==t,vol:this.DbToLinear(s),pos:0,off:m,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:u,y:d,z:h.GetTotalZElevation(),angle:h.GetAngle()-c,innerAngle:B0.toRadians(i),outerAngle:B0.toRadians(r),outerGain:this.DbToLinear(a),uid:l.GetUID()}})}finally{g&&(g.placeholder=this._runtime.GetTickCountNoSave())}}}}},async PlayByName(e,t,s,n,i,r){if(!this._isSilent){const a=1===e,o=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(o){const l=this._nextPlayTime,h=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(t,r,a,0!==s,this.DbToLinear(n)));try{await this.PostToDOMAsync("play",{originalUrl:t,url:o.url,type:o.type,isMusic:a,tags:this._SplitTags(r),isLooping:0!==s,vol:this.DbToLinear(n),stereoPan:B0.clamp(i/100,-1,1),pos:0,off:l,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{h&&(h.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPositionByName(e,t,s,n,i,r,a,o,l,h,c,u){if(!this._isSilent){const d=1===e,_=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(_){const p=this._nextPlayTime,m=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(t,u,d,0!==s,this.DbToLinear(n)));try{await this.PostToDOMAsync("play",{originalUrl:t,url:_.url,type:_.type,isMusic:d,tags:this._SplitTags(u),isLooping:0!==s,vol:this.DbToLinear(n),pos:0,off:p,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:i,y:r,z:a,angle:B0.toRadians(o),innerAngle:B0.toRadians(l),outerAngle:B0.toRadians(h),outerGain:this.DbToLinear(c)}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObjectByName(e,t,s,n,i,r,a,o,l){if(!this._isSilent&&!this._isSilent&&i){const h=i.GetFirstPicked();if(h&&h.GetWorldInfo()){const c=h.GetWorldInfo(),u=c.GetLayer().GetAngle(),[d,_]=this.rotatePtAround(c.GetX(),c.GetY(),-u,this._listenerPos[0],this._listenerPos[1]),p=1===e,m=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(m){const g=this._nextPlayTime,f=(this._nextPlayTime=0,this._MaybeMarkAsPlaying(t,l,p,0!==s,this.DbToLinear(n)));try{await this.PostToDOMAsync("play",{originalUrl:t,url:m.url,type:m.type,isMusic:p,tags:this._SplitTags(l),isLooping:0!==s,vol:this.DbToLinear(n),pos:0,off:g,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:d,y:_,z:c.GetTotalZElevation(),angle:c.GetAngle()-u,innerAngle:B0.toRadians(r),outerAngle:B0.toRadians(a),outerGain:this.DbToLinear(o),uid:h.GetUID()}})}finally{f&&(f.placeholder=this._runtime.GetTickCountNoSave())}}}}},SetLooping(e,t){this.PostToDOM("set-looping",{tags:this._SplitTags(e),isLooping:0===t})},SetMuted(e,t){this.PostToDOM("set-muted",{tags:this._SplitTags(e),isMuted:0===t})},SetVolume(e,t){this.PostToDOM("set-volume",{tags:this._SplitTags(e),vol:this.DbToLinear(t)})},FadeVolume(e,t,s,n){this.PostToDOM("fade-volume",{tags:this._SplitTags(e),vol:this.DbToLinear(t),duration:s,stopOnEnd:0===n})},SetStereoPan(e,t){this.PostToDOM("set-stereo-pan",{tags:this._SplitTags(e),p:B0.clamp(t/100,-1,1)})},async Preload(e){const t=e[1],s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);s&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:e[0],url:s.url,type:s.type,isMusic:t}),this._preloadCount++)},async PreloadByName(e,t){const s=1===e,n=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());n&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:t,url:n.url,type:n.type,isMusic:s}),this._preloadCount++)},SetPlaybackRate(e,t){this.PostToDOM("set-playback-rate",{tags:this._SplitTags(e),rate:Math.max(t,0)})},Stop(e){this._MaybeMarkAsStopped(e),this.PostToDOM("stop",{tags:this._SplitTags(e)})},StopAll(){this._StopAll()},SetPaused(e,t){this.PostToDOM("set-paused",{tags:this._SplitTags(e),paused:0===t})},Seek(e,t){this.PostToDOM("seek",{tags:this._SplitTags(e),pos:t})},SetSilent(e){2===e&&(e=this._IsSilent()?1:0),this._SetSilent(0===e)},SetMasterVolume(e){const t=this.DbToLinear(e);this._SetMasterVolume(t)},AddFilterEffect(e,t,s,n,i,r,a){const o=C0[t];this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"filter",tags:this._SplitTags(e),params:[o,s,n,i,r,B0.clamp(a/100,0,1)]})},AddDelayEffect(e,t,s,n){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"delay",tags:this._SplitTags(e),params:[t,this.DbToLinear(s),B0.clamp(n/100,0,1)]})},AddFlangerEffect(e,t,s,n,i,r){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"flanger",tags:this._SplitTags(e),params:[t/1e3,s/1e3,n,i/100,B0.clamp(r/100,0,1)]})},AddPhaserEffect(e,t,s,n,i,r,a){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"phaser",tags:this._SplitTags(e),params:[t,s,n,i,r,B0.clamp(a/100,0,1)]})},AddConvolutionEffect(e,t,s,n){const i=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);i&&(this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"convolution",tags:this._SplitTags(e),bufferOriginalUrl:t[0],bufferUrl:i.url,bufferType:i.type,params:[0===s,B0.clamp(n/100,0,1)]}))},AddGainEffect(e,t){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tags:this._SplitTags(e),params:[this.DbToLinear(t)]})},AddStereoPanEffect(e,t){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"stereopan",tags:this._SplitTags(e),params:[B0.clamp(t/100,-1,1)]})},AddMuteEffect(e){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tags:this._SplitTags(e),params:[0]})},AddTremoloEffect(e,t,s){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"tremolo",tags:this._SplitTags(e),params:[t,B0.clamp(s/100,0,1)]})},AddRingModEffect(e,t,s){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"ringmod",tags:this._SplitTags(e),params:[t,B0.clamp(s/100,0,1)]})},AddDistortionEffect(e,t,s,n,i,r){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"distortion",tags:this._SplitTags(e),params:[this.DbToLinearNoCap(t),this.DbToLinearNoCap(s),n,this.DbToLinearNoCap(i),B0.clamp(r/100,0,1)]})},AddCompressorEffect(e,t,s,n,i,r){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"compressor",tags:this._SplitTags(e),params:[t,s,n,i/1e3,r/1e3]})},AddAnalyserEffect(e,t,s){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"analyser",tags:this._SplitTags(e),params:[t,s]})},RemoveEffects(e){const t=this._SplitTags(e);for(const s of t)this._effectCount.set(s.toLowerCase(),0);this.PostToDOM("remove-effects",{tags:t}),this._lastFxState={}},SetEffectParameter(e,t,s,n,i,r){this.PostToDOM("set-effect-param",{tags:this._SplitTags(e),index:Math.floor(t),param:s,value:n,ramp:i,time:r})},SetListenerObject(e){if(e){const t=e.GetFirstPicked();t&&t.GetWorldInfo()&&(this._listenerInst=t)}},SetListenerZ(e){this._listenerPos[2]=e},SetListenerOrientation(e,t,s,n,i,r){this._listenerForwardVec[0]=e,this._listenerForwardVec[1]=t,this._listenerForwardVec[2]=-s,this._listenerUpVec[0]=n,this._listenerUpVec[1]=i,this._listenerUpVec[2]=-r},ScheduleNextPlay(e){this._nextPlayTime=Math.max(e,0)},UnloadAudio(e){const t=e[1],s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);s&&this.PostToDOM("unload",{url:s.url,type:s.type,isMusic:t})},UnloadAudioByName(e,t){const s=1===e,n=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());n&&this.PostToDOM("unload",{url:n.url,type:n.type,isMusic:s})},UnloadAll(){this.PostToDOM("unload-all")},AddRemoteURL(e,t,s){this._remoteUrls.set(s.toLowerCase(),{url:e,type:t})}}}{const x2=self.C3;x2.Plugins.Audio.Exps={Duration(e){const t=this._GetFirstAudioStateByTags(e);return t?t.duration:0},PlaybackTime(e){const t=this._GetFirstAudioStateByTags(e);return t?t.playbackTime:0},PlaybackRate(e){const t=this._GetFirstAudioStateByTags(e);return t?t.playbackRate:0},Volume(e){const t=this._GetFirstAudioStateByTags(e);return t?this.LinearToDb(t.volume):0},MasterVolume(){return this.LinearToDb(this._GetMasterVolume())},EffectCount(e){return this._effectCount.get(e.toLowerCase())||0},AnalyserFreqBinCount(e,t){const s=this.GetAnalyserData(e,Math.floor(t));return s?s.binCount:0},AnalyserFreqBinAt(e,t,s){const n=this.GetAnalyserData(e,Math.floor(t));return!n||(s=Math.floor(s))<0||s>=n.binCount?0:n.freqBins[s]},AnalyserPeakLevel(e,t){const s=this.GetAnalyserData(e,Math.floor(t));return s?s.peak:0},AnalyserRMSLevel(e,t){const s=this.GetAnalyserData(e,Math.floor(t));return s?s.rms:0},SampleRate(){return this._sampleRate},CurrentTime(){return self.C3_GetAudioContextCurrentTime?self.C3_GetAudioContextCurrentTime():performance.now()/1e3},OutputLatency(){return this._outputLatency},NormalizedVolume(e,t){return 0==(e=x2.clamp(+e,0,100)/100)?-1/0:e<.1?this.LinearToDb(x2.lerp(0,this.DbToLinear(t),10*e)):x2.lerp(t,0,(e-.1)/.9)}}}{const a=self.C3;a.Plugins.Particles=class extends a.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Plugins.Particles.Type=class extends d.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{let GetParticleEngine2=function(e){return H.get(e).GetParticleEngine()};GetParticleEngine=GetParticleEngine2;const h=self.C3,i=self.C3X,j=0,k=1,l=2,m=3,n=4,o=5,p=6,q=7,r=8,s=9,t=10,u=11,v=12,w=13,x=14,y=15,z=16,A=17,B=18,C=19,D=20,E=0,F=1,G=h.New(h.Rect),H=(h.Plugins.Particles.Instance=class extends h.SDKWorldInstanceBase{constructor(e,i){super(e),this._isFirstTick=!0;const a=h.New(self.ParticleEngine);(this._particleEngine=a).ononeshotfinish=()=>this._OnOneShotFinish(),this._spawnObjectClass=null,this._particleUpdateCallback=(e,t,s,n,i,r)=>this._OnParticleUpdate(e,t,s,n,i,r),this._particleDestroyCallback=e=>this._OnParticleDestroy(e);let c=this._hasAnyDefaultParticle=!0;i&&(a.SetRate(i[j]),a.SetSprayCone(h.toRadians(i[k])),a.SetSprayType(i[l]?"one-shot":"continuous-spray"),this._SetParticleObjectClass(this._runtime.GetObjectClassBySID(i[m])),c=i[n],a.SetInitSpeed(i[o]),a.SetInitSize(i[p]),a.SetInitOpacity(i[q]/100),a.SetGrowRate(i[r]),a.SetInitXRandom(i[s]),a.SetInitYRandom(i[t]),a.SetInitSpeedRandom(i[u]),a.SetInitSizeRandom(i[v]),a.SetGrowRandom(i[w]),a.SetAcceleration(i[x]),a.SetGravity(i[y]),a.SetLifeAngleRandom(i[z]),a.SetLifeSpeedRandom(i[A]),a.SetLifeOpacityRandom(i[B]),a.SetDestroyModeIndex(i[C]),a.SetTimeout(i[D])),this._UpdateEngineParameters(),this._spawnObjectClass&&(this._hasAnyDefaultParticle=!1),"one-shot"===a.GetSprayType()?a.CreateOneShotSpray():a.SetSpraying(!0);const d=this.GetWorldInfo();d.SetVisible(c),d.SetBboxChangeEventEnabled(!0),this._inst.Dispatcher().addEventListener("bboxchange",()=>{d.OverwriteBoundingBox(this._particleEngine.GetBoundingBox())}),this.GetRuntime().GetRenderer().IsWebGPU()&&d.SetUsePointsShaderProgram(),this._afterLoad=e=>this._OnAfterLoad(e),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad),this._StartTicking()}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._particleEngine.Release(),this._particleEngine=null,this._particleUpdateCallback=null,this._particleDestroyCallback=null,super.Release()}GetParticleEngine(){return this._particleEngine}_SetRate(e){this._particleEngine.SetRate(e),"one-shot"===this._particleEngine.GetSprayType()&&this._isFirstTick&&this._particleEngine.SetParticleCount(e)}_SetParticleObjectClass(e){(e=e===this.GetObjectClass()?null:e)===this._spawnObjectClass||(this._spawnObjectClass=e,this._particleEngine.onparticlecreate=e?e=>this._OnParticleCreate(e):null,this._spawnObjectClass)||(this._hasAnyDefaultParticle=!0)}_UpdateEngineParameters(){const e=this._particleEngine,t=this.GetWorldInfo();e.SetMasterOpacity(t.GetOpacity()),e.SetPixelRounding(this._runtime.IsPixelRoundingEnabled()),e.SetSpawnX(t.GetX()),e.SetSpawnY(t.GetY()),e.SetSpawnAngle(t.GetAngle()),e.SetInitSizeScale(Math.abs(t.GetSceneGraphScale()))}_OnOneShotFinish(){this._runtime.DestroyInstance(this._inst)}Draw(e){if(this._hasAnyDefaultParticle){const t=this._objectClass.GetImageInfo(),s=t.GetTexture();if(s){const n=this.GetWorldInfo(),i=n.GetLayer(),r=G,a=(this._runtime.GetCanvasManager().IsPastingToDrawingCanvas()?r.set(-1/0,-1/0,1/0,1/0):i.Has3DCamera()?i.CalculateViewport3D(n.GetTotalZElevation(),r):i.GetViewportForZ(n.GetTotalZElevation(),r),e.SetTexture(s),i.Get2DScaleFactorToZ(n.GetTotalZElevation()));this._particleEngine.SetParticleScale(i.GetRenderScale()*a),this._particleEngine.Draw(e,t.GetTexQuad(),r,i.Has3DCamera())}}}SaveToJson(){const e=this._particleEngine;return{r:e.GetRate(),sc:e.GetSprayCone(),st:e.GetSprayType(),isp:e.GetInitSpeed(),isz:e.GetInitSize(),io:e.GetInitOpacity(),gr:e.GetGrowRate(),xr:e.GetInitXRandom(),yr:e.GetInitYRandom(),spr:e.GetInitSpeedRandom(),szr:e.GetInitSizeRandom(),grnd:e.GetGrowRandom(),acc:e.GetAcceleration(),g:e.GetGravity(),lar:e.GetLifeAngleRandom(),lsr:e.GetLifeSpeedRandom(),lor:e.GetLifeOpacityRandom(),dm:e.GetDestroyModeIndex(),to:e.GetTimeout(),s:e.IsSpraying(),pcc:e._GetCreateCounter(),ft:this._isFirstTick,soc:this._spawnObjectClass?this._spawnObjectClass.GetSID():null,p:e.GetParticles().map(e=>e.toJSON())}}LoadFromJson(e,t){const s=this._particleEngine;if(s.SetRate(e.r),s.SetSprayCone(e.sc),s.SetSprayType(e.st),s.SetInitSpeed(e.isp),s.SetInitSize(e.isz),s.SetInitOpacity(e.io),s.SetGrowRate(e.gr),s.SetInitXRandom(e.xr),s.SetInitYRandom(e.yr),s.SetInitSpeedRandom(e.spr),s.SetInitSizeRandom(e.szr),s.SetGrowRandom(e.grnd),s.SetAcceleration(e.acc),s.SetGravity(e.g),s.SetLifeAngleRandom(e.lar),s.SetLifeSpeedRandom(e.lsr),s.SetLifeOpacityRandom(e.lor),s.SetDestroyModeIndex(e.dm),s.SetTimeout(e.to),s.SetSpraying(e.s),s._SetCreateCounter(e.pcc),this._isFirstTick=e.ft,e.hasOwnProperty("soc")){const r=this.GetRuntime().GetObjectClassBySID(e.soc);r&&this._SetParticleObjectClass(r)}const n=e.p,i=(s.SetParticleCount(n.length,!1),s.GetParticles());for(let e=0,t=i.length;e<t;++e)i[e].setFromJSON(n[e]);"state"===t&&this._spawnObjectClass&&(s.UpdateAllParticlesUserData(),s.ApplyParticleDataToUserData(this))}_OnAfterLoad(){const e=this._particleEngine,s=(e.UpdateAllParticlesUserData(),e.ApplyParticleDataToUserData(this),e.GetParticles());for(let e=0,t=s.length;e<t;++e){const n=s[e],i=n.GetUserData();if(i){const r=i.GetWorldInfo();if(r){const a=r.GetInstance();if(a){const o=n.GetUserDataUID(),l=a.GetUID();if(("number"!=typeof o||"number"!=typeof l||o!==l)&&"number"==typeof o){const h=this.GetRuntime(),c=h.GetInstanceByUID(o);c&&h.DestroyInstance(c)}}}}}}Tick(){const e=this._runtime.GetDt(this._inst);this._UpdateEngineParameters(),this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles(),this._particleEngine.Tick(e),this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_FastForward(e){for(this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles();0<e;)this._particleEngine.Tick(1/60),e-=1/60;this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_OnParticleCreate(e,t){let s,n=(s=(s=(s="number"==typeof t?this._runtime.GetInstanceByUID(t):s)&&s.GetObjectClass()!==this._spawnObjectClass?null:s)||this._runtime.CreateInstance(this._spawnObjectClass,this.GetWorldInfo().GetLayer(),e.GetX(),e.GetY())).GetWorldInfo();return n.SetSize(e.GetSize(),e.GetSize()),n.SetAngle(e.GetAngle()),n.SetOpacity(e.GetOpacity()),n.SetUnpremultipliedColor(this.GetWorldInfo().GetUnpremultipliedColor()),n.SetBboxChanged(),n.ZOrderMoveAdjacentToInstance(this.GetInstance(),!0),s._TriggerOnCreated(),e.SetUpdateCallback(this._particleUpdateCallback),e.SetDestroyCallback(this._particleDestroyCallback),s}_OnParticleUpdate(e,t,s,n,i,r){if(!e.IsDestroyed()){const a=e.GetWorldInfo();a.OffsetXY(t,s),a.SetSize(a.GetWidth()+n,a.GetHeight()+n),a.SetAngle(a.GetAngle()+i),a.SetOpacity(a.GetOpacity()+r),a.SetBboxChanged()}}_OnParticleDestroy(e){e.IsDestroyed()||this._runtime.DestroyInstance(e)}GetPropertyValueByIndex(e){const n=this._particleEngine;switch(e){case j:return n.GetRate();case k:return h.toDegrees(n.GetSprayCone());case l:return"one-shot"===n.GetSprayType()?F:E;case o:return n.GetInitSpeed();case p:return n.GetInitSize();case q:return 100*n.GetInitOpacity();case r:return n.GetGrowRate();case s:return n.GetInitXRandom();case t:return n.GetInitYRandom();case u:return n.GetInitSpeedRandom();case v:return n.GetInitSizeRandom();case w:return n.GetGrowRandom();case x:return n.GetAcceleration();case y:return n.GetGravity();case z:return n.GetLifeAngleRandom();case A:return n.GetLifeSpeedRandom();case B:return n.GetLifeOpacityRandom();case C:return n.GetDestroyModeIndex();case D:return n.GetTimeout()}}SetPropertyValueByIndex(e,n){const i=this._particleEngine;switch(e){case j:i.SetRate(n);break;case k:i.SetSprayCone(h.toRadians(n));break;case l:i.SetSprayType(n?"one-shot":"continuous-spray");break;case o:i.SetInitSpeed(n);break;case p:i.SetInitSize(n);break;case q:i.SetInitOpacity(n/100);break;case r:i.SetGrowRate(n);break;case s:i.SetInitXRandom(n);break;case t:i.SetInitYRandom(n);break;case u:i.SetInitSpeedRandom(n);break;case v:i.SetInitSizeRandom(n);break;case w:i.SetGrowRandom(n);break;case x:i.SetAcceleration(n);break;case y:i.SetGravity(n);break;case z:i.SetLifeAngleRandom(n);break;case A:i.SetLifeSpeedRandom(n);break;case B:i.SetLifeOpacityRandom(n);break;case C:i.SetDestroyModeIndex(n);break;case D:i.SetTimeout(n)}}GetDebuggerProperties(){const e="plugins.particles",t=e+".properties",s=e+".debugger",n=this._particleEngine;return[{title:e+".name",properties:[{name:s+".particle-count",value:n.GetParticleCount()},{name:t+".type.name",value:[t+".type.items."+n.GetSprayType()]},{name:s+".is-spraying",value:n.IsSpraying(),onedit:e=>n.SetSpraying(e)},{name:t+".rate.name",value:n.GetRate(),onedit:e=>n.SetRate(e)},{name:t+".spray-cone.name",value:h.toDegrees(n.GetSprayCone()),onedit:e=>n.SetSprayCone(h.toRadians(e))},{name:t+".speed.name",value:n.GetInitSpeed(),onedit:e=>n.SetInitSpeed(e)},{name:t+".size.name",value:n.GetInitSize(),onedit:e=>n.SetInitSize(e)},{name:t+".opacity.name",value:n.GetInitOpacity(),onedit:e=>n.SetInitOpacity(e)},{name:t+".grow-rate.name",value:n.GetGrowRate(),onedit:e=>n.SetGrowRate(e)},{name:t+".x-randomiser.name",value:n.GetInitXRandom(),onedit:e=>n.SetInitXRandom(e)},{name:t+".y-randomiser.name",value:n.GetInitYRandom(),onedit:e=>n.SetInitYRandom(e)},{name:t+".initial-speed-randomiser.name",value:n.GetInitSpeedRandom(),onedit:e=>n.SetInitSpeedRandom(e)},{name:t+".size-randomiser.name",value:n.GetInitSizeRandom(),onedit:e=>n.SetInitSizeRandom(e)},{name:t+".grow-rate-randomiser.name",value:n.GetGrowRandom(),onedit:e=>n.SetGrowRandom(e)},{name:t+".acceleration.name",value:n.GetAcceleration(),onedit:e=>n.SetAcceleration(e)},{name:t+".gravity.name",value:n.GetGravity(),onedit:e=>n.SetGravity(e)},{name:t+".angle-randomiser.name",value:n.GetLifeAngleRandom(),onedit:e=>n.SetLifeAngleRandom(e)},{name:t+".life-speed-randomiser.name",value:n.GetLifeSpeedRandom(),onedit:e=>n.SetLifeSpeedRandom(e)},{name:t+".opacity-randomiser.name",value:n.GetLifeOpacityRandom(),onedit:e=>n.SetLifeOpacityRandom(e)},{name:t+".timeout.name",value:n.GetTimeout(),onedit:e=>n.SetTimeout(e)}]}]}GetScriptInterfaceClass(){return self.IParticlesInstance}},new WeakMap);self.IParticlesInstance=class extends self.IWorldInstance{constructor(){super(),H.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set isSpraying(e){GetParticleEngine2(this).SetSpraying(!!e)}get isSpraying(){return GetParticleEngine2(this).IsSpraying()}set rate(e){i.RequireFiniteNumber(e),H.get(this)._SetRate(e)}get rate(){return GetParticleEngine2(this).GetRate()}set sprayCone(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetSprayCone(e)}get sprayCone(){return GetParticleEngine2(this).GetSprayCone()}set initSpeed(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSpeed(e)}get initSpeed(){return GetParticleEngine2(this).GetInitSpeed()}set initSize(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSize(e)}get initSize(){return GetParticleEngine2(this).GetInitSize()}set initOpacity(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitOpacity(e)}get initOpacity(){return GetParticleEngine2(this).GetInitOpacity()}set initXRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitXRandom(e)}get initXRandom(){return GetParticleEngine2(this).GetInitXRandom()}set initYRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitYRandom(e)}get initYRandom(){return GetParticleEngine2(this).GetInitYRandom()}set initSpeedRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSpeedRandom(e)}get initSpeedRandom(){return GetParticleEngine2(this).GetInitSpeedRandom()}set initSizeRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetInitSizeRandom(e)}get initSizeRandom(){return GetParticleEngine2(this).GetInitSizeRandom()}set initGrowRate(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetGrowRate(e)}get initGrowRate(){return GetParticleEngine2(this).GetGrowRate()}set initGrowRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetGrowRandom(e)}get initGrowRandom(){return GetParticleEngine2(this).GetGrowRandom()}set acceleration(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetAcceleration(e)}get acceleration(){return GetParticleEngine2(this).GetAcceleration()}set gravity(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetGravity(e)}get gravity(){return GetParticleEngine2(this).GetGravity()}set lifeAngleRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetLifeAngleRandom(e)}get lifeAngleRandom(){return GetParticleEngine2(this).GetLifeAngleRandom()}set lifeSpeedRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetLifeSpeedRandom(e)}get lifeSpeedRandom(){return GetParticleEngine2(this).GetLifeSpeedRandom()}set lifeOpacityRandom(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetLifeOpacityRandom(e)}get lifeOpacityRandom(){return GetParticleEngine2(this).GetLifeOpacityRandom()}set timeout(e){i.RequireFiniteNumber(e),GetParticleEngine2(this).SetTimeout(e)}get timeout(){return GetParticleEngine2(this).GetTimeout()}fastForward(e){i.RequireFiniteNumber(e),H.get(this)._FastForward(e)}setParticleObjectClass(e){const t=H.get(this);e?t._SetParticleObjectClass(t.GetRuntime()._UnwrapIObjectClass(e)):t._SetParticleObjectClass(null)}}}{const N0=self.C3;N0.Plugins.Particles.Cnds={IsSpraying(){return this._particleEngine.IsSpraying()}}}{const O0=self.C3;O0.Plugins.Particles.Acts={SetSpraying(e){this._particleEngine.SetSpraying(0!==e)},SetRate(e){this._SetRate(e)},SetParticleObject(e){this._SetParticleObjectClass(e)},UnsetParticleObject(){this._SetParticleObjectClass(null)},SetSprayCone(e){this._particleEngine.SetSprayCone(O0.toRadians(e))},SetInitSpeed(e){this._particleEngine.SetInitSpeed(e)},SetInitSize(e){this._particleEngine.SetInitSize(e)},SetInitOpacity(e){this._particleEngine.SetInitOpacity(e/100)},SetGrowRate(e){this._particleEngine.SetGrowRate(e)},SetXRandomiser(e){this._particleEngine.SetInitXRandom(e)},SetYRandomiser(e){this._particleEngine.SetInitYRandom(e)},SetSpeedRandomiser(e){this._particleEngine.SetInitSpeedRandom(e)},SetSizeRandomiser(e){this._particleEngine.SetInitSizeRandom(e)},SetGrowRateRandomiser(e){this._particleEngine.SetGrowRandom(e)},SetParticleAcc(e){this._particleEngine.SetAcceleration(e)},SetGravity(e){this._particleEngine.SetGravity(e)},SetAngleRandomiser(e){this._particleEngine.SetLifeAngleRandom(e)},SetLifeSpeedRandomiser(e){this._particleEngine.SetLifeSpeedRandom(e)},SetOpacityRandomiser(e){this._particleEngine.SetLifeOpacityRandom(e)},SetTimeout(e){this._particleEngine.SetTimeout(e)},FastForward(e){this._FastForward(e)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{const ib=self.C3;ib.Plugins.Particles.Exps={ParticleCount(){return this._particleEngine.GetParticleCount()},Rate(){return this._particleEngine.GetRate()},SprayCone(){return ib.toDegrees(this._particleEngine.GetSprayCone())},InitSpeed(){return this._particleEngine.GetInitSpeed()},InitSize(){return this._particleEngine.GetInitSize()},InitOpacity(){return 100*this._particleEngine.GetInitOpacity()},InitGrowRate(){return this._particleEngine.GetGrowRate()},XRandom(){return this._particleEngine.GetInitXRandom()},YRandom(){return this._particleEngine.GetInitYRandom()},InitSizeRandom(){return this._particleEngine.GetInitSizeRandom()},InitSpeedRandom(){return this._particleEngine.GetInitSpeedRandom()},InitGrowRandom(){return this._particleEngine.GetGrowRandom()},ParticleAcceleration(){return this._particleEngine.GetAcceleration()},Gravity(){return this._particleEngine.GetGravity()},ParticleAngleRandom(){return this._particleEngine.GetLifeAngleRandom()},ParticleSpeedRandom(){return this._particleEngine.GetLifeSpeedRandom()},ParticleOpacityRandom(){return this._particleEngine.GetLifeOpacityRandom()},Timeout(){return this._particleEngine.GetTimeout()}}}{const C33=self.C3,inactiveParticles=[],MAX_RECYCLE_PARTICLES=1e3,VALID_SPRAY_TYPES=new Set(["continuous-spray","one-shot"]),DESTROY_MODES=["fade-to-invisible","timeout-expired","particle-stopped"],tempRect=C33.New(C33.Rect);self.ParticleEngine=class{constructor(){this._rate=0,this._sprayCone=0,this._sprayType="continuous-spray",this._isSpraying=!1,this._masterOpacity=0,this._isPixelRounding=!1,this._spawnX=0,this._spawnY=0,this._spawnAngle=0,this._initSpeed=0,this._initSize=0,this._initSizeScale=1,this._initOpacity=0,this._growRate=0,this._xRandom=0,this._yRandom=0,this._initSpeedRandom=0,this._initSizeRandom=0,this._growRandom=0,this._acceleration=0,this._gravity=0,this._lifeAngleRandom=0,this._lifeSpeedRandom=0,this._lifeOpacityRandom=0,this._destroyMode=0,this._timeout=0,this._createCounter=0,this._particleScale=1,this.ononeshotfinish=null,this.onparticlecreate=null,this._particles=[],this._boundingBox=new C33.Rect,this._color=new C33.Color}Release(){this.Cancel(),C33.clearArray(this._particles),this._particles=null,this.ononeshotfinish=null,this.onparticlecreate=null,this._boundingBox=null,this._color=null}Cancel(){const s=this._particles;for(let e=0,t=s.length;e<t;++e)s[e].Destroy();C33.appendArray(inactiveParticles,s),C33.clearArray(s),inactiveParticles.length>MAX_RECYCLE_PARTICLES&&C33.truncateArray(inactiveParticles,MAX_RECYCLE_PARTICLES),this._isSpraying=!1}CreateOneShotSpray(){for(let e=0,t=this._rate;e<t;++e)this._CreateParticle();this._particles.length&&(this._isSpraying=!0)}_CreateParticle(e=!0){let t=null;return inactiveParticles.length?(t=inactiveParticles.pop()).SetEngine(this):t=C33.New(self.Particle,this),this._particles.push(t),e?t.Init(this.onparticlecreate):t.Init(),t}ReInitAllParticles(){const s=this._particles,n=this.onparticlecreate;for(let e=0,t=s.length;e<t;++e)s[e].Init(n)}UpdateAllParticlesUserData(){const s=this._particles,n=this.onparticlecreate;for(let e=0,t=s.length;e<t;++e)s[e].UpdateUserData(n)}ApplyParticleDataToUserData(s){const n=this._particles;for(let e=0,t=n.length;e<t;++e){const i=n[e],r=i.GetUserData();if(r){const a=r.GetWorldInfo();a.SetX(i.GetX()),a.SetY(i.GetY()),a.SetSize(i.GetSize(),i.GetSize()),a.SetOpacity(i.GetOpacity()),a.SetAngle(i.GetAngle()),a.SetUnpremultipliedColor(s.GetWorldInfo().GetUnpremultipliedColor()),a.SetBboxChanged()}}}SetParticleCount(e,t=!0){const s=this._particles;if(e<s.length){const n=s.length-e;for(let e=0;e<n;++e){const i=s.pop();i.Destroy(),inactiveParticles.push(i)}inactiveParticles.length>MAX_RECYCLE_PARTICLES&&C33.truncateArray(inactiveParticles,MAX_RECYCLE_PARTICLES)}else if(e>s.length){const r=e-s.length;for(let e=0;e<r;++e)this._CreateParticle(t)}}GetParticles(){return this._particles}GetParticleCount(){return this._particles.length}Tick(e){this._SpawnContinuous(e),this._TickParticles(e),this._MaybeFinishOneShot()}_SpawnContinuous(e){if("continuous-spray"===this._sprayType&&this._isSpraying){this._createCounter+=e*this._rate;const t=Math.floor(this._createCounter);this._createCounter-=t;for(let e=0;e<t;++e)this._CreateParticle()}}_SetCreateCounter(e){this._createCounter=e}_GetCreateCounter(){return this._createCounter}_TickParticles(s){let n=this._boundingBox,i=(n.set(this._spawnX,this._spawnY,this._spawnX,this._spawnY),this._particles),r=0;for(let e=0,t=i.length;e<t;++e){const a=i[e];(i[r]=a).Tick(s),a.IsActive()?(++r,n.expandToContain(a.GetBoundingBox())):(a.Destroy(),inactiveParticles.push(a))}C33.truncateArray(i,r),inactiveParticles.length>MAX_RECYCLE_PARTICLES&&C33.truncateArray(inactiveParticles,MAX_RECYCLE_PARTICLES)}_MaybeFinishOneShot(){"one-shot"===this._sprayType&&0===this._particles.length&&this._isSpraying&&(this.ononeshotfinish&&this.ononeshotfinish(),this._isSpraying=!1)}Draw(s,n,i,r){tempRect.set(n.getTlx(),n.getTly(),n.getBrx(),n.getBry()),s.StartRenderingPoints(tempRect),this._color.copy(s.GetColor());const a=this._particles;for(let e=0,t=a.length;e<t;++e){const o=a[e];i.intersectsRect(o.GetBoundingBox())&&o.Draw(s,n,r)}s.FinishRenderingPoints()}GetColor(){return this._color}SetRate(e){this._rate=+e}GetRate(){return this._rate}SetSprayCone(e){this._sprayCone=+e}GetSprayCone(){return this._sprayCone}SetSprayType(e){if(!VALID_SPRAY_TYPES.has(e))throw new Error("invalid spray type");this._sprayType=e}GetSprayType(){return this._sprayType}SetSpraying(e){this._isSpraying=!!e}IsSpraying(){return this._isSpraying}SetMasterOpacity(e){this._masterOpacity=+e}GetMasterOpacity(){return this._masterOpacity}SetPixelRounding(e){this._isPixelRounding=!!e}IsPixelRounding(){return this._isPixelRounding}SetSpawnX(e){this._spawnX=+e}GetSpawnX(){return this._spawnX}SetSpawnY(e){this._spawnY=+e}GetSpawnY(){return this._spawnY}SetSpawnAngle(e){this._spawnAngle=+e}GetInitAngle(){return this._spawnAngle}SetInitSpeed(e){this._initSpeed=+e}GetInitSpeed(){return this._initSpeed}SetInitSize(e){this._initSize=+e}GetInitSize(){return this._initSize}SetInitSizeScale(e){this._initSizeScale=+e}GetInitSizeScale(){return this._initSizeScale}SetInitOpacity(e){this._initOpacity=+e}GetInitOpacity(){return this._initOpacity}SetGrowRate(e){this._growRate=+e}GetGrowRate(){return this._growRate}SetInitXRandom(e){this._xRandom=+e}GetInitXRandom(){return this._xRandom}SetInitYRandom(e){this._yRandom=+e}GetInitYRandom(){return this._yRandom}SetInitSpeedRandom(e){this._initSpeedRandom=+e}GetInitSpeedRandom(){return this._initSpeedRandom}SetInitSizeRandom(e){this._initSizeRandom=+e}GetInitSizeRandom(){return this._initSizeRandom}SetGrowRandom(e){this._growRandom=+e}GetGrowRandom(){return this._growRandom}SetAcceleration(e){this._acceleration=+e}GetAcceleration(){return this._acceleration}SetGravity(e){this._gravity=+e}GetGravity(){return this._gravity}SetLifeAngleRandom(e){this._lifeAngleRandom=+e}GetLifeAngleRandom(){return this._lifeAngleRandom}SetLifeSpeedRandom(e){this._lifeSpeedRandom=+e}GetLifeSpeedRandom(){return this._lifeSpeedRandom}SetLifeOpacityRandom(e){this._lifeOpacityRandom=+e}GetLifeOpacityRandom(){return this._lifeOpacityRandom}SetDestroyMode(e){let t=DESTROY_MODES.indexOf(e);if(-1===t)throw new Error("invalid destroy mode");this._destroyMode=t}SetDestroyModeIndex(e){this.SetDestroyMode(DESTROY_MODES[e])}GetDestroyMode(){return DESTROY_MODES[this._destroyMode]}GetDestroyModeIndex(){return this._destroyMode}SetTimeout(e){this._timeout=+e}GetTimeout(){return this._timeout}SetParticleScale(e){this._particleScale=+e}GetParticleScale(){return this._particleScale}GetBoundingBox(){return this._boundingBox}}}{let randomOffset2=function(e){return Math.random()*e-e/2},C33=(randomOffset=randomOffset2,self.C3),ParticleEngine=self.ParticleEngine,tmpQuad=new C33.Quad,tmpColor=new C33.Color,DPR=self.devicePixelRatio||1,didChangeColor=!1;self.Particle=class{constructor(e){this._engine=e,this._isActive=!1,this._x=0,this._y=0,this._speed=0,this._angle=0,this._opacity=1,this._lastOpacity=0,this._grow=0,this._size=0,this._halfSize=0,this._gs=0,this._age=0,this._bbox=new C33.Rect,this._userData=null,this._userDataUid=NaN,this._updateCallback=null,this._destroyCallback=null}SetEngine(e){this._engine=e}Init(e){const t=this._engine;this._isActive=!0,this._x=t.GetSpawnX()+randomOffset2(t.GetInitXRandom()),this._y=t.GetSpawnY()+randomOffset2(t.GetInitYRandom()),this._speed=t.GetInitSpeed()+randomOffset2(t.GetInitSpeedRandom()),this._angle=t.GetInitAngle()+randomOffset2(t.GetSprayCone()),this._opacity=t.GetInitOpacity(),this._lastOpacity=this._opacity,this._size=(t.GetInitSize()+randomOffset2(t.GetInitSizeRandom()))*t.GetInitSizeScale(),this._halfSize=this._size/2,this._grow=t.GetGrowRate()+randomOffset2(t.GetGrowRandom()),this._gs=0,this._age=0,this._UpdateBoundingBox(),e?this._userData||(this._userData=e(this)):(this._userData=null,this._updateCallback=null,this._destroyCallback=null)}UpdateUserData(e){e?this._userData&&!this._userData.IsDestroyed()||(this._userData=e(this,this._userDataUid)):(this._userData=null,this._updateCallback=null,this._destroyCallback=null)}SetUpdateCallback(e){this._updateCallback=e}SetDestroyCallback(e){this._destroyCallback=e}Destroy(){const e=this._destroyCallback;e&&e(this._userData),this._userData=null,this._updateCallback=null,this._destroyCallback=null}toJSON(){let e;return this._userData&&this._userData.GetWorldInfo()&&(e=this._userData.GetWorldInfo().GetInstance().GetUID()),[this._x,this._y,this._speed,this._angle,this._opacity,this._grow,this._size,this._gs,this._age,e]}setFromJSON(e){this._x=e[0],this._y=e[1],this._speed=e[2],this._angle=e[3],this._opacity=e[4],this._lastOpacity=this._opacity,this._grow=e[5],this._size=e[6],this._gs=e[7],this._age=e[8],this._userDataUid=e[9],this._halfSize=this._size/2,this._UpdateBoundingBox()}Tick(e){let t=this._engine,s=this._speed*e,n=this._angle,i=Math.cos(n)*s,r=Math.sin(n)*s+this._gs*e,a=(this._x+=i,this._y+=r,this._grow*e),o=(this._size+=a,this._halfSize=this._size/2,this._speed+=t.GetAcceleration()*e,this._gs+=t.GetGravity()*e,this._age+=e,this._UpdateBoundingBox(),t.GetLifeAngleRandom()),l=t.GetLifeSpeedRandom(),h=t.GetLifeOpacityRandom(),c=0;0!==o&&(c=randomOffset2(o*e),this._angle+=c),0!==l&&(this._speed+=randomOffset2(l*e)),0!==h&&(this._opacity=C33.clamp(this._opacity+randomOffset2(h*e),0,1));const u=1<=this._size&&(2===t.GetDestroyModeIndex()?0<this._speed:this._age<t.GetTimeout()),d=this._updateCallback;if(d&&u){let e=t.GetMasterOpacity()*this._opacity;0===t.GetDestroyModeIndex()&&(e*=1-this._age/t.GetTimeout());const _=e-this._lastOpacity;this._lastOpacity=e,d(this._userData,i,r,a,c,_)}this._isActive=u}IsActive(){return this._isActive}GetBoundingBox(){return this._bbox}_UpdateBoundingBox(){const e=this._x,t=this._y,s=this._halfSize;this._bbox.set(e-s,t-s,e+s,t+s)}Draw(i,r,a){if(!this._userData){let s=this._engine,n=s.GetMasterOpacity()*this._opacity;if(0===s.GetDestroyModeIndex()&&(n*=1-this._age/s.GetTimeout()),!(n<=0)){const o=this._size,l=o*s.GetParticleScale()*DPR;if(!(l<1)){let e=this._x,t=this._y;s.IsPixelRounding()&&(e=e+.5|0,t=t+.5|0),i.IsWebGPU()?i.Point(e,t,o,n):a||l>i.GetMaxPointSize()||l<i.GetMinPointSize()?(tmpColor.copy(s.GetColor()),tmpColor.multiplyAlpha(n),i.SetColor(tmpColor),didChangeColor=!0,tmpQuad.setFromRect(this._bbox),i.Quad4(tmpQuad,r)):(didChangeColor&&(i.SetColor(s.GetColor()),didChangeColor=!1),i.Point(e,t,l,n))}}}}GetUserData(){return this._userData}GetUserDataUID(){return this._userDataUid}GetX(){return this._x}GetY(){return this._y}GetSize(){return this._size}GetAngle(){return this._angle}GetOpacity(){return this._opacity}}}{const a=self.C3;a.Behaviors.Pin=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.Pin.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3;g.Behaviors.Pin.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._pinInst=null,this._pinUid=-1,this._mode="",this._propSet=new Set,this._pinDist=0,this._pinAngle=0,this._pinImagePoint=0,this._dx=0,this._dy=0,this._dWidth=0,this._dHeight=0,this._dAngle=0,this._dz=0,this._lastKnownAngle=0,this._destroy=!1,t&&(this._destroy=t[0]);const s=this._runtime.Dispatcher();this._disposables=new g.CompositeDisposable(g.Disposable.From(s,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),g.Disposable.From(s,"afterload",e=>this._OnAfterLoad()))}Release(){this._pinInst=null,super.Release()}_SetPinInst(e){e?(this._pinInst=e,this._StartTicking2()):(this._pinInst=null,this._StopTicking2())}_Pin(e,t,s){if(e){const n=e.GetFirstPicked(this._inst);if(n){this._mode=t,this._SetPinInst(n);const i=this._inst.GetWorldInfo(),r=n.GetWorldInfo();if("properties"===this._mode){const a=this._propSet;a.clear();for(const o of s)a.add(o);this._dx=i.GetX()-r.GetX(),this._dy=i.GetY()-r.GetY(),this._dAngle=i.GetAngle()-r.GetAngle(),this._lastKnownAngle=i.GetAngle(),this._dz=i.GetZElevation()-r.GetZElevation(),a.has("x")&&a.has("y")&&(this._pinAngle=g.angleTo(r.GetX(),r.GetY(),i.GetX(),i.GetY())-r.GetAngle(),this._pinDist=g.distanceTo(r.GetX(),r.GetY(),i.GetX(),i.GetY())),a.has("width-abs")?this._dWidth=i.GetWidth()-r.GetWidth():a.has("width-scale")&&(this._dWidth=i.GetWidth()/r.GetWidth()),a.has("height-abs")?this._dHeight=i.GetHeight()-r.GetHeight():a.has("height-scale")&&(this._dHeight=i.GetHeight()/r.GetHeight())}else this._pinDist=g.distanceTo(r.GetX(),r.GetY(),i.GetX(),i.GetY())}}}SaveToJson(){const e=this._propSet,t=this._mode,s={uid:this._pinInst&&!this._pinInst.IsDestroyed()?this._pinInst.GetUID():-1,m:t,d:this._destroy};return"rope"===t||"bar"===t?s.pd=this._pinDist:"properties"===t&&(s.ps=[...this._propSet],e.has("imagepoint")?s.ip=this._pinImagePoint:e.has("x")&&e.has("y")?(s.pa=this._pinAngle,s.pd=this._pinDist):(e.has("x")&&(s.dx=this._dx),e.has("y")&&(s.dy=this._dy)),e.has("angle")&&(s.da=this._dAngle,s.lka=this._lastKnownAngle),(e.has("width-abs")||e.has("width-scale"))&&(s.dw=this._dWidth),(e.has("height-abs")||e.has("height-scale"))&&(s.dh=this._dHeight),e.has("z"))&&(s.dz=this._dz),s}LoadFromJson(e){const t=e.m,s=this._propSet;if(s.clear(),this._pinUid=e.uid,"number"==typeof t)this._LoadFromJson_Legacy(e);else if(this._mode=t,e.hasOwnProperty("d")&&(this._destroy=!!e.d),"rope"===t||"bar"===t)this._pinDist=e.pd;else if("properties"===t){for(const n of e.ps)s.add(n);s.has("imagepoint")?this._pinImagePoint=e.ip:s.has("x")&&s.has("y")?(this._pinAngle=e.pa,this._pinDist=e.pd):(s.has("x")&&(this._dx=e.dx),s.has("y")&&(this._dy=e.dy)),s.has("angle")&&(this._dAngle=e.da,this._lastKnownAngle=e.lka||0),(s.has("width-abs")||s.has("width-scale"))&&(this._dWidth=e.dw),(s.has("height-abs")||s.has("height-scale"))&&(this._dHeight=e.dh),s.has("z")&&(this._dz=e.dz)}}_LoadFromJson_Legacy(e){const t=this._propSet,s=e.msa,n=e.tsa,i=e.pa,r=e.pd,a=e.m;switch(a){case 0:this._mode="properties",t.add("x").add("y").add("angle"),this._pinAngle=i,this._pinDist=r,this._dAngle=s-n,this._lastKnownAngle=e.lka;break;case 1:this._mode="properties",t.add("x").add("y"),this._pinAngle=i,this._pinDist=r;break;case 2:this._mode="properties",t.add("angle"),this._dAngle=s-n,this._lastKnownAngle=e.lka;break;case 3:this._mode="rope",this._pinDist=e.pd;break;case 4:this._mode="bar",this._pinDist=e.pd}}_OnAfterLoad(){-1===this._pinUid?this._SetPinInst(null):(this._SetPinInst(this._runtime.GetInstanceByUID(this._pinUid)),this._pinUid=-1)}_OnInstanceDestroyed(e){this._pinInst===e&&(this._SetPinInst(null),this._destroy)&&this._runtime.DestroyInstance(this._inst)}Tick2(){const r=this._pinInst;if(r&&!r.IsDestroyed()){let s=r.GetWorldInfo(),e=this._inst,n=e.GetWorldInfo(),t=this._mode,i=!1;if("rope"===t||"bar"===t){const a=g.distanceTo(n.GetX(),n.GetY(),s.GetX(),s.GetY());if(a>this._pinDist||"bar"===t&&a<this._pinDist){const o=g.angleTo(s.GetX(),s.GetY(),n.GetX(),n.GetY());n.SetXY(s.GetX()+Math.cos(o)*this._pinDist,s.GetY()+Math.sin(o)*this._pinDist),i=!0}}else{let e=this._propSet,t=0;if(e.has("imagepoint")){const[l,h]=r.GetImagePoint(this._pinImagePoint);n.EqualsXY(l,h)||(n.SetXY(l,h),i=!0)}else if(e.has("x")&&e.has("y")){const c=s.GetX()+Math.cos(s.GetAngle()+this._pinAngle)*this._pinDist,u=s.GetY()+Math.sin(s.GetAngle()+this._pinAngle)*this._pinDist;n.EqualsXY(c,u)||(n.SetXY(c,u),i=!0)}else t=s.GetX()+this._dx,e.has("x")&&t!==n.GetX()&&(n.SetX(t),i=!0),t=s.GetY()+this._dy,e.has("y")&&t!==n.GetY()&&(n.SetY(t),i=!0);e.has("angle")&&(this._lastKnownAngle!==n.GetAngle()&&(this._dAngle=g.clampAngle(this._dAngle+(n.GetAngle()-this._lastKnownAngle))),(t=g.clampAngle(s.GetAngle()+this._dAngle))!==n.GetAngle()&&(n.SetAngle(t),i=!0),this._lastKnownAngle=n.GetAngle()),e.has("width-abs")&&(t=s.GetWidth()+this._dWidth)!==n.GetWidth()&&(n.SetWidth(t),i=!0),e.has("width-scale")&&(t=s.GetWidth()*this._dWidth)!==n.GetWidth()&&(n.SetWidth(t),i=!0),e.has("height-abs")&&(t=s.GetHeight()+this._dHeight)!==n.GetHeight()&&(n.SetHeight(t),i=!0),e.has("height-scale")&&(t=s.GetHeight()*this._dHeight)!==n.GetHeight()&&(n.SetHeight(t),i=!0),e.has("z")&&(t=s.GetZElevation()+this._dz)!==n.GetZElevation()&&(n.SetZElevation(t),this._runtime.UpdateRender())}i&&n.SetBboxChanged()}}GetDebuggerProperties(){const e="behaviors.pin.debugger";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".is-pinned",value:!!this._pinInst},{name:e+".pinned-uid",value:this._pinInst?this._pinInst.GetUID():0}]}]}}}{const $=self.C3;$.Behaviors.Pin.Cnds={IsPinned(){return!!this._pinInst},WillDestroy(){return this._destroy}}}{const _=self.C3;_.Behaviors.Pin.Acts={PinByDistance(e,t){this._Pin(e,0===t?"rope":"bar")},PinByProperties(e,t,s,n,i,r,a){const o=[];t&&o.push("x"),s&&o.push("y"),n&&o.push("angle"),a&&o.push("z"),1===i?o.push("width-abs"):2===i&&o.push("width-scale"),1===r?o.push("height-abs"):2===r&&o.push("height-scale"),0!==o.length&&this._Pin(e,"properties",o)},PinByImagePoint(e,t,s,n,i,r){const a=["imagepoint"];s&&a.push("angle"),r&&a.push("z"),1===n?a.push("width-abs"):2===n&&a.push("width-scale"),1===i?a.push("height-abs"):2===i&&a.push("height-scale"),this._pinImagePoint=t,this._Pin(e,"properties",a)},SetPinDistance(e){"rope"!==this._mode&&"bar"!==this._mode||(this._pinDist=Math.max(e,0))},SetDestroy(e){this._destroy=e},Unpin(){this._SetPinInst(null),this._mode="",this._propSet.clear(),this._pinImagePoint=""},Pin(e,t){switch(t){case 0:this._Pin(e,"properties",["x","y","angle"]);break;case 1:this._Pin(e,"properties",["x","y"]);break;case 2:this._Pin(e,"properties",["angle"]);break;case 3:this._Pin(e,"rope");break;case 4:this._Pin(e,"bar")}}}}{const va=self.C3;va.Behaviors.Pin.Exps={PinnedUID(){return this._pinInst?this._pinInst.GetUID():-1}}}{const a=self.C3;a.Behaviors.DragnDrop=class extends a.SDKBehaviorBase{constructor(e){super(e);const t=this._runtime.Dispatcher();this._disposables=new a.CompositeDisposable(a.Disposable.From(t,"pointerdown",e=>this._OnPointerDown(e.data)),a.Disposable.From(t,"pointermove",e=>this._OnPointerMove(e.data)),a.Disposable.From(t,"pointerup",e=>this._OnPointerUp(e.data,!1)),a.Disposable.From(t,"pointercancel",e=>this._OnPointerUp(e.data,!0)))}Release(){this._disposables.Release(),this._disposables=null,super.Release()}_OnPointerDown(e){"mouse"===e.pointerType&&0!==e.button||this._OnInputDown(e.pointerId.toString(),e.pageX-this._runtime.GetCanvasClientX(),e.pageY-this._runtime.GetCanvasClientY())}_OnPointerMove(e){0!=(1&e.lastButtons)&&0==(1&e.buttons)?this._OnInputUp(e.pointerId.toString()):this._OnInputMove(e.pointerId.toString(),e.pageX-this._runtime.GetCanvasClientX(),e.pageY-this._runtime.GetCanvasClientY())}_OnPointerUp(e,t){"mouse"===e.pointerType&&0!==e.button||this._OnInputUp(e.pointerId.toString())}async _OnInputDown(e,t,s){let n=this.GetInstances(),i=null,r=null,o=0,l=0;for(const h of n){const c=h.GetBehaviorSdkInstanceFromCtor(a.Behaviors.DragnDrop);if(c.IsEnabled()&&!c.IsDragging()&&!h.IsDestroyed()){const u=h.GetWorldInfo(),d=u.GetLayer(),[_,p]=d.CanvasCssToLayer(t,s,u.GetTotalZElevation());if(d.IsSelfAndParentsInteractive()&&u.ContainsPoint(_,p))if(i){const m=i.GetWorldInfo();(d.GetIndex()>m.GetLayer().GetIndex()||d.GetIndex()===m.GetLayer().GetIndex()&&u.GetZIndex()>m.GetZIndex())&&(i=h,r=c,o=_,l=p)}else i=h,r=c,o=_,l=p}}i&&await r._OnDown(e,o,l)}_OnInputMove(e,t,s){const n=this.GetInstances();for(const i of n){const r=i.GetBehaviorSdkInstanceFromCtor(a.Behaviors.DragnDrop);if(r.IsEnabled()&&r.IsDragging()&&(!r.IsDragging()||r.GetDragSource()===e)){const o=i.GetWorldInfo(),l=o.GetLayer(),[h,c]=l.CanvasCssToLayer(t,s,o.GetTotalZElevation());r._OnMove(h,c)}}}async _OnInputUp(e){const t=this.GetInstances();for(const s of t){const n=s.GetBehaviorSdkInstanceFromCtor(a.Behaviors.DragnDrop);n.IsDragging()&&n.GetDragSource()===e&&await n._OnUp()}}}}{const P=self.C3;P.Behaviors.DragnDrop.Type=class extends P.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const S=self.C3,T=self.C3X,U=self.IBehaviorInstance,V=0,W=1,X=(S.Behaviors.DragnDrop.Instance=class extends S.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._isDragging=!1,this._dx=0,this._dy=0,this._dragSource="<none>",this._axes=0,this._isEnabled=!0,t&&(this._axes=t[V],this._isEnabled=t[W])}Release(){super.Release()}SaveToJson(){return{a:this._axes,e:this._isEnabled}}LoadFromJson(e){this._axes=e.a,this._isEnabled=e.e,this._isDragging=!1}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled||(this._isDragging=!1)}IsEnabled(){return this._isEnabled}_SetAxes(e){this._axes=e}_GetAxes(){return this._axes}_Drop(){this._isDragging&&this._OnUp()}IsDragging(){return this._isDragging}GetDragSource(){return this._dragSource}async _OnDown(e,t,s){const n=this.GetWorldInfo();this._dx=t-n.GetX(),this._dy=s-n.GetY(),this._isDragging=!0,this._dragSource=e,this.DispatchScriptEvent("dragstart"),await this.TriggerAsync(S.Behaviors.DragnDrop.Cnds.OnDragStart)}_OnMove(e,t){const s=this.GetWorldInfo(),n=e-this._dx,i=t-this._dy;0===this._axes?s.GetX()===n&&s.GetY()===i||(s.SetXY(n,i),s.SetBboxChanged()):1===this._axes?s.GetX()!==n&&(s.SetX(n),s.SetBboxChanged()):2===this._axes&&s.GetY()!==i&&(s.SetY(i),s.SetBboxChanged())}async _OnUp(){this._isDragging=!1,this.DispatchScriptEvent("drop"),await this.TriggerAsync(S.Behaviors.DragnDrop.Cnds.OnDrop)}GetPropertyValueByIndex(e){switch(e){case V:return this._GetAxes();case W:return this.IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case V:this._SetAxes(t);break;case W:this._SetEnabled(!!t)}}GetDebuggerProperties(){let e="behaviors.dragndrop",t=e+".properties.axes",s="";return 0===this._axes?s=t+".items.both":1===this._axes?s=t+".items.horizontal-only":2===this._axes&&(s=t+".items.vertical-only"),[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".debugger.is-dragging",value:this.IsDragging()},{name:t+".name",value:[s]},{name:e+".properties.enabled.name",value:this.IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IDragDropBehaviorInstance}},new WeakMap),Y=["both","horizontal","vertical"];self.IDragDropBehaviorInstance=class extends U{constructor(){super(),X.set(this,U._GetInitInst().GetSdkInstance())}set axes(e){const t=Y.indexOf(e);if(-1===t)throw new Error("invalid axes");X.get(this)._SetAxes(t)}get axes(){return Y[X.get(this)._GetAxes()]}drop(){X.get(this)._Drop()}get isDragging(){return X.get(this).IsDragging()}get isEnabled(){return X.get(this).IsEnabled()}set isEnabled(e){X.get(this)._SetEnabled(e)}}}{const xa=self.C3;xa.Behaviors.DragnDrop.Cnds={IsDragging(){return this.IsDragging()},OnDragStart(){return!0},OnDrop(){return!0},IsEnabled(){return this.IsEnabled()}}}{const ya=self.C3;ya.Behaviors.DragnDrop.Acts={SetEnabled(e){this._SetEnabled(!!e)},SetAxes(e){this._SetAxes(e)},Drop(){this._Drop()}}}{const Ba=self.C3;Ba.Behaviors.DragnDrop.Exps={}}{const a=self.C3;a.Behaviors.Tween=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.Tween.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=g.Behaviors.Tween,i=0;h.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._allowMultiple=!1,this._enabled=!0,t&&(this._allowMultiple=!1,this._enabled=!!t[i]),this._activeTweens=new Map,this._disabledTweens=[],this._waitingForReleaseTweens=new Map,this._finishingTween=null,this._activeTweensJson=null,this._disabledTweensJson=null,this._waitingForReleaseTweensJson=null,this._finishingTweenName="",this._triggerTweens=[],this._afterLoad=e=>this._OnAfterLoad(),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad)}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._finishingTween&&(this.ReleaseAndCompleteTween(this._finishingTween),this._finishingTween=null),this.ReleaseAndCompleteTweens(),this._tweens=null,this.ClearDisabledList(),this._disabledTweens=null,this._ReleaseWaitingTweens(),this._waitingForReleaseTweens=null,this._triggerTweens=null,super.Release()}PushTriggerTween(e){this._triggerTweens.push(e)}PopTriggerTween(){this._triggerTweens.pop()}GetTriggerTween(){return this._triggerTweens[this._triggerTweens.length-1]}SetEnabled(e){this._enabled=!!e,e?this._waitingForReleaseTweens&&this._waitingForReleaseTweens.size&&this._StartTicking2():this._StopTicking2();for(const t of this.AllTweens())e?this.IsInDisabledList(t)&&t.Resume():((t.IsPlaying()||t.IsScheduled())&&this.AddToDisabledList(t),t.Stop());e&&this.ClearDisabledList()}IsEnabled(){return this._enabled}AddToDisabledList(e){this._disabledTweens.push(e)}IsInDisabledList(e){return this._disabledTweens.includes(e)}ClearDisabledList(){g.clearArray(this._disabledTweens)}GetFinishingTween(){return this._finishingTween}IsInstanceValid(){const e=this.GetObjectInstance();return!!e&&!e.IsDestroyed()}GetTween(e,t,s=!1){const n=t?this.PropertyTweens(t,s):this.AllTweens(s);if(n&&n.length)for(const i of n)if(i.HasTags(e))return i}CheckTweensWithTags(e,t){for(const s of this._activeTweens.values())for(const n of s)if(!n.IsReleased()&&n.HasTags(e)&&t(n))return!0;for(const i of this._waitingForReleaseTweens.values())for(const r of i)if(!r.IsReleased()&&r.HasTags(e)&&t(r))return!0;return!1}CheckTweens(e){for(const t of this._activeTweens.values())for(const s of t)if(!s.IsReleased()&&e(s))return!0;for(const n of this._waitingForReleaseTweens.values())for(const i of n)if(!i.IsReleased()&&e(i))return!0;return!1}GetTweenIncludingWaitingForRelease(e,t){return this.GetTween(e,t,!0)}*GetTweens(e,t,s=!1){const n=t?this.PropertyTweens(t,s):this.AllTweens(s);if(n&&n.length)for(const i of n)i.HasTags(e)&&(yield i)}*GetTweensIncludingWaitingForRelease(e,t){yield*this.GetTweens(e,t,!0)}PropertyTweens(s,e){if(e){let e=this._activeTweens.get(s),t=this._waitingForReleaseTweens.get(s);return(e=e||[]).concat(t||[]).filter(e=>e).filter(e=>!e.IsReleased())}{let e=this._activeTweens.get(s);return(e=e||[]).filter(e=>e).filter(e=>!e.IsReleased())}}AllTweens(e){if(e){const t=[...this._activeTweens.values()].flat(),s=[...this._waitingForReleaseTweens.values()].flat();return t.concat(s).filter(e=>e).filter(e=>!e.IsReleased())}{const n=[...this._activeTweens.values()].flat();return n.filter(e=>e).filter(e=>!e.IsReleased())}}AllTweensIncludingWaitingForRelease(){return this.AllTweens(!0)}SaveToJson(e=0){return{s:!1,e:!!this._enabled,at:this._SaveActiveTweensToJson(),dt:this._SaveDisabledTweensToJson(),wt:this._SaveWaitingForReleaseTweensToJson(),ft:this._SaveFinishingTweenToJson()}}LoadFromJson(e,t="full"){e&&(this._activeTweensJson=e.at,this._disabledTweensJson=e.dt,this._waitingForReleaseTweensJson=e.wt,this._finishingTweenName=e.ft,this._allowMultiple=!1,this._enabled=!!e.e,"state"===t)&&this._OnAfterLoad()}_OnAfterLoad(){const e=this.GetRuntime().GetTimelineManager();if(this._PopulateTweenMap(this._activeTweensJson,this._activeTweens,e),this._disabledTweensJson){g.clearArray(this._disabledTweens);for(const t of this._disabledTweensJson)this._PopulateTweenArray(this._disabledTweens,t,e)}this._PopulateTweenMap(this._waitingForReleaseTweensJson,this._waitingForReleaseTweens,e),this._finishingTween=this._GetTween(this._finishingTweenName,e),this._enabled?this._waitingForReleaseTweens&&this._waitingForReleaseTweens.size&&this._StartTicking2():this._StopTicking2()}_PopulateTweenMap(t,s,n){if(t)for(const i in t){let e=s.get(i);e?g.clearArray(e):e=[];const r=t[i];for(const a of r){const o=this._PopulateTweenArray(e,a.name,n);if(o)this._LoadTweenFromJson(a.name,a,n);else{const l=g.TweenState.Build({runtime:this.GetRuntime(),json:a});g.TweenState.SetInstanceUID(l,this.GetObjectInstance().GetUID()),l.AddCompletedCallback(e=>this._FinishTriggers(e)),n.AddScheduledTimeline(l),this._PopulateTweenArray(e,l,n)}}s.set(i,e)}}_GetTween(e,t){return t.GetScheduledOrPlayingTimelineByName(e)}_PopulateTweenArray(e,t,s){if("string"!=typeof t)return!!e.push(t);{const n=this._GetTween(t,s);if(n)return!!e.push(n)}return!1}_LoadTweenFromJson(e,t,s){if("string"==typeof e){const n=this._GetTween(e,s);n&&(n._LoadFromJson(t),g.TweenState.SetInstanceUID(n,this.GetObjectInstance().GetUID()))}else e._LoadFromJson(t),g.TweenState.SetInstanceUID(e,this.GetObjectInstance().GetUID())}_SaveActiveTweensToJson(){const e={};for(const[t,s]of this._activeTweens)e[t]=s.filter(e=>!e.IsReleased()).map(e=>e._SaveToJson());return e}_SaveDisabledTweensToJson(){return this._disabledTweens.filter(e=>!e.IsReleased()).map(e=>e.GetName())}_SaveWaitingForReleaseTweensToJson(){const e={};for(const[t,s]of this._waitingForReleaseTweens)e[t]=s.map(e=>e._SaveToJson());return e}_SaveFinishingTweenToJson(){return this._finishingTween?this._finishingTween.GetName():""}Tick2(){this._ReleaseWaitingTweens()}CreateTween(e){const t=h.Config.GetPropertyTracksConfig(e.property,e.startValue,e.endValue,e.ease,e.resultMode,this.GetObjectInstance()),s=h.Maps.GetPropertyFromIndex(e.property),n=(h.Maps.IsValueId(s)||this.ReleaseTweens(e.property),g.TweenState.Build({runtime:this.GetRuntime(),id:s,tags:e.tags,time:e.time,instance:this.GetObjectInstance(),releaseOnComplete:!!e.releaseOnComplete,loop:!!e.loop,pingPong:!!e.pingPong,repeatCount:e.repeatCount,initialValueMode:e.initialValueMode,propertyTracksConfig:t}));return n.AddCompletedCallback(e=>this._FinishTriggers(e)),this._AddTween(n,e.property),n}_MaybeRemoveFromActiveTweenMap(e){const t=e.GetId();if(this._activeTweens.has(t)){const s=this._activeTweens.get(t);if(s){const n=s.indexOf(e);-1!==n&&s.splice(n,1)}}}ReleaseTween(e,t=!1){this._MaybeRemoveFromActiveTweenMap(e),e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(t),this._AddToWaitingList(e))}ReleaseTweens(e,t=!1){if(g.IsFiniteNumber(e)){const s=h.Maps.GetPropertyFromIndex(e);if(this._activeTweens.has(s)){const n=this._activeTweens.get(s),i=this.GetFinishingTween();for(const r of n)r===i||r.IsReleased()||this._IsInWaitingList(r)||(r.Stop(t),r.Release());g.clearArray(n)}}else{const a=this.GetFinishingTween();for(const o of this.AllTweens())o===a||o.IsReleased()||this._IsInWaitingList(o)||(o.Stop(t),o.Release());for(const l of this._activeTweens.keys())g.clearArray(this._activeTweens.get(l)),this._activeTweens.delete(l);this._activeTweens.clear()}}ReleaseAndCompleteTween(e){this.ReleaseTween(e,!0)}ReleaseAndCompleteTweens(){this.ReleaseTweens(NaN,!0)}GetPropertyValueByIndex(e){if(e===i)return this._enabled}SetPropertyValueByIndex(e,t){e===i&&(this._enabled=!!t)}_GetBehaviorType(e){const t=e.GetInstance(),s=t.GetBehaviorInstances();for(const n of s){const i=n.GetBehaviorType();if(i.GetInstanceSdkCtor()===this.constructor)return i}}Trigger(e,t,s,n){return this._runtime?super.Trigger(e):t.Trigger(e,s,n)}_FinishTriggers(e){this._finishingTween=e,h.Cnds.SetFinishingTween(e);let t,s;if(this.GetRuntime())t=this._inst,s=this._runtime,this.Trigger(h.Cnds.OnTweensFinished),this.Trigger(h.Cnds.OnAnyTweensFinished),this.ReleaseTween(e);else{if(!(t=e.GetInstance()))return;if(t&&t.IsDestroyed())return;s=t.GetRuntime();const n=this._GetBehaviorType(e);this.Trigger(h.Cnds.OnTweensFinished,s,t,n),this.Trigger(h.Cnds.OnAnyTweensFinished,s,t,n),e.Stop()}this._finishingTween=null,h.Cnds.SetFinishingTween(null),e.GetDestroyInstanceOnComplete()&&s.DestroyInstance(t)}_AddTween(e,t){const s=h.Maps.GetPropertyFromIndex(t),n=(this._activeTweens.has(s)||this._activeTweens.set(s,[]),this._activeTweens.get(s));n.push(e)}_AddToWaitingList(e){const t=e.GetId();this._waitingForReleaseTweens.has(t)||this._waitingForReleaseTweens.set(t,[]),this._waitingForReleaseTweens.get(t).push(e),this.IsTicking2()||this._StartTicking2()}_IsInWaitingList(e){const t=e.GetId();return!!this._waitingForReleaseTweens.has(t)&&this._waitingForReleaseTweens.get(t).includes(e)}_ReleaseWaitingTweens(){if(this._waitingForReleaseTweens.size){for(const e of this._waitingForReleaseTweens.values()){for(const t of e)t.IsReleased()||t.Release();g.clearArray(e)}this._waitingForReleaseTweens.clear(),this.IsTicking2()&&this._StopTicking2()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.tween.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.ITweenBehaviorInstance}}}{let M0=self.C3,s=null;M0.Behaviors.Tween.Cnds={OnAnyTweenLoop(){return!0},OnTweensLoop(e){const t=this.GetTriggerTween();return!!t&&t.HasTags(e)},OnAnyTweenPingPong(e){const t=this.GetTriggerTween();return!!t&&(t.GetPingPongState()===e||2===e)},OnTweensPingPong(e,t){const s=this.GetTriggerTween();return!!s&&(s.GetPingPongState()===t||2===t)&&s.HasTags(e)},SetFinishingTween(e){s=e},OnTweensFinished(e){return s.HasTags(e)},OnAnyTweensFinished(){return!0},IsPlaying(e){return this.CheckTweensWithTags(e,M0.TweenState.IsPlaying)},IsAnyPlaying(){return this.CheckTweens(M0.TweenState.IsPlaying)},IsPaused(e){return this.CheckTweensWithTags(e,M0.TweenState.IsPaused)},IsAnyPaused(){return this.CheckTweens(M0.TweenState.IsPaused)},IsPingPong(e,t){return 0===t?this.CheckTweensWithTags(e,M0.TweenState.IsPing):1===t&&this.CheckTweensWithTags(e,M0.TweenState.IsPong)},IsAnyPingPong(e){return 0===e?this.CheckTweens(M0.TweenState.IsPing):1===e&&this.CheckTweens(M0.TweenState.IsPong)}}}{const ab=self.C3,bb=self.Ease,cb=ab.Behaviors.Tween;cb.Acts={SetEnabled(e){this.SetEnabled(!!e)},async TweenOneProperty(...e){if(this.IsEnabled()&&this.IsInstanceValid()){const t=this.CreateTween(cb.TweenArguments.OneProperty(this,...e));t.Play()&&await t.GetPlayPromise()}},async TweenTwoProperties(...e){if(this.IsEnabled()&&this.IsInstanceValid()){const t=this.CreateTween(cb.TweenArguments.TwoProperties(this,...e));t.Play()&&await t.GetPlayPromise()}},async TweenValue(...e){if(this.IsEnabled()&&this.IsInstanceValid()){const t=this.CreateTween(cb.TweenArguments.ValueProperty(this,...e));t.Play()&&await t.GetPlayPromise()}},PauseTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Stop()},PauseAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Stop()},ResumeTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Resume()},ResumeAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Resume()},StopTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))this.ReleaseTween(t)},StopAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())this.ReleaseTween(e)},SetOnePropertyTweensEndValue(e,t,s){if(this.IsEnabled()&&this.IsInstanceValid()){const n=ab.Behaviors.Tween.Maps.GetSinglePropertyFromIndex(t);for(const i of this.GetTweens(e))i.BeforeSetEndValues([n]),i.SetEndValue(s,n)}},SetTwoPropertiesTweensEndValue(e,t,s,n){if(this.IsEnabled()&&this.IsInstanceValid()){const i=ab.Behaviors.Tween.Maps.GetRealProperties(t);for(const r of this.GetTweens(e))r.BeforeSetEndValues(i),r.SetEndValue(s,i[0]),r.SetEndValue(n,i[1])}},SetValuePropertyTweensStartValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.SetStartValue(t,"value")},SetValuePropertyTweensEndValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.BeforeSetEndValues(["value"]),s.SetEndValue(t,"value")},SetTweensEase(e,t){if(this.IsEnabled()&&this.IsInstanceValid()){const s=bb.GetEaseFromIndex(t);for(const n of this.GetTweens(e))n.SetEase(s)}},SetAllTweensEase(e){if(this.IsEnabled()&&this.IsInstanceValid()){const t=bb.GetEaseFromIndex(e);for(const s of this.AllTweens())s.SetEase(t)}},SetTweensTime(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetTime(t)},SetAllTweensTime(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetTime(e)},SetTweensPlaybackRate(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetPlaybackRate(t)},SetAllTweensPlaybackRate(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetPlaybackRate(e)},SetTweensDestroyOnComplete(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetDestroyInstanceOnComplete(!!t)},SetAllTweensDestroyOnComplete(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetDestroyInstanceOnComplete(!!e)}}}{const e1=self.C3;e1.Behaviors.Tween.Exps={Time(e){const t=this.GetTweenIncludingWaitingForRelease(e);return t?t.GetTime():0},Progress(e){const t=this.GetTweenIncludingWaitingForRelease(e);return t?t.GetTime()/t.GetTotalTime():0},PlaybackRate(e){const t=this.GetTweenIncludingWaitingForRelease(e);return t?t.GetPlaybackRate():0},Value(e){const t=this.GetTweenIncludingWaitingForRelease(e,"value");return t?t.GetPropertyTrack("value").GetSourceAdapterValue():0},Tags(){let e=this.GetFinishingTween();return(e=e||this.GetTriggerTween())?e.GetStringTags():""}}}{const C33=self.C3,Ease=self.Ease,PAIR_PROPERTIES=["position","size","scale"],SINGLE_PROPERTIES=["offsetX","offsetY","offsetWidth","offsetHeight","offsetAngle","offsetOpacity","offsetColor","offsetZElevation","offsetScaleX","offsetScaleY"],VALUE_PROPERTIES=["value"],PROPERTY_INDEX_TO_NAME=[].concat(PAIR_PROPERTIES).concat(SINGLE_PROPERTIES).concat(VALUE_PROPERTIES),PROPERTY_PAIR_TO_REAL_PROPERTIES={position:["offsetX","offsetY"],size:["offsetWidth","offsetHeight"],scale:["offsetScaleX","offsetScaleY"]},ALL_REAL_PROPERTIES=Object.assign({},PROPERTY_INDEX_TO_NAME.reduce((e,t)=>Object.assign({},e,{[t]:[t]}),{}),PROPERTY_PAIR_TO_REAL_PROPERTIES);C33.Behaviors.Tween.Maps=class{constructor(){}static GetEases(){return[...Ease.GetRuntimeEaseNames()]}static GetEaseFromIndex(e){return[...Ease.GetRuntimeEaseNames()][e]}static GetPropertyFromIndex(e){return PROPERTY_INDEX_TO_NAME[e]}static GetPropertyIndexFromName(e){return PROPERTY_INDEX_TO_NAME.indexOf(e)}static GetPairPropertyFromIndex(e){return PAIR_PROPERTIES[e]}static GetSinglePropertyFromIndex(e){return SINGLE_PROPERTIES[e]}static GetValuePropertyFromIndex(e){return VALUE_PROPERTIES[e]}static GetPairProperties(e){return PROPERTY_PAIR_TO_REAL_PROPERTIES[e]}static GetRealProperties(e){return C33.IsString(e)?ALL_REAL_PROPERTIES[e]:ALL_REAL_PROPERTIES[PROPERTY_INDEX_TO_NAME[e]]}static IsPairId(e){return!!PROPERTY_PAIR_TO_REAL_PROPERTIES[e]}static IsColorId(e){return"offsetColor"===e}static IsAngleId(e){return"offsetAngle"===e}static IsOpacityId(e){return"offsetOpacity"===e}static IsValueId(e){return"value"===e}}}{const C33=self.C3,NAMESPACE=C33.Behaviors.Tween,TWEEN_CONFIGURATIONS=new Map;NAMESPACE.Config=class{constructor(){}static GetPropertyTracksConfig(e,t,s,n,i,r){0===TWEEN_CONFIGURATIONS.size&&this._CreateConfigObjects();let a=NAMESPACE.PropertyTypes.Pick(e),o=TWEEN_CONFIGURATIONS.get(a);return C33.IsFiniteNumber(e)&&(e=NAMESPACE.Maps.GetPropertyFromIndex(e)),this._GetConfig(o,e,t,s,n,i,r)}static TransformValue(e,t){const s=C33.Behaviors.Tween.GetPropertyTracksConfig(e);return s.valueGetter(t)}static _CreateConfigObjects(){const e=NAMESPACE.PropertyTypes,t=NAMESPACE.ValueGetters;this._AddConfigObject(e.PAIR,this._GetPairConfig,t._GetPropertyValue),this._AddConfigObject(e.COLOR,this._GetColorConfig,t._GetColorPropertyValue),this._AddConfigObject(e.ANGLE,this._GetAngleConfig,t._GetPropertyAngleValue),this._AddConfigObject(e.VALUE,this._GetValueConfig,t._GetPropertyValue),this._AddConfigObject(e.OTHER,this._GetCommonConfig,t._GetPropertyValue)}static _AddConfigObject(e,t,s){TWEEN_CONFIGURATIONS.set(e,this._CreateConfigObject(e,t,s))}static _CreateConfigObject(e,t,s){return{name:e,configFunc:t,valueGetter:s}}static _GetConfig(e,t,s,n,i,r,a){return e.configFunc(t,e.valueGetter(s),e.valueGetter(n),i,r,a)}static _GetPairConfig(e,s,n,i,r,t){const a=NAMESPACE.Maps.GetPairProperties(e);return a.map((e,t)=>({sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:s[t],endValue:n[t],ease:NAMESPACE.Maps.GetEaseFromIndex(i),resultMode:r}))}static _GetColorConfig(e,t,s,n,i,r){return C33.Plugins.Text&&r.GetPlugin()instanceof C33.Plugins.Text?{sourceId:"plugin",sourceArgs:[7],property:"color",type:"color",valueType:"color",startValue:t,endValue:s,ease:NAMESPACE.Maps.GetEaseFromIndex(n),resultMode:i}:{sourceId:"world-instance",property:e,type:"color",valueType:"color",startValue:t,endValue:s,ease:NAMESPACE.Maps.GetEaseFromIndex(n),resultMode:i}}static _GetAngleConfig(e,t,s,n,i,r){return{sourceId:"world-instance",property:e,type:"angle",valueType:"angle",startValue:t,endValue:s,ease:NAMESPACE.Maps.GetEaseFromIndex(n),resultMode:i}}static _GetCommonConfig(e,t,s,n,i,r){return{sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:t,endValue:s,ease:NAMESPACE.Maps.GetEaseFromIndex(n),resultMode:i}}static _GetValueConfig(e,t,s,n,i,r){return{sourceId:"value",property:e,type:"float",valueType:"numeric",startValue:t,endValue:s,ease:NAMESPACE.Maps.GetEaseFromIndex(n),resultMode:i}}}}{const C33=self.C3,NAMESPACE=C33.Behaviors.Tween,COMMON_FIXED_ARGS={resultMode:"absolute"},COMMON_VARIABLE_ARGS=Object.assign({},COMMON_FIXED_ARGS,{tags:"",property:"",time:0,ease:0,releaseOnComplete:0,loop:!1,pingPong:!1,repeatCount:1}),ONE_PROPERTY_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:0,endValue:0}),TWO_PROPERTIES_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:[0,0],endValue:[0,0]}),COLOR_PROPERTY_ARGS=Object.assign({},COMMON_VARIABLE_ARGS,{initialValueMode:"current-state",startValue:[0,0,0],endValue:[0,0,0]}),VALUE_PROPERTY_ARGS=Object.assign({},ONE_PROPERTY_ARGS,{initialValueMode:"start-value"}),X=0,Y=1,R=0,G=1,B=2;NAMESPACE.TweenArguments=class{constructor(){}static _SetCommonProperties(e,t,s,n,i,r,a,o){e.tags=t,e.time=s,e.ease=n,e.releaseOnComplete=i,e.loop=r,e.pingPong=a,e.repeatCount=o}static OneProperty(e,t,s,n,i,r,a,o,l,h){const c="string"==typeof s?s:NAMESPACE.Maps.GetSinglePropertyFromIndex(s),u=NAMESPACE.Maps.IsColorId(c)?COLOR_PROPERTY_ARGS:ONE_PROPERTY_ARGS;return this._SetCommonProperties(u,t,i,r,a,o,l,h),NAMESPACE.Maps.IsColorId(c)?(COLOR_PROPERTY_ARGS.endValue[R]=C33.GetRValue(n),COLOR_PROPERTY_ARGS.endValue[G]=C33.GetGValue(n),COLOR_PROPERTY_ARGS.endValue[B]=C33.GetBValue(n),COLOR_PROPERTY_ARGS.property=NAMESPACE.Maps.GetPropertyIndexFromName(c)):NAMESPACE.Maps.IsOpacityId(c)?ONE_PROPERTY_ARGS.endValue=n/100:ONE_PROPERTY_ARGS.endValue=n,u.property=NAMESPACE.Maps.GetPropertyIndexFromName(c),u}static TwoProperties(e,t,s,n,i,r,a,o,l,h,c){this._SetCommonProperties(TWO_PROPERTIES_ARGS,t,r,a,o,l,h,c);const u="string"==typeof s?s:NAMESPACE.Maps.GetPairPropertyFromIndex(s);return TWO_PROPERTIES_ARGS.endValue[X]=n,TWO_PROPERTIES_ARGS.endValue[Y]=i,TWO_PROPERTIES_ARGS.property=NAMESPACE.Maps.GetPropertyIndexFromName(u),TWO_PROPERTIES_ARGS}static ValueProperty(e,t,s,n,i,r,a,o,l,h){return this._SetCommonProperties(VALUE_PROPERTY_ARGS,t,i,r,a,o,l,h),VALUE_PROPERTY_ARGS.startValue=s,VALUE_PROPERTY_ARGS.endValue=n,VALUE_PROPERTY_ARGS.property=NAMESPACE.Maps.GetPropertyIndexFromName("value"),VALUE_PROPERTY_ARGS}}}{const C33=self.C3,NAMESPACE=C33.Behaviors.Tween,TYPE_CHECK_OBJECTS=[];NAMESPACE.PropertyTypes=class{constructor(){}static Pick(e){if(0===TYPE_CHECK_OBJECTS.length){const t=TYPE_CHECK_OBJECTS;t.push({checkFunc:NAMESPACE.Maps.IsPairId,result:this.PAIR}),t.push({checkFunc:NAMESPACE.Maps.IsColorId,result:this.COLOR}),t.push({checkFunc:NAMESPACE.Maps.IsAngleId,result:this.ANGLE}),t.push({checkFunc:NAMESPACE.Maps.IsValueId,result:this.VALUE}),t.push({checkFunc:()=>!0,result:this.OTHER})}C33.IsFiniteNumber(e)&&(e=C33.Behaviors.Tween.Maps.GetPropertyFromIndex(e));for(const s of TYPE_CHECK_OBJECTS)if(s.checkFunc(e))return s.result}static get PAIR(){return"pair"}static get COLOR(){return"color"}static get ANGLE(){return"angle"}static get VALUE(){return"value"}static get OTHER(){return"other"}}}{const C33=self.C3,NAMESPACE=C33.Behaviors.Tween;NAMESPACE.ValueGetters=class{constructor(){}static _GetPropertyAngleValue(e){const t=C33.toRadians(parseFloat(e));return C33.clampAngle(t)}static _GetColorPropertyValue(e){return e.slice(0)}static _GetPropertyValue(e){return e}}}{let getIndexForEase2=function(e){C3X.RequireString(e);let t=Ease.ToInternal(e),s;if(-1===(s=t?Ease.GetIndexForEase(t,null):Ease.GetIndexForEase(e,null)))throw new Error(`invalid ease name '${e}'`);return s},ValidateTags2=function(e,t=!1){if(!(t&&null==e||"string"==typeof e||Array.isArray(e)))throw new Error("invalid tags")};getIndexForEase=getIndexForEase2,ValidateTags=ValidateTags2;const C33=self.C3,C3X=self.C3X,IBehaviorInstance=self.IBehaviorInstance,Ease=self.Ease,NAMESPACE=C33.Behaviors.Tween,map=new WeakMap,TWEEN_PROPERTIES=new Map([["x",{name:"offsetX",type:"one"}],["y",{name:"offsetY",type:"one"}],["width",{name:"offsetWidth",type:"one"}],["height",{name:"offsetHeight",type:"one"}],["angle",{name:"offsetAngle",type:"one"}],["opacity",{name:"offsetOpacity",type:"one"}],["color",{name:"offsetColor",type:"color"}],["z-elevation",{name:"offsetZElevation",type:"one"}],["x-scale",{name:"offsetScaleX",type:"one"}],["y-scale",{name:"offsetScaleY",type:"one"}],["position",{name:"position",type:"two"}],["size",{name:"size",type:"two"}],["scale",{name:"scale",type:"two"}],["value",{name:"value",type:"value"}]]),TWEEN_OPTS={tags:"",destroyOnComplete:!1,loop:!1,pingPong:!1,repeatCount:1,startValue:0},I_TWEEN_OPTS={easeToIndexFunc:getIndexForEase2};self.ITweenBehaviorInstance=class extends IBehaviorInstance{constructor(){super(),map.set(this,IBehaviorInstance._GetInitInst().GetSdkInstance())}startTween(e,t,s,n,i){const r=map.get(this);if(!r.IsEnabled()||!r.IsInstanceValid())return null;const a=TWEEN_PROPERTIES.get(e);if(!a)throw new Error("invalid tween property");"one"===a.type||"value"===a.type?C3X.RequireNumber(t):(C3X.RequireArray(t),"two"===a.type?(C3X.RequireNumber(t[0]),C3X.RequireNumber(t[1])):"color"===a.type&&(C3X.RequireNumber(t[0]),C3X.RequireNumber(t[1]),C3X.RequireNumber(t[2]))),"angle"===e?t=C33.toDegrees(t):"opacity"===e?t*=100:"color"===e&&(t=C33.PackRGBEx(t[0],t[1],t[2]));const o=getIndexForEase2(n);C3X.RequireFiniteNumber(s),i=Object.assign({},TWEEN_OPTS,i),"value"===a.type&&C3X.RequireNumber(i.startValue),ValidateTags2(i.tags,!0);let l;if("one"===a.type||"color"===a.type?l=r.CreateTween(NAMESPACE.TweenArguments.OneProperty(r,i.tags,a.name,t,s,o,!!i.destroyOnComplete,!!i.loop,!!i.pingPong,i.repeatCount)):"two"===a.type?l=r.CreateTween(NAMESPACE.TweenArguments.TwoProperties(r,i.tags,a.name,t[0],t[1],s,o,!!i.destroyOnComplete,!!i.loop,!!i.pingPong,i.repeatCount)):"value"===a.type&&(l=r.CreateTween(NAMESPACE.TweenArguments.ValueProperty(r,i.tags,i.startValue,t,s,o,!!i.destroyOnComplete,!!i.loop,!!i.pingPong,i.repeatCount))),l.Play())return l.GetITweenState(r,I_TWEEN_OPTS);throw new Error("failed to start tween")}*allTweens(){const e=map.get(this);for(const t of e.AllTweens())yield t.GetITweenState(e,I_TWEEN_OPTS)}*tweensByTags(e){ValidateTags2(e);const t=map.get(this);for(const s of t.GetTweens(e))yield s.GetITweenState(t,I_TWEEN_OPTS)}get isEnabled(){return map.get(this).IsEnabled()}set isEnabled(e){map.get(this).SetEnabled(e)}}}{const a=self.C3;a.Behaviors.Sin=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.Sin.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=self.C3X,i=self.IBehaviorInstance,j=0,k=1,l=2,m=3,n=4,o=5,p=6,q=7,r=8,s=0,t=1,u=2,v=3,w=4,x=5,y=6,z=7,A=8,B=9,C=0,D=1,E=2,F=3,G=4,H=2*Math.PI,I=Math.PI/2,J=3*Math.PI/2,K=[0,1,8,3,4,2,5,6,9,7],L=(g.Behaviors.Sin.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._i=0,this._movement=0,this._wave=0,this._period=0,this._mag=0,this._isEnabled=!0,this._basePeriod=0,this._basePeriodOffset=0,this._baseMag=0,this._periodRandom=0,this._periodOffsetRandom=0,this._magnitudeRandom=0,this._initialValue=0,this._initialValue2=0,this._lastKnownValue=0,this._lastKnownValue2=0,this._ratio=0,t&&(this._movement=K[t[j]],this._wave=t[k],this._periodRandom=this._runtime.Random()*t[m],this._basePeriod=t[l],this._period=t[l],this._period+=this._periodRandom,this._basePeriodOffset=t[n],0!==this._period&&(this._periodOffsetRandom=this._runtime.Random()*t[o],this._i=t[n]/this._period*H,this._i+=this._periodOffsetRandom/this._period*H),this._magnitudeRandom=this._runtime.Random()*t[q],this._baseMag=t[p],this._mag=t[p],this._mag+=this._magnitudeRandom,this._isEnabled=!!t[r]),this._movement===x&&(this._mag=g.toRadians(this._mag)),this.Init(),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{i:this._i,e:this._isEnabled,mv:this._movement,w:this._wave,p:this._period,mag:this._mag,iv:this._initialValue,iv2:this._initialValue2,r:this._ratio,lkv:this._lastKnownValue,lkv2:this._lastKnownValue2}}LoadFromJson(e){this._i=e.i,this._SetEnabled(e.e),this._movement=e.mv,this._wave=e.w,this._period=e.p,this._mag=e.mag,this._initialValue=e.iv,this._initialValue2=e.iv2,this._ratio=e.r,this._lastKnownValue=e.lkv,this._lastKnownValue2=e.lkv2}Init(){const e=this._inst.GetWorldInfo();switch(this._movement){case s:this._initialValue=e.GetX();break;case t:this._initialValue=e.GetY();break;case u:this._initialValue=e.GetWidth(),this._ratio=e.GetHeight()/e.GetWidth();break;case v:this._initialValue=e.GetWidth();break;case w:this._initialValue=e.GetHeight();break;case x:this._initialValue=e.GetAngle();break;case y:this._initialValue=e.GetOpacity();break;case z:this._initialValue=0;break;case A:this._initialValue=e.GetX(),this._initialValue2=e.GetY();break;case B:this._initialValue=e.GetZElevation()}this._lastKnownValue=this._initialValue,this._lastKnownValue2=this._initialValue2}WaveFunc(e){switch(e%=H,this._wave){case C:return Math.sin(e);case D:return e<=I?e/I:e<=J?1-2*(e-I)/Math.PI:(e-J)/I-1;case E:return 2*e/H-1;case F:return-2*e/H+1;case G:return e<Math.PI?-1:1}return 0}Tick(){const e=this._runtime.GetDt(this._inst);this._isEnabled&&0!==e&&(0===this._period?this._i=0:this._i=(this._i+e/this._period*H)%H,this._UpdateFromPhase())}_UpdateFromPhase(){const e=this._inst.GetWorldInfo();switch(this._movement){case s:e.GetX()!==this._lastKnownValue&&(this._initialValue+=e.GetX()-this._lastKnownValue),e.SetX(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetX();break;case t:e.GetY()!==this._lastKnownValue&&(this._initialValue+=e.GetY()-this._lastKnownValue),e.SetY(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetY();break;case u:e.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag),e.SetHeight(e.GetWidth()*this._ratio);break;case v:e.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case w:e.SetHeight(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case x:e.GetAngle()!==this._lastKnownValue&&(this._initialValue=g.clampAngle(this._initialValue+(e.GetAngle()-this._lastKnownValue))),e.SetAngle(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetAngle();break;case y:e.SetOpacity(this._initialValue+this.WaveFunc(this._i)*this._mag/100);break;case A:e.GetX()!==this._lastKnownValue&&(this._initialValue+=e.GetX()-this._lastKnownValue),e.GetY()!==this._lastKnownValue2&&(this._initialValue2+=e.GetY()-this._lastKnownValue2),e.SetX(this._initialValue+Math.cos(e.GetAngle())*this.WaveFunc(this._i)*this._mag),e.SetY(this._initialValue2+Math.sin(e.GetAngle())*this.WaveFunc(this._i)*this._mag),this._lastKnownValue=e.GetX(),this._lastKnownValue2=e.GetY();break;case B:e.SetZElevation(this._initialValue+this.WaveFunc(this._i)*this._mag)}e.SetBboxChanged()}_OnSpriteFrameChanged(e,t){}_SetPeriod(e){this._period=e}_GetPeriod(){return this._period}_SetMagnitude(e){this._mag=e}_SetMagnitude_ConvertAngle(e){5===this._movement&&(e=g.toRadians(e)),this._SetMagnitude(e)}_GetMagnitude(){return this._mag}_GetMagnitude_ConvertAngle(){let e=this._GetMagnitude();return 5===this._movement?g.toDegrees(e):e}_SetMovement(e){5===this._movement&&5!==e&&(this._mag=g.toDegrees(this._mag)),this._movement=e,this.Init()}_GetMovement(){return this._movement}_SetWave(e){this._wave=e}_GetWave(){return this._wave}_SetPhase(e){this._i=g.clamp(e,0,2*Math.PI),this._UpdateFromPhase()}_GetPhase(){return this._i}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case j:return this._movement;case k:return this._wave;case l:return this._basePeriod;case p:return this._baseMag;case r:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case j:this._movement=K[t],this.Init();break;case k:this._wave=t;break;case l:this._basePeriod=t,this._period=this._basePeriod+this._periodRandom,this._isEnabled||(0!==this._period?(this._i=this._basePeriodOffset/this._period*H,this._i+=this._periodOffsetRandom/this._period*H):this._i=0);break;case p:this._baseMag=t,this._mag=this._baseMag+this._magnitudeRandom,this._movement===x&&(this._mag=g.toRadians(this._mag));break;case r:this._isEnabled=!!t}}GetDebuggerProperties(){const e="behaviors.sin";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:e+".properties.period.name",value:this._GetPeriod(),onedit:e=>this._SetPeriod(e)},{name:e+".properties.magnitude.name",value:this._GetMagnitude_ConvertAngle(),onedit:e=>this._SetMagnitude_ConvertAngle(e)},{name:e+".debugger.value",value:this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}]}]}GetScriptInterfaceClass(){return self.ISineBehaviorInstance}},new WeakMap),M=["horizontal","vertical","size","width","height","angle","opacity","value-only","forwards-backwards","z-elevation"],N=["sine","triangle","sawtooth","reverse-sawtooth","square"];self.ISineBehaviorInstance=class extends i{constructor(){super(),L.set(this,i._GetInitInst().GetSdkInstance())}set period(e){h.RequireFiniteNumber(e),L.get(this)._SetPeriod(e)}get period(){return L.get(this)._GetPeriod()}set magnitude(e){h.RequireFiniteNumber(e),L.get(this)._SetMagnitude(e)}get magnitude(){return L.get(this)._GetMagnitude()}set phase(e){L.get(this)._SetPhase(e)}get phase(){return L.get(this)._GetPhase()}set movement(e){h.RequireString(e);const t=M.indexOf(e);if(-1===t)throw new Error("invalid movement");L.get(this)._SetMovement(t)}get movement(){return M[L.get(this)._GetMovement()]}set wave(e){h.RequireString(e);const t=N.indexOf(e);if(-1===t)throw new Error("invalid wave");L.get(this)._SetWave(t)}get wave(){return N[L.get(this)._GetWave()]}get value(){const e=L.get(this);return e.WaveFunc(e._GetPhase())*e._GetMagnitude()}updateInitialState(){L.get(this).Init()}set isEnabled(e){L.get(this)._SetEnabled(!!e)}get isEnabled(){return L.get(this)._IsEnabled()}}}{const va=self.C3;va.Behaviors.Sin.Cnds={IsEnabled(){return this._IsEnabled()},CompareMovement(e){return this._GetMovement()===e},ComparePeriod(e,t){return va.compare(this._GetPeriod(),e,t)},CompareMagnitude(e,t){return va.compare(this._GetMagnitude_ConvertAngle(),e,t)},CompareWave(e){return this._GetWave()===e}}}{const Ca=self.C3;Ca.Behaviors.Sin.Acts={SetEnabled(e){this._SetEnabled(0!==e)},SetPeriod(e){this._SetPeriod(e)},SetMagnitude(e){this._SetMagnitude_ConvertAngle(e)},SetMovement(e){this._SetMovement(e)},SetWave(e){this._wave=e},SetPhase(e){const t=2*Math.PI;this._SetPhase(e*t%t)},UpdateInitialState(){this.Init()}}}{const Ka=self.C3;Ka.Behaviors.Sin.Exps={CyclePosition(){return this._GetPhase()/(2*Math.PI)},Period(){return this._GetPeriod()},Magnitude(){return this._GetMagnitude_ConvertAngle()},Value(){return this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}}}{const a=self.C3;a.Behaviors.Fade=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.Fade.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=self.C3X,i=self.IBehaviorInstance,j=0,k=1,l=2,m=3,n=4,o=(g.Behaviors.Fade.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._fadeInTime=0,this._waitTime=0,this._fadeOutTime=0,this._destroy=!0,this._activeAtStart=!0,this._setMaxOpacity=!1,this._stage=0,this._stageTime=g.New(g.KahanSum),this._maxOpacity=this._inst.GetWorldInfo().GetOpacity()||1,t&&(this._fadeInTime=t[j],this._waitTime=t[k],this._fadeOutTime=t[l],this._destroy=!!t[m],this._activeAtStart=!!t[n],this._stage=this._activeAtStart?0:3),this._activeAtStart&&(0===this._fadeInTime?(this._stage=1,0===this._waitTime&&(this._stage=2)):(this._inst.GetWorldInfo().SetOpacity(0),this._runtime.UpdateRender())),this._StartTicking()}Release(){super.Release()}SaveToJson(){return{fit:this._fadeInTime,wt:this._waitTime,fot:this._fadeOutTime,d:this._destroy,s:this._stage,st:this._stageTime.Get(),mo:this._maxOpacity}}LoadFromJson(e){this._fadeInTime=e.fit,this._waitTime=e.wt,this._fadeOutTime=e.fot,this._destroy=e.d,this._stage=e.s,this._stageTime.Set(e.st),this._maxOpacity=e.mo,3===this._stage?this._StopTicking():this._StartTicking()}Tick(){const e=this._runtime.GetDt(this._inst),t=(this._stageTime.Add(e),this._inst.GetWorldInfo());0===this._stage&&(t.SetOpacity(this._stageTime.Get()/this._fadeInTime*this._maxOpacity),this._runtime.UpdateRender(),t.GetOpacity()>=this._maxOpacity)&&(t.SetOpacity(this._maxOpacity),this._stage=1,this._stageTime.Reset(),this.DispatchScriptEvent("fadeinend"),this.Trigger(g.Behaviors.Fade.Cnds.OnFadeInEnd)),1===this._stage&&this._stageTime.Get()>=this._waitTime&&(this._stage=2,this._stageTime.Reset(),this.DispatchScriptEvent("waitend"),this.Trigger(g.Behaviors.Fade.Cnds.OnWaitEnd)),2===this._stage&&(0!==this._fadeOutTime?(t.SetOpacity(this._maxOpacity-this._stageTime.Get()/this._fadeOutTime*this._maxOpacity),this._runtime.UpdateRender(),t.GetOpacity()<=0&&(this._stage=3,this._stageTime.Reset(),this.DispatchScriptEvent("fadeoutend"),this.Trigger(g.Behaviors.Fade.Cnds.OnFadeOutEnd),this._destroy)&&this._runtime.DestroyInstance(this._inst)):(this._stage=3,this._stageTime.Reset())),3===this._stage&&this._StopTicking()}_StartFade(){this._activeAtStart||this._setMaxOpacity||(this._maxOpacity=this._inst.GetWorldInfo().GetOpacity()||1,this._setMaxOpacity=!0),3===this._stage&&this.Start()}_RestartFade(){this.Start()}Start(){this._stage=0,this._stageTime.Reset(),0===this._fadeInTime?(this._stage=1,0===this._waitTime&&(this._stage=2)):(this._inst.GetWorldInfo().SetOpacity(0),this._runtime.UpdateRender()),this._StartTicking()}_SetFadeInTime(e){this._fadeInTime=Math.max(e,0)}_GetFadeInTime(){return this._fadeInTime}_SetWaitTime(e){this._waitTime=Math.max(e,0)}_GetWaitTime(){return this._waitTime}_SetFadeOutTime(e){this._fadeOutTime=Math.max(e,0)}_GetFadeOutTime(){return this._fadeOutTime}GetPropertyValueByIndex(e){switch(e){case j:return this._GetFadeInTime();case k:return this._GetWaitTime();case l:return this._GetFadeOutTime();case m:return this._destroy}}SetPropertyValueByIndex(e,t){switch(e){case j:this._SetFadeInTime(t);break;case k:this._SetWaitTime(t);break;case l:this._SetFadeOutTime(t);break;case m:this._destroy=!!t}}GetDebuggerProperties(){const e="behaviors.fade";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".properties.fade-in-time.name",value:this._GetFadeInTime(),onedit:e=>this._SetFadeInTime(e)},{name:e+".properties.wait-time.name",value:this._GetWaitTime(),onedit:e=>this._SetWaitTime(e)},{name:e+".properties.fade-out-time.name",value:this._GetFadeOutTime(),onedit:e=>this._SetFadeOutTime(e)},{name:e+".debugger.stage",value:[e+".debugger."+["fade-in","wait","fade-out","done"][this._stage]]}]}]}GetScriptInterfaceClass(){return self.IFadeBehaviorInstance}},new WeakMap);self.IFadeBehaviorInstance=class extends i{constructor(){super(),o.set(this,i._GetInitInst().GetSdkInstance())}startFade(){o.get(this)._StartFade()}restartFade(){o.get(this)._RestartFade()}set fadeInTime(e){h.RequireFiniteNumber(e),o.get(this)._SetFadeInTime(e)}get fadeInTime(){return o.get(this)._GetFadeInTime()}set waitTime(e){h.RequireFiniteNumber(e),o.get(this)._SetWaitTime(e)}get waitTime(){return o.get(this)._GetWaitTime()}set fadeOutTime(e){h.RequireFiniteNumber(e),o.get(this)._SetFadeOutTime(e)}get fadeOutTime(){return o.get(this)._GetFadeOutTime()}}}{const J=self.C3;J.Behaviors.Fade.Cnds={OnFadeOutEnd(){return!0},OnFadeInEnd(){return!0},OnWaitEnd(){return!0}}}{const K=self.C3;K.Behaviors.Fade.Acts={StartFade(){this._StartFade()},RestartFade(){this._RestartFade()},SetFadeInTime(e){this._SetFadeInTime(e)},SetWaitTime(e){this._SetWaitTime(e)},SetFadeOutTime(e){this._SetFadeOutTime(e)}}}{const O=self.C3;O.Behaviors.Fade.Exps={FadeInTime(){return this._GetFadeInTime()},WaitTime(){return this._GetWaitTime()},FadeOutTime(){return this._GetFadeOutTime()}}}{const a=self.C3;a.Behaviors.Timer=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.Timer.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=self.C3X,i=self.IBehaviorInstance,j=(g.Behaviors.Timer.SingleTimer=class{constructor(e,t,s,n){this._current=g.New(g.KahanSum),this._current.Set(e||0),this._total=g.New(g.KahanSum),this._total.Set(t||0),this._duration=s||0,this._isRegular=!!n,this._isPaused=!1}GetCurrentTime(){return this._current.Get()}GetTotalTime(){return this._total.Get()}GetDuration(){return this._duration}SetPaused(e){this._isPaused=!!e}IsPaused(){return this._isPaused}Add(e){this._current.Add(e),this._total.Add(e)}HasFinished(){return this._current.Get()>=this._duration}Update(){if(this.HasFinished()){if(!this._isRegular)return!0;this._current.Subtract(this._duration)}return!1}SaveToJson(){return{c:this._current.Get(),t:this._total.Get(),d:this._duration,r:this._isRegular,p:this._isPaused}}LoadFromJson(e){this._current.Set(e.c),this._total.Set(e.t),this._duration=e.d,this._isRegular=!!e.r,this._isPaused=!!e.p}},g.Behaviors.Timer.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._timers=new Map}Release(){this._timers.clear(),super.Release()}_StartTimer(e,t,s){const n=new g.Behaviors.Timer.SingleTimer(0,0,e,s);this._timers.set(t.toLowerCase(),n),this._UpdateTickState()}_StopTimer(e){this._timers.delete(e.toLowerCase()),this._UpdateTickState()}_StopAllTimers(){this._timers.clear(),this._UpdateTickState()}_IsTimerRunning(e){return this._timers.has(e.toLowerCase())}_GetTimerCurrentTime(e){const t=this._timers.get(e.toLowerCase());return t?t.GetCurrentTime():0}_GetTimerTotalTime(e){const t=this._timers.get(e.toLowerCase());return t?t.GetTotalTime():0}_GetTimerDuration(e){const t=this._timers.get(e.toLowerCase());return t?t.GetDuration():0}_HasTimerFinished(e){const t=this._timers.get(e.toLowerCase());return!!t&&t.HasFinished()}_SetTimerPaused(e,t){const s=this._timers.get(e.toLowerCase());s&&s.SetPaused(t)}_IsTimerPaused(e){const t=this._timers.get(e.toLowerCase());return!!t&&t.IsPaused()}_SetAllTimersPaused(e){for(const t of this._timers.values())t.SetPaused(e)}_UpdateTickState(){0<this._timers.size?(this._StartTicking(),this._StartTicking2()):(this._StopTicking(),this._StopTicking2())}SaveToJson(){const e={};for(const[t,s]of this._timers.entries())e[t]=s.SaveToJson();return e}LoadFromJson(e){this._timers.clear();for(const[t,s]of Object.entries(e)){const n=new g.Behaviors.Timer.SingleTimer;n.LoadFromJson(s),this._timers.set(t,n)}this._UpdateTickState()}Tick(){const e=this._runtime.GetDt(this._inst);for(const[t,s]of this._timers)s.IsPaused()||(s.Add(e),s.HasFinished()&&this.DispatchScriptEvent("timer",!1,{tag:t}))}Tick2(){for(const[e,t]of this._timers.entries()){const s=t.Update();s&&this._timers.delete(e)}}GetDebuggerProperties(){return[{title:"behaviors.timer.debugger.timers",properties:[...this._timers.entries()].map(e=>({name:"$"+e[0],value:Math.round(10*e[1].GetCurrentTime())/10+" / "+Math.round(10*e[1].GetDuration())/10}))}]}GetScriptInterfaceClass(){return self.ITimerBehaviorInstance}},new WeakMap),k=["once","regular"];self.ITimerBehaviorInstance=class extends i{constructor(){super(),j.set(this,i._GetInitInst().GetSdkInstance())}startTimer(e,t,s="once"){h.RequireFiniteNumber(e),h.RequireString(t);const n=k.indexOf(s);if(-1===n)throw new Error("invalid type");j.get(this)._StartTimer(e,t,1===n)}setTimerPaused(e,t){h.RequireString(e),j.get(this)._SetTimerPaused(e,!!t)}setAllTimersPaused(e){j.get(this)._SetAllTimersPaused(!!e)}stopTimer(e){h.RequireString(e),j.get(this)._StopTimer(e)}stopAllTimers(){j.get(this)._StopAllTimers()}isTimerRunning(e){return h.RequireString(e),j.get(this)._IsTimerRunning(e)}isTimerPaused(e){return h.RequireString(e),j.get(this)._IsTimerPaused(e)}getCurrentTime(e){return h.RequireString(e),j.get(this)._GetTimerCurrentTime(e)}getTotalTime(e){return h.RequireString(e),j.get(this)._GetTimerTotalTime(e)}getDuration(e){return h.RequireString(e),j.get(this)._GetTimerDuration(e)}hasFinished(e){return h.RequireString(e),j.get(this)._HasTimerFinished(e)}}}{const sa=self.C3;sa.Behaviors.Timer.Cnds={OnTimer(e){return this._HasTimerFinished(e)},IsTimerRunning(e){return this._IsTimerRunning(e)},IsTimerPaused(e){return this._IsTimerPaused(e)}}}{const wa=self.C3;wa.Behaviors.Timer.Acts={StartTimer(e,t,s){this._StartTimer(e,s,1===t)},StopTimer(e){this._StopTimer(e)},StopAllTimers(){this._StopAllTimers()},PauseResumeTimer(e,t){this._SetTimerPaused(e,0===t)},PauseResumeAllTimers(e){this._SetAllTimersPaused(0===e)}}}{const Ea=self.C3;Ea.Behaviors.Timer.Exps={CurrentTime(e){return this._GetTimerCurrentTime(e)},TotalTime(e){return this._GetTimerTotalTime(e)},Duration(e){return this._GetTimerDuration(e)}}}{const a=self.C3;a.Behaviors.Rotate=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.Rotate.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=self.C3X,i=self.IBehaviorInstance,j=0,k=1,l=2,m=(g.Behaviors.Rotate.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._speed=0,this._acceleration=0,this._isEnabled=!0,t&&(this._speed=g.toRadians(t[j]),this._acceleration=g.toRadians(t[k]),this._isEnabled=t[l]),this._isEnabled&&this._StartTicking()}Release(){super.Release()}_SetSpeed(e){this._speed=e}_GetSpeed(){return this._speed}_SetAcceleration(e){this._acceleration=e}_GetAcceleration(){return this._acceleration}SaveToJson(){return{s:this._speed,a:this._acceleration,e:this._isEnabled}}LoadFromJson(e){this._speed=e.s,this._acceleration=e.a,this._SetEnabled(e.e)}Tick(){if(this._isEnabled){const e=this._runtime.GetDt(this._inst);if(0!==e&&(0!==this._acceleration&&(this._speed+=this._acceleration*e),0!==this._speed)){const t=this._inst.GetWorldInfo();t.SetAngle(t.GetAngle()+this._speed*e),t.SetBboxChanged()}}}GetPropertyValueByIndex(e){switch(e){case j:return g.toDegrees(this._GetSpeed());case k:return g.toDegrees(this._GetAcceleration());case l:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case j:this._SetSpeed(g.toRadians(t));break;case k:this._SetAcceleration(g.toRadians(t));break;case l:this._SetEnabled(t)}}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){const e="behaviors.rotate";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".properties.speed.name",value:g.toDegrees(this._GetSpeed()),onedit:e=>this._SetSpeed(g.toRadians(e))},{name:e+".properties.acceleration.name",value:g.toDegrees(this._GetAcceleration()),onedit:e=>this._SetAcceleration(g.toRadians(e))},{name:e+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IRotateBehaviorInstance}},new WeakMap);self.IRotateBehaviorInstance=class extends i{constructor(){super(),m.set(this,i._GetInitInst().GetSdkInstance())}set speed(e){h.RequireFiniteNumber(e),m.get(this)._SetSpeed(e)}get speed(){return m.get(this)._GetSpeed()}set acceleration(e){h.RequireFiniteNumber(e),m.get(this)._SetAcceleration(e)}get acceleration(){return m.get(this)._GetAcceleration()}get isEnabled(){return m.get(this)._IsEnabled()}set isEnabled(e){m.get(this)._SetEnabled(e)}}}{const H=self.C3;H.Behaviors.Rotate.Cnds={IsEnabled(){return this._IsEnabled()}}}{const I=self.C3;I.Behaviors.Rotate.Acts={SetSpeed(e){this._SetSpeed(I.toRadians(e))},SetAcceleration(e){this._SetAcceleration(I.toRadians(e))},SetEnabled(e){this._SetEnabled(e)}}}{const M=self.C3;M.Behaviors.Rotate.Exps={Speed(){return M.toDegrees(this._GetSpeed())},Acceleration(){return M.toDegrees(this._GetAcceleration())}}}{const a=self.C3;a.Behaviors.wrap=class extends a.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const d=self.C3;d.Behaviors.wrap.Type=class extends d.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const g=self.C3,h=0,i=new g.Rect;g.Behaviors.wrap.Instance=class extends g.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._mode=0,t&&(this._mode=t[h]),this._StartTicking()}Release(){super.Release()}SaveToJson(){return{m:this._mode}}LoadFromJson(e){this._mode=e.m}Tick(){const e=this._inst.GetWorldInfo(),t=e.GetLayer(),s=t.GetLayout(),n=e.GetBoundingBox();0===this._mode?i.set(0,0,s.GetWidth(),s.GetHeight()):i.copy(t.GetViewport()),n.getRight()<i.getLeft()?(e.SetX(i.getRight()-1+(e.GetX()-n.getLeft())),e.SetBboxChanged()):n.getLeft()>i.getRight()?(e.SetX(i.getLeft()+1-(n.getRight()-e.GetX())),e.SetBboxChanged()):n.getBottom()<i.getTop()?(e.SetY(i.getBottom()-1+(e.GetY()-n.getTop())),e.SetBboxChanged()):n.getTop()>i.getBottom()&&(e.SetY(i.getTop()+1-(n.getBottom()-e.GetY())),e.SetBboxChanged())}GetPropertyValueByIndex(e){if(e===h)return this._mode}SetPropertyValueByIndex(e,t){e===h&&(this._mode=t)}}}{const u=self.C3;u.Behaviors.wrap.Cnds={}}{const v=self.C3;v.Behaviors.wrap.Acts={}}{const w=self.C3;w.Behaviors.wrap.Exps={}}{let unaryminus2=function(e){return"number"==typeof e?-e:e},bothNumbers2=function(e,t){return"number"==typeof e&&"number"==typeof t},add2=function(e,t){return bothNumbers2(e,t)?e+t:e},subtract2=function(e,t){return bothNumbers2(e,t)?e-t:e},multiply2=function(e,t){return bothNumbers2(e,t)?e*t:e},divide2=function(e,t){return bothNumbers2(e,t)?e/t:e},mod2=function(e,t){return bothNumbers2(e,t)?e%t:e},pow2=function(e,t){return bothNumbers2(e,t)?Math.pow(e,t):e},and2=function(s,n){if("string"!=typeof s&&"string"!=typeof n)return s&&n?1:0;{let e,t;return e="number"==typeof s?(Math.round(1e10*s)/1e10).toString():s,t="number"==typeof n?(Math.round(1e10*n)/1e10).toString():n,e+t}},or2=function(e,t){return bothNumbers2(e,t)?e||t?1:0:e};unaryminus=unaryminus2,bothNumbers=bothNumbers2,add=add2,subtract=subtract2,multiply=multiply2,divide=divide2,mod=mod2,pow=pow2,and=and2,or=or2;const C33=self.C3;self.C3_ExpressionFuncs=[()=>"all",()=>"Tap earn logic",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t()},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetVar();return()=>C33.clamp(t.GetValue()-s.GetValue(),0,n.GetValue())},()=>"energy",()=>.235,()=>.1,()=>.24,()=>"Tutorial",()=>"total_coins",e=>{const t=e._GetNode(0).GetVar();return()=>C33.clamp(t.GetValue(),0,5)},()=>"coin",()=>1,e=>{const t=e._GetNode(0).GetBoundMethod();return()=>.1*t()},()=>"Modals",()=>"",()=>"collected",e=>{const t=e._GetNode(0);return()=>t.ExpObject()},()=>.25,e=>{const t=e._GetNode(0).GetVar();return()=>.1*t.GetValue()+.25},()=>"coins",()=>"drop",()=>"Drops & Boosters",()=>0,()=>"boost",()=>"leaderboards",()=>"Leaderboards",()=>"Game",()=>"Handle Notifications",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("offline-gains")},()=>"lastPassiveEarn",()=>"Passive Income",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>"While you were gone, the lab has generated revenue for you.\n\n[icon=coins] "+t(s.ExpObject("lastPassiveEarn"))},()=>"Awesome",()=>"destroy",()=>"offline-gains",e=>{const t=e._GetNode(0);return()=>t.ExpObject("notifications")},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".content.type"},()=>"FOUND_MONSTER",()=>"monster-discovered",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".id")},()=>"slug",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(and2("clan-invite-",s.ExpObject("slug")))},()=>"Clan Invite",e=>{const t=e._GetNode(0),s=e._GetNode(1),n=e._GetNode(2),i=e._GetNode(3);return()=>and2(and2(and2(and2("You have been invited to a clan:\n\n",t.ExpObject("name"))+" #",s.ExpObject("slug"))+"\n\nMembers: ",n.ExpObject("memberCount"))+"/",i.ExpObject("memberLimit"))},()=>"accept-clan-invite",()=>"Accept",()=>"decline-clan-invite",()=>"Decline",e=>{const t=e._GetNode(0);return()=>and2("clan-invite-",t.ExpObject("slug"))},()=>"MeUpdated",()=>"ClanInviteRecieved",()=>"me",()=>"TapEnergy",()=>"BattleStatus",()=>"battling",e=>{const t=e._GetNode(0);return()=>t.ExpObject("PlayerHP")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("TapEnergy")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("PlayerAction")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("PlayerMonsterID")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("OpponentHP")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("OpponentMonsterID")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("OpponentAction")},()=>"Actions for all ListPages",()=>-1,()=>"Lists",()=>"Drops & Boosters ListPage",()=>"Monsters ListPage",()=>"Upgrades ListPage",()=>"Earn ListPage",()=>"Clan ListPage",()=>"Leaderboards ListPage",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+" ListPage"},()=>"CoverTransition",()=>.2,()=>2,()=>"List",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("List")},()=>"ListMessage",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2),i=e._GetNode(3),r=e._GetNode(4).GetVar();return()=>C33.clamp(t.ExpObject(),s(-n.ExpObject()+(i.ExpObject()+50),0),r.GetValue())},()=>300,()=>-90,()=>30,()=>90,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar(),4)},()=>"http",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()},()=>"Listpage Functions",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod();return()=>t.GetValue()*s("Lists")},()=>455,()=>"leaderboard",()=>"blue",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod();return()=>12+t.GetValue()*s("Lists")},()=>460,e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar();return()=>and2("#",t.GetValue())+" "+s.GetValue()},()=>"lb-score",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()+s.ExpObject()},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetVar(),r=e._GetNode(4).GetVar(),a=e._GetNode(5).GetVar();return()=>and2(and2(and2(and2(t.GetValue()+" "+s.GetValue()+" ",n.GetValue())+" ",i.GetValue())+" ",r.GetValue())+" ",a.GetValue())},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetVar(),r=e._GetNode(4).GetVar();return()=>t.GetValue()*s("Lists")+n.GetValue()+i.GetValue()*(r.GetValue()%2)},e=>{const t=e._GetNode(0).GetVar();return()=>Math.floor(t.GetValue()%2)},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-s.ExpObject()},()=>"upgrade_btn",()=>"monster_btn",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".slug")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".name")},()=>"name",()=>"lvl",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>and2("Lvl ",t.ExpObject(s.GetValue()+".level"))},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".slug"))},()=>"pph",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".level"},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>"+"+t(s.ExpObject(n.GetValue()+".nextLevel.earnPerHour"))},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".earnPerHour"))},()=>"price",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".nextLevel.price"))},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".nextLevel.requirementMet"},()=>"locked",()=>-0x8002000803ff,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".nextLevel.requirementText")},()=>7,()=>"bottom",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".stats.health")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".stats.maxHealth")},()=>-562984313684991,e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".stats.health"},()=>-422221055525887,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2),i=e._GetNode(3).GetVar();return()=>multiply2(100,divide2(t.ExpObject(s.GetValue()+".levelProgress"),n.ExpObject(i.GetValue()+".nextLevel.progressRequired")))},()=>"desc",()=>"???",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".requirementMet"},()=>"requirement",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".requirementText")},()=>"xp",()=>"lock",()=>20,()=>"notFound",()=>"Not found yet",()=>"clans_btn",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".desc")},()=>"bleft",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".bleft")},()=>"bright",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".bright")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".img")},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".unlocked"},()=>"Peer Review",()=>"me.clanMembership.memberCount",()=>-0xc004000c03ff,e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod();return()=>t.GetValue()*s("Lists")+10},()=>"simple-text",e=>{const t=e._GetNode(0);return()=>t.ExpObject()+5},()=>"Monster Research",()=>"Chainmons",()=>"Squad (soon)",()=>"Battle (soon)",e=>{const t=e._GetNode(0);return()=>t.ExpObject("monsters")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(and2("",s.GetValue()))},e=>{const t=e._GetNode(0).GetVar();return()=>and2("monsters.",t.GetValue())},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("invite-friend-upgrade")},()=>"referrals.amount",()=>"Double the amount of daily Monsters you can find by inviting a friend!",()=>"invite-friend",()=>"Invite Friend",()=>"No Thanks",()=>"invite-friend-read",()=>"INTERACTION-Monsters",()=>"invite-friend-upgrade",()=>"monster-info",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(and2("monsters.",s.GetValue())+".stats.health")},()=>"Revive Monster!",()=>"modalHealth",()=>-717706215031807,()=>-717750023016447,()=>.5,()=>"currentHPButton",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(and2("monsters.",s.GetValue())+".stats.maxHealth")},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(and2("monsters.",n.GetValue())+".stats.health"))},e=>{const t=e._GetNode(0);return()=>t.ExpObject("energy.amount")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("energy.max")},()=>"Not Enough Energy!",()=>"Monster Revived!",()=>"monster-modal-hp",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetVar();return()=>t(s.ExpObject(and2("monsters.",n.GetValue())+".stats.health"))/i(r.ExpObject(and2("monsters.",a.GetValue())+".stats.maxHealth"))},()=>"monsterModalHP",()=>"Reviving!",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2),i=e._GetNode(3).GetVar();return()=>and2(and2(t.ExpObject(and2("monsters.",s.GetValue())+".stats.health"),"/"),n.ExpObject(and2("monsters.",i.GetValue())+".stats.maxHealth"))},()=>"hp_message_text",()=>"tapToHeal",()=>"training",()=>100,()=>"Monster Healed!",()=>"Healing!",()=>"HealEffect",()=>"FavMonster",()=>"Upgrade Research",()=>"Lab",()=>"Equipment",()=>"Products",()=>"upgradeCategories.2.requirementMet",()=>"Join the Tapmonsters telegram channel to unlock Products!",()=>"join-telegram-prompt",()=>"Join",()=>"join-telegram",()=>"Verify",()=>"verify-telegram",e=>{const t=e._GetNode(0);return()=>t.ExpObject("upgrades")},e=>{const t=e._GetNode(0).GetVar();return()=>and2("upgrades.",t.GetValue())},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".category"},()=>"LAB",()=>"EQUIPMENT",()=>"PRODUCTS",()=>"INTERACTION-Upgrades",()=>"upgrade-requirement",()=>"upgrade",()=>"upgrade_modal_btn",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+" purchased"},()=>"grey",()=>"Upgrading...",e=>{const t=e._GetNode(0);return()=>t.ExpObject("upgradeCategories.2.requirementLink")},()=>"LeaderBoards ListPage",()=>"Score",()=>"More Soon..",()=>"entries",()=>"score",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject(s.ExpObject()+".rank")},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject(s.ExpObject()+".name")},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2);return()=>"[icon=coins] "+t(s.ExpObject(n.ExpObject()+".score"))},e=>{const t=e._GetNode(0);return()=>t.ExpObject("userEntry.rank")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("userEntry.name")},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>"[icon=coins] "+t(s.ExpObject("userEntry.score"))},()=>"Drops",()=>"Boosters",()=>"Drops will be awarded based on leaderboard position.  TAP HERE to view your current position.",()=>"standard",()=>"view-leaderboard",()=>"boosters",()=>"use_boost",()=>"tap-power",()=>"Upgrade Tap Power",()=>"energy-level",()=>"Upgrade Energy Level",()=>"energy-refill",()=>"Refill Energy",()=>"lab-capacity-increase",()=>"lab-capacity",()=>"energy-refill-ad",()=>"ENERGY_REFILL",()=>"D&B Functions",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+"-price"},()=>-281492157629439,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar();return()=>10+t()*s.GetValue()},()=>"booster",()=>"icon",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".icon")},()=>"currency",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".currency")},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2(and2("\nUsed today: (",t.ExpObject("energy.refill.usedRefills"))+"/",s.ExpObject("energy.refill.maxRefills"))+")"},e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+"-price"},()=>"uses",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+"-uses"},()=>"timer",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()+"-timer"},()=>"tapPower.nextLevel.cost",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue())},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar();return()=>t(s.GetValue())},()=>"MAX",()=>"energy.nextLevel.cost",()=>"energy.refill",()=>10,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".usedRefills")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".maxRefills")},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".coolDownResetMillis"},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2),i=e._GetNode(3).GetVar();return()=>t(s(n.ExpObject(i.GetValue()+".coolDownResetMillis")))},()=>"claim",()=>"READY",()=>6,()=>"INVITE 1 FRIEND",()=>"oneTimePurchases.0",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+".bought"},()=>"BOUGHT",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".price.stars"))},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+"-uses"},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2(and2("Used Today: ",t.ExpObject("adsWatched"))+"/",s.ExpObject("maxAds"))},e=>{const t=e._GetNode(0);return()=>t.ExpObject("adsWatched")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("maxAds")},()=>".adCooldownResetMillis",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2);return()=>" "+t(s(n.ExpObject("adCooldownResetMillis")))},()=>" claim",()=>" Watch Ad",()=>" MAX",()=>"Earn",()=>"Tasks",()=>"Invite",()=>"Daily",()=>"TAP HERE to invite your friends to play.  You recieve a [icon=coins] payout for each successful referal and a % of all their [icon=coins] earnings!",()=>"TAP HERE to claim your daily [icon=coins] reward!",()=>"daily-reward",e=>{const t=e._GetNode(0);return()=>and2("Total Invites: ",t.ExpObject("referrals.amount"))},()=>"category",()=>"REGULAR",()=>"DAILY",()=>"special",()=>"task2",()=>"task",()=>"countdown_button",e=>{const t=e._GetNode(0);return()=>t.ExpObject("link")},e=>{const t=e._GetNode(0);return()=>and2("Open Task Link: ",t.ExpObject("link"))},()=>"orange",()=>"button",()=>"verifying",()=>"daily-streak",()=>"Grayscale",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar())},()=>"RefreshDaily",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2("",t.ExpObject(s.ExpObject()+".number"))},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+".state"},()=>"COLLECTED",()=>"COLLECTABLE",()=>"Earn Functions",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod();return()=>10+t.GetValue()*s("Modals")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("imageUrl")},()=>"connect-wobbl3",()=>"connect-wombat",()=>"join-telegram-channel",e=>{const t=e._GetNode(0);return()=>t.ExpObject("cta")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("text")},()=>"reward",e=>{const t=e._GetNode(0);return()=>t.ExpObject("score")},()=>"done",()=>"true",()=>"Complete",e=>{const t=e._GetNode(0);return()=>"countdown_button_"+t.ExpInstVar()},()=>"verifiableAtMillis",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpObject("verifiableAtMillis"))},()=>"Claim",()=>"New",()=>"clanMembership.memberCount",()=>"No Clan",()=>"Bonus",()=>"Ranking",()=>"Activities",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("Modals")},()=>"no-clan",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2(and2(t.ExpObject("clanMembership.name"),"#"),s.ExpObject("clanMembership.slug"))},()=>"clanTasks",e=>{const t=e._GetNode(0);return()=>t.ExpObject()+".category"},()=>"members",()=>"Tap here to leave your clan",()=>"leave-clan",()=>"invite-to-clan",()=>"show-create-clan-modal",()=>"create-name-clan",()=>"create-clan-now",()=>1e6,()=>"You don't have enough coins",()=>"Please enter a clan name",()=>"show-invite-clan-modal",()=>"copy-invite-to-clan-link",()=>"do-leave-clan",()=>"clanMembership.role",()=>"LEADER",()=>"Leave Clan",()=>"Are you sure you want to leave the clan you created? \n\nThe 1M cost for creating the clan will not be refunded.\n\nAfter you leave the clan the #2 will become the clan leader.",()=>"Leave",()=>"Stay",()=>"Are you sure you want to leave the clan?",()=>"ClanCreated",()=>"clan-created",()=>"min-keyboard",()=>"Clan Functions",()=>"Get me2 contruct project file",()=>"me2",()=>"loaded",()=>"Load Dynamic Icons",()=>999,()=>"msg_icon",()=>"game-version",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>"v"+t()},()=>"Link Copied",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()/3600},e=>{const t=e._GetNode(0);return()=>t.ExpObject("score.current")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("tapPower.yield")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("earnPerHour")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("energy.rechargePerSecond")},()=>"game_earnPerTap",()=>"game_earnPerHour",()=>"game_maxEnergy",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2).GetVar();return()=>t(s(n.GetValue()),5)},()=>"head-daily-chainmons",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2(and2(t.ExpObject("monstersCap.current"),"/"),s.ExpObject("monstersCap.max"))},()=>"Mute",()=>"mute",()=>"false",()=>-100,()=>"Reusable Progress Bar",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>32+t.ExpObject()*(s.GetValue()/100)},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-32},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>32+t.ExpInstVar()*(s.ExpObject()/100)},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-1},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+2},()=>"ReplaceColor",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2).GetBoundMethod(),i=e._GetNode(3),r=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetBoundMethod(),o=e._GetNode(6),l=e._GetNode(7).GetBoundMethod(),h=e._GetNode(8).GetBoundMethod(),c=e._GetNode(9);return()=>t(s(n(i.ExpInstVar(),0,",")),r(a(o.ExpInstVar(),1,",")),l(h(c.ExpInstVar(),2,",")))},()=>"Screen Header",()=>.001,()=>"listXScroll",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetBoundMethod();return()=>t("Lists")+s.ExpInstVar()*n("Lists")},()=>"title",()=>"0",()=>"1",()=>"2",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetBoundMethod();return()=>t("Lists")+s.GetValue()*n("Lists")},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>multiply2(100,divide2(t.ExpObject("level.xp"),s.ExpObject("level.nextLevelRequirement")))},e=>{const t=e._GetNode(0);return()=>and2("Level ",t.ExpObject("level.number"))},()=>"AdjustHSL",()=>115,()=>"ModalLayer",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t()/2},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>1.5*t()},()=>"1-button",()=>"layer",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("ModalLayer")-1},()=>"text",()=>"b1",()=>"2-button",()=>"b2",()=>"Logic for the different types modals",()=>"description",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".description")},()=>"earnPerHour",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".nextLevel.earnPerHour"))},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue()+".nextLevel.requirementImageUrl")},()=>"required-category",()=>"Required",()=>"requirementText",()=>"task1",e=>{const t=e._GetNode(0);return()=>and2("1. ",t.ExpObject("cta"))},e=>{const t=e._GetNode(0).GetVar();return()=>"countdown_button_"+t.GetValue()},()=>"eph",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>and2("Lv. ",t.ExpObject(s.GetValue()+".level"))},()=>"nextLvl",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetBoundMethod(),i=e._GetNode(3),r=e._GetNode(4).GetVar();return()=>and2(and2(t.ExpObject(s.GetValue()+".stats.health"),"/"),n(i.ExpObject(r.GetValue()+".stats.maxHealth")))},()=>"monster-modal-potential-text",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetVar();return()=>and2(and2(.1*t(s.ExpObject(n.GetValue()+".stats.potential")),"/"),i(r.ExpObject(a.GetValue()+".level")))},()=>27,()=>26,()=>"monsterModalStars",()=>"monster-modal-xp",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetVar();return()=>t(s.ExpObject(n.GetValue()+".levelProgress"))/i(r.ExpObject(a.GetValue()+".nextLevel.progressRequired"))*100},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetVar();return()=>t(s.ExpObject(n.GetValue()+".stats.health"))/i(r.ExpObject(a.GetValue()+".stats.maxHealth"))*100},()=>"monster-modal-potential",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetVar();return()=>.1*t(s.ExpObject(n.GetValue()+".stats.potential"))/i(r.ExpObject(a.GetValue()+".level"))*100},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".stats.health"))},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".stats.maxHealth"))},()=>"Tap To Heal",()=>-717723395949567,()=>"Tap To Revive",()=>"modalStats",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2),i=e._GetNode(3).GetVar(),r=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5),o=e._GetNode(6).GetVar(),l=e._GetNode(7),h=e._GetNode(8).GetVar(),c=e._GetNode(9),u=e._GetNode(10).GetVar(),d=e._GetNode(11),_=e._GetNode(12).GetVar(),p=e._GetNode(13),m=e._GetNode(14).GetVar(),g=e._GetNode(15),f=e._GetNode(16).GetVar();return()=>and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(and2(t.ExpObject(s.GetValue()+".name"),"\n"),"LVL:"),n.ExpObject(i.GetValue()+".level")),"\n"),"POT:"),.1*r(a.ExpObject(o.GetValue()+".stats.potential"))),"\n"),"ATK:"),l.ExpObject(h.GetValue()+".stats.attackPower")),"/"),c.ExpObject(u.GetValue()+".stats.baseAttackPower")),"\n"),"DEF:"),d.ExpObject(_.GetValue()+".stats.defense")),"/"),p.ExpObject(m.GetValue()+".stats.baseDefense")),"\n"),"AGI:"),g.ExpObject(f.GetValue()+".stats.baseAgility"))},()=>"notifications.0.content",()=>"notifications.0.content.count",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>and2(" x ",t.ExpObject(s.GetValue()+".count"))},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject(n.GetValue()+".newEarnPerHour"))},()=>"newLvl",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>and2("Level ",t.ExpObject(s.GetValue()+".newLevel"))},()=>"reward1",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>"+"+t(s.ExpObject("referrals.nextBonus"))},()=>"reward2",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>"+"+t(s.ExpObject("referrals.nextPremiumBonus"))},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpObject())},()=>"modalbg",()=>"MessageBox (incl. chipleaf)",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2).GetVar();return()=>t.GetValue()+s("Lists")*n.GetValue()},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-5},()=>"2buttons",()=>1.5,e=>{const t=e._GetNode(0);return()=>t.ExpObject()+67},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+32},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()+s.ExpObject()/2},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("Alerts")+8},()=>25,e=>{const t=e._GetNode(0);return()=>t.ExpObject()+18},()=>"good_msg",()=>.05,()=>"Bottom Menu Bar",()=>.33,()=>.3,()=>.22,()=>"do-invite-friend",()=>"copy-invite-link",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar();return()=>and2("[outlineback=#000000][lineThickness=",t.GetValue())+"]"+s.GetValue()+"[/lineThickness][/outlineback]"},e=>{const t=e._GetNode(0).GetVar();return()=>Math.floor(t.GetValue())},()=>"LocalStorageTools",()=>"FavouriteMonsters",e=>{const t=e._GetNode(0).GetVar();return()=>and2("",t.GetValue())},()=>"FavMonsters",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>and2("",t())},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod();return()=>t(s(n.GetValue()),i())},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod();return()=>t.GetValue()-s()},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetBoundMethod(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4).GetVar();return()=>and2(Math.floor(t(s.GetValue())),":")+n(Math.floor(i(r.GetValue())%60),2)},()=>"0 - Start Layout",()=>-10,()=>"music",()=>"Cover",()=>"BattleAnimation",()=>"TapPower",()=>"Buttons",()=>"Results",()=>"MainUI",()=>"Battle Sequence - Initiate Traning",()=>"Show Enemy Thinking",()=>"Animations & Sequences",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject()-s.GetValue()},()=>400,()=>-500,()=>180,()=>730,()=>-168,()=>"trainingTitle",()=>600,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpObject("OpponentMonsterID"))+"\nApproaches..."},()=>-150,()=>"255,255,255",()=>"trainingBlack",()=>3,()=>"opponentLarge",()=>-300,()=>40,()=>"Final Hit",()=>"opponent",()=>"player",()=>700,()=>-50,e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+"\n Final Attack!"},()=>-200,()=>"255,100,100",()=>"Attack",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+" Victorious!"},()=>"129,250,238",()=>3.5,()=>150,()=>2.5,()=>75,()=>-20,()=>5,()=>"1 - Attack & Block",()=>"attack",()=>"BattleTimer",()=>4.5,()=>"tap_to_power_notice",()=>"block",()=>"2 - Tap Button",e=>{const t=e._GetNode(0);return()=>t.ExpObject("PlayerEnergy")},e=>{const t=e._GetNode(0);return()=>add2(0,t.ExpObject("tapPower.yield"))},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpObject("tapPower.yield"))},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2);return()=>C33.clamp(t.GetValue(),0,s(n.ExpObject("PlayerMaxAttackPower")))},()=>"tapSound",e=>{const t=e._GetNode(0).GetVar();return()=>.5+.002*t.GetValue()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetBoundMethod(),i=e._GetNode(3),r=e._GetNode(4).GetVar();return()=>C33.clamp(subtract2(t.ExpObject("PlayerEnergy"),s.GetValue()*n(i.ExpObject("tapPower.yield"))),0,r.GetValue())},()=>"BattleTapButton",()=>.6,()=>"tapPowerAmount",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1);return()=>and2(and2(t.GetValue(),"/"),s.ExpObject("PlayerMaxAttackPower"))},()=>"battleTimer",()=>"tapPower",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2);return()=>C33.clamp(t.GetValue()/s(n.ExpObject("PlayerMaxAttackPower"))*100,0,100)},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetBoundMethod(),i=e._GetNode(3);return()=>2+C33.clamp(.1*t(subtract2(s.ExpObject("OpponentAgility"),n(i.ExpObject("PlayerAgility")))),0,1e3)},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1);return()=>and2(and2(Math.round(t.GetValue()),"/"),s.ExpObject("PlayerMaxAttackPower"))},()=>"3 - Battle Logic",()=>"PlayerFirstAction",e=>{const t=e._GetNode(0);return()=>t.ExpObject("PlayerDamageDealt")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("OpponentDamageDealt")},()=>"BattleResultAnimation",()=>"OpponentAction",()=>"Check Outcome",e=>{const t=e._GetNode(0);return()=>t.ExpObject("BattleStatus")},()=>"player_win",()=>"opponent_win",()=>"Monsters",()=>"attackSound",()=>.45,()=>"Shield",()=>"ShieldSound",()=>"Recharge",()=>"4 - Show Results",()=>"Win Audio",e=>{const t=e._GetNode(0);return()=>t.ExpObject("EXPEarned")},()=>"resultsText",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4).GetVar(),a=e._GetNode(5);return()=>and2(and2("[color=#009900]",.1*t(add2(s.ExpObject(and2("monsters.",n.GetValue())+".stats.potential"),.1)))+"[/color](+0)\n"+i(r.GetValue())+" [color=#999900](+",a.ExpObject("CoinsEarned"))+")[/color]"},()=>"PickUp",e=>{const t=e._GetNode(0);return()=>t.ExpObject("CoinsEarned")},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4).GetVar(),a=e._GetNode(5);return()=>and2("[color=#009900]",.1*t(add2(s.ExpObject(and2("monsters.",n.GetValue())+".stats.potential"),.1)))+"[/color](+0)\n[color=#999900]"+i(add2(r.GetValue(),a.ExpObject("CoinsEarned")))+"[/color](+0)"},e=>{const t=e._GetNode(0);return()=>C33.clamp(t.ExpObject("CoinsEarned"),0,20)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>.05*t()*1},()=>156,()=>378,()=>"CoinPickup",()=>"Loose Audio",()=>"trainingEXPProgress",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetVar();return()=>.1*t(s.ExpObject(and2("monsters.",n.GetValue())+".stats.potential"))/i(r.ExpObject(and2("monsters.",a.GetValue())+".level"))*100},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar(),i=e._GetNode(3),r=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar(),o=e._GetNode(6);return()=>and2(and2(and2(.1*t(s.ExpObject(and2("monsters.",n.GetValue())+".stats.potential"))," [color=#009900](+"),i.ExpObject("EXPEarned"))+")[/color]\n"+r(a.GetValue())+" [color=#999900](+",o.ExpObject("CoinsEarned"))+")[/color]"},()=>"playerLargeFront",()=>"opponentLargeBack",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpObject("PlayerMonsterID"))},()=>"resultsHeader",()=>"You Win!",()=>"results",()=>"You Lose!",()=>"playerLarge",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpObject("OpponentMonsterID"))},()=>"Backend Returns",()=>"TrainingInitiated",()=>"TrainingUpdated",e=>{const t=e._GetNode(0);return()=>t.ExpObject("PlayerFirstAction")},()=>"TrainingOpponentUpdated",e=>{const t=e._GetNode(0);return()=>t.ExpObject("NextOpponentAction")},()=>4,()=>"Effects",()=>"DamageText",()=>"clawstrikeLarge",()=>"shieldLarge",()=>"playerHealth",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>multiply2(divide2(t.ExpObject("PlayerHP"),s.ExpObject("PlayerMaxHP")),100)},()=>"opponentHealth",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>multiply2(divide2(t.ExpObject("OpponentHP"),s.ExpObject("OpponentMaxHP")),100)},()=>"playerHPText",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2(and2(t.ExpObject("PlayerHP")," / "),s.ExpObject("PlayerMaxHP"))},()=>"opponentHPText",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>and2(and2(t.ExpObject("OpponentHP")," / "),s.ExpObject("OpponentMaxHP"))},()=>"battleEnergyBar",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject("PlayerEnergy"))/n.GetValue()*100},()=>"battleEnergyText",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>and2(and2(t.ExpObject("PlayerEnergy")," / "),s.GetValue())},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar();return()=>t.GetValue()/s.GetValue()*100},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar();return()=>and2(and2(t.GetValue()," / "),s.GetValue())},()=>"superText",()=>-460,e=>{const t=e._GetNode(0).GetVar();return()=>400+t.GetValue()},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2).GetBoundMethod(),i=e._GetNode(3).GetVar(),r=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetBoundMethod(),o=e._GetNode(6).GetVar(),l=e._GetNode(7).GetBoundMethod(),h=e._GetNode(8).GetBoundMethod(),c=e._GetNode(9).GetVar();return()=>t(s(n(i.GetValue(),0,",")),r(a(o.GetValue(),1,",")),l(h(c.GetValue(),2,",")))},()=>160,e=>{const t=e._GetNode(0).GetVar();return()=>274+t.GetValue()},e=>{const t=e._GetNode(0).GetVar();return()=>.1*t.GetValue()},e=>{const t=e._GetNode(0).GetVar();return()=>.25*t.GetValue()},e=>{const t=e._GetNode(0).GetVar();return()=>.5*t.GetValue()},()=>620,e=>{const t=e._GetNode(0).GetVar();return()=>178+t.GetValue()},e=>{const t=e._GetNode(0).GetVar();return()=>.2*t.GetValue()},()=>"Flash",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+.5},()=>"AttackLines",()=>"closeBattle",()=>"Functions",()=>"endMonsterImage",()=>500,()=>"playerMonsterName",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(and2("monsters.",s.GetValue())+".name")},()=>"playerMonsterLevel",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2),i=e._GetNode(3).GetVar(),r=e._GetNode(4),a=e._GetNode(5).GetVar(),o=e._GetNode(6),l=e._GetNode(7).GetVar(),h=e._GetNode(8).GetBoundMethod(),c=e._GetNode(9),u=e._GetNode(10).GetVar();return()=>and2(and2(and2(and2(and2("LVL : ",t.ExpObject(and2("monsters.",s.GetValue())+".level"))+"\nATK : ",n.ExpObject(and2("monsters.",i.GetValue())+".stats.attackPower"))+"\nDEF : ",r.ExpObject(and2("monsters.",a.GetValue())+".stats.defense"))+"\nAGI : ",o.ExpObject(and2("monsters.",l.GetValue())+".stats.baseAgility"))+"\nPOT : ",.1*h(c.ExpObject(and2("monsters.",u.GetValue())+".stats.potential")))},()=>"opponentMonsterName",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),n=e._GetNode(2),i=e._GetNode(3).GetBoundMethod(),r=e._GetNode(4),a=e._GetNode(5).GetBoundMethod(),o=e._GetNode(6);return()=>t(s(n.ExpObject("OpponentMonsterID"),1))+i(r.ExpObject("OpponentMonsterID"),a(o.ExpObject("OpponentMonsterID"))-1)},()=>"opponentMonsterLevel",e=>{const t=e._GetNode(0),s=e._GetNode(1),n=e._GetNode(2),i=e._GetNode(3),r=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5);return()=>and2(and2(and2(and2(and2("LVL : ",t.ExpObject("OpponentLevel"))+"\nATK : ",s.ExpObject("OpponentAttackPower"))+"\nDEF : ",n.ExpObject("OpponentDefense"))+"\nAGI : ",i.ExpObject("OpponentAgility"))+"\nPOT : ",.1*r(a.ExpObject("OpponentPotential")))},()=>"topUIBar",()=>-400,()=>"lowerUIPanel",()=>800,()=>"playerInfoPanel",()=>"opponentInfoPanel",()=>"MonsterHealth",()=>"battleButtonBackL",()=>"battleButtonBackR",()=>720,()=>-250,()=>530,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar();return()=>t(0)-s.GetValue()/2},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1),n=e._GetNode(2).GetVar();return()=>t(s.ExpObject())+n.GetValue()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),n=e._GetNode(2).GetVar();return()=>t.ExpObject(and2("monsters.",s.GetValue())+"."+n.GetValue())},()=>"REDUNDANT",()=>"Monster Training",()=>"PlayerMonsterID",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar(),n=e._GetNode(2);return()=>t(Math.round(divide2(s.GetValue(),n.ExpObject("tapPower.yield"))))},()=>"BLOCK",()=>"ATTACK",()=>"Monster Training Testing",()=>"OpponentMonsterID",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod();return()=>t(s(0,37))},()=>"OpponentHP",()=>"PlayerHP",()=>"PlayerMaxHP",()=>"OpponentMaxHP",()=>"CoinsEarned",()=>"EXPEarned",()=>"PlayerDamageDealt",()=>"OpponentDamageDealt",()=>"PlayerEnergy",()=>"General"]}}}),require_adsgram_min=__commonJS({"file-map:scripts/project/adsgram.min.js"(e,t){var s,n;n=function(y){var C=Object.defineProperty,T=Object.defineProperties,I=Object.getOwnPropertyDescriptors,b=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,j=(e,t,s)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,l=(e,t)=>{for(var s in t=t||{})A.call(t,s)&&j(e,s,t[s]);if(b)for(var s of b(t))U.call(t,s)&&j(e,s,t[s]);return e},H=(e,t)=>T(e,I(t)),i=(e,t,s)=>(j(e,"symbol"!=typeof t?t+"":t,s),s),P=(e,a,o)=>new Promise((t,s)=>{var n=e=>{try{r(o.next(e))}catch(e){s(e)}},i=e=>{try{r(o.throw(e))}catch(e){s(e)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);r((o=o.apply(e,a)).next())});const X={ru:"!      .      ",en:"Oops! No ads available at the moment. Try again later "},q={themeParams:{accentTextColor:"#168acd",bgColor:"#ffffff",buttonColor:"#40a7e3",buttonTextColor:"#ffffff",destructiveTextColor:"#d14e4e",headerBgColor:"#ffffff",hintColor:"#999999",linkColor:"#168acd",secondaryBgColor:"#f1f1f1",sectionBgColor:"#ffffff",sectionHeaderTextColor:"#168acd",sectionSeparatorColor:"#e7e7e7",subtitleTextColor:"#999999",textColor:"#000000"},initData:{authDate:new Date(1724378007e3),hash:"e1d28656e2cc7529099f01c0b145b7f5c0006d2d7bb0640ffa5d17c4e3f485fc",user:{allowsWriteToPm:!0,firstName:"Aliaksei",id:111111,languageCode:"en",lastName:"mock",username:"mock"}},initDataRaw:"query_id=AAEMo_0aAAAAAAyj_Ro3BMVq&user=%7B%22id%22%3A111111%2C%22first_name%22%3A%22Aliaksei%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22mock%22%2C%22language_code%22%3A%22en%22%2C%22allows_write_to_pm%22%3Atrue%7D&auth_date=1724378007&hash=e1d28656e2cc7529099f01c0b145b7f5c0006d2d7bb0640ffa5d17c4e3f485fc",version:"7.8",platform:"browser"};class $ extends Error{constructor(e,t,s){super(t,{cause:s}),this.type=e,Object.setPrototypeOf(this,$.prototype)}}function Y(e,t,s){return new $(e,t,s)}const z="ERR_METHOD_UNSUPPORTED",K="ERR_METHOD_PARAMETER_UNSUPPORTED",J="ERR_UNKNOWN_ENV",Z="ERR_UNEXPECTED_TYPE",Q="ERR_PARSE";class ee{constructor(e,t,s){this.parser=e,this.isOptional=t,this.type=s}parse(e){if(!this.isOptional||void 0!==e)try{return this.parser(e)}catch(e){throw Y(Q,"Unable to parse value"+(this.type?" as "+this.type:""),e)}}optional(){return this.isOptional=!0,this}required(){return this.isOptional=!1,this}}function te(e,t){return()=>new ee(e,!1,t)}function se(){return Y(Z,"Value has unexpected type")}const ne=te(e=>{if("number"==typeof e)return e;if("string"==typeof e){const t=Number(e);if(!Number.isNaN(t))return t}throw se()},"number"),ie=te(e=>e instanceof Date?e:new Date(1e3*ne().parse(e)),"Date");function re(e,s){const n={};for(const i in e){const r=e[i];if(r){let e,t;if("function"==typeof r||"parse"in r)e=i,t="function"==typeof r?r:r.parse.bind(r);else{const a=r.type;e=r.from||i,t="function"==typeof a?a:a.parse.bind(a)}try{const o=t(s(e));void 0!==o&&(n[i]=o)}catch(e){throw Y(Q,`Unable to parse field "${i}"`,e)}}}return n}function ae(t,e){return new ee(e=>{if("string"!=typeof e&&!(e instanceof URLSearchParams))throw se();const s="string"==typeof e?new URLSearchParams(e):e;return re(t,e=>{const t=s.get(e);return null!=t?t:void 0})},!1,e)}const t=te(e=>{if("string"==typeof e||"number"==typeof e)return e.toString();throw se()},"string");function oe(e){let t=e;if("object"!=typeof(t="string"==typeof t?JSON.parse(t):t)||null===t||Array.isArray(t))throw se();return t}function le(s,e){return new ee(e=>{const t=oe(e);return re(s,e=>t[e])},!1,e)}const he=le({id:ne(),type:t(),title:t(),photoUrl:{type:t().optional(),from:"photo_url"},username:t().optional()},"Chat").optional(),ce=te(e=>{if("boolean"==typeof e)return e;const t=String(e);if("1"===t||"true"===t)return!0;if("0"===t||"false"===t)return!1;throw se()},"boolean"),ue={addedToAttachmentMenu:{type:ce().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:ce().optional(),from:"allows_write_to_pm"},firstName:{type:t(),from:"first_name"},id:ne(),isBot:{type:ce().optional(),from:"is_bot"},isPremium:{type:ce().optional(),from:"is_premium"},languageCode:{type:t().optional(),from:"language_code"},lastName:{type:t().optional(),from:"last_name"},photoUrl:{type:t().optional(),from:"photo_url"},username:t().optional()},de=le(ue,"User").optional(),_e=le(ue,"User").required();function pe(){return ae({authDate:{type:ie(),from:"auth_date"},canSendAfter:{type:ne().optional(),from:"can_send_after"},chat:he,chatInstance:{type:t().optional(),from:"chat_instance"},chatType:{type:t().optional(),from:"chat_type"},hash:t(),queryId:{type:t().optional(),from:"query_id"},receiver:de,startParam:{type:t().optional(),from:"start_param"},user:_e},"InitData")}function me(e){const s=e.replace(/\s/g,"").toLowerCase();if(/^#[\da-f]{6}$/i.test(s))return s;if(/^#[\da-f]{3}$/i.test(s)){let t="#";for(let e=0;e<3;e+=1)t+=s[1+e].repeat(2);return t}const t=s.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||s.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(t)return t.slice(1).reduce((e,t)=>{const s=Number.parseInt(t,10).toString(16);return e+(1===s.length?"0":"")+s},"#");throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`)}const ge=te(e=>me(t().parse(e)),"rgb"),fe=te(e=>{const n=ge().optional();return Object.entries(oe(e)).reduce((e,[t,s])=>(e[t.replace(/_[a-z]/g,e=>e[1].toUpperCase())]=n.parse(s),e),{})},"ThemeParams");function Se(){{var e=(()=>{const e=sessionStorage.getItem("__telegram__initParams");try{return e?JSON.parse(e):void 0}catch(e){}})();if(!e)throw new Error("No telegram initParams in storage");const{tgWebAppData:t,tgWebAppVersion:s,tgWebAppPlatform:n,tgWebAppThemeParams:i,tgWebAppBotInline:r,tgWebAppShowSettings:a,tgWebAppStartParam:o}=e;return{botInline:Boolean(Number(r)),initData:(e=t,pe().parse(e)),initDataRaw:t,showSettings:Boolean(Number(a)),startParam:o,themeParams:(e=i,fe().parse(e)),version:s,platform:n}}}function ye(e){return ae({botInline:{type:ce().optional(),from:"tgWebAppBotInline"},initData:{type:pe(),from:"tgWebAppData"},initDataRaw:{type:t().optional(),from:"tgWebAppData"},platform:{type:t(),from:"tgWebAppPlatform"},showSettings:{type:ce().optional(),from:"tgWebAppShowSettings"},startParam:{type:t().optional(),from:"tgWebAppStartParam"},themeParams:{type:fe(),from:"tgWebAppThemeParams"},version:{type:t(),from:"tgWebAppVersion"}}).parse(e)}function Ce(e){return ye(e.replace(/^[^#?]*[#?]/,"").replace(/[#?]/g,"&"))}function Ge(t){try{for(const e of[function(){return Ce(window.location.href)},function(){const e=performance.getEntriesByType("navigation")[0];if(e)return Ce(e.name);throw new Error("Unable to get first navigation entry.")},Se,function(){var e;return ye(JSON.parse(null!=(e=null!=(e=null!=(e=null!=(e=sessionStorage.getItem("tma.js/launch-params"))?e:sessionStorage.getItem("tapps/launchParams"))?e:sessionStorage.getItem("telegram-apps/launch-params"))?e:sessionStorage.getItem("adsgram/launch-params"))?e:""))}])try{return e()}catch(e){}throw new Error("Unable to retrieve launch parameters from any known source.")}catch(e){return null!=t&&t(),q}}function Te(){return Ge().initData.user}function Ie(){var e;return null!=(e=Te().languageCode)?e:window.navigator.language}function u(e){const t=Ie();return t in e?e[t]:e.en}const be={RewardedVideo:"104",FullscreenMedia:"511"},s={noBannerToShowError:{description:u(X),state:"load",error:!1,done:!1},duplicateShowError:{description:"Attempt to call show when an ad is being shown",state:"playing",error:!0,done:!1},renderError:{description:"Error during render ad",state:"render",error:!0,done:!1},playError:{description:"Error during playing ad",state:"playing",error:!0,done:!1},skip:{description:"The banner was skipped",state:"playing",error:!1,done:!1},reward:{description:"The banner was viewed to the end",state:"destroy",error:!1,done:!0},noBannerDataError:{description:"No banner data to show",state:"load",error:!1,done:!1}},Ae="https://api.adsgram.ai/",Pe="AdsgramError";function Ee(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function n(a,e){return(e=>{const t=a.split("."),s=e.split("."),n=Math.max(t.length,s.length);for(let e=0;e<n;e+=1){const i=Number.parseInt(t[e]||"0",10),r=Number.parseInt(s[e]||"0",10);if(i!==r)return r<i?1:-1}return 0})(e)<=0}function ve(e,t,s){if("string"==typeof s){if("web_app_open_link"===e&&"try_instant_view"===t)return n("6.4",s);if("web_app_set_header_color"===e&&"color"===t)return n("6.9",s)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return n("6.1",t);case"web_app_open_popup":return n("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return n("6.4",t);case"web_app_switch_inline_query":return n("6.7",t);case"web_app_request_write_access":case"web_app_request_phone":return n("6.9",t);case"web_app_setup_settings_button":return n("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return n("7.2",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}let Re="https://web.telegram.org";function xe(e,t,s){let n,i={};void 0===t&&void 0===s?i={}:void 0!==t&&void 0!==s?(i=s,n=t):void 0!==t&&("targetOrigin"in t?i=t:n=t);const{targetOrigin:r=Re}=i;if((()=>{try{return window.self!==window.top}catch(e){return 1}})())window.parent.postMessage(JSON.stringify({eventType:e,eventData:n}),r);else if("external"in(s=window)&&Ee(s.external)&&"notify"in s.external&&"function"==typeof s.external.notify)window.external.notify(JSON.stringify({eventType:e,eventData:n}));else{if(!("TelegramWebviewProxy"in(t=window)&&Ee(t.TelegramWebviewProxy)&&"postEvent"in t.TelegramWebviewProxy&&"function"==typeof t.TelegramWebviewProxy.postEvent))throw Y(J,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside of Telegram application environment.");window.TelegramWebviewProxy.postEvent(e,JSON.stringify(n))}}function we(n){return(t,s)=>{if(!ve(t,n))throw Y(z,`Method "${t}" is unsupported in Mini Apps version `+n);if(Ee(s)){let e;if("web_app_open_link"===t&&"try_instant_view"in s?e="try_instant_view":"web_app_set_header_color"===t&&"color"in s&&(e="color"),e&&!ve(t,e,n))throw Y(K,`Parameter "${e}" of "${t}" method is unsupported in Mini Apps version `+n)}return xe(t,s)}}function De(){return Ge().version}function Me(t){try{we(De())("web_app_open_popup",(e=>{var t;const s=e.message.trim(),n=(null!=(t=e.title)?t:"").trim(),i=e.buttons||[];if(64<n.length)throw new Error("Title has incorrect size: "+n.length);if(0===s.length||256<s.length)throw new Error("Message has incorrect size: "+s.length);if(3<i.length)throw new Error("Buttons have incorrect size: "+i.length);return{title:n,message:s,buttons:0===i.length?[{type:"close",id:""}]:i.map(e=>{var t;const{id:s=""}=e;if(64<s.length)throw new Error("Button ID has incorrect size: "+s);if(e.type&&"default"!==e.type&&"destructive"!==e.type)return H(l({},e),{id:s});{const n=e.text.trim();if(0===n.length||64<n.length){const i=null!=(t=e.type)?t:"default";throw new Error(`Button text with type "${i}" has incorrect size: `+e.text.length)}return H(l({},e),{text:n,id:s})}})}})(t))}catch(e){alert(t.message)}}class d extends Error{constructor({message:e}){super(e),i(this,"message"),this.name=Pe,this.message=Pe+": "+e,this.logError(e)}logError(e){Me({title:"AdsgramError",message:e.length<256?e:e.slice(0,255)}),console.error(this)}}(class extends Error{});const Oe=["blockId","campaignId","environment"];class Fe{constructor(e,t){return i(this,"apiUrl"),i(this,"app"),i(this,"data"),this.app=e,this.apiUrl=t,this.data={},this}getData(){return this.data}add(e,t){return(e=>{if(null!=e&&""!==e){if("object"!=typeof e)return!1;for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1}return!0})(t)||(this.data[e]=t),this}addError(e){return this.data.error=(e=e)instanceof Error?{name:e.name,message:e.message,stack:e.stack}:String(e),this}clean(){return this.data={},this}send(e,t="ERROR"){fetch(""+this.getSendUrl(e,t),{method:"GET",cache:"no-cache"}).then(()=>!0).catch(()=>!1)}getLogRequestData(e,t){return{app:this.app,type:t,event:e,data:l({},this.data)}}getSendUrl(e,t){return this.apiUrl+"?"+(({app:e,type:t,event:s,data:o})=>{const n={app:e,type:t,event:s};return o&&(n.data=JSON.stringify((e=>{const t=[],s=[];for(const[i,r]of Object.entries(o)){const a=e.indexOf(i);-1===a?t.push([i,r]):s[a]=[i,r]}const n=[...t,...s.filter(Boolean)];return Object.fromEntries(n)})(Oe))),new URLSearchParams(n)})(this.getLogRequestData(e,t))}}function G(){const e=new Fe("SAD",Ae+"frontend-error"),t=(()=>{try{return{tg_id:String(Te().id),tg_platform:Ge().platform,platform:window.navigator.platform,userAgent:window.navigator.userAgent,origin:window.location.origin}}catch(e){return null}})();return t&&e.add("environment",t),e}function Le(s,i){return P(this,null,function*(){const t=G();t.add("blockId",s).add("isForceCampaign",Boolean(i)).add("campaignId",Number(i));try{const n=((e,t)=>{var s,n,i,r;const a=G();a.add("blockId",e).add("campaignId",t);try{const{initData:o,platform:l}=Ge(()=>{a.send("NoUserData","WARN")}),{user:h,chat:c}=o;return{blockId:e,forceCampaignId:t,tg_id:String(h.id),tg_platform:l,platform:window.navigator.platform,language:null!=(s=null==h?void 0:h.languageCode)?s:window.navigator.language,is_premium:null==h?void 0:h.isPremium,chat_type:null==o?void 0:o.chatType,chat_instance:null==o?void 0:o.chatInstance,attach_chat_type:null==c?void 0:c.type,attach_chat_id:null!=c&&c.id?String(null==c?void 0:c.id):void 0,receiver_id:null!=(n=null==o?void 0:o.receiver)&&n.id?String(null==(i=null==o?void 0:o.receiver)?void 0:i.id):void 0,receiver_is_bot:null==(r=o.receiver)?void 0:r.isBot}}catch(e){throw a.addError(e).send("CannotGetRequestData"),new d({message:"Cannot get request data."})}})(s,i),e=yield fetch(Ae+"adv?"+(()=>{const e={};for(const[t,s]of Object.entries(n))"object"==typeof s&&null!==s?e[t]=JSON.stringify(s):null!=s&&""!==s&&(e[t]=String(s));return new URLSearchParams(e)})(),{method:"GET",cache:"no-cache",referrerPolicy:"strict-origin-when-cross-origin"});if(e.ok)return yield e.json();switch((yield e.json()).error){case"Wrong referer":throw t.send("WrongReferer","WARN"),new d({message:`Platform App url for blockId = ${s} not equal to ${window.location.origin}
Create new platform with app url ${window.location.origin} and new blockId for this platform.`});case"Need to use active blockid":throw t.send("BlockNotActive","WARN"),new d({message:`Block ${s} is not active.
Change status to active on https://partner.adsgram.ai/units/${s}/
If block has moderation status see https://docs.adsgram.ai/publisher/get-block-id#moderation`});case"Not found this id":throw t.send("BlockNotFound","WARN"),new d({message:`BlockId = ${s} is not found. Make sure that this is your blockId https://partner.adsgram.ai/units/${s}/`});case"Need to specify blockid":throw t.send("NotPassBlock","WARN"),new d({message:"You don't pass blockId to Init function"})}}catch(e){throw!1?t.addError(e).send("APIFetchBannerData"):e instanceof d||t.addError(e).send("UnknownFetchBannerDataError"),e}})}var ke,E,Be,h,Ne,We,Ve,Ue,je={},He=[],Xe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,qe=Array.isArray;function v(e,t){for(var s in t)e[s]=t[s];return e}function $e(e){var t=e.parentNode;t&&t.removeChild(e)}function Ye(e,t,s){var n,i,r,a={};for(r in t)"key"==r?n=t[r]:"ref"==r?i=t[r]:a[r]=t[r];if(2<arguments.length&&(a.children=3<arguments.length?ke.call(arguments,2):s),"function"==typeof e&&null!=e.defaultProps)for(r in e.defaultProps)void 0===a[r]&&(a[r]=e.defaultProps[r]);return ze(e,a,n,i,null)}function ze(e,t,s,n,i){e={type:e,props:t,key:s,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==i?++Be:i,__i:-1,__u:0};return null==i&&null!=E.vnode&&E.vnode(e),e}function Ke(e){return e.children}function R(e,t){this.props=e,this.context=t}function Je(e,t){if(null==t)return e.__?Je(e.__,e.__i+1):null;for(var s;t<e.__k.length;t++)if(null!=(s=e.__k[t])&&null!=s.__e)return s.__e;return"function"==typeof e.type?Je(e):null}function Ze(e){(e.__d||(e.__d=!0,!h.push(e))||Qe.__r++)&&Ne===E.debounceRendering||((Ne=E.debounceRendering)||We)(Qe)}function Qe(){var e,t,s,n,i,r,a,o;for(h.sort(Ve);t=h.shift();)t.__d&&(e=h.length,s=void 0,i=(n=(t=t).__v).__e,a=[],o=[],(r=t.__P)&&((s=v({},n)).__v=n.__v+1,E.vnode&&E.vnode(s),at(r,s,n,t.__n,void 0!==r.ownerSVGElement,32&n.__u?[i]:null,a,null==i?Je(n):i,!!(32&n.__u),o),ot(a,s.__.__k[s.__i]=s,o),s.__e!=i)&&function e(t){var s,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,s=0;s<t.__k.length;s++)if(null!=(n=t.__k[s])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return e(t)}}(s),h.length>e)&&h.sort(Ve);Qe.__r=0}function et(e,t,s,n,i,r,a,o,l,h,c){var u,d,_,p,m,g,f,S,y,C,G=n&&n.__k||He,T=t.length,I=(s.__d=l,s),b=t,A=G,P=b.length,E=A.length,v=E,R=0;for(I.__k=[],g=0;g<P;g++)null!=(f=I.__k[g]=null==(f=b[g])||"boolean"==typeof f||"function"==typeof f?null:"string"==typeof f||"number"==typeof f||"bigint"==typeof f||f.constructor==String?ze(null,f,null,null,f):qe(f)?ze(Ke,{children:f},null,null,null):void 0===f.constructor&&0<f.__b?ze(f.type,f.props,f.key,f.ref||null,f.__v):f)?(f.__=I,f.__b=I.__b+1,C=((e,t,s,n)=>{var i=e.key,r=e.type,a=s-1,o=s+1,l=t[s];if(null===l||l&&i==l.key&&r===l.type)return s;if(n>(null!=l&&0==(131072&l.__u)?1:0))for(;0<=a||o<t.length;){if(0<=a){if((l=t[a])&&0==(131072&l.__u)&&i==l.key&&r===l.type)return a;a--}if(o<t.length){if((l=t[o])&&0==(131072&l.__u)&&i==l.key&&r===l.type)return o;o++}}return-1})(f,A,y=g+R,v),S=null,-1!==(f.__i=C)&&(v--,S=A[C])&&(S.__u|=131072),null==S||null===S.__v?(-1==C&&R--,"function"!=typeof f.type&&(f.__u|=65536)):C!==y&&(C===y+1?R++:y<C?P-y<v?R+=C-y:R--:R=C<y&&C==y-1?C-y:0,C!==g+R)&&(f.__u|=65536)):(S=A[g])&&null==S.key&&S.__e&&(S.__e==I.__d&&(I.__d=Je(S)),ht(S,S,!1),A[g]=null,v--);if(v)for(g=0;g<E;g++)null!=(S=A[g])&&0==(131072&S.__u)&&(S.__e==I.__d&&(I.__d=Je(S)),ht(S,S));for(l=s.__d,u=0;u<T;u++)null!=(_=s.__k[u])&&"boolean"!=typeof _&&"function"!=typeof _&&(d=-1!==_.__i&&G[_.__i]||je,_.__i=u,at(e,_,d,i,r,a,o,l,h,c),p=_.__e,_.ref&&d.ref!=_.ref&&(d.ref&&lt(d.ref,null,_),c.push(_.ref,_.__c||p,_)),null==m&&null!=p&&(m=p),65536&_.__u||d.__k===_.__k?l=function e(t,s,n){var i,r;if("function"==typeof t.type){for(i=t.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=t,s=e(i[r],s,n));return s}return t.__e!=s&&(n.insertBefore(t.__e,s||null),s=t.__e),s&&s.nextSibling}(_,l,e):"function"==typeof _.type&&void 0!==_.__d?l=_.__d:p&&(l=p.nextSibling),_.__d=void 0,_.__u&=-196609);s.__d=l,s.__e=m}function tt(e,t){return t=t||[],null!=e&&"boolean"!=typeof e&&(qe(e)?e.some(function(e){tt(e,t)}):t.push(e)),t}function st(e,t,s){"-"===t[0]?e.setProperty(t,null==s?"":s):e[t]=null==s?"":"number"!=typeof s||Xe.test(t)?s:s+"px"}function nt(e,t,s,n,i){var r;e:if("style"===t)if("string"==typeof s)e.style.cssText=s;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)s&&t in s||st(e.style,t,"");if(s)for(t in s)n&&s[t]===n[t]||st(e.style,t,s[t])}else if("o"===t[0]&&"n"===t[1])r=t!==(t=t.replace(/(PointerCapture)$|Capture$/,"$1")),t=(t.toLowerCase()in e?t.toLowerCase():t).slice(2),e.l||(e.l={}),(e.l[t+r]=s)?n?s.u=n.u:(s.u=Date.now(),e.addEventListener(t,r?rt:it,r)):e.removeEventListener(t,r?rt:it,r);else{if(i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==t&&"height"!==t&&"href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&"rowSpan"!==t&&"colSpan"!==t&&"role"!==t&&t in e)try{e[t]=null==s?"":s;break e}catch(e){}"function"!=typeof s&&(null==s||!1===s&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,s))}}function it(e){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(E.event?E.event(e):e)}function rt(e){return this.l[e.type+!0](E.event?E.event(e):e)}function at(e,t,s,n,i,r,a,o,l,h){var c,u,d,_,p,m,g,f,S,y,C,G,T,I,b,A=t.type;if(void 0===t.constructor){128&s.__u&&(l=!!(32&s.__u),r=[o=t.__e=s.__e]),(c=E.__b)&&c(t);e:if("function"==typeof A)try{if(f=t.props,S=(c=A.contextType)&&n[c.__c],y=c?S?S.props.value:c.__:n,s.__c?g=(u=t.__c=s.__c).__=u.__E:("prototype"in A&&A.prototype.render?t.__c=u=new A(f,y):(t.__c=u=new R(f,y),u.constructor=A,u.render=ct),S&&S.sub(u),u.props=f,u.state||(u.state={}),u.context=y,u.__n=n,d=u.__d=!0,u.__h=[],u._sb=[]),null==u.__s&&(u.__s=u.state),null!=A.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=v({},u.__s)),v(u.__s,A.getDerivedStateFromProps(f,u.__s))),_=u.props,p=u.state,u.__v=t,d)null==A.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(null==A.getDerivedStateFromProps&&f!==_&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(f,y),!u.__e&&(null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(f,u.__s,y)||t.__v===s.__v)){for(t.__v!==s.__v&&(u.props=f,u.state=u.__s,u.__d=!1),t.__e=s.__e,t.__k=s.__k,t.__k.forEach(function(e){e&&(e.__=t)}),C=0;C<u._sb.length;C++)u.__h.push(u._sb[C]);u._sb=[],u.__h.length&&a.push(u);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(f,u.__s,y),null!=u.componentDidUpdate&&u.__h.push(function(){u.componentDidUpdate(_,p,m)})}if(u.context=y,u.props=f,u.__P=e,u.__e=!1,G=E.__r,T=0,"prototype"in A&&A.prototype.render){for(u.state=u.__s,u.__d=!1,G&&G(t),c=u.render(u.props,u.state,u.context),I=0;I<u._sb.length;I++)u.__h.push(u._sb[I]);u._sb=[]}else for(;u.__d=!1,G&&G(t),c=u.render(u.props,u.state,u.context),u.state=u.__s,u.__d&&++T<25;);u.state=u.__s,null!=u.getChildContext&&(n=v(v({},n),u.getChildContext())),d||null==u.getSnapshotBeforeUpdate||(m=u.getSnapshotBeforeUpdate(_,p)),et(e,qe(b=null!=c&&c.type===Ke&&null==c.key?c.props.children:c)?b:[b],t,s,n,i,r,a,o,l,h),u.base=t.__e,t.__u&=-161,u.__h.length&&a.push(u),g&&(u.__E=u.__=null)}catch(e){t.__v=null,l||null!=r?(t.__e=o,t.__u|=l?160:32,r[r.indexOf(o)]=null):(t.__e=s.__e,t.__k=s.__k),E.__e(e,t,s)}else null==r&&t.__v===s.__v?(t.__k=s.__k,t.__e=s.__e):t.__e=((e,t,s,n,i,r,a,o,l)=>{var h,c,u,d,_,p,m,g=s.props,f=t.props,S=t.type;if("svg"===S&&(i=!0),null!=r)for(h=0;h<r.length;h++)if((_=r[h])&&"setAttribute"in _==!!S&&(S?_.localName===S:3===_.nodeType)){e=_,r[h]=null;break}if(null==e){if(null===S)return document.createTextNode(f);e=i?document.createElementNS("http://www.w3.org/2000/svg",S):document.createElement(S,f.is&&f),r=null,o=!1}if(null===S)g===f||o&&e.data===f||(e.data=f);else{if(r=r&&ke.call(e.childNodes),g=s.props||je,!o&&null!=r)for(g={},h=0;h<e.attributes.length;h++)g[(_=e.attributes[h]).name]=_.value;for(h in g)_=g[h],"children"!=h&&("dangerouslySetInnerHTML"==h?u=_:"key"===h||h in f||nt(e,h,null,_,i));for(h in f)_=f[h],"children"==h?d=_:"dangerouslySetInnerHTML"==h?c=_:"value"==h?p=_:"checked"==h?m=_:"key"===h||o&&"function"!=typeof _||g[h]===_||nt(e,h,_,g[h],i);if(c)o||u&&(c.__html===u.__html||c.__html===e.innerHTML)||(e.innerHTML=c.__html),t.__k=[];else if(u&&(e.innerHTML=""),et(e,qe(d)?d:[d],t,s,n,i&&"foreignObject"!==S,r,a,r?r[0]:s.__k&&Je(s,0),o,l),null!=r)for(h=r.length;h--;)null!=r[h]&&$e(r[h]);o||(h="value",void 0!==p&&(p!==e[h]||"progress"===S&&!p||"option"===S&&p!==g[h])&&nt(e,h,p,g[h],!1),h="checked",void 0!==m&&m!==e[h]&&nt(e,h,m,g[h],!1))}return e})(s.__e,t,s,n,i,r,a,l,h);(c=E.diffed)&&c(t)}}function ot(e,t,s){t.__d=void 0;for(var n=0;n<s.length;n++)lt(s[n],s[++n],s[++n]);E.__c&&E.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){E.__e(e,t.__v)}})}function lt(e,t,s){try{"function"==typeof e?e(t):e.current=t}catch(e){E.__e(e,s)}}function ht(e,t,s){var n,i;if(E.unmount&&E.unmount(e),!(n=e.ref)||n.current&&n.current!==e.__e||lt(n,null,t),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){E.__e(e,t)}n.base=n.__P=null,e.__c=void 0}if(n=e.__k)for(i=0;i<n.length;i++)n[i]&&ht(n[i],t,s||"function"!=typeof e.type);s||null==e.__e||$e(e.__e),e.__=e.__e=e.__d=void 0}function ct(e,t,s){return this.constructor(e,s)}function ut(e,t,s){var n,i,r,a;E.__&&E.__(e,t),i=(n="function"==typeof s)?null:s&&s.__k||t.__k,r=[],a=[],at(t,e=(!n&&s||t).__k=Ye(Ke,null,[e]),i||je,je,void 0!==t.ownerSVGElement,!n&&s?[s]:!i&&t.firstChild?ke.call(t.childNodes):null,r,!n&&s?s:i?i.__e:t.firstChild,n,a),ot(r,e,a)}function e(e,n){e={__c:n="__cC"+Ue++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var s,t;return this.getChildContext||(s=[],((t={})[n]=this).getChildContext=function(){return t},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&s.some(function(e){e.__e=!0,Ze(e)})},this.sub=function(e){s.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){s.splice(s.indexOf(e),1),t&&t.call(e)}}),e.children}};return e.Provider.__=e.Consumer.contextType=e}ke=He.slice,E={__e:function(t,e,s,n){for(var i,r,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((r=i.constructor)&&null!=r.getDerivedStateFromError&&(i.setState(r.getDerivedStateFromError(t)),a=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(t,n||{}),a=i.__d),a)return i.__E=i}catch(e){t=e}throw t}},Be=0,R.prototype.setState=function(e,t){var s=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=v({},this.state);(e="function"==typeof e?e(v({},s),this.props):e)&&v(s,e),null!=e&&this.__v&&(t&&this._sb.push(t),Ze(this))},R.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ze(this))},R.prototype.render=Ke,h=[],We="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ve=function(e,t){return e.__v.__b-t.__v.__b},Qe.__r=0,Ue=0;const dt=new Set(["RewardedVideo","FullscreenMedia"]),x={show:"show",load:"load",preload:"preload",destroy:"destroy",finalDestroy:"finalDestroy",error:"error",renderError:"renderError",pause:"pause",play:"play",leave:"leave",return:"return"},w={onReward:"onReward",onStart:"onStart",onSkip:"onSkip",onBannerNotFound:"onBannerNotFound",onError:"onError"},_t=l(l(l({},x),w),{replay:"replay"});var pt,r,mt={exports:{}};function gt(){for(var e="",t=0;t<arguments.length;t++){var s=arguments[t];s&&(e=ft(e,(e=>{if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return gt.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t,s="";for(t in e)pt.call(e,t)&&e[t]&&(s=ft(s,t));return s})(s)))}return e}function ft(e,t){return t?e?e+" "+t:e+t:e}r=mt,pt={}.hasOwnProperty,r.exports?r.exports=gt.default=gt:window.classNames=gt;const D=(r=mt.exports)&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,St=15,yt=30;class Ct{constructor(){i(this,"handlers"),this.handlers=[]}on(e,t){if("function"!=typeof t)throw new d({message:"The handler argument must be of type Function. Received type "+typeof t});if(!e)throw new d({message:"The event argument must be of type String. Received type "+typeof e});if(_t[e])return this.handlers.push({event:e,handler:t}),this;throw new d({message:`The event argument must be one of ${Object.keys(_t).join(", ")}. Received `+e})}off(t,s){return this.handlers=this.handlers.filter(e=>e.event!==t||e.handler!==s),this}emit(e){let t=!1;for(const s of this.handlers)s.event===e&&(t=!0,s.handler());return t}removeAllListeners(t){return this.handlers=t?this.handlers.filter(e=>e.event!==t):[],this}hasHandlers(t){return this.handlers.some(({event:e})=>e===t)}}const Gt=e(new Proxy(new Ct,{apply(){console.warn("EventEmitter not initialized")},get(){console.warn("EventEmitter not initialized")}}));var Tt,c,It,bt,At=0,Pt=[],Et=[],vt=E.__b,Rt=E.__r,xt=E.diffed,wt=E.__c,Dt=E.unmount;function Mt(e,t){E.__h&&E.__h(c,e,At||t),At=0;t=c.__H||(c.__H={__:[],__h:[]});return e>=t.__.length&&t.__.push({__V:Et}),t.__[e]}function M(e){return At=1,t=Nt,e=e,(o=Mt(Tt++,2)).t=t,o.__c||(o.__=[Nt(void 0,e),function(e){var t=(o.__N||o.__)[0],e=o.t(t,e);t!==e&&(o.__N=[e,o.__[1]],o.__c.setState({}))}],(o.__c=c).u)||(i=function(e,t,s){var n,i;return!o.__c.__H||((n=o.__c.__H.__.filter(function(e){return e.__c})).every(function(e){return!e.__N})||(i=!1,n.forEach(function(e){var t;e.__N&&(t=e.__[0],e.__=e.__N,e.__N=void 0,t!==e.__[0])&&(i=!0)}),!(!i&&o.__c.props===e)))&&(!r||r.call(this,e,t,s))},c.u=!0,r=c.shouldComponentUpdate,a=c.componentWillUpdate,c.componentWillUpdate=function(e,t,s){var n;this.__e&&(n=r,r=void 0,i(e,t,s),r=n),a&&a.call(this,e,t,s)},c.shouldComponentUpdate=i),o.__N||o.__;var t,i,r,a,o}function O(e,t){var s=Mt(Tt++,3);!E.__s&&Bt(s.__H,t)&&(s.__=e,s.i=t,c.__H.__h.push(s))}function F(e){return At=5,L(function(){return{current:e}},[])}function L(e,t){var s=Mt(Tt++,7);return Bt(s.__H,t)?(s.__V=e(),s.i=t,s.__h=e,s.__V):s.__}function k(e,t){return At=8,L(function(){return e},t)}function a(e){var t=c.context[e.__c],s=Mt(Tt++,9);return s.c=e,t?(null==s.__&&(s.__=!0,t.sub(c)),t.props.value):e.__}function Ot(){for(var t;t=Pt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Lt),t.__H.__h.forEach(kt),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(e){c=null,vt&&vt(e)},E.__r=function(e){Rt&&Rt(e),Tt=0;e=(c=e.__c).__H;e&&(It===c?(e.__h=[],c.__h=[],e.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=Et,e.__N=e.i=void 0})):(e.__h.forEach(Lt),e.__h.forEach(kt),e.__h=[],Tt=0)),It=c},E.diffed=function(e){xt&&xt(e);e=e.__c;e&&e.__H&&(!e.__H.__h.length||1!==Pt.push(e)&&bt===E.requestAnimationFrame||((bt=E.requestAnimationFrame)||function(e){function t(){clearTimeout(n),Ft&&cancelAnimationFrame(s),setTimeout(e)}var s,n=setTimeout(t,100);Ft&&(s=requestAnimationFrame(t))})(Ot),e.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==Et&&(e.__=e.__V),e.i=void 0,e.__V=Et})),It=c=null},E.__c=function(e,s){s.some(function(t){try{t.__h.forEach(Lt),t.__h=t.__h.filter(function(e){return!e.__||kt(e)})}catch(e){s.some(function(e){e.__h&&(e.__h=[])}),s=[],E.__e(e,t.__v)}}),wt&&wt(e,s)},E.unmount=function(e){Dt&&Dt(e);var t,e=e.__c;e&&e.__H&&(e.__H.__.forEach(function(e){try{Lt(e)}catch(e){t=e}}),e.__H=void 0,t)&&E.__e(t,e.__v)};var Ft="function"==typeof requestAnimationFrame;function Lt(e){var t=c,s=e.__c;"function"==typeof s&&(e.__c=void 0,s()),c=t}function kt(e){var t=c;e.__c=e.__(),c=t}function Bt(s,e){return!s||s.length!==e.length||e.some(function(e,t){return e!==s[t]})}function Nt(e,t){return"function"==typeof t?t(e):t}(new R).isPureReactComponent=!0;var Wt=E.__b,Vt=(E.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),Wt&&Wt(e)},E.__e),Ut=(E.__e=function(e,t,s,n){if(e.then)for(var i,r=t;r=r.__;)if((i=r.__c)&&i.__c)return null==t.__e&&(t.__e=s.__e,t.__k=s.__k),i.__c(e,t);Vt(e,t,s,n)},E.unmount);function jt(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}E.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),Ut&&Ut(e)},(new R).__c=function(e,t){function s(){a||(a=!0,n.__R=null,r?r(o):o())}var n=t.__c,i=this,r=(null==i.t&&(i.t=[]),i.t.push(n),jt(i.__v)),a=!1,o=(n.__R=s,function(){var e,t;if(!--i.__u)for(i.state.__a&&(e=i.state.__a,i.__v.__k[0]=function t(e,s,n){return e&&n&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(e){return t(e,s,n)}),e.__c)&&e.__c.__P===s&&(e.__e&&n.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=n),e}(e,e.__c.__P,e.__c.__O)),i.setState({__a:i.__b=null});t=i.t.pop();)t.forceUpdate()});i.__u++||32&t.__u||i.setState({__a:i.__b=i.__v.__k[0]}),e.then(s,s)};function Ht(e,t,s){if(++s[1]===s[0]&&e.o.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.o.size))for(s=e.u;s;){for(;3<s.length;)s.pop()();if(s[1]<s[0])break;e.u=s=s[2]}}(new R).__a=function(s){var n=this,i=jt(n.__v),r=n.o.get(s);return r[0]++,function(e){function t(){n.props.revealOrder?(r.push(e),Ht(n,s,r)):e()}i?i(t):t()}};var Xt="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,qt=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,$t=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Yt=/[A-Z0-9]/g,zt="undefined"!=typeof document,Kt=(R.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(R.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})}),E.event);function Jt(){}function Zt(){return this.cancelBubble}function Qt(){return this.defaultPrevented}var es={enumerable:!(E.event=function(e){return(e=Kt?Kt(e):e).persist=Jt,e.isPropagationStopped=Zt,e.isDefaultPrevented=Qt,e.nativeEvent=e}),configurable:!0,get:function(){return this.class}},ts=E.vnode,ss=(E.vnode=function(e){if("string"==typeof e.type){var t=e,s,n,i=t.props,r=t.type,a={};for(s in i){var o,l=i[s];"value"===s&&"defaultValue"in i&&null==l||zt&&"children"===s&&"noscript"===r||"class"===s||"className"===s||(o=s.toLowerCase(),"defaultValue"===s&&"value"in i&&null==i.value?s="value":"download"===s&&!0===l?l="":"ondoubleclick"===o?s="ondblclick":"onchange"!==o||"input"!==r&&"textarea"!==r||(n=i.type,("undefined"!=typeof Symbol&&"symbol"==typeof Symbol()?/fil|che|rad/:/fil|che|ra/).test(n))?"onfocus"===o?s="onfocusin":"onblur"===o?s="onfocusout":$t.test(s)?s=o:-1===r.indexOf("-")&&qt.test(s)?s=s.replace(Yt,"-$&").toLowerCase():null===l&&(l=void 0):o=s="oninput","oninput"===o&&a[s=o]&&(s="oninputCapture"),a[s]=l)}"select"==r&&a.multiple&&Array.isArray(a.value)&&(a.value=tt(i.children).forEach(function(e){e.props.selected=-1!=a.value.indexOf(e.props.value)})),"select"==r&&null!=a.defaultValue&&(a.value=tt(i.children).forEach(function(e){e.props.selected=a.multiple?-1!=a.defaultValue.indexOf(e.props.value):a.defaultValue==e.props.value})),i.class&&!i.className?(a.class=i.class,Object.defineProperty(a,"className",es)):(i.className&&!i.class||i.class&&i.className)&&(a.class=a.className=i.className),t.props=a}e.$$typeof=Xt,ts&&ts(e)},E.__r),ns=(E.__r=function(e){ss&&ss(e),e.__c},E.diffed);function B(){return a(Gt)}E.diffed=function(e){ns&&ns(e);var t=e.props,s=e.__e;null!=s&&"textarea"===e.type&&"value"in t&&t.value!==s.value&&(s.value=null==t.value?"":t.value)};const is={NONSKIP_ALWAYS:!0},rs=e(is);function N(e){const t=a(rs);return L(()=>Boolean(t[e]),[e,t])}const as=e(G());function W(){return a(as)}const os=e(!1);function ls(){return a(os)}const hs={background:"_background_13n54_1",preview:"_preview_13n54_9",dark:"_dark_13n54_18",light:"_light_13n54_36"};var cs=0;function V(e,t,s,n,i,r){var a,o,l={};for(o in t)"ref"==o?a=t[o]:l[o]=t[o];s={type:e,props:l,key:s,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--cs,__i:-1,__u:0,__source:i,__self:r};if("function"==typeof e&&(a=e.defaultProps))for(o in a)void 0===l[o]&&(l[o]=a[o]);return E.vnode&&E.vnode(s),s}function us(){const e=ls();return V("div",{className:D(hs.background,e?hs.dark:hs.light,!1)})}const ds={label:"_label_8q9mb_1",text:"_text_8q9mb_19"},_s="https://t.me/+NumBvh9EOiM2MDAy",ps="https://t.me/+3u3wa8LtNjVkY2Zi";function ms(){return"ru"===Ie()?ps:_s}function gs(e){try{const t=new URL(e).hostname;return"t.me"===t}catch(e){}}function fs({url:t,logger:s}){try{var e=t;if(gs(e)){const{pathname:n,search:i}=new URL(e);we(De())("web_app_open_tg_link",{path_full:n+i})}else we(De())("web_app_open_link",{try_instant_view:!1,url:e})}catch(e){s.add("url",t).send("OpenUrlError","WARN"),window.open(t,"_blank")}}function Ss({}){const t=W(),s=B(),e=k(e=>{e.isTrusted&&(e.stopPropagation(),s.emit(x.leave),fs({url:ms(),logger:t}))},[s,t]);return V("div",{className:ds.label,onClick:e,children:V("span",{className:ds.text,children:"@adsgram_ai  ads in Telegram"})})}const ys={footer:"_footer_1vuvm_1"},Cs={timer:"_timer_1bmq0_1",time:"_time_1bmq0_1"},Gs=e=>(""+e).padStart(2,"0"),Ts=e=>{const t=e%60;return Gs((e-t)/60%60)+":"+Gs(t)};function Is({timer:e}){const t=N("FORCED_SUB_FORMAT"),[s,n]=M(t?yt:St),i=k((e,t)=>{n(t)},[]);return O(()=>{e.subscribeOnTimeUpdate(i)},[i,e]),V("div",{className:Cs.timer,children:V("span",{className:Cs.time,children:Ts(s)})})}function bs({timer:e}){const t=N("NOT_SHOW_ADSGRAM_LABEL");return V("div",{className:ys.footer,children:[V(Is,{timer:e}),!t&&V(Ss,{})]})}const As=e=>{var{src:t,alt:s,className:n,isCriticalImage:i}=e,e=((e,t)=>{var s={};for(n in e)A.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&b)for(var n of b(e))t.indexOf(n)<0&&U.call(e,n)&&(s[n]=e[n]);return s})(e,["src","alt","className","isCriticalImage"]);const r=W(),a=(r.add("url",t),i?"Critical":""),o=k(()=>{r.send(a+"ImageLoadError")},[a,r]);return V("img",l({className:n,src:t,alt:s,onError:o},e))},Ps={kebab:"_kebab_lsgwj_1",hidden:"_hidden_lsgwj_7",icon:"_icon_lsgwj_11"},Es="_wrapper_1c6e2_1",vs="_legal-info_1c6e2_15",Rs="_item_1tvev_1",xs="_header_1tvev_16",ws="_content_1tvev_21";function Ds({header:e,content:t}){return V("div",{className:Rs,children:[V("span",{className:xs,children:e}),V("span",{className:ws,children:t})]})}const Ms=({kebab:e,setIsOpen:t,className:s})=>{const{legalName:n,inn:i,erid:r,regNumber:a}=e,o=B(),l=F(null),h=k(e=>{e.preventDefault(),e.stopPropagation(),l.current&&!l.current.contains(e.target)&&(t(!1),o.emit("play"),l.current.getRootNode().removeEventListener("click",h,{capture:!0}))},[o,t]);return O(()=>{l.current&&l.current.getRootNode().addEventListener("click",h,{capture:!0})},[h]),V("div",{className:D(Es,s),ref:l,children:V("div",{className:vs,children:[V(Ds,{header:" ",content:n}),V(Ds,{header:"",content:i}),V(Ds,{header:"",content:a}),V(Ds,{header:"ERID",content:r})]})})};function Os(e){return"string"==typeof e&&""!==e}const Fs="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12.522%208c1.148%200%202.087-.9%202.087-2s-.94-2-2.087-2c-1.148%200-2.087.9-2.087%202s.939%202%202.087%202Zm0%202c-1.148%200-2.087.9-2.087%202s.939%202%202.087%202c1.148%200%202.087-.9%202.087-2s-.94-2-2.087-2Zm0%206c-1.148%200-2.087.9-2.087%202s.939%202%202.087%202c1.148%200%202.087-.9%202.087-2s-.94-2-2.087-2Z'%20fill='%23fff'/%3e%3c/svg%3e";function Ls({kebab:i,classNameKebab:e,classNameKebabContent:t}){const s=B(),[n,r]=M(!1),a=k(()=>{n||(r(!0),s.emit("pause"))},[s,n]);return(()=>{const{legalName:e,erid:t,regNumber:s,inn:n}=i;return Os(e)&&Os(n)&&Os(t)&&Os(s)})()?V("div",{className:D(Ps.kebab,e),onClick:a,children:[V("img",{className:Ps.icon,src:Fs,alt:"more info"}),n&&V(Ms,{className:t,kebab:i,setIsOpen:r})]}):V("div",{className:D(Ps.kebab,e,Ps.hidden)})}const _={post:"_post_16y4i_1",show:"_show_16y4i_1",channel:"_channel_16y4i_21",icon:"_icon_16y4i_29",tail:"_tail_16y4i_37",message:"_message_16y4i_51",image:"_image_16y4i_61",text:"_text_16y4i_69",title:"_title_16y4i_81",description:"_description_16y4i_92",footer:"_footer_16y4i_99",name:"_name_16y4i_104",clickable:"_clickable_16y4i_125",adlabel:"_adlabel_16y4i_130",kebab:"_kebab_16y4i_140","kebab-content":"_kebab-content_16y4i_152",kebabContent:"_kebab-content_16y4i_152"},ks="Ad  18+",Bs="  18+";function Ns(){return void 0!==window.ontouchstart||"ontouchstart"in document.documentElement}function Ws({image:e,title:t,description:s,advertiserName:n,icon:i,onClick:r,isClickable:a,kebab:o}){const l=ls(),h=Ns(),c=N("RU_GEO_SHOW")?Bs:ks;return V("div",{className:D(_.post,l?_.dark:_.light),children:[V("div",{className:_.channel,children:V(As,{src:i,alt:"channel",className:_.icon})}),V("div",{className:_.tail,children:V("svg",{fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 6 10",children:V("path",{d:"M0 9c4.5-.5 6-5.5 6-9v10H0V9Z"})})}),V("div",{className:_.message,children:[V(Ls,{kebab:o,classNameKebab:_.kebab,classNameKebabContent:_.kebabContent}),V(As,{src:e,alt:"Post main",className:_.image,isCriticalImage:!0}),V("div",{className:_.text,children:[V("h2",{className:_.title,children:t}),V("span",{className:_.description,children:s}),V("div",{className:_.footer,children:[V("button",{className:D(_.name,a&&_.clickable),onClick:h?void 0:r,onTouchStart:h?r:void 0,disabled:!a,children:n}),V("span",{className:_.adlabel,children:c})]})]})]})]})}const Vs={button:"_button_11hr1_1",show:"_show_11hr1_1",click:"_click_11hr1_1"};function Us({buttonName:e,onClick:t}){const s=Ns();return V("button",{className:Vs.button,onClick:s?void 0:t,onTouchStart:s?t:void 0,children:e})}const js={ru:",   !",en:"Click to get the reward!"},Hs={tooltip:"_tooltip_y87u2_1",show:"_show_y87u2_1",title:"_title_y87u2_46"};function Xs(){return V("div",{className:Hs.tooltip,children:V("h3",{className:Hs.title,children:u(js)})})}const qs=2;function $s(){return P(this,arguments,function*(t,s,n=qs){if("string"!=typeof t||""===t)s.add("trackingUrl",JSON.stringify(t)).send("WrongTrackingUrl");else for(let e=1+n;0<e;--e)try{if((yield fetch(t,{method:"GET",cache:"no-cache"})).ok)return!0}catch(e){s.addError(e).add("trackingUrl",t).send("APITrackingError")}return!1})}function Ys(e){const t=window.getComputedStyle(e);if("0px"==t.height||"none"==t.display||"0"==t.opacity||"hidden"==t.visibility||"circle(0px at 50% 50%)"==t.clipPath||"scale(0)"==t.transform||e.hasAttribute("hidden")||"hidden"===document.visibilityState)return!1;const s=e.getBoundingClientRect(),n=s.left,i=s.top,r=document.elementFromPoint(n,i);if(null!=r&&!e.isSameNode(r)){const a=t.zIndex,o=window.getComputedStyle(r).zIndex;if(Number(a)<Number(o))return!1;if(""===a&&""===o&&e.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING)return!1}return(s.bottom-s.top)*(s.right-s.left)>=(window.innerHeight||document.documentElement.clientHeight)*(window.innerWidth||document.documentElement.clientWidth)*.5}function zs(e){const t=F(null),[s,n]=M(!1);return O(()=>{t.current=new IntersectionObserver(([e])=>{e.isIntersecting&&Ys(e.target)?n(!0):n(!1)},{root:null,rootMargin:"0px",threshold:.5})},[]),O(()=>(e.current&&t.current&&t.current.observe(e.current),()=>{t.current&&(n(!1),t.current.disconnect())}),[e]),s}const Ks=e(void 0);function Js(t){const s=a(Ks);return L(()=>{var e;return null!=(e=null==s?void 0:s[t])?e:""},[t,s])}function Zs(){const t=W(),s=Js("reward"),n=B();O(()=>{const e=()=>{$s(s,t)};return n.on(w.onReward,e),()=>{n.off(w.onReward,e)}},[n,s,t])}const Qs=class Xi{constructor({callbacks:e,endTime:t}){i(this,"startTime"),i(this,"endTime"),i(this,"time"),i(this,"stopped"),i(this,"finished"),i(this,"stopTime"),i(this,"fromStopToResumeTime"),i(this,"onSpecificTimeCallback"),i(this,"onTimeUpdateCallback"),i(this,"onTickUpdateCallback"),i(this,"onEndCallback"),this.startTime=performance.now(),this.endTime=t,this.time=0,this.stopped=!1,this.finished=!1,this.stopTime=0,this.fromStopToResumeTime=0,this.onSpecificTimeCallback={};for(const s in e)Number.isNaN(Number(s))||(this.onSpecificTimeCallback[s]=e[s]);this.onTimeUpdateCallback=e.onTimeUpdate,this.onTickUpdateCallback=e.onTick,this.onEndCallback=e.endCallback,this.tick()}get isFinished(){return this.finished}get isStopped(){return this.stopped}get elapsedTime(){return this.endTime-this.time}stop(){return this.stopped||(this.stopTime=performance.now(),this.stopped=!0),this.time}resume(){if(this.stopped){const e=performance.now()-this.stopTime;this.fromStopToResumeTime+=e,this.stopped=!1,this.tick()}}restart(){this.time=0,this.fromStopToResumeTime=performance.now()-this.startTime,this.stopped=!1,this.finished=!1,this.tick()}subscribeOnSpecificTimeUpdate(e,t){this.onSpecificTimeCallback[e]=t}subscribeOnTimeUpdate(e){this.onTimeUpdateCallback=e}subscribeOnTickUpdate(e){this.onTickUpdateCallback=e}subscribeOnEnd(e){this.onEndCallback=e}unsubscribeAll(){this.onEndCallback=void 0,this.onTimeUpdateCallback=void 0,this.onSpecificTimeCallback={},this.onTickUpdateCallback=void 0}destroy(){this.finished=!0,this.unsubscribeAll()}tick(){var e;if(!this.stopped&&!this.finished){if(performance.now()-this.fromStopToResumeTime-this.startTime>1e3*(this.time+1)){++this.time,null!=(e=this.onTimeUpdateCallback)&&e.call(this,this.time,this.elapsedTime);const t=this.onSpecificTimeCallback[this.time];null!=t&&t(this.time,this.elapsedTime)}this.time<this.endTime?setTimeout(this.tick.bind(this),Xi.checkInterval):(null!=(e=this.onEndCallback)&&e.call(this,this.time,this.elapsedTime),this.finished=!0),null!=(e=this.onTickUpdateCallback)&&e.call(this,this.time,this.elapsedTime)}}};i(Qs,"checkInterval",100);let en=Qs,tn=e("");function sn(){return a(tn)}const nn={button:"_button_1ddhv_1",show:"_show_1ddhv_1",visible:"_visible_1ddhv_36",hidden:"_hidden_1ddhv_41"},rn=15e3,an=e(null);function on(){return a(an)}function ln(e){return e+"-action-button"}const hn=new class{constructor(){i(this,"subscribers",{}),i(this,"dispatchedEvents",new Set)}onFiredBeforePlayerEvent(e,t){var s,n;this.dispatchedEvents.has(e)?t():(null!=(n=(s=this.subscribers)[e])?n:s[e]=[]).push(t)}dispatchEvent(e){var t;this.dispatchedEvents.add(e),null!=(t=this.subscribers[e])&&t.map(e=>e()),this.subscribers[e]=[]}clear(){this.dispatchedEvents=new Set,this.subscribers={}}};function cn({text:e}){const t=sn(),s=on(),n=B(),i=W(),[r,a]=M(!1),[o,l]=M(""),h=F(1/0),c=k(()=>{s&&(l(s.clickThroughUrl),s.on("showActionButton",()=>{a(!0)}))},[s]),u=(O(()=>{s&&hn.onFiredBeforePlayerEvent("adstarted",c)},[c,s]),k(e=>{e.isTrusted&&((e=>{if(gs(e)){const t=new URL(e).pathname;return/bot\/./i.test(t)}})(o)?s&&(s.muted=!0):(null!=s&&s.pause(),h.current=Date.now()),n.emit("leave"),fs({url:o,logger:i}))},[n,o,i,s])),d=k(()=>{Date.now()-h.current>rn&&n.emit("onReward"),h.current=1/0},[n]);return O(()=>{n.on("return",d)},[n,d]),V("button",{id:ln(t),className:nn.button+" "+(r?nn.visible:nn.hidden),onClick:u,children:e})}const un={footer:"_footer_15eel_1"},dn={timeline:"_timeline_1gsrl_1",bar:"_bar_1gsrl_10",progress:"_progress_1gsrl_17"};function _n({packshotDuration:e}){const t=F(null),s=on(),n=k(()=>{if(t.current&&s){var{player:h,progress:c,packshotDuration:u}=[{player:s,progress:t.current,packshotDuration:e}][0];let i=h.adDuration+(null!=u?u:0),r,a,o=!1,l=!1;h.on("adcomplete",()=>{l=!0}),h.on("addestroyed",()=>{o=!0});const d=e=>{if(l&&u){const t=e-(r=void 0===r?e:r);if(u<=t&&(o=!0),a!==e){const s=(h.adDuration+t)/i*100;c.style.width=s+"%"}a=e}if(!l){const n=h.adCurrentTime/i*100;Number(c.style.width.replace("%",""))<n&&(c.style.width=n+"%")}o||requestAnimationFrame(d)};requestAnimationFrame(d)}},[e,s]);return O(()=>{s&&s.on("adstarted",n)},[n,s]),V("div",{className:dn.timeline,children:V("div",{className:dn.bar,children:V("div",{className:dn.progress,ref:t})})})}function pn({packshotDuration:e}){return V("div",{className:un.footer,children:V(_n,{packshotDuration:e})})}const mn={wrapper:"_wrapper_r5xom_1",adlabeltext:"_adlabeltext_r5xom_16",adlabel:"_adlabel_r5xom_16",tgchannel:"_tgchannel_r5xom_32"};function gn(){const t=W(),s=B(),e=N("NOT_SHOW_ADSGRAM_LABEL"),n=N("RU_GEO_SHOW")?Bs:ks,i=k(e=>{e.stopPropagation(),e.preventDefault(),s.emit(x.leave),fs({url:ms(),logger:t})},[s,t]);return e?V("p",{className:mn.adlabel,children:n}):V("div",{className:mn.wrapper,onClick:i,children:[V("p",{className:mn.tgchannel,children:"@adsgram_ai  ads in Telegram"}),V("p",{className:mn.adlabeltext,children:n})]})}const fn={close:"_close_e7d2o_1",clickable:"_clickable_e7d2o_9",image:"_image_e7d2o_13",show:"_show_e7d2o_1"},Sn={ru:" ?",en:"Skip Advert?"},yn={ru:" ,   ",en:"If you skip ad, you won't get a reward"},Cn={ru:"",en:"Skip anyway"},Gn={ru:" ",en:"Continue watching"};const Tn="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M18.295%207.115a.997.997%200%201%200-1.41-1.41L12%2010.59%207.115%205.705a.997.997%200%200%200-1.41%201.41L10.59%2012l-4.885%204.885a.997.997%200%200%200%201.41%201.41L12%2013.41l4.885%204.885a.997.997%200%201%200%201.41-1.41L13.41%2012l4.885-4.885Z'%20fill='%23fff'/%3e%3c/svg%3e";function In(){const e=on(),t=(()=>{const s=on(),n=sn()+"-video",[e,i]=M(null);return O(()=>{hn.onFiredBeforePlayerEvent("adstarted",()=>{var e;if(null!=s&&s.isSkippableAd){const t=null==(e=document.getElementById(n))?void 0:e.querySelector("div.rmp-ad-container-skip");t&&i(t)}})},[s,n]),e})(),s=B(),[n,i]=M(!1),r=(()=>{const e=on(),[t,s]=M(!1);return O(()=>{e&&e.on("adcomplete",()=>{s(!0)})},[e]),t})(),a=N("NONSKIP_ALWAYS"),o=({onSkip:h,onContinue:c}=[{onSkip:k(()=>{t&&t.click(),s.emit(w.onSkip)},[s,t]),onContinue:k(()=>{null!=e&&e.play()},[e])}][0],k(()=>{var e;if("function"==typeof(null==(e=null==(e=window.Telegram)?void 0:e.WebApp)?void 0:e.showPopup))try{window.Telegram.WebApp.showPopup({title:u(Sn),message:u(yn),buttons:[{id:"skip",type:"destructive",text:u(Cn)},{id:"continue",type:"default",text:u(Gn)}]},e=>{"skip"===e&&h(),"continue"===e&&c()})}catch(e){h()}else h()},[c,h])),l=k(()=>{n&&(r?s.emit(w.onReward):(null!=e&&e.pause(),o()))},[s,n,r,e,o]);var h,c;return O(()=>{e&&!a&&e.on("adskippablestatechanged",()=>i(e.adSkippableState))},[a,e]),n?V("div",{onClick:l,className:D(fn.close,{clickable:n}),children:V("img",{className:fn.image,src:Tn,alt:"Close ad button"})}):null}const bn={header:"_header_1c2pi_1",preview:"_preview_1c2pi_14",kebab:"_kebab_1c2pi_18","kebab-content":"_kebab-content_1c2pi_26",kebabContent:"_kebab-content_1c2pi_26"},An={volume:"_volume_10n0w_1"},Pn="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13%205.345c0-1.576-1.92-2.349-3.011-1.213L6.654%207.6H5a3%203%200%200%200-3%203v2.8a3%203%200%200%200%203%203h1.23l3.798%203.703c1.109%201.08%202.972.295%202.972-1.253V5.345ZM5%2014.4h2.044L11%2018.257V5.966L7.505%209.6H5a1%201%200%200%200-1%201v2.8a1%201%200%200%200%201%201Z'%20fill='%23fff'/%3e%3cpath%20d='M16.707%208.793a1%201%200%201%200-1.414%201.414L17.086%2012l-1.793%201.793a1%201%200%200%200%201.414%201.414l1.793-1.793%201.793%201.793a1%201%200%200%200%201.414-1.414L19.914%2012l1.793-1.793a1%201%200%200%200-1.414-1.414L18.5%2010.586l-1.793-1.793Z'%20fill='%23fff'/%3e%3c/svg%3e",En="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16.807%203.39a1%201%200%200%201%201.324-.497%2010%2010%200%200%201%20.253%2018.095%201%201%200%201%201-.877-1.797%208%208%200%200%200-.202-14.476%201%201%200%200%201-.498-1.324Z'%20fill='%23fff'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M9.989%204.132C11.08%202.996%2013%203.769%2013%205.345V18.85c0%201.548-1.863%202.334-2.972%201.253L6.231%2016.4H5a3%203%200%200%201-3-3v-2.8a3%203%200%200%201%203-3h1.654l3.335-3.468ZM7.044%2014.4H5a1%201%200%200%201-1-1v-2.8a1%201%200%200%201%201-1h2.505L11%205.966v12.29L7.044%2014.4Z'%20fill='%23fff'/%3e%3cpath%20d='M16.479%206.536a1%201%200%200%200-.827%201.821%204%204%200%200%201%20.102%207.238%201%201%200%200%200%20.876%201.798%206%206%200%200%200-.151-10.857Z'%20fill='%23fff'/%3e%3c/svg%3e",vn="volume-button";function Rn(){const e=on(),[t,s]=M(!1);return O(()=>{e&&s(e.muted)},[e]),V("div",{onClick:k(()=>{e.muted=!t,s(e=>!e)},[t,e]),className:An.volume,"data-testid":vn,children:V("img",t?{src:Pn,alt:"unmute"}:{src:En,alt:"mute"})})}function xn({kebab:e}){return V("div",{className:D(bn.header,!1),children:[V(Rn,{}),V(gn,{}),V(Ls,{kebab:e,classNameKebab:bn.kebab,classNameKebabContent:bn.kebabContent}),V(In,{})]})}const p={packshot:"_packshot_eb9zb_1",creatives:"_creatives_eb9zb_23",image:"_image_eb9zb_35",title:"_title_eb9zb_44",description:"_description_eb9zb_55",play:"_play_eb9zb_65",pause:"_pause_eb9zb_70"};function wn({image:e,title:t,description:s,duration:n}){const i=on(),r=B(),[a,o]=M(!1),l=F(null);return O(()=>{i&&i.on("adcomplete",()=>{o(!0),l.current=new en({callbacks:{endCallback:()=>{r.emit(w.onReward)}},endTime:n/1e3})})},[r,n,i]),O(()=>{const e=()=>{var e;null!=(e=l.current)&&e.destroy()},t=()=>{var e;null!=(e=l.current)&&e.resume()},s=()=>{var e;null!=(e=l.current)&&e.stop()};return r.on(x.finalDestroy,e),r.on(x.play,t),r.on(x.pause,s),()=>{r.off(x.finalDestroy,e),r.off(x.play,t),r.off(x.pause,s)}},[r,l]),V("div",{className:p.packshot+" "+(a?p.play:p.pause),children:V("div",{className:p.creatives+" "+(a?p.play:p.pause),children:[V(As,{className:p.image,src:e,alt:"app icon"}),V("span",{className:p.title,children:t}),V("span",{className:p.description,children:s})]})})}const m={childByName:function(e,t){const s=e.childNodes;for(const n in s){const i=s[n];if(i.nodeName===t)return i}},childrenByName:function(e,t){const s=[],n=e.childNodes;for(const i in n){const r=n[i];r.nodeName===t&&s.push(r)}return s},parseBoolean:function(e){return-1!==["true","TRUE","True","1"].indexOf(e)},parseNodeText:function(e){return e&&(e.textContent||e.text||"").trim()},copyNodeAttribute:function(e,t,s){const n=t.getAttribute(e);n&&s.setAttribute(e,n)},parseAttributes:function(e){const t=e.attributes,s={};for(let e=0;e<t.length;e++)s[t[e].nodeName]=t[e].nodeValue;return s},parseDuration:function(e){if(null==e)return-1;const t=e.split(":");if(3!==t.length)return-1;let s=t[2].split("."),n=parseInt(s[0]);2===s.length&&(n+=parseFloat("0."+s[1]));const i=parseInt(60*t[1]),r=parseInt(60*t[0]*60);return isNaN(r)||isNaN(i)||isNaN(n)||3600<i||60<n?-1:r+i+n}};function Dn(e,t){let n,i=((e={})=>{[e={}]=[e];const{id:t,adId:s,apiFramework:n}={id:e.id||null,adId:e.adId||null,apiFramework:e.apiFramework||null};return{id:t,adId:s,apiFramework:n,type:"linear",duration:0,skipDelay:null,mediaFiles:[],videoClickThroughURLTemplate:null,videoClickTrackingURLTemplates:[],videoCustomClickURLTemplates:[],trackingEvents:{}}})(t);i.duration=m.parseDuration(m.parseNodeText(m.childByName(e,"Duration")));const s=e.getAttribute("skipoffset");if(null==s)i.skipDelay=null;else if("%"===s.charAt(s.length-1)&&-1!==i.duration){const a=parseInt(s,10);i.skipDelay=i.duration*(a/100)}else i.skipDelay=m.parseDuration(s);const r=m.childByName(e,"VideoClicks");if(r){const o=m.childByName(r,"ClickThrough");i.videoClickThroughURLTemplate=o?{id:o.getAttribute("id")||null,url:m.parseNodeText(o)}:null,m.childrenByName(r,"ClickTracking").forEach(e=>{i.videoClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:m.parseNodeText(e)})})}return m.childrenByName(e,"TrackingEvents").forEach(e=>{m.childrenByName(e,"Tracking").forEach(e=>{let t=e.getAttribute("event"),s=m.parseNodeText(e);if(t&&s){if("progress"===t){if(!(n=e.getAttribute("offset")))return;t="%"===n.charAt(n.length-1)?"progress-"+n:"progress-"+Math.round(m.parseDuration(n))}Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(s)}})}),m.childrenByName(e,"MediaFiles").forEach(e=>{m.childrenByName(e,"MediaFile").forEach(e=>{i.mediaFiles.push((e=>{const t={id:null,fileURL:null,fileSize:0,deliveryType:"progressive",mimeType:null,mediaType:null,codec:null,bitrate:0,minBitrate:0,maxBitrate:0,width:0,height:0,apiFramework:null,scalable:null,maintainAspectRatio:null},s=(t.id=e.getAttribute("id"),t.fileURL=m.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.mediaType=e.getAttribute("mediaType")||"2D",t.apiFramework=e.getAttribute("apiFramework"),t.fileSize=parseInt(e.getAttribute("fileSize")||0),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0),e.getAttribute("scalable")),n=(s&&"string"==typeof s&&(t.scalable=m.parseBoolean(s)),e.getAttribute("maintainAspectRatio"));return n&&"string"==typeof n&&(t.maintainAspectRatio=m.parseBoolean(n)),t})(e))})}),i}function Mn(e){const s=[];return e.forEach(e=>{const t=function e(t){if("#comment"===t.nodeName)return null;const s={name:null,value:null,attributes:{},children:[]},n=t.attributes,i=t.childNodes;if(s.name=t.nodeName,t.attributes)for(const r in n)if(n.hasOwnProperty(r)){const a=n[r];a.nodeName&&a.nodeValue&&(s.attributes[a.nodeName]=a.nodeValue)}for(const o in i)if(i.hasOwnProperty(o)){const l=e(i[o]);l&&s.children.push(l)}if(0===s.children.length||1===s.children.length&&0<=["#cdata-section","#text"].indexOf(s.children[0].name)){const h=m.parseNodeText(t);""!==h&&(s.value=h),s.children=[]}return null===(t=s).value&&0===Object.keys(t.attributes).length&&0===t.children.length?null:s}(e);t&&s.push(t)}),s}function On(e){const o=[];return e.forEach(s=>{const n={id:s.getAttribute("id")||null,adId:(e=s).getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null,apiFramework:s.getAttribute("apiFramework")||null},i=[];var e;let r;m.childrenByName(s,"UniversalAdId").forEach(e=>{const t={idRegistry:e.getAttribute("idRegistry")||"unknown",value:m.parseNodeText(e)};i.push(t)});const t=m.childByName(s,"CreativeExtensions");t&&(r=Mn(m.childrenByName(t,"CreativeExtension")));for(const a in s.childNodes){let e=s.childNodes[a],t;switch(e.nodeName){case"Linear":t=Dn(e,n);break;case"NonLinearAds":throw new Error("NonLinear ads are not supported");case"CompanionAds":throw new Error("CompanionAds ads are not supported")}t&&(i&&(t.universalAdIds=i),r&&(t.creativeExtensions=r),o.push(t))}}),o}const Fn={Wrapper:{subElements:["VASTAdTagURI","Impression"]},InLine:{subElements:["AdSystem","AdTitle","Impression","AdServingId","Creatives"]},UniversalAdId:{attributes:["idRegistry"]},Tracking:{attributes:["event"]},Creatives:{subElements:["Creative"]},Creative:{subElements:["UniversalAdId"]},Linear:{subElements:["MediaFiles","Duration"]},MediaFiles:{subElements:["MediaFile"]},MediaFile:{attributes:["delivery","type","width","height"]},StaticResource:{attributes:["creativeType"]}};function Ln(t,e){if(Fn[t.nodeName]&&Fn[t.nodeName].attributes){const s=Fn[t.nodeName].attributes.filter(e=>!t.getAttribute(e));0<s.length&&Nn({name:t.nodeName,parentName:t.parentNode.nodeName,attributes:s},e)}}function kn(t,e,s){const n=Fn[t.nodeName],i=!s&&"Wrapper"!==t.nodeName;if(n&&!i){if(n.subElements){const r=n.subElements.filter(e=>!m.childByName(t,e));0<r.length&&Nn({name:t.nodeName,parentName:t.parentNode.nodeName,subElements:r},e)}s&&n.oneOfinLineResources&&(n.oneOfinLineResources.some(e=>m.childByName(t,e))||Nn({name:t.nodeName,parentName:t.parentNode.nodeName,oneOfResources:n.oneOfinLineResources},e))}}function Bn(e){return e.children&&0!==e.children.length}function Nn({name:e,parentName:t,attributes:s,subElements:n,oneOfResources:i},r){let a=`Element '${e}'`;r("VAST-warning",{message:a+=s?` missing required attribute(s) '${s.join(", ")}' `:n?` missing required sub element(s) '${n.join(", ")}' `:i?` must provide one of the following '${i.join(", ")}' `:" is empty",parentElement:t,specVersion:4.1})}const Wn={verifyRequiredValues:function t(s,n,i){if(s&&s.nodeName)if("InLine"===s.nodeName&&(i=!0),Ln(s,n),Bn(s)){kn(s,n,i);for(let e=0;e<s.children.length;e++)t(s.children[e],n,i)}else 0===m.parseNodeText(s).length&&Nn({name:s.nodeName,parentName:s.parentNode.nodeName},n)},hasSubElements:Bn,emitMissingValueWarning:Nn,verifyRequiredAttributes:Ln,verifyRequiredSubElements:kn};function Vn(e,t){const s=e.childNodes;for(const n in s){const i=s[n];if(-1!==["InLine"].indexOf(i.nodeName))return m.copyNodeAttribute("id",e,i),m.copyNodeAttribute("adType",e,i),{ad:((e,t)=>{{t&&Wn.verifyRequiredValues(e,t);const s=e.childNodes,n=((e={})=>({id:e.id||null,adType:e.adType||null,adServingId:null,system:null,title:null,description:null,errorURLTemplates:[],impressionURLTemplates:[],creatives:[],extensions:[],followAdditionalWrappers:!0,allowMultipleAds:!1,fallbackOnNoAd:null}))(m.parseAttributes(e));for(const i in s){const r=s[i];switch(r.nodeName){case"Error":n.errorURLTemplates.push(m.parseNodeText(r));break;case"Impression":n.impressionURLTemplates.push({id:r.getAttribute("id")||null,url:m.parseNodeText(r)});break;case"Creatives":n.creatives=On(m.childrenByName(r,"Creative"));break;case"Extensions":{const a=m.childrenByName(r,"Extension");n.extensions=Mn(a);break}case"AdSystem":n.system={value:m.parseNodeText(r),version:r.getAttribute("version")||null};break;case"AdTitle":n.title=m.parseNodeText(r);break;case"AdServingId":n.adServingId=m.parseNodeText(r);break;case"Description":n.description=m.parseNodeText(r)}}return n}})(i,t),type:"INLINE"}}}const Un=["MEDIAPLAYHEAD","TIMESTAMP"];function jn(e,t){let s=e;for(const n in t){const i=t[n];s=s.replace(new RegExp(`(?:\\[|%%)(${n})(?:\\]|%%)`,"g"),i)}return s}const Hn={track:function(h,e,t){((e={},t={})=>{const s=[],n=(i=h,Array.isArray(i)?i.map(e=>e&&e.hasOwnProperty("url")?e.url:e):i);var i,r;!e.ERRORCODE||t.isCustomCode||/^[0-9]{3}$/.test(e.ERRORCODE)||(e.ERRORCODE=900),e.TIMESTAMP=(new Date).toISOString();for(const a in e)e[a]=(r=e[a],encodeURIComponent(r).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16)));for(const o in n){const l=n[o];"string"==typeof l&&s.push(((e,t)=>{const s=(e=jn(e,t)).match(/[^[\]]+(?=])/g);if(!s)return e;let n=s.filter(e=>-1<Un.indexOf(e));return 0===n.length?e:jn(e,n=n.reduce((e,t)=>(e[t]=-1,e),{}))})(l,e))}return s})(e,t).forEach(e=>{"undefined"!=typeof window&&null!==window&&((new Image).src=e)})}},Xn={ERRORCODE:900,extensions:[]};class qn{constructor(s){this.remainingAds=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.URLTemplateFilters=[],this.emit=(e,t)=>{s(e,t)}}_trackVastError(e,t,...s){this.emit("VAST-error",Object.assign({},Xn,t,...s)),Hn.track(e,t)}_getErrorURLTemplates(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}_initParsingStatus(){this.errorURLTemplates=[],this.remainingAds=[],this.rootErrorURLTemplates=[],this.vastVersion=null}parseVAST(e){return this._initParsingStatus(),this._parse(e).then(e=>this.buildVASTResponse(e))}buildVASTResponse(e){const t={ads:e,errorURLTemplates:this._getErrorURLTemplates(),version:this.vastVersion};return this._reportPossibleParsingErrors(t),t}_parseVastXml(e){if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)throw this.emit("VAST-ad-parsed",{type:"ERROR"}),new Error("Invalid VAST XMLDocument");const t=[],s=e.documentElement.childNodes,n=e.documentElement.getAttribute("version");n&&(this.vastVersion=n);for(const i in s){const r=s[i];if("Error"===r.nodeName){const a=m.parseNodeText(r);this.rootErrorURLTemplates.push(a)}else if("Ad"===r.nodeName){if(1<t.length)throw new Error("VAST document must contain one Ad");const o=Vn(r,this.emit.bind(this));o.ad?(t.push(o.ad),this.emit("VAST-ad-parsed",{type:o.type})):this._trackVastError(this._getErrorURLTemplates(),{ERRORCODE:101})}}return t}_parse(e){let t=[];try{t=this._parseVastXml(e)}catch(e){return Promise.reject(e)}return Promise.resolve(t)}_reportPossibleParsingErrors(t){if(0===t.ads.length)this._trackVastError(t.errorURLTemplates,{ERRORCODE:303});else for(let e=t.ads.length-1;0<=e;e--){const s=t.ads[e];!s.errorCode&&0!==s.creatives.length||(this._trackVastError(s.errorURLTemplates.concat(t.errorURLTemplates),{ERRORCODE:s.errorCode||303},{ERRORMESSAGE:s.errorMessage||""},{extensions:s.extensions},{system:s.system}),t.ads.splice(e,1))}}}class $n{constructor(){}_getConnectionType(){if("string"==typeof navigator.connection.type&&""!==navigator.connection.type)switch(navigator.connection.type){case"ethernet":return"ethernet";case"wifi":case"wimax":return"wifi";case"bluetooth":case"cellular":return"cellular";case"none":return"none"}return"unknown"}_getBandwidthEstimate(){if("number"==typeof navigator.connection.downlink&&0<navigator.connection.downlink)return navigator.connection.downlink;if("string"==typeof navigator.connection.effectiveType&&""!==navigator.connection.effectiveType)switch(navigator.connection.effectiveType){case"slow-2g":return.025;case"2g":return.035;case"3g":return.35;case"4g":return 1.4}else if("string"==typeof navigator.connection.type&&""!==navigator.connection.type)switch(navigator.connection.type){case"ethernet":case"wifi":case"wimax":return 1.4;case"bluetooth":case"cellular":return.35;case"none":return-1}return.025}get bandwidthData(){return void 0===navigator.onLine||navigator.onLine?void 0===navigator.connection?{estimate:1.1,connectionType:"unknown"}:{estimate:this._getBandwidthEstimate(),connectionType:this._getConnectionType()}:{estimate:-1,connectionType:"none"}}}class g{static _filterVersion(e){if(navigator.userAgent){const t=navigator.userAgent.match(e);if(Array.isArray(t)&&void 0!==t[1])return parseInt(t[1],10)}return-1}static get _testVideo(){return document.createElement("video")}static get hasTouchEvents(){return!!(void 0!==window.ontouchstart||window.DocumentTouch&&document instanceof window.DocumentTouch)}static get userAgent(){return navigator.userAgent||null}static get devicePixelRatio(){let e=1;return e=Number.isFinite(window.devicePixelRatio)&&1<window.devicePixelRatio?window.devicePixelRatio:e}static get maxTouchPoints(){return"number"==typeof navigator.maxTouchPoints?navigator.maxTouchPoints:-1}static get isIos(){let e=[!1,-1];return e=/(ipad|iphone|ipod)/i.test(g.userAgent)&&g.hasTouchEvents?[!0,g._filterVersion(/os\s+(\d+)_/i)]:e}static get isIpadOS(){return!!(!g.isIos[0]&&g.hasTouchEvents&&/macintel/i.test(navigator.platform)&&1<g.devicePixelRatio&&1<g.maxTouchPoints)}static get isMacOS(){let e=!1,t=-1;return g.isIos[0]||g.isIpadOS||!/(macintosh|mac\s+os)/i.test(g.userAgent)||(e=!0,t=g._filterVersion(/mac\s+os\s+x\s+(\d+)_(\d+)/i,!0)),[e,t]}static get isSafari(){let e=!1,t=-1;return/safari\/[.0-9]*/i.test(g.userAgent)&&!/(chrome|chromium|android|crios|fxios)/i.test(g.userAgent)&&(e=!0,t=g._filterVersion(/version\/(\d+)\./i)),[e,t]}static get isMacOSSafari(){return g.isMacOS[0]&&g.isSafari[0]}static get isAndroid(){let e=[!1,-1];return e=!g.isIos[0]&&g.hasTouchEvents&&/android/i.test(g.userAgent)?[!0,g._filterVersion(/android\s*(\d+)\./i)]:e}static get isMobile(){return!!(g.isIos[0]||g.isAndroid[0]||g.isIpadOS)}static get hasNativeFullscreenSupport(){const e=document.documentElement,t=g._testVideo;return!(!e||void 0===e.requestFullscreen&&void 0===e.webkitRequestFullscreen&&void 0===e.mozRequestFullScreen&&void 0===e.msRequestFullscreen&&void 0===t.webkitEnterFullscreen)}static checkCanPlayType(s,e){const n=g._testVideo;if("undefined"!==n.canPlayType){if((g.isSafari[0]||g.isIpadOS[0]||g.isIos[0])&&"video/webm"===s)return!1;if(s&&e){let t;try{t=n.canPlayType(s+`; codecs="${e}"`)}catch(e){return"probably"===(t=n.canPlayType(s))}if(""!==t)return!0}else if(s&&!e&&""!==n.canPlayType(s))return!0}return!1}}class f{static _getStyleAttributeData(e,t){let s=0,n=window.getComputedStyle(e,null);return n&&(s=(s=n.getPropertyValue(t)).toString().toLowerCase()),parseFloat(s)}static getWidth(e){return e?Number.isFinite(e.offsetWidth)&&0!==e.offsetWidth?e.offsetWidth:f._getStyleAttributeData(e,"width"):0}static getHeight(e){return e?Number.isFinite(e.offsetHeight)&&0!==e.offsetHeight?e.offsetHeight:f._getStyleAttributeData(e,"height"):0}static show(e){e&&(e.style.display="block")}static hide(e){e&&(e.style.display="none")}static get consoleStyle(){return"color: white; background-color: #00ACC1; padding:1px 3px; border-radius: 3px; margin-right: 7px"}static get consoleStyle2(){return"color: white; background-color: #FB8C00; padding:1px 3px; border-radius: 3px; margin-right: 7px"}static get consolePrepend(){return navigator&&navigator.userAgent&&/(edge|xbox|msie|trident)/i.test(navigator.userAgent)?"RMP-VAST:":"%crmp-vast%c"}static logVideoEvents(t,e){["loadstart","durationchange","playing","waiting","loadedmetadata","loadeddata","canplay","canplaythrough"].forEach(e=>{t.addEventListener(e,e=>{e&&e.type})})}static ajax(n,i,r,a=0){return new Promise((e,t)=>{const s=new XMLHttpRequest;s.open("GET",n,!0),s.timeout=i,r&&(s.withCredentials=!0),s.onloadend=()=>{"number"==typeof s.status&&200<=s.status&&s.status<300?e("XMLHttpRequest request succeeded"):a<1||"number"!=typeof a?t("XMLHttpRequest wrong status code: "+s.status):f.ajax(n,i,r,a-1)},s.ontimeout=()=>{a<1||"number"!=typeof a?t("XMLHttpRequest timeout"):f.ajax(n,i,r,a-1)},s.send(null)})}}class S{static _dispatch(t){const e=this.trackingTags.filter(e=>t===e.event);0<e.length&&e.forEach(e=>{S.pingURI.call(this,e.url)})}static _vastReadableTime(e){if(!Number.isFinite(e)||e<0)return"00:00:00.000";let t=(e,t=2)=>String(e).padStart(t,"0"),s=t(Math.floor(e%1e3),3),n=Math.floor(e/1e3),i=Math.floor(n/60),r=Math.floor(i/60),a=t(n%=60),o=t(i%60);return t(23<r?0:r)+`:${o}:${a}.`+s}static _ping(e){f.ajax(e,this.params.ajaxTimeout,!1,2).then(()=>{}).catch(e=>{})}static _onVolumeChange(){this.__adPlayer.muted||0===this.__adPlayer.volume?(o.createApiEvent.call(this,"advolumemuted"),S.dispatch.call(this,"mute")):!this.__adPlayer.muted&&0<this.__adPlayer.volume&&S.dispatch.call(this,"unmute"),o.createApiEvent.call(this,"advolumechanged")}static _onTimeupdate(){let s=-1,n=-1;this.rmpVastAdPlayer&&(n=this.rmpVastAdPlayer.currentTime,s=this.rmpVastAdPlayer.duration),0<n&&0<s&&s>n&&(n>=.25*s&&!this.firstQuartileEventFired?(this.firstQuartileEventFired=!0,o.createApiEvent.call(this,"adfirstquartile"),S.dispatch.call(this,"firstQuartile")):n>=.5*s&&!this.midpointEventFired?(this.midpointEventFired=!0,o.createApiEvent.call(this,"admidpoint"),S.dispatch.call(this,"midpoint")):n>=.75*s&&!this.thirdQuartileEventFired&&(this.thirdQuartileEventFired=!0,o.createApiEvent.call(this,"adthirdquartile"),S.dispatch.call(this,"thirdQuartile")),2e3<=n&&!this.progressEventFired&&(this.progressEventFired=!0,o.createApiEvent.call(this,"adprogress"),S.dispatch.call(this,"progress-2")),Object.entries(this.params.timeEvents).forEach(([e,t])=>{this.timeEventsFired[e]||(t<0&&n>=s+t||0<=t&&n>=t)&&(this.timeEventsFired[e]=!0,o.createApiEvent.call(this,e))}))}static _onPause(){this.__adPlayer&&this.__adPlayer.paused&&this.__adPlayer.currentTime!==this.__adPlayer.duration&&(o.createApiEvent.call(this,"adpaused"),S.dispatch.call(this,"pause"))}static _onPlay(){this.__adPlayer&&!this.__adPlayer.paused&&0!==this.__adPlayer.currentTime&&(o.createApiEvent.call(this,"adresumed"),S.dispatch.call(this,"resume"))}static _onPlaying(){o.createApiEvent.call(this,["adimpression","adstarted"]),S.dispatch.call(this,["start","creativeView","impression"])}static _onEnded(){o.createApiEvent.call(this,"adcomplete"),S.dispatch.call(this,"complete"),this.rmpVastAdPlayer&&(this.params.pauseOnEnd?this.__adPlayer.pause():this.rmpVastAdPlayer.destroy())}static replaceMacros(e){if(!/\[.+?\]/i.test(e))return e;let t=e,s=/\[TIMESTAMP\]/gi,n=(new Date).toISOString(),i=(s.test(t)&&(t=t.replace(s,encodeURIComponent(n))),/\[MEDIAPLAYHEAD\]/gi),r=-1;return this.rmpVastAdPlayer&&(r=this.rmpVastAdPlayer.currentTime),t=i.test(t)&&-1<r?t.replace(i,encodeURIComponent(S._vastReadableTime(r))):t}static pingURI(e){const t=S.replaceMacros.call(this,e);S._ping.call(this,t)}static error(a,o){let e=this.adErrorTags;0<(e=303===a&&0<this.vastErrorTags.length?[...e,...this.vastErrorTags]:e).length&&e.forEach(s=>{if(s.url){let e=s.url,t=/\[ERRORCODE\]/gi;if(t.test(e)&&Number.isFinite(a)&&0<a&&a<1e3&&(e=e.replace(t,a)),o){const n=JSON.stringify(o),i=encodeURIComponent(n),r=`${e}${-1!==e.indexOf("?")?"&":"?"}extra=`+i;e=r}S._ping.call(this,e)}})}static dispatch(e){Array.isArray(e)?e.forEach(e=>{S._dispatch.call(this,e)}):S._dispatch.call(this,e)}static destroy(){this.__adPlayer&&(this.__adPlayer.removeEventListener("pause",this.onPauseFn),this.__adPlayer.removeEventListener("play",this.onPlayFn),this.__adPlayer.removeEventListener("playing",this.onPlayingFn),this.__adPlayer.removeEventListener("ended",this.onEndedFn),this.__adPlayer.removeEventListener("volumechange",this.onVolumeChangeFn),this.__adPlayer.removeEventListener("timeupdate",this.onTimeupdateFn))}static wire(){this.__adPlayer&&this.creative.isLinear&&!this.rmpVastVpaidPlayer&&(this.onPauseFn=S._onPause.bind(this),this.__adPlayer.addEventListener("pause",this.onPauseFn),this.onPlayFn=S._onPlay.bind(this),this.__adPlayer.addEventListener("play",this.onPlayFn),this.onPlayingFn=S._onPlaying.bind(this),this.__adPlayer.addEventListener("playing",this.onPlayingFn,{once:!0}),this.onEndedFn=S._onEnded.bind(this),this.__adPlayer.addEventListener("ended",this.onEndedFn,{once:!0}),this.onVolumeChangeFn=S._onVolumeChange.bind(this),this.__adPlayer.addEventListener("volumechange",this.onVolumeChangeFn),this.onTimeupdateFn=S._onTimeupdate.bind(this),this.__adPlayer.addEventListener("timeupdate",this.onTimeupdateFn))}}class o{static _updateVastError(t){const e=[{code:201,description:"Video player expecting different linearity."},{code:303,description:"No VAST response after one or more Wrappers."},{code:400,description:"General Linear error. Video player is unable to display the Linear Ad."},{code:401,description:"File not found. Unable to find Linear/MediaFile from URI."},{code:402,description:"Timeout of MediaFile URI."},{code:403,description:"Could not find MediaFile that is supported by this video player, based on the attributes of the MediaFile element."},{code:501,description:"Unable to display NonLinear Ad because creative dimensions do not align with creative display area (i.e. creative dimension too large)."},{code:502,description:"Unable to fetch NonLinearAds/NonLinear resource."},{code:503,description:"Could not find NonLinear resource with supported type."},{code:603,description:"Unable to fetch CompanionAds/Companion resource."},{code:900,description:"Undefined Error."},{code:901,description:"General VPAID error."},{code:1001,description:"Invalid input for loadAds method"},{code:1002,description:"Required DOMParser API is not available"}].filter(e=>e.code===t);0<e.length?(this.__vastErrorCode=e[0].code,this.__adErrorMessage=e[0].description):(this.__vastErrorCode=-1,this.__adErrorMessage="Error getting VAST error"),-1<this.__vastErrorCode&&(-1<[303,900,1001].indexOf(this.__vastErrorCode)?this.__adErrorType="adLoadError":-1<[201,204,205,400,401,402,403,501,502,503,603,901,1002].indexOf(this.__vastErrorCode)&&(this.__adErrorType="adPlayError"))}static filterParams(t){this.params={ajaxTimeout:5e3,creativeLoadTimeout:8e3,ajaxWithCredentials:!1,maxNumRedirects:4,vastXmlInput:!1,enableVpaid:!1,pauseOnEnd:!1,timeEvents:{},clickThroughElementId:""},t&&"object"==typeof t&&Object.keys(t).forEach(e=>{typeof t[e]==typeof this.params[e]&&(Number.isFinite(t[e])&&0<t[e]||"number"!=typeof t[e])&&(this.params[e]=t[e])})}static createApiEvent(e){Array.isArray(e)?e.forEach(e=>{e&&this.dispatch(e)}):e&&this.dispatch(e)}static playPromise(t,s){let e;switch(t){case"content":e=this.__contentPlayer;break;case"vast":e=this.__adPlayer}if(e){const n=e.play();void 0!==n&&n.then(()=>{s&&o.createApiEvent.call(this,"adinitialplayrequestsucceeded")}).catch(e=>{console.warn(e),s&&"vast"===t&&this.creative.isLinear?(o.createApiEvent.call(this,"adinitialplayrequestfailed"),this.rmpVastAdPlayer.appendPlayButton()):s&&"content"===t&&!this.creative.isLinear&&o.createApiEvent.call(this,"adinitialplayrequestfailed")})}}static initInstanceVariables(){this.adContainer=null,this.contentWrapper=null,this.container=null,this.rmpVastContentPlayer=null,this.rmpVastAdPlayer=null,this.currentContentSrc="",this.currentContentCurrentTime=-1,this.params={},this.events={},this.adPod=!1,this.adPodLength=0,this.__contentPlayer=null,this.__adPlayer=null,this.__initialized=!1,this.__contentPlayerCompleted=!1}static resetVariablesForNewLoadAds(){this.off("adstarted",this.attachViewableObserverFn),this.onPauseFn=null,this.onPlayFn=null,this.onPlayingFn=null,this.onEndedFn=null,this.onVolumeChangeFn=null,this.onTimeupdateFn=null,this.trackingTags=[],this.vastErrorTags=[],this.adErrorTags=[],this.firstQuartileEventFired=!1,this.midpointEventFired=!1,this.progressEventFired=!1,this.thirdQuartileEventFired=!1,this.needsSeekAdjust=!1,this.seekAdjustAttached=!1,this.ad={},this.creative={},this.attachViewableObserverFn=null,this.viewableObserver=null,this.viewablePreviousRatio=.5,this.progressEvents=[],this.rmpVastLinearCreative=null,this.rmpVastVpaidPlayer=null,this.adParametersData="",this.__vastErrorCode=-1,this.__adErrorType="",this.__adErrorMessage="",this.__adOnStage=!1,this.timeEventsFired={},this.clickThroughElement=null}static processVastErrors(e,t,s){t&&S.error.call(this,e,s),o._updateVastError.call(this,e),o.createApiEvent.call(this,"aderror"),this.rmpVastAdPlayer&&this.rmpVastAdPlayer.destroy()}}class Yn{constructor(e){this._rmpVast=e,this._params=e.params,this._container=e.container,this._adContainer=e.adContainer,this._adPlayer=e.__adPlayer,this._contentPlayer=e.__contentPlayer,this._firstAdPlayerPlayRequest=!0,this._skippableAdCanBeSkipped=!1,this._onTimeupdateCheckSkipFn=null,this._onDurationChangeFn=null,this._onLoadedmetadataPlayFn=null,this._onContextMenuFn=null,this._onPlaybackErrorFn=null,this._onInteractionOpenClickThroughUrlFn=null,this._creativeLoadTimeoutCallback=null}get skippableAdCanBeSkipped(){return this._skippableAdCanBeSkipped}_onDurationChange(){let n=-1;this._rmpVast.rmpVastAdPlayer&&(n=this._rmpVast.rmpVastAdPlayer.duration),o.createApiEvent.call(this._rmpVast,"addurationchange"),-1!==n&&(Object.keys(this._rmpVast.creative.trackingEvents).forEach(e=>{if(/progress-/i.test(e)){const s=e.split("-")[1];if(/%/i.test(s)){let t=s.slice(0,-1);t=n*parseFloat(t)/100,this._rmpVast.creative.trackingEvents[e].forEach(e=>{this._rmpVast.progressEvents.push({time:t,url:e})})}else this._rmpVast.creative.trackingEvents[e].forEach(e=>{this._rmpVast.progressEvents.push({time:1e3*parseFloat(s),url:e})})}}),0<this._rmpVast.progressEvents.length)&&this._rmpVast.progressEvents.sort((e,t)=>e.time-t.time)}_onLoadedmetadataPlay(){clearTimeout(this._creativeLoadTimeoutCallback),this._adPlayer&&(this._contentPlayer.muted?this._adPlayer.muted=!0:this._adPlayer.muted=!1),f.show(this._adContainer),f.show(this._adPlayer),this._rmpVast.__adOnStage=!0,this._rmpVast.rmpVastAdPlayer&&(this._rmpVast.rmpVastAdPlayer.play(this._firstAdPlayerPlayRequest),this._firstAdPlayerPlayRequest=!1),o.createApiEvent.call(this._rmpVast,"adloaded"),S.dispatch.call(this._rmpVast,"loaded")}_onInteractionOpenClickThroughUrl(e){e&&e.stopPropagation(),o.createApiEvent.call(this._rmpVast,"adclick"),S.dispatch.call(this._rmpVast,"clickthrough")}_onPlaybackError(e){if(e&&e.target){const t=e.target;if(t.error&&Number.isFinite(t.error.code)){let e=t.error.code;if("string"==typeof t.error.message&&t.error.message,4===e){const s={errorCode:t.error.code,errorMessage:t.error.message,videoNetworkState:t.networkState,videoReadyState:t.readyState,videoSrc:t.src,videoCurrentSrc:t.currentSrc};o.processVastErrors.call(this._rmpVast,401,!0,s)}}}}_onContextMenu(e){e&&(e.stopPropagation(),e.preventDefault())}_onTimeupdateCheckSkip(){const e=this._adPlayer.currentTime;Number.isFinite(e)&&0<e&&e>=this._rmpVast.creative.skipoffset&&(this._adPlayer.removeEventListener("timeupdate",this._onTimeupdateCheckSkipFn),this._skippableAdCanBeSkipped=!0,o.createApiEvent.call(this._rmpVast,"adskippablestatechanged"))}destroy(){clearTimeout(this._creativeLoadTimeoutCallback),this._adPlayer&&(this._adPlayer.removeEventListener("click",this._onInteractionOpenClickThroughUrlFn),this._adPlayer.removeEventListener("timeupdate",this._onTimeupdateCheckSkipFn),this._adPlayer.removeEventListener("durationchange",this._onDurationChangeFn),this._adPlayer.removeEventListener("loadedmetadata",this._onLoadedmetadataPlayFn),this._adPlayer.removeEventListener("contextmenu",this._onContextMenuFn),this._adPlayer.removeEventListener("error",this._onPlaybackErrorFn)),this._contentPlayer.removeEventListener("error",this._onPlaybackErrorFn),this.clickThroughElement&&this.clickThroughElement.removeEventListener("click",this._onInteractionOpenClickThroughUrlFn)}update(e,t){if(this._onDurationChangeFn=this._onDurationChange.bind(this),this._adPlayer.addEventListener("durationchange",this._onDurationChangeFn,{once:!0}),this._onLoadedmetadataPlayFn=this._onLoadedmetadataPlay.bind(this),this._adPlayer.addEventListener("loadedmetadata",this._onLoadedmetadataPlayFn,{once:!0}),this._onContextMenuFn=this._onContextMenu.bind(this),this._adPlayer.addEventListener("contextmenu",this._onContextMenuFn),this._onPlaybackErrorFn=this._onPlaybackError.bind(this),this._creativeLoadTimeoutCallback=setTimeout(()=>{const e=this._adPlayer,t={videoNetworkState:e.networkState,videoReadyState:e.readyState,videoSrc:e.src,videoCurrentSrc:e.currentSrc};o.processVastErrors.call(this._rmpVast,402,!0,t)},this._params.creativeLoadTimeout),this._adPlayer.addEventListener("error",this._onPlaybackErrorFn),this._adPlayer.src=e,this._adPlayer.load(),this._onInteractionOpenClickThroughUrlFn=this._onInteractionOpenClickThroughUrl.bind(this),this._rmpVast.creative.clickThroughUrl){if(this.clickThroughElement=this._params.clickThroughElementId&&this._container.getRootNode().querySelector("#"+CSS.escape(this._params.clickThroughElementId)),!this.clickThroughElement)throw new Error("clickThroughElementId is not valid");this.clickThroughElement.addEventListener("click",this._onInteractionOpenClickThroughUrlFn)}this._rmpVast.creative.isSkippableAd&&(this._onTimeupdateCheckSkipFn=this._onTimeupdateCheckSkip.bind(this),this._adPlayer.addEventListener("timeupdate",this._onTimeupdateCheckSkipFn))}parse(e){const i=e.mediaFiles;if(0!==i.length){const r="hvc1",h="avc1.4d401f",c="vp9",u=e=>{if(e.codec&&e.mimeType)return e.codec;if("video/mp4"===e.mimeType&&e.fileURL.endsWith("-x265.mp4"))return r;if(e.mimeType)switch(e.mimeType){case"video/mp4":return h;case"video/webm":return c;default:return null}return null},d=["video/mp4","video/webm"],_=i.filter(e=>null!==e.fileURL&&null!==e.mimeType&&d.includes(e.mimeType)&&(e=>{const t=u(e);return!!t&&g.checkCanPlayType(e.mimeType,t)})(e));if(0===_.length){const p=i.findAll(e=>"video/mp4"===e.mimeType&&u(e)===h);_.push(...p)}let a=e=>{const{width:t,height:s,bitrate:n}=e;return n||{[h]:87e-5,[c]:61e-5,[r]:76e-5}[u(e)]*t*s},o=new $n,l=-1<o.bandwidthData.estimate,t=e=>{let{width:t,height:s}=e,n=1;if(l){const i=Math.round(1e3*o.bandwidthData.estimate);n*=Math.min(i/a(e),1)}if(t&&s){const r=Math.min(t/(f.getWidth(this._container)*g.devicePixelRatio),s/(f.getHeight(this._container)*g.devicePixelRatio));n*=Math.min(1,r)}return n},s,n=0;for(let e=0;e<_.length;e++){const m=t(_[e]);m>n?(n=m,s=_[e]):m===n&&(s=a(_[e])<a(s)?_[e]:s)}this._rmpVast.creative.mediaUrl=s.fileURL,this._rmpVast.creative.height=s.height,this._rmpVast.creative.width=s.width,this._rmpVast.creative.type=s.mimeType,this._rmpVast.rmpVastAdPlayer&&this._rmpVast.rmpVastAdPlayer.append(s.fileURL,s.mimeType)}}}class zn{constructor(e){this.eventName=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}unregisterCallback(e){const t=this.callbacks.indexOf(e);-1<t&&this.callbacks.splice(t,1)}fire(t){this.callbacks.slice(0).forEach(e=>{e(t)})}}class Kn{constructor(e){i(this,"_rmpVast"),this._rmpVast=e,this._params=e.params,this._adContainer=e.adContainer,this._contentWrapper=e.contentWrapper,this._adPlayer=null,this._onTimeUpdateFn=null,this._onProgressFn=null,this._onPlayButtonClickFn=null}destroy(){this._rmpVast.rmpVastLinearCreative&&this._rmpVast.rmpVastLinearCreative.destroy(),this._onTimeUpdateFn&&this._adPlayer.removeEventListener("timeupdate",this._onTimeUpdateFn),this._onProgressFn&&this._adPlayer.removeEventListener("progress",this._onProgressFn),this._onPlayButtonClickFn&&this._adPlayer.removeEventListener("click",this._onPlayButtonClickFn),S.destroy.call(this._rmpVast),f.hide(this._adContainer);try{this._adPlayer&&(this._adPlayer.pause(),this._adPlayer.removeAttribute("src"),this._adPlayer.load(),f.hide(this._adPlayer))}catch(e){console.warn(e)}o.resetVariablesForNewLoadAds.call(this._rmpVast),o.createApiEvent.call(this._rmpVast,"addestroyed")}init(){this._rmpVast.adContainer=this._adContainer=document.createElement("div"),this._adContainer.className="rmp-ad-container",this._contentWrapper.appendChild(this._adContainer),f.hide(this._adContainer),this._rmpVast.__adPlayer=this._adPlayer=this._rmpVast.__contentPlayer,f.logVideoEvents(this._adPlayer,"ad"),g.isMobile&&this._adPlayer.load(),(g.isIos[0]||g.isMacOS[0]||g.isIpadOS||g.isMacOS[0])&&(this._onTimeUpdateFn=this._onTimeUpdate.bind(this),this._adPlayer.addEventListener("timeupdate",this._onTimeUpdateFn),this._onProgressFn=this._onProgress.bind(this),this._adPlayer.addEventListener("progress",this._onProgressFn)),this._rmpVast.__initialized=!0}append(e,t){if(!this._adPlayer)throw new Error("AdPlayer: missing ad player");e&&t&&this._rmpVast.rmpVastLinearCreative&&this._rmpVast.rmpVastLinearCreative.update(e,t),S.wire.call(this._rmpVast)}appendPlayButton(){const e=document.createElement("div"),t=(e.className="rmp-ad-container-play-button",e.style.cssText="width: 136px; height: 136px; border-radius: 100%; background-color: rgb(255 255 255 / 12%); position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); display: flex; justify-content: center; align-items: center;",e.setAttribute("data-testid","play-button"),document.createElement("img")),s=(t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKESURBVHgB7dztcdNAEIDhNUMBKcHpIKkAUgFDBTgV4FRgUwGhAkMFmApsKiBUIHUAHSy7IzyRE9uxpDt93fvM7Ezy9/bjzmdZIgAAAAAAAAAAjIOqXlls9JH/PRXE5wtt8UcPW5GIyJ5U/iGZxQdBHHo+T8Q7QVha3UoZS+FofUtBc9pMpuwPzWgY35WxVI+G9ZlEVKThZTqisTSRyHzFJI7c4mYymeQyYK9kuKYW3g0rxtIJ2g6/6lgKntN2ZcqxdZ92Y6UDGUtD3oTP8cni3jbqv5Iq7V6mPR5LY++AsgeL9307tg75GFrVlfTw2JpSAnZmFpu+jKWURtAhucXcxtIP6UiKHVA2tVh3OZZST8DOTIr9YSktIwH7Fm0fW1PfA05ZW9zFPraSgJfdW3yJlQgScJ7cYmlJ+CaBkYBqcgn8JRCbcDVTKU5LcwmEDqjHb1cvQ9yy0gH1XFgEeYySBHSMBNT3WwIgAfV8tfn/IAGQgOr8g9mdBPJacK7cYmaV/1MCogPO41V/HXrxHR1wWi4Rqr6MDjguWtWX0QHP+elmHnvhd+iAfX7jed3W4js6oLCV4suXIGf7KlLvAL9M83Fz08Xiu5Q7YGtx2/WTcil2QLnqc+lYah2wlR5UfVkqHdCrqi9LoQO20rOqLxtzB/S26svG2gH+UNXtEH4ZM7YE+IL7wq9lIMY0gvzy7HJIi+/G0AG5RL4yHjSNy1/ecSE4TuPILN4IXqbhUfVVaDiZUvXVaRhUfV3azC+l6pvR+haC5rS6jcWVIIwKC+8vXfooCEuPv7j7adVPBeHZwi6o+o5p8eJVqv6A6L8R29Hizehv//+75vIMAAAAAAAAAIDW/AMZppzFSmxZ4wAAAABJRU5ErkJggg==",t.width=96,t.height=96,e.appendChild(t),this._adContainer.appendChild(e),this._onPlayButtonClickFn=this._onPlayButtonClick.bind(this),this._adPlayer.addEventListener("click",this._onPlayButtonClickFn,{once:!0}),setTimeout(()=>{o.processVastErrors.call(this,400,!0)},8e3));this._adPlayer.addEventListener("playing",()=>{e.remove(),clearTimeout(s)},{once:!0})}_onPlayButtonClick(){this._adPlayer.play();const e=this._adContainer.querySelector(".rmp-ad-container-play-button");e&&e.remove()}_onTimeUpdate(){this.lastBufferedTime<this._adPlayer.currentTime&&this._adPlayer.pause()}_onProgress(){this.lastBufferedTime>this._adPlayer.currentTime&&this._adPlayer.paused&&this._adPlayer.play()}set volume(e){this._adPlayer&&(this._adPlayer.volume=e)}get volume(){return this._adPlayer?this._adPlayer.volume:-1}set muted(e){this._adPlayer&&(e&&!this._adPlayer.muted?this._adPlayer.muted=!0:!e&&this._adPlayer.muted&&(this._adPlayer.muted=!1))}get muted(){return!!this._adPlayer&&this._adPlayer.muted}get duration(){return this._adPlayer&&Number.isFinite(this._adPlayer.duration)?1e3*this._adPlayer.duration:-1}get currentTime(){return this._adPlayer&&Number.isFinite(this._adPlayer.currentTime)?1e3*this._adPlayer.currentTime:-1}get lastBufferedTime(){if(this._adPlayer.buffered&&0<this._adPlayer.buffered.length){const e=this._adPlayer.buffered?this._adPlayer.buffered.end(this._adPlayer.buffered.length-1):void 0;if(void 0!==e)return e}return 1/0}play(e){this._adPlayer&&this._adPlayer.paused&&o.playPromise.call(this._rmpVast,"vast",e)}pause(){this._adPlayer&&!this._adPlayer.paused&&this._adPlayer.pause()}}class Jn{constructor(e,t){i(this,"rmpVastAdPlayer"),i(this,"rmpVastLinearCreative"),o.initInstanceVariables.call(this),e instanceof HTMLElement&&(this.container=e,this.contentWrapper=this.container.querySelector(".rmp-content"),this.__contentPlayer=this.container.querySelector(".rmp-video"),null!==this.container)&&null!==this.contentWrapper&&null!==this.__contentPlayer&&(o.resetVariablesForNewLoadAds.call(this),o.filterParams.call(this,t))}dispatch(e,t){const s=this.events[e];if(s){const n={type:e};t&&(n.data=t),s.fire(n)}}_on(e,t){let s=this.events[e];s||(s=new zn(e),this.events[e]=s),s.registerCallback(t)}on(e,t){"string"==typeof e&&""!==e&&"function"==typeof t&&e.split(" ").forEach(e=>{this._on(e,t)})}_off(e,t){const s=this.events[e];s&&-1<s.callbacks.indexOf(t)&&(s.unregisterCallback(t),0===s.callbacks.length)&&delete this.events[e]}off(e,t){"string"==typeof e&&""!==e&&"function"==typeof t&&e.split(" ").forEach(e=>{this._off(e,t)})}_addTrackingEvents(e){Object.keys(e).forEach(t=>{e[t].forEach(e=>{this.trackingTags.push({event:t,url:e})})})}_loopAds(t){for(let e=0;e<t.length;e++){const s=t[e],n=(this.ad.id=s.id,this.ad.adServingId=s.adServingId,this.ad.adType=s.adType,this.ad.title=s.title,this.ad.description=s.description,this.ad.system=s.system,s.errorURLTemplates.forEach(e=>{this.adErrorTags.push({event:"error",url:e})}),s.impressionURLTemplates.forEach(e=>{e.url&&this.trackingTags.push({event:"impression",url:e.url})}),s.creatives);for(let e=0;e<n.length;e++){const i=n[e];this.creative.id=i.id,this.creative.universalAdIds=i.universalAdIds,this.creative.adId=i.adId,this.creative.trackingEvents=i.trackingEvents,this.creative.duration=i.duration,this.creative.skipDelay=i.skipDelay,this.creative.skipDelay&&(this.creative.skipoffset=i.skipDelay,this.creative.isSkippableAd=!0),i.videoClickThroughURLTemplate&&i.videoClickThroughURLTemplate.url&&(this.creative.clickThroughUrl=i.videoClickThroughURLTemplate.url),0<i.videoClickTrackingURLTemplates.length&&i.videoClickTrackingURLTemplates.forEach(e=>{e.url&&this.trackingTags.push({event:"clickthrough",url:e.url})}),this.creative.isLinear=!0,this._addTrackingEvents(i.trackingEvents),this.rmpVastLinearCreative=new Yn(this),this.rmpVastLinearCreative.parse(i)}}}_handleParsedVast(e){0<e.errorURLTemplates.length&&e.errorURLTemplates.forEach(e=>{this.vastErrorTags.push({event:"error",url:e})}),0!==e.ads.length?this._loopAds(e.ads):o.processVastErrors.call(this,303,!0)}_getVastTag(t){if("string"==typeof t&&""!==t)if("undefined"!=typeof DOMParser){if(o.createApiEvent.call(this,"adtagstartloading"),!this.params.vastXmlInput)throw new Error("VAST XML input is required. VAST loading by URI is not supported");{let e;try{e=(new DOMParser).parseFromString(t,"text/xml")}catch(e){return console.warn(e),void o.processVastErrors.call(this,900,!0)}new qn((e,t)=>{"VAST-error"!==e&&"ERROR"!==t.type||o.processVastErrors.call(this,900,!0)}).parseVAST(e).then(e=>{o.createApiEvent.call(this,"adtagloaded"),this._handleParsedVast(e)}).catch(e=>{console.warn(e),o.processVastErrors.call(this,900,!0)})}}else o.processVastErrors.call(this,1002,!1);else o.processVastErrors.call(this,1001,!1)}loadAds(e){if(this.__initialized||this.initialize(),this.__adOnStage)throw new Error("Creative already on stage, cannot load VAST");this._getVastTag(e)}play(){this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer&&this.rmpVastAdPlayer.play()}pause(){this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer&&this.rmpVastAdPlayer.pause()}destroy(){this.rmpVastAdPlayer&&this.rmpVastAdPlayer.destroy(),o.initInstanceVariables.call(this)}get adPaused(){return!!(this.__adOnStage&&this.creative&&this.creative.isLinear&&this.__adPlayer)&&this.__adPlayer.paused}set volume(e){if(Number.isFinite(e))this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer&&(this.rmpVastAdPlayer.volume=e<0?0:1<e?1:e)}get volume(){return this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer?this.rmpVastAdPlayer.volume:-1}set muted(e){"boolean"==typeof e&&this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer&&(this.rmpVastAdPlayer.muted=e)}get muted(){return!(this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer)||this.rmpVastAdPlayer.muted}get adDuration(){return this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer?this.rmpVastAdPlayer.duration:-1}get adCurrentTime(){return this.__adOnStage&&this.creative&&this.creative.isLinear&&this.rmpVastAdPlayer?this.rmpVastAdPlayer.currentTime:-1}get clickThroughUrl(){return this.creative&&this.creative.clickThroughUrl?this.creative.clickThroughUrl:""}get isSkippableAd(){return!(!this.creative||!this.creative.isSkippableAd)}get adSkippableState(){return!!(this.__adOnStage&&this.isSkippableAd&&this.rmpVastLinearCreative)&&this.rmpVastLinearCreative.skippableAdCanBeSkipped}initialize(){this.__initialized||(this.rmpVastAdPlayer=new Kn(this),this.rmpVastAdPlayer.init())}}const Zn="player-container",Qn="player-video",ei="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=";function ti({setPlayerContext:t,playerRef:i,vast:s}){const n=sn(),r=F(null),a=B(),e=k(e=>{const t=i.current;null!==t&&t.adPaused&&t.play(),e.preventDefault(),e.stopPropagation()},[i]);return O(()=>{var e;null===i.current&&null!==r.current&&(i.current=new Jn(r.current,{vastXmlInput:!0,pauseOnEnd:!0,timeEvents:{showActionButton:5e3,showPackshot:-500},clickThroughElementId:ln(n)}),i.current.initialize(),i.current.loadAds(s),null!=(e=i.current)&&e.on("addestroyed",()=>{hn.clear()}),null!=(e=i.current)&&e.on("adstarted",()=>{hn.dispatchEvent("adstarted"),a.emit(w.onStart)}),null!=(e=i.current)&&e.on("aderror",()=>{a.emit(x.error)}),t(i.current))},[a,n,i,t,s]),O(()=>{const e=()=>{var e;null!=(e=i.current)&&e.play()},t=()=>{var e;null!=(e=i.current)&&e.pause()},s=()=>{var e;null!=(e=i.current)&&e.adPaused&&setTimeout(()=>{var e;return null==(e=i.current)?void 0:e.play()},500)},n=()=>{var e;hn.clear(),null!=(e=i.current)&&e.destroy()};return a.on(x.play,e),a.on(x.pause,t),a.on(x.leave,t),a.on(x.return,s),a.on(x.finalDestroy,n),()=>{a.off(x.play,e),a.off(x.pause,t),a.off(x.leave,t),a.off(x.return,s),a.off(x.finalDestroy,n)}},[a,i]),V("div",{className:"rmp-container adsgram",ref:r,onClick:e,"data-testid":Zn,children:V("div",{className:"rmp-content",children:V("video",{className:"rmp-video",poster:ei,muted:!0,playsInline:!0,controls:!1,disableRemotePlayback:!0,disablePictureInPicture:!0,"data-testid":Qn,preload:"auto"})})})}const si={wrapper:"_wrapper_1t8xa_1"};function ni({vast:e,playerRef:t,actionButtonTitle:s,image:n,hasPackshot:i,duration:r,title:a,description:o,kebab:l}){const[h,c]=M(null);return V(an.Provider,{value:h,children:V("div",{className:si.wrapper,children:[V(xn,{kebab:l}),V(cn,{text:s}),V(ti,{vast:e,playerRef:t,setPlayerContext:c}),i&&V(wn,{image:n,duration:r,title:a,description:o}),V(pn,{packshotDuration:r})]})})}const ii={RewardedVideo:function({vast:e,packshotImage:t,actionButtonTitle:s,title:n,description:i,kebab:r}){const a=F(null),o=N("FORCED_SUB_FORMAT");return Zs(),V("div",{className:"_banner_3zpbu_1",children:V(ni,{vast:e,playerRef:a,image:t,actionButtonTitle:s,hasPackshot:!0,title:n,description:i,duration:o?15e3:5e3,kebab:r})})},FullscreenMedia:function({image:e,title:t,description:s,advertiserName:n,buttonName:i,url:r,icon:a,kebab:o}){const l=B(),h=W(),c=Js("click"),u=N("FORCED_SUB_FORMAT"),d=L(()=>new en({callbacks:{endCallback:()=>{l.emit(w.onReward)},3:()=>g(!0),6:()=>p(!0)},endTime:u?yt:St}),[l,u]),[_,p]=M(!1),[m,g]=M(!1),f=F(1/0),S=k(e=>{m&&(e.isTrusted?(e.preventDefault(),e.stopPropagation(),$s(c,h),d.stop(),l.emit(x.leave),f.current=Date.now(),fs({url:r,logger:h})):l.emit(w.onError))},[m,c,h,d,r,l]),y=F(null);(function({sendTackingTime:e,element:t,preventSend:s}){const n=W(),i=B(),r=Js("show"),[a,o]=M(!1),[l,h]=M(!0),c=L(()=>new en({endTime:e,callbacks:{}}),[e]),u=zs(t),d=L(()=>null!==t.current&&u&&l&&Ys(t.current),[t,l,u]),_=k(()=>P(this,null,function*(){a||s||(yield $s(r,n),o(!0))}),[a,n,s,r]),p=k(()=>{d||c.stop()},[d,c]);O(()=>(c.subscribeOnTickUpdate(p),c.subscribeOnEnd(_),()=>{c.unsubscribeAll()}),[_,p,c]),O(()=>{c.isStopped&&d&&c.restart()},[d,c]),O(()=>{const e=()=>{h(!0)},t=()=>{h(!1)};return i.on(x.return,e),i.on(x.leave,t),()=>{i.off(x.return,e),i.off(x.leave,t)}},[i])})({sendTackingTime:2,element:y,preventSend:!1});{var C=y;const G=W(),T=Js("render"),[I,b]=M(!1),A=zs(C);O(()=>{A&&T&&!I&&($s(T,G),b(!0))},[T,I,A,G])}return Zs(),O(()=>{const e=()=>{d.destroy()},t=()=>{d.resume()},s=()=>{d.stop()},n=()=>{1e4<Date.now()-f.current&&l.emit("onReward"),f.current=1/0,d.resume()};return l.on(x.finalDestroy,e),l.on(x.play,t),l.on(x.pause,s),l.on(x.leave,s),l.on(x.return,n),()=>{l.off(x.finalDestroy,e),l.off(x.play,t),l.off(x.pause,s),l.off(x.leave,s),l.off(x.return,n)}},[l,d]),O(()=>{l.emit(w.onStart)},[l]),V("div",{className:D("_banner_7zy2f_1",!1),ref:y,children:[V(us,{}),V("div",{className:"_wrapper_7zy2f_33",children:[V(Ws,{advertiserName:n,title:t,description:s,image:e,icon:a,onClick:S,isClickable:m,kebab:o}),m&&V(Us,{buttonName:i,onClick:S}),_&&V(Xs,{}),V(bs,{timer:d})]})]})}};function ri(e){const{blockId:t,EventEmitter:s,logger:n,isDark:i,children:r,exp:a,trackings:o}=e;return V(as.Provider,{value:n,children:V(Gt.Provider,{value:s,children:V(tn.Provider,{value:t,children:V(os.Provider,{value:i,children:V(rs.Provider,{value:a,children:V(Ks.Provider,{value:o,children:r})})})})})})}function ai(e){const t={};for(const s in e){const{name:n,value:i}=e[s];t[n]=i}return t}const oi={RewardedVideo:function({banner:e}){const t=e.bannerAssets,{title:s,description:n,buttonName:i,buttonImg:r,vast:a,erid:o,regNumber:l,legalName:h,inn:c}=ai(t);return{vast:a,packshotImage:r,actionButtonTitle:i,title:s,description:n,kebab:{erid:o,regNumber:l,legalName:h,inn:c}}},FullscreenMedia:function({banner:e}){const t=e.bannerAssets,{advertiserName:s,buttonName:n,title:i,description:r,icon:a,image:o,url:l,erid:h,legalName:c,regNumber:u,inn:d}=ai(t);return{advertiserName:s,buttonName:n,description:r,icon:a,image:o,url:l,title:i,kebab:{erid:h,legalName:c,regNumber:u,inn:d}}}};class li extends R{constructor(){super(),this.state={hasError:!1}}componentDidCatch(e,t){try{this.props.logger.add("componentStack",null==t?void 0:t.componentStack).addError(e).send("ErrorBoundary")}catch(e){}this.setState({hasError:!0})}render({EventEmitter:e}){return this.state.hasError?(e.emit(x.renderError),null):this.props.children}}function hi({data:e,bannerType:t,blockId:s,EventEmitter:n,logger:i,isDark:r}){const a=ii[t],o=oi[t](e);return V(ri,{blockId:s,EventEmitter:n,logger:i,isDark:r,exp:(r=null==(t=null==e?void 0:e.banner)?void 0:t.flags,l(l({},is),(t=r)&&0!==t.length?t.reduce((e,t)=>(e[t]=!0,e),{}):{})),trackings:(e=>{if(e){const t={};for(const s in e){const{name:n,value:i}=e[s];t[n]=i}return t}})(null==(r=null==e?void 0:e.banner)?void 0:r.trackings),children:V(li,{EventEmitter:n,blockId:s,campaignId:e.campaignId,logger:i,children:V(a,l({},o))})})}function ci(e){if(!(e instanceof HTMLElement))throw new d({message:e+" cannot be used to display ads"})}const ui="._banner_7zy2f_1{display:flex;flex-direction:column;height:100%;justify-content:space-between;left:0;overflow-y:scroll;position:fixed;top:0;width:100%}._banner_7zy2f_1 button{appearance:none;background:none;box-shadow:none;outline:none;text-decoration:none}._banner_7zy2f_1 button:disabled{background:none}._banner_7zy2f_1::-webkit-scrollbar{display:none}._preview_7zy2f_29{position:static}._wrapper_7zy2f_33{display:flex;flex-direction:column;height:100%;margin:28px 60px 0 0}",di="._banner_3zpbu_1{left:0;position:fixed;top:0}._banner_3zpbu_1,._preview_3zpbu_10{background-color:#000;height:100%;width:100%}._preview_3zpbu_10{position:absolute}._preview_3zpbu_10 .rmp-container{border-radius:8px}",_i='._label_8q9mb_1{border-radius:12px;cursor:pointer;padding:0 8px;position:relative;width:fit-content;z-index:1}._label_8q9mb_1:before{background-color:var(--adsgram-opacity-button-color);border-radius:12px;content:"";inset:0;position:absolute;z-index:-1}._text_8q9mb_19{color:var(--adsgram-button-text-color);font-family:SF Pro,Roboto,sans-serif;font-size:13px;font-weight:500;line-height:23px;text-align:center;vertical-align:top}',pi='._background_13n54_1{height:100%;left:0;position:fixed;top:0;width:100%}._preview_13n54_9{border-radius:8px;position:absolute}._preview_13n54_9:after{border-radius:8px}._dark_13n54_18{background:var(--adsgram-bg-color,#0f0f0f);background-blend-mode:darken}._dark_13n54_18:after{background-image:url(https://telegram.org/img/tgme/pattern.svg);background-position:50%;background-repeat:no-repeat;background-size:cover;content:"";filter:invert(99%) sepia(2%) saturate(1%) hue-rotate(161deg) brightness(116%) contrast(73%);inset:0;mix-blend-mode:overlay;position:absolute}._light_13n54_36{background-blend-mode:lighten;background-color:#99ba92;background-image:radial-gradient(64.13% 64.66% at 0 0,#d6d896 0,#d6d89600),radial-gradient(57.75% 64.84% at 100% 100%,#dbddbe 0,#dbddbe00),radial-gradient(49.87% 52.71% at 0 100%,#78a389 0,#78a38900)}._light_13n54_36:after{background-image:url(https://telegram.org/img/tgme/pattern.svg);background-position:50%;background-repeat:no-repeat;background-size:cover;content:"";filter:invert(33%) sepia(5%) saturate(0) hue-rotate(164deg) brightness(99%) contrast(100%);inset:0;mix-blend-mode:soft-light;position:absolute}',mi="._footer_1vuvm_1{align-items:center;display:flex;flex:1 1 auto;flex-direction:column;gap:8px;justify-content:end;margin:20px 0 16px 60px}",gi="._kebab_lsgwj_1{cursor:pointer;display:flex;position:relative}._hidden_lsgwj_7{visibility:hidden}._icon_lsgwj_11{filter:drop-shadow(1px 1px 1px rgb(0 0 0/15%));height:24px;width:24px}",fi="._wrapper_1c6e2_1{background:var(--adsgram-secondary-bg-color);border-radius:6px;box-shadow:0 1px 3px 1px #0000001f;box-sizing:border-box;cursor:default;max-width:220px;padding:6px 16px;position:absolute;width:calc(100vw - 140px)}._legal-info_1c6e2_15,._wrapper_1c6e2_1{display:flex;flex-direction:column}",Si="._item_1tvev_1{display:flex;flex-direction:column;gap:4px;margin:8px 0;width:100%}._item_1tvev_1 span{font-family:SF Pro,Roboto,sans-serif;font-size:12px;font-weight:500;line-height:14px}._header_1tvev_16{color:var(--adsgram-subtitle-text-color,#82868a);white-space:nowrap}._content_1tvev_21{color:var(--adsgram-text-color,#222)}",yi="._button_1ddhv_1{animation-duration:.3s;animation-fill-mode:forwards;animation-name:_show_1ddhv_1;animation-timing-function:cubic-bezier(.05,.7,.1,1);background-color:var(--adsgram-button-color);border:1px solid #0000;border-radius:8px;box-shadow:1px 1px 3px #0003;color:var(--adsgram-button-text-color);cursor:pointer;font-family:SF Pro,Roboto,sans-serif;font-size:16px;font-weight:600;height:48px;left:50%;line-height:24px;padding:12px 24px;position:absolute;transform:translate(-50%);z-index:3}@keyframes _show_1ddhv_1{0%{bottom:10px;opacity:0}to{bottom:30px;opacity:1}}._visible_1ddhv_36{animation-play-state:running;visibility:visible}._hidden_1ddhv_41{animation-play-state:paused;visibility:hidden}",Ci="._wrapper_r5xom_1{cursor:pointer;display:flex;flex-direction:column;font-family:SF Pro,Roboto,sans-serif;font-size:13px;font-weight:400;height:100%;letter-spacing:0;line-height:16px;margin:10px 0;text-align:center;width:calc(100% - var(--adsgram-header-height)*2)}._adlabeltext_r5xom_16{color:#fff9;margin:0}._adlabel_r5xom_16{align-items:center;color:#fff9;display:flex;font-family:SF Pro,Roboto,sans-serif;font-size:13px;font-weight:400;letter-spacing:0;line-height:16px}._tgchannel_r5xom_32{color:#fff;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}",Gi="._close_e7d2o_1{aspect-ratio:1/1;display:flex;flex-wrap:wrap;height:100%;place-content:center center}._close_e7d2o_1._clickable_e7d2o_9{cursor:pointer}._image_e7d2o_13{animation-duration:.15s;animation-name:_show_e7d2o_1;animation-play-state:running;animation-timing-function:cubic-bezier(0,0,0,1)}@keyframes _show_e7d2o_1{0%{opacity:0}to{opacity:1}}",Ti="._footer_15eel_1{bottom:0;display:flex;justify-content:space-between;position:absolute;width:100%;z-index:3}",Ii="._header_1c2pi_1{--adsgram-header-height:52px;background:linear-gradient(#00000059,#0000);display:flex;height:var(--adsgram-header-height);justify-content:space-between;position:absolute;top:0;width:100%;z-index:3}._preview_1c2pi_14{border-radius:8px 8px 0 0}._kebab_1c2pi_18{align-items:center;display:flex;height:var(--adsgram-header-height);justify-content:center;width:var(--adsgram-header-height)}._kebab-content_1c2pi_26{right:40px;top:10px}",bi="._packshot_eb9zb_1{animation-duration:.2s;animation-name:_packshot_eb9zb_1;animation-timing-function:cubic-bezier(0,0,0,1);-webkit-backdrop-filter:blur(25px);backdrop-filter:blur(25px);background:#141414cc;display:flex;flex-wrap:wrap;height:100%;place-content:center center;position:absolute;top:0;width:100%}@supports ((-webkit-backdrop-filter:none) or (backdrop-filter:none)){._packshot_eb9zb_1{-webkit-backdrop-filter:blur(25px);backdrop-filter:blur(25px);background:#7474804d}}._creatives_eb9zb_23{animation-duration:.4s;animation-name:_creatives_eb9zb_23;animation-timing-function:cubic-bezier(.05,.7,.1,1);display:flex;flex-direction:column;place-content:center center;position:relative;transform:translateY(-26px);width:280px}._image_eb9zb_35{border:1px solid #0000000a;border-radius:20px;box-shadow:0 8px 20px #00000029;height:128px;margin:0 auto 20px;width:128px}._title_eb9zb_44{color:#fff;font-size:28px;font-weight:700;line-height:32px;margin:8px}._description_eb9zb_55,._title_eb9zb_44{font-family:SF Pro,Roboto,sans-serif;letter-spacing:0;text-align:center}._description_eb9zb_55{color:#fff9;font-size:16px;font-weight:500;line-height:24px}._play_eb9zb_65{animation-play-state:running;visibility:visible}._pause_eb9zb_70{animation-play-state:paused;visibility:hidden}@keyframes _packshot_eb9zb_1{0%{opacity:0}to{opacity:1}}@keyframes _creatives_eb9zb_23{0%{opacity:0;top:40px}to{opacity:1;top:0}}",Ai=".rmp-container,.rmp-content,.rmp-video{height:100%;width:100%}",Pi="._timeline_1gsrl_1{align-content:center;display:flex;flex-wrap:wrap;height:18px;margin:auto 8px;width:100%}._bar_1gsrl_10{background-color:#ffffff59;border-radius:4px;height:2px;width:100%}._progress_1gsrl_17{background-color:#fff;border-radius:4px;height:100%;width:0}",Ei="._volume_10n0w_1{aspect-ratio:1/1;cursor:pointer;display:flex;flex-wrap:wrap;height:100%;place-content:center center}",vi="._wrapper_1t8xa_1{height:100%;position:relative;width:100%}",Ri="._post_16y4i_1{animation-duration:.1s;animation-fill-mode:forwards;animation-name:_show_16y4i_1;animation-play-state:running;animation-timing-function:ease-out;display:flex;position:relative}@keyframes _show_16y4i_1{0%{opacity:0}to{opacity:1}}._channel_16y4i_21{align-self:end;cursor:pointer;height:40px;margin:0 4px 0 10px;width:40px}._icon_16y4i_29{background-color:var(--adsgram-secondary-bg-color);border-radius:100%;height:40px;object-fit:cover;width:40px}._tail_16y4i_37{align-self:end;color:var(--adsgram-secondary-bg-color);display:flex;z-index:1}._tail_16y4i_37,._tail_16y4i_37 svg{height:10px;width:6px}._message_16y4i_51{background-color:var(--adsgram-secondary-bg-color);border-radius:18px 18px 18px 0;box-shadow:0 1px 2px #00000029;display:flex;flex-direction:column;position:relative;width:100%}._image_16y4i_61{aspect-ratio:1;border-radius:16px 16px 4px 4px;margin:2px 2px 0;object-fit:cover;width:calc(100% - 4px)}._text_16y4i_69{display:flex;flex-direction:column;gap:18px;margin:8px;width:calc(100% - 16px)}._text_16y4i_69,._title_16y4i_81{font-family:SF Pro,Roboto,sans-serif;font-size:15px;line-height:18px;padding:0}._title_16y4i_81{color:var(--adsgram-text-color);font-weight:500;letter-spacing:0;margin:0}._description_16y4i_92{color:var(--adsgram-text-color);font-size:15px;font-weight:400;line-height:18px}._footer_16y4i_99{display:flex;justify-content:space-between}._name_16y4i_104{background:none;border:none;display:-webkit-box;overflow:hidden;padding:0;-webkit-box-orient:vertical;color:var(--adsgram-hint-color);cursor:default;font-family:SF Pro,Roboto,sans-serif;font-size:15px;font-weight:400;-webkit-line-clamp:2;line-height:18px;text-align:left;text-decoration:none;text-overflow:ellipsis;transition:color .2s cubic-bezier(.2,0,0,1);word-break:break-word}._clickable_16y4i_125{color:var(--adsgram-link-color);cursor:pointer}._adlabel_16y4i_130{align-self:end;color:var(--adsgram-subtitle-text-color);font-size:12px;line-height:16px;transform:translate(-2px,4px);vertical-align:bottom;white-space:nowrap}._kebab_16y4i_140{background:linear-gradient(216deg,#2222220d 25%,#8880 55%);border-radius:0 18px 0 0;padding:8px 4px 16px 16px;position:absolute;right:0}._kebab-content_16y4i_152{right:30px;top:-20px}",xi='._button_11hr1_1{animation-duration:.2s;animation-fill-mode:forwards;animation-name:_show_11hr1_1;animation-play-state:running;animation-timing-function:cubic-bezier(.2,0,0,1);background-color:initial;border:none;border-radius:6px 6px 15px 15px;color:var(--adsgram-button-text-color);cursor:pointer;display:inline-block;font-family:SF Pro,Roboto,sans-serif;font-size:14px;font-weight:400;height:40px;letter-spacing:.03em;line-height:40px;margin:4px 0 0 60px;position:relative;text-align:center;width:calc(100% - 60px);z-index:1}@keyframes _show_11hr1_1{0%{opacity:0;transform:translateY(-20px) scale(.1)}to{opacity:1;transform:translateY(0) scale(1)}}._button_11hr1_1:before{background-color:var(--adsgram-opacity-button-color);border-radius:6px 6px 15px 15px;content:"";inset:0;position:absolute;z-index:-1}._button_11hr1_1:active{animation-duration:.1s;animation-fill-mode:forwards;animation-name:_click_11hr1_1;animation-play-state:running;animation-timing-function:cubic-bezier(.2,0,0,1)}@keyframes _click_11hr1_1{0%{transform:scale(1)}to{transform:scale(95%)}}',wi='._timer_1bmq0_1{padding:0 8px;position:relative;width:fit-content;z-index:1}._timer_1bmq0_1:before{background-color:var(--adsgram-opacity-button-color);border-radius:12px;content:"";inset:0;position:absolute;z-index:-1}._time_1bmq0_1{color:var(--adsgram-button-text-color);font-family:SF Pro,Roboto,sans-serif;font-size:13px;font-weight:500;line-height:23px;text-align:center;vertical-align:top}',Di='._tooltip_y87u2_1{align-self:center;animation-duration:.2s;animation-fill-mode:forwards;animation-name:_show_y87u2_1;animation-play-state:running;animation-timing-function:cubic-bezier(.2,0,0,1);background-color:var(--adsgram-secondary-bg-color);border-radius:12px;box-shadow:0 1px 2px #00000029;cursor:default;opacity:0;padding:10px 12px;position:relative;scale:25%;text-align:center;top:-10px;transform:translate(30px)}@keyframes _show_y87u2_1{0%{opacity:0;scale:25%;top:-10px}to{opacity:1;scale:100%;top:10px}}._tooltip_y87u2_1:after{border:6px solid;border-color:#0000 #0000 var(--adsgram-secondary-bg-color) #0000;content:"";left:50%;position:absolute;top:0;transform:translate(-50%,-100%)}._title_y87u2_46{color:var(--adsgram-text-color);font-family:SF Pro,Roboto,sans-serif;font-size:13px;font-weight:500;line-height:16px;margin:0;text-align:center}',Mi="._wrapper_1t8xa_1{height:100%;position:relative;width:100%}",Oi="._overlay_1gwug_1{align-items:center;background-color:#0009;border-radius:8px;display:flex;height:100%;justify-content:center;width:100%}._image_1gwug_11{aspect-ratio:1/1;filter:drop-shadow(2px 2px 2px rgb(0 0 0/60%));width:25%}";function Fi(e){if(e.shadowRoot)return e.shadowRoot;const t=e.attachShadow({mode:"closed"}),s=document.createElement("style");return s.textContent=(()=>{const e=Object.assign({"/src/banners/fullscreenMedia/fullscreenMedia.module.css":ui,"/src/banners/rwvideo/rwvideo.module.css":di,"/src/components/adsgramLabel/adsgramLabel.module.css":_i,"/src/components/chatBackground/chatBackground.module.css":pi,"/src/components/footer/footer.module.css":mi,"/src/components/kebab/kebab.module.css":gi,"/src/components/kebab/kebabContet.module.css":fi,"/src/components/kebab/legalInfoItem.module.css":Si,"/src/components/player/components/actionButton/actionButton.module.css":yi,"/src/components/player/components/adLabel/adLabel.module.css":Ci,"/src/components/player/components/close/close.module.css":Gi,"/src/components/player/components/footer/footer.module.css":Ti,"/src/components/player/components/header/header.module.css":Ii,"/src/components/player/components/packshot/packshot.module.css":bi,"/src/components/player/components/playerInitContainer/playerInitContainer.css":Ai,"/src/components/player/components/timeline/timeline.module.css":Pi,"/src/components/player/components/volume/volume.module.css":Ei,"/src/components/player/player.module.css":vi,"/src/components/post/post.module.css":Ri,"/src/components/postButton/postButton.module.css":xi,"/src/components/timer/timer.module.css":wi,"/src/components/tooltip/tooltip.module.css":Di,"/src/preview/components/previewWrapper/previewWrapper.module.css":Mi,"/src/preview/components/replay/replay.module.css":Oi});return Object.values(e).join("")})(),t.append(s),t}const Li={light:{accentTextColor:"#168acd",bgColor:"#ffffff",buttonColor:"#40a7e3",buttonTextColor:"#ffffff",destructiveTextColor:"#d14e4e",headerBgColor:"#ffffff",hintColor:"#999999",linkColor:"#168acd",secondaryBgColor:"#f1f1f1",sectionBgColor:"#ffffff",sectionHeaderTextColor:"#168acd",sectionSeparatorColor:"#e7e7e7",subtitleTextColor:"#999999",textColor:"#000000",opacityButtonColor:"rgb(74 142 58 / 54%)"},dark:{accentTextColor:"#6ab2f2",bgColor:"#17212b",buttonColor:"#5288c1",buttonTextColor:"#ffffff",destructiveTextColor:"#ec3942",headerBgColor:"#17212b",hintColor:"#708499",linkColor:"#6ab3f3",secondaryBgColor:"#232e3c",sectionBgColor:"#17212b",sectionHeaderTextColor:"#6ab3f3",sectionSeparatorColor:"#111921",subtitleTextColor:"#708499",textColor:"#f5f5f5",opacityButtonColor:"rgb(8 15 25 / 54%)"}};function ki(){const e=Ge().themeParams;return e}function Bi(){const e=ki().bgColor;return!!e&&(()=>{const i=me(e);return Math.sqrt([.299,.587,.114].reduce((e,t,s)=>{const n=Number.parseInt(i.slice(1+2*s,1+2*(s+1)),16);return e+n*n*t},0))<120})()}function Ni({blockId:r,container:a,data:e,EventEmitter:o}){a&&ci(a);const l=(e=>{const t=document.createElement("div");return document.documentElement.append(t),t.setAttribute("id",e),t.setAttribute("style","position: relative;z-index:2147483647;"),t})(r),h=Fi(l),t=Bi();{var[s=document.documentElement,n]=[l,t?Li.dark:Li.light],i,c;const m=Object.entries(null!=n?n:ki());for(const[g,f]of m)f&&(i=g,i="--adsgram-"+i.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),c=f,(s||document.documentElement).style.setProperty(i,c))}{var{data:n,EventEmitter:u}={data:e,EventEmitter:o};n=n;const S=dt.has(n.bannerType);if(S){const y=document.body.style.overflow;document.body.style.overflow="hidden";try{we(De())("web_app_expand")}catch(e){}u.on(x.finalDestroy,()=>{document.body.style.overflow=y})}{var d=u;let e=!1,t=()=>{e=!0},s=()=>{e=!1},n=()=>{"visible"===document.visibilityState&&e&&d.emit("return"),"hidden"!==document.visibilityState||e||d.emit("leave")},i=()=>{e&&d.emit("return")};d.on("leave",t),d.on("return",s),window.addEventListener("visibilitychange",n),window.addEventListener("focus",i),window.addEventListener("click",i),d.on("finalDestroy",()=>{window.removeEventListener("visibilitychange",n),window.removeEventListener("focus",i),window.removeEventListener("click",i),d.off("leave",t),d.off("return",s)})}}{n=l;const C=document.createElement("style");C.textContent="@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap')",n.append(C)}const _=G();_.add("blockId",r).add("bannerType",e.bannerType).add("campaignId",e.campaignId);try{ut(V(hi,{bannerType:e.bannerType,data:e,blockId:r,EventEmitter:o,logger:_,isDark:t}),h)}catch(e){_.send("RenderError"),o.emit(x.renderError)}const p=()=>{{var{blockId:e,shadowRoot:t,container:s,shouldRemoveContainer:n}={blockId:r,container:l,shadowRoot:h,shouldRemoveContainer:!(a&&ci(a))};ut(null,t);const i=null!=s?s:document.getElementById(e);i&&n&&i.remove()}o.off(x.finalDestroy,p)};o.on(x.finalDestroy,p)}class Wi{constructor({blockId:e,container:t,debug:s,debugBannerType:n}){i(this,"blockId"),i(this,"EventEmitter"),i(this,"bannerData"),i(this,"forceCampaignId"),i(this,"loadBannerPromise"),i(this,"container"),i(this,"isShowing"),i(this,"isLoading"),this.blockId=e,this.container=t,this.EventEmitter=new Ct,this.subscribe(),this.isShowing=!1,this.isLoading=!1,this.forceCampaignId=s?be[null!=n?n:"RewardedVideo"]:void 0}show(){return P(this,null,function*(){if(!this.bannerData&&!(yield this._load()))throw s.noBannerToShowError;if(this.isShowing)throw s.duplicateShowError;return new Promise((e,t)=>{if(!this.bannerData)return t(s.noBannerDataError);this.isShowing=!0,this.EventEmitter.emit(x.show);try{Ni({blockId:this.blockId,container:this.container,data:this.bannerData,EventEmitter:this.EventEmitter})}catch(e){G().add("blockId",this.blockId).add("bannerType",this.bannerData.bannerType).add("campaignId",this.bannerData.campaignId).send("UnknownRenderError","WARN"),t(s.renderError)}this.EventEmitter.on(x.renderError,()=>{this.EventEmitter.emit(w.onError),t(s.renderError)}),this.EventEmitter.on(x.error,()=>{this.EventEmitter.emit(w.onError),t(s.playError)}),this.EventEmitter.on(w.onSkip,()=>{t(s.skip)}),this.EventEmitter.on(w.onReward,()=>{e(s.reward)})})})}load(){return P(this,null,function*(){return console.error("AdsgramError: Deprecated method AdController.load, use AdController.show right away"),G().add("blockId",this.blockId).send("DeprecatedLoadInvoked","WARN"),!0})}preload(){return P(this,null,function*(){console.error("AdsgramError: Deprecated method AdController.preload, use AdController.show right away"),G().add("blockId",this.blockId).send("DeprecatedPreloadInvoked","WARN"),this.EventEmitter.emit(x.preload)})}addEventListener(e,t){if(!w[e])throw new d({message:`The event argument must be one of ${Object.keys(w).join(", ")}. Received `+e});this.EventEmitter.on(e,t)}removeEventListener(e,t){if(!w[e])throw new d({message:`The event argument must be one of ${Object.keys(w).join(", ")}. Received `+e});this.EventEmitter.off(e,t)}destroy(){this.EventEmitter.emit(x.destroy)}_load(){return P(this,null,function*(){var e;return!(null==(e=this.bannerData)||!e)||(this.loadBannerPromise instanceof Promise&&this.isLoading?yield this.loadBannerPromise:(this.isLoading=!0,this.EventEmitter.emit(x.load),this.loadBannerPromise=Le(this.blockId,this.forceCampaignId).then(e=>e&&e.bannerType?(this.bannerData=e,!0):(this.EventEmitter.hasHandlers(w.onBannerNotFound)?this.EventEmitter.emit(w.onBannerNotFound):Me({message:u(X)}),!1)).catch(()=>(this.EventEmitter.emit(w.onError),!1)).finally(()=>{this.isLoading=!1}),this.loadBannerPromise))})}finalDestroy(){this.EventEmitter.emit(x.finalDestroy),this.resetVariables()}subscribe(){this.EventEmitter.on(x.destroy,this.finalDestroy.bind(this)),this.EventEmitter.on(w.onReward,this.finalDestroy.bind(this)),this.EventEmitter.on(w.onSkip,this.finalDestroy.bind(this)),this.EventEmitter.on(x.error,this.finalDestroy.bind(this)),this.EventEmitter.on(x.renderError,this.finalDestroy.bind(this))}resetVariables(){this.bannerData=void 0,this.loadBannerPromise=void 0,this.isShowing=!1}}const Vi={blockId:function(e){if(!("blockId"in e))throw new d({message:"blockId is required param for init function"});if("string"!=typeof e.blockId)throw new d({message:"blockId param should be string"});if(/\d+/.test(e.blockId))return!0;throw new d({message:"blockId param should be string with number value inside, you pass "+e.blockId})},container:function(e){if("container"in e){if(e.container instanceof HTMLElement)return!0;throw new d({message:"container should be instanceof HTMLElement you call with "+JSON.stringify(e.container)})}return!0},hasReward:function(e){if("hasReward"in e&&"boolean"!=typeof e.hasReward)throw new d({message:"hasReward should be boolean you call with "+JSON.stringify(e.hasReward)});return!0},debug:function(e){if("debug"in e&&"boolean"!=typeof e.debug)throw new d({message:"debug should be boolean you call with "+JSON.stringify(e.debug)});return!0},debugBannerType:function(e){if("debugBannerType"in e){if("string"!=typeof e.debugBannerType)throw new d({message:"debugBannerType should be string you call with "+JSON.stringify(e.debugBannerType)});if(!Object.keys(be).includes(e.debugBannerType))throw new d({message:`debugBannerType should be one of ${Object.keys(be)} you call with `+e.debugBannerType})}return!0}},Ui={};function ji(e){if(!(t=>{if("object"!=typeof t)throw new d({message:"Object should be passed to the init function you pass "+JSON.stringify(t)});return!("object"!=typeof t||t instanceof Function||Array.isArray(t)||null===t)&&Object.values(Vi).every(e=>e(t))})(e))throw new d({message:"Attempt to create AdController with wrong params"});const t=e.blockId;return Ui[t]||(Ui[t]=new Wi(e)),Ui[t]}function Hi(e){return ji(e)}window.Adsgram=H(l({},window.Adsgram),{init:Hi}),y.init=Hi,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})},"object"==typeof(s=e)&&void 0!==t?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((s="undefined"!=typeof globalThis?globalThis:s||self).SAD={})}}),import_c3runtime=__toESM(require_c3runtime()),C32=self.C3,import_adsgram_min=(self.C3_GetObjectRefTable=function(){return[C32.Plugins.AJAX,C32.Plugins.Arr,C32.Plugins.Touch,C32.Plugins.LocalStorage,C32.Plugins.Dictionary,C32.Plugins.Mouse,C32.Plugins.Browser,C32.Plugins.Date,C32.Plugins.Clipboard,C32.Plugins.Keyboard,C32.Plugins.Text,C32.Plugins.Json,C32.Plugins.Sprite,C32.Behaviors.Pin,C32.Behaviors.DragnDrop,C32.Plugins.NinePatch,C32.Behaviors.Tween,C32.Behaviors.Sin,C32.Behaviors.Fade,C32.Plugins.TiledBg,C32.Behaviors.Timer,C32.Plugins.TextBox,C32.Behaviors.Rotate,C32.Plugins.Audio,C32.Plugins.Particles,C32.Behaviors.wrap,C32.Plugins.System.Cnds.OnLayoutStart,C32.Plugins.System.Cnds.IsGroupActive,C32.Plugins.Touch.Cnds.OnTouchObject,C32.Plugins.System.Cnds.CompareVar,C32.Plugins.Touch.Exps.X,C32.Plugins.Touch.Exps.Y,C32.Plugins.System.Acts.SetVar,C32.Plugins.Sprite.Acts.SetScale,C32.Plugins.System.Acts.Wait,C32.Plugins.Touch.Cnds.OnTapGestureObject,C32.Plugins.Sprite.Acts.Destroy,C32.Plugins.Sprite.Cnds.CompareInstanceVar,C32.Plugins.System.Cnds.For,C32.Plugins.System.Exps.loopindex,C32.Plugins.System.Acts.CreateObject,C32.Behaviors.Tween.Acts.TweenTwoProperties,C32.Plugins.Sprite.Exps.X,C32.Plugins.Sprite.Exps.Y,C32.Plugins.System.Acts.AddVar,C32.Plugins.Text.Cnds.CompareInstanceVar,C32.Plugins.System.Acts.GoToLayoutByName,C32.Plugins.System.Cnds.Else,C32.Plugins.System.Acts.GoToLayout,C32.Plugins.System.Cnds.Compare,C32.Plugins.NinePatch.Exps.Count,C32.Plugins.Json.Cnds.CompareValue,C32.Plugins.Json.Exps.Get,C32.Plugins.Json.Exps.ArraySize,C32.Plugins.System.Acts.WaitForPreviousActions,C32.Plugins.Json.Cnds.HasKey,C32.Plugins.System.Cnds.OnSignal,C32.Plugins.NinePatch.Cnds.OnDestroyed,C32.Plugins.NinePatch.Acts.Destroy,C32.Plugins.System.Cnds.Every,C32.Plugins.System.Cnds.OnSuspend,C32.Plugins.System.Cnds.OnResume,C32.Plugins.AJAX.Acts.RequestFile,C32.Plugins.Json.Acts.SetValue,C32.Plugins.System.Acts.SetLayerInteractive,C32.Plugins.System.Acts.SetGroupActive,C32.Plugins.System.Acts.SetLayerVisible,C32.Plugins.Sprite.Acts.SetY,C32.Plugins.System.Cnds.OnLayoutEnd,C32.Plugins.System.Cnds.EveryTick,C32.Plugins.System.Cnds.LayerNameExists,C32.Plugins.System.Acts.SetLayerScroll,C32.Plugins.System.Exps.layerscrolly,C32.Plugins.System.Exps.min,C32.Plugins.Sprite.Exps.Height,C32.Plugins.Sprite.Cnds.CompareHeight,C32.Plugins.Mouse.Cnds.IsOverObject,C32.Plugins.Mouse.Cnds.OnWheel,C32.Plugins.Sprite.Acts.MoveAtAngle,C32.Plugins.System.Exps.left,C32.Plugins.Touch.Cnds.IsTouchingObject,C32.Plugins.System.Acts.SetFunctionReturnValue,C32.Plugins.System.Cnds.CompareBoolVar,C32.Plugins.System.Exps.viewportwidth,C32.Plugins.Sprite.Acts.SetAnimFrame,C32.Plugins.Text.Acts.SetText,C32.Plugins.Sprite.Exps.BBoxBottom,C32.Plugins.Sprite.Acts.AddChild,C32.Plugins.Sprite.Acts.SetHeight,C32.Plugins.Text.Exps.Height,C32.Plugins.Browser.Acts.ConsoleLog,C32.Plugins.NinePatch.Exps.Height,C32.Plugins.Sprite.Acts.SetInstanceVar,C32.Plugins.Sprite.Exps.UID,C32.Plugins.Sprite.Acts.SetBoolInstanceVar,C32.Plugins.Sprite.Acts.SetDefaultColor,C32.Plugins.Text.Acts.SetFontSize,C32.Plugins.Text.Acts.Destroy,C32.Plugins.NinePatch.Acts.SetInstanceVar,C32.Plugins.Json.Cnds.IsBooleanSet,C32.Plugins.Sprite.Acts.SetSize,C32.Plugins.Text.Acts.SetHeight,C32.Plugins.Text.Exps.TextHeight,C32.Plugins.NinePatch.Cnds.IsBoolInstanceVarSet,C32.Plugins.System.Acts.RestartLayout,C32.Plugins.System.Cnds.While,C32.Plugins.Dictionary.Exps.Get,C32.Plugins.System.Cnds.EvaluateExpression,C32.Plugins.Sprite.Cnds.IsBoolInstanceVarSet,C32.Plugins.System.Exps.int,C32.Plugins.Text.Acts.SetVisible,C32.Plugins.Sprite.Acts.SetVisible,C32.Behaviors.Fade.Acts.StartFade,C32.Plugins.Particles.Acts.SetSpraying,C32.Plugins.Json.Cnds.ForEach,C32.Plugins.Json.Exps.Path,C32.Plugins.NinePatch.Cnds.CompareInstanceVar,C32.Plugins.NinePatch.Acts.SetDefaultColor,C32.Plugins.NinePatch.Cnds.PickChildren,C32.Plugins.Text.Acts.SetFontColor,C32.Plugins.System.Exps.layoutwidth,C32.Plugins.Text.Acts.AppendText,C32.Plugins.Text.Acts.SetInstanceVar,C32.Plugins.Text.Cnds.CompareText,C32.Plugins.System.Cnds.ForEach,C32.Plugins.Dictionary.Cnds.CompareValue,C32.Plugins.Dictionary.Cnds.CompareInstanceVar,C32.Plugins.Dictionary.Cnds.HasKey,C32.Plugins.Sprite.Cnds.CompareFrameTag,C32.Plugins.Sprite.Cnds.IsEffectEnabled,C32.Plugins.Sprite.Cnds.CompareFrame,C32.Plugins.Sprite.Acts.SetEffectEnabled,C32.Plugins.Dictionary.Acts.AddKey,C32.Plugins.System.Exps.viewportmidx,C32.Plugins.System.Exps.viewportmidy,C32.Plugins.TextBox.Cnds.CompareText,C32.Plugins.TextBox.Exps.Text,C32.Plugins.Clipboard.Acts.CopyText,C32.Plugins.TextBox.Acts.SetBlur,C32.Plugins.AJAX.Cnds.OnComplete,C32.Plugins.Json.Acts.Parse,C32.Plugins.AJAX.Exps.LastData,C32.Plugins.Sprite.Cnds.PickByUID,C32.Plugins.Sprite.Exps.Width,C32.Plugins.Sprite.Acts.SetAnim,C32.Plugins.Sprite.Cnds.IsAnimPlaying,C32.Plugins.Sprite.Acts.AddRemoveAnimation,C32.Plugins.Sprite.Acts.LoadURL,C32.Plugins.Sprite.Exps.ImageWidth,C32.Plugins.Sprite.Acts.MoveToLayer,C32.Plugins.Text.Acts.MoveToLayer,C32.Plugins.Sprite.Exps.LayerName,C32.Plugins.System.Exps.projectversion,C32.Plugins.Clipboard.Cnds.OnCopySuccess,C32.Plugins.Keyboard.Cnds.OnKey,C32.Plugins.System.Acts.SetBoolVar,C32.Plugins.LocalStorage.Acts.SetItem,C32.Plugins.Audio.Acts.SetMasterVolume,C32.Plugins.LocalStorage.Acts.CheckItemExists,C32.Plugins.LocalStorage.Cnds.OnItemExists,C32.Plugins.LocalStorage.Cnds.CompareValue,C32.Plugins.NinePatch.Cnds.PickNthChild,C32.Behaviors.Tween.Acts.TweenOneProperty,C32.Plugins.NinePatch.Exps.Width,C32.Plugins.NinePatch.Acts.SetWidth,C32.Plugins.NinePatch.Cnds.OnCreated,C32.Plugins.System.Exps.len,C32.Plugins.NinePatch.Acts.MoveToLayer,C32.Plugins.NinePatch.Exps.LayerName,C32.Plugins.NinePatch.Exps.X,C32.Plugins.NinePatch.Exps.Y,C32.Plugins.NinePatch.Acts.AddChild,C32.Plugins.NinePatch.Acts.SetSize,C32.Plugins.NinePatch.Acts.SetEffect,C32.Plugins.NinePatch.Acts.SetEffectParam,C32.Plugins.System.Exps.rgb,C32.Plugins.System.Exps.tokenat,C32.Plugins.NinePatch.Acts.SetEffectEnabled,C32.Plugins.Text.Acts.MoveToTop,C32.Plugins.System.Exps.layerscrollx,C32.Plugins.NinePatch.Acts.SetBoolInstanceVar,C32.Plugins.Sprite.Acts.SetX,C32.Plugins.System.Exps.layoutheight,C32.Plugins.System.Exps.layerindex,C32.Plugins.Sprite.Acts.AddInstanceVar,C32.Plugins.System.Acts.Signal,C32.Plugins.Sprite.Acts.MoveToBottom,C32.Behaviors.Fade.Acts.SetFadeInTime,C32.Behaviors.Fade.Acts.SetFadeOutTime,C32.Behaviors.Fade.Acts.RestartFade,C32.Plugins.Text.Acts.TypewriterText,C32.Plugins.NinePatch.Acts.SetHeight,C32.Behaviors.Pin.Acts.PinByProperties,C32.Plugins.System.Cnds.PickAll,C32.ScriptsInEvents.Systemlogic_Event187_Act1,C32.ScriptsInEvents.Systemlogic_Event188_Act2,C32.ScriptsInEvents.Systemlogic_Event189_Act1,C32.Plugins.Dictionary.Acts.SetKey,C32.Plugins.Dictionary.Exps.AsJSON,C32.Plugins.LocalStorage.Cnds.OnItemMissing,C32.Plugins.LocalStorage.Acts.GetItem,C32.Plugins.LocalStorage.Cnds.OnItemGet,C32.Plugins.Dictionary.Acts.JSONLoad,C32.Plugins.LocalStorage.Exps.ItemValue,C32.Plugins.Dictionary.Cnds.IsEmpty,C32.Plugins.Date.Exps.Difference,C32.Plugins.Date.Exps.Parse,C32.Plugins.Date.Exps.Now,C32.Plugins.Date.Exps.ToTotalMinutes,C32.Plugins.System.Exps.zeropad,C32.Plugins.Date.Exps.ToTotalSeconds,C32.ScriptsInEvents._backend_Event1_Act1,C32.ScriptsInEvents._backend_Event2_Act1,C32.ScriptsInEvents._backend_Event3_Act1,C32.ScriptsInEvents._backend_Event4_Act1,C32.ScriptsInEvents._backend_Event5_Act1,C32.ScriptsInEvents._backend_Event6_Act1,C32.ScriptsInEvents._backend_Event7_Act1,C32.ScriptsInEvents._backend_Event8_Act1,C32.ScriptsInEvents._backend_Event9_Act1,C32.ScriptsInEvents._backend_Event10_Act1,C32.ScriptsInEvents._backend_Event11_Act1,C32.ScriptsInEvents._backend_Event12_Act1,C32.ScriptsInEvents._backend_Event13_Act1,C32.ScriptsInEvents._backend_Event14_Act1,C32.ScriptsInEvents._backend_Event15_Act1,C32.ScriptsInEvents._backend_Event16_Act1,C32.ScriptsInEvents._backend_Event17_Act1,C32.ScriptsInEvents._backend_Event18_Act1,C32.ScriptsInEvents._backend_Event19_Act1,C32.ScriptsInEvents._backend_Event20_Act1,C32.ScriptsInEvents._backend_Event21_Act1,C32.ScriptsInEvents._backend_Event22_Act1,C32.ScriptsInEvents._backend_Event23_Act1,C32.ScriptsInEvents._backend_Event24_Act1,C32.ScriptsInEvents._backend_Event25_Act1,C32.ScriptsInEvents._backend_Event26_Act1,C32.ScriptsInEvents._backend_Event27_Act1,C32.ScriptsInEvents._backend_Event28_Act1,C32.ScriptsInEvents._backend_Event29_Act1,C32.ScriptsInEvents._backend_Event30_Act1,C32.ScriptsInEvents._backend_Event31_Act1,C32.ScriptsInEvents._backend_Event32_Act1,C32.ScriptsInEvents._backend_Event33_Act1,C32.ScriptsInEvents._backend_Event34_Act1,C32.Plugins.Audio.Acts.Play,C32.Plugins.TiledBg.Acts.SetImageOffsetX,C32.Plugins.TiledBg.Exps.ImageOffsetX,C32.Plugins.Sprite.Acts.SetAngle,C32.Plugins.System.Exps.uppercase,C32.Plugins.Sprite.Acts.SetZElevation,C32.Plugins.Audio.Acts.PlayByName,C32.Plugins.Sprite.Exps.BBoxMidX,C32.Plugins.Sprite.Exps.BBoxMidY,C32.Behaviors.Timer.Acts.StartTimer,C32.Behaviors.Timer.Acts.StopAllTimers,C32.Plugins.Audio.Acts.SetPlaybackRate,C32.Behaviors.Timer.Cnds.OnTimer,C32.Plugins.System.Acts.SubVar,C32.Plugins.Sprite.Acts.MoveToTop,C32.Plugins.Sprite.Acts.SetPos,C32.Plugins.Particles.Acts.SetPos,C32.Plugins.Audio.Acts.Stop,C32.Plugins.System.Cnds.Repeat,C32.Behaviors.Sin.Acts.SetEnabled,C32.Plugins.Text.Acts.SetPos,C32.Plugins.Text.Acts.SetZElevation,C32.Plugins.System.Exps.rgbex,C32.Plugins.Sprite.Acts.SetOpacity,C32.Plugins.System.Acts.SetTimescale,C32.Plugins.Audio.Acts.StopAll,C32.Plugins.System.Exps.right,C32.Plugins.NinePatch.Acts.SetY,C32.Plugins.NinePatch.Acts.SetX,C32.Plugins.System.Exps.random,C32.ScriptsInEvents.Trainingbackendlinking_Event11_Act1,C32.ScriptsInEvents.Playfabfunctions_Event2_Act1,C32.ScriptsInEvents.Playfabfunctions_Event3_Act1,C32.ScriptsInEvents.Playfabfunctions_Event4_Act1,C32.ScriptsInEvents.Playfabfunctions_Event5_Act1]},self.C3_JsPropNameTable=[{AJAX:0},{Array:0},{Touch:0},{LocalStorage:0},{Dictionary:0},{Mouse:0},{Browser:0},{Date:0},{Clipboard:0},{Keyboard:0},{LevelNumber:0},{me:0},{me2:0},{leaderboard:0},{slug:0},{TaskData:0},{readMessages:0},{loginstreak:0},{clanMembers:0},{clanInvite:0},{backendError:0},{referrals:0},{config:0},{MonsterTraining:0},{ActivePlayerMonster:0},{FavMonsters:0},{adsgram:0},{locked:0},{jpos:0},{name:0},{Pin:0},{list_btn:0},{iconb:0},{tab:0},{DragDrop:0},{DragBox:0},{ListMask:0},{PageHeadlineBG:0},{ref:0},{screen:0},{CloseButton:0},{Tween:0},{Modal:0},{infoPanel:0},{ModalButton:0},{CoinsSmall:0},{LabImage:0},{requirementImage:0},{Lock:0},{UpgradeModal:0},{Coins2:0},{background:0},{credits:0},{coins:0},{Energy:0},{greybox:0},{NavIcons:0},{BottomNavBG:0},{Text:0},{TapObject_crystal:0},{TopShade:0},{Sine:0},{TutorialHand:0},{tapToDestroy:0},{list_msg_box:0},{ListXScroll:0},{icon:0},{value:0},{rotatingCoin:0},{text_general:0},{leaderboardEntry:0},{SineH:0},{SineV:0},{SineR:0},{DynamicIcons:0},{disabled:0},{selected:0},{tab_btn:0},{headerText:0},{timerText:0},{icon2:0},{layer:0},{percent:0},{color:0},{bar:0},{barBorder:0},{barProgress:0},{Fade:0},{alert_bg:0},{alert_txt:0},{MonsterShadow:0},{BattlePanel:0},{Opponent:0},{MonsterButtonL_9:0},{MonsterButtonR_9:0},{MonsterBattleFrame:0},{MonsterBattleTileBack:0},{MonsterPlayer:0},{MonsterBattleMask:0},{Timer:0},{TapButton:0},{playerSlug:0},{selectedMonsterID:0},{monsterHealth:0},{MonsterBattleLowerPanel:0},{Attack:0},{Shield:0},{ThoughtBubble:0},{AttackShard:0},{AttackSmall:0},{ShieldSmall:0},{BattleButton:0},{BattleUIBlackCorePanel:0},{GreyDataPanelPoint:0},{GreyDataPanelPoint2:0},{BattleUILower2:0},{BattleUILower9:0},{GreyDataPanelPointFlip:0},{countDownTimer:0},{verifyTime:0},{progBarPlaceholder:0},{chipleaf_message:0},{Sprite:0},{verifyTimestamp:0},{list_btn_full:0},{Pipe:0},{BackBtn:0},{DailyGoldCoin:0},{DailyChainmon:0},{list_btn_full2:0},{MonsterModal:0},{ModalHeader:0},{EmbdedPanel:0},{XPBox:0},{TextInput:0},{blackBox:0},{Rotate:0},{ShinyGlow:0},{chipleaf_copy:0},{infoPanelstretchy:0},{"9patch":0},{"9patch2":0},{ButtonR:0},{DamageText:0},{DebugText:0},{Audio:0},{XPBoxFillBevel:0},{XPBoxFillWhite:0},{PixelBackground_Retro:0},{playerPoint:0},{opponentPoint:0},{PixelArrow:0},{EnergyTapParticles:0},{Flash:0},{Sine2:0},{AnimeAttackLines:0},{timeScale:0},{timeController:0},{PivotPoint:0},{Wrap:0},{Clouds:0},{Dizzy:0},{"9patch3":0},{HealBack:0},{HealParticles:0},{MuteIcon:0},{RechargeParticles:0},{energy:0},{maxEnergy:0},{rechargePerSecond:0},{earnPerHour:0},{earnPerTap:0},{ccoinsClamped:0},{ccoins:0},{x:0},{y:0},{p:0},{PassedTapPower:0},{startingTab:0},{list_x_origin:0},{list_y_origin:0},{list_y_origin_offset:0},{list_btn_a_width:0},{dragy0:0},{dragy1:0},{dragy2:0},{template:0},{rank:0},{yourScore:0},{score:0},{iconWidth:0},{iconHeight:0},{path:0},{count:0},{fullWidth:0},{text:0},{btn_counter:0},{monster_count:0},{btn_counter_favs:0},{lab_count:0},{eq_count:0},{prod_count:0},{btn_count:0},{cost:0},{btn_count0:0},{btn_count2:0},{btn_count1:0},{liveGame:0},{mute:0},{currentScreen:0},{uid:0},{imageURL:0},{whatToUpdate:0},{tween:0},{title:0},{tab0:0},{tab1:0},{tab2:0},{tab0disabled:0},{tab1disabled:0},{tab2disabled:0},{BackButtonScreen:0},{tab_tween_time:0},{tab_ref:0},{b1text:0},{b1ref:0},{b2ref:0},{b2text:0},{message:0},{b1Text:0},{b2Text:0},{secondsToFade:0},{txt:0},{bg:0},{string:0},{thickness:0},{number:0},{num:0},{favMonsterString:0},{ID:0},{timeDiffMS:0},{targetTimeUTCString:0},{timeLeftMS:0},{targetTimestamp:0},{taskSlug:0},{clanName:0},{notificationId:0},{day:0},{link:0},{featureSlug:0},{trainingMonsterSlug:0},{moveType:0},{taps:0},{countedTaps:0},{type:0},{TrainingStatus:0},{BattleState:0},{MonsterID:0},{TrainingTapCounter:0},{TrainingTapEnemyPower:0},{playerMove:0},{opponentMove:0},{monsterSlug:0},{BattleEnergy:0},{BattleEnergyMax:0},{animateBackground:0},{playerX:0},{playerY:0},{opponentX:0},{opponentY:0},{TapPowerMod:0},{timeScalar:0},{TileSpeed:0},{TopUIPos:0},{BottomUIPos:0},{PlayerDataPanelPos:0},{OpponentDataPanelPos:0},{battleButtonPanelPosL:0},{playerMonsterName:0},{tapCount:0},{battleButtonPanelPosR:0},{calculatedTaps:0},{calculatedTapPower:0},{posPlayer:0},{posOpponent:0},{winnerUID:0},{looserUID:0},{WinnerName:0},{player:0},{posx:0},{posy:0},{result:0},{storedPlayerHP:0},{storedOpponentHP:0},{tPlayerHP:0},{tOppHP:0},{tCoins:0},{tXP:0},{tPlayerFirst:0},{positionX:0},{positionY:0},{DamageValue:0},{shieldX:0},{shieldY:0},{attackX:0},{attackY:0},{attack:0},{isPlayer:0},{EnableJiggle:0},{CurrentEnergy:0},{showText:0},{duration:0},{punchAmount:0},{VerticalOffset:0},{textColor:0},{speed:0},{width:0},{height:0},{myUID:0},{OffsetX:0},{OffsetY:0},{UID:0},{Next_Opponent_Move:0},{PlayerHP:0},{PlayerDamageDealt:0},{OpponentDamageDealt:0},{BattleStatus:0},{OpponentHP:0},{TrainingEXPEarned:0},{TrainingCoinsEarned:0},{TrainingPlayerFirstAction:0},{PlayerAction:0},{PlayerTrainingEnergy:0},{TapMonsterID:0},{TapPower:0},{player_hp:0},{tap_power:0},{player_action:0},{player_monster_id:0},{opponent_hp:0},{opponent_monster_id:0},{opponent_action:0},{player_energy:0}],self.InstanceType={AJAX:class extends self.IInstance{},Array:class extends self.IArrayInstance{},Touch:class extends self.IInstance{},LocalStorage:class extends self.IInstance{},Dictionary:class extends self.IDictionaryInstance{},Mouse:class extends self.IInstance{},Browser:class extends self.IInstance{},Date:class extends self.IInstance{},Clipboard:class extends self.IInstance{},Keyboard:class extends self.IInstance{},LevelNumber:class extends self.ITextInstance{},me:class extends self.IJSONInstance{},me2:class extends self.IJSONInstance{},leaderboard:class extends self.IJSONInstance{},TaskData:class extends self.IDictionaryInstance{},readMessages:class extends self.IDictionaryInstance{},loginstreak:class extends self.IJSONInstance{},clanMembers:class extends self.IJSONInstance{},clanInvite:class extends self.IJSONInstance{},backendError:class extends self.IJSONInstance{},referrals:class extends self.IJSONInstance{},config:class extends self.IJSONInstance{},MonsterTraining:class extends self.IJSONInstance{},ActivePlayerMonster:class extends self.IJSONInstance{},FavMonsters:class extends self.IDictionaryInstance{},adsgram:class extends self.IJSONInstance{},list_btn:class extends self.ISpriteInstance{},iconb:class extends self.ISpriteInstance{},DragBox:class extends self.ISpriteInstance{},ListMask:class extends self.ISpriteInstance{},PageHeadlineBG:class extends self.IWorldInstance{},CloseButton:class extends self.ISpriteInstance{},Modal:class extends self.IWorldInstance{},infoPanel:class extends self.ISpriteInstance{},ModalButton:class extends self.ISpriteInstance{},CoinsSmall:class extends self.ISpriteInstance{},LabImage:class extends self.ISpriteInstance{},requirementImage:class extends self.ISpriteInstance{},Lock:class extends self.ISpriteInstance{},UpgradeModal:class extends self.ISpriteInstance{},Coins2:class extends self.ISpriteInstance{},background:class extends self.ISpriteInstance{},coins:class extends self.ITextInstance{},Energy:class extends self.ITextInstance{},greybox:class extends self.IWorldInstance{},NavIcons:class extends self.ISpriteInstance{},BottomNavBG:class extends self.IWorldInstance{},Text:class extends self.ITextInstance{},TapObject_crystal:class extends self.ISpriteInstance{},TopShade:class extends self.ISpriteInstance{},TutorialHand:class extends self.ISpriteInstance{},list_msg_box:class extends self.IWorldInstance{},ListXScroll:class extends self.ISpriteInstance{},icon:class extends self.ISpriteInstance{},rotatingCoin:class extends self.ISpriteInstance{},text_general:class extends self.ITextInstance{},leaderboardEntry:class extends self.ITextInstance{},DynamicIcons:class extends self.ISpriteInstance{},tab_btn:class extends self.IWorldInstance{},headerText:class extends self.ITextInstance{},timerText:class extends self.ITextInstance{},icon2:class extends self.ISpriteInstance{},bar:class extends self.IWorldInstance{},barBorder:class extends self.IWorldInstance{},barProgress:class extends self.IWorldInstance{},alert_bg:class extends self.ISpriteInstance{},alert_txt:class extends self.ITextInstance{},MonsterShadow:class extends self.ISpriteInstance{},BattlePanel:class extends self.ISpriteInstance{},Opponent:class extends self.ISpriteInstance{},MonsterButtonL_9:class extends self.IWorldInstance{},MonsterButtonR_9:class extends self.IWorldInstance{},MonsterBattleFrame:class extends self.ISpriteInstance{},MonsterBattleTileBack:class extends self.ITiledBackgroundInstance{},MonsterPlayer:class extends self.ISpriteInstance{},MonsterBattleMask:class extends self.ISpriteInstance{},TapButton:class extends self.ISpriteInstance{},MonsterBattleLowerPanel:class extends self.ISpriteInstance{},Attack:class extends self.ISpriteInstance{},Shield:class extends self.ISpriteInstance{},ThoughtBubble:class extends self.ISpriteInstance{},AttackShard:class extends self.ISpriteInstance{},AttackSmall:class extends self.ISpriteInstance{},ShieldSmall:class extends self.ISpriteInstance{},BattleButton:class extends self.IWorldInstance{},BattleUIBlackCorePanel:class extends self.ISpriteInstance{},GreyDataPanelPoint:class extends self.IWorldInstance{},GreyDataPanelPoint2:class extends self.IWorldInstance{},BattleUILower2:class extends self.ISpriteInstance{},BattleUILower9:class extends self.IWorldInstance{},GreyDataPanelPointFlip:class extends self.IWorldInstance{},countDownTimer:class extends self.ITextInstance{},verifyTime:class extends self.ITextInstance{},progBarPlaceholder:class extends self.ISpriteInstance{},chipleaf_message:class extends self.ISpriteInstance{},Sprite:class extends self.ISpriteInstance{},list_btn_full:class extends self.IWorldInstance{},Pipe:class extends self.ISpriteInstance{},BackBtn:class extends self.ISpriteInstance{},DailyGoldCoin:class extends self.ISpriteInstance{},DailyChainmon:class extends self.ISpriteInstance{},list_btn_full2:class extends self.IWorldInstance{},MonsterModal:class extends self.ISpriteInstance{},ModalHeader:class extends self.ISpriteInstance{},EmbdedPanel:class extends self.ISpriteInstance{},XPBox:class extends self.ISpriteInstance{},TextInput:class extends self.ITextInputInstance{},blackBox:class extends self.ISpriteInstance{},ShinyGlow:class extends self.ISpriteInstance{},chipleaf_copy:class extends self.ISpriteInstance{},infoPanelstretchy:class extends self.IWorldInstance{},_9patch:class extends self.IWorldInstance{},_9patch2:class extends self.IWorldInstance{},ButtonR:class extends self.ISpriteInstance{},DamageText:class extends self.ITextInstance{},DebugText:class extends self.ITextInstance{},Audio:class extends self.IInstance{},XPBoxFillBevel:class extends self.ISpriteInstance{},XPBoxFillWhite:class extends self.ISpriteInstance{},PixelBackground_Retro:class extends self.ISpriteInstance{},playerPoint:class extends self.ISpriteInstance{},opponentPoint:class extends self.ISpriteInstance{},PixelArrow:class extends self.ISpriteInstance{},EnergyTapParticles:class extends self.IParticlesInstance{},Flash:class extends self.ISpriteInstance{},AnimeAttackLines:class extends self.ISpriteInstance{},timeController:class extends self.ISpriteInstance{},PivotPoint:class extends self.ISpriteInstance{},Clouds:class extends self.ISpriteInstance{},Dizzy:class extends self.ISpriteInstance{},_9patch3:class extends self.IWorldInstance{},HealBack:class extends self.ISpriteInstance{},HealParticles:class extends self.IParticlesInstance{},MuteIcon:class extends self.ISpriteInstance{},RechargeParticles:class extends self.IParticlesInstance{}},(()=>{var i={},e="";try{e=location.hash.toString()}catch(e){}var t=l(e),s=_("initParams");if(s)for(var n in s)void 0===t[n]&&(t[n]=s[n]);d("initParams",t);var r,a=!1;try{if(a=null!=window.parent&&window!=window.parent){window.addEventListener("message",function(e){if(e.source===window.parent){try{var t=JSON.parse(e.data)}catch(e){return}if(t&&t.eventType)if("set_custom_style"==t.eventType)"https://web.telegram.org"===e.origin&&(r.innerHTML=t.eventData);else if("reload_iframe"==t.eventType){try{window.parent.postMessage(JSON.stringify({eventType:"iframe_will_reload"}),"*")}catch(e){}location.reload()}else c(t.eventType,t.eventData)}}),r=document.createElement("style"),document.head.appendChild(r);try{window.parent.postMessage(JSON.stringify({eventType:"iframe_ready",eventData:{reload_supported:!0}}),"*")}catch(e){}}}catch(e){}function o(t){try{return t=t.replace(/\+/g,"%20"),decodeURIComponent(t)}catch(e){return t}}function l(e){var t={};if((e=e.replace(/^#/,"")).length)if(e.indexOf("=")<0&&e.indexOf("?")<0)t._path=o(e);else{var s,n,i=e.indexOf("?"),r=(0<=i&&(s=e.substr(0,i),t._path=o(s),e=e.substr(i+1)),h(e));for(n in r)t[n]=r[n]}return t}function h(e){var t={};if(e.length)for(var s,n,i=e.split("&"),r=0;r<i.length;r++)s=o((n=i[r].split("="))[0]),n=null==n[1]?null:o(n[1]),t[s]=n;return t}function c(t,s){console.log("[Telegram.WebView] < receiveEvent",t,s),u(t,function(e){e(t,s)})}function u(e,t){var s=i[e];if(void 0!==s&&s.length)for(var n=0;n<s.length;n++)try{t(s[n])}catch(e){}}function d(e,t){try{return window.sessionStorage.setItem("__telegram__"+e,JSON.stringify(t)),!0}catch(e){}return!1}function _(e){try{return JSON.parse(window.sessionStorage.getItem("__telegram__"+e))}catch(e){}return null}window.Telegram||(window.Telegram={}),window.Telegram.WebView={initParams:t,isIframe:a,onEvent:function(e,t){void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},offEvent:function(e,t){void 0!==i[e]&&-1!==(t=i[e].indexOf(t))&&i[e].splice(t,1)},postEvent:function(e,t,s){if(t=t||function(){},void 0===s&&(s=""),console.log("[Telegram.WebView] > postEvent",e,s),void 0!==window.TelegramWebviewProxy)window.TelegramWebviewProxy.postEvent(e,JSON.stringify(s)),t();else if(window.external&&"notify"in window.external)window.external.notify(JSON.stringify({eventType:e,eventData:s})),t();else if(a)try{window.parent.postMessage(JSON.stringify({eventType:e,eventData:s}),"*"),t()}catch(e){t(e)}else t({notAvailable:!0})},receiveEvent:c,callEventCallbacks:u},window.Telegram.Utils={urlSafeDecode:o,urlParseQueryString:h,urlParseHashParams:l,urlAppendHashParams:function(e,t){var s=e.indexOf("#");return s<0?e+"#"+t:0<=(s=e.substr(s+1)).indexOf("=")||0<=s.indexOf("?")?e+"&"+t:0<s.length?e+"?"+t:e+t},sessionStorageSet:d,sessionStorageGet:_},window.TelegramGameProxy_receiveEvent=c,window.TelegramGameProxy={receiveEvent:c}})(),(()=>{var c=window.Telegram.Utils,p=window.Telegram.WebView,m=p.initParams,L=p.isIframe,s={},k="",B={},g={},N="light",u="6.0",W="unknown";if(m.tgWebAppData&&m.tgWebAppData.length)for(var V in k=m.tgWebAppData,B=c.urlParseQueryString(k)){var e=B[V];try{("{"==e.substr(0,1)&&"}"==e.substr(-1)||"["==e.substr(0,1)&&"]"==e.substr(-1))&&(B[V]=JSON.parse(e))}catch(e){}}if(m.tgWebAppThemeParams&&m.tgWebAppThemeParams.length){var U=m.tgWebAppThemeParams;try{(h=JSON.parse(U))&&Y(h)}catch(e){}}(h=c.sessionStorageGet("themeParams"))&&Y(h),m.tgWebAppVersion&&(u=m.tgWebAppVersion),m.tgWebAppPlatform&&(W=m.tgWebAppPlatform);var j=window.innerHeight;function H(e){j!=window.innerHeight&&(j=window.innerHeight,S("viewportChanged",{isStateStable:!0}))}function f(e){return e.toString().replace(/^\s+|\s+$/g,"")}function S(e){var t=Array.prototype.slice.call(arguments);e=t.shift(),p.callEventCallbacks("webview:"+e,function(e){e.apply(s,t)})}function X(e,t){p.onEvent("webview:"+e,t)}function q(e,t){p.offEvent("webview:"+e,t)}function $(e,t){var s=document.documentElement;s&&s.style&&s.style.setProperty&&s.style.setProperty("--tg-"+e,t)}function Y(e){var t,s,n,i,r;for(s in"#1c1c1d"==e.bg_color&&e.bg_color==e.secondary_bg_color&&(e.secondary_bg_color="#2c2c2e"),e)(t=y(e[s]))&&(g[s]=t,"bg_color"==s&&(r=i=void 0,3==(n=(n=t).replace(/[\s#]/g,"")).length&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),i=parseInt(n.substr(0,2),16),r=parseInt(n.substr(2,2),16),n=parseInt(n.substr(4,2),16),$("color-scheme",N=Math.sqrt(i*i*.299+r*r*.587+n*n*.114)<120?"dark":"light")),$(s="theme-"+s.split("_").join("-"),t));c.sessionStorageSet("themeParams",g)}var a={};function z(e){for(var t=100;--t;){for(var s="",n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i=n.length,r=0;r<e;r++)s+=n[Math.floor(Math.random()*i)];if(!a[s])return a[s]={},s}throw Error("WebAppCallbackIdGenerateFailed")}var t=!1,n=!1,K=!0;function J(e){void 0!==e&&(K=!!e.is_expanded,t=e.height,e.is_state_stable&&(n=e.height),S("viewportChanged",{isStateStable:!!e.is_state_stable})),e=!1!==n?n-C+"px":C?"calc(100vh - "+C+"px)":"100vh",$("viewport-height",!1!==t?t-C+"px":C?"calc(100vh - "+C+"px)":"100vh"),$("viewport-stable-height",e)}var Z=!1,Q=!0,i="bg_color",r=null,ee=null,te=null;function se(){ee==i&&te==r||(ee=i,(te=r)?p.postEvent("web_app_set_header_color",!1,{color:r}):p.postEvent("web_app_set_header_color",!1,{color_key:i}))}var ne="bg_color";function ie(){return"secondary_bg_color"==ne?g.secondary_bg_color:"bg_color"==ne?g.bg_color:ne}var re=null;function ae(){var e=ie();re!=e&&(re=e,p.postEvent("web_app_set_background_color",!1,{color:e}))}function y(e){var t,s;return(s=/^\s*#([0-9a-f]{6})\s*$/i.exec(e+=""))?"#"+s[1].toLowerCase():(s=/^\s*#([0-9a-f])([0-9a-f])([0-9a-f])\s*$/i.exec(e))?("#"+s[1]+s[1]+s[2]+s[2]+s[3]+s[3]).toLowerCase():!!(s=/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)\s*$/.exec(e))&&(e=parseInt(s[1]),t=parseInt(s[2]),s=parseInt(s[3]),"#"+(e=(e<16?"0":"")+e.toString(16))+(t=(t<16?"0":"")+t.toString(16))+(s=(s<16?"0":"")+s.toString(16)))}function d(e){return 0<=((e,t)=>{"string"!=typeof t&&(t=""),e=(e="string"!=typeof e?"":e).replace(/^\s+|\s+$/g,"").split("."),t=t.replace(/^\s+|\s+$/g,"").split(".");for(var s,n,i=Math.max(e.length,t.length),r=0;r<i;r++)if((s=parseInt(e[r])||0)!=(n=parseInt(t[r])||0))return n<s?1:-1;return 0})(u,e)}oe=!1,o={},Object.defineProperty(o,"isVisible",{set:function(e){de({is_visible:e})},get:function(){return oe},enumerable:!0}),le=null,p.onEvent("back_button_pressed",function(){S("backButtonClicked")}),o.onClick=function(e){return ce()&&X("backButtonClicked",e),o},o.offClick=function(e){return ce()&&q("backButtonClicked",e),o},o.show=function(){return de({is_visible:!0})},o.hide=function(){return de({is_visible:!1})};var oe,o,le,U=o;function he(){return{is_visible:oe}}function ce(){if(d("6.1"))return 1;console.warn("[Telegram.WebApp] BackButton is not supported in version "+u)}function ue(){var e=he(),t=(void 0===(t=e)&&(t=he()),JSON.stringify(t));le!==t&&(le=t,p.postEvent("web_app_setup_back_button",!1,e))}function de(e){return ce()&&(void 0!==e.is_visible&&(oe=!!e.is_visible),ue()),o}var _e,l,pe,C=0,h=(()=>{var e,s=!1,n=!0,i=!1,r="CONTINUE",a=!1,o=!1,l={},h=(Object.defineProperty(l,"text",{set:function(e){l.setParams({text:e})},get:function(){return r},enumerable:!0}),Object.defineProperty(l,"color",{set:function(e){l.setParams({color:e})},get:function(){return a||g.button_color||"#2481cc"},enumerable:!0}),Object.defineProperty(l,"textColor",{set:function(e){l.setParams({text_color:e})},get:function(){return o||g.button_text_color||"#ffffff"},enumerable:!0}),Object.defineProperty(l,"isVisible",{set:function(e){l.setParams({is_visible:e})},get:function(){return s},enumerable:!0}),Object.defineProperty(l,"isProgressVisible",{get:function(){return i},enumerable:!0}),Object.defineProperty(l,"isActive",{set:function(e){l.setParams({is_active:e})},get:function(){return n},enumerable:!0}),null),c=(p.onEvent("main_button_pressed",u),null);if(m.tgWebAppDebug){for(var t in c=document.createElement("tg-main-button"),e={font:"600 14px/18px sans-serif",display:"none",width:"100%",height:"48px",borderRadius:"0",background:"no-repeat right center",position:"fixed",left:"0",right:"0",bottom:"0",margin:"0",padding:"15px 20px",textAlign:"center",boxSizing:"border-box",zIndex:"10000"})c.style[t]=e[t];document.addEventListener("DOMContentLoaded",function e(t){document.removeEventListener("DOMContentLoaded",e),document.body.appendChild(c),c.addEventListener("click",u,!1)})}function u(){n&&S("mainButtonClicked")}function d(){var e=l.color,t=l.textColor;return s?{is_visible:!0,is_active:n,is_progress_visible:i,text:r,color:e,text_color:t}:{is_visible:!1}}function _(){var e=d(),t=(void 0===(t=e)&&(t=d()),JSON.stringify(t));h!==t&&(h=t,p.postEvent("web_app_setup_main_button",!1,e),m.tgWebAppDebug)&&((t=e).is_visible?(c.style.display="block",C=48,c.style.opacity=t.is_active?"1":"0.8",c.style.cursor=t.is_active?"pointer":"auto",c.disabled=!t.is_active,c.innerText=t.text,c.style.backgroundImage=t.is_progress_visible?"url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20viewport%3D%220%200%2048%2048%22%20width%3D%2248px%22%20height%3D%2248px%22%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20stroke%3D%22%23fff%22%20stroke-width%3D%222.25%22%20stroke-linecap%3D%22round%22%20fill%3D%22none%22%20stroke-dashoffset%3D%22106%22%20r%3D%229%22%20stroke-dasharray%3D%2256.52%22%20rotate%3D%22-90%22%3E%3Canimate%20attributeName%3D%22stroke-dashoffset%22%20attributeType%3D%22XML%22%20dur%3D%22360s%22%20from%3D%220%22%20to%3D%2212500%22%20repeatCount%3D%22indefinite%22%3E%3C%2Fanimate%3E%3CanimateTransform%20attributeName%3D%22transform%22%20attributeType%3D%22XML%22%20type%3D%22rotate%22%20dur%3D%221s%22%20from%3D%22-90%2024%2024%22%20to%3D%22630%2024%2024%22%20repeatCount%3D%22indefinite%22%3E%3C%2FanimateTransform%3E%3C%2Fcircle%3E%3C%2Fsvg%3E')":"none",c.style.backgroundColor=t.color,c.style.color=t.text_color):(c.style.display="none",C=0),document.documentElement&&(document.documentElement.style.boxSizing="border-box",document.documentElement.style.paddingBottom=C+"px"),J())}return l.setText=function(e){return l.setParams({text:e})},l.onClick=function(e){return X("mainButtonClicked",e),l},l.offClick=function(e){return q("mainButtonClicked",e),l},l.show=function(){return l.setParams({is_visible:!0})},l.hide=function(){return l.setParams({is_visible:!1})},l.enable=function(){return l.setParams({is_active:!0})},l.disable=function(){return l.setParams({is_active:!1})},l.showProgress=function(e){return n=!!e,i=!0,_(),l},l.hideProgress=function(){return l.isActive||(n=!0),i=!1,_(),l},l.setParams=function(e){if(void 0!==e.text){var t=f(e.text);if(!t.length)throw console.error("[Telegram.WebApp] Main button text is required",e.text),Error("WebAppMainButtonParamInvalid");if(64<t.length)throw console.error("[Telegram.WebApp] Main button text is too long",t),Error("WebAppMainButtonParamInvalid");r=t}if(void 0!==e.color)if(!1===e.color||null===e.color)a=!1;else{t=y(e.color);if(!t)throw console.error("[Telegram.WebApp] Main button color format is invalid",e.color),Error("WebAppMainButtonParamInvalid");a=t}if(void 0!==e.text_color)if(!1===e.text_color||null===e.text_color)o=!1;else{t=y(e.text_color);if(!t)throw console.error("[Telegram.WebApp] Main button text color format is invalid",e.text_color),Error("WebAppMainButtonParamInvalid");o=t}if(void 0!==e.is_visible){if(e.is_visible&&!l.text.length)throw console.error("[Telegram.WebApp] Main button text is required"),Error("WebAppMainButtonParamInvalid");s=!!e.is_visible}return void 0!==e.is_active&&(n=!!e.is_active),_(),l},l})(),me=(_e=!1,l={},Object.defineProperty(l,"isVisible",{set:function(e){ye({is_visible:e})},get:function(){return _e},enumerable:!0}),pe=null,p.onEvent("settings_button_pressed",function(){S("settingsButtonClicked")}),l.onClick=function(e){return fe()&&X("settingsButtonClicked",e),l},l.offClick=function(e){return fe()&&q("settingsButtonClicked",e),l},l.show=function(){return ye({is_visible:!0})},l.hide=function(){return ye({is_visible:!1})},l);function ge(){return{is_visible:_e}}function fe(){if(d("6.10"))return 1;console.warn("[Telegram.WebApp] SettingsButton is not supported in version "+u)}function Se(){var e=ge(),t=(void 0===(t=e)&&(t=ge()),JSON.stringify(t));pe!==t&&(pe=t,p.postEvent("web_app_setup_settings_button",!1,e))}function ye(e){return fe()&&(void 0!==e.is_visible&&(_e=!!e.is_visible),Se()),l}var Ce,Ge=Ce={impactOccurred:function(e){return Te({type:"impact",impact_style:e})},notificationOccurred:function(e){return Te({type:"notification",notification_type:e})},selectionChanged:function(){return Te({type:"selection_change"})}};function Te(e){if(d("6.1")){if("impact"==e.type){if("light"!=e.impact_style&&"medium"!=e.impact_style&&"heavy"!=e.impact_style&&"rigid"!=e.impact_style&&"soft"!=e.impact_style)throw console.error("[Telegram.WebApp] Haptic impact style is invalid",e.impact_style),Error("WebAppHapticImpactStyleInvalid")}else if("notification"==e.type){if("error"!=e.notification_type&&"success"!=e.notification_type&&"warning"!=e.notification_type)throw console.error("[Telegram.WebApp] Haptic notification type is invalid",e.notification_type),Error("WebAppHapticNotificationTypeInvalid")}else if("selection_change"!=e.type)throw console.error("[Telegram.WebApp] Haptic feedback type is invalid",e.type),Error("WebAppHapticFeedbackTypeInvalid");p.postEvent("web_app_trigger_haptic_feedback",!1,e)}else console.warn("[Telegram.WebApp] HapticFeedback is not supported in version "+u);return Ce}var Ie,be=Ie={setItem:function(e,t,s){return Ae("saveStorageValue",{key:e,value:t},s)},getItem:function(s,n){return Ie.getItems([s],n?function(e,t){e?n(e):n(null,t[s])}:null)},getItems:function(e,t){return Ae("getStorageValues",{keys:e},t)},removeItem:function(e,t){return Ie.removeItems([e],t)},removeItems:function(e,t){return Ae("deleteStorageValues",{keys:e},t)},getKeys:function(e){return Ae("getStorageKeys",{},e)}};function Ae(e,t,s){if(d("6.9"))return xe(e,t,s),Ie;throw console.error("[Telegram.WebApp] CloudStorage is not supported in version "+u),Error("WebAppMethodUnsupported")}G=_=!1,b=I=T=!(Pe="unknown"),Ee="",A={},Object.defineProperty(A,"isInited",{get:function(){return _},enumerable:!0}),Object.defineProperty(A,"isBiometricAvailable",{get:function(){return _&&G},enumerable:!0}),Object.defineProperty(A,"biometricType",{get:function(){return Pe||"unknown"},enumerable:!0}),Object.defineProperty(A,"isAccessRequested",{get:function(){return T},enumerable:!0}),Object.defineProperty(A,"isAccessGranted",{get:function(){return T&&I},enumerable:!0}),Object.defineProperty(A,"isBiometricTokenSaved",{get:function(){return b},enumerable:!0}),Object.defineProperty(A,"deviceId",{get:function(){return Ee||""},enumerable:!0}),R=v=E=!(P={callbacks:[]}),p.onEvent("biometry_info_received",function(e,t){_=!0,b=t.available?(G=!0,Pe=t.type||"unknown",t.access_requested?(T=!0,I=!!t.access_granted,!!t.token_saved):I=T=!1):(G=!1,I=T=!(Pe="unknown"));if(Ee=t.device_id||"",0<P.callbacks.length)for(var s=0;s<P.callbacks.length;s++)(0,P.callbacks[s])();E&&(t=E,E=!1,t.callback)&&t.callback(I);S("biometricManagerUpdated")}),p.onEvent("biometry_auth_requested",function(e,t){var s="authorized"==t.status,t=t.token||"";{var n;v&&(n=v,v=!1,n.callback)&&n.callback(s,s?t:null)}S("biometricAuthRequested",s?{isAuthenticated:!0,biometricToken:t}:{isAuthenticated:!1})}),p.onEvent("biometry_token_updated",function(e,t){var s=!1;G&&T&&("updated"==t.status?s=b=!0:"removed"==t.status&&(s=!(b=!1)));R&&(t=R,R=!1,t.callback)&&t.callback(s);S("biometricTokenUpdated",{isUpdated:s})}),A.init=function(e){return x()&&!_&&(e&&P.callbacks.push(e),p.postEvent("web_app_biometry_get_info",!1)),A},A.requestAccess=function(e,t){if(x()){if(Re(),!G)throw console.error("[Telegram.WebApp] Biometrics is not available on this device."),Error("WebAppBiometricManagerBiometricsNotAvailable");if(E)throw console.error("[Telegram.WebApp] Access is already requested"),Error("WebAppBiometricManagerAccessRequested");var s={};if(void 0!==e.reason){e=f(e.reason);if(128<e.length)throw console.error("[Telegram.WebApp] Biometric reason is too long",e),Error("WebAppBiometricRequestAccessParamInvalid");0<e.length&&(s.reason=e)}E={callback:t},p.postEvent("web_app_biometry_request_access",!1,s)}return A},A.authenticate=function(e,t){if(x()){if(Re(),!G)throw console.error("[Telegram.WebApp] Biometrics is not available on this device."),Error("WebAppBiometricManagerBiometricsNotAvailable");if(!I)throw console.error("[Telegram.WebApp] Biometric access was not granted by the user."),Error("WebAppBiometricManagerBiometricAccessNotGranted");if(v)throw console.error("[Telegram.WebApp] Authentication request is already in progress."),Error("WebAppBiometricManagerAuthenticationRequested");var s={};if(void 0!==e.reason){e=f(e.reason);if(128<e.length)throw console.error("[Telegram.WebApp] Biometric reason is too long",e),Error("WebAppBiometricRequestAccessParamInvalid");0<e.length&&(s.reason=e)}v={callback:t},p.postEvent("web_app_biometry_request_auth",!1,s)}return A},A.updateBiometricToken=function(e,t){if(x()){if(1024<(e=e||"").length)throw console.error("[Telegram.WebApp] Token is too long",e),Error("WebAppBiometricManagerTokenInvalid");if(Re(),!G)throw console.error("[Telegram.WebApp] Biometrics is not available on this device."),Error("WebAppBiometricManagerBiometricsNotAvailable");if(!I)throw console.error("[Telegram.WebApp] Biometric access was not granted by the user."),Error("WebAppBiometricManagerBiometricAccessNotGranted");if(R)throw console.error("[Telegram.WebApp] Token request is already in progress."),Error("WebAppBiometricManagerTokenUpdateRequested");R={callback:t},p.postEvent("web_app_biometry_update_token",!1,{token:e})}return A},A.openSettings=function(){if(x()){if(Re(),!G)throw console.error("[Telegram.WebApp] Biometrics is not available on this device."),Error("WebAppBiometricManagerBiometricsNotAvailable");if(!T)throw console.error("[Telegram.WebApp] Biometric access was not requested yet."),Error("WebAppBiometricManagerBiometricsAccessNotRequested");I?console.warn("[Telegram.WebApp] Biometric access was granted by the user, no need to go to settings."):p.postEvent("web_app_biometry_open_settings",!1)}return A};var _,G,Pe,T,I,b,Ee,A,P,E,v,R,ve=A;function x(){if(d("7.2"))return 1;console.warn("[Telegram.WebApp] BiometricManager is not supported in version "+u)}function Re(){if(!_)throw console.error("[Telegram.WebApp] BiometricManager should be inited before using."),Error("WebAppBiometricManagerNotInited")}var w={},D=!1,M=!1,O=!1,F=!1;function xe(e,t,s){if(!d("6.9"))throw console.error("[Telegram.WebApp] Method invokeCustomMethod is not supported in version "+u),Error("WebAppMethodUnsupported");var n=z(16),e={req_id:n,method:e,params:t||{}};a[n]={callback:s},p.postEvent("web_app_invoke_custom_method",!1,e)}window.Telegram||(window.Telegram={}),Object.defineProperty(s,"initData",{get:function(){return k},enumerable:!0}),Object.defineProperty(s,"initDataUnsafe",{get:function(){return B},enumerable:!0}),Object.defineProperty(s,"version",{get:function(){return u},enumerable:!0}),Object.defineProperty(s,"platform",{get:function(){return W},enumerable:!0}),Object.defineProperty(s,"colorScheme",{get:function(){return N},enumerable:!0}),Object.defineProperty(s,"themeParams",{get:function(){return g},enumerable:!0}),Object.defineProperty(s,"isExpanded",{get:function(){return K},enumerable:!0}),Object.defineProperty(s,"viewportHeight",{get:function(){return(!1===t?window.innerHeight:t)-C},enumerable:!0}),Object.defineProperty(s,"viewportStableHeight",{get:function(){return(!1===n?window.innerHeight:n)-C},enumerable:!0}),Object.defineProperty(s,"isClosingConfirmationEnabled",{set:function(e){e=e,d("6.2")?(Z=!!e,p.postEvent("web_app_setup_closing_behavior",!1,{need_confirmation:Z})):console.warn("[Telegram.WebApp] Closing confirmation is not supported in version "+u)},get:function(){return Z},enumerable:!0}),Object.defineProperty(s,"isVerticalSwipesEnabled",{set:function(e){e=e,d("7.7")?(Q=!!e,p.postEvent("web_app_setup_swipe_behavior",!1,{allow_vertical_swipe:Q})):console.warn("[Telegram.WebApp] Changing swipes behavior is not supported in version "+u)},get:function(){return Q},enumerable:!0}),Object.defineProperty(s,"headerColor",{set:function(e){if(d("6.1")){d("6.9")||(g.bg_color&&g.bg_color==e?e="bg_color":g.secondary_bg_color&&g.secondary_bg_color==e&&(e="secondary_bg_color"));var t=null,s=null;if("bg_color"==e||"secondary_bg_color"==e)s=e;else if(d("6.9")&&!(t=y(e)))throw console.error("[Telegram.WebApp] Header color format is invalid",e),Error("WebAppHeaderColorInvalid");if(!d("6.9")&&"bg_color"!=s&&"secondary_bg_color"!=s)throw console.error("[Telegram.WebApp] Header color key should be one of Telegram.WebApp.themeParams.bg_color, Telegram.WebApp.themeParams.secondary_bg_color, 'bg_color', 'secondary_bg_color'",e),Error("WebAppHeaderColorKeyInvalid");i=s,r=t,se()}else console.warn("[Telegram.WebApp] Header color is not supported in version "+u)},get:function(){return"secondary_bg_color"==i?g.secondary_bg_color:"bg_color"==i?g.bg_color:r},enumerable:!0}),Object.defineProperty(s,"backgroundColor",{set:function(e){var t;if(d("6.1")){if("bg_color"==e||"secondary_bg_color"==e)t=e;else if(!(t=y(e)))throw console.error("[Telegram.WebApp] Background color format is invalid",e),Error("WebAppBackgroundColorInvalid");ne=t,ae()}else console.warn("[Telegram.WebApp] Background color is not supported in version "+u)},get:ie,enumerable:!0}),Object.defineProperty(s,"BackButton",{value:U,enumerable:!0}),Object.defineProperty(s,"MainButton",{value:h,enumerable:!0}),Object.defineProperty(s,"SettingsButton",{value:me,enumerable:!0}),Object.defineProperty(s,"HapticFeedback",{value:Ge,enumerable:!0}),Object.defineProperty(s,"CloudStorage",{value:be,enumerable:!0}),Object.defineProperty(s,"BiometricManager",{value:ve,enumerable:!0}),s.setHeaderColor=function(e){s.headerColor=e},s.setBackgroundColor=function(e){s.backgroundColor=e},s.enableClosingConfirmation=function(){s.isClosingConfirmationEnabled=!0},s.disableClosingConfirmation=function(){s.isClosingConfirmationEnabled=!1},s.enableVerticalSwipes=function(){s.isVerticalSwipesEnabled=!0},s.disableVerticalSwipes=function(){s.isVerticalSwipesEnabled=!1},s.isVersionAtLeast=d,s.onEvent=function(e,t){X(e,t)},s.offEvent=function(e,t){q(e,t)},s.sendData=function(e){if(!e||!e.length)throw console.error("[Telegram.WebApp] Data is required",e),Error("WebAppDataInvalid");if(4096<(e=>{if(window.Blob)try{return new Blob([e]).size}catch(e){}for(var t=e.length,s=e.length-1;0<=s;s--){var n=e.charCodeAt(s);127<n&&n<=2047?t++:2047<n&&n<=65535&&(t+=2),56320<=n&&n<=57343&&s--}return t})(e))throw console.error("[Telegram.WebApp] Data is too long",e),Error("WebAppDataInvalid");p.postEvent("web_app_data_send",!1,{data:e})},s.switchInlineQuery=function(e,t){if(!d("6.6"))throw console.error("[Telegram.WebApp] Method switchInlineQuery is not supported in version "+u),Error("WebAppMethodUnsupported");if(!m.tgWebAppBotInline)throw console.error("[Telegram.WebApp] Inline mode is disabled for this bot. Read more about inline mode: https://core.telegram.org/bots/inline"),Error("WebAppInlineModeDisabled");if(256<(e=e||"").length)throw console.error("[Telegram.WebApp] Inline query is too long",e),Error("WebAppInlineQueryInvalid");var s=[];if(t){if(!Array.isArray(t))throw console.error("[Telegram.WebApp] Choose chat types should be an array",t),Error("WebAppInlineChooseChatTypesInvalid");for(var n={users:1,bots:1,groups:1,channels:1},i=0;i<t.length;i++){var r=t[i];if(!n[r])throw console.error("[Telegram.WebApp] Choose chat type is invalid",r),Error("WebAppInlineChooseChatTypeInvalid");2!=n[r]&&(n[r]=2,s.push(r))}}p.postEvent("web_app_switch_inline_query",!1,{query:e,chat_types:s})},s.openLink=function(e,t){var s=document.createElement("A");if(s.href=e,"http:"!=s.protocol&&"https:"!=s.protocol)throw console.error("[Telegram.WebApp] Url protocol is not supported",e),Error("WebAppTgUrlInvalid");e=s.href;t=t||{},d("6.1")?(s={url:e},d("6.4")&&t.try_instant_view&&(s.try_instant_view=!0),d("7.6")&&t.try_browser&&(s.try_browser=t.try_browser),p.postEvent("web_app_open_link",!1,s)):window.open(e,"_blank")},s.openTelegramLink=function(e){var t=document.createElement("A");if(t.href=e,"http:"!=t.protocol&&"https:"!=t.protocol)throw console.error("[Telegram.WebApp] Url protocol is not supported",e),Error("WebAppTgUrlInvalid");if("t.me"!=t.hostname)throw console.error("[Telegram.WebApp] Url host is not supported",e),Error("WebAppTgUrlInvalid");e=t.pathname+t.search;L||d("6.1")?p.postEvent("web_app_open_tg_link",!1,{path_full:e}):location.href="https://t.me"+e},s.openInvoice=function(e,t){var s,n=document.createElement("A");if(n.href=e,"http:"!=n.protocol&&"https:"!=n.protocol||"t.me"!=n.hostname||!(n=n.pathname.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/))||!(s=n[2]))throw console.error("[Telegram.WebApp] Invoice url is invalid",e),Error("WebAppInvoiceUrlInvalid");if(!d("6.1"))throw console.error("[Telegram.WebApp] Method openInvoice is not supported in version "+u),Error("WebAppMethodUnsupported");if(w[s])throw console.error("[Telegram.WebApp] Invoice is already opened"),Error("WebAppInvoiceOpened");w[s]={url:e,callback:t},p.postEvent("web_app_open_invoice",!1,{slug:s})},s.showPopup=function(e,t){if(!d("6.2"))throw console.error("[Telegram.WebApp] Method showPopup is not supported in version "+u),Error("WebAppMethodUnsupported");if(D)throw console.error("[Telegram.WebApp] Popup is already opened"),Error("WebAppPopupOpened");var s,n="",i=[],r={};if(void 0!==e.title){if(64<(s=f(e.title)).length)throw console.error("[Telegram.WebApp] Popup title is too long",s),Error("WebAppPopupParamInvalid");0<s.length&&(r.title=s)}if(!(n=void 0!==e.message?f(e.message):n).length)throw console.error("[Telegram.WebApp] Popup message is required",e.message),Error("WebAppPopupParamInvalid");if(256<n.length)throw console.error("[Telegram.WebApp] Popup message is too long",n),Error("WebAppPopupParamInvalid");if(r.message=n,void 0!==e.buttons){if(!Array.isArray(e.buttons))throw console.error("[Telegram.WebApp] Popup buttons should be an array",e.buttons),Error("WebAppPopupParamInvalid");for(var a=0;a<e.buttons.length;a++){var o=e.buttons[a],l={},h="";if(void 0!==o.id&&64<(h=o.id.toString()).length)throw console.error("[Telegram.WebApp] Popup button id is too long",h),Error("WebAppPopupParamInvalid");l.id=h;h=o.type;if("ok"!=(l.type=h=void 0===h?"default":h)&&"close"!=h&&"cancel"!=h){if("default"!=h&&"destructive"!=h)throw console.error("[Telegram.WebApp] Popup button type is invalid",h),Error("WebAppPopupParamInvalid");var c="";if(!(c=void 0!==o.text?f(o.text):c).length)throw console.error("[Telegram.WebApp] Popup button text is required for type "+h,o.text),Error("WebAppPopupParamInvalid");if(64<c.length)throw console.error("[Telegram.WebApp] Popup button text is too long",c),Error("WebAppPopupParamInvalid");l.text=c}i.push(l)}}else i.push({id:"",type:"close"});if(i.length<1)throw console.error("[Telegram.WebApp] Popup should have at least one button"),Error("WebAppPopupParamInvalid");if(3<i.length)throw console.error("[Telegram.WebApp] Popup should not have more than 3 buttons"),Error("WebAppPopupParamInvalid");r.buttons=i,D={callback:t},p.postEvent("web_app_open_popup",!1,r)},s.showAlert=function(e,t){s.showPopup({message:e},t?function(){t()}:null)},s.showConfirm=function(e,t){s.showPopup({message:e,buttons:[{type:"ok",id:"ok"},{type:"cancel"}]},t?function(e){t("ok"==e)}:null)},s.showScanQrPopup=function(e,t){if(!d("6.4"))throw console.error("[Telegram.WebApp] Method showScanQrPopup is not supported in version "+u),Error("WebAppMethodUnsupported");if(M)throw console.error("[Telegram.WebApp] Popup is already opened"),Error("WebAppScanQrPopupOpened");var s={};if(void 0!==e.text){if(64<(e=f(e.text)).length)throw console.error("[Telegram.WebApp] Scan QR popup text is too long",e),Error("WebAppScanQrPopupParamInvalid");0<e.length&&(s.text=e)}M={callback:t},p.postEvent("web_app_open_scan_qr_popup",!1,s)},s.closeScanQrPopup=function(){if(!d("6.4"))throw console.error("[Telegram.WebApp] Method closeScanQrPopup is not supported in version "+u),Error("WebAppMethodUnsupported");M=!1,p.postEvent("web_app_close_scan_qr_popup",!1)},s.readTextFromClipboard=function(e){if(!d("6.4"))throw console.error("[Telegram.WebApp] Method readTextFromClipboard is not supported in version "+u),Error("WebAppMethodUnsupported");var t=z(16),s={req_id:t};a[t]={callback:e},p.postEvent("web_app_read_text_from_clipboard",!1,s)},s.requestWriteAccess=function(e){if(!d("6.9"))throw console.error("[Telegram.WebApp] Method requestWriteAccess is not supported in version "+u),Error("WebAppMethodUnsupported");if(O)throw console.error("[Telegram.WebApp] Write access is already requested"),Error("WebAppWriteAccessRequested");O={callback:e},p.postEvent("web_app_request_write_access")},s.requestContact=function(e){if(!d("6.9"))throw console.error("[Telegram.WebApp] Method requestContact is not supported in version "+u),Error("WebAppMethodUnsupported");if(F)throw console.error("[Telegram.WebApp] Contact is already requested"),Error("WebAppContactRequested");F={callback:e},p.postEvent("web_app_request_phone")},s.shareToStory=function(e,t){if(t=t||{},!d("7.8"))throw console.error("[Telegram.WebApp] Method shareToStory is not supported in version "+u),Error("WebAppMethodUnsupported");var s=document.createElement("A");if(s.href=e,"http:"!=s.protocol&&"https:"!=s.protocol)throw console.error("[Telegram.WebApp] Media url protocol is not supported",e),Error("WebAppMediaUrlInvalid");e={};if(e.media_url=s.href,void 0!==t.text){var n=f(t.text);if(2048<n.length)throw console.error("[Telegram.WebApp] Text is too long",n),Error("WebAppShareToStoryParamInvalid");0<n.length&&(e.text=n)}if(void 0!==t.widget_link){if(t.widget_link=t.widget_link||{},s.href=t.widget_link.url,"http:"!=s.protocol&&"https:"!=s.protocol)throw console.error("[Telegram.WebApp] Link protocol is not supported",t.widget_link.url),Error("WebAppShareToStoryParamInvalid");n={url:s.href};if(void 0!==t.widget_link.name){s=f(t.widget_link.name);if(48<s.length)throw console.error("[Telegram.WebApp] Link name is too long",s),Error("WebAppShareToStoryParamInvalid");0<s.length&&(n.name=s)}e.widget_link=n}p.postEvent("web_app_share_to_story",!1,e)},s.invokeCustomMethod=function(e,t,s){xe(e,t,s)},s.ready=function(){p.postEvent("web_app_ready")},s.expand=function(){p.postEvent("web_app_expand")},s.close=function(e){e=e||{};var t={};d("7.6")&&e.return_back&&(t.return_back=!0),p.postEvent("web_app_close",!1,t)},window.Telegram.WebApp=s,se(),ae(),J(),m.tgWebAppShowSettings&&me.show(),window.addEventListener("resize",H),L&&document.addEventListener("click",function(e){if(!e.metaKey&&!e.ctrlKey){for(var t=e.target;"A"!=t.tagName&&t.parentNode;)t=t.parentNode;"A"!=t.tagName||"_blank"==t.target||"http:"!=t.protocol&&"https:"!=t.protocol||"t.me"!=t.hostname||(s.openTgLink(t.href),e.preventDefault())}}),p.onEvent("theme_changed",function(e,t){t.theme_params&&(Y(t.theme_params),window.Telegram.WebApp.MainButton.setParams({}),ae(),S("themeChanged"))}),p.onEvent("viewport_changed",function(e,t){t.height&&(window.removeEventListener("resize",H),J(t))}),p.onEvent("invoice_closed",function(e,t){var s;t.slug&&w[t.slug]&&(s=w[t.slug],delete w[t.slug],s.callback&&s.callback(t.status),S("invoiceClosed",{url:s.url,status:t.status}))}),p.onEvent("popup_closed",function(e,t){var s,n;D&&(s=D,D=!1,n=null,void 0!==t.button_id&&(n=t.button_id),s.callback&&s.callback(n),S("popupClosed",{button_id:n}))}),p.onEvent("qr_text_received",function(e,t){var s,n;M&&(s=M,n=null,void 0!==t.data&&(n=t.data),s.callback&&s.callback(n)&&(M=!1,p.postEvent("web_app_close_scan_qr_popup",!1)),S("qrTextReceived",{data:n}))}),p.onEvent("scan_qr_popup_closed",function(e,t){M=!1,S("scanQrPopupClosed")}),p.onEvent("clipboard_text_received",function(e,t){var s,n;t.req_id&&a[t.req_id]&&(s=a[t.req_id],delete a[t.req_id],n=null,void 0!==t.data&&(n=t.data),s.callback&&s.callback(n),S("clipboardTextReceived",{data:n}))}),p.onEvent("write_access_requested",function(e,t){var s;O&&(s=O,O=!1,s.callback&&s.callback("allowed"==t.status),S("writeAccessRequested",{status:t.status}))}),p.onEvent("phone_requested",function(e,t){var n,i,r,s,a,o,l;function h(){xe("getRequestedContact",{},function(e,t){t&&t.length?(clearTimeout(l),s(t)):(o+=50,a=setTimeout(h,o))})}F&&(n=F,F=!1,i="sent"==t.status,r={status:t.status},i?(s=function(e){if(e&&e.length)for(var t in r.response=e,r.responseUnsafe=c.urlParseQueryString(e),r.responseUnsafe){var s=r.responseUnsafe[t];try{("{"==s.substr(0,1)&&"}"==s.substr(-1)||"["==s.substr(0,1)&&"]"==s.substr(-1))&&(r.responseUnsafe[t]=JSON.parse(s))}catch(e){}}n.callback&&n.callback(i,r),S("contactRequested",r)},o=0,l=setTimeout(function(){clearTimeout(a),s("")},3e3),h()):(n.callback&&n.callback(i,r),S("contactRequested",r)))}),p.onEvent("custom_method_invoked",function(e,t){var s,n,i;t.req_id&&a[t.req_id]&&(s=a[t.req_id],delete a[t.req_id],i=n=null,void 0!==t.result&&(n=t.result),void 0!==t.error&&(i=t.error),s.callback)&&s.callback(i,n)}),p.postEvent("web_app_request_theme"),p.postEvent("web_app_request_viewport")})(),__toESM(require_adsgram_min())),API_BASE_URL,BOT_NAME,DEV_AUTH_ENABLED=!1,IMAGES_DOMAIN,UPGRADE_IMAGES_EXTENSION="gif",ADSGRAM_BLOCK_ID,ADSGRAM_DEBUG,LS_AUTH_TOKEN_KEY=("preview.construct.net"===window.location.host?(DEV_AUTH_ENABLED=!0,API_BASE_URL="https://api-test.tapmonsters.wombat.app",BOT_NAME="moritz_test_sw_bot",IMAGES_DOMAIN="staging.tapmonsters.wombat.app",ADSGRAM_BLOCK_ID="4567",ADSGRAM_DEBUG=!0):"staging.tapmonsters.wombat.app"===window.location.host?(API_BASE_URL="https://api-test.tapmonsters.wombat.app",BOT_NAME="moritz_test_sw_bot",IMAGES_DOMAIN="staging.tapmonsters.wombat.app",ADSGRAM_BLOCK_ID="4567",ADSGRAM_DEBUG=!0):"tapmonsters.wombat.app"===window.location.host&&(API_BASE_URL="https://api.tapmonsters.wombat.app",BOT_NAME="tapmonsters_bot",IMAGES_DOMAIN="tapmonsters.wombat.app",ADSGRAM_BLOCK_ID="4565",ADSGRAM_DEBUG=!1),"API_TOKEN"),token=null;function getToken(){return token}function setToken(e){token=e,localStorage.setItem(LS_AUTH_TOKEN_KEY,e)}function getInitData(){return window.Telegram.WebApp.initData}function getInitDataUnsafe(){return window.Telegram.WebApp.initDataUnsafe}function parseStartParams(e){return void 0===e?[]:e.split("-").map(e=>e.startsWith("ref")?{type:"ref",telegramUserId:parseInt(e.substring(3))}:e.startsWith("clan")?{type:"clan",clanSlug:e.substring(4)}:{type:"unknown",value:e})}var token=localStorage.getItem(LS_AUTH_TOKEN_KEY),startParams=parseStartParams(getInitDataUnsafe().start_param),queuedCalls=[];function dequeue(){if(0!==queuedCalls.length){const e=queuedCalls[0];e.call().then(e.onResolve).catch(e.onReject).finally(()=>{queuedCalls.shift(),dequeue()})}}function enqueue(s){return new Promise((e,t)=>{queuedCalls.push({call:s,onResolve:e,onReject:t}),1===queuedCalls.length&&dequeue()})}var API_VERSION="1.1.0",API_VERSION_HEADER="X-TM-Api-Version",API_BASE=API_BASE_URL,ResponseError=class extends Error{constructor(e,t,s,n){super(`Request to ${t} ${e} failed with status ${s} and code `+n),this.path=e,this.method=t,this.status=s,this.code=n}},ApiNotAvailableError=class extends Error{constructor(){super("The API is currently not available")}},UserBannedError=class extends Error{constructor(){super("The user is banned")}},tokenProvider,UpgradeCategory,TaskCategory,ClanRole,LoginStreakEntryState,TrainingSessionState,TrainingSessionMoveType,AdRewardType,AlertBoxColor;async function apiCall(e,t="GET",s=void 0,n={}){const i={...n},r=(i[API_VERSION_HEADER]=API_VERSION,"POST"!==t&&"PUT"!==t||(i["Content-Type"]="application/json"),await fetch(""+API_BASE+e,{method:t,headers:i,body:JSON.stringify(s)}).catch(()=>{throw new ApiNotAvailableError})),a=r.headers.get("Content-Type"),o="application/json"===a;if(399<r.status){if(503===r.status)throw new ApiNotAvailableError;if(o){const h=await r.json();if(410===r.status&&"OUTDATED_CLIENT"===h.code||403!==r.status||"USER_BANNED"!=h.code)throw new ResponseError(e,t,r.status,h.code);throw new UserBannedError}{const c=await r.text();throw new ResponseError(e,t,r.status,c)}}const l=r.headers.get(API_VERSION_HEADER);if(l!==API_VERSION&&console.warn("Backend has a different version. Backend %s, frontend %s",l,API_VERSION),o)return r.json();throw new Error("Expected JSON response but got "+a)}async function authenticatedApiCall(t,s="GET",n=void 0,i={}){let r=getToken();null===r&&(console.debug("Not logged in for authenticated call, executing login"),setToken(r=await tokenProvider.getToken()));try{const e={...i,Authorization:"Bearer "+r};return await apiCall(t,s,n,e)}catch(e){if(e instanceof ResponseError&&401==e.status){console.debug("Authenticated call returned 401, logging in again and retrying"),setToken(r=await tokenProvider.getToken());const a={...i,Authorization:"Bearer "+r};return apiCall(t,s,n,a)}throw e}}async function login(e){const t=await apiCall("/login","POST",{initData:e});return t.token}async function getMe(){return enqueue(()=>authenticatedApiCall("/me","POST"))}function sendTapBatch(e,t,s){return enqueue(()=>authenticatedApiCall("/batch-tap","POST",{taps:e,time:t.getTime(),currentEnergy:s}))}function buyUpgrade(e){return enqueue(()=>authenticatedApiCall("/upgrades","POST",{slug:e}))}function upgradeTapPower(){return enqueue(()=>authenticatedApiCall("/upgrades/tap-power","POST"))}function upgradeEnergyLevel(){return enqueue(()=>authenticatedApiCall("/upgrades/energy","POST"))}function verifyTelegramChannelJoin(){return enqueue(()=>authenticatedApiCall("/tg-channel/verify","POST"))}function getLeaderboard(e){const t=new URLSearchParams({score_type:e}).toString();return authenticatedApiCall("/leaderboard?"+t)}function getEarnTasks(){return authenticatedApiCall("/earn/tasks")}function startEarnTask(e){return enqueue(()=>authenticatedApiCall("/earn/start-task","POST",{slug:e}))}function verifyEarnTask(e){return enqueue(()=>authenticatedApiCall("/earn/verify-task","POST",{slug:e}))}function deleteNotification(e){return enqueue(()=>authenticatedApiCall("/notifications/"+e,"DELETE"))}function refillEnergy(){return enqueue(()=>authenticatedApiCall("/energy/refill","POST"))}function getReferralStats(){return authenticatedApiCall("/referrals/stats")}function initiateStarsPayment(e){return authenticatedApiCall("/purchase/initiate/stars","POST",{featureSlug:e})}function getLoginStreak(){return authenticatedApiCall("/login-streak")}function collectLoginStreakEntry(e){return authenticatedApiCall("/login-streak","POST",{number:e})}function getClanMembers(){return authenticatedApiCall("/clan/members")}function createClan(e){return enqueue(()=>authenticatedApiCall("/clan","POST",{name:e}))}function getClanBySlug(e){return authenticatedApiCall("/clan?slug="+e)}function joinClan(e){return enqueue(()=>authenticatedApiCall("/clan/join","POST",{initData:e}))}function leaveClan(){return enqueue(()=>authenticatedApiCall("/clan/leave","POST"))}async function requestAuthTokenByUsername(e){const t=await apiCall("/login/by-username","POST",{username:e});return t.token}async function startTrainingSession(e){return authenticatedApiCall("/training/start","POST",{monsterSlug:e})}async function executeTrainingMove(e,t,s){if(t<=0)throw new Error("Taps must be > 0");return authenticatedApiCall("/training/move","POST",{type:e,numberOfTaps:t,countedTaps:s})}async function cancelActiveTrainingSession(){await authenticatedApiCall("/training/cancel","POST")}async function partiallyHealMonster(e,t){return authenticatedApiCall(`/monsters/${e}/heal`,"POST",{type:"PARTIAL",numberOfTaps:t})}async function fullyHealMonster(e){return authenticatedApiCall(`/monsters/${e}/heal`,"POST",{type:"FULL"})}async function getAdUserStats(){return authenticatedApiCall("/adsgram/user-data")}async function initiateAdRewardDistribution(e){const t=await authenticatedApiCall("/adsgram/initiate-reward","POST",{reward:e});return t.id}async function distributeAdReward(e){await authenticatedApiCall(`/adsgram/reward/${e}/distribute`,"POST")}tokenProvider=DEV_AUTH_ENABLED?{getToken(){let e=localStorage.getItem("TM_LOCAL_USERNAME"),t;if(null!==(t=null==e?window.prompt("Your username?"):window.prompt("Your username?",e)))return localStorage.setItem("TM_LOCAL_USERNAME",t),requestAuthTokenByUsername(t);throw new Error("Username not provided, API call failed")}}:{getToken(){return login(getInitData())}},(e=>{e.LAB="LAB",e.EQUIPMENT="EQUIPMENT",e.PRODUCTS="PRODUCTS"})(UpgradeCategory=UpgradeCategory||{}),(e=>{e.REGULAR="REGULAR",e.DAILY="DAILY"})(TaskCategory=TaskCategory||{}),(e=>{e.MEMBER="MEMBER",e.LEADER="LEADER"})(ClanRole=ClanRole||{}),(e=>{e.COLLECTABLE="COLLECTABLE",e.COLLECTED="COLLECTED",e.NOT_COLLECTABLE="NOT_COLLECTABLE"})(LoginStreakEntryState=LoginStreakEntryState||{}),(e=>{e.BATTLING="BATTLING",e.PLAYER_WIN="PLAYER_WIN",e.OPPONENT_WIN="OPPONENT_WIN"})(TrainingSessionState=TrainingSessionState||{}),(e=>{e.ATTACK="ATTACK",e.BLOCK="BLOCK"})(TrainingSessionMoveType=TrainingSessionMoveType||{}),(AdRewardType=AdRewardType||{}).ENERGY_REFILL="ENERGY_REFILL",(e=>{e[e.RED=0]="RED",e[e.GREEN=1]="GREEN"})(AlertBoxColor=AlertBoxColor||{});var Game=class{constructor(e){this.runtime=e}showAlertboxMessage(e,t){this.runtime.callFunction("AlertBox",e,t)}},Boost=class{constructor(e,t,s){this.me=e,this.game=t,this.adsgram=s}async upgradeTapPower(){await upgradeTapPower().then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"ALREADY_AT_MAX_LEVEL":this.game.showAlertboxMessage("Tap power already maxed out",AlertBoxColor.RED);break;case"NOT_ENOUGH_SCORE":this.game.showAlertboxMessage("Not enough score",AlertBoxColor.RED);break;case"USER_LEVEL_NOT_MET":this.game.showAlertboxMessage("Dependency to buy not fulfilled",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error buying upgrade: "+e.code,AlertBoxColor.RED)}})}async refillEnergy(){await refillEnergy().then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"IN_COOLDOWN":this.game.showAlertboxMessage("Refill in cooldown",AlertBoxColor.RED);break;case"NO_MORE_REFILLS":this.game.showAlertboxMessage("No more refills left",AlertBoxColor.RED);break;case"GATE_NOT_FULFILLED":this.game.showAlertboxMessage("Dependency to recharge not fulfilled",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error buying upgrade: "+e.code,AlertBoxColor.RED)}})}async refillEnergyWithAd(){await this.adsgram.unlockWithAds({type:AdRewardType.ENERGY_REFILL});const e=await getMe();this.me.synchronizeMeWithGame(e.me)}async upgradeEnergyLevel(){await upgradeEnergyLevel().then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"ALREADY_AT_MAX_LEVEL":this.game.showAlertboxMessage("Energy already maxed out",AlertBoxColor.RED);break;case"NOT_ENOUGH_SCORE":this.game.showAlertboxMessage("Not enough score",AlertBoxColor.RED);break;case"USER_LEVEL_NOT_MET":this.game.showAlertboxMessage("Dependency to recharge not fulfilled",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error buying upgrade: "+e.code,AlertBoxColor.RED)}})}},Clan=class{constructor(e,t,s){this.runtime=e,this.me=t,this.game=s}async createClan(e){await createClan(e).then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"NOT_ENOUGH_SCORE":this.game.showAlertboxMessage("Not enough score",AlertBoxColor.RED);break;case"ALREADY_CLAN_MEMBER":this.game.showAlertboxMessage("Already in a clan",AlertBoxColor.RED);break;case"INVALID_NAME":this.game.showAlertboxMessage("Clan name not valid",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error creating clan: "+e.code,AlertBoxColor.RED)}})}async leaveClan(){await leaveClan().then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{e instanceof ResponseError&&("NOT_IN_CLAN"===e.code?this.game.showAlertboxMessage("Not in a clan",AlertBoxColor.RED):this.game.showAlertboxMessage("Unknown error leaving clan: "+e.code,AlertBoxColor.RED))})}async joinClan(){await joinClan(getInitData()).then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"ALREADY_CLAN_MEMBER":this.game.showAlertboxMessage("Already in a clan",AlertBoxColor.RED);break;case"INVALID_INIT_DATA":this.game.showAlertboxMessage("Invalid clan invite",AlertBoxColor.RED);break;case"CLAN_FULL":this.game.showAlertboxMessage("Clan already full",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error joining clan: "+e.code,AlertBoxColor.RED)}})}async loadClanMembers(){if(null!==this.me.data.clanMembership){const e=await getClanMembers(),t=this.runtime.objects.clanMembers.getFirstInstance();if(null===t)throw new Error('No instance of "clanMembersInstance" object found - cannot set data');t.setJsonDataCopy(e)}}},Me=class _Me{constructor(e,t){this.runtime=e,this.data=t}synchronizeMeWithGame(e){void 0!==e&&(this.data=e);const t=this.runtime.objects.me.getFirstInstance();if(null===t)throw new Error('No instance of "me" object found - cannot set data');{const s=this.data;null!==s.energy.refill.coolDownReset?s.energy.refill.coolDownResetMillis=new Date(s.energy.refill.coolDownReset).getTime():s.energy.refill.coolDownResetMillis=null,t.setJsonDataCopy(s),this.runtime.signal(_Me.ME_UPDATED_SIGNAL_TAG)}}async loadReferrals(){const e=await getReferralStats(),t=this.runtime.objects.referrals.getFirstInstance();if(null===t)throw new Error('No instance of "referralsInstance" object found - cannot set data');t.setJsonDataCopy(e.referrals)}async verifyTelegramChannelJoin(){const e=await verifyTelegramChannelJoin();this.synchronizeMeWithGame(e.me)}},Notification=(Me.ME_UPDATED_SIGNAL_TAG="MeUpdated",class{constructor(e){this.me=e}async deleteNotification(e){const t=await deleteNotification(e);this.me.synchronizeMeWithGame(t.me)}});function booleanToString(e){return e?"true":"false"}var Tasks=class{constructor(e,t,s){this.runtime=e,this.me=t,this.game=s}async createTaskData(){const e=await getEarnTasks();this.runtime.objects.TaskData.getAllInstances().forEach(e=>e.destroy()),e.tasks.forEach(e=>{const t=this.runtime.objects.TaskData.createInstance(0,0,0,!1),s=t.getDataMap(),n=(s.set("cta",e.linkCtaText),s.set("link",e.link),s.set("text",e.text),e.verifiableAt&&(s.set("verifiableAt",e.verifiableAt),s.set("verifiableAtMillis",new Date(e.verifiableAt).getTime())),`+${Math.floor(e.score/1e3)}k`);s.set("score",n),s.set("imageUrl",`https://${IMAGES_DOMAIN}/img/tasks/${e.slug}.png`),s.set("done",booleanToString(e.done)),s.set("category",e.category),t.instVars.slug=e.slug})}async startEarnTask(n){await startEarnTask(n).then(s=>{this.runtime.objects.TaskData.getAllInstances().forEach(e=>{if(e.instVars.slug===n){const t=e.getDataMap();s.task.verifiableAt&&(t.set("verifiableAt",s.task.verifiableAt),t.set("verifiableAtMillis",new Date(s.task.verifiableAt).getTime()))}})}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"ALREADY STARTED":this.game.showAlertboxMessage("The task was already started",AlertBoxColor.RED);break;case"ALREADY DONE":this.game.showAlertboxMessage("The task was already completed",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error verifying task: "+e.code,AlertBoxColor.RED)}})}async verifyEarnTask(s){await verifyEarnTask(s).then(t=>{this.runtime.objects.TaskData.getAllInstances().forEach(e=>{e.instVars.slug===s&&(e.getDataMap().set("verifiableAt",t.task.verifiableAt||""),e.getDataMap().set("done",booleanToString(t.task.done)))}),this.me.data.score.current+=t.task.score,this.me.data.scores.main.current+=t.task.score,this.me.synchronizeMeWithGame()}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"ALREADY DONE":this.game.showAlertboxMessage("The task was already completed",AlertBoxColor.RED);break;case"NOT_STARTED_YET":this.game.showAlertboxMessage("The task has not been started",AlertBoxColor.RED);break;case"NOT_VERIFIABLE_YET":this.game.showAlertboxMessage("The task is not verifiable yet",AlertBoxColor.RED);break;case"NOT_IN_GROUP":this.game.showAlertboxMessage("Not joined to the Telegram group",AlertBoxColor.RED);break;case"WOMBAT_NOT_CONNECTED":this.game.showAlertboxMessage("Not connected to Wombat",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error verifying task: "+e.code,AlertBoxColor.RED)}})}async loadLoginStreak(){const e=await getLoginStreak(),t=this.runtime.objects.loginstreak.getFirstInstance();if(null===t)throw new Error('No instance of "loginStreakInstance" object found - cannot set data');t.setJsonDataCopy(e)}async collectLoginStreak(t){await collectLoginStreakEntry(t).then(e=>{const t=this.runtime.objects.loginstreak.getFirstInstance();if(null===t)throw new Error('No instance of "loginStreakInstance" object found - cannot set data');t.setJsonDataCopy(e.loginStreak),this.me.data.score.current+=e.scoreIncrease,this.me.data.scores.main.current+=e.scoreIncrease,this.me.synchronizeMeWithGame()}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"ALREADY_COLLECTED":this.game.showAlertboxMessage(`Streak ${t} was already collected`,AlertBoxColor.RED);break;case"NOT_COLLECTABLE":this.game.showAlertboxMessage(`Streak ${t} not collectable`,AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error collecting streak: "+e.code,AlertBoxColor.RED)}})}},Upgrades=class{constructor(e,t){this.me=e,this.game=t}async buyUpgrade(e){await buyUpgrade(e).then(e=>{this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"NOT_ENOUGH_SCORE":this.game.showAlertboxMessage("Not enough score",AlertBoxColor.RED);break;case"CONCURRENT_BUY":this.game.showAlertboxMessage("Not so fast...",AlertBoxColor.RED);break;case"GATE_NOT_FULFILLED":this.game.showAlertboxMessage("Dependency to buy not fulfilled",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error buying upgrade: "+e.code,AlertBoxColor.RED)}})}},Crystal=class _Crystal{constructor(e,t,s){this.runtime=e,this.me=t,this.game=s,this.currentTaps=0,this.batchTapTimeout=void 0}registerTap(){void 0!==this.batchTapTimeout&&(clearTimeout(this.batchTapTimeout),this.batchTapTimeout=void 0),window.Telegram.WebApp.HapticFeedback.impactOccurred("medium"),this.currentTaps++,this.batchTapTimeout=setTimeout(()=>this.sendCurrentTaps(),_Crystal.BATCH_TAP_TIMEOUT_MS)}async sendCurrentTaps(){if(0!==this.currentTaps){this.batchTapTimeout=void 0;const e=new Date,t=this.runtime.globalVars.energy;await sendTapBatch(this.currentTaps,e,t).then(e=>{this.runtime.signal(_Crystal.BATCH_TAP_SENT_SIGNAL_TAG),this.me.synchronizeMeWithGame(e.me)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"BATCH_IN_FUTURE":this.game.showAlertboxMessage("Device time out of sync",AlertBoxColor.RED);break;case"NOT_ENOUGH_ENERGY":this.game.showAlertboxMessage("Not enough energy for so many taps",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage("Unknown error tapping: "+e.code,AlertBoxColor.RED)}}),this.currentTaps=0}}},Leaderboards=(Crystal.BATCH_TAP_SENT_SIGNAL_TAG="BatchTapSent",Crystal.BATCH_TAP_TIMEOUT_MS=3e3,class{constructor(e){this.runtime=e}async loadLeaderboard(e){const t=await getLeaderboard(e||"main"),s=this.runtime.objects.leaderboard.getFirstInstance();if(null==s)throw new Error('No instance of "leaderboard" object found - cannot set data');s.setJsonDataCopy(t)}}),TelegramAdapter=class _TelegramAdapter{constructor(e){this.me=e}readyAndExpand(){window.Telegram.WebApp.ready(),window.Telegram.WebApp.isExpanded||window.Telegram.WebApp.expand()}openLink(e){e.startsWith("https://t.me")?window.Telegram.WebApp.openTelegramLink(e):e===_TelegramAdapter.CONNECT_WOMBAT_LINK_VALUE?window.Telegram.WebApp.openLink(generateLinkWombatLink(getInitData())):window.Telegram.WebApp.openLink(e)}inviteFriend(){let e=new URLSearchParams({url:this.getReferralLink()}).toString();e+="&text=Join me at N-Corp to advance Chainmons research and tap our way into a $MONSTER airdrop!",window.Telegram.WebApp.openTelegramLink("https://t.me/share/url?"+e)}getReferralLink(){const e=BOT_NAME,t="ref"+this.me.data.telegramId;return`https://t.me/${e}/start?startapp=${t}&startApp=`+t}getClanInviteLink(){if(null===this.me.data.clanMembership)throw new Error("User is not in a clan, cannot create invite link");{const e=`ref${this.me.data.telegramId}-clan`+this.me.data.clanMembership.slug,t=BOT_NAME,s=`startapp=${e}&startApp=`+e;return`https://t.me/${t}/start?`+s}}inviteToClan(){let e=new URLSearchParams({url:this.getClanInviteLink()}).toString();e+="&text=Join my clan!",window.Telegram.WebApp.openTelegramLink("https://t.me/share/url?"+e)}async buyFeatureWithStars(e){const t=await initiateStarsPayment(e),s=(await this.openInvoice(t.invoiceUrl),await getMe());this.me.synchronizeMeWithGame(s.me)}async openInvoice(e){return new Promise((t,s)=>{window.Telegram.WebApp.openInvoice(e,e=>{"paid"===e?setTimeout(()=>t(),333):"failed"===e?s(new Error("Payment failed")):"cancelled"===e&&s(new Error("Payment was cancelled"))})})}};function generateLinkWombatLink(e){const t=new URLSearchParams({initData:encodeURIComponent(btoa(e))}),s=new URL("https://womplay.io/tapmonsters/link_wombat.html?"+t.toString()).toString(),n=new URLSearchParams({url:s.toString()}),i=new URL("https://app.getwombat.io/dapp-view?"+n.toString()).toString(),r=new URLSearchParams({apn:"io.getwombat.android",ibi:"io.getwombat.ios",isi:"1474392110",link:i,ofl:i});return"https://go.getwombat.io/?"+r.toString()}TelegramAdapter.CONNECT_WOMBAT_LINK_VALUE="CONNECT_WOMBAT_WALLET_DEEP_LINK";var Images=class{getUpgradeImageUrl(e){return`https://${IMAGES_DOMAIN}/img/icon_${e}.`+UPGRADE_IMAGES_EXTENSION}getMonsterImageUrl(e){return`https://${IMAGES_DOMAIN}/img/monsters/${e}.png`}getMonsterBackImageUrl(e){return`https://${IMAGES_DOMAIN}/img/monsters/back/${e}_back.png`}},Training=class{constructor(e,t){this.runtime=e,this.me=t}async startTraining(e){const t=await startTrainingSession(e),s=this.runtime.objects.MonsterTraining.getFirstInstance();if(null==s)throw new Error("Training instance is not available");let n={PlayerMonsterID:t.player.monster.slug,BattleStatus:"battling",OpponentMonsterID:t.opponent.monster.slug,OpponentHP:t.opponent.monster.health,OpponentMaxHP:t.opponent.monster.maxHealth,OpponentAgility:t.opponent.monster.agility,OpponentLevel:t.opponent.monster.level,OpponentPotential:t.opponent.monster.potential,OpponentAttackPower:t.opponent.monster.maxAttackPower,OpponentDefense:t.opponent.monster.maxDefense,PlayerHP:t.player.monster.health,PlayerMaxHP:t.player.monster.maxHealth,PlayerAgility:t.player.monster.agility,OpponentAction:null,NextOpponentAction:t.opponent.move.type.toLowerCase(),CoinsEarned:0,EXPEarned:0,PlayerFirstAction:0,PlayerDamageDealt:null,OpponentDamageDealt:null,PlayerEnergy:t.player.maxEnergy,PlayerMaxAttackPower:t.player.monster.maxAttackPower,PlayerMaxDefense:t.player.monster.maxDefense};s.setJsonDataCopy(n)}async executeMove(e,t,s){const n=await executeTrainingMove(e,t,s),i=this.runtime.objects.MonsterTraining.getFirstInstance();if(null==i)throw new Error("Training instance is not available");const r=i.getJsonDataCopy(),a={...r,BattleStatus:n.newStatus.toLowerCase(),OpponentHP:n.opponent.monster.health,PlayerHP:n.player.monster.health,OpponentAction:r.NextOpponentAction,NextOpponentAction:n.opponent.nextMove.type.toLowerCase(),PlayerFirstAction:n.playerFirstAction?1:0,PlayerDamageDealt:n.player.monster.damageDealt,OpponentDamageDealt:n.opponent.monster.damageDealt,PlayerEnergy:n.player.energy,CoinsEarned:n.scoreEarned,EXPEarned:n.newStatus===TrainingSessionState.PLAYER_WIN?.1:0};i.setJsonDataCopy(a),n.newStatus!==TrainingSessionState.BATTLING&&(this.me.data.scores.main.current+=n.scoreEarned,this.me.data.scores.main.lifetime+=n.scoreEarned,this.me.data.monsters.forEach(e=>{e.slug===r.PlayerMonsterID&&(e.stats.health=n.player.monster.health)}),this.me.synchronizeMeWithGame())}async cancelSession(){await cancelActiveTrainingSession()}async partiallyHealMonster(e,t){const s=await partiallyHealMonster(e,t);for(const n of this.me.data.monsters)if(n.slug===s.monsterSlug){n.stats.health=s.newMonsterHealth;break}this.me.data.energy.amount=s.newPlayerEnergy,this.me.synchronizeMeWithGame()}async fullyHealMonster(e){const t=await fullyHealMonster(e);for(const s of this.me.data.monsters)if(s.slug===t.monsterSlug){s.stats.health=t.newMonsterHealth;break}this.me.data.energy.amount=t.newPlayerEnergy,this.me.synchronizeMeWithGame()}},Adsgram=class{constructor(e,t){this.runtime=e,this.game=t,this.controller=window.Adsgram.init({blockId:ADSGRAM_BLOCK_ID,debug:ADSGRAM_DEBUG}),this.controller.addEventListener("onStart",()=>{console.debug("Ad started")}),this.controller.addEventListener("onError",()=>{console.debug("Error during ad")}),this.controller.addEventListener("onSkip",()=>{console.debug("User skipped ad")}),this.controller.addEventListener("onReward",()=>{console.debug("Ad watched till end")}),this.refreshUserData()}async refreshUserData(){let e=await getAdUserStats(),t=null;null!==e.adCooldownReset&&(t=new Date(e.adCooldownReset).getTime());const s=this.runtime.objects.adsgram.getFirstInstance();if(null===s)throw new Error(`No "adsgram" instance available, can't set data`);s.setJsonDataCopy({...e,adCooldownResetMillis:t})}async unlockWithAds(e){await initiateAdRewardDistribution(e).then(async e=>{this.refreshUserData(),await this.showAd(),await distributeAdReward(e)}).catch(e=>{if(e instanceof ResponseError)switch(e.code){case"TOO_MANY_ADS_TODAY":this.game.showAlertboxMessage("Ad reward limit reached",AlertBoxColor.RED);break;case"AD_REQUESTED_TOO_FAST":this.game.showAlertboxMessage("Have to wait 5 minutes between ads",AlertBoxColor.RED);break;case"REWARD_DISTRIBUTION_ALREADY_FULFILLED":this.game.showAlertboxMessage("Reward already claimed",AlertBoxColor.RED);break;default:this.game.showAlertboxMessage(`Unknown error buying upgrade: ${e.code} (${e.status})`,AlertBoxColor.RED)}})}async showAd(){try{const e=await this.controller.show();e.done||e.error&&this.game.showAlertboxMessage("Error after ad: "+e.description,AlertBoxColor.RED)}catch(e){if(console.error("Error showing ad",e),e instanceof Error)this.game.showAlertboxMessage("Ad failed: "+e.message,AlertBoxColor.RED);else if("object"==typeof e&&null!==e&&"done"in e){const t=e;this.game.showAlertboxMessage("Ad failed: "+t.description,AlertBoxColor.RED)}else this.game.showAlertboxMessage("Ad failed (check console)",AlertBoxColor.RED)}}},backend,Backend=class{constructor(e,t){this.runtime=e,this.me=new Me(this.runtime,t),this.game=new Game(this.runtime),this.tasks=new Tasks(this.runtime,this.me,this.game),this.upgrades=new Upgrades(this.me,this.game),this.crystal=new Crystal(this.runtime,this.me,this.game),this.ads=new Adsgram(this.runtime,this.game),this.boost=new Boost(this.me,this.game,this.ads),this.clan=new Clan(this.runtime,this.me,this.game),this.notification=new Notification(this.me),this.leaderboards=new Leaderboards(this.runtime),this.telegram=new TelegramAdapter(this.me),this.images=new Images,this.training=new Training(this.runtime,this.me)}onBeforeProjectStart(){this.me.synchronizeMeWithGame(),this.handleClanInvite()}handleClanInvite(){const s=startParams.find(e=>"clan"===e.type);void 0!==s&&null===this.me.data.clanMembership&&getClanBySlug(s.clanSlug).then(e=>{const t=this.runtime.objects.clanInvite.getFirstInstance();if(null===t)throw new Error('No instance of "clanInvite" object found - cannot set data');t.setJsonDataCopy({slug:s.clanSlug,name:e.name,memberCount:e.memberCount,memberLimit:e.memberLimit}),this.runtime.signal("ClanInviteReceived")}).catch(e=>{console.error("Error loading clan data for clan "+s.clanSlug,e)})}};function initializeBackend(e,t){(backend=new Backend(e,t)).telegram.readyAndExpand()}async function OnBeforeProjectStart(e){backend.onBeforeProjectStart(),e.addEventListener("tick",()=>Tick(e))}function Tick(e){}runOnStartup(async e=>{try{const t=await getMe();initializeBackend(e,t.me)}catch(e){if(e instanceof ResponseError&&401===e.status&&DEV_AUTH_ENABLED){let e=localStorage.getItem("TM_LOCAL_USERNAME"),t;if(null===(t=null==e?window.prompt("Your username?"):window.prompt("Your username?",e)))throw new Error("Username not provided, cannot start Tapmonsters");localStorage.setItem("TM_LOCAL_USERNAME",t),await requestAuthTokenByUsername(t),await getMe()}}e.addEventListener("beforeprojectstart",()=>OnBeforeProjectStart(e))});var PlayFab=void 0!==PlayFab?PlayFab:{},PlayFabClientSDK=(PlayFab.settings||(PlayFab.settings={titleId:null,developerSecretKey:null,advertisingIdType:null,advertisingIdValue:null,GlobalHeaderInjection:null,disableAdvertising:!1,AD_TYPE_IDFA:"Idfa",AD_TYPE_ANDROID_ID:"Adid",productionServerUrl:".playfabapi.com"}),PlayFab._internalSettings||(PlayFab._internalSettings={entityToken:null,sdkVersion:"1.84.210406",requestGetParams:{sdk:"JavaScriptSDK-1.84.210406"},sessionTicket:null,verticalName:null,errorTitleId:"Must be have PlayFab.settings.titleId set to call this method",errorLoggedIn:"Must be logged in to call this method",errorEntityToken:"You must successfully call GetEntityToken before calling this",errorSecretKey:"Must have PlayFab.settings.developerSecretKey set to call this method",GetServerUrl:function(){return"http"!==PlayFab.settings.productionServerUrl.substring(0,4)?PlayFab._internalSettings.verticalName?"https://"+PlayFab._internalSettings.verticalName+PlayFab.settings.productionServerUrl:"https://"+PlayFab.settings.titleId+PlayFab.settings.productionServerUrl:PlayFab.settings.productionServerUrl},InjectHeaders:function(e,t){if(t)for(var s in t)try{e.setRequestHeader(gHeaderKey,t[s])}catch(e){console.log("Failed to append header: "+s+" = "+t[s]+"Error: "+e)}},ExecuteRequest:function(c,u,d,_,p,m,g){return new Promise(function(t,s){if(null!=p&&"function"!=typeof p)throw"Callback must be null or a function";null==u&&(u={});var n=new Date,e=JSON.stringify(u),i=[c],r=PlayFab._internalSettings.requestGetParams;if(null!=r){var a,o=!0;for(a in r)o?(i.push("?"),o=!1):i.push("&"),i.push(a),i.push("="),i.push(r[a])}var l=i.join(""),h=new XMLHttpRequest;h.open("POST",l,!0),h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("X-PlayFabSDK","JavaScriptSDK-"+PlayFab._internalSettings.sdkVersion),null!=d&&h.setRequestHeader(d,_),PlayFab._internalSettings.InjectHeaders(h,PlayFab.settings.GlobalHeaderInjection),PlayFab._internalSettings.InjectHeaders(h,g),h.onloadend=function(){var e;null!=p&&(200===(e=PlayFab._internalSettings.GetPlayFabResponse(u,h,n,m)).code?p(e,null):p(null,e))},h.onerror=function(){var e;null!=p&&(e=PlayFab._internalSettings.GetPlayFabResponse(u,h,n,m),p(null,e))},h.send(e),h.onreadystatechange=function(){var e;4===this.readyState&&(e=PlayFab._internalSettings.GetPlayFabResponse(u,this,n,m),(200===this.status?t:s)(e))}})},GetPlayFabResponse:function(e,t,s,n){var i=null;try{i=JSON.parse(t.responseText)}catch(e){i={code:503,status:"Service Unavailable",error:"Connection error",errorCode:2,errorMessage:t.responseText}}return i.CallBackTimeMS=new Date-s,i.Request=e,i.CustomData=n,i},authenticationContext:{PlayFabId:null,EntityId:null,EntityType:null,SessionTicket:null,EntityToken:null},UpdateAuthenticationContext:function(e,t){var s={};return null!==t.data.PlayFabId&&(PlayFab._internalSettings.authenticationContext.PlayFabId=t.data.PlayFabId,s.PlayFabId=t.data.PlayFabId),null!==t.data.SessionTicket&&(PlayFab._internalSettings.authenticationContext.SessionTicket=t.data.SessionTicket,s.SessionTicket=t.data.SessionTicket),null!==t.data.EntityToken&&(PlayFab._internalSettings.authenticationContext.EntityId=t.data.EntityToken.Entity.Id,s.EntityId=t.data.EntityToken.Entity.Id,PlayFab._internalSettings.authenticationContext.EntityType=t.data.EntityToken.Entity.Type,s.EntityType=t.data.EntityToken.Entity.Type,PlayFab._internalSettings.authenticationContext.EntityToken=t.data.EntityToken.EntityToken,s.EntityToken=t.data.EntityToken.EntityToken),e=Object.assign(e,s)},AuthInfoMap:{"X-EntityToken":{authAttr:"entityToken",authError:"errorEntityToken"},"X-Authorization":{authAttr:"sessionTicket",authError:"errorLoggedIn"},"X-SecretKey":{authAttr:"developerSecretKey",authError:"errorSecretKey"}},GetAuthInfo:function(e,t){var s=PlayFab._internalSettings.AuthInfoMap[t].authError,n=PlayFab._internalSettings.AuthInfoMap[t].authAttr,i=null;return"entityToken"===n?i=PlayFab._internalSettings.entityToken:"sessionTicket"===n?i=PlayFab._internalSettings.sessionTicket:"developerSecretKey"===n&&(i=PlayFab.settings.developerSecretKey),{authKey:t,authValue:e.AuthenticationContext?e.AuthenticationContext[n]:i,authError:s}},ExecuteRequestWrapper:function(e,t,s,n,i,r){var a=null;if(null!==s){var o=PlayFab._internalSettings.GetAuthInfo(t,s),s=o.authKey;if(!(a=o.authValue))throw o.authError}return PlayFab._internalSettings.ExecuteRequest(PlayFab._internalSettings.GetServerUrl()+e,t,s,a,n,i,r)}}),PlayFab.buildIdentifier="jbuild_javascriptsdk_sdk-generic-3_1",PlayFab.sdkVersion="1.84.210406",PlayFab.GenerateErrorReport=function(e){if(null==e)return"";var t,s=e.errorMessage;for(t in e.errorDetails)for(var n in e.errorDetails[t])s+="\n"+t+": "+e.errorDetails[t][n];return s},PlayFab.ClientApi={WritePlayerEvent:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/WritePlayerEvent",e,"X-Authorization",t,s,n)},WritePlayerEvent:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/WritePlayerEvent",e,"X-Authorization",t,s,n)},ExecuteFunction:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/CloudScript/ExecuteFunction",e,"X-EntityToken",t,s,n)},IsClientLoggedIn:function(){return null!=PlayFab._internalSettings.sessionTicket&&0<PlayFab._internalSettings.sessionTicket.length},ForgetAllCredentials:function(){PlayFab._internalSettings.sessionTicket=null,PlayFab._internalSettings.entityToken=null},AcceptTrade:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AcceptTrade",e,"X-Authorization",t,s,n)},AddFriend:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AddFriend",e,"X-Authorization",t,s,n)},AddGenericID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AddGenericID",e,"X-Authorization",t,s,n)},AddOrUpdateContactEmail:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AddOrUpdateContactEmail",e,"X-Authorization",t,s,n)},AddSharedGroupMembers:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AddSharedGroupMembers",e,"X-Authorization",t,s,n)},AddUsernamePassword:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AddUsernamePassword",e,"X-Authorization",t,s,n)},AddUserVirtualCurrency:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AddUserVirtualCurrency",e,"X-Authorization",t,s,n)},AndroidDevicePushNotificationRegistration:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AndroidDevicePushNotificationRegistration",e,"X-Authorization",t,s,n)},AttributeInstall:function(e,s,t,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/AttributeInstall",e,"X-Authorization",function(e,t){PlayFab.settings.advertisingIdType+="_Successful",null!=s&&"function"==typeof s&&s(e,t)},t,n)},CancelTrade:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/CancelTrade",e,"X-Authorization",t,s,n)},ConfirmPurchase:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ConfirmPurchase",e,"X-Authorization",t,s,n)},ConsumeItem:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ConsumeItem",e,"X-Authorization",t,s,n)},ConsumeMicrosoftStoreEntitlements:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ConsumeMicrosoftStoreEntitlements",e,"X-Authorization",t,s,n)},ConsumePS5Entitlements:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ConsumePS5Entitlements",e,"X-Authorization",t,s,n)},ConsumePSNEntitlements:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ConsumePSNEntitlements",e,"X-Authorization",t,s,n)},ConsumeXboxEntitlements:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ConsumeXboxEntitlements",e,"X-Authorization",t,s,n)},CreateSharedGroup:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/CreateSharedGroup",e,"X-Authorization",t,s,n)},ExecuteCloudScript:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ExecuteCloudScript",e,"X-Authorization",t,s,n)},GetAccountInfo:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetAccountInfo",e,"X-Authorization",t,s,n)},GetAdPlacements:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetAdPlacements",e,"X-Authorization",t,s,n)},GetAllUsersCharacters:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetAllUsersCharacters",e,"X-Authorization",t,s,n)},GetCatalogItems:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCatalogItems",e,"X-Authorization",t,s,n)},GetCharacterData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCharacterData",e,"X-Authorization",t,s,n)},GetCharacterInventory:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCharacterInventory",e,"X-Authorization",t,s,n)},GetCharacterLeaderboard:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCharacterLeaderboard",e,"X-Authorization",t,s,n)},GetCharacterReadOnlyData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCharacterReadOnlyData",e,"X-Authorization",t,s,n)},GetCharacterStatistics:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCharacterStatistics",e,"X-Authorization",t,s,n)},GetContentDownloadUrl:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetContentDownloadUrl",e,"X-Authorization",t,s,n)},GetCurrentGames:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetCurrentGames",e,"X-Authorization",t,s,n)},GetFriendLeaderboard:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetFriendLeaderboard",e,"X-Authorization",t,s,n)},GetFriendLeaderboardAroundPlayer:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetFriendLeaderboardAroundPlayer",e,"X-Authorization",t,s,n)},GetFriendsList:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetFriendsList",e,"X-Authorization",t,s,n)},GetGameServerRegions:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetGameServerRegions",e,"X-Authorization",t,s,n)},GetLeaderboard:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetLeaderboard",e,"X-Authorization",t,s,n)},GetLeaderboardAroundCharacter:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetLeaderboardAroundCharacter",e,"X-Authorization",t,s,n)},GetLeaderboardAroundPlayer:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetLeaderboardAroundPlayer",e,"X-Authorization",t,s,n)},GetLeaderboardForUserCharacters:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetLeaderboardForUserCharacters",e,"X-Authorization",t,s,n)},GetPaymentToken:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPaymentToken",e,"X-Authorization",t,s,n)},GetPhotonAuthenticationToken:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPhotonAuthenticationToken",e,"X-Authorization",t,s,n)},GetPlayerCombinedInfo:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerCombinedInfo",e,"X-Authorization",t,s,n)},GetPlayerProfile:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerProfile",e,"X-Authorization",t,s,n)},GetPlayerSegments:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerSegments",e,"X-Authorization",t,s,n)},GetPlayerStatistics:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerStatistics",e,"X-Authorization",t,s,n)},GetPlayerStatisticVersions:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerStatisticVersions",e,"X-Authorization",t,s,n)},GetPlayerTags:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerTags",e,"X-Authorization",t,s,n)},GetPlayerTrades:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayerTrades",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromFacebookIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromFacebookIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromFacebookInstantGamesIds:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromFacebookInstantGamesIds",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromGameCenterIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromGameCenterIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromGenericIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromGenericIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromGoogleIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromGoogleIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromKongregateIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromKongregateIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromNintendoSwitchDeviceIds:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromNintendoSwitchDeviceIds",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromPSNAccountIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromPSNAccountIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromSteamIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromSteamIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromTwitchIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromTwitchIDs",e,"X-Authorization",t,s,n)},GetPlayFabIDsFromXboxLiveIDs:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPlayFabIDsFromXboxLiveIDs",e,"X-Authorization",t,s,n)},GetPublisherData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPublisherData",e,"X-Authorization",t,s,n)},GetPurchase:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetPurchase",e,"X-Authorization",t,s,n)},GetSharedGroupData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetSharedGroupData",e,"X-Authorization",t,s,n)},GetStoreItems:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetStoreItems",e,"X-Authorization",t,s,n)},GetTime:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetTime",e,"X-Authorization",t,s,n)},GetTitleData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetTitleData",e,"X-Authorization",t,s,n)},GetTitleNews:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetTitleNews",e,"X-Authorization",t,s,n)},GetTitlePublicKey:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetTitlePublicKey",e,null,t,s,n)},GetTradeStatus:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetTradeStatus",e,"X-Authorization",t,s,n)},GetUserData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetUserData",e,"X-Authorization",t,s,n)},GetUserInventory:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetUserInventory",e,"X-Authorization",t,s,n)},GetUserPublisherData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetUserPublisherData",e,"X-Authorization",t,s,n)},GetUserPublisherReadOnlyData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetUserPublisherReadOnlyData",e,"X-Authorization",t,s,n)},GetUserReadOnlyData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetUserReadOnlyData",e,"X-Authorization",t,s,n)},GetWindowsHelloChallenge:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GetWindowsHelloChallenge",e,null,t,s,n)},GrantCharacterToUser:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/GrantCharacterToUser",e,"X-Authorization",t,s,n)},LinkAndroidDeviceID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkAndroidDeviceID",e,"X-Authorization",t,s,n)},LinkApple:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkApple",e,"X-Authorization",t,s,n)},LinkCustomID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkCustomID",e,"X-Authorization",t,s,n)},LinkFacebookAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkFacebookAccount",e,"X-Authorization",t,s,n)},LinkFacebookInstantGamesId:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkFacebookInstantGamesId",e,"X-Authorization",t,s,n)},LinkGameCenterAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkGameCenterAccount",e,"X-Authorization",t,s,n)},LinkGoogleAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkGoogleAccount",e,"X-Authorization",t,s,n)},LinkIOSDeviceID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkIOSDeviceID",e,"X-Authorization",t,s,n)},LinkKongregate:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkKongregate",e,"X-Authorization",t,s,n)},LinkNintendoServiceAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkNintendoServiceAccount",e,"X-Authorization",t,s,n)},LinkNintendoSwitchDeviceId:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkNintendoSwitchDeviceId",e,"X-Authorization",t,s,n)},LinkOpenIdConnect:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkOpenIdConnect",e,"X-Authorization",t,s,n)},LinkPSNAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkPSNAccount",e,"X-Authorization",t,s,n)},LinkSteamAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkSteamAccount",e,"X-Authorization",t,s,n)},LinkTwitch:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkTwitch",e,"X-Authorization",t,s,n)},LinkWindowsHello:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkWindowsHello",e,"X-Authorization",t,s,n)},LinkXboxAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LinkXboxAccount",e,"X-Authorization",t,s,n)},LoginWithAndroidDeviceID:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithAndroidDeviceID",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithApple:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithApple",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithCustomID:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithCustomID",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithEmailAddress:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithEmailAddress",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithFacebook:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithFacebook",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithFacebookInstantGamesId:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithFacebookInstantGamesId",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithGameCenter:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithGameCenter",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithGoogleAccount:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithGoogleAccount",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithIOSDeviceID:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithIOSDeviceID",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithKongregate:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithKongregate",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithNintendoServiceAccount:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithNintendoServiceAccount",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithNintendoSwitchDeviceId:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithNintendoSwitchDeviceId",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithOpenIdConnect:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithOpenIdConnect",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithPlayFab:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithPlayFab",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithPSN:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithPSN",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithSteam:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithSteam",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithTwitch:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithTwitch",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithWindowsHello:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithWindowsHello",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},LoginWithXbox:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/LoginWithXbox",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},Matchmake:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/Matchmake",e,"X-Authorization",t,s,n)},OpenTrade:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/OpenTrade",e,"X-Authorization",t,s,n)},PayForPurchase:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/PayForPurchase",e,"X-Authorization",t,s,n)},PurchaseItem:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/PurchaseItem",e,"X-Authorization",t,s,n)},RedeemCoupon:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RedeemCoupon",e,"X-Authorization",t,s,n)},RefreshPSNAuthToken:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RefreshPSNAuthToken",e,"X-Authorization",t,s,n)},RegisterForIOSPushNotification:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RegisterForIOSPushNotification",e,"X-Authorization",t,s,n)},RegisterPlayFabUser:function(e,s,t,n){if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RegisterPlayFabUser",e,null,function(e,t){null!=e&&null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket,PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n);throw PlayFab._internalSettings.errorTitleId},RegisterWithWindowsHello:function(e,s,t,n){var i;if(e.TitleId=PlayFab.settings.titleId||e.TitleId,e.TitleId)return i=JSON.parse(JSON.stringify(PlayFab._internalSettings.authenticationContext)),PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RegisterWithWindowsHello",e,null,function(e,t){null!=e&&(null!=e.data.SessionTicket&&(PlayFab._internalSettings.sessionTicket=e.data.SessionTicket),null!=e.data.EntityToken&&(PlayFab._internalSettings.entityToken=e.data.EntityToken.EntityToken),i=PlayFab._internalSettings.UpdateAuthenticationContext(i,e),PlayFab.ClientApi._MultiStepClientLogin(e.data.SettingsForUser.NeedsAttribution)),null!=s&&"function"==typeof s&&s(e,t)},t,n),new Promise(function(e){e(i)});throw PlayFab._internalSettings.errorTitleId},RemoveContactEmail:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RemoveContactEmail",e,"X-Authorization",t,s,n)},RemoveFriend:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RemoveFriend",e,"X-Authorization",t,s,n)},RemoveGenericID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RemoveGenericID",e,"X-Authorization",t,s,n)},RemoveSharedGroupMembers:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RemoveSharedGroupMembers",e,"X-Authorization",t,s,n)},ReportAdActivity:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ReportAdActivity",e,"X-Authorization",t,s,n)},ReportDeviceInfo:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ReportDeviceInfo",e,"X-Authorization",t,s,n)},ReportPlayer:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ReportPlayer",e,"X-Authorization",t,s,n)},RestoreIOSPurchases:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RestoreIOSPurchases",e,"X-Authorization",t,s,n)},RewardAdActivity:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/RewardAdActivity",e,"X-Authorization",t,s,n)},SendAccountRecoveryEmail:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/SendAccountRecoveryEmail",e,null,t,s,n)},SetFriendTags:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/SetFriendTags",e,"X-Authorization",t,s,n)},SetPlayerSecret:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/SetPlayerSecret",e,"X-Authorization",t,s,n)},StartGame:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/StartGame",e,"X-Authorization",t,s,n)},StartPurchase:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/StartPurchase",e,"X-Authorization",t,s,n)},SubtractUserVirtualCurrency:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/SubtractUserVirtualCurrency",e,"X-Authorization",t,s,n)},UnlinkAndroidDeviceID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkAndroidDeviceID",e,"X-Authorization",t,s,n)},UnlinkApple:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkApple",e,"X-Authorization",t,s,n)},UnlinkCustomID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkCustomID",e,"X-Authorization",t,s,n)},UnlinkFacebookAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkFacebookAccount",e,"X-Authorization",t,s,n)},UnlinkFacebookInstantGamesId:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkFacebookInstantGamesId",e,"X-Authorization",t,s,n)},UnlinkGameCenterAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkGameCenterAccount",e,"X-Authorization",t,s,n)},UnlinkGoogleAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkGoogleAccount",e,"X-Authorization",t,s,n)},UnlinkIOSDeviceID:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkIOSDeviceID",e,"X-Authorization",t,s,n)},UnlinkKongregate:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkKongregate",e,"X-Authorization",t,s,n)},UnlinkNintendoServiceAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkNintendoServiceAccount",e,"X-Authorization",t,s,n)},UnlinkNintendoSwitchDeviceId:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkNintendoSwitchDeviceId",e,"X-Authorization",t,s,n)},UnlinkOpenIdConnect:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkOpenIdConnect",e,"X-Authorization",t,s,n)},UnlinkPSNAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkPSNAccount",e,"X-Authorization",t,s,n)},UnlinkSteamAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkSteamAccount",e,"X-Authorization",t,s,n)},UnlinkTwitch:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkTwitch",e,"X-Authorization",t,s,n)},UnlinkWindowsHello:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkWindowsHello",e,"X-Authorization",t,s,n)},UnlinkXboxAccount:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlinkXboxAccount",e,"X-Authorization",t,s,n)},UnlockContainerInstance:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlockContainerInstance",e,"X-Authorization",t,s,n)},UnlockContainerItem:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UnlockContainerItem",e,"X-Authorization",t,s,n)},UpdateAvatarUrl:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateAvatarUrl",e,"X-Authorization",t,s,n)},UpdateCharacterData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateCharacterData",e,"X-Authorization",t,s,n)},UpdateCharacterStatistics:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateCharacterStatistics",e,"X-Authorization",t,s,n)},UpdatePlayerStatistics:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdatePlayerStatistics",e,"X-Authorization",t,s,n)},UpdateSharedGroupData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateSharedGroupData",e,"X-Authorization",t,s,n)},UpdateUserData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateUserData",e,"X-Authorization",t,s,n)},UpdateUserPublisherData:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateUserPublisherData",e,"X-Authorization",t,s,n)},UpdateUserTitleDisplayName:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/UpdateUserTitleDisplayName",e,"X-Authorization",t,s,n)},ValidateAmazonIAPReceipt:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ValidateAmazonIAPReceipt",e,"X-Authorization",t,s,n)},ValidateGooglePlayPurchase:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ValidateGooglePlayPurchase",e,"X-Authorization",t,s,n)},ValidateIOSReceipt:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ValidateIOSReceipt",e,"X-Authorization",t,s,n)},ValidateWindowsStoreReceipt:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/ValidateWindowsStoreReceipt",e,"X-Authorization",t,s,n)},WriteCharacterEvent:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/WriteCharacterEvent",e,"X-Authorization",t,s,n)},WriteTitleEvent:function(e,t,s,n){return PlayFab._internalSettings.ExecuteRequestWrapper("/Client/WriteTitleEvent",e,"X-Authorization",t,s,n)},_MultiStepClientLogin:function(e){if(e&&!PlayFab.settings.disableAdvertising&&null!==PlayFab.settings.advertisingIdType&&null!==PlayFab.settings.advertisingIdValue){e={};if(PlayFab.settings.advertisingIdType===PlayFab.settings.AD_TYPE_IDFA)e.Idfa=PlayFab.settings.advertisingIdValue;else{if(PlayFab.settings.advertisingIdType!==PlayFab.settings.AD_TYPE_ANDROID_ID)return;e.Adid=PlayFab.settings.advertisingIdValue}PlayFab.ClientApi.AttributeInstall(e,null)}}},PlayFab.ClientApi),gPlayFabCachedData=(PlayFab.RegisterWithPhaser=function(){"undefined"!=typeof Phaser&&void 0!==Phaser.Plugin&&(Phaser.Plugin.PlayFab=function(e,t){Phaser.Plugin.call(this,e,t)},Phaser.Plugin.PlayFab.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.PlayFab.prototype.constructor=Phaser.Plugin.PlayFab,Phaser.Plugin.PlayFab.prototype.PlayFab=PlayFab,Phaser.Plugin.PlayFab.prototype.settings=PlayFab.settings,Phaser.Plugin.PlayFab.prototype.ClientApi=PlayFab.ClientApi)},PlayFab.RegisterWithPhaser(),{Keys:[],PlayFabID:null,Results:[]}),gPFConst={kAddUsernamePassword:"AddUsernamePassword",kGetAccountInfo:"GetAccountInfo",kGetLeaderboard:"GetLeaderboard",kGetUserData:"GetUserData",kLoginWithXXX:"LoginWithXXX",kRegisterPlayFabUser:"RegisterPlayFabUser",kUpdatePlayerStatistics:"UpdatePlayerStatistics",kUpdateUserData:"UpdateUserData",kWriteClientSessionStartEvent:"client_session_start",kWriteClientSessionEndEvent:"client_session_end",kExecuteFunction:"execute_function"};async function PlayFab_WriteClientSessionStartEvent(){const e=localStorage.getItem("TM_LOCAL_USERNAME"),t={UserID:e,TitleID:PlayFab.settings.titleId,Source:"Telegram"},s=JSON.stringify(t),n={EventName:"client_session_start",Body:{PayloadJSON:s}};return gPlayFabCachedData.Results[gPFConst.kWriteClientSessionStartEvent]={Result:null,Error:null},i=n,new Promise((s,n)=>{PlayFabClientSDK.WritePlayerEvent(i,(e,t)=>{if(t)return n(t);s(e)})}).then(e=>{gPlayFabCachedData.Results[gPFConst.kWriteClientSessionStartEvent].Result=e,console.log("Event sent successfully:",e)}).catch(e=>{gPlayFabCachedData.Results[gPFConst.kWriteClientSessionStartEvent].Error=e,console.log("Error:"+CompileErrorReport(e))});var i}async function PlayFab_EnterTrainingEvent(){const e=localStorage.getItem("TM_LOCAL_USERNAME"),t={UserID:e,TitleID:PlayFab.settings.titleId,Source:"Telegram"},s=JSON.stringify(t),n={EventName:"client_training_start",Body:{PayloadJSON:s}};return gPlayFabCachedData.Results[gPFConst.kWriteClientSessionStartEvent]={Result:null,Error:null},i=n,new Promise((s,n)=>{PlayFabClientSDK.WritePlayerEvent(i,(e,t)=>{if(t)return n(t);s(e)})}).then(e=>{gPlayFabCachedData.Results[gPFConst.kWriteClientSessionStartEvent].Result=e,console.log("Event sent successfully:",e)}).catch(e=>{gPlayFabCachedData.Results[gPFConst.kWriteClientSessionStartEvent].Error=e,console.log("Error:"+CompileErrorReport(e))});var i}async function PlayFab_WriteClientSessionEndEvent(){const e=localStorage.getItem("TM_LOCAL_USERNAME"),t={UserID:e,TitleID:PlayFab.settings.titleId,Source:"Telegram"},s=JSON.stringify(t),n={EventName:"client_session_end",Body:{PayloadJSON:s}};return gPlayFabCachedData.Results[gPFConst.kWriteClientSessionEndEvent]={Result:null,Error:null},i=n,new Promise((s,n)=>{PlayFabClientSDK.WritePlayerEvent(i,(e,t)=>{if(t)return n(t);s(e)})}).then(e=>{gPlayFabCachedData.Results[gPFConst.kWriteClientSessionEndEvent].Result=e,console.log("Event sent successfully:",e)}).catch(e=>{gPlayFabCachedData.Results[gPFConst.kWriteClientSessionEndEvent].Error=e,console.log("Error:"+CompileErrorReport(e))});var i}function PlayFab_GetPlayFabID(){return gPlayFabCachedData&&gPlayFabCachedData.PlayFabID?gPlayFabCachedData.PlayFabID:""}async function PlayFab_LoginWithCustomID(e,t,s){console.log("PlayFab_LoginWithCustomID-IN");let n={TitleId:PlayFab.settings.titleId=e,CustomId:t,CreateAccount:s,InfoRequestParameters:{GetPlayerProfile:!0}};return gPlayFabCachedData.Results[gPFConst.kLoginWithXXX]={Result:null,Error:null},gPlayFabCachedData.PlayFabID=null,i=n,new Promise((s,n)=>{PlayFabClientSDK.LoginWithCustomID(i,(e,t)=>{if(t)return n(t);s(e)})}).then(e=>{gPlayFabCachedData.Results[gPFConst.kLoginWithXXX].Result=e,gPlayFabCachedData.PlayFabID=e.data.PlayFabId,console.log("PlayFab_LoginWithCustomID-OUT")}).catch(e=>{gPlayFabCachedData.Results[gPFConst.kLoginWithXXX].Error=e,console.log("Error:"+CompileErrorReport(e)),console.log("PlayFab_LoginWithCustomID-OUT")});var i}function CompileErrorReport(e){if(null===e)return"";if(e.errorMessage){var t,s=e.errorMessage;for(t in e.errorDetails)for(var n in e.errorDetails[t])s+="\n"+t+": "+e.errorDetails[t][n]}else s=e;return s}Object.freeze(gPFConst);var scriptsInEvents={async Systemlogic_Event187_Act1(e,t){const s=t.number;t="",t=1e12<=s?(Math.floor(s/1e10)/100).toFixed(2)+"T":1e9<=s?(Math.floor(s/1e7)/100).toFixed(2)+"B":1e6<=s?(Math.floor(s/1e4)/100).toFixed(2)+"M":1e4<=s?(Math.floor(s/10)/100).toFixed(2)+"K":Math.floor(s).toString();e.setReturnValue(t)},async Systemlogic_Event188_Act2(e,t){const s=t.number;t=s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");e.setReturnValue(t)},async Systemlogic_Event189_Act1(e,t){const s=t.number;t="",t=1e12<=s?(Math.floor(s/1e10)/100).toFixed(0)+"T":1e9<=s?(Math.floor(s/1e7)/100).toFixed(0)+"B":1e6<=s?(Math.floor(s/1e4)/100).toFixed(0)+"M":1e3<=s?(Math.floor(s/10)/100).toFixed(0)+"K":Math.floor(s).toString();e.setReturnValue(t)},async _backend_Event1_Act1(e,t){await backend.tasks.createTaskData()},async _backend_Event2_Act1(e,t){await backend.tasks.startEarnTask(t.taskSlug)},async _backend_Event3_Act1(e,t){await backend.tasks.verifyEarnTask(t.taskSlug)},async _backend_Event4_Act1(e,t){await backend.upgrades.buyUpgrade(t.slug)},async _backend_Event5_Act1(e,t){backend.crystal.registerTap()},async _backend_Event6_Act1(e,t){await backend.boost.upgradeTapPower()},async _backend_Event7_Act1(e,t){await backend.boost.refillEnergy()},async _backend_Event8_Act1(e,t){await backend.boost.upgradeEnergyLevel()},async _backend_Event9_Act1(e,t){await backend.clan.createClan(t.clanName)},async _backend_Event10_Act1(e,t){await backend.clan.leaveClan()},async _backend_Event11_Act1(e,t){await backend.notification.deleteNotification(t.notificationId)},async _backend_Event12_Act1(e,t){await backend.leaderboards.loadLeaderboard()},async _backend_Event13_Act1(e,t){await backend.clan.joinClan()},async _backend_Event14_Act1(e,t){await backend.clan.loadClanMembers()},async _backend_Event15_Act1(e,t){await backend.tasks.loadLoginStreak()},async _backend_Event16_Act1(e,t){await backend.tasks.collectLoginStreak(t.day)},async _backend_Event17_Act1(e,t){await backend.me.loadReferrals()},async _backend_Event18_Act1(e,t){backend.telegram.openLink(t.link)},async _backend_Event19_Act1(e,t){await backend.telegram.buyFeatureWithStars(t.featureSlug)},async _backend_Event20_Act1(e,t){e.setReturnValue(backend.telegram.getReferralLink())},async _backend_Event21_Act1(e,t){backend.telegram.inviteFriend()},async _backend_Event22_Act1(e,t){e.setReturnValue(backend.telegram.getClanInviteLink())},async _backend_Event23_Act1(e,t){backend.telegram.inviteToClan()},async _backend_Event24_Act1(e,t){e.setReturnValue(backend.images.getUpgradeImageUrl(t.slug))},async _backend_Event25_Act1(e,t){e.setReturnValue(backend.images.getMonsterImageUrl(t.slug))},async _backend_Event26_Act1(e,t){e.setReturnValue(backend.images.getMonsterBackImageUrl(t.slug))},async _backend_Event27_Act1(e,t){await backend.me.verifyTelegramChannelJoin()},async _backend_Event28_Act1(e,t){await backend.crystal.sendCurrentTaps()},async _backend_Event29_Act1(e,t){await backend.training.startTraining(t.trainingMonsterSlug)},async _backend_Event30_Act1(e,t){await backend.training.executeMove(t.moveType,t.taps,t.countedTaps)},async _backend_Event31_Act1(e,t){await backend.training.cancelSession()},async _backend_Event32_Act1(e,t){await backend.training.partiallyHealMonster(t.slug,t.taps)},async _backend_Event33_Act1(e,t){await backend.training.fullyHealMonster(t.slug)},async _backend_Event34_Act1(e,t){await backend.boost.refillEnergyWithAd()},async Trainingbackendlinking_Event11_Act1(s,e){let n={Pyro:["Cryo","Electro","Dendro"],Cryo:["Hydro","Electro"],Hydro:["Pyro"],Electro:["Hydro"],Anemo:["Pyro","Geo"],Geo:["Electro","Geo"],Dendro:["Hydro"]},i=(e,t)=>n[e].includes(t)?2:(n[t].includes(e),1),r=e.player_hp,t=e.player_action,a=e.player_energy,o=0,l=e.opponent_hp,h=e.opponent_action,c=0,u,d=2,_=e.tap_power,p=2,m=200*Math.random(),g=[];"block"==t&&g.push({type:"block",source:"player"}),"block"==h&&g.push({type:"block",source:"opponent"}),m<(u=5*_)?("attack"==t&&(a>_?(a-=_,g.push({type:"attack",source:"player"})):g.push({type:"block",source:"player"})),"attack"==h&&g.push({type:"attack",source:"opponent"})):("attack"==h&&g.push({type:"attack",source:"opponent"}),"attack"==t&&(a>_?(a-=_,g.push({type:"attack",source:"player"})):g.push({type:"block",source:"player"}))),"player"==g[0].source?s.globalVars.TrainingPlayerFirstAction=!0:s.globalVars.TrainingPlayerFirstAction=!1;for(const f of g)if("block"==f.type)"player"==f.source?(d*=2,a+=10*u,o=0):(p*=2,c=0);else if("attack"==f.type)if("player"==f.source){let e=i("Geo","Geo"),t=_/10*3*e;if(t=0<(t=Math.floor(t)-p)?t:0,l-=t,o=t,l<=0){s.globalVars.BattleStatus="player_win";const S=Math.floor(3*1.2),y=Math.floor(5*_);s.globalVars.TrainingEXPEarned=S,s.globalVars.TrainingCoinsEarned=y;break}}else{let e=i("Geo","Geo"),t=m/10*2*e;if(t=0<(t=Math.floor(t)-d)?t:0,r-=t,c=t,r<=0){s.globalVars.BattleStatus="opponent_win",s.globalVars.TrainingEXPEarned=0,s.globalVars.TrainingCoinsEarned=0;break}}s.globalVars.PlayerDamageDealt=o,s.globalVars.OpponentDamageDealt=c,s.globalVars.PlayerHP=r,s.globalVars.OpponentHP=l,s.globalVars.TrainingPlayerEnergy=a},async Playfabfunctions_Event2_Act1(e,t){let s,n=e.objects.me.getFirstInstance().getJsonDataCopy();await PlayFab_LoginWithCustomID("92E4D",n.telegramId,!0),s=await PlayFab_GetPlayFabID(),localStorage.setItem("PLAYFABID",s)},async Playfabfunctions_Event3_Act1(e,t){await PlayFab_WriteClientSessionStartEvent()},async Playfabfunctions_Event4_Act1(e,t){await PlayFab_WriteClientSessionEndEvent()},async Playfabfunctions_Event5_Act1(e,t){await PlayFab_EnterTrainingEvent()}};self.C3.ScriptsInEvents=scriptsInEvents;